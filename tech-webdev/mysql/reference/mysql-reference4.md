n bytes required for value storage.

For descriptions of WKB and internal storage formats for spatial values,
see *note gis-data-formats::.


File: manual.info.tmp,  Node: choosing-types,  Next: other-vendor-data-types,  Prev: storage-requirements,  Up: data-types

11.7 Choosing the Right Type for a Column
=========================================

For optimum storage, you should try to use the most precise type in all
cases.  For example, if an integer column is used for values in the
range from '1' to '99999', 'MEDIUMINT UNSIGNED' is the best type.  Of
the types that represent all the required values, this type uses the
least amount of storage.

All basic calculations ('+', '-', '*', and '/') with *note 'DECIMAL':
fixed-point-types. columns are done with precision of 65 decimal (base
10) digits.  See *note numeric-type-syntax::.

If accuracy is not too important or if speed is the highest priority,
the *note 'DOUBLE': floating-point-types. type may be good enough.  For
high precision, you can always convert to a fixed-point type stored in a
*note 'BIGINT': integer-types.  This enables you to do all calculations
with 64-bit integers and then convert results back to floating-point
values as necessary.

'PROCEDURE ANALYSE' can be used to obtain suggestions for optimal column
data types.  For more information, see *note procedure-analyse::.


File: manual.info.tmp,  Node: other-vendor-data-types,  Prev: choosing-types,  Up: data-types

11.8 Using Data Types from Other Database Engines
=================================================

To facilitate the use of code written for SQL implementations from other
vendors, MySQL maps data types as shown in the following table.  These
mappings make it easier to import table definitions from other database
systems into MySQL.

Other Vendor Type         MySQL Type
                          
*note 'BOOL': integer-types.*note 'TINYINT': integer-types.
                          
*note 'BOOLEAN': integer-types.*note 'TINYINT': integer-types.
                          
'CHARACTER VARYING(M)'    'VARCHAR(M)'
                          
*note 'FIXED': fixed-point-types.*note 'DECIMAL': fixed-point-types.
                          
*note 'FLOAT4': floating-point-types.*note 'FLOAT': floating-point-types.
                          
*note 'FLOAT8': floating-point-types.*note 'DOUBLE': floating-point-types.
                          
*note 'INT1': integer-types.*note 'TINYINT': integer-types.
                          
*note 'INT2': integer-types.*note 'SMALLINT': integer-types.
                          
*note 'INT3': integer-types.*note 'MEDIUMINT': integer-types.
                          
*note 'INT4': integer-types.*note 'INT': integer-types.
                          
'INT8'                    *note 'BIGINT': integer-types.
                          
'LONG VARBINARY'          *note 'MEDIUMBLOB': blob.
                          
'LONG VARCHAR'            *note 'MEDIUMTEXT': blob.
                          
'LONG'                    *note 'MEDIUMTEXT': blob.
                          
*note 'MIDDLEINT': integer-types.*note 'MEDIUMINT': integer-types.
                          
*note 'NUMERIC': fixed-point-types.*note 'DECIMAL': fixed-point-types.

Data type mapping occurs at table creation time, after which the
original type specifications are discarded.  If you create a table with
types used by other vendors and then issue a 'DESCRIBE TBL_NAME'
statement, MySQL reports the table structure using the equivalent MySQL
types.  For example:

     mysql> CREATE TABLE t (a BOOL, b FLOAT8, c LONG VARCHAR, d NUMERIC);
     Query OK, 0 rows affected (0.00 sec)

     mysql> DESCRIBE t;
     +-------+---------------+------+-----+---------+-------+
     | Field | Type          | Null | Key | Default | Extra |
     +-------+---------------+------+-----+---------+-------+
     | a     | tinyint(1)    | YES  |     | NULL    |       |
     | b     | double        | YES  |     | NULL    |       |
     | c     | mediumtext    | YES  |     | NULL    |       |
     | d     | decimal(10,0) | YES  |     | NULL    |       |
     +-------+---------------+------+-----+---------+-------+
     4 rows in set (0.01 sec)


File: manual.info.tmp,  Node: functions,  Next: sql-statements,  Prev: data-types,  Up: Top

12 Functions and Operators
**************************

* Menu:

* func-op-summary-ref::          Function and Operator Reference
* type-conversion::              Type Conversion in Expression Evaluation
* non-typed-operators::          Operators
* control-flow-functions::       Control Flow Functions
* numeric-functions::            Numeric Functions and Operators
* date-and-time-functions::      Date and Time Functions
* string-functions::             String Functions and Operators
* mysql-calendar::               What Calendar Is Used By MySQL?
* fulltext-search::              Full-Text Search Functions
* cast-functions::               Cast Functions and Operators
* xml-functions::                XML Functions
* bit-functions::                Bit Functions and Operators
* encryption-functions::         Encryption and Compression Functions
* locking-functions::            Locking Functions
* information-functions::        Information Functions
* spatial-analysis-functions::   Spatial Analysis Functions
* group-by-functions-and-modifiers::  Aggregate (GROUP BY) Functions
* miscellaneous-functions::      Miscellaneous Functions
* precision-math::               Precision Math

Expressions can be used at several points in SQL statements, such as in
the 'ORDER BY' or 'HAVING' clauses of *note 'SELECT': select.
statements, in the 'WHERE' clause of a *note 'SELECT': select, *note
'DELETE': delete, or *note 'UPDATE': update. statement, or in *note
'SET': set-variable. statements.  Expressions can be written using
literal values, column values, 'NULL', built-in functions, stored
functions, user-defined functions, and operators.  This chapter
describes the functions and operators that are permitted for writing
expressions in MySQL. Instructions for writing stored functions and
user-defined functions are given in *note stored-routines::, and *note
adding-functions::.  See *note function-resolution::, for the rules
describing how the server interprets references to different kinds of
functions.

An expression that contains 'NULL' always produces a 'NULL' value unless
otherwise indicated in the documentation for a particular function or
operator.

*Note*:

By default, there must be no whitespace between a function name and the
parenthesis following it.  This helps the MySQL parser distinguish
between function calls and references to tables or columns that happen
to have the same name as a function.  However, spaces around function
arguments are permitted.

You can tell the MySQL server to accept spaces after function names by
starting it with the '--sql-mode=IGNORE_SPACE' option.  (See *note
sql-mode::.)  Individual client programs can request this behavior by
using the 'CLIENT_IGNORE_SPACE' option for *note 'mysql_real_connect()':
mysql-real-connect.  In either case, all function names become reserved
words.

For the sake of brevity, most examples in this chapter display the
output from the *note 'mysql': mysql. program in abbreviated form.
Rather than showing examples in this format:

     mysql> SELECT MOD(29,9);
     +-----------+
     | mod(29,9) |
     +-----------+
     |         2 |
     +-----------+
     1 rows in set (0.00 sec)

This format is used instead:

     mysql> SELECT MOD(29,9);
             -> 2


File: manual.info.tmp,  Node: func-op-summary-ref,  Next: type-conversion,  Prev: functions,  Up: functions

12.1 Function and Operator Reference
====================================

*Functions and Operators*

Name                          Description
                              
'&'                           Bitwise AND
                              
'>'                           Greater than operator
                              
'>>'                          Right shift
                              
'>='                          Greater than or equal operator
                              
'<'                           Less than operator
                              
'<>', '!='                    Not equal operator
                              
'<<'                          Left shift
                              
'<='                          Less than or equal operator
                              
'<=>'                         NULL-safe equal to operator
                              
'%', 'MOD'                    Modulo operator
                              
'*'                           Multiplication operator
                              
'+'                           Addition operator
                              
'-'                           Minus operator
                              
'-'                           Change the sign of the argument
                              
'/'                           Division operator
                              
':='                          Assign a value
                              
'='                           Assign a value (as part of a
                              *note 'SET': set-variable. statement, or
                              as part of the 'SET' clause in an
                              *note 'UPDATE': update. statement)
                              
'='                           Equal operator
                              
'^'                           Bitwise XOR
                              
'ABS()'                       Return the absolute value
                              
'ACOS()'                      Return the arc cosine
                              
'ADDDATE()'                   Add time values (intervals) to a date
                              value
                              
'ADDTIME()'                   Add time
                              
'AES_DECRYPT()'               Decrypt using AES
                              
'AES_ENCRYPT()'               Encrypt using AES
                              
'AND', '&&'                   Logical AND
                              
'Area()'                      Return Polygon or MultiPolygon area
                              
'AsBinary()', 'AsWKB()'       Convert from internal geometry format to
                              WKB
                              
'ASCII()'                     Return numeric value of left-most
                              character
                              
'ASIN()'                      Return the arc sine
                              
'AsText()', 'AsWKT()'         Convert from internal geometry format to
                              WKT
                              
'ATAN()'                      Return the arc tangent
                              
'ATAN2()', 'ATAN()'           Return the arc tangent of the two
                              arguments
                              
'AVG()'                       Return the average value of the argument
                              
'BENCHMARK()'                 Repeatedly execute an expression
                              
'BETWEEN ... AND ...'         Whether a value is within a range of
                              values
                              
'BIN()'                       Return a string containing binary
                              representation of a number
                              
'BINARY'                      Cast a string to a binary string
                              
'BIT_AND()'                   Return bitwise AND
                              
'BIT_COUNT()'                 Return the number of bits that are set
                              
'BIT_LENGTH()'                Return length of argument in bits
                              
'BIT_OR()'                    Return bitwise OR
                              
'BIT_XOR()'                   Return bitwise XOR
                              
'CASE'                        Case operator
                              
'CAST()'                      Cast a value as a certain type
                              
'CEIL()'                      Return the smallest integer value not
                              less than the argument
                              
'CEILING()'                   Return the smallest integer value not
                              less than the argument
                              
'Centroid()'                  Return centroid as a point
                              
'CHAR()'                      Return the character for each integer
                              passed
                              
'CHAR_LENGTH()'               Return number of characters in argument
                              
'CHARACTER_LENGTH()'          Synonym for CHAR_LENGTH()
                              
'CHARSET()'                   Return the character set of the argument
                              
'COALESCE()'                  Return the first non-NULL argument
                              
'COERCIBILITY()'              Return the collation coercibility value
                              of the string argument
                              
'COLLATION()'                 Return the collation of the string
                              argument
                              
'COMPRESS()'                  Return result as a binary string
                              
'CONCAT()'                    Return concatenated string
                              
'CONCAT_WS()'                 Return concatenate with separator
                              
'CONNECTION_ID()'             Return the connection ID (thread ID) for
                              the connection
                              
'Contains()'                  Whether MBR of one geometry contains MBR
                              of another
                              
'CONV()'                      Convert numbers between different number
                              bases
                              
'CONVERT()'                   Cast a value as a certain type
                              
'CONVERT_TZ()'                Convert from one time zone to another
                              
'COS()'                       Return the cosine
                              
'COT()'                       Return the cotangent
                              
'COUNT()'                     Return a count of the number of rows
                              returned
                              
'COUNT(DISTINCT)'             Return the count of a number of different
                              values
                              
'CRC32()'                     Compute a cyclic redundancy check value
                              
'Crosses()'                   Whether one geometry crosses another
                              
'CURDATE()'                   Return the current date
                              
'CURRENT_DATE()',             Synonyms for CURDATE()
'CURRENT_DATE'                

'CURRENT_TIME()',             Synonyms for CURTIME()
'CURRENT_TIME'                

'CURRENT_TIMESTAMP()',        Synonyms for NOW()
'CURRENT_TIMESTAMP'           

'CURRENT_USER()',             The authenticated user name and host name
'CURRENT_USER'                

'CURTIME()'                   Return the current time
                              
'DATABASE()'                  Return the default (current) database
                              name
                              
'DATE()'                      Extract the date part of a date or
                              datetime expression
                              
'DATE_ADD()'                  Add time values (intervals) to a date
                              value
                              
'DATE_FORMAT()'               Format date as specified
                              
'DATE_SUB()'                  Subtract a time value (interval) from a
                              date
                              
'DATEDIFF()'                  Subtract two dates
                              
'DAY()'                       Synonym for DAYOFMONTH()
                              
'DAYNAME()'                   Return the name of the weekday
                              
'DAYOFMONTH()'                Return the day of the month (0-31)
                              
'DAYOFWEEK()'                 Return the weekday index of the argument
                              
'DAYOFYEAR()'                 Return the day of the year (1-366)
                              
'DECODE()'                    Decode a string encrypted using ENCODE()
                              
'DEFAULT()'                   Return the default value for a table
                              column
                              
'DEGREES()'                   Convert radians to degrees
                              
'DES_DECRYPT()'               Decrypt a string
                              
'DES_ENCRYPT()'               Encrypt a string
                              
'Dimension()'                 Dimension of geometry
                              
'Disjoint()'                  Whether MBRs of two geometries are
                              disjoint
                              
'DIV'                         Integer division
                              
'ELT()'                       Return string at index number
                              
'ENCODE()'                    Encode a string
                              
'ENCRYPT()'                   Encrypt a string
                              
'EndPoint()'                  End Point of LineString
                              
'Envelope()'                  Return MBR of geometry
                              
'Equals()'                    Whether MBRs of two geometries are equal
                              
'EXP()'                       Raise to the power of
                              
'EXPORT_SET()'                Return a string such that for every bit
                              set in the value bits, you get an on
                              string and for every unset bit, you get
                              an off string
                              
'ExteriorRing()'              Return exterior ring of Polygon
                              
'EXTRACT()'                   Extract part of a date
                              
'ExtractValue()'              Extract a value from an XML string using
                              XPath notation
                              
'FIELD()'                     Index (position) of first argument in
                              subsequent arguments
                              
'FIND_IN_SET()'               Index (position) of first argument within
                              second argument
                              
'FLOOR()'                     Return the largest integer value not
                              greater than the argument
                              
'FORMAT()'                    Return a number formatted to specified
                              number of decimal places
                              
'FOUND_ROWS()'                For a SELECT with a LIMIT clause, the
                              number of rows that would be returned
                              were there no LIMIT clause
                              
'FROM_DAYS()'                 Convert a day number to a date
                              
'FROM_UNIXTIME()'             Format Unix timestamp as a date
                              
'GeomCollFromText()',         Return geometry collection from WKT
'GeometryCollectionFromText()'

'GeomCollFromWKB()',          Return geometry collection from WKB
'GeometryCollectionFromWKB()' 

'GeometryCollection()'        Construct geometry collection from
                              geometries
                              
'GeometryN()'                 Return N-th geometry from geometry
                              collection
                              
'GeometryType()'              Return name of geometry type
                              
'GeomFromText()',             Return geometry from WKT
'GeometryFromText()'          

'GeomFromWKB()',              Return geometry from WKB
'GeometryFromWKB()'           

'GET_FORMAT()'                Return a date format string
                              
'GET_LOCK()'                  Get a named lock
                              
'GLength()'                   Return length of LineString
                              
'GREATEST()'                  Return the largest argument
                              
'GROUP_CONCAT()'              Return a concatenated string
                              
'HEX()'                       Hexadecimal representation of decimal or
                              string value
                              
'HOUR()'                      Extract the hour
                              
'IF()'                        If/else construct
                              
'IFNULL()'                    Null if/else construct
                              
'IN()'                        Whether a value is within a set of values
                              
'INET_ATON()'                 Return the numeric value of an IP address
                              
'INET_NTOA()'                 Return the IP address from a numeric
                              value
                              
'INSERT()'                    Insert substring at specified position up
                              to specified number of characters
                              
'INSTR()'                     Return the index of the first occurrence
                              of substring
                              
'InteriorRingN()'             Return N-th interior ring of Polygon
                              
'Intersects()'                Whether MBRs of two geometries intersect
                              
'INTERVAL()'                  Return the index of the argument that is
                              less than the first argument
                              
'IS'                          Test a value against a boolean
                              
'IS_FREE_LOCK()'              Whether the named lock is free
                              
'IS NOT'                      Test a value against a boolean
                              
'IS NOT NULL'                 NOT NULL value test
                              
'IS NULL'                     NULL value test
                              
'IS_USED_LOCK()'              Whether the named lock is in use; return
                              connection identifier if true
                              
'IsClosed()'                  Whether a geometry is closed and simple
                              
'IsEmpty()'                   Placeholder function
                              
'ISNULL()'                    Test whether the argument is NULL
                              
'IsSimple()'                  Whether a geometry is simple
                              
'LAST_DAY'                    Return the last day of the month for the
                              argument
                              
'LAST_INSERT_ID()'            Value of the AUTOINCREMENT column for the
                              last INSERT
                              
'LCASE()'                     Synonym for LOWER()
                              
'LEAST()'                     Return the smallest argument
                              
'LEFT()'                      Return the leftmost number of characters
                              as specified
                              
'LENGTH()'                    Return the length of a string in bytes
                              
'LIKE'                        Simple pattern matching
                              
'LineFromText()',             Construct LineString from WKT
'LineStringFromText()'        

'LineFromWKB()',              Construct LineString from WKB
'LineStringFromWKB()'         

'LineString()'                Construct LineString from Point values
                              
'LN()'                        Return the natural logarithm of the
                              argument
                              
'LOAD_FILE()'                 Load the named file
                              
'LOCALTIME()', 'LOCALTIME'    Synonym for NOW()
                              
'LOCALTIMESTAMP',             Synonym for NOW()
'LOCALTIMESTAMP()'            

'LOCATE()'                    Return the position of the first
                              occurrence of substring
                              
'LOG()'                       Return the natural logarithm of the first
                              argument
                              
'LOG10()'                     Return the base-10 logarithm of the
                              argument
                              
'LOG2()'                      Return the base-2 logarithm of the
                              argument
                              
'LOWER()'                     Return the argument in lowercase
                              
'LPAD()'                      Return the string argument, left-padded
                              with the specified string
                              
'LTRIM()'                     Remove leading spaces
                              
'MAKE_SET()'                  Return a set of comma-separated strings
                              that have the corresponding bit in bits
                              set
                              
'MAKEDATE()'                  Create a date from the year and day of
                              year
                              
'MAKETIME()'                  Create time from hour, minute, second
                              
'MASTER_POS_WAIT()'           Block until the slave has read and
                              applied all updates up to the specified
                              position
                              
'MATCH'                       Perform full-text search
                              
'MAX()'                       Return the maximum value
                              
'MBRContains()'               Whether MBR of one geometry contains MBR
                              of another
                              
'MBRDisjoint()'               Whether MBRs of two geometries are
                              disjoint
                              
'MBREqual()'                  Whether MBRs of two geometries are equal
                              
'MBRIntersects()'             Whether MBRs of two geometries intersect
                              
'MBROverlaps()'               Whether MBRs of two geometries overlap
                              
'MBRTouches()'                Whether MBRs of two geometries touch
                              
'MBRWithin()'                 Whether MBR of one geometry is within MBR
                              of another
                              
'MD5()'                       Calculate MD5 checksum
                              
'MICROSECOND()'               Return the microseconds from argument
                              
'MID()'                       Return a substring starting from the
                              specified position
                              
'MIN()'                       Return the minimum value
                              
'MINUTE()'                    Return the minute from the argument
                              
'MLineFromText()',            Construct MultiLineString from WKT
'MultiLineStringFromText()'   

'MLineFromWKB()',             Construct MultiLineString from WKB
'MultiLineStringFromWKB()'    

'MOD()'                       Return the remainder
                              
'MONTH()'                     Return the month from the date passed
                              
'MONTHNAME()'                 Return the name of the month
                              
'MPointFromText()',           Construct MultiPoint from WKT
'MultiPointFromText()'        

'MPointFromWKB()',            Construct MultiPoint from WKB
'MultiPointFromWKB()'         

'MPolyFromText()',            Construct MultiPolygon from WKT
'MultiPolygonFromText()'      

'MPolyFromWKB()',             Construct MultiPolygon from WKB
'MultiPolygonFromWKB()'       

'MultiLineString()'           Contruct MultiLineString from LineString
                              values
                              
'MultiPoint()'                Construct MultiPoint from Point values
                              
'MultiPolygon()'              Construct MultiPolygon from Polygon
                              values
                              
'NAME_CONST()'                Cause the column to have the given name
                              
'NOT', '!'                    Negates value
                              
'NOT BETWEEN ... AND ...'     Whether a value is not within a range of
                              values
                              
'NOT IN()'                    Whether a value is not within a set of
                              values
                              
'NOT LIKE'                    Negation of simple pattern matching
                              
'NOT REGEXP'                  Negation of REGEXP
                              
'NOW()'                       Return the current date and time
                              
'NULLIF()'                    Return NULL if expr1 = expr2
                              
'NumGeometries()'             Return number of geometries in geometry
                              collection
                              
'NumInteriorRings()'          Return number of interior rings in
                              Polygon
                              
'NumPoints()'                 Return number of points in LineString
                              
'OCT()'                       Return a string containing octal
                              representation of a number
                              
'OCTET_LENGTH()'              Synonym for LENGTH()
                              
'OLD_PASSWORD()'              Return the value of the pre-4.1
                              implementation of PASSWORD
                              
'OR', '||'                    Logical OR
                              
'ORD()'                       Return character code for leftmost
                              character of the argument
                              
'Overlaps()'                  Whether MBRs of two geometries overlap
                              
'PASSWORD()'                  Calculate and return a password string
                              
'PERIOD_ADD()'                Add a period to a year-month
                              
'PERIOD_DIFF()'               Return the number of months between
                              periods
                              
'PI()'                        Return the value of pi
                              
'Point()'                     Construct Point from coordinates
                              
'PointFromText()'             Construct Point from WKT
                              
'PointFromWKB()'              Construct Point from WKB
                              
'PointN()'                    Return N-th point from LineString
                              
'PolyFromText()',             Construct Polygon from WKT
'PolygonFromText()'           

'PolyFromWKB()',              Construct Polygon from WKB
'PolygonFromWKB()'            

'Polygon()'                   Construct Polygon from LineString
                              arguments
                              
'POSITION()'                  Synonym for LOCATE()
                              
'POW()'                       Return the argument raised to the
                              specified power
                              
'POWER()'                     Return the argument raised to the
                              specified power
                              
*note 'PROCEDURE ANALYSE()': procedure-analyse.Analyze the results of a query
                              
'QUARTER()'                   Return the quarter from a date argument
                              
'QUOTE()'                     Escape the argument for use in an SQL
                              statement
                              
'RADIANS()'                   Return argument converted to radians
                              
'RAND()'                      Return a random floating-point value
                              
'REGEXP'                      Whether string matches regular expression
                              
'RELEASE_LOCK()'              Release the named lock
                              
'REPEAT()'                    Repeat a string the specified number of
                              times
                              
'REPLACE()'                   Replace occurrences of a specified string
                              
'REVERSE()'                   Reverse the characters in a string
                              
'RIGHT()'                     Return the specified rightmost number of
                              characters
                              
'RLIKE'                       Whether string matches regular expression
                              
'ROUND()'                     Round the argument
                              
'ROW_COUNT()'                 The number of rows updated
                              
'RPAD()'                      Append string the specified number of
                              times
                              
'RTRIM()'                     Remove trailing spaces
                              
'SCHEMA()'                    Synonym for DATABASE()
                              
'SEC_TO_TIME()'               Converts seconds to 'hh:mm:ss' format
                              
'SECOND()'                    Return the second (0-59)
                              
'SESSION_USER()'              Synonym for USER()
                              
'SHA1()', 'SHA()'             Calculate an SHA-1 160-bit checksum
                              
'SHA2()'                      Calculate an SHA-2 checksum
                              
'SIGN()'                      Return the sign of the argument
                              
'SIN()'                       Return the sine of the argument
                              
'SLEEP()'                     Sleep for a number of seconds
                              
'SOUNDEX()'                   Return a soundex string
                              
'SOUNDS LIKE'                 Compare sounds
                              
'SPACE()'                     Return a string of the specified number
                              of spaces
                              
'SQRT()'                      Return the square root of the argument
                              
'SRID()'                      Return spatial reference system ID for
                              geometry
                              
'StartPoint()'                Start Point of LineString
                              
'STD()'                       Return the population standard deviation
                              
'STDDEV()'                    Return the population standard deviation
                              
'STDDEV_POP()'                Return the population standard deviation
                              
'STDDEV_SAMP()'               Return the sample standard deviation
                              
'STR_TO_DATE()'               Convert a string to a date
                              
'STRCMP()'                    Compare two strings
                              
'SUBDATE()'                   Synonym for DATE_SUB() when invoked with
                              three arguments
                              
'SUBSTR()'                    Return the substring as specified
                              
'SUBSTRING()'                 Return the substring as specified
                              
'SUBSTRING_INDEX()'           Return a substring from a string before
                              the specified number of occurrences of
                              the delimiter
                              
'SUBTIME()'                   Subtract times
                              
'SUM()'                       Return the sum
                              
'SYSDATE()'                   Return the time at which the function
                              executes
                              
'SYSTEM_USER()'               Synonym for USER()
                              
'TAN()'                       Return the tangent of the argument
                              
'TIME()'                      Extract the time portion of the
                              expression passed
                              
'TIME_FORMAT()'               Format as time
                              
'TIME_TO_SEC()'               Return the argument converted to seconds
                              
'TIMEDIFF()'                  Subtract time
                              
'TIMESTAMP()'                 With a single argument, this function
                              returns the date or datetime expression;
                              with two arguments, the sum of the
                              arguments
                              
'TIMESTAMPADD()'              Add an interval to a datetime expression
                              
'TIMESTAMPDIFF()'             Subtract an interval from a datetime
                              expression
                              
'TO_DAYS()'                   Return the date argument converted to
                              days
                              
'TO_SECONDS()'                Return the date or datetime argument
                              converted to seconds since Year 0
                              
'Touches()'                   Whether one geometry touches another
                              
'TRIM()'                      Remove leading and trailing spaces
                              
'TRUNCATE()'                  Truncate to specified number of decimal
                              places
                              
'UCASE()'                     Synonym for UPPER()
                              
'UNCOMPRESS()'                Uncompress a string compressed
                              
'UNCOMPRESSED_LENGTH()'       Return the length of a string before
                              compression
                              
'UNHEX()'                     Return a string containing hex
                              representation of a number
                              
'UNIX_TIMESTAMP()'            Return a Unix timestamp
                              
'UpdateXML()'                 Return replaced XML fragment
                              
'UPPER()'                     Convert to uppercase
                              
'USER()'                      The user name and host name provided by
                              the client
                              
'UTC_DATE()'                  Return the current UTC date
                              
'UTC_TIME()'                  Return the current UTC time
                              
'UTC_TIMESTAMP()'             Return the current UTC date and time
                              
'UUID()'                      Return a Universal Unique Identifier
                              (UUID)
                              
'UUID_SHORT()'                Return an integer-valued universal
                              identifier
                              
'VALUES()'                    Define the values to be used during an
                              INSERT
                              
'VAR_POP()'                   Return the population standard variance
                              
'VAR_SAMP()'                  Return the sample variance
                              
'VARIANCE()'                  Return the population standard variance
                              
'VERSION()'                   Return a string that indicates the MySQL
                              server version
                              
'WEEK()'                      Return the week number
                              
'WEEKDAY()'                   Return the weekday index
                              
'WEEKOFYEAR()'                Return the calendar week of the date
                              (1-53)
                              
'Within()'                    Whether MBR of one geometry is within MBR
                              of another
                              
'X()'                         Return X coordinate of Point
                              
'XOR'                         Logical XOR
                              
'Y()'                         Return Y coordinate of Point
                              
'YEAR()'                      Return the year
                              
'YEARWEEK()'                  Return the year and week
                              
'|'                           Bitwise OR
                              
'~'                           Bitwise inversion


File: manual.info.tmp,  Node: type-conversion,  Next: non-typed-operators,  Prev: func-op-summary-ref,  Up: functions

12.2 Type Conversion in Expression Evaluation
=============================================

When an operator is used with operands of different types, type
conversion occurs to make the operands compatible.  Some conversions
occur implicitly.  For example, MySQL automatically converts strings to
numbers as necessary, and vice versa.

     mysql> SELECT 1+'1';
             -> 2
     mysql> SELECT CONCAT(2,' test');
             -> '2 test'

It is also possible to convert a number to a string explicitly using the
'CAST()' function.  Conversion occurs implicitly with the 'CONCAT()'
function because it expects string arguments.

     mysql> SELECT 38.8, CAST(38.8 AS CHAR);
             -> 38.8, '38.8'
     mysql> SELECT 38.8, CONCAT(38.8);
             -> 38.8, '38.8'

See later in this section for information about the character set of
implicit number-to-string conversions, and for modified rules that apply
to 'CREATE TABLE ... SELECT' statements.

The following rules describe how conversion occurs for comparison
operations:

   * If one or both arguments are 'NULL', the result of the comparison
     is 'NULL', except for the 'NULL'-safe '<=>' equality comparison
     operator.  For 'NULL <=> NULL', the result is true.  No conversion
     is needed.

   * If both arguments in a comparison operation are strings, they are
     compared as strings.

   * If both arguments are integers, they are compared as integers.

   * Hexadecimal values are treated as binary strings if not compared to
     a number.

   * If one of the arguments is a *note 'TIMESTAMP': datetime. or *note
     'DATETIME': datetime. column and the other argument is a constant,
     the constant is converted to a timestamp before the comparison is
     performed.  This is done to be more ODBC-friendly.  This is not
     done for the arguments to 'IN()'.  To be safe, always use complete
     datetime, date, or time strings when doing comparisons.  For
     example, to achieve best results when using 'BETWEEN' with date or
     time values, use 'CAST()' to explicitly convert the values to the
     desired data type.

   * If one of the arguments is a decimal value, comparison depends on
     the other argument.  The arguments are compared as decimal values
     if the other argument is a decimal or integer value, or as
     floating-point values if the other argument is a floating-point
     value.

   * In all other cases, the arguments are compared as floating-point
     (real) numbers.  For example, a comparison of string and numeric
     operands takes places as a comparison of floating-point numbers.

For information about conversion of values from one temporal type to
another, see *note date-and-time-type-conversion::.

The following examples illustrate conversion of strings to numbers for
comparison operations:

     mysql> SELECT 1 > '6x';
             -> 0
     mysql> SELECT 7 > '6x';
             -> 1
     mysql> SELECT 0 > 'x6';
             -> 0
     mysql> SELECT 0 = 'x6';
             -> 1

For comparisons of a string column with a number, MySQL cannot use an
index on the column to look up the value quickly.  If STR_COL is an
indexed string column, the index cannot be used when performing the
lookup in the following statement:

     SELECT * FROM TBL_NAME WHERE STR_COL=1;

The reason for this is that there are many different strings that may
convert to the value '1', such as ''1'', '' 1'', or ''1a''.

Comparisons that use floating-point numbers (or values that are
converted to floating-point numbers) are approximate because such
numbers are inexact.  This might lead to results that appear
inconsistent:

     mysql> SELECT '18015376320243458' = 18015376320243458;
             -> 1
     mysql> SELECT '18015376320243459' = 18015376320243459;
             -> 0

Such results can occur because the values are converted to
floating-point numbers, which have only 53 bits of precision and are
subject to rounding:

     mysql> SELECT '18015376320243459'+0.0;
             -> 1.8015376320243e+16

Furthermore, the conversion from string to floating-point and from
integer to floating-point do not necessarily occur the same way.  The
integer may be converted to floating-point by the CPU, whereas the
string is converted digit by digit in an operation that involves
floating-point multiplications.

The results shown will vary on different systems, and can be affected by
factors such as computer architecture or the compiler version or
optimization level.  One way to avoid such problems is to use 'CAST()'
so that a value is not converted implicitly to a float-point number:

     mysql> SELECT CAST('18015376320243459' AS UNSIGNED) = 18015376320243459;
             -> 1

For more information about floating-point comparisons, see *note
problems-with-float::.

The server includes 'dtoa', a conversion library that provides the basis
for improved conversion between string or *note 'DECIMAL':
fixed-point-types. values and approximate-value (*note 'FLOAT':
floating-point-types./*note 'DOUBLE': floating-point-types.) numbers:

   * Consistent conversion results across platforms, which eliminates,
     for example, Unix versus Windows conversion differences.

   * Accurate representation of values in cases where results previously
     did not provide sufficient precision, such as for values close to
     IEEE limits.

   * Conversion of numbers to string format with the best possible
     precision.  The precision of 'dtoa' is always the same or better
     than that of the standard C library functions.

Because the conversions produced by this library differ in some cases
from non-'dtoa' results, the potential exists for incompatibilities in
applications that rely on previous results.  For example, applications
that depend on a specific exact result from previous conversions might
need adjustment to accommodate additional precision.

The 'dtoa' library provides conversions with the following properties.
D represents a value with a *note 'DECIMAL': fixed-point-types. or
string representation, and F represents a floating-point number in
native binary (IEEE) format.

   * F -> D conversion is done with the best possible precision,
     returning D as the shortest string that yields F when read back in
     and rounded to the nearest value in native binary format as
     specified by IEEE.

   * D -> F conversion is done such that F is the nearest native binary
     number to the input decimal string D.

These properties imply that F -> D -> F conversions are lossless unless
F is '-inf', '+inf', or 'NaN'.  The latter values are not supported
because the SQL standard defines them as invalid values for *note
'FLOAT': floating-point-types. or *note 'DOUBLE': floating-point-types.

For D -> F -> D conversions, a sufficient condition for losslessness is
that D uses 15 or fewer digits of precision, is not a denormal value,
'-inf', '+inf', or 'NaN'.  In some cases, the conversion is lossless
even if D has more than 15 digits of precision, but this is not always
the case.

Implicit conversion of a numeric or temporal value to string produces a
value that has a character set and collation determined by the
'character_set_connection' and 'collation_connection' system variables.
(These variables commonly are set with *note 'SET NAMES': set-names.
For information about connection character sets, see *note
charset-connection::.)

This means that such a conversion results in a character (nonbinary)
string (a *note 'CHAR': char, *note 'VARCHAR': char, or *note
'LONGTEXT': blob. value), except in the case that the connection
character set is set to 'binary'.  In that case, the conversion result
is a binary string (a *note 'BINARY': binary-varbinary, *note
'VARBINARY': binary-varbinary, or *note 'LONGBLOB': blob. value).

For integer expressions, the preceding remarks about expression
_evaluation_ apply somewhat differently for expression _assignment_; for
example, in a statement such as this:

     CREATE TABLE t SELECT INTEGER_EXPR;

In this case, the table in the column resulting from the expression has
type *note 'INT': integer-types. or *note 'BIGINT': integer-types.
depending on the length of the integer expression.  If the maximum
length of the expression does not fit in an *note 'INT': integer-types,
*note 'BIGINT': integer-types. is used instead.  The length is taken
from the 'max_length' value of the *note 'SELECT': select. result set
metadata (see *note c-api-data-structures::).  This means that you can
force a *note 'BIGINT': integer-types. rather than *note 'INT':
integer-types. by use of a sufficiently long expression:

     CREATE TABLE t SELECT 000000000000000000000;


File: manual.info.tmp,  Node: non-typed-operators,  Next: control-flow-functions,  Prev: type-conversion,  Up: functions

12.3 Operators
==============

* Menu:

* operator-precedence::          Operator Precedence
* comparison-operators::         Comparison Functions and Operators
* logical-operators::            Logical Operators
* assignment-operators::         Assignment Operators

*Operators*

Name                          Description
                              
'&'                           Bitwise AND
                              
'>'                           Greater than operator
                              
'>>'                          Right shift
                              
'>='                          Greater than or equal operator
                              
'<'                           Less than operator
                              
'<>', '!='                    Not equal operator
                              
'<<'                          Left shift
                              
'<='                          Less than or equal operator
                              
'<=>'                         NULL-safe equal to operator
                              
'%', 'MOD'                    Modulo operator
                              
'*'                           Multiplication operator
                              
'+'                           Addition operator
                              
'-'                           Minus operator
                              
'-'                           Change the sign of the argument
                              
'/'                           Division operator
                              
':='                          Assign a value
                              
'='                           Assign a value (as part of a
                              *note 'SET': set-variable. statement, or
                              as part of the 'SET' clause in an
                              *note 'UPDATE': update. statement)
                              
'='                           Equal operator
                              
'^'                           Bitwise XOR
                              
'AND', '&&'                   Logical AND
                              
'BETWEEN ... AND ...'         Whether a value is within a range of
                              values
                              
'BINARY'                      Cast a string to a binary string
                              
'CASE'                        Case operator
                              
'DIV'                         Integer division
                              
'IN()'                        Whether a value is within a set of values
                              
'IS'                          Test a value against a boolean
                              
'IS NOT'                      Test a value against a boolean
                              
'IS NOT NULL'                 NOT NULL value test
                              
'IS NULL'                     NULL value test
                              
'LIKE'                        Simple pattern matching
                              
'NOT', '!'                    Negates value
                              
'NOT BETWEEN ... AND ...'     Whether a value is not within a range of
                              values
                              
'NOT IN()'                    Whether a value is not within a set of
                              values
                              
'NOT LIKE'                    Negation of simple pattern matching
                              
'NOT REGEXP'                  Negation of REGEXP
                              
'OR', '||'                    Logical OR
                              
'REGEXP'                      Whether string matches regular expression
                              
'RLIKE'                       Whether string matches regular expression
                              
'SOUNDS LIKE'                 Compare sounds
                              
'XOR'                         Logical XOR
                              
'|'                           Bitwise OR
                              
'~'                           Bitwise inversion


File: manual.info.tmp,  Node: operator-precedence,  Next: comparison-operators,  Prev: non-typed-operators,  Up: non-typed-operators

12.3.1 Operator Precedence
--------------------------

Operator precedences are shown in the following list, from highest
precedence to the lowest.  Operators that are shown together on a line
have the same precedence.

     INTERVAL
     BINARY, COLLATE
     !
     - (unary minus), ~ (unary bit inversion)
     ^
     *, /, DIV, %, MOD
     -, +
     <<, >>
     &
     |
     = (comparison), <=>, >=, >, <=, <, <>, !=, IS, LIKE, REGEXP, IN
     BETWEEN, CASE, WHEN, THEN, ELSE
     NOT
     AND, &&
     XOR
     OR, ||
     = (assignment), :=

The precedence of '=' depends on whether it is used as a comparison
operator ('=') or as an assignment operator ('=').  When used as a
comparison operator, it has the same precedence as '<=>', '>=', '>',
'<=', '<', '<>', '!=', 'IS', 'LIKE', 'REGEXP', and 'IN()'.  When used as
an assignment operator, it has the same precedence as ':='.  *note
set-variable::, and *note user-variables::, explain how MySQL determines
which interpretation of '=' should apply.

For operators that occur at the same precedence level within an
expression, evaluation proceeds left to right, with the exception that
assignments evaluate right to left.

The precedence and meaning of some operators depends on the SQL mode:

   * By default, '||' is a logical 'OR' operator.  With
     'PIPES_AS_CONCAT' enabled, '||' is string concatenation, with a
     precedence between '^' and the unary operators.

   * By default, '!' has a higher precedence than 'NOT'.  With
     'HIGH_NOT_PRECEDENCE' enabled, '!' and 'NOT' have the same
     precedence.

See *note sql-mode::.

The precedence of operators determines the order of evaluation of terms
in an expression.  To override this order and group terms explicitly,
use parentheses.  For example:

     mysql> SELECT 1+2*3;
             -> 7
     mysql> SELECT (1+2)*3;
             -> 9


File: manual.info.tmp,  Node: comparison-operators,  Next: logical-operators,  Prev: operator-precedence,  Up: non-typed-operators

12.3.2 Comparison Functions and Operators
-----------------------------------------

*Comparison Operators*

Name                          Description
                              
'>'                           Greater than operator
                              
'>='                          Greater than or equal operator
                              
'<'                           Less than operator
                              
'<>', '!='                    Not equal operator
                              
'<='                          Less than or equal operator
                              
'<=>'                         NULL-safe equal to operator
                              
'='                           Equal operator
                              
'BETWEEN ... AND ...'         Whether a value is within a range of
                              values
                              
'COALESCE()'                  Return the first non-NULL argument
                              
'GREATEST()'                  Return the largest argument
                              
'IN()'                        Whether a value is within a set of values
                              
'INTERVAL()'                  Return the index of the argument that is
                              less than the first argument
                              
'IS'                          Test a value against a boolean
                              
'IS NOT'                      Test a value against a boolean
                              
'IS NOT NULL'                 NOT NULL value test
                              
'IS NULL'                     NULL value test
                              
'ISNULL()'                    Test whether the argument is NULL
                              
'LEAST()'                     Return the smallest argument
                              
'LIKE'                        Simple pattern matching
                              
'NOT BETWEEN ... AND ...'     Whether a value is not within a range of
                              values
                              
'NOT IN()'                    Whether a value is not within a set of
                              values
                              
'NOT LIKE'                    Negation of simple pattern matching
                              
'STRCMP()'                    Compare two strings

Comparison operations result in a value of '1' ('TRUE'), '0' ('FALSE'),
or 'NULL'.  These operations work for both numbers and strings.  Strings
are automatically converted to numbers and numbers to strings as
necessary.

The following relational comparison operators can be used to compare not
only scalar operands, but row operands:

     =  >  <  >=  <=  <>  !=

The descriptions for those operators later in this section detail how
they work with row operands.  For additional examples of row comparisons
in the context of row subqueries, see *note row-subqueries::.

Some of the functions in this section return values other than '1'
('TRUE'), '0' ('FALSE'), or 'NULL'.  'LEAST()' and 'GREATEST()' are
examples of such functions; *note type-conversion::, describes the rules
for comparison operations performed by these and similar functions for
determining their return values.

To convert a value to a specific type for comparison purposes, you can
use the 'CAST()' function.  String values can be converted to a
different character set using 'CONVERT()'.  See *note cast-functions::.

By default, string comparisons are not case-sensitive and use the
current character set.  The default is 'latin1' (cp1252 West European),
which also works well for English.

   * 
     '='

     Equal:

          mysql> SELECT 1 = 0;
                  -> 0
          mysql> SELECT '0' = 0;
                  -> 1
          mysql> SELECT '0.0' = 0;
                  -> 1
          mysql> SELECT '0.01' = 0;
                  -> 0
          mysql> SELECT '.01' = 0.01;
                  -> 1

     For row comparisons, '(a, b) = (x, y)' is equivalent to:

          (a = x) AND (b = y)

   * 
     '<=>'

     'NULL'-safe equal.  This operator performs an equality comparison
     like the '=' operator, but returns '1' rather than 'NULL' if both
     operands are 'NULL', and '0' rather than 'NULL' if one operand is
     'NULL'.

     The '<=>' operator is equivalent to the standard SQL 'IS NOT
     DISTINCT FROM' operator.

          mysql> SELECT 1 <=> 1, NULL <=> NULL, 1 <=> NULL;
                  -> 1, 1, 0
          mysql> SELECT 1 = 1, NULL = NULL, 1 = NULL;
                  -> 1, NULL, NULL

     For row comparisons, '(a, b) <=> (x, y)' is equivalent to:

          (a <=> x) AND (b <=> y)

   * 
     '<>', '!='

     Not equal:

          mysql> SELECT '.01' <> '0.01';
                  -> 1
          mysql> SELECT .01 <> '0.01';
                  -> 0
          mysql> SELECT 'zapp' <> 'zappp';
                  -> 1

     For row comparisons, '(a, b) <> (x, y)' and '(a, b) != (x, y)' are
     equivalent to:

          (a <> x) OR (b <> y)

   * 
     '<='

     Less than or equal:

          mysql> SELECT 0.1 <= 2;
                  -> 1

     For row comparisons, '(a, b) <= (x, y)' is equivalent to:

          (a < x) OR ((a = x) AND (b <= y))

   * 
     '<'

     Less than:

          mysql> SELECT 2 < 2;
                  -> 0

     For row comparisons, '(a, b) < (x, y)' is equivalent to:

          (a < x) OR ((a = x) AND (b < y))

   * 
     '>='

     Greater than or equal:

          mysql> SELECT 2 >= 2;
                  -> 1

     For row comparisons, '(a, b) >= (x, y)' is equivalent to:

          (a > x) OR ((a = x) AND (b >= y))

   * 
     '>'

     Greater than:

          mysql> SELECT 2 > 2;
                  -> 0

     For row comparisons, '(a, b) > (x, y)' is equivalent to:

          (a > x) OR ((a = x) AND (b > y))

   * 
     'EXPR BETWEEN MIN AND MAX'

     If EXPR is greater than or equal to MIN and EXPR is less than or
     equal to MAX, 'BETWEEN' returns '1', otherwise it returns '0'.
     This is equivalent to the expression '(MIN <= EXPR AND EXPR <=
     MAX)' if all the arguments are of the same type.  Otherwise type
     conversion takes place according to the rules described in *note
     type-conversion::, but applied to all the three arguments.

          mysql> SELECT 2 BETWEEN 1 AND 3, 2 BETWEEN 3 and 1;
                  -> 1, 0
          mysql> SELECT 1 BETWEEN 2 AND 3;
                  -> 0
          mysql> SELECT 'b' BETWEEN 'a' AND 'c';
                  -> 1
          mysql> SELECT 2 BETWEEN 2 AND '3';
                  -> 1
          mysql> SELECT 2 BETWEEN 2 AND 'x-3';
                  -> 0

     For best results when using 'BETWEEN' with date or time values, use
     'CAST()' to explicitly convert the values to the desired data type.
     Examples: If you compare a *note 'DATETIME': datetime. to two *note
     'DATE': datetime. values, convert the *note 'DATE': datetime.
     values to *note 'DATETIME': datetime. values.  If you use a string
     constant such as ''2001-1-1'' in a comparison to a *note 'DATE':
     datetime, cast the string to a *note 'DATE': datetime.

   * 
     'EXPR NOT BETWEEN MIN AND MAX'

     This is the same as 'NOT (EXPR BETWEEN MIN AND MAX)'.

   * 
     'COALESCE(VALUE,...)'

     Returns the first non-'NULL' value in the list, or 'NULL' if there
     are no non-'NULL' values.

     The return type of 'COALESCE()' is the aggregated type of the
     argument types.

          mysql> SELECT COALESCE(NULL,1);
                  -> 1
          mysql> SELECT COALESCE(NULL,NULL,NULL);
                  -> NULL

   * 
     'GREATEST(VALUE1,VALUE2,...)'

     With two or more arguments, returns the largest (maximum-valued)
     argument.  The arguments are compared using the same rules as for
     'LEAST()'.

          mysql> SELECT GREATEST(2,0);
                  -> 2
          mysql> SELECT GREATEST(34.0,3.0,5.0,767.0);
                  -> 767.0
          mysql> SELECT GREATEST('B','A','C');
                  -> 'C'

     'GREATEST()' returns 'NULL' if any argument is 'NULL'.

   * 
     'EXPR IN (VALUE,...)'

     Returns '1' (true) if EXPR is equal to any of the values in the
     'IN()' list, else returns '0' (false).

     Type conversion takes place according to the rules described in
     *note type-conversion::, applied to all the arguments.  If no type
     conversion is needed for the values in the 'IN()' list, they are
     all constants of the same type, and EXPR can be compared to each of
     them as a value of the same type (possibly after type conversion),
     an optimization takes place.  The values the list are sorted and
     the search for EXPR is done using a binary search, which makes the
     'IN()' operation very quick.

          mysql> SELECT 2 IN (0,3,5,7);
                  -> 0
          mysql> SELECT 'wefwf' IN ('wee','wefwf','weg');
                  -> 1

     'IN()' can be used to compare row constructors:

          mysql> SELECT (3,4) IN ((1,2), (3,4));
                  -> 1
          mysql> SELECT (3,4) IN ((1,2), (3,5));
                  -> 0

     You should never mix quoted and unquoted values in an 'IN()' list
     because the comparison rules for quoted values (such as strings)
     and unquoted values (such as numbers) differ.  Mixing types may
     therefore lead to inconsistent results.  For example, do not write
     an 'IN()' expression like this:

          SELECT val1 FROM tbl1 WHERE val1 IN (1,2,'a');

     Instead, write it like this:

          SELECT val1 FROM tbl1 WHERE val1 IN ('1','2','a');

     Implicit type conversion may produce nonintuitive results:

          mysql> SELECT 'a' IN (0), 0 IN ('b');
                  -> 1, 1

     In both cases, the comparison values are converted to
     floating-point values, yielding 0.0 in each case, and a comparison
     result of 1 (true).

     The number of values in the 'IN()' list is only limited by the
     'max_allowed_packet' value.

     To comply with the SQL standard, 'IN()' returns 'NULL' not only if
     the expression on the left hand side is 'NULL', but also if no
     match is found in the list and one of the expressions in the list
     is 'NULL'.

     'IN()' syntax can also be used to write certain types of
     subqueries.  See *note any-in-some-subqueries::.

   * 
     'EXPR NOT IN (VALUE,...)'

     This is the same as 'NOT (EXPR IN (VALUE,...))'.

   * 
     'INTERVAL(N,N1,N2,N3,...)'

     Returns '0' if N < N1, '1' if N < N2 and so on or '-1' if N is
     'NULL'.  All arguments are treated as integers.  It is required
     that N1 < N2 < N3 < '...' < NN for this function to work correctly.
     This is because a binary search is used (very fast).

          mysql> SELECT INTERVAL(23, 1, 15, 17, 30, 44, 200);
                  -> 3
          mysql> SELECT INTERVAL(10, 1, 10, 100, 1000);
                  -> 2
          mysql> SELECT INTERVAL(22, 23, 30, 44, 200);
                  -> 0

   * 
     'IS BOOLEAN_VALUE'

     Tests a value against a boolean value, where BOOLEAN_VALUE can be
     'TRUE', 'FALSE', or 'UNKNOWN'.

          mysql> SELECT 1 IS TRUE, 0 IS FALSE, NULL IS UNKNOWN;
                  -> 1, 1, 1

   * 
     'IS NOT BOOLEAN_VALUE'

     Tests a value against a boolean value, where BOOLEAN_VALUE can be
     'TRUE', 'FALSE', or 'UNKNOWN'.

          mysql> SELECT 1 IS NOT UNKNOWN, 0 IS NOT UNKNOWN, NULL IS NOT UNKNOWN;
                  -> 1, 1, 0

   * 
     'IS NULL'

     Tests whether a value is 'NULL'.

          mysql> SELECT 1 IS NULL, 0 IS NULL, NULL IS NULL;
                  -> 0, 0, 1

     To work well with ODBC programs, MySQL supports the following extra
     features when using 'IS NULL':

        * If 'sql_auto_is_null' variable is set to 1, then after a
          statement that successfully inserts an automatically generated
          'AUTO_INCREMENT' value, you can find that value by issuing a
          statement of the following form:

               SELECT * FROM TBL_NAME WHERE AUTO_COL IS NULL

          If the statement returns a row, the value returned is the same
          as if you invoked the 'LAST_INSERT_ID()' function.  For
          details, including the return value after a multiple-row
          insert, see *note information-functions::.  If no
          'AUTO_INCREMENT' value was successfully inserted, the *note
          'SELECT': select. statement returns no row.

          The behavior of retrieving an 'AUTO_INCREMENT' value by using
          an 'IS NULL' comparison can be disabled by setting
          'sql_auto_is_null = 0'.  See *note server-system-variables::.

          The default value of 'sql_auto_is_null' is 0.

        * For *note 'DATE': datetime. and *note 'DATETIME': datetime.
          columns that are declared as 'NOT NULL', you can find the
          special date ''0000-00-00'' by using a statement like this:

               SELECT * FROM TBL_NAME WHERE DATE_COLUMN IS NULL

          This is needed to get some ODBC applications to work because
          ODBC does not support a ''0000-00-00'' date value.

          See Obtaining Auto-Increment Values
          (https://dev.mysql.com/doc/connector-odbc/en/connector-odbc-usagenotes-functionality-last-insert-id.html),
          and the description for the 'FLAG_AUTO_IS_NULL' option at
          Connector/ODBC Connection Parameters
          (https://dev.mysql.com/doc/connector-odbc/en/connector-odbc-configuration-connection-parameters.html).

   * 
     'IS NOT NULL'

     Tests whether a value is not 'NULL'.

          mysql> SELECT 1 IS NOT NULL, 0 IS NOT NULL, NULL IS NOT NULL;
                  -> 1, 1, 0

   * 
     'ISNULL(EXPR)'

     If EXPR is 'NULL', 'ISNULL()' returns '1', otherwise it returns
     '0'.

          mysql> SELECT ISNULL(1+1);
                  -> 0
          mysql> SELECT ISNULL(1/0);
                  -> 1

     'ISNULL()' can be used instead of '=' to test whether a value is
     'NULL'.  (Comparing a value to 'NULL' using '=' always yields
     'NULL'.)

     The 'ISNULL()' function shares some special behaviors with the 'IS
     NULL' comparison operator.  See the description of 'IS NULL'.

   * 
     'LEAST(VALUE1,VALUE2,...)'

     With two or more arguments, returns the smallest (minimum-valued)
     argument.  The arguments are compared using the following rules:

        * If any argument is 'NULL', the result is 'NULL'.  No
          comparison is needed.

        * If all arguments are integer-valued, they are compared as
          integers.

        * If at least one argument is double precision, they are
          compared as double-precision values.  Otherwise, if at least
          one argument is a *note 'DECIMAL': fixed-point-types. value,
          they are compared as *note 'DECIMAL': fixed-point-types.
          values.

        * If the arguments comprise a mix of numbers and strings, they
          are compared as numbers.

        * If any argument is a nonbinary (character) string, the
          arguments are compared as nonbinary strings.

        * In all other cases, the arguments are compared as binary
          strings.

     The return type of 'LEAST()' is the aggregated type of the
     comparison argument types.

          mysql> SELECT LEAST(2,0);
                  -> 0
          mysql> SELECT LEAST(34.0,3.0,5.0,767.0);
                  -> 3.0
          mysql> SELECT LEAST('B','A','C');
                  -> 'A'


File: manual.info.tmp,  Node: logical-operators,  Next: assignment-operators,  Prev: comparison-operators,  Up: non-typed-operators

12.3.3 Logical Operators
------------------------

*Logical Operators*

Name                          Description
                              
'AND', '&&'                   Logical AND
                              
'NOT', '!'                    Negates value
                              
'OR', '||'                    Logical OR
                              
'XOR'                         Logical XOR

In SQL, all logical operators evaluate to 'TRUE', 'FALSE', or 'NULL'
('UNKNOWN').  In MySQL, these are implemented as 1 ('TRUE'), 0
('FALSE'), and 'NULL'.  Most of this is common to different SQL database
servers, although some servers may return any nonzero value for 'TRUE'.

MySQL evaluates any nonzero, non-'NULL' value to 'TRUE'.  For example,
the following statements all assess to 'TRUE':

     mysql> SELECT 10 IS TRUE;
     -> 1
     mysql> SELECT -10 IS TRUE;
     -> 1
     mysql> SELECT 'string' IS NOT NULL;
     -> 1

   * 
     'NOT', '!'

     Logical NOT. Evaluates to '1' if the operand is '0', to '0' if the
     operand is nonzero, and 'NOT NULL' returns 'NULL'.

          mysql> SELECT NOT 10;
                  -> 0
          mysql> SELECT NOT 0;
                  -> 1
          mysql> SELECT NOT NULL;
                  -> NULL
          mysql> SELECT ! (1+1);
                  -> 0
          mysql> SELECT ! 1+1;
                  -> 1

     The last example produces '1' because the expression evaluates the
     same way as '(!1)+1'.

   * 
     'AND', '&&'

     Logical AND. Evaluates to '1' if all operands are nonzero and not
     'NULL', to '0' if one or more operands are '0', otherwise 'NULL' is
     returned.

          mysql> SELECT 1 AND 1;
                  -> 1
          mysql> SELECT 1 AND 0;
                  -> 0
          mysql> SELECT 1 AND NULL;
                  -> NULL
          mysql> SELECT 0 AND NULL;
                  -> 0
          mysql> SELECT NULL AND 0;
                  -> 0

   * 
     'OR', '||'

     Logical OR. When both operands are non-'NULL', the result is '1' if
     any operand is nonzero, and '0' otherwise.  With a 'NULL' operand,
     the result is '1' if the other operand is nonzero, and 'NULL'
     otherwise.  If both operands are 'NULL', the result is 'NULL'.

          mysql> SELECT 1 OR 1;
                  -> 1
          mysql> SELECT 1 OR 0;
                  -> 1
          mysql> SELECT 0 OR 0;
                  -> 0
          mysql> SELECT 0 OR NULL;
                  -> NULL
          mysql> SELECT 1 OR NULL;
                  -> 1

     *Note*:

     If the 'PIPES_AS_CONCAT' SQL mode is enabled, '||' signifies the
     SQL-standard string concatenation operator (like 'CONCAT()').

   * 
     'XOR'

     Logical XOR. Returns 'NULL' if either operand is 'NULL'.  For
     non-'NULL' operands, evaluates to '1' if an odd number of operands
     is nonzero, otherwise '0' is returned.

          mysql> SELECT 1 XOR 1;
                  -> 0
          mysql> SELECT 1 XOR 0;
                  -> 1
          mysql> SELECT 1 XOR NULL;
                  -> NULL
          mysql> SELECT 1 XOR 1 XOR 1;
                  -> 1

     'a XOR b' is mathematically equal to '(a AND (NOT b)) OR ((NOT a)
     and b)'.


File: manual.info.tmp,  Node: assignment-operators,  Prev: logical-operators,  Up: non-typed-operators

12.3.4 Assignment Operators
---------------------------

*Assignment Operators*

Name                          Description
                              
':='                          Assign a value
                              
'='                           Assign a value (as part of a
                              *note 'SET': set-variable. statement, or
                              as part of the 'SET' clause in an
                              *note 'UPDATE': update. statement)

   * 
     ':='

     Assignment operator.  Causes the user variable on the left hand
     side of the operator to take on the value to its right.  The value
     on the right hand side may be a literal value, another variable
     storing a value, or any legal expression that yields a scalar
     value, including the result of a query (provided that this value is
     a scalar value).  You can perform multiple assignments in the same
     *note 'SET': set-variable. statement.  You can perform multiple
     assignments in the same statement.

     Unlike '=', the ':=' operator is never interpreted as a comparison
     operator.  This means you can use ':=' in any valid SQL statement
     (not just in *note 'SET': set-variable. statements) to assign a
     value to a variable.

          mysql> SELECT @var1, @var2;
                  -> NULL, NULL
          mysql> SELECT @var1 := 1, @var2;
                  -> 1, NULL
          mysql> SELECT @var1, @var2;
                  -> 1, NULL
          mysql> SELECT @var1, @var2 := @var1;
                  -> 1, 1
          mysql> SELECT @var1, @var2;
                  -> 1, 1

          mysql> SELECT @var1:=COUNT(*) FROM t1;
                  -> 4
          mysql> SELECT @var1;
                  -> 4

     You can make value assignments using ':=' in other statements
     besides *note 'SELECT': select, such as *note 'UPDATE': update, as
     shown here:

          mysql> SELECT @var1;
                  -> 4
          mysql> SELECT * FROM t1;
                  -> 1, 3, 5, 7

          mysql> UPDATE t1 SET c1 = 2 WHERE c1 = @var1:= 1;
          Query OK, 1 row affected (0.00 sec)
          Rows matched: 1  Changed: 1  Warnings: 0

          mysql> SELECT @var1;
                  -> 1
          mysql> SELECT * FROM t1;
                  -> 2, 3, 5, 7

     While it is also possible both to set and to read the value of the
     same variable in a single SQL statement using the ':=' operator,
     this is not recommended.  *note user-variables::, explains why you
     should avoid doing this.

   * 
     '='

     This operator is used to perform value assignments in two cases,
     described in the next two paragraphs.

     Within a *note 'SET': set-variable. statement, '=' is treated as an
     assignment operator that causes the user variable on the left hand
     side of the operator to take on the value to its right.  (In other
     words, when used in a *note 'SET': set-variable. statement, '=' is
     treated identically to ':='.)  The value on the right hand side may
     be a literal value, another variable storing a value, or any legal
     expression that yields a scalar value, including the result of a
     query (provided that this value is a scalar value).  You can
     perform multiple assignments in the same *note 'SET': set-variable.
     statement.

     In the 'SET' clause of an *note 'UPDATE': update. statement, '='
     also acts as an assignment operator; in this case, however, it
     causes the column named on the left hand side of the operator to
     assume the value given to the right, provided any 'WHERE'
     conditions that are part of the *note 'UPDATE': update. are met.
     You can make multiple assignments in the same 'SET' clause of an
     *note 'UPDATE': update. statement.

     In any other context, '=' is treated as a comparison operator.

          mysql> SELECT @var1, @var2;
                  -> NULL, NULL
          mysql> SELECT @var1 := 1, @var2;
                  -> 1, NULL
          mysql> SELECT @var1, @var2;
                  -> 1, NULL
          mysql> SELECT @var1, @var2 := @var1;
                  -> 1, 1
          mysql> SELECT @var1, @var2;
                  -> 1, 1

     For more information, see *note set-variable::, *note update::, and
     *note subqueries::.


File: manual.info.tmp,  Node: control-flow-functions,  Next: numeric-functions,  Prev: non-typed-operators,  Up: functions

12.4 Control Flow Functions
===========================

*Flow Control Operators*

Name                          Description
                              
'CASE'                        Case operator
                              
'IF()'                        If/else construct
                              
'IFNULL()'                    Null if/else construct
                              
'NULLIF()'                    Return NULL if expr1 = expr2

   * 
     'CASE VALUE WHEN [COMPARE_VALUE] THEN RESULT [WHEN [COMPARE_VALUE]
     THEN RESULT ...] [ELSE RESULT] END'

     'CASE WHEN [CONDITION] THEN RESULT [WHEN [CONDITION] THEN RESULT
     ...] [ELSE RESULT] END'

     The first 'CASE' syntax returns the RESULT for the first
     'VALUE=COMPARE_VALUE' comparison that is true.  The second syntax
     returns the result for the first condition that is true.  If no
     comparison or condition is true, the result after 'ELSE' is
     returned, or 'NULL' if there is no 'ELSE' part.

     *Note*:

     The syntax of the 'CASE' _expr_ described here differs slightly
     from that of the SQL *note 'CASE': case. _statement_ described in
     *note case::, for use inside stored programs.  The *note 'CASE':
     case. statement cannot have an 'ELSE NULL' clause, and it is
     terminated with 'END CASE' instead of 'END'.

     The return type of a 'CASE' expression result is the aggregated
     type of all result values.

          mysql> SELECT CASE 1 WHEN 1 THEN 'one'
              ->     WHEN 2 THEN 'two' ELSE 'more' END;
                  -> 'one'
          mysql> SELECT CASE WHEN 1>0 THEN 'true' ELSE 'false' END;
                  -> 'true'
          mysql> SELECT CASE BINARY 'B'
              ->     WHEN 'a' THEN 1 WHEN 'b' THEN 2 END;
                  -> NULL

   * 
     'IF(EXPR1,EXPR2,EXPR3)'

     If EXPR1 is 'TRUE' ('EXPR1 <> 0' and 'EXPR1 <> NULL'), 'IF()'
     returns EXPR2.  Otherwise, it returns EXPR3.

     *Note*:

     There is also an *note 'IF': if. _statement_, which differs from
     the 'IF()' _function_ described here.  See *note if::.

     If only one of EXPR2 or EXPR3 is explicitly 'NULL', the result type
     of the 'IF()' function is the type of the non-'NULL' expression.

     The default return type of 'IF()' (which may matter when it is
     stored into a temporary table) is calculated as follows:

        * If EXPR2 or EXPR3 produce a string, the result is a string.

          If EXPR2 and EXPR3 are both strings, the result is
          case-sensitive if either string is case-sensitive.

        * If EXPR2 or EXPR3 produce a floating-point value, the result
          is a floating-point value.

        * If EXPR2 or EXPR3 produce an integer, the result is an
          integer.

          mysql> SELECT IF(1>2,2,3);
                  -> 3
          mysql> SELECT IF(1<2,'yes','no');
                  -> 'yes'
          mysql> SELECT IF(STRCMP('test','test1'),'no','yes');
                  -> 'no'

   * 
     'IFNULL(EXPR1,EXPR2)'

     If EXPR1 is not 'NULL', 'IFNULL()' returns EXPR1; otherwise it
     returns EXPR2.

          mysql> SELECT IFNULL(1,0);
                  -> 1
          mysql> SELECT IFNULL(NULL,10);
                  -> 10
          mysql> SELECT IFNULL(1/0,10);
                  -> 10
          mysql> SELECT IFNULL(1/0,'yes');
                  -> 'yes'

     The default return type of 'IFNULL(EXPR1,EXPR2)' is the more
     'general' of the two expressions, in the order 'STRING', 'REAL', or
     'INTEGER'.  Consider the case of a table based on expressions or
     where MySQL must internally store a value returned by 'IFNULL()' in
     a temporary table:


          mysql> CREATE TABLE tmp SELECT IFNULL(1,'test') AS test;
          mysql> DESCRIBE tmp;
          +-------+--------------+------+-----+---------+-------+
          | Field | Type         | Null | Key | Default | Extra |
          +-------+--------------+------+-----+---------+-------+
          | test  | varbinary(4) | NO   |     |         |       |
          +-------+--------------+------+-----+---------+-------+

     In this example, the type of the 'test' column is *note
     'VARBINARY(4)': binary-varbinary. (a string type).

   * 
     'NULLIF(EXPR1,EXPR2)'

     Returns 'NULL' if 'EXPR1 = EXPR2' is true, otherwise returns EXPR1.
     This is the same as 'CASE WHEN EXPR1 = EXPR2 THEN NULL ELSE EXPR1
     END'.

     The return value has the same type as the first argument.

          mysql> SELECT NULLIF(1,1);
                  -> NULL
          mysql> SELECT NULLIF(1,2);
                  -> 1

     *Note*:

     MySQL evaluates EXPR1 twice if the arguments are not equal.


File: manual.info.tmp,  Node: numeric-functions,  Next: date-and-time-functions,  Prev: control-flow-functions,  Up: functions

12.5 Numeric Functions and Operators
====================================

* Menu:

* arithmetic-functions::         Arithmetic Operators
* mathematical-functions::       Mathematical Functions

*Numeric Functions and Operators*

Name                          Description
                              
'%', 'MOD'                    Modulo operator
                              
'*'                           Multiplication operator
                              
'+'                           Addition operator
                              
'-'                           Minus operator
                              
'-'                           Change the sign of the argument
                              
'/'                           Division operator
                              
'ABS()'                       Return the absolute value
                              
'ACOS()'                      Return the arc cosine
                              
'ASIN()'                      Return the arc sine
                              
'ATAN()'                      Return the arc tangent
                              
'ATAN2()', 'ATAN()'           Return the arc tangent of the two
                              arguments
                              
'CEIL()'                      Return the smallest integer value not
                              less than the argument
                              
'CEILING()'                   Return the smallest integer value not
                              less than the argument
                              
'CONV()'                      Convert numbers between different number
                              bases
                              
'COS()'                       Return the cosine
                              
'COT()'                       Return the cotangent
                              
'CRC32()'                     Compute a cyclic redundancy check value
                              
'DEGREES()'                   Convert radians to degrees
                              
'DIV'                         Integer division
                              
'EXP()'                       Raise to the power of
                              
'FLOOR()'                     Return the largest integer value not
                              greater than the argument
                              
'LN()'                        Return the natural logarithm of the
                              argument
                              
'LOG()'                       Return the natural logarithm of the first
                              argument
                              
'LOG10()'                     Return the base-10 logarithm of the
                              argument
                              
'LOG2()'                      Return the base-2 logarithm of the
                              argument
                              
'MOD()'                       Return the remainder
                              
'PI()'                        Return the value of pi
                              
'POW()'                       Return the argument raised to the
                              specified power
                              
'POWER()'                     Return the argument raised to the
                              specified power
                              
'RADIANS()'                   Return argument converted to radians
                              
'RAND()'                      Return a random floating-point value
                              
'ROUND()'                     Round the argument
                              
'SIGN()'                      Return the sign of the argument
                              
'SIN()'                       Return the sine of the argument
                              
'SQRT()'                      Return the square root of the argument
                              
'TAN()'                       Return the tangent of the argument
                              
'TRUNCATE()'                  Truncate to specified number of decimal
                              places


File: manual.info.tmp,  Node: arithmetic-functions,  Next: mathematical-functions,  Prev: numeric-functions,  Up: numeric-functions

12.5.1 Arithmetic Operators
---------------------------

*Arithmetic Operators*

Name                          Description
                              
'%', 'MOD'                    Modulo operator
                              
'*'                           Multiplication operator
                              
'+'                           Addition operator
                              
'-'                           Minus operator
                              
'-'                           Change the sign of the argument
                              
'/'                           Division operator
                              
'DIV'                         Integer division

The usual arithmetic operators are available.  The result is determined
according to the following rules:

   * In the case of '-', '+', and '*', the result is calculated with
     *note 'BIGINT': integer-types. (64-bit) precision if both operands
     are integers.

   * If both operands are integers and any of them are unsigned, the
     result is an unsigned integer.  For subtraction, if the
     'NO_UNSIGNED_SUBTRACTION' SQL mode is enabled, the result is signed
     even if any operand is unsigned.

   * If any of the operands of a '+', '-', '/', '*', '%' is a real or
     string value, the precision of the result is the precision of the
     operand with the maximum precision.

   * In division performed with '/', the scale of the result when using
     two exact-value operands is the scale of the first operand plus the
     value of the 'div_precision_increment' system variable (which is 4
     by default).  For example, the result of the expression '5.05 /
     0.014' has a scale of six decimal places ('360.714286').

These rules are applied for each operation, such that nested
calculations imply the precision of each component.  Hence, '(14620 /
9432456) / (24250 / 9432456)', resolves first to '(0.0014) / (0.0026)',
with the final result having 8 decimal places ('0.60288653').

Because of these rules and the way they are applied, care should be
taken to ensure that components and subcomponents of a calculation use
the appropriate level of precision.  See *note cast-functions::.

For information about handling of overflow in numeric expression
evaluation, see *note out-of-range-and-overflow::.

Arithmetic operators apply to numbers.  For other types of values,
alternative operations may be available.  For example, to add date
values, use 'DATE_ADD()'; see *note date-and-time-functions::.

   * 
     '+'

     Addition:

          mysql> SELECT 3+5;
                  -> 8

   * 
     '-'

     Subtraction:

          mysql> SELECT 3-5;
                  -> -2

   * 
     '-'

     Unary minus.  This operator changes the sign of the operand.

          mysql> SELECT - 2;
                  -> -2

     *Note*:

     If this operator is used with a *note 'BIGINT': integer-types, the
     return value is also a *note 'BIGINT': integer-types.  This means
     that you should avoid using '-' on integers that may have the value
     of −2^63.

   * 
     '*'

     Multiplication:

          mysql> SELECT 3*5;
                  -> 15
          mysql> SELECT 18014398509481984*18014398509481984.0;
                  -> 324518553658426726783156020576256.0
          mysql> SELECT 18014398509481984*18014398509481984;
                  -> out-of-range error

     The last expression produces an error because the result of the
     integer multiplication exceeds the 64-bit range of *note 'BIGINT':
     integer-types. calculations.  (See *note numeric-types::.)

   * 
     '/'

     Division:

          mysql> SELECT 3/5;
                  -> 0.60

     Division by zero produces a 'NULL' result:

          mysql> SELECT 102/(1-1);
                  -> NULL

     A division is calculated with *note 'BIGINT': integer-types.
     arithmetic only if performed in a context where its result is
     converted to an integer.

   * 
     'DIV'

     Integer division.  Discards from the division result any fractional
     part to the right of the decimal point.

     If either operand has a noninteger type, the operands are converted
     to *note 'DECIMAL': fixed-point-types. and divided using *note
     'DECIMAL': fixed-point-types. arithmetic before converting the
     result to *note 'BIGINT': integer-types.  If the result exceeds
     'BIGINT' range, an error occurs.

          mysql> SELECT 5 DIV 2, -5 DIV 2, 5 DIV -2, -5 DIV -2;
                  -> 2, -2, -2, 2

   * 
     'N % M', 'N MOD M'

     Modulo operation.  Returns the remainder of N divided by M.  For
     more information, see the description for the 'MOD()' function in
     *note mathematical-functions::.


File: manual.info.tmp,  Node: mathematical-functions,  Prev: arithmetic-functions,  Up: numeric-functions

12.5.2 Mathematical Functions
-----------------------------

*Mathematical Functions*

Name                          Description
                              
'ABS()'                       Return the absolute value
                              
'ACOS()'                      Return the arc cosine
                              
'ASIN()'                      Return the arc sine
                              
'ATAN()'                      Return the arc tangent
                              
'ATAN2()', 'ATAN()'           Return the arc tangent of the two
                              arguments
                              
'CEIL()'                      Return the smallest integer value not
                              less than the argument
                              
'CEILING()'                   Return the smallest integer value not
                              less than the argument
                              
'CONV()'                      Convert numbers between different number
                              bases
                              
'COS()'                       Return the cosine
                              
'COT()'                       Return the cotangent
                              
'CRC32()'                     Compute a cyclic redundancy check value
                              
'DEGREES()'                   Convert radians to degrees
                              
'EXP()'                       Raise to the power of
                              
'FLOOR()'                     Return the largest integer value not
                              greater than the argument
                              
'LN()'                        Return the natural logarithm of the
                              argument
                              
'LOG()'                       Return the natural logarithm of the first
                              argument
                              
'LOG10()'                     Return the base-10 logarithm of the
                              argument
                              
'LOG2()'                      Return the base-2 logarithm of the
                              argument
                              
'MOD()'                       Return the remainder
                              
'PI()'                        Return the value of pi
                              
'POW()'                       Return the argument raised to the
                              specified power
                              
'POWER()'                     Return the argument raised to the
                              specified power
                              
'RADIANS()'                   Return argument converted to radians
                              
'RAND()'                      Return a random floating-point value
                              
'ROUND()'                     Round the argument
                              
'SIGN()'                      Return the sign of the argument
                              
'SIN()'                       Return the sine of the argument
                              
'SQRT()'                      Return the square root of the argument
                              
'TAN()'                       Return the tangent of the argument
                              
'TRUNCATE()'                  Truncate to specified number of decimal
                              places

All mathematical functions return 'NULL' in the event of an error.

   * 
     'ABS(X)'

     Returns the absolute value of X.

          mysql> SELECT ABS(2);
                  -> 2
          mysql> SELECT ABS(-32);
                  -> 32

     This function is safe to use with *note 'BIGINT': integer-types.
     values.

   * 
     'ACOS(X)'

     Returns the arc cosine of X, that is, the value whose cosine is X.
     Returns 'NULL' if X is not in the range '-1' to '1'.

          mysql> SELECT ACOS(1);
                  -> 0
          mysql> SELECT ACOS(1.0001);
                  -> NULL
          mysql> SELECT ACOS(0);
                  -> 1.5707963267949

   * 
     'ASIN(X)'

     Returns the arc sine of X, that is, the value whose sine is X.
     Returns 'NULL' if X is not in the range '-1' to '1'.

          mysql> SELECT ASIN(0.2);
                  -> 0.20135792079033
          mysql> SELECT ASIN('foo');

          +-------------+
          | ASIN('foo') |
          +-------------+
          |           0 |
          +-------------+
          1 row in set, 1 warning (0.00 sec)

          mysql> SHOW WARNINGS;
          +---------+------+-----------------------------------------+
          | Level   | Code | Message                                 |
          +---------+------+-----------------------------------------+
          | Warning | 1292 | Truncated incorrect DOUBLE value: 'foo' |
          +---------+------+-----------------------------------------+

   * 
     'ATAN(X)'

     Returns the arc tangent of X, that is, the value whose tangent is
     X.

          mysql> SELECT ATAN(2);
                  -> 1.1071487177941
          mysql> SELECT ATAN(-2);
                  -> -1.1071487177941

   * 
     'ATAN(Y,X)', 'ATAN2(Y,X)'

     Returns the arc tangent of the two variables X and Y.  It is
     similar to calculating the arc tangent of 'Y / X', except that the
     signs of both arguments are used to determine the quadrant of the
     result.

          mysql> SELECT ATAN(-2,2);
                  -> -0.78539816339745
          mysql> SELECT ATAN2(PI(),0);
                  -> 1.5707963267949

   * 
     'CEIL(X)'

     'CEIL()' is a synonym for 'CEILING()'.

   * 
     'CEILING(X)'

     Returns the smallest integer value not less than X.

          mysql> SELECT CEILING(1.23);
                  -> 2
          mysql> SELECT CEILING(-1.23);
                  -> -1

     For exact-value numeric arguments, the return value has an
     exact-value numeric type.  For string or floating-point arguments,
     the return value has a floating-point type.

   * 
     'CONV(N,FROM_BASE,TO_BASE)'

     Converts numbers between different number bases.  Returns a string
     representation of the number N, converted from base FROM_BASE to
     base TO_BASE.  Returns 'NULL' if any argument is 'NULL'.  The
     argument N is interpreted as an integer, but may be specified as an
     integer or a string.  The minimum base is '2' and the maximum base
     is '36'.  If FROM_BASE is a negative number, N is regarded as a
     signed number.  Otherwise, N is treated as unsigned.  'CONV()'
     works with 64-bit precision.

          mysql> SELECT CONV('a',16,2);
                  -> '1010'
          mysql> SELECT CONV('6E',18,8);
                  -> '172'
          mysql> SELECT CONV(-17,10,-18);
                  -> '-H'
          mysql> SELECT CONV(10+'10'+'10'+X'0a',10,10);
                  -> '40'

   * 
     'COS(X)'

     Returns the cosine of X, where X is given in radians.

          mysql> SELECT COS(PI());
                  -> -1

   * 
     'COT(X)'

     Returns the cotangent of X.

          mysql> SELECT COT(12);
                  -> -1.5726734063977
          mysql> SELECT COT(0);
                  -> out-of-range error

   * 
     'CRC32(EXPR)'

     Computes a cyclic redundancy check value and returns a 32-bit
     unsigned value.  The result is 'NULL' if the argument is 'NULL'.
     The argument is expected to be a string and (if possible) is
     treated as one if it is not.

          mysql> SELECT CRC32('MySQL');
                  -> 3259397556
          mysql> SELECT CRC32('mysql');
                  -> 2501908538

   * 
     'DEGREES(X)'

     Returns the argument X, converted from radians to degrees.

          mysql> SELECT DEGREES(PI());
                  -> 180
          mysql> SELECT DEGREES(PI() / 2);
                  -> 90

   * 
     'EXP(X)'

     Returns the value of _e_ (the base of natural logarithms) raised to
     the power of X.  The inverse of this function is 'LOG()' (using a
     single argument only) or 'LN()'.

          mysql> SELECT EXP(2);
                  -> 7.3890560989307
          mysql> SELECT EXP(-2);
                  -> 0.13533528323661
          mysql> SELECT EXP(0);
                  -> 1

   * 
     'FLOOR(X)'

     Returns the largest integer value not greater than X.

          mysql> SELECT FLOOR(1.23), FLOOR(-1.23);
                  -> 1, -2

     For exact-value numeric arguments, the return value has an
     exact-value numeric type.  For string or floating-point arguments,
     the return value has a floating-point type.

   * 'FORMAT(X,D)'

     Formats the number X to a format like ''#,###,###.##'', rounded to
     D decimal places, and returns the result as a string.  For details,
     see *note string-functions::.

   * 
     'HEX(N_or_S)'

     This function can be used to obtain a hexadecimal representation of
     a decimal number or a string; the manner in which it does so varies
     according to the argument's type.  See this function's description
     in *note string-functions::, for details.

   * 
     'LN(X)'

     Returns the natural logarithm of X; that is, the base-_e_ logarithm
     of X.  If X is less than or equal to 0, then 'NULL' is returned.

          mysql> SELECT LN(2);
                  -> 0.69314718055995
          mysql> SELECT LN(-2);
                  -> NULL

     This function is synonymous with 'LOG(X)'.  The inverse of this
     function is the 'EXP()' function.

   * 
     'LOG(X)', 'LOG(B,X)'

     If called with one parameter, this function returns the natural
     logarithm of X.  If X is less than or equal to 0, then 'NULL' is
     returned.

     The inverse of this function (when called with a single argument)
     is the 'EXP()' function.

          mysql> SELECT LOG(2);
                  -> 0.69314718055995
          mysql> SELECT LOG(-2);
                  -> NULL

     If called with two parameters, this function returns the logarithm
     of X to the base B.  If X is less than or equal to 0, or if B is
     less than or equal to 1, then 'NULL' is returned.

          mysql> SELECT LOG(2,65536);
                  -> 16
          mysql> SELECT LOG(10,100);
                  -> 2
          mysql> SELECT LOG(1,100);
                  -> NULL

     'LOG(B,X)' is equivalent to 'LOG(X) / LOG(B)'.

   * 
     'LOG2(X)'

     Returns the base-2 logarithm of 'X'.

          mysql> SELECT LOG2(65536);
                  -> 16
          mysql> SELECT LOG2(-100);
                  -> NULL

     'LOG2()' is useful for finding out how many bits a number requires
     for storage.  This function is equivalent to the expression 'LOG(X)
     / LOG(2)'.

   * 
     'LOG10(X)'

     Returns the base-10 logarithm of X.

          mysql> SELECT LOG10(2);
                  -> 0.30102999566398
          mysql> SELECT LOG10(100);
                  -> 2
          mysql> SELECT LOG10(-100);
                  -> NULL

     'LOG10(X)' is equivalent to 'LOG(10,X)'.

   * 
     'MOD(N,M)', 'N % M', 'N MOD M'

     Modulo operation.  Returns the remainder of N divided by M.

          mysql> SELECT MOD(234, 10);
                  -> 4
          mysql> SELECT 253 % 7;
                  -> 1
          mysql> SELECT MOD(29,9);
                  -> 2
          mysql> SELECT 29 MOD 9;
                  -> 2

     This function is safe to use with *note 'BIGINT': integer-types.
     values.

     'MOD()' also works on values that have a fractional part and
     returns the exact remainder after division:

          mysql> SELECT MOD(34.5,3);
                  -> 1.5

     'MOD(N,0)' returns 'NULL'.

   * 
     'PI()'

     Returns the value of π (pi).  The default number of decimal places
     displayed is seven, but MySQL uses the full double-precision value
     internally.

          mysql> SELECT PI();
                  -> 3.141593
          mysql> SELECT PI()+0.000000000000000000;
                  -> 3.141592653589793116

   * 
     'POW(X,Y)'

     Returns the value of X raised to the power of Y.

          mysql> SELECT POW(2,2);
                  -> 4
          mysql> SELECT POW(2,-2);
                  -> 0.25

   * 
     'POWER(X,Y)'

     This is a synonym for 'POW()'.

   * 
     'RADIANS(X)'

     Returns the argument X, converted from degrees to radians.  (Note
     that π radians equals 180 degrees.)

          mysql> SELECT RADIANS(90);
                  -> 1.5707963267949

   * 
     'RAND([N])'

     Returns a random floating-point value V in the range '0' <= V <
     '1.0'.  To obtain a random integer R in the range I <= R < J, use
     the expression 'FLOOR(I + RAND() * (J' − 'I))'.  For example, to
     obtain a random integer in the range the range '7' <= R < '12', use
     the following statement:

          SELECT FLOOR(7 + (RAND() * 5));

     If an integer argument N is specified, it is used as the seed
     value:

        * With a constant initializer argument, the seed is initialized
          once when the statement is prepared, prior to execution.

        * With a nonconstant initializer argument (such as a column
          name), the seed is initialized with the value for each
          invocation of 'RAND()'.

     One implication of this behavior is that for equal argument values,
     'RAND(N)' returns the same value each time, and thus produces a
     repeatable sequence of column values.  In the following example,
     the sequence of values produced by 'RAND(3)' is the same both
     places it occurs.


          mysql> CREATE TABLE t (i INT);
          Query OK, 0 rows affected (0.42 sec)

          mysql> INSERT INTO t VALUES(1),(2),(3);
          Query OK, 3 rows affected (0.00 sec)
          Records: 3  Duplicates: 0  Warnings: 0

          mysql> SELECT i, RAND() FROM t;
          +------+------------------+
          | i    | RAND()           |
          +------+------------------+
          |    1 | 0.61914388706828 |
          |    2 | 0.93845168309142 |
          |    3 | 0.83482678498591 |
          +------+------------------+
          3 rows in set (0.00 sec)

          mysql> SELECT i, RAND(3) FROM t;
          +------+------------------+
          | i    | RAND(3)          |
          +------+------------------+
          |    1 | 0.90576975597606 |
          |    2 | 0.37307905813035 |
          |    3 | 0.14808605345719 |
          +------+------------------+
          3 rows in set (0.00 sec)

          mysql> SELECT i, RAND() FROM t;
          +------+------------------+
          | i    | RAND()           |
          +------+------------------+
          |    1 | 0.35877890638893 |
          |    2 | 0.28941420772058 |
          |    3 | 0.37073435016976 |
          +------+------------------+
          3 rows in set (0.00 sec)

          mysql> SELECT i, RAND(3) FROM t;
          +------+------------------+
          | i    | RAND(3)          |
          +------+------------------+
          |    1 | 0.90576975597606 |
          |    2 | 0.37307905813035 |
          |    3 | 0.14808605345719 |
          +------+------------------+
          3 rows in set (0.01 sec)

     'RAND()' in a 'WHERE' clause is evaluated for every row (when
     selecting from one table) or combination of rows (when selecting
     from a multiple-table join).  Thus, for optimizer purposes,
     'RAND()' is not a constant value and cannot be used for index
     optimizations.  For more information, see *note
     function-optimization::.

     Use of a column with 'RAND()' values in an 'ORDER BY' or 'GROUP BY'
     clause may yield unexpected results because for either clause a
     'RAND()' expression can be evaluated multiple times for the same
     row, each time returning a different result.  If the goal is to
     retrieve rows in random order, you can use a statement like this:

          SELECT * FROM TBL_NAME ORDER BY RAND();

     To select a random sample from a set of rows, combine 'ORDER BY
     RAND()' with 'LIMIT':

          SELECT * FROM table1, table2 WHERE a=b AND c<d ORDER BY RAND() LIMIT 1000;

     'RAND()' is not meant to be a perfect random generator.  It is a
     fast way to generate random numbers on demand that is portable
     between platforms for the same MySQL version.

     This function is unsafe for statement-based replication.  A warning
     is logged if you use this function when 'binlog_format' is set to
     'STATEMENT'.

   * 
     'ROUND(X)', 'ROUND(X,D)'

     Rounds the argument X to D decimal places.  The rounding algorithm
     depends on the data type of X.  D defaults to 0 if not specified.
     D can be negative to cause D digits left of the decimal point of
     the value X to become zero.

          mysql> SELECT ROUND(-1.23);
                  -> -1
          mysql> SELECT ROUND(-1.58);
                  -> -2
          mysql> SELECT ROUND(1.58);
                  -> 2
          mysql> SELECT ROUND(1.298, 1);
                  -> 1.3
          mysql> SELECT ROUND(1.298, 0);
                  -> 1
          mysql> SELECT ROUND(23.298, -1);
                  -> 20

     The return value has the same type as the first argument (assuming
     that it is integer, double, or decimal).  This means that for an
     integer argument, the result is an integer (no decimal places):

          mysql> SELECT ROUND(150.000,2), ROUND(150,2);
          +------------------+--------------+
          | ROUND(150.000,2) | ROUND(150,2) |
          +------------------+--------------+
          |           150.00 |          150 |
          +------------------+--------------+

     'ROUND()' uses the following rules depending on the type of the
     first argument:

        * For exact-value numbers, 'ROUND()' uses the 'round half away
          from zero' or 'round toward nearest' rule: A value with a
          fractional part of .5 or greater is rounded up to the next
          integer if positive or down to the next integer if negative.
          (In other words, it is rounded away from zero.)  A value with
          a fractional part less than .5 is rounded down to the next
          integer if positive or up to the next integer if negative.

        * For approximate-value numbers, the result depends on the C
          library.  On many systems, this means that 'ROUND()' uses the
          'round to nearest even' rule: A value with a fractional part
          exactly half way between two integers is rounded to the
          nearest even integer.

     The following example shows how rounding differs for exact and
     approximate values:

          mysql> SELECT ROUND(2.5), ROUND(25E-1);
          +------------+--------------+
          | ROUND(2.5) | ROUND(25E-1) |
          +------------+--------------+
          | 3          |            2 |
          +------------+--------------+

     For more information, see *note precision-math::.

   * 
     'SIGN(X)'

     Returns the sign of the argument as '-1', '0', or '1', depending on
     whether X is negative, zero, or positive.

          mysql> SELECT SIGN(-32);
                  -> -1
          mysql> SELECT SIGN(0);
                  -> 0
          mysql> SELECT SIGN(234);
                  -> 1

   * 
     'SIN(X)'

     Returns the sine of X, where X is given in radians.

          mysql> SELECT SIN(PI());
                  -> 1.2246063538224e-16
          mysql> SELECT ROUND(SIN(PI()));
                  -> 0

   * 
     'SQRT(X)'

     Returns the square root of a nonnegative number X.

          mysql> SELECT SQRT(4);
                  -> 2
          mysql> SELECT SQRT(20);
                  -> 4.4721359549996
          mysql> SELECT SQRT(-16);
                  -> NULL

   * 
     'TAN(X)'

     Returns the tangent of X, where X is given in radians.

          mysql> SELECT TAN(PI());
                  -> -1.2246063538224e-16
          mysql> SELECT TAN(PI()+1);
                  -> 1.5574077246549

   * 
     'TRUNCATE(X,D)'

     Returns the number X, truncated to D decimal places.  If D is '0',
     the result has no decimal point or fractional part.  D can be
     negative to cause D digits left of the decimal point of the value X
     to become zero.

          mysql> SELECT TRUNCATE(1.223,1);
                  -> 1.2
          mysql> SELECT TRUNCATE(1.999,1);
                  -> 1.9
          mysql> SELECT TRUNCATE(1.999,0);
                  -> 1
          mysql> SELECT TRUNCATE(-1.999,1);
                  -> -1.9
          mysql> SELECT TRUNCATE(122,-2);
                 -> 100
          mysql> SELECT TRUNCATE(10.28*100,0);
                 -> 1028

     All numbers are rounded toward zero.


File: manual.info.tmp,  Node: date-and-time-functions,  Next: string-functions,  Prev: numeric-functions,  Up: functions

12.6 Date and Time Functions
============================

This section describes the functions that can be used to manipulate
temporal values.  See *note date-and-time-types::, for a description of
the range of values each date and time type has and the valid formats in
which values may be specified.

*Date and Time Functions*

Name                          Description
                              
'ADDDATE()'                   Add time values (intervals) to a date
                              value
                              
'ADDTIME()'                   Add time
                              
'CONVERT_TZ()'                Convert from one time zone to another
                              
'CURDATE()'                   Return the current date
                              
'CURRENT_DATE()',             Synonyms for CURDATE()
'CURRENT_DATE'                

'CURRENT_TIME()',             Synonyms for CURTIME()
'CURRENT_TIME'                

'CURRENT_TIMESTAMP()',        Synonyms for NOW()
'CURRENT_TIMESTAMP'           

'CURTIME()'                   Return the current time
                              
'DATE()'                      Extract the date part of a date or
                              datetime expression
                              
'DATE_ADD()'                  Add time values (intervals) to a date
                              value
                              
'DATE_FORMAT()'               Format date as specified
                              
'DATE_SUB()'                  Subtract a time value (interval) from a
                              date
                              
'DATEDIFF()'                  Subtract two dates
                              
'DAY()'                       Synonym for DAYOFMONTH()
                              
'DAYNAME()'                   Return the name of the weekday
                              
'DAYOFMONTH()'                Return the day of the month (0-31)
                              
'DAYOFWEEK()'                 Return the weekday index of the argument
                              
'DAYOFYEAR()'                 Return the day of the year (1-366)
                              
'EXTRACT()'                   Extract part of a date
                              
'FROM_DAYS()'                 Convert a day number to a date
                              
'FROM_UNIXTIME()'             Format Unix timestamp as a date
                              
'GET_FORMAT()'                Return a date format string
                              
'HOUR()'                      Extract the hour
                              
'LAST_DAY'                    Return the last day of the month for the
                              argument
                              
'LOCALTIME()', 'LOCALTIME'    Synonym for NOW()
                              
'LOCALTIMESTAMP',             Synonym for NOW()
'LOCALTIMESTAMP()'            

'MAKEDATE()'                  Create a date from the year and day of
                              year
                              
'MAKETIME()'                  Create time from hour, minute, second
                              
'MICROSECOND()'               Return the microseconds from argument
                              
'MINUTE()'                    Return the minute from the argument
                              
'MONTH()'                     Return the month from the date passed
                              
'MONTHNAME()'                 Return the name of the month
                              
'NOW()'                       Return the current date and time
                              
'PERIOD_ADD()'                Add a period to a year-month
                              
'PERIOD_DIFF()'               Return the number of months between
                              periods
                              
'QUARTER()'                   Return the quarter from a date argument
                              
'SEC_TO_TIME()'               Converts seconds to 'hh:mm:ss' format
                              
'SECOND()'                    Return the second (0-59)
                              
'STR_TO_DATE()'               Convert a string to a date
                              
'SUBDATE()'                   Synonym for DATE_SUB() when invoked with
                              three arguments
                              
'SUBTIME()'                   Subtract times
                              
'SYSDATE()'                   Return the time at which the function
                              executes
                              
'TIME()'                      Extract the time portion of the
                              expression passed
                              
'TIME_FORMAT()'               Format as time
                              
'TIME_TO_SEC()'               Return the argument converted to seconds
                              
'TIMEDIFF()'                  Subtract time
                              
'TIMESTAMP()'                 With a single argument, this function
                              returns the date or datetime expression;
                              with two arguments, the sum of the
                              arguments
                              
'TIMESTAMPADD()'              Add an interval to a datetime expression
                              
'TIMESTAMPDIFF()'             Subtract an interval from a datetime
                              expression
                              
'TO_DAYS()'                   Return the date argument converted to
                              days
                              
'TO_SECONDS()'                Return the date or datetime argument
                              converted to seconds since Year 0
                              
'UNIX_TIMESTAMP()'            Return a Unix timestamp
                              
'UTC_DATE()'                  Return the current UTC date
                              
'UTC_TIME()'                  Return the current UTC time
                              
'UTC_TIMESTAMP()'             Return the current UTC date and time
                              
'WEEK()'                      Return the week number
                              
'WEEKDAY()'                   Return the weekday index
                              
'WEEKOFYEAR()'                Return the calendar week of the date
                              (1-53)
                              
'YEAR()'                      Return the year
                              
'YEARWEEK()'                  Return the year and week

Here is an example that uses date functions.  The following query
selects all rows with a DATE_COL value from within the last 30 days:

     mysql> SELECT SOMETHING FROM TBL_NAME
         -> WHERE DATE_SUB(CURDATE(),INTERVAL 30 DAY) <= DATE_COL;

The query also selects rows with dates that lie in the future.

Functions that expect date values usually accept datetime values and
ignore the time part.  Functions that expect time values usually accept
datetime values and ignore the date part.

Functions that return the current date or time each are evaluated only
once per query at the start of query execution.  This means that
multiple references to a function such as 'NOW()' within a single query
always produce the same result.  (For our purposes, a single query also
includes a call to a stored program (stored routine, trigger, or event)
and all subprograms called by that program.)  This principle also
applies to 'CURDATE()', 'CURTIME()', 'UTC_DATE()', 'UTC_TIME()',
'UTC_TIMESTAMP()', and to any of their synonyms.

The 'CURRENT_TIMESTAMP()', 'CURRENT_TIME()', 'CURRENT_DATE()', and
'FROM_UNIXTIME()' functions return values in the current session time
zone, which is available as the session value of the 'time_zone' system
variable.  In addition, 'UNIX_TIMESTAMP()' assumes that its argument is
a datetime value in the session time zone.  See *note
time-zone-support::.

Some date functions can be used with 'zero' dates or incomplete dates
such as ''2001-11-00'', whereas others cannot.  Functions that extract
parts of dates typically work with incomplete dates and thus can return
0 when you might otherwise expect a nonzero value.  For example:

     mysql> SELECT DAYOFMONTH('2001-11-00'), MONTH('2005-00-00');
             -> 0, 0

Other functions expect complete dates and return 'NULL' for incomplete
dates.  These include functions that perform date arithmetic or that map
parts of dates to names.  For example:

     mysql> SELECT DATE_ADD('2006-05-00',INTERVAL 1 DAY);
             -> NULL
     mysql> SELECT DAYNAME('2006-05-00');
             -> NULL

*Note*:

From MySQL 5.5.16 to 5.5.20, a change in handling of a date-related
assertion caused several functions to become more strict when passed a
'DATE()' function value as their argument and reject incomplete dates
with a day part of zero.  These functions are affected: 'CONVERT_TZ()',
'DATE_ADD()', 'DATE_SUB()', 'DAYOFYEAR()', 'LAST_DAY()',
'TIMESTAMPDIFF()', 'TO_DAYS()', 'TO_SECONDS()', 'WEEK()', 'WEEKDAY()',
'WEEKOFYEAR()', 'YEARWEEK()'.  Because this changes date-handling
behavior in General Availability-status series MySQL 5.5, the change was
reverted in 5.5.21.

   * 
     'ADDDATE(DATE,INTERVAL EXPR UNIT)', 'ADDDATE(EXPR,DAYS)'

     When invoked with the 'INTERVAL' form of the second argument,
     'ADDDATE()' is a synonym for 'DATE_ADD()'.  The related function
     'SUBDATE()' is a synonym for 'DATE_SUB()'.  For information on the
     'INTERVAL' UNIT argument, see *note temporal-intervals::.

          mysql> SELECT DATE_ADD('2008-01-02', INTERVAL 31 DAY);
                  -> '2008-02-02'
          mysql> SELECT ADDDATE('2008-01-02', INTERVAL 31 DAY);
                  -> '2008-02-02'

     When invoked with the DAYS form of the second argument, MySQL
     treats it as an integer number of days to be added to EXPR.

          mysql> SELECT ADDDATE('2008-01-02', 31);
                  -> '2008-02-02'

   * 
     'ADDTIME(EXPR1,EXPR2)'

     'ADDTIME()' adds EXPR2 to EXPR1 and returns the result.  EXPR1 is a
     time or datetime expression, and EXPR2 is a time expression.

          mysql> SELECT ADDTIME('2007-12-31 23:59:59.999999', '1 1:1:1.000002');
                  -> '2008-01-02 01:01:01.000001'
          mysql> SELECT ADDTIME('01:00:00.999999', '02:00:00.999998');
                  -> '03:00:01.999997'

   * 
     'CONVERT_TZ(DT,FROM_TZ,TO_TZ)'

     'CONVERT_TZ()' converts a datetime value DT from the time zone
     given by FROM_TZ to the time zone given by TO_TZ and returns the
     resulting value.  Time zones are specified as described in *note
     time-zone-support::.  This function returns 'NULL' if the arguments
     are invalid.

     If the value falls out of the supported range of the *note
     'TIMESTAMP': datetime. type when converted from FROM_TZ to UTC, no
     conversion occurs.  The *note 'TIMESTAMP': datetime. range is
     described in *note date-and-time-type-syntax::.

          mysql> SELECT CONVERT_TZ('2004-01-01 12:00:00','GMT','MET');
                  -> '2004-01-01 13:00:00'
          mysql> SELECT CONVERT_TZ('2004-01-01 12:00:00','+00:00','+10:00');
                  -> '2004-01-01 22:00:00'

     *Note*:

     To use named time zones such as ''MET'' or ''Europe/Amsterdam'',
     the time zone tables must be properly set up.  For instructions,
     see *note time-zone-support::.

   * 
     'CURDATE()'

     Returns the current date as a value in ''YYYY-MM-DD'' or YYYYMMDD
     format, depending on whether the function is used in string or
     numeric context.

          mysql> SELECT CURDATE();
                  -> '2008-06-13'
          mysql> SELECT CURDATE() + 0;
                  -> 20080613

   * 
     'CURRENT_DATE', 'CURRENT_DATE()'

     'CURRENT_DATE' and 'CURRENT_DATE()' are synonyms for 'CURDATE()'.

   * 
     'CURRENT_TIME', 'CURRENT_TIME()'

     'CURRENT_TIME' and 'CURRENT_TIME()' are synonyms for 'CURTIME()'.

   * 
     'CURRENT_TIMESTAMP', 'CURRENT_TIMESTAMP()'

     'CURRENT_TIMESTAMP' and 'CURRENT_TIMESTAMP()' are synonyms for
     'NOW()'.

   * 
     'CURTIME()'

     Returns the current time as a value in 'HH:MM:SS' or HHMMSS format,
     depending on whether the function is used in string or numeric
     context.  The value is expressed in the session time zone.

          mysql> SELECT CURTIME();
                  -> '23:50:26'
          mysql> SELECT CURTIME() + 0;
                  -> 235026.000000

   * 
     'DATE(EXPR)'

     Extracts the date part of the date or datetime expression EXPR.

          mysql> SELECT DATE('2003-12-31 01:02:03');
                  -> '2003-12-31'

   * 
     'DATEDIFF(EXPR1,EXPR2)'

     'DATEDIFF()' returns EXPR1 − EXPR2 expressed as a value in days
     from one date to the other.  EXPR1 and EXPR2 are date or
     date-and-time expressions.  Only the date parts of the values are
     used in the calculation.

          mysql> SELECT DATEDIFF('2007-12-31 23:59:59','2007-12-30');
                  -> 1
          mysql> SELECT DATEDIFF('2010-11-30 23:59:59','2010-12-31');
                  -> -31

   * 
     'DATE_ADD(DATE,INTERVAL EXPR UNIT)', 'DATE_SUB(DATE,INTERVAL EXPR
     UNIT)'

     These functions perform date arithmetic.  The DATE argument
     specifies the starting date or datetime value.  EXPR is an
     expression specifying the interval value to be added or subtracted
     from the starting date.  EXPR is evaluated as a string; it may
     start with a '-' for negative intervals.  UNIT is a keyword
     indicating the units in which the expression should be interpreted.

     For more information about temporal interval syntax, including a
     full list of UNIT specifiers, the expected form of the EXPR
     argument for each UNIT value, and rules for operand interpretation
     in temporal arithmetic, see *note temporal-intervals::.

     The return value depends on the arguments:

        * *note 'DATE': datetime. if the DATE argument is a *note
          'DATE': datetime. value and your calculations involve only
          'YEAR', 'MONTH', and 'DAY' parts (that is, no time parts).

        * *note 'DATETIME': datetime. if the first argument is a *note
          'DATETIME': datetime. (or *note 'TIMESTAMP': datetime.) value,
          or if the first argument is a *note 'DATE': datetime. and the
          UNIT value uses 'HOURS', 'MINUTES', or 'SECONDS'.

        * String otherwise.

     To ensure that the result is *note 'DATETIME': datetime, you can
     use 'CAST()' to convert the first argument to *note 'DATETIME':
     datetime.

          mysql> SELECT DATE_ADD('2018-05-01',INTERVAL 1 DAY);
                  -> '2018-05-02'
          mysql> SELECT DATE_SUB('2018-05-01',INTERVAL 1 YEAR);
                  -> '2017-05-01'
          mysql> SELECT DATE_ADD('2020-12-31 23:59:59',
              ->                 INTERVAL 1 SECOND);
                  -> '2021-01-01 00:00:00'
          mysql> SELECT DATE_ADD('2018-12-31 23:59:59',
              ->                 INTERVAL 1 DAY);
                  -> '2019-01-01 23:59:59'
          mysql> SELECT DATE_ADD('2100-12-31 23:59:59',
              ->                 INTERVAL '1:1' MINUTE_SECOND);
                  -> '2101-01-01 00:01:00'
          mysql> SELECT DATE_SUB('2025-01-01 00:00:00',
              ->                 INTERVAL '1 1:1:1' DAY_SECOND);
                  -> '2024-12-30 22:58:59'
          mysql> SELECT DATE_ADD('1900-01-01 00:00:00',
              ->                 INTERVAL '-1 10' DAY_HOUR);
                  -> '1899-12-30 14:00:00'
          mysql> SELECT DATE_SUB('1998-01-02', INTERVAL 31 DAY);
                  -> '1997-12-02'
          mysql> SELECT DATE_ADD('1992-12-31 23:59:59.000002',
              ->            INTERVAL '1.999999' SECOND_MICROSECOND);
                  -> '1993-01-01 00:00:01.000001'

   * 
     'DATE_FORMAT(DATE,FORMAT)'

     Formats the DATE value according to the FORMAT string.

     The specifiers shown in the following table may be used in the
     FORMAT string.  The '%' character is required before format
     specifier characters.  The specifiers apply to other functions as
     well: 'STR_TO_DATE()', 'TIME_FORMAT()', 'UNIX_TIMESTAMP()'.

     Specifier      Description
                    
     '%a'           Abbreviated weekday name ('Sun'..'Sat')
                    
     '%b'           Abbreviated month name ('Jan'..'Dec')
                    
     '%c'           Month, numeric ('0'..'12')
                    
     '%D'           Day of the month with English suffix ('0th',
                    '1st', '2nd', '3rd', ...)
                    
     '%d'           Day of the month, numeric ('00'..'31')
                    
     '%e'           Day of the month, numeric ('0'..'31')
                    
     '%f'           Microseconds ('000000'..'999999')
                    
     '%H'           Hour ('00'..'23')
                    
     '%h'           Hour ('01'..'12')
                    
     '%I'           Hour ('01'..'12')
                    
     '%i'           Minutes, numeric ('00'..'59')
                    
     '%j'           Day of year ('001'..'366')
                    
     '%k'           Hour ('0'..'23')
                    
     '%l'           Hour ('1'..'12')
                    
     '%M'           Month name ('January'..'December')
                    
     '%m'           Month, numeric ('00'..'12')
                    
     '%p'           'AM' or 'PM'
                    
     '%r'           Time, 12-hour (HH:MM:SS followed by 'AM' or
                    'PM')
                    
     '%S'           Seconds ('00'..'59')
                    
     '%s'           Seconds ('00'..'59')
                    
     '%T'           Time, 24-hour (HH:MM:SS)
                    
     '%U'           Week ('00'..'53'), where Sunday is the first day
                    of the week; 'WEEK()' mode 0
                    
     '%u'           Week ('00'..'53'), where Monday is the first day
                    of the week; 'WEEK()' mode 1
                    
     '%V'           Week ('01'..'53'), where Sunday is the first day
                    of the week; 'WEEK()' mode 2; used with '%X'
                    
     '%v'           Week ('01'..'53'), where Monday is the first day
                    of the week; 'WEEK()' mode 3; used with '%x'
                    
     '%W'           Weekday name ('Sunday'..'Saturday')
                    
     '%w'           Day of the week ('0'=Sunday..'6'=Saturday)
                    
     '%X'           Year for the week where Sunday is the first day
                    of the week, numeric, four digits; used with
                    '%V'
                    
     '%x'           Year for the week, where Monday is the first day
                    of the week, numeric, four digits; used with
                    '%v'
                    
     '%Y'           Year, numeric, four digits
                    
     '%y'           Year, numeric (two digits)
                    
     '%%'           A literal '%' character
                    
     '%X'           X, for any 'X' not listed above

     Ranges for the month and day specifiers begin with zero due to the
     fact that MySQL permits the storing of incomplete dates such as
     ''2014-00-00''.

     The language used for day and month names and abbreviations is
     controlled by the value of the 'lc_time_names' system variable
     (*note locale-support::).

     For the '%U', '%u', '%V', and '%v' specifiers, see the description
     of the 'WEEK()' function for information about the mode values.
     The mode affects how week numbering occurs.

     'DATE_FORMAT()' returns a string with a character set and collation
     given by 'character_set_connection' and 'collation_connection' so
     that it can return month and weekday names containing non-ASCII
     characters.

          mysql> SELECT DATE_FORMAT('2009-10-04 22:23:00', '%W %M %Y');
                  -> 'Sunday October 2009'
          mysql> SELECT DATE_FORMAT('2007-10-04 22:23:00', '%H:%i:%s');
                  -> '22:23:00'
          mysql> SELECT DATE_FORMAT('1900-10-04 22:23:00',
              ->                 '%D %y %a %d %m %b %j');
                  -> '4th 00 Thu 04 10 Oct 277'
          mysql> SELECT DATE_FORMAT('1997-10-04 22:23:00',
              ->                 '%H %k %I %r %T %S %w');
                  -> '22 22 10 10:23:00 PM 22:23:00 00 6'
          mysql> SELECT DATE_FORMAT('1999-01-01', '%X %V');
                  -> '1998 52'
          mysql> SELECT DATE_FORMAT('2006-06-00', '%d');
                  -> '00'

   * 
     'DATE_SUB(DATE,INTERVAL EXPR UNIT)'

     See the description for 'DATE_ADD()'.

   * 
     'DAY(DATE)'

     'DAY()' is a synonym for 'DAYOFMONTH()'.

   * 
     'DAYNAME(DATE)'

     Returns the name of the weekday for DATE.  The language used for
     the name is controlled by the value of the 'lc_time_names' system
     variable (*note locale-support::).

          mysql> SELECT DAYNAME('2007-02-03');
                  -> 'Saturday'

   * 
     'DAYOFMONTH(DATE)'

     Returns the day of the month for DATE, in the range '1' to '31', or
     '0' for dates such as ''0000-00-00'' or ''2008-00-00'' that have a
     zero day part.

          mysql> SELECT DAYOFMONTH('2007-02-03');
                  -> 3

   * 
     'DAYOFWEEK(DATE)'

     Returns the weekday index for DATE ('1' = Sunday, '2' = Monday,
     ..., '7' = Saturday).  These index values correspond to the ODBC
     standard.

          mysql> SELECT DAYOFWEEK('2007-02-03');
                  -> 7

   * 
     'DAYOFYEAR(DATE)'

     Returns the day of the year for DATE, in the range '1' to '366'.

          mysql> SELECT DAYOFYEAR('2007-02-03');
                  -> 34

   * 
     'EXTRACT(UNIT FROM DATE)'

     The 'EXTRACT()' function uses the same kinds of UNIT specifiers as
     'DATE_ADD()' or 'DATE_SUB()', but extracts parts from the date
     rather than performing date arithmetic.  For information on the
     UNIT argument, see *note temporal-intervals::.

          mysql> SELECT EXTRACT(YEAR FROM '2019-07-02');
                  -> 2019
          mysql> SELECT EXTRACT(YEAR_MONTH FROM '2019-07-02 01:02:03');
                  -> 201907
          mysql> SELECT EXTRACT(DAY_MINUTE FROM '2019-07-02 01:02:03');
                  -> 20102
          mysql> SELECT EXTRACT(MICROSECOND
              ->                FROM '2003-01-02 10:30:00.000123');
                  -> 123

   * 
     'FROM_DAYS(N)'

     Given a day number N, returns a *note 'DATE': datetime. value.

          mysql> SELECT FROM_DAYS(730669);
                  -> '2000-07-03'

     Use 'FROM_DAYS()' with caution on old dates.  It is not intended
     for use with values that precede the advent of the Gregorian
     calendar (1582).  See *note mysql-calendar::.

   * 
     'FROM_UNIXTIME(UNIX_TIMESTAMP[,FORMAT])'

     Returns a representation of the UNIX_TIMESTAMP argument as a value
     in ''YYYY-MM-DD HH:MM:SS'' or YYYYMMDDHHMMSS format, depending on
     whether the function is used in string or numeric context.
     UNIX_TIMESTAMP is an internal timestamp value representing seconds
     since ''1970-01-01 00:00:00'' UTC, such as produced by the
     'UNIX_TIMESTAMP()' function.

     The return value is expressed in the session time zone.  (Clients
     can set the session time zone as described in *note
     time-zone-support::.)  The FORMAT string, if given, is used to
     format the result the same way as described in the entry for the
     'DATE_FORMAT()' function.

          mysql> SELECT FROM_UNIXTIME(1447430881);
                  -> '2015-11-13 10:08:01'
          mysql> SELECT FROM_UNIXTIME(1447430881) + 0;
                  -> 20151113100801
          mysql> SELECT FROM_UNIXTIME(1447430881,
              ->                      '%Y %D %M %h:%i:%s %x');
                  -> '2015 13th November 10:08:01 2015'

     *Note*:

     If you use 'UNIX_TIMESTAMP()' and 'FROM_UNIXTIME()' to convert
     between values in a non-UTC time zone and Unix timestamp values,
     the conversion is lossy because the mapping is not one-to-one in
     both directions.  For details, see the description of the
     'UNIX_TIMESTAMP()' function.

   * 
     'GET_FORMAT({DATE|TIME|DATETIME},
     {'EUR'|'USA'|'JIS'|'ISO'|'INTERNAL'})'

     Returns a format string.  This function is useful in combination
     with the 'DATE_FORMAT()' and the 'STR_TO_DATE()' functions.

     The possible values for the first and second arguments result in
     several possible format strings (for the specifiers used, see the
     table in the 'DATE_FORMAT()' function description).  ISO format
     refers to ISO 9075, not ISO 8601.

     Function Call                               Result
                                                 
     'GET_FORMAT(DATE,'USA')'                    ''%m.%d.%Y''
                                                 
     'GET_FORMAT(DATE,'JIS')'                    ''%Y-%m-%d''
                                                 
     'GET_FORMAT(DATE,'ISO')'                    ''%Y-%m-%d''
                                                 
     'GET_FORMAT(DATE,'EUR')'                    ''%d.%m.%Y''
                                                 
     'GET_FORMAT(DATE,'INTERNAL')'               ''%Y%m%d''
                                                 
     'GET_FORMAT(DATETIME,'USA')'                ''%Y-%m-%d %H.%i.%s''
                                                 
     'GET_FORMAT(DATETIME,'JIS')'                ''%Y-%m-%d %H:%i:%s''
                                                 
     'GET_FORMAT(DATETIME,'ISO')'                ''%Y-%m-%d %H:%i:%s''
                                                 
     'GET_FORMAT(DATETIME,'EUR')'                ''%Y-%m-%d %H.%i.%s''
                                                 
     'GET_FORMAT(DATETIME,'INTERNAL')'           ''%Y%m%d%H%i%s''
                                                 
     'GET_FORMAT(TIME,'USA')'                    ''%h:%i:%s %p''
                                                 
     'GET_FORMAT(TIME,'JIS')'                    ''%H:%i:%s''
                                                 
     'GET_FORMAT(TIME,'ISO')'                    ''%H:%i:%s''
                                                 
     'GET_FORMAT(TIME,'EUR')'                    ''%H.%i.%s''
                                                 
     'GET_FORMAT(TIME,'INTERNAL')'               ''%H%i%s''

     *note 'TIMESTAMP': datetime. can also be used as the first argument
     to 'GET_FORMAT()', in which case the function returns the same
     values as for *note 'DATETIME': datetime.

          mysql> SELECT DATE_FORMAT('2003-10-03',GET_FORMAT(DATE,'EUR'));
                  -> '03.10.2003'
          mysql> SELECT STR_TO_DATE('10.31.2003',GET_FORMAT(DATE,'USA'));
                  -> '2003-10-31'

   * 
     'HOUR(TIME)'

     Returns the hour for TIME.  The range of the return value is '0' to
     '23' for time-of-day values.  However, the range of *note 'TIME':
     time. values actually is much larger, so 'HOUR' can return values
     greater than '23'.

          mysql> SELECT HOUR('10:05:03');
                  -> 10
          mysql> SELECT HOUR('272:59:59');
                  -> 272

   * 
     'LAST_DAY(DATE)'

     Takes a date or datetime value and returns the corresponding value
     for the last day of the month.  Returns 'NULL' if the argument is
     invalid.

          mysql> SELECT LAST_DAY('2003-02-05');
                  -> '2003-02-28'
          mysql> SELECT LAST_DAY('2004-02-05');
                  -> '2004-02-29'
          mysql> SELECT LAST_DAY('2004-01-01 01:01:01');
                  -> '2004-01-31'
          mysql> SELECT LAST_DAY('2003-03-32');
                  -> NULL

   * 
     'LOCALTIME', 'LOCALTIME()'

     'LOCALTIME' and 'LOCALTIME()' are synonyms for 'NOW()'.

   * 
     'LOCALTIMESTAMP', 'LOCALTIMESTAMP()'

     'LOCALTIMESTAMP' and 'LOCALTIMESTAMP()' are synonyms for 'NOW()'.

   * 
     'MAKEDATE(YEAR,DAYOFYEAR)'

     Returns a date, given year and day-of-year values.  DAYOFYEAR must
     be greater than 0 or the result is 'NULL'.

          mysql> SELECT MAKEDATE(2011,31), MAKEDATE(2011,32);
                  -> '2011-01-31', '2011-02-01'
          mysql> SELECT MAKEDATE(2011,365), MAKEDATE(2014,365);
                  -> '2011-12-31', '2014-12-31'
          mysql> SELECT MAKEDATE(2011,0);
                  -> NULL

   * 
     'MAKETIME(HOUR,MINUTE,SECOND)'

     Returns a time value calculated from the HOUR, MINUTE, and SECOND
     arguments.

          mysql> SELECT MAKETIME(12,15,30);
                  -> '12:15:30'

   * 
     'MICROSECOND(EXPR)'

     Returns the microseconds from the time or datetime expression EXPR
     as a number in the range from '0' to '999999'.

          mysql> SELECT MICROSECOND('12:00:00.123456');
                  -> 123456
          mysql> SELECT MICROSECOND('2019-12-31 23:59:59.000010');
                  -> 10

   * 
     'MINUTE(TIME)'

     Returns the minute for TIME, in the range '0' to '59'.

          mysql> SELECT MINUTE('2008-02-03 10:05:03');
                  -> 5

   * 
     'MONTH(DATE)'

     Returns the month for DATE, in the range '1' to '12' for January to
     December, or '0' for dates such as ''0000-00-00'' or ''2008-00-00''
     that have a zero month part.

          mysql> SELECT MONTH('2008-02-03');
                  -> 2

   * 
     'MONTHNAME(DATE)'

     Returns the full name of the month for DATE.  The language used for
     the name is controlled by the value of the 'lc_time_names' system
     variable (*note locale-support::).

          mysql> SELECT MONTHNAME('2008-02-03');
                  -> 'February'

   * 
     'NOW()'

     Returns the current date and time as a value in ''YYYY-MM-DD
     HH:MM:SS'' or YYYYMMDDHHMMSS format, depending on whether the
     function is used in string or numeric context.  The value is
     expressed in the session time zone.

          mysql> SELECT NOW();
                  -> '2007-12-15 23:50:26'
          mysql> SELECT NOW() + 0;
                  -> 20071215235026.000000

     'NOW()' returns a constant time that indicates the time at which
     the statement began to execute.  (Within a stored function or
     trigger, 'NOW()' returns the time at which the function or
     triggering statement began to execute.)  This differs from the
     behavior for 'SYSDATE()', which returns the exact time at which it
     executes.

          mysql> SELECT NOW(), SLEEP(2), NOW();
          +---------------------+----------+---------------------+
          | NOW()               | SLEEP(2) | NOW()               |
          +---------------------+----------+---------------------+
          | 2006-04-12 13:47:36 |        0 | 2006-04-12 13:47:36 |
          +---------------------+----------+---------------------+

          mysql> SELECT SYSDATE(), SLEEP(2), SYSDATE();
          +---------------------+----------+---------------------+
          | SYSDATE()           | SLEEP(2) | SYSDATE()           |
          +---------------------+----------+---------------------+
          | 2006-04-12 13:47:44 |        0 | 2006-04-12 13:47:46 |
          +---------------------+----------+---------------------+

     In addition, the 'SET TIMESTAMP' statement affects the value
     returned by 'NOW()' but not by 'SYSDATE()'.  This means that
     timestamp settings in the binary log have no effect on invocations
     of 'SYSDATE()'.  Setting the timestamp to a nonzero value causes
     each subsequent invocation of 'NOW()' to return that value.
     Setting the timestamp to zero cancels this effect so that 'NOW()'
     once again returns the current date and time.

     See the description for 'SYSDATE()' for additional information
     about the differences between the two functions.

   * 
     'PERIOD_ADD(P,N)'

     Adds N months to period P (in the format YYMM or YYYYMM).  Returns
     a value in the format YYYYMM.  Note that the period argument P is
     _not_ a date value.

          mysql> SELECT PERIOD_ADD(200801,2);
                  -> 200803

   * 
     'PERIOD_DIFF(P1,P2)'

     Returns the number of months between periods P1 and P2.  P1 and P2
     should be in the format YYMM or YYYYMM.  Note that the period
     arguments P1 and P2 are _not_ date values.

          mysql> SELECT PERIOD_DIFF(200802,200703);
                  -> 11

   * 
     'QUARTER(DATE)'

     Returns the quarter of the year for DATE, in the range '1' to '4'.

          mysql> SELECT QUARTER('2008-04-01');
                  -> 2

   * 
     'SECOND(TIME)'

     Returns the second for TIME, in the range '0' to '59'.

          mysql> SELECT SECOND('10:05:03');
                  -> 3

   * 
     'SEC_TO_TIME(SECONDS)'

     Returns the SECONDS argument, converted to hours, minutes, and
     seconds, as a *note 'TIME': time. value.  The range of the result
     is constrained to that of the *note 'TIME': time. data type.  A
     warning occurs if the argument corresponds to a value outside that
     range.

          mysql> SELECT SEC_TO_TIME(2378);
                  -> '00:39:38'
          mysql> SELECT SEC_TO_TIME(2378) + 0;
                  -> 3938

   * 
     'STR_TO_DATE(STR,FORMAT)'

     This is the inverse of the 'DATE_FORMAT()' function.  It takes a
     string STR and a format string FORMAT.  'STR_TO_DATE()' returns a
     *note 'DATETIME': datetime. value if the format string contains
     both date and time parts, or a *note 'DATE': datetime. or *note
     'TIME': time. value if the string contains only date or time parts.
     If the date, time, or datetime value extracted from STR is illegal,
     'STR_TO_DATE()' returns 'NULL' and produces a warning.

     The server scans STR attempting to match FORMAT to it.  The format
     string can contain literal characters and format specifiers
     beginning with '%'.  Literal characters in FORMAT must match
     literally in STR.  Format specifiers in FORMAT must match a date or
     time part in STR.  For the specifiers that can be used in FORMAT,
     see the 'DATE_FORMAT()' function description.

          mysql> SELECT STR_TO_DATE('01,5,2013','%d,%m,%Y');
                  -> '2013-05-01'
          mysql> SELECT STR_TO_DATE('May 1, 2013','%M %d,%Y');
                  -> '2013-05-01'

     Scanning starts at the beginning of STR and fails if FORMAT is
     found not to match.  Extra characters at the end of STR are
     ignored.

          mysql> SELECT STR_TO_DATE('a09:30:17','a%h:%i:%s');
                  -> '09:30:17'
          mysql> SELECT STR_TO_DATE('a09:30:17','%h:%i:%s');
                  -> NULL
          mysql> SELECT STR_TO_DATE('09:30:17a','%h:%i:%s');
                  -> '09:30:17'

     Unspecified date or time parts have a value of 0, so incompletely
     specified values in STR produce a result with some or all parts set
     to 0:

          mysql> SELECT STR_TO_DATE('abc','abc');
                  -> '0000-00-00'
          mysql> SELECT STR_TO_DATE('9','%m');
                  -> '0000-09-00'
          mysql> SELECT STR_TO_DATE('9','%s');
                  -> '00:00:09'

     Range checking on the parts of date values is as described in *note
     datetime::.  This means, for example, that 'zero' dates or dates
     with part values of 0 are permitted unless the SQL mode is set to
     disallow such values.

          mysql> SELECT STR_TO_DATE('00/00/0000', '%m/%d/%Y');
                  -> '0000-00-00'
          mysql> SELECT STR_TO_DATE('04/31/2004', '%m/%d/%Y');
                  -> '2004-04-31'

     If the 'NO_ZERO_DATE' or 'NO_ZERO_IN_DATE' SQL mode is enabled,
     zero dates or part of dates are disallowed.  In that case,
     'STR_TO_DATE()' returns 'NULL' and generates a warning:

          mysql> SET sql_mode = '';
          mysql> SELECT STR_TO_DATE('15:35:00', '%H:%i:%s');
          +-------------------------------------+
          | STR_TO_DATE('15:35:00', '%H:%i:%s') |
          +-------------------------------------+
          | 15:35:00                            |
          +-------------------------------------+
          mysql> SET sql_mode = 'NO_ZERO_IN_DATE';
          mysql> SELECT STR_TO_DATE('15:35:00', '%h:%i:%s');
          +-------------------------------------+
          | STR_TO_DATE('15:35:00', '%h:%i:%s') |
          +-------------------------------------+
          | NULL                                |
          +-------------------------------------+
          mysql> SHOW WARNINGS\G
          *************************** 1. row ***************************
            Level: Warning
             Code: 1411
          Message: Incorrect datetime value: '15:35:00' for function str_to_date

     *Note*:

     You cannot use format '"%X%V"' to convert a year-week string to a
     date because the combination of a year and week does not uniquely
     identify a year and month if the week crosses a month boundary.  To
     convert a year-week to a date, you should also specify the weekday:

          mysql> SELECT STR_TO_DATE('200442 Monday', '%X%V %W');
                  -> '2004-10-18'

   * 
     'SUBDATE(DATE,INTERVAL EXPR UNIT)', 'SUBDATE(EXPR,DAYS)'

     When invoked with the 'INTERVAL' form of the second argument,
     'SUBDATE()' is a synonym for 'DATE_SUB()'.  For information on the
     'INTERVAL' UNIT argument, see the discussion for 'DATE_ADD()'.

          mysql> SELECT DATE_SUB('2008-01-02', INTERVAL 31 DAY);
                  -> '2007-12-02'
          mysql> SELECT SUBDATE('2008-01-02', INTERVAL 31 DAY);
                  -> '2007-12-02'

     The second form enables the use of an integer value for DAYS.  In
     such cases, it is interpreted as the number of days to be
     subtracted from the date or datetime expression EXPR.

          mysql> SELECT SUBDATE('2008-01-02 12:00:00', 31);
                  -> '2007-12-02 12:00:00'

   * 
     'SUBTIME(EXPR1,EXPR2)'

     'SUBTIME()' returns EXPR1 − EXPR2 expressed as a value in the
     same format as EXPR1.  EXPR1 is a time or datetime expression, and
     EXPR2 is a time expression.

          mysql> SELECT SUBTIME('2007-12-31 23:59:59.999999','1 1:1:1.000002');
                  -> '2007-12-30 22:58:58.999997'
          mysql> SELECT SUBTIME('01:00:00.999999', '02:00:00.999998');
                  -> '-00:59:59.999999'

   * 
     'SYSDATE()'

     Returns the current date and time as a value in ''YYYY-MM-DD
     HH:MM:SS'' or YYYYMMDDHHMMSS format, depending on whether the
     function is used in string or numeric context.

     'SYSDATE()' returns the time at which it executes.  This differs
     from the behavior for 'NOW()', which returns a constant time that
     indicates the time at which the statement began to execute.
     (Within a stored function or trigger, 'NOW()' returns the time at
     which the function or triggering statement began to execute.)

          mysql> SELECT NOW(), SLEEP(2), NOW();
          +---------------------+----------+---------------------+
          | NOW()               | SLEEP(2) | NOW()               |
          +---------------------+----------+---------------------+
          | 2006-04-12 13:47:36 |        0 | 2006-04-12 13:47:36 |
          +---------------------+----------+---------------------+

          mysql> SELECT SYSDATE(), SLEEP(2), SYSDATE();
          +---------------------+----------+---------------------+
          | SYSDATE()           | SLEEP(2) | SYSDATE()           |
          +---------------------+----------+---------------------+
          | 2006-04-12 13:47:44 |        0 | 2006-04-12 13:47:46 |
          +---------------------+----------+---------------------+

     In addition, the 'SET TIMESTAMP' statement affects the value
     returned by 'NOW()' but not by 'SYSDATE()'.  This means that
     timestamp settings in the binary log have no effect on invocations
     of 'SYSDATE()'.

     Because 'SYSDATE()' can return different values even within the
     same statement, and is not affected by 'SET TIMESTAMP', it is
     nondeterministic and therefore unsafe for replication if
     statement-based binary logging is used.  If that is a problem, you
     can use row-based logging.

     Alternatively, you can use the '--sysdate-is-now' option to cause
     'SYSDATE()' to be an alias for 'NOW()'.  This works if the option
     is used on both the master and the slave.

     The nondeterministic nature of 'SYSDATE()' also means that indexes
     cannot be used for evaluating expressions that refer to it.

   * 
     'TIME(EXPR)'

     Extracts the time part of the time or datetime expression EXPR and
     returns it as a string.

     This function is unsafe for statement-based replication.  A warning
     is logged if you use this function when 'binlog_format' is set to
     'STATEMENT'.

          mysql> SELECT TIME('2003-12-31 01:02:03');
                  -> '01:02:03'
          mysql> SELECT TIME('2003-12-31 01:02:03.000123');
                  -> '01:02:03.000123'

   * 
     'TIMEDIFF(EXPR1,EXPR2)'

     'TIMEDIFF()' returns EXPR1 − EXPR2 expressed as a time value.
     EXPR1 and EXPR2 are time or date-and-time expressions, but both
     must be of the same type.

     The result returned by 'TIMEDIFF()' is limited to the range allowed
     for *note 'TIME': time. values.  Alternatively, you can use either
     of the functions 'TIMESTAMPDIFF()' and 'UNIX_TIMESTAMP()', both of
     which return integers.

          mysql> SELECT TIMEDIFF('2000:01:01 00:00:00',
              ->                 '2000:01:01 00:00:00.000001');
                  -> '-00:00:00.000001'
          mysql> SELECT TIMEDIFF('2008-12-31 23:59:59.000001',
              ->                 '2008-12-30 01:01:01.000002');
                  -> '46:58:57.999999'

   * 
     'TIMESTAMP(EXPR)', 'TIMESTAMP(EXPR1,EXPR2)'

     With a single argument, this function returns the date or datetime
     expression EXPR as a datetime value.  With two arguments, it adds
     the time expression EXPR2 to the date or datetime expression EXPR1
     and returns the result as a datetime value.

          mysql> SELECT TIMESTAMP('2003-12-31');
                  -> '2003-12-31 00:00:00'
          mysql> SELECT TIMESTAMP('2003-12-31 12:00:00','12:00:00');
                  -> '2004-01-01 00:00:00'

   * 
     'TIMESTAMPADD(UNIT,INTERVAL,DATETIME_EXPR)'

     Adds the integer expression INTERVAL to the date or datetime
     expression DATETIME_EXPR.  The unit for INTERVAL is given by the
     UNIT argument, which should be one of the following values:
     'MICROSECOND' (microseconds), 'SECOND', 'MINUTE', 'HOUR', 'DAY',
     'WEEK', 'MONTH', 'QUARTER', or 'YEAR'.

     The UNIT value may be specified using one of keywords as shown, or
     with a prefix of 'SQL_TSI_'.  For example, 'DAY' and 'SQL_TSI_DAY'
     both are legal.

          mysql> SELECT TIMESTAMPADD(MINUTE,1,'2003-01-02');
                  -> '2003-01-02 00:01:00'
          mysql> SELECT TIMESTAMPADD(WEEK,1,'2003-01-02');
                  -> '2003-01-09'

   * 
     'TIMESTAMPDIFF(UNIT,DATETIME_EXPR1,DATETIME_EXPR2)'

     Returns DATETIME_EXPR2 − DATETIME_EXPR1, where DATETIME_EXPR1 and
     DATETIME_EXPR2 are date or datetime expressions.  One expression
     may be a date and the other a datetime; a date value is treated as
     a datetime having the time part ''00:00:00'' where necessary.  The
     unit for the result (an integer) is given by the UNIT argument.
     The legal values for UNIT are the same as those listed in the
     description of the 'TIMESTAMPADD()' function.

          mysql> SELECT TIMESTAMPDIFF(MONTH,'2003-02-01','2003-05-01');
                  -> 3
          mysql> SELECT TIMESTAMPDIFF(YEAR,'2002-05-01','2001-01-01');
                  -> -1
          mysql> SELECT TIMESTAMPDIFF(MINUTE,'2003-02-01','2003-05-01 12:05:55');
                  -> 128885

     *Note*:

     The order of the date or datetime arguments for this function is
     the opposite of that used with the 'TIMESTAMP()' function when
     invoked with 2 arguments.

   * 
     'TIME_FORMAT(TIME,FORMAT)'

     This is used like the 'DATE_FORMAT()' function, but the FORMAT
     string may contain format specifiers only for hours, minutes,
     seconds, and microseconds.  Other specifiers produce a 'NULL' value
     or '0'.

     If the TIME value contains an hour part that is greater than '23',
     the '%H' and '%k' hour format specifiers produce a value larger
     than the usual range of '0..23'.  The other hour format specifiers
     produce the hour value modulo 12.

          mysql> SELECT TIME_FORMAT('100:00:00', '%H %k %h %I %l');
                  -> '100 100 04 04 4'

   * 
     'TIME_TO_SEC(TIME)'

     Returns the TIME argument, converted to seconds.

          mysql> SELECT TIME_TO_SEC('22:23:00');
                  -> 80580
          mysql> SELECT TIME_TO_SEC('00:39:38');
                  -> 2378

   * 
     'TO_DAYS(DATE)'

     Given a date DATE, returns a day number (the number of days since
     year 0).

          mysql> SELECT TO_DAYS(950501);
                  -> 728779
          mysql> SELECT TO_DAYS('2007-10-07');
                  -> 733321

     'TO_DAYS()' is not intended for use with values that precede the
     advent of the Gregorian calendar (1582), because it does not take
     into account the days that were lost when the calendar was changed.
     For dates before 1582 (and possibly a later year in other locales),
     results from this function are not reliable.  See *note
     mysql-calendar::, for details.

     Remember that MySQL converts two-digit year values in dates to
     four-digit form using the rules in *note date-and-time-types::.
     For example, ''2008-10-07'' and ''08-10-07'' are seen as identical
     dates:

          mysql> SELECT TO_DAYS('2008-10-07'), TO_DAYS('08-10-07');
                  -> 733687, 733687

     In MySQL, the zero date is defined as ''0000-00-00'', even though
     this date is itself considered invalid.  This means that, for
     ''0000-00-00'' and ''0000-01-01'', 'TO_DAYS()' returns the values
     shown here:

          mysql> SELECT TO_DAYS('0000-00-00');
          +-----------------------+
          | to_days('0000-00-00') |
          +-----------------------+
          |                  NULL |
          +-----------------------+
          1 row in set, 1 warning (0.00 sec)

          mysql> SHOW WARNINGS;
          +---------+------+----------------------------------------+
          | Level   | Code | Message                                |
          +---------+------+----------------------------------------+
          | Warning | 1292 | Incorrect datetime value: '0000-00-00' |
          +---------+------+----------------------------------------+
          1 row in set (0.00 sec)

          mysql> SELECT TO_DAYS('0000-01-01');
          +-----------------------+
          | to_days('0000-01-01') |
          +-----------------------+
          |                     1 |
          +-----------------------+
          1 row in set (0.00 sec)

     This is true whether or not the 'ALLOW_INVALID_DATES' SQL server
     mode is enabled.

   * 
     'TO_SECONDS(EXPR)'

     Given a date or datetime EXPR, returns the number of seconds since
     the year 0.  If EXPR is not a valid date or datetime value, returns
     'NULL'.

          mysql> SELECT TO_SECONDS(950501);
                  -> 62966505600
          mysql> SELECT TO_SECONDS('2009-11-29');
                  -> 63426672000
          mysql> SELECT TO_SECONDS('2009-11-29 13:43:32');
                  -> 63426721412
          mysql> SELECT TO_SECONDS( NOW() );
                  -> 63426721458

     Like 'TO_DAYS()', 'TO_SECONDS()' is not intended for use with
     values that precede the advent of the Gregorian calendar (1582),
     because it does not take into account the days that were lost when
     the calendar was changed.  For dates before 1582 (and possibly a
     later year in other locales), results from this function are not
     reliable.  See *note mysql-calendar::, for details.

     Like 'TO_DAYS()', 'TO_SECONDS()', converts two-digit year values in
     dates to four-digit form using the rules in *note
     date-and-time-types::.

     In MySQL, the zero date is defined as ''0000-00-00'', even though
     this date is itself considered invalid.  This means that, for
     ''0000-00-00'' and ''0000-01-01'', 'TO_SECONDS()' returns the
     values shown here:

          mysql> SELECT TO_SECONDS('0000-00-00');
          +--------------------------+
          | TO_SECONDS('0000-00-00') |
          +--------------------------+
          |                     NULL |
          +--------------------------+
          1 row in set, 1 warning (0.00 sec)

          mysql> SHOW WARNINGS;
          +---------+------+----------------------------------------+
          | Level   | Code | Message                                |
          +---------+------+----------------------------------------+
          | Warning | 1292 | Incorrect datetime value: '0000-00-00' |
          +---------+------+----------------------------------------+
          1 row in set (0.00 sec)

          mysql> SELECT TO_SECONDS('0000-01-01');
          +--------------------------+
          | TO_SECONDS('0000-01-01') |
          +--------------------------+
          |                    86400 |
          +--------------------------+
          1 row in set (0.00 sec)

     This is true whether or not the 'ALLOW_INVALID_DATES' SQL server
     mode is enabled.

   * 
     'UNIX_TIMESTAMP([DATE])'

     If 'UNIX_TIMESTAMP()' is called with no DATE argument, it returns a
     Unix timestamp representing seconds since ''1970-01-01 00:00:00''
     UTC.

     If 'UNIX_TIMESTAMP()' is called with a DATE argument, it returns
     the value of the argument as seconds since ''1970-01-01 00:00:00''
     UTC. The server interprets DATE as a value in the session time zone
     and converts it to an internal Unix timestamp value in UTC.
     (Clients can set the session time zone as described in *note
     time-zone-support::.)  The DATE argument may be a *note 'DATE':
     datetime, *note 'DATETIME': datetime, or *note 'TIMESTAMP':
     datetime. string, or a number in YYMMDD, YYMMDDHHMMSS, YYYYMMDD, or
     YYYYMMDDHHMMSS format.

     The return value is an unsigned integer.

     When the DATE argument is a *note 'TIMESTAMP': datetime. column,
     'UNIX_TIMESTAMP()' returns the internal timestamp value directly,
     with no implicit 'string-to-Unix-timestamp' conversion.

     The valid range of argument values is the same as for the *note
     'TIMESTAMP': datetime. data type: ''1970-01-01 00:00:01.000000''
     UTC to ''2038-01-19 03:14:07.999999'' UTC. If you pass an
     out-of-range date to 'UNIX_TIMESTAMP()', it returns '0'.

          mysql> SELECT UNIX_TIMESTAMP();
                  -> 1447431666
          mysql> SELECT UNIX_TIMESTAMP('2015-11-13 10:20:19');
                  -> 1447431619

     If you use 'UNIX_TIMESTAMP()' and 'FROM_UNIXTIME()' to convert
     between values in a non-UTC time zone and Unix timestamp values,
     the conversion is lossy because the mapping is not one-to-one in
     both directions.  For example, due to conventions for local time
     zone changes such as Daylight Saving Time (DST), it is possible for
     'UNIX_TIMESTAMP()' to map two values that are distinct in a non-UTC
     time zone to the same Unix timestamp value.  'FROM_UNIXTIME()' will
     map that value back to only one of the original values.  Here is an
     example, using values that are distinct in the 'MET' time zone:

          mysql> SET time_zone = 'MET';
          mysql> SELECT UNIX_TIMESTAMP('2005-03-27 03:00:00');
          +---------------------------------------+
          | UNIX_TIMESTAMP('2005-03-27 03:00:00') |
          +---------------------------------------+
          |                            1111885200 |
          +---------------------------------------+
          mysql> SELECT UNIX_TIMESTAMP('2005-03-27 02:00:00');
          +---------------------------------------+
          | UNIX_TIMESTAMP('2005-03-27 02:00:00') |
          +---------------------------------------+
          |                            1111885200 |
          +---------------------------------------+
          mysql> SELECT FROM_UNIXTIME(1111885200);
          +---------------------------+
          | FROM_UNIXTIME(1111885200) |
          +---------------------------+
          | 2005-03-27 03:00:00       |
          +---------------------------+

     *Note*:

     To use named time zones such as ''MET'' or ''Europe/Amsterdam'',
     the time zone tables must be properly set up.  For instructions,
     see *note time-zone-support::.

     If you want to subtract 'UNIX_TIMESTAMP()' columns, you might want
     to cast them to signed integers.  See *note cast-functions::.

   * 
     'UTC_DATE', 'UTC_DATE()'

     Returns the current UTC date as a value in ''YYYY-MM-DD'' or
     YYYYMMDD format, depending on whether the function is used in
     string or numeric context.

          mysql> SELECT UTC_DATE(), UTC_DATE() + 0;
                  -> '2003-08-14', 20030814

   * 
     'UTC_TIME', 'UTC_TIME()'

     Returns the current UTC time as a value in 'HH:MM:SS' or HHMMSS
     format, depending on whether the function is used in string or
     numeric context.

          mysql> SELECT UTC_TIME(), UTC_TIME() + 0;
                  -> '18:07:53', 180753.000000

   * 
     'UTC_TIMESTAMP', 'UTC_TIMESTAMP()'

     Returns the current UTC date and time as a value in ''YYYY-MM-DD
     HH:MM:SS'' or YYYYMMDDHHMMSS format, depending on whether the
     function is used in string or numeric context.

          mysql> SELECT UTC_TIMESTAMP(), UTC_TIMESTAMP() + 0;
                  -> '2003-08-14 18:08:04', 20030814180804.000000

   * 
     'WEEK(DATE[,MODE])'

     This function returns the week number for DATE.  The two-argument
     form of 'WEEK()' enables you to specify whether the week starts on
     Sunday or Monday and whether the return value should be in the
     range from '0' to '53' or from '1' to '53'.  If the MODE argument
     is omitted, the value of the 'default_week_format' system variable
     is used.  See *note server-system-variables::.

     The following table describes how the MODE argument works.

     Mode    First day of   Range          Week 1 is the first week ...
             week                          
             
     0       Sunday         0-53           with a Sunday in this year
                                           
     1       Monday         0-53           with 4 or more days this year
                                           
     2       Sunday         1-53           with a Sunday in this year
                                           
     3       Monday         1-53           with 4 or more days this year
                                           
     4       Sunday         0-53           with 4 or more days this year
                                           
     5       Monday         0-53           with a Monday in this year
                                           
     6       Sunday         1-53           with 4 or more days this year
                                           
     7       Monday         1-53           with a Monday in this year
                            

     For MODE values with a meaning of 'with 4 or more days this year,'
     weeks are numbered according to ISO 8601:1988:

        * If the week containing January 1 has 4 or more days in the new
          year, it is week 1.

        * Otherwise, it is the last week of the previous year, and the
          next week is week 1.

          mysql> SELECT WEEK('2008-02-20');
                  -> 7
          mysql> SELECT WEEK('2008-02-20',0);
                  -> 7
          mysql> SELECT WEEK('2008-02-20',1);
                  -> 8
          mysql> SELECT WEEK('2008-12-31',1);
                  -> 53

     If a date falls in the last week of the previous year, MySQL
     returns '0' if you do not use '2', '3', '6', or '7' as the optional
     MODE argument:

          mysql> SELECT YEAR('2000-01-01'), WEEK('2000-01-01',0);
                  -> 2000, 0

     One might argue that 'WEEK()' should return '52' because the given
     date actually occurs in the 52nd week of 1999.  'WEEK()' returns
     '0' instead so that the return value is 'the week number in the
     given year.' This makes use of the 'WEEK()' function reliable when
     combined with other functions that extract a date part from a date.

     If you prefer a result evaluated with respect to the year that
     contains the first day of the week for the given date, use '0',
     '2', '5', or '7' as the optional MODE argument.

          mysql> SELECT WEEK('2000-01-01',2);
                  -> 52

     Alternatively, use the 'YEARWEEK()' function:

          mysql> SELECT YEARWEEK('2000-01-01');
                  -> 199952
          mysql> SELECT MID(YEARWEEK('2000-01-01'),5,2);
                  -> '52'

   * 
     'WEEKDAY(DATE)'

     Returns the weekday index for DATE ('0' = Monday, '1' = Tuesday,
     ... '6' = Sunday).

          mysql> SELECT WEEKDAY('2008-02-03 22:23:00');
                  -> 6
          mysql> SELECT WEEKDAY('2007-11-06');
                  -> 1

   * 
     'WEEKOFYEAR(DATE)'

     Returns the calendar week of the date as a number in the range from
     '1' to '53'.  'WEEKOFYEAR()' is a compatibility function that is
     equivalent to 'WEEK(DATE,3)'.

          mysql> SELECT WEEKOFYEAR('2008-02-20');
                  -> 8

   * 
     'YEAR(DATE)'

     Returns the year for DATE, in the range '1000' to '9999', or '0'
     for the 'zero' date.

          mysql> SELECT YEAR('1987-01-01');
                  -> 1987

   * 
     'YEARWEEK(DATE)', 'YEARWEEK(DATE,MODE)'

     Returns year and week for a date.  The year in the result may be
     different from the year in the date argument for the first and the
     last week of the year.

     The MODE argument works exactly like the MODE argument to 'WEEK()'.
     For the single-argument syntax, a MODE value of 0 is used.  Unlike
     'WEEK()', the value of 'default_week_format' does not influence
     'YEARWEEK()'.

          mysql> SELECT YEARWEEK('1987-01-01');
                  -> 198652

     The week number is different from what the 'WEEK()' function would
     return ('0') for optional arguments '0' or '1', as 'WEEK()' then
     returns the week in the context of the given year.


File: manual.info.tmp,  Node: string-functions,  Next: mysql-calendar,  Prev: date-and-time-functions,  Up: functions

12.7 String Functions and Operators
===================================

* Menu:

* string-comparison-functions::  String Comparison Functions and Operators
* regexp::                       Regular Expressions
* string-functions-charset::     Character Set and Collation of Function Results

*String Functions and Operators*

Name                          Description
                              
'ASCII()'                     Return numeric value of left-most
                              character
                              
'BIN()'                       Return a string containing binary
                              representation of a number
                              
'BIT_LENGTH()'                Return length of argument in bits
                              
'CHAR()'                      Return the character for each integer
                              passed
                              
'CHAR_LENGTH()'               Return number of characters in argument
                              
'CHARACTER_LENGTH()'          Synonym for CHAR_LENGTH()
                              
'CONCAT()'                    Return concatenated string
                              
'CONCAT_WS()'                 Return concatenate with separator
                              
'ELT()'                       Return string at index number
                              
'EXPORT_SET()'                Return a string such that for every bit
                              set in the value bits, you get an on
                              string and for every unset bit, you get
                              an off string
                              
'FIELD()'                     Index (position) of first argument in
                              subsequent arguments
                              
'FIND_IN_SET()'               Index (position) of first argument within
                              second argument
                              
'FORMAT()'                    Return a number formatted to specified
                              number of decimal places
                              
'HEX()'                       Hexadecimal representation of decimal or
                              string value
                              
'INSERT()'                    Insert substring at specified position up
                              to specified number of characters
                              
'INSTR()'                     Return the index of the first occurrence
                              of substring
                              
'LCASE()'                     Synonym for LOWER()
                              
'LEFT()'                      Return the leftmost number of characters
                              as specified
                              
'LENGTH()'                    Return the length of a string in bytes
                              
'LIKE'                        Simple pattern matching
                              
'LOAD_FILE()'                 Load the named file
                              
'LOCATE()'                    Return the position of the first
                              occurrence of substring
                              
'LOWER()'                     Return the argument in lowercase
                              
'LPAD()'                      Return the string argument, left-padded
                              with the specified string
                              
'LTRIM()'                     Remove leading spaces
                              
'MAKE_SET()'                  Return a set of comma-separated strings
                              that have the corresponding bit in bits
                              set
                              
'MATCH'                       Perform full-text search
                              
'MID()'                       Return a substring starting from the
                              specified position
                              
'NOT LIKE'                    Negation of simple pattern matching
                              
'NOT REGEXP'                  Negation of REGEXP
                              
'OCT()'                       Return a string containing octal
                              representation of a number
                              
'OCTET_LENGTH()'              Synonym for LENGTH()
                              
'ORD()'                       Return character code for leftmost
                              character of the argument
                              
'POSITION()'                  Synonym for LOCATE()
                              
'QUOTE()'                     Escape the argument for use in an SQL
                              statement
                              
'REGEXP'                      Whether string matches regular expression
                              
'REPEAT()'                    Repeat a string the specified number of
                              times
                              
'REPLACE()'                   Replace occurrences of a specified string
                              
'REVERSE()'                   Reverse the characters in a string
                              
'RIGHT()'                     Return the specified rightmost number of
                              characters
                              
'RLIKE'                       Whether string matches regular expression
                              
'RPAD()'                      Append string the specified number of
                              times
                              
'RTRIM()'                     Remove trailing spaces
                              
'SOUNDEX()'                   Return a soundex string
                              
'SOUNDS LIKE'                 Compare sounds
                              
'SPACE()'                     Return a string of the specified number
                              of spaces
                              
'STRCMP()'                    Compare two strings
                              
'SUBSTR()'                    Return the substring as specified
                              
'SUBSTRING()'                 Return the substring as specified
                              
'SUBSTRING_INDEX()'           Return a substring from a string before
                              the specified number of occurrences of
                              the delimiter
                              
'TRIM()'                      Remove leading and trailing spaces
                              
'UCASE()'                     Synonym for UPPER()
                              
'UNHEX()'                     Return a string containing hex
                              representation of a number
                              
'UPPER()'                     Convert to uppercase

String-valued functions return 'NULL' if the length of the result would
be greater than the value of the 'max_allowed_packet' system variable.
See *note server-configuration::.

For functions that operate on string positions, the first position is
numbered 1.

For functions that take length arguments, noninteger arguments are
rounded to the nearest integer.

   * 
     'ASCII(STR)'

     Returns the numeric value of the leftmost character of the string
     STR.  Returns '0' if STR is the empty string.  Returns 'NULL' if
     STR is 'NULL'.  'ASCII()' works for 8-bit characters.

          mysql> SELECT ASCII('2');
                  -> 50
          mysql> SELECT ASCII(2);
                  -> 50
          mysql> SELECT ASCII('dx');
                  -> 100

     See also the 'ORD()' function.

   * 
     'BIN(N)'

     Returns a string representation of the binary value of N, where N
     is a longlong (*note 'BIGINT': integer-types.) number.  This is
     equivalent to 'CONV(N,10,2)'.  Returns 'NULL' if N is 'NULL'.

          mysql> SELECT BIN(12);
                  -> '1100'

   * 
     'BIT_LENGTH(STR)'

     Returns the length of the string STR in bits.

          mysql> SELECT BIT_LENGTH('text');
                  -> 32

   * 
     'CHAR(N,... [USING CHARSET_NAME])'

     'CHAR()' interprets each argument N as an integer and returns a
     string consisting of the characters given by the code values of
     those integers.  'NULL' values are skipped.

          mysql> SELECT CHAR(77,121,83,81,'76');
                  -> 'MySQL'
          mysql> SELECT CHAR(77,77.3,'77.3');
                  -> 'MMM'

     'CHAR()' arguments larger than 255 are converted into multiple
     result bytes.  For example, 'CHAR(256)' is equivalent to
     'CHAR(1,0)', and 'CHAR(256*256)' is equivalent to 'CHAR(1,0,0)':

          mysql> SELECT HEX(CHAR(1,0)), HEX(CHAR(256));
          +----------------+----------------+
          | HEX(CHAR(1,0)) | HEX(CHAR(256)) |
          +----------------+----------------+
          | 0100           | 0100           |
          +----------------+----------------+
          mysql> SELECT HEX(CHAR(1,0,0)), HEX(CHAR(256*256));
          +------------------+--------------------+
          | HEX(CHAR(1,0,0)) | HEX(CHAR(256*256)) |
          +------------------+--------------------+
          | 010000           | 010000             |
          +------------------+--------------------+

     By default, 'CHAR()' returns a binary string.  To produce a string
     in a given character set, use the optional 'USING' clause:

          mysql> SELECT CHARSET(CHAR(X'65')), CHARSET(CHAR(X'65' USING utf8));
          +----------------------+---------------------------------+
          | CHARSET(CHAR(X'65')) | CHARSET(CHAR(X'65' USING utf8)) |
          +----------------------+---------------------------------+
          | binary               | utf8                            |
          +----------------------+---------------------------------+

     If 'USING' is given and the result string is illegal for the given
     character set, a warning is issued.  Also, if strict SQL mode is
     enabled, the result from 'CHAR()' becomes 'NULL'.

   * 
     'CHAR_LENGTH(STR)'

     Returns the length of the string STR, measured in characters.  A
     multibyte character counts as a single character.  This means that
     for a string containing five 2-byte characters, 'LENGTH()' returns
     '10', whereas 'CHAR_LENGTH()' returns '5'.

   * 
     'CHARACTER_LENGTH(STR)'

     'CHARACTER_LENGTH()' is a synonym for 'CHAR_LENGTH()'.

   * 
     'CONCAT(STR1,STR2,...)'

     Returns the string that results from concatenating the arguments.
     May have one or more arguments.  If all arguments are nonbinary
     strings, the result is a nonbinary string.  If the arguments
     include any binary strings, the result is a binary string.  A
     numeric argument is converted to its equivalent nonbinary string
     form.

     'CONCAT()' returns 'NULL' if any argument is 'NULL'.

          mysql> SELECT CONCAT('My', 'S', 'QL');
                  -> 'MySQL'
          mysql> SELECT CONCAT('My', NULL, 'QL');
                  -> NULL
          mysql> SELECT CONCAT(14.3);
                  -> '14.3'

     For quoted strings, concatenation can be performed by placing the
     strings next to each other:

          mysql> SELECT 'My' 'S' 'QL';
                  -> 'MySQL'

   * 
     'CONCAT_WS(SEPARATOR,STR1,STR2,...)'

     'CONCAT_WS()' stands for Concatenate With Separator and is a
     special form of 'CONCAT()'.  The first argument is the separator
     for the rest of the arguments.  The separator is added between the
     strings to be concatenated.  The separator can be a string, as can
     the rest of the arguments.  If the separator is 'NULL', the result
     is 'NULL'.

          mysql> SELECT CONCAT_WS(',','First name','Second name','Last Name');
                  -> 'First name,Second name,Last Name'
          mysql> SELECT CONCAT_WS(',','First name',NULL,'Last Name');
                  -> 'First name,Last Name'

     'CONCAT_WS()' does not skip empty strings.  However, it does skip
     any 'NULL' values after the separator argument.

   * 
     'ELT(N,STR1,STR2,STR3,...)'

     'ELT()' returns the Nth element of the list of strings: STR1 if N =
     '1', STR2 if N = '2', and so on.  Returns 'NULL' if N is less than
     '1' or greater than the number of arguments.  'ELT()' is the
     complement of 'FIELD()'.

          mysql> SELECT ELT(1, 'Aa', 'Bb', 'Cc', 'Dd');
                  -> 'Aa'
          mysql> SELECT ELT(4, 'Aa', 'Bb', 'Cc', 'Dd');
                  -> 'Dd'

   * 
     'EXPORT_SET(BITS,ON,OFF[,SEPARATOR[,NUMBER_OF_BITS]])'

     Returns a string such that for every bit set in the value BITS, you
     get an ON string and for every bit not set in the value, you get an
     OFF string.  Bits in BITS are examined from right to left (from
     low-order to high-order bits).  Strings are added to the result
     from left to right, separated by the SEPARATOR string (the default
     being the comma character ',').  The number of bits examined is
     given by NUMBER_OF_BITS, which has a default of 64 if not
     specified.  NUMBER_OF_BITS is silently clipped to 64 if larger than
     64.  It is treated as an unsigned integer, so a value of −1 is
     effectively the same as 64.

          mysql> SELECT EXPORT_SET(5,'Y','N',',',4);
                  -> 'Y,N,Y,N'
          mysql> SELECT EXPORT_SET(6,'1','0',',',10);
                  -> '0,1,1,0,0,0,0,0,0,0'

   * 
     'FIELD(STR,STR1,STR2,STR3,...)'

     Returns the index (position) of STR in the STR1, STR2, STR3, '...'
     list.  Returns '0' if STR is not found.

     If all arguments to 'FIELD()' are strings, all arguments are
     compared as strings.  If all arguments are numbers, they are
     compared as numbers.  Otherwise, the arguments are compared as
     double.

     If STR is 'NULL', the return value is '0' because 'NULL' fails
     equality comparison with any value.  'FIELD()' is the complement of
     'ELT()'.

          mysql> SELECT FIELD('Bb', 'Aa', 'Bb', 'Cc', 'Dd', 'Ff');
                  -> 2
          mysql> SELECT FIELD('Gg', 'Aa', 'Bb', 'Cc', 'Dd', 'Ff');
                  -> 0

   * 
     'FIND_IN_SET(STR,STRLIST)'

     Returns a value in the range of 1 to N if the string STR is in the
     string list STRLIST consisting of N substrings.  A string list is a
     string composed of substrings separated by ',' characters.  If the
     first argument is a constant string and the second is a column of
     type *note 'SET': set, the 'FIND_IN_SET()' function is optimized to
     use bit arithmetic.  Returns '0' if STR is not in STRLIST or if
     STRLIST is the empty string.  Returns 'NULL' if either argument is
     'NULL'.  This function does not work properly if the first argument
     contains a comma (',') character.

          mysql> SELECT FIND_IN_SET('b','a,b,c,d');
                  -> 2

   * 
     'FORMAT(X,D[,LOCALE])'

     Formats the number X to a format like ''#,###,###.##'', rounded to
     D decimal places, and returns the result as a string.  If D is '0',
     the result has no decimal point or fractional part.

     The optional third parameter enables a locale to be specified to be
     used for the result number's decimal point, thousands separator,
     and grouping between separators.  Permissible locale values are the
     same as the legal values for the 'lc_time_names' system variable
     (see *note locale-support::).  If no locale is specified, the
     default is ''en_US''.

          mysql> SELECT FORMAT(12332.123456, 4);
                  -> '12,332.1235'
          mysql> SELECT FORMAT(12332.1,4);
                  -> '12,332.1000'
          mysql> SELECT FORMAT(12332.2,0);
                  -> '12,332'
          mysql> SELECT FORMAT(12332.2,2,'de_DE');
                  -> '12.332,20'

   * 
     'HEX(STR)', 'HEX(N)'

     For a string argument STR, 'HEX()' returns a hexadecimal string
     representation of STR where each byte of each character in STR is
     converted to two hexadecimal digits.  (Multibyte characters
     therefore become more than two digits.)  The inverse of this
     operation is performed by the 'UNHEX()' function.

     For a numeric argument N, 'HEX()' returns a hexadecimal string
     representation of the value of N treated as a longlong (*note
     'BIGINT': integer-types.) number.  This is equivalent to
     'CONV(N,10,16)'.  The inverse of this operation is performed by
     'CONV(HEX(N),16,10)'.

          mysql> SELECT X'616263', HEX('abc'), UNHEX(HEX('abc'));
                  -> 'abc', 616263, 'abc'
          mysql> SELECT HEX(255), CONV(HEX(255),16,10);
                  -> 'FF', 255

   * 
     'INSERT(STR,POS,LEN,NEWSTR)'

     Returns the string STR, with the substring beginning at position
     POS and LEN characters long replaced by the string NEWSTR.  Returns
     the original string if POS is not within the length of the string.
     Replaces the rest of the string from position POS if LEN is not
     within the length of the rest of the string.  Returns 'NULL' if any
     argument is 'NULL'.

          mysql> SELECT INSERT('Quadratic', 3, 4, 'What');
                  -> 'QuWhattic'
          mysql> SELECT INSERT('Quadratic', -1, 4, 'What');
                  -> 'Quadratic'
          mysql> SELECT INSERT('Quadratic', 3, 100, 'What');
                  -> 'QuWhat'

     This function is multibyte safe.

   * 
     'INSTR(STR,SUBSTR)'

     Returns the position of the first occurrence of substring SUBSTR in
     string STR.  This is the same as the two-argument form of
     'LOCATE()', except that the order of the arguments is reversed.

          mysql> SELECT INSTR('foobarbar', 'bar');
                  -> 4
          mysql> SELECT INSTR('xbar', 'foobar');
                  -> 0

     This function is multibyte safe, and is case-sensitive only if at
     least one argument is a binary string.

   * 
     'LCASE(STR)'

     'LCASE()' is a synonym for 'LOWER()'.

   * 
     'LEFT(STR,LEN)'

     Returns the leftmost LEN characters from the string STR, or 'NULL'
     if any argument is 'NULL'.

          mysql> SELECT LEFT('foobarbar', 5);
                  -> 'fooba'

     This function is multibyte safe.

   * 
     'LENGTH(STR)'

     Returns the length of the string STR, measured in bytes.  A
     multibyte character counts as multiple bytes.  This means that for
     a string containing five 2-byte characters, 'LENGTH()' returns
     '10', whereas 'CHAR_LENGTH()' returns '5'.

          mysql> SELECT LENGTH('text');
                  -> 4

     *Note*:

     The 'Length()' OpenGIS spatial function is named 'GLength()' in
     MySQL.

   * 
     'LOAD_FILE(FILE_NAME)'

     Reads the file and returns the file contents as a string.  To use
     this function, the file must be located on the server host, you
     must specify the full path name to the file, and you must have the
     'FILE' privilege.  The file must be readable by all and its size
     less than 'max_allowed_packet' bytes.  If the 'secure_file_priv'
     system variable is set to a nonempty directory name, the file to be
     loaded must be located in that directory.

     If the file does not exist or cannot be read because one of the
     preceding conditions is not satisfied, the function returns 'NULL'.

     The 'character_set_filesystem' system variable controls
     interpretation of file names that are given as literal strings.

          mysql> UPDATE t
                      SET blob_col=LOAD_FILE('/tmp/picture')
                      WHERE id=1;

   * 
     'LOCATE(SUBSTR,STR)', 'LOCATE(SUBSTR,STR,POS)'

     The first syntax returns the position of the first occurrence of
     substring SUBSTR in string STR.  The second syntax returns the
     position of the first occurrence of substring SUBSTR in string STR,
     starting at position POS.  Returns '0' if SUBSTR is not in STR.
     Returns 'NULL' if SUBSTR or STR is 'NULL'.

          mysql> SELECT LOCATE('bar', 'foobarbar');
                  -> 4
          mysql> SELECT LOCATE('xbar', 'foobar');
                  -> 0
          mysql> SELECT LOCATE('bar', 'foobarbar', 5);
                  -> 7

     This function is multibyte safe, and is case-sensitive only if at
     least one argument is a binary string.

   * 
     'LOWER(STR)'

     Returns the string STR with all characters changed to lowercase
     according to the current character set mapping.  The default is
     'latin1' (cp1252 West European).

          mysql> SELECT LOWER('QUADRATICALLY');
                  -> 'quadratically'

     'LOWER()' (and 'UPPER()') are ineffective when applied to binary
     strings (*note 'BINARY': binary-varbinary, *note 'VARBINARY':
     binary-varbinary, *note 'BLOB': blob.).  To perform lettercase
     conversion of a binary string, first convert it to a nonbinary
     string using a character set appropriate for the data stored in the
     string:

          mysql> SET @str = BINARY 'New York';
          mysql> SELECT LOWER(@str), LOWER(CONVERT(@str USING latin1));
          +-------------+-----------------------------------+
          | LOWER(@str) | LOWER(CONVERT(@str USING latin1)) |
          +-------------+-----------------------------------+
          | New York    | new york                          |
          +-------------+-----------------------------------+

     This function is multibyte safe.

   * 
     'LPAD(STR,LEN,PADSTR)'

     Returns the string STR, left-padded with the string PADSTR to a
     length of LEN characters.  If STR is longer than LEN, the return
     value is shortened to LEN characters.

          mysql> SELECT LPAD('hi',4,'??');
                  -> '??hi'
          mysql> SELECT LPAD('hi',1,'??');
                  -> 'h'

   * 
     'LTRIM(STR)'

     Returns the string STR with leading space characters removed.

          mysql> SELECT LTRIM('  barbar');
                  -> 'barbar'

     This function is multibyte safe.

   * 
     'MAKE_SET(BITS,STR1,STR2,...)'

     Returns a set value (a string containing substrings separated by
     ',' characters) consisting of the strings that have the
     corresponding bit in BITS set.  STR1 corresponds to bit 0, STR2 to
     bit 1, and so on.  'NULL' values in STR1, STR2, '...' are not
     appended to the result.

          mysql> SELECT MAKE_SET(1,'a','b','c');
                  -> 'a'
          mysql> SELECT MAKE_SET(1 | 4,'hello','nice','world');
                  -> 'hello,world'
          mysql> SELECT MAKE_SET(1 | 4,'hello','nice',NULL,'world');
                  -> 'hello'
          mysql> SELECT MAKE_SET(0,'a','b','c');
                  -> ''

   * 
     'MID(STR,POS,LEN)'

     'MID(STR,POS,LEN)' is a synonym for 'SUBSTRING(STR,POS,LEN)'.

   * 
     'OCT(N)'

     Returns a string representation of the octal value of N, where N is
     a longlong (*note 'BIGINT': integer-types.) number.  This is
     equivalent to 'CONV(N,10,8)'.  Returns 'NULL' if N is 'NULL'.

          mysql> SELECT OCT(12);
                  -> '14'

   * 
     'OCTET_LENGTH(STR)'

     'OCTET_LENGTH()' is a synonym for 'LENGTH()'.

   * 
     'ORD(STR)'

     If the leftmost character of the string STR is a multibyte
     character, returns the code for that character, calculated from the
     numeric values of its constituent bytes using this formula:

            (1st byte code)
          + (2nd byte code * 256)
          + (3rd byte code * 256^2) ...

     If the leftmost character is not a multibyte character, 'ORD()'
     returns the same value as the 'ASCII()' function.

          mysql> SELECT ORD('2');
                  -> 50

   * 
     'POSITION(SUBSTR IN STR)'

     'POSITION(SUBSTR IN STR)' is a synonym for 'LOCATE(SUBSTR,STR)'.

   * 
     'QUOTE(STR)'

     Quotes a string to produce a result that can be used as a properly
     escaped data value in an SQL statement.  The string is returned
     enclosed by single quotation marks and with each instance of
     backslash ('\'), single quote ('''), ASCII 'NUL', and Control+Z
     preceded by a backslash.  If the argument is 'NULL', the return
     value is the word 'NULL' without enclosing single quotation marks.

          mysql> SELECT QUOTE('Don\'t!');
                  -> 'Don\'t!'
          mysql> SELECT QUOTE(NULL);
                  -> NULL

     For comparison, see the quoting rules for literal strings and
     within the C API in *note string-literals::, and *note
     mysql-real-escape-string::.

   * 
     'REPEAT(STR,COUNT)'

     Returns a string consisting of the string STR repeated COUNT times.
     If COUNT is less than 1, returns an empty string.  Returns 'NULL'
     if STR or COUNT are 'NULL'.

          mysql> SELECT REPEAT('MySQL', 3);
                  -> 'MySQLMySQLMySQL'

   * 
     'REPLACE(STR,FROM_STR,TO_STR)'

     Returns the string STR with all occurrences of the string FROM_STR
     replaced by the string TO_STR.  'REPLACE()' performs a
     case-sensitive match when searching for FROM_STR.

          mysql> SELECT REPLACE('www.mysql.com', 'w', 'Ww');
                  -> 'WwWwWw.mysql.com'

     This function is multibyte safe.

   * 
     'REVERSE(STR)'

     Returns the string STR with the order of the characters reversed.

          mysql> SELECT REVERSE('abc');
                  -> 'cba'

     This function is multibyte safe.

   * 
     'RIGHT(STR,LEN)'

     Returns the rightmost LEN characters from the string STR, or 'NULL'
     if any argument is 'NULL'.

          mysql> SELECT RIGHT('foobarbar', 4);
                  -> 'rbar'

     This function is multibyte safe.

   * 
     'RPAD(STR,LEN,PADSTR)'

     Returns the string STR, right-padded with the string PADSTR to a
     length of LEN characters.  If STR is longer than LEN, the return
     value is shortened to LEN characters.

          mysql> SELECT RPAD('hi',5,'?');
                  -> 'hi???'
          mysql> SELECT RPAD('hi',1,'?');
                  -> 'h'

     This function is multibyte safe.

   * 
     'RTRIM(STR)'

     Returns the string STR with trailing space characters removed.

          mysql> SELECT RTRIM('barbar   ');
                  -> 'barbar'

     This function is multibyte safe.

   * 
     'SOUNDEX(STR)'

     Returns a soundex string from STR.  Two strings that sound almost
     the same should have identical soundex strings.  A standard soundex
     string is four characters long, but the 'SOUNDEX()' function
     returns an arbitrarily long string.  You can use 'SUBSTRING()' on
     the result to get a standard soundex string.  All nonalphabetic
     characters in STR are ignored.  All international alphabetic
     characters outside the A-Z range are treated as vowels.

     *Important*:

     When using 'SOUNDEX()', you should be aware of the following
     limitations:

        * This function, as currently implemented, is intended to work
          well with strings that are in the English language only.
          Strings in other languages may not produce reliable results.

        * This function is not guaranteed to provide consistent results
          with strings that use multibyte character sets, including
          'utf-8'.  See Bug #22638 for more information.

          mysql> SELECT SOUNDEX('Hello');
                  -> 'H400'
          mysql> SELECT SOUNDEX('Quadratically');
                  -> 'Q36324'

     *Note*:

     This function implements the original Soundex algorithm, not the
     more popular enhanced version (also described by D. Knuth).  The
     difference is that original version discards vowels first and
     duplicates second, whereas the enhanced version discards duplicates
     first and vowels second.

   * 
     'EXPR1 SOUNDS LIKE EXPR2'

     This is the same as 'SOUNDEX(EXPR1) = SOUNDEX(EXPR2)'.

   * 
     'SPACE(N)'

     Returns a string consisting of N space characters.

          mysql> SELECT SPACE(6);
                  -> '      '

   * 
     'SUBSTR(STR,POS)', 'SUBSTR(STR FROM POS)', 'SUBSTR(STR,POS,LEN)',
     'SUBSTR(STR FROM POS FOR LEN)'

     'SUBSTR()' is a synonym for 'SUBSTRING()'.

   * 
     'SUBSTRING(STR,POS)', 'SUBSTRING(STR FROM POS)',
     'SUBSTRING(STR,POS,LEN)', 'SUBSTRING(STR FROM POS FOR LEN)'

     The forms without a LEN argument return a substring from string STR
     starting at position POS.  The forms with a LEN argument return a
     substring LEN characters long from string STR, starting at position
     POS.  The forms that use 'FROM' are standard SQL syntax.  It is
     also possible to use a negative value for POS.  In this case, the
     beginning of the substring is POS characters from the end of the
     string, rather than the beginning.  A negative value may be used
     for POS in any of the forms of this function.  A value of 0 for POS
     returns an empty string.

     For all forms of 'SUBSTRING()', the position of the first character
     in the string from which the substring is to be extracted is
     reckoned as '1'.

          mysql> SELECT SUBSTRING('Quadratically',5);
                  -> 'ratically'
          mysql> SELECT SUBSTRING('foobarbar' FROM 4);
                  -> 'barbar'
          mysql> SELECT SUBSTRING('Quadratically',5,6);
                  -> 'ratica'
          mysql> SELECT SUBSTRING('Sakila', -3);
                  -> 'ila'
          mysql> SELECT SUBSTRING('Sakila', -5, 3);
                  -> 'aki'
          mysql> SELECT SUBSTRING('Sakila' FROM -4 FOR 2);
                  -> 'ki'

     This function is multibyte safe.

     If LEN is less than 1, the result is the empty string.

   * 
     'SUBSTRING_INDEX(STR,DELIM,COUNT)'

     Returns the substring from string STR before COUNT occurrences of
     the delimiter DELIM.  If COUNT is positive, everything to the left
     of the final delimiter (counting from the left) is returned.  If
     COUNT is negative, everything to the right of the final delimiter
     (counting from the right) is returned.  'SUBSTRING_INDEX()'
     performs a case-sensitive match when searching for DELIM.

          mysql> SELECT SUBSTRING_INDEX('www.mysql.com', '.', 2);
                  -> 'www.mysql'
          mysql> SELECT SUBSTRING_INDEX('www.mysql.com', '.', -2);
                  -> 'mysql.com'

     This function is multibyte safe.

   * 
     'TRIM([{BOTH | LEADING | TRAILING} [REMSTR] FROM] STR)',
     'TRIM([REMSTR FROM] STR)'

     Returns the string STR with all REMSTR prefixes or suffixes
     removed.  If none of the specifiers 'BOTH', 'LEADING', or
     'TRAILING' is given, 'BOTH' is assumed.  REMSTR is optional and, if
     not specified, spaces are removed.

          mysql> SELECT TRIM('  bar   ');
                  -> 'bar'
          mysql> SELECT TRIM(LEADING 'x' FROM 'xxxbarxxx');
                  -> 'barxxx'
          mysql> SELECT TRIM(BOTH 'x' FROM 'xxxbarxxx');
                  -> 'bar'
          mysql> SELECT TRIM(TRAILING 'xyz' FROM 'barxxyz');
                  -> 'barx'

     This function is multibyte safe.

   * 
     'UCASE(STR)'

     'UCASE()' is a synonym for 'UPPER()'.

   * 
     'UNHEX(STR)'

     For a string argument STR, 'UNHEX(STR)' interprets each pair of
     characters in the argument as a hexadecimal number and converts it
     to the byte represented by the number.  The return value is a
     binary string.

          mysql> SELECT UNHEX('4D7953514C');
                  -> 'MySQL'
          mysql> SELECT X'4D7953514C';
                  -> 'MySQL'
          mysql> SELECT UNHEX(HEX('string'));
                  -> 'string'
          mysql> SELECT HEX(UNHEX('1267'));
                  -> '1267'

     The characters in the argument string must be legal hexadecimal
     digits: ''0'' ..  ''9'', ''A'' ..  ''F'', ''a'' ..  ''f''.  If the
     argument contains any nonhexadecimal digits, the result is 'NULL':

          mysql> SELECT UNHEX('GG');
          +-------------+
          | UNHEX('GG') |
          +-------------+
          | NULL        |
          +-------------+

     A 'NULL' result can occur if the argument to 'UNHEX()' is a *note
     'BINARY': binary-varbinary. column, because values are padded with
     0x00 bytes when stored but those bytes are not stripped on
     retrieval.  For example, ''41'' is stored into a 'CHAR(3)' column
     as ''41 '' and retrieved as ''41'' (with the trailing pad space
     stripped), so 'UNHEX()' for the column value returns ''A''.  By
     contrast ''41'' is stored into a 'BINARY(3)' column as ''41\0'' and
     retrieved as ''41\0'' (with the trailing pad '0x00' byte not
     stripped).  ''\0'' is not a legal hexadecimal digit, so 'UNHEX()'
     for the column value returns 'NULL'.

     For a numeric argument N, the inverse of 'HEX(N)' is not performed
     by 'UNHEX()'.  Use 'CONV(HEX(N),16,10)' instead.  See the
     description of 'HEX()'.

   * 
     'UPPER(STR)'

     Returns the string STR with all characters changed to uppercase
     according to the current character set mapping.  The default is
     'latin1' (cp1252 West European).

          mysql> SELECT UPPER('Hej');
                  -> 'HEJ'

     See the description of 'LOWER()' for information that also applies
     to 'UPPER()', such as information about how to perform lettercase
     conversion of binary strings (*note 'BINARY': binary-varbinary,
     *note 'VARBINARY': binary-varbinary, *note 'BLOB': blob.) for which
     these functions are ineffective.

     This function is multibyte safe.


File: manual.info.tmp,  Node: string-comparison-functions,  Next: regexp,  Prev: string-functions,  Up: string-functions

12.7.1 String Comparison Functions and Operators
------------------------------------------------

*String Comparison Functions and Operators*

Name                          Description
                              
'LIKE'                        Simple pattern matching
                              
'NOT LIKE'                    Negation of simple pattern matching
                              
'STRCMP()'                    Compare two strings

If a string function is given a binary string as an argument, the
resulting string is also a binary string.  A number converted to a
string is treated as a binary string.  This affects only comparisons.

Normally, if any expression in a string comparison is case-sensitive,
the comparison is performed in case-sensitive fashion.

   * 
     'EXPR LIKE PAT [ESCAPE 'ESCAPE_CHAR']'

     Pattern matching using an SQL pattern.  Returns '1' ('TRUE') or '0'
     ('FALSE').  If either EXPR or PAT is 'NULL', the result is 'NULL'.

     The pattern need not be a literal string.  For example, it can be
     specified as a string expression or table column.

     Per the SQL standard, 'LIKE' performs matching on a per-character
     basis, thus it can produce results different from the '='
     comparison operator:

          mysql> SELECT 'a"' LIKE 'ae' COLLATE latin1_german2_ci;
          +-----------------------------------------+
          | 'a"' LIKE 'ae' COLLATE latin1_german2_ci |
          +-----------------------------------------+
          |                                       0 |
          +-----------------------------------------+
          mysql> SELECT 'a"' = 'ae' COLLATE latin1_german2_ci;
          +--------------------------------------+
          | 'a"' = 'ae' COLLATE latin1_german2_ci |
          +--------------------------------------+
          |                                    1 |
          +--------------------------------------+

     In particular, trailing spaces are significant, which is not true
     for *note 'CHAR': char. or *note 'VARCHAR': char. comparisons
     performed with the '=' operator:

          mysql> SELECT 'a' = 'a ', 'a' LIKE 'a ';
          +------------+---------------+
          | 'a' = 'a ' | 'a' LIKE 'a ' |
          +------------+---------------+
          |          1 |             0 |
          +------------+---------------+
          1 row in set (0.00 sec)

     With 'LIKE' you can use the following two wildcard characters in
     the pattern:

        * '%' matches any number of characters, even zero characters.

        * '_' matches exactly one character.

          mysql> SELECT 'David!' LIKE 'David_';
                  -> 1
          mysql> SELECT 'David!' LIKE '%D%v%';
                  -> 1

     To test for literal instances of a wildcard character, precede it
     by the escape character.  If you do not specify the 'ESCAPE'
     character, '\' is assumed.

        * '\%' matches one '%' character.

        * '\_' matches one '_' character.

          mysql> SELECT 'David!' LIKE 'David\_';
                  -> 0
          mysql> SELECT 'David_' LIKE 'David\_';
                  -> 1

     To specify a different escape character, use the 'ESCAPE' clause:

          mysql> SELECT 'David_' LIKE 'David|_' ESCAPE '|';
                  -> 1

     The escape sequence should be empty or one character long.  The
     expression must evaluate as a constant at execution time.  If the
     'NO_BACKSLASH_ESCAPES' SQL mode is enabled, the sequence cannot be
     empty.

     The following two statements illustrate that string comparisons are
     not case-sensitive unless one of the operands is case-sensitive
     (uses a case-sensitive collation or is a binary string):

          mysql> SELECT 'abc' LIKE 'ABC';
                  -> 1
          mysql> SELECT 'abc' LIKE _latin1 'ABC' COLLATE latin1_general_cs;
                  -> 0
          mysql> SELECT 'abc' LIKE _latin1 'ABC' COLLATE latin1_bin;
                  -> 0
          mysql> SELECT 'abc' LIKE BINARY 'ABC';
                  -> 0

     As an extension to standard SQL, MySQL permits 'LIKE' on numeric
     expressions.

          mysql> SELECT 10 LIKE '1%';
                  -> 1

     *Note*:

     Because MySQL uses C escape syntax in strings (for example, '\n' to
     represent a newline character), you must double any '\' that you
     use in 'LIKE' strings.  For example, to search for '\n', specify it
     as '\\n'.  To search for '\', specify it as '\\\\'; this is because
     the backslashes are stripped once by the parser and again when the
     pattern match is made, leaving a single backslash to be matched
     against.

     Exception: At the end of the pattern string, backslash can be
     specified as '\\'.  At the end of the string, backslash stands for
     itself because there is nothing following to escape.  Suppose that
     a table contains the following values:

          mysql> SELECT filename FROM t1;
          +--------------+
          | filename     |
          +--------------+
          | C:           |
          | C:\          |
          | C:\Programs  |
          | C:\Programs\ |
          +--------------+

     To test for values that end with backslash, you can match the
     values using either of the following patterns:

          mysql> SELECT filename, filename LIKE '%\\' FROM t1;
          +--------------+---------------------+
          | filename     | filename LIKE '%\\' |
          +--------------+---------------------+
          | C:           |                   0 |
          | C:\          |                   1 |
          | C:\Programs  |                   0 |
          | C:\Programs\ |                   1 |
          +--------------+---------------------+

          mysql> SELECT filename, filename LIKE '%\\\\' FROM t1;
          +--------------+-----------------------+
          | filename     | filename LIKE '%\\\\' |
          +--------------+-----------------------+
          | C:           |                     0 |
          | C:\          |                     1 |
          | C:\Programs  |                     0 |
          | C:\Programs\ |                     1 |
          +--------------+-----------------------+

   * 
     'EXPR NOT LIKE PAT [ESCAPE 'ESCAPE_CHAR']'

     This is the same as 'NOT (EXPR LIKE PAT [ESCAPE 'ESCAPE_CHAR'])'.

     *Note*:

     Aggregate queries involving 'NOT LIKE' comparisons with columns
     containing 'NULL' may yield unexpected results.  For example,
     consider the following table and data:

          CREATE TABLE foo (bar VARCHAR(10));

          INSERT INTO foo VALUES (NULL), (NULL);

     The query 'SELECT COUNT(*) FROM foo WHERE bar LIKE '%baz%';'
     returns '0'.  You might assume that 'SELECT COUNT(*) FROM foo WHERE
     bar NOT LIKE '%baz%';' would return '2'.  However, this is not the
     case: The second query returns '0'.  This is because 'NULL NOT LIKE
     EXPR' always returns 'NULL', regardless of the value of EXPR.  The
     same is true for aggregate queries involving 'NULL' and comparisons
     using 'NOT RLIKE' or 'NOT REGEXP'.  In such cases, you must test
     explicitly for 'NOT NULL' using 'OR' (and not 'AND'), as shown
     here:

          SELECT COUNT(*) FROM foo WHERE bar NOT LIKE '%baz%' OR bar IS NULL;

   * 
     'STRCMP(EXPR1,EXPR2)'

     'STRCMP()' returns '0' if the strings are the same, '-1' if the
     first argument is smaller than the second according to the current
     sort order, and '1' otherwise.

          mysql> SELECT STRCMP('text', 'text2');
                  -> -1
          mysql> SELECT STRCMP('text2', 'text');
                  -> 1
          mysql> SELECT STRCMP('text', 'text');
                  -> 0

     'STRCMP()' performs the comparison using the collation of the
     arguments.

          mysql> SET @s1 = _latin1 'x' COLLATE latin1_general_ci;
          mysql> SET @s2 = _latin1 'X' COLLATE latin1_general_ci;
          mysql> SET @s3 = _latin1 'x' COLLATE latin1_general_cs;
          mysql> SET @s4 = _latin1 'X' COLLATE latin1_general_cs;
          mysql> SELECT STRCMP(@s1, @s2), STRCMP(@s3, @s4);
          +------------------+------------------+
          | STRCMP(@s1, @s2) | STRCMP(@s3, @s4) |
          +------------------+------------------+
          |                0 |                1 |
          +------------------+------------------+

     If the collations are incompatible, one of the arguments must be
     converted to be compatible with the other.  See *note
     charset-collation-coercibility::.


          mysql> SELECT STRCMP(@s1, @s3);
          ERROR 1267 (HY000): Illegal mix of collations (latin1_general_ci,IMPLICIT)
          and (latin1_general_cs,IMPLICIT) for operation 'strcmp'
          mysql> SELECT STRCMP(@s1, @s3 COLLATE latin1_general_ci);
          +--------------------------------------------+
          | STRCMP(@s1, @s3 COLLATE latin1_general_ci) |
          +--------------------------------------------+
          |                                          0 |
          +--------------------------------------------+


File: manual.info.tmp,  Node: regexp,  Next: string-functions-charset,  Prev: string-comparison-functions,  Up: string-functions

12.7.2 Regular Expressions
--------------------------

*Regular Expression Functions and Operators*

Name                          Description
                              
'NOT REGEXP'                  Negation of REGEXP
                              
'REGEXP'                      Whether string matches regular expression
                              
'RLIKE'                       Whether string matches regular expression

A regular expression is a powerful way of specifying a pattern for a
complex search.  This section discusses the operators available for
regular expression matching and illustrates, with examples, some of the
special characters and constructs that can be used for regular
expression operations.  See also *note pattern-matching::.

MySQL uses Henry Spencer's implementation of regular expressions, which
is aimed at conformance with POSIX 1003.2.  MySQL uses the extended
version to support regular expression pattern-matching operations in SQL
statements.  This section does not contain all the details that can be
found in Henry Spencer's 'regex(7)' manual page.  That manual page is
included in MySQL source distributions, in the 'regex.7' file under the
'regex' directory.

   * *note regexp-operators::

   * *note regexp-syntax::

*Regular Expression Operators*

   * 
     'EXPR NOT REGEXP PAT', 'EXPR NOT RLIKE PAT'

     This is the same as 'NOT (EXPR REGEXP PAT)'.

   * 
     'EXPR REGEXP PAT', 'EXPR RLIKE PAT'

     Returns 1 if the string EXPR matches the regular expression
     specified by the pattern PAT, 0 otherwise.  If either EXPR or PAT
     is 'NULL', the return value is 'NULL'.

     'RLIKE' is a synonym for 'REGEXP', provided for 'mSQL'
     compatibility.

     The pattern can be an extended regular expression, the syntax for
     which is discussed in *note regexp-syntax::.  The pattern need not
     be a literal string.  For example, it can be specified as a string
     expression or table column.

     *Note*:

     Because MySQL uses the C escape syntax in strings (for example,
     '\n' to represent the newline character), you must double any '\'
     that you use in your 'REGEXP' arguments.

     Regular expression operations use the character set and collation
     of the string expression and pattern arguments when deciding the
     type of a character and performing the comparison.  If the
     arguments have different character sets or collations, coercibility
     rules apply as described in *note charset-collation-coercibility::.
     If either argument is a binary string, the arguments are handled in
     case-sensitive fashion as binary strings.

          mysql> SELECT 'Michael!' REGEXP '.*';
          +------------------------+
          | 'Michael!' REGEXP '.*' |
          +------------------------+
          |                      1 |
          +------------------------+
          mysql> SELECT 'new*\n*line' REGEXP 'new\\*.\\*line';
          +---------------------------------------+
          | 'new*\n*line' REGEXP 'new\\*.\\*line' |
          +---------------------------------------+
          |                                     0 |
          +---------------------------------------+
          mysql> SELECT 'a' REGEXP '^[a-d]';
          +---------------------+
          | 'a' REGEXP '^[a-d]' |
          +---------------------+
          |                   1 |
          +---------------------+
          mysql> SELECT 'a' REGEXP 'A', 'a' REGEXP BINARY 'A';
          +----------------+-----------------------+
          | 'a' REGEXP 'A' | 'a' REGEXP BINARY 'A' |
          +----------------+-----------------------+
          |              1 |                     0 |
          +----------------+-----------------------+

     *Warning*:

     The 'REGEXP' and 'RLIKE' operators work in byte-wise fashion, so
     they are not multibyte safe and may produce unexpected results with
     multibyte character sets.  In addition, these operators compare
     characters by their byte values and accented characters may not
     compare as equal even if a given collation treats them as equal.

*Regular Expression Syntax*

A regular expression describes a set of strings.  The simplest regular
expression is one that has no special characters in it.  For example,
the regular expression 'hello' matches 'hello' and nothing else.

Nontrivial regular expressions use certain special constructs so that
they can match more than one string.  For example, the regular
expression 'hello|world' contains the '|' alternation operator and
matches either the 'hello' or 'world'.

As a more complex example, the regular expression 'B[an]*s' matches any
of the strings 'Bananas', 'Baaaaas', 'Bs', and any other string starting
with a 'B', ending with an 's', and containing any number of 'a' or 'n'
characters in between.

A regular expression for the 'REGEXP' operator may use any of the
following special characters and constructs:

   * '^'

     Match the beginning of a string.

          mysql> SELECT 'fo\nfo' REGEXP '^fo$';                   -> 0
          mysql> SELECT 'fofo' REGEXP '^fo';                      -> 1

   * '$'

     Match the end of a string.

          mysql> SELECT 'fo\no' REGEXP '^fo\no$';                 -> 1
          mysql> SELECT 'fo\no' REGEXP '^fo$';                    -> 0

   * '.'

     Match any character (including carriage return and newline).

          mysql> SELECT 'fofo' REGEXP '^f.*$';                    -> 1
          mysql> SELECT 'fo\r\nfo' REGEXP '^f.*$';                -> 1

   * 'a*'

     Match any sequence of zero or more 'a' characters.

          mysql> SELECT 'Ban' REGEXP '^Ba*n';                     -> 1
          mysql> SELECT 'Baaan' REGEXP '^Ba*n';                   -> 1
          mysql> SELECT 'Bn' REGEXP '^Ba*n';                      -> 1

   * 'a+'

     Match any sequence of one or more 'a' characters.

          mysql> SELECT 'Ban' REGEXP '^Ba+n';                     -> 1
          mysql> SELECT 'Bn' REGEXP '^Ba+n';                      -> 0

   * 'a?'

     Match either zero or one 'a' character.

          mysql> SELECT 'Bn' REGEXP '^Ba?n';                      -> 1
          mysql> SELECT 'Ban' REGEXP '^Ba?n';                     -> 1
          mysql> SELECT 'Baan' REGEXP '^Ba?n';                    -> 0

   * 'de|abc'

     Alternation; match either of the sequences 'de' or 'abc'.

          mysql> SELECT 'pi' REGEXP 'pi|apa';                     -> 1
          mysql> SELECT 'axe' REGEXP 'pi|apa';                    -> 0
          mysql> SELECT 'apa' REGEXP 'pi|apa';                    -> 1
          mysql> SELECT 'apa' REGEXP '^(pi|apa)$';                -> 1
          mysql> SELECT 'pi' REGEXP '^(pi|apa)$';                 -> 1
          mysql> SELECT 'pix' REGEXP '^(pi|apa)$';                -> 0

   * '(abc)*'

     Match zero or more instances of the sequence 'abc'.

          mysql> SELECT 'pi' REGEXP '^(pi)*$';                    -> 1
          mysql> SELECT 'pip' REGEXP '^(pi)*$';                   -> 0
          mysql> SELECT 'pipi' REGEXP '^(pi)*$';                  -> 1

   * '{1}', '{2,3}'

     Repetition; '{N}' and '{M,N}' notation provide a more general way
     of writing regular expressions that match many occurrences of the
     previous atom (or 'piece') of the pattern.  M and N are integers.

        * 'a*'

          Can be written as 'a{0,}'.

        * 'a+'

          Can be written as 'a{1,}'.

        * 'a?'

          Can be written as 'a{0,1}'.

     To be more precise, 'a{N}' matches exactly N instances of 'a'.
     'a{N,}' matches N or more instances of 'a'.  'a{M,N}' matches M
     through N instances of 'a', inclusive.  If both M and N are given,
     M must be less than or equal to N.

     M and N must be in the range from '0' to 'RE_DUP_MAX' (default
     255), inclusive.

          mysql> SELECT 'abcde' REGEXP 'a[bcd]{2}e';              -> 0
          mysql> SELECT 'abcde' REGEXP 'a[bcd]{3}e';              -> 1
          mysql> SELECT 'abcde' REGEXP 'a[bcd]{1,10}e';           -> 1

   * '[a-dX]', '[^a-dX]'

     Matches any character that is (or is not, if '^' is used) either
     'a', 'b', 'c', 'd' or 'X'.  A '-' character between two other
     characters forms a range that matches all characters from the first
     character to the second.  For example, '[0-9]' matches any decimal
     digit.  To include a literal ']' character, it must immediately
     follow the opening bracket '['.  To include a literal '-'
     character, it must be written first or last.  Any character that
     does not have a defined special meaning inside a '[]' pair matches
     only itself.

          mysql> SELECT 'aXbc' REGEXP '[a-dXYZ]';                 -> 1
          mysql> SELECT 'aXbc' REGEXP '^[a-dXYZ]$';               -> 0
          mysql> SELECT 'aXbc' REGEXP '^[a-dXYZ]+$';              -> 1
          mysql> SELECT 'aXbc' REGEXP '^[^a-dXYZ]+$';             -> 0
          mysql> SELECT 'gheis' REGEXP '^[^a-dXYZ]+$';            -> 1
          mysql> SELECT 'gheisa' REGEXP '^[^a-dXYZ]+$';           -> 0

   * '[.characters.]'

     Within a bracket expression (written using '[' and ']'), matches
     the sequence of characters of that collating element.  'characters'
     is either a single character or a character name like 'newline'.
     The following table lists the permissible character names.

     The following table shows the permissible character names and the
     characters that they match.  For characters given as numeric
     values, the values are represented in octal.

     Name               Character          Name               Character
                                                              
     'NUL'              '0'                'SOH'              '001'
                                                              
     'STX'              '002'              'ETX'              '003'
                                                              
     'EOT'              '004'              'ENQ'              '005'
                                                              
     'ACK'              '006'              'BEL'              '007'
                                                              
     'alert'            '007'              'BS'               '010'
                                                              
     'backspace'        ''\b''             'HT'               '011'
                                                              
     'tab'              ''\t''             'LF'               '012'
                                                              
     'newline'          ''\n''             'VT'               '013'
                                                              
     'vertical-tab'     ''\v''             'FF'               '014'
                                                              
     'form-feed'        ''\f''             'CR'               '015'
                                                              
     'carriage-return'  ''\r''             'SO'               '016'
                                                              
     'SI'               '017'              'DLE'              '020'
                                                              
     'DC1'              '021'              'DC2'              '022'
                                                              
     'DC3'              '023'              'DC4'              '024'
                                                              
     'NAK'              '025'              'SYN'              '026'
                                                              
     'ETB'              '027'              'CAN'              '030'
                                                              
     'EM'               '031'              'SUB'              '032'
                                                              
     'ESC'              '033'              'IS4'              '034'
                                                              
     'FS'               '034'              'IS3'              '035'
                                                              
     'GS'               '035'              'IS2'              '036'
                                                              
     'RS'               '036'              'IS1'              '037'
                                                              
     'US'               '037'              'space'            '' ''
                                                              
     'exclamation-mark' ''!''              'quotation-mark'   ''"''
                                                              
     'number-sign'      ''#''              'dollar-sign'      ''$''
                                                              
     'percent-sign'     ''%''              'ampersand'        ''&''
                                                              
     'apostrophe'       ''\'''             'left-parenthesis' ''(''
                                                              
     'right-parenthesis''')''              'asterisk'         ''*''
                                                              
     'plus-sign'        ''+''              'comma'            '',''
                                                              
     'hyphen'           ''-''              'hyphen-minus'     ''-''
                                                              
     'period'           ''.''              'full-stop'        ''.''
                                                              
     'slash'            ''/''              'solidus'          ''/''
                                                              
     'zero'             ''0''              'one'              ''1''
                                                              
     'two'              ''2''              'three'            ''3''
                                                              
     'four'             ''4''              'five'             ''5''
                                                              
     'six'              ''6''              'seven'            ''7''
                                                              
     'eight'            ''8''              'nine'             ''9''
                                                              
     'colon'            '':''              'semicolon'        '';''
                                                              
     'less-than-sign'   ''<''              'equals-sign'      ''=''
                                                              
     'greater-than-sign'''>''              'question-mark'    ''?''
                                                              
     'commercial-at'    ''@''              'left-square-bracket'''[''
                                                              
     'backslash'        ''\\''             'reverse-solidus'  ''\\''
                                                              
     'right-square-bracket''']''           'circumflex'       ''^''
                                                              
     'circumflex-accent'''^''              'underscore'       ''_''
                                                              
     'low-line'         ''_''              'grave-accent'     ''`''
                                                              
     'left-brace'       ''{''              'left-curly-bracket'''{''
                                                              
     'vertical-line'    ''|''              'right-brace'      ''}''
                                                              
     'right-curly-bracket'''}''            'tilde'            ''~''
                                                              
     'DEL'              '177'              
                        

          mysql> SELECT '~' REGEXP '[[.~.]]';                     -> 1
          mysql> SELECT '~' REGEXP '[[.tilde.]]';                 -> 1

   * '[=character_class=]'

     Within a bracket expression (written using '[' and ']'),
     '[=character_class=]' represents an equivalence class.  It matches
     all characters with the same collation value, including itself.
     For example, if 'o' and '(+)' are the members of an equivalence
     class, '[[=o=]]', '[[=(+)=]]', and '[o(+)]' are all synonymous.  An
     equivalence class may not be used as an endpoint of a range.

   * '[:character_class:]'

     Within a bracket expression (written using '[' and ']'),
     '[:character_class:]' represents a character class that matches all
     characters belonging to that class.  The following table lists the
     standard class names.  These names stand for the character classes
     defined in the 'ctype(3)' manual page.  A particular locale may
     provide other class names.  A character class may not be used as an
     endpoint of a range.

     Character      Meaning
     Class Name     

     'alnum'        Alphanumeric characters
                    
     'alpha'        Alphabetic characters
                    
     'blank'        Whitespace characters
                    
     'cntrl'        Control characters
                    
     'digit'        Digit characters
                    
     'graph'        Graphic characters
                    
     'lower'        Lowercase alphabetic characters
                    
     'print'        Graphic or space characters
                    
     'punct'        Punctuation characters
                    
     'space'        Space, tab, newline, and carriage return
                    
     'upper'        Uppercase alphabetic characters
                    
     'xdigit'       Hexadecimal digit characters

          mysql> SELECT 'justalnums' REGEXP '[[:alnum:]]+';       -> 1
          mysql> SELECT '!!' REGEXP '[[:alnum:]]+';               -> 0

   * '[[:<:]]', '[[:>:]]'

     These markers stand for word boundaries.  They match the beginning
     and end of words, respectively.  A word is a sequence of word
     characters that is not preceded by or followed by word characters.
     A word character is an alphanumeric character in the 'alnum' class
     or an underscore ('_').

          mysql> SELECT 'a word a' REGEXP '[[:<:]]word[[:>:]]';   -> 1
          mysql> SELECT 'a xword a' REGEXP '[[:<:]]word[[:>:]]';  -> 0

To use a literal instance of a special character in a regular
expression, precede it by two backslash (\) characters.  The MySQL
parser interprets one of the backslashes, and the regular expression
library interprets the other.  For example, to match the string '1+2'
that contains the special '+' character, only the last of the following
regular expressions is the correct one:

     mysql> SELECT '1+2' REGEXP '1+2';                       -> 0
     mysql> SELECT '1+2' REGEXP '1\+2';                      -> 0
     mysql> SELECT '1+2' REGEXP '1\\+2';                     -> 1


File: manual.info.tmp,  Node: string-functions-charset,  Prev: regexp,  Up: string-functions

12.7.3 Character Set and Collation of Function Results
------------------------------------------------------

MySQL has many operators and functions that return a string.  This
section answers the question: What is the character set and collation of
such a string?

For simple functions that take string input and return a string result
as output, the output's character set and collation are the same as
those of the principal input value.  For example, 'UPPER(X)' returns a
string with the same character string and collation as X.  The same
applies for 'INSTR()', 'LCASE()', 'LOWER()', 'LTRIM()', 'MID()',
'REPEAT()', 'REPLACE()', 'REVERSE()', 'RIGHT()', 'RPAD()', 'RTRIM()',
'SOUNDEX()', 'SUBSTRING()', 'TRIM()', 'UCASE()', and 'UPPER()'.

*Note*:

The 'REPLACE()' function, unlike all other functions, always ignores the
collation of the string input and performs a case-sensitive comparison.

If a string input or function result is a binary string, the string has
the 'binary' character set and collation.  This can be checked by using
the 'CHARSET()' and 'COLLATION()' functions, both of which return
'binary' for a binary string argument:

     mysql> SELECT CHARSET(BINARY 'a'), COLLATION(BINARY 'a');
     +---------------------+-----------------------+
     | CHARSET(BINARY 'a') | COLLATION(BINARY 'a') |
     +---------------------+-----------------------+
     | binary              | binary                |
     +---------------------+-----------------------+

For operations that combine multiple string inputs and return a single
string output, the 'aggregation rules' of standard SQL apply for
determining the collation of the result:

   * If an explicit 'COLLATE Y' occurs, use Y.

   * If explicit 'COLLATE Y' and 'COLLATE Z' occur, raise an error.

   * Otherwise, if all collations are Y, use Y.

   * Otherwise, the result has no collation.

For example, with 'CASE ... WHEN a THEN b WHEN b THEN c COLLATE X END',
the resulting collation is X.  The same applies for *note 'UNION':
union, '||', 'CONCAT()', 'ELT()', 'GREATEST()', 'IF()', and 'LEAST()'.

For operations that convert to character data, the character set and
collation of the strings that result from the operations are defined by
the 'character_set_connection' and 'collation_connection' system
variables that determine the default connection character set and
collation (see *note charset-connection::).  This applies only to
'CAST()', 'CONV()', 'FORMAT()', 'HEX()', and 'SPACE()'.

If there is any question about the character set or collation of the
result returned by a string function, use the 'CHARSET()' or
'COLLATION()' function to find out:

     mysql> SELECT USER(), CHARSET(USER()), COLLATION(USER());
     +----------------+-----------------+-------------------+
     | USER()         | CHARSET(USER()) | COLLATION(USER()) |
     +----------------+-----------------+-------------------+
     | test@localhost | utf8            | utf8_general_ci   |
     +----------------+-----------------+-------------------+
     mysql> SELECT CHARSET(COMPRESS('abc')), COLLATION(COMPRESS('abc'));
     +--------------------------+----------------------------+
     | CHARSET(COMPRESS('abc')) | COLLATION(COMPRESS('abc')) |
     +--------------------------+----------------------------+
     | binary                   | binary                     |
     +--------------------------+----------------------------+


File: manual.info.tmp,  Node: mysql-calendar,  Next: fulltext-search,  Prev: string-functions,  Up: functions

12.8 What Calendar Is Used By MySQL?
====================================

MySQL uses what is known as a _proleptic Gregorian calendar_.

Every country that has switched from the Julian to the Gregorian
calendar has had to discard at least ten days during the switch.  To see
how this works, consider the month of October 1582, when the first
Julian-to-Gregorian switch occurred.

Monday     Tuesday    Wednesday  Thursday   Friday     Saturday   Sunday
                                                                  
1          2          3          4          15         16         17
                                                                  
18         19         20         21         22         23         24
                                                                  
25         26         27         28         29         30         31
                                                       

There are no dates between October 4 and October 15.  This discontinuity
is called the _cutover_.  Any dates before the cutover are Julian, and
any dates following the cutover are Gregorian.  Dates during a cutover
are nonexistent.

A calendar applied to dates when it was not actually in use is called
_proleptic_.  Thus, if we assume there was never a cutover and Gregorian
rules always rule, we have a proleptic Gregorian calendar.  This is what
is used by MySQL, as is required by standard SQL. For this reason, dates
prior to the cutover stored as MySQL *note 'DATE': datetime. or *note
'DATETIME': datetime. values must be adjusted to compensate for the
difference.  It is important to realize that the cutover did not occur
at the same time in all countries, and that the later it happened, the
more days were lost.  For example, in Great Britain, it took place in
1752, when Wednesday September 2 was followed by Thursday September 14.
Russia remained on the Julian calendar until 1918, losing 13 days in the
process, and what is popularly referred to as its 'October Revolution'
occurred in November according to the Gregorian calendar.


File: manual.info.tmp,  Node: fulltext-search,  Next: cast-functions,  Prev: mysql-calendar,  Up: functions

12.9 Full-Text Search Functions
===============================

* Menu:

* fulltext-natural-language::    Natural Language Full-Text Searches
* fulltext-boolean::             Boolean Full-Text Searches
* fulltext-query-expansion::     Full-Text Searches with Query Expansion
* fulltext-stopwords::           Full-Text Stopwords
* fulltext-restrictions::        Full-Text Restrictions
* fulltext-fine-tuning::         Fine-Tuning MySQL Full-Text Search
* full-text-adding-collation::   Adding a Collation for Full-Text Indexing

'MATCH (COL1,COL2,...) AGAINST (EXPR [SEARCH_MODIFIER])'

     SEARCH_MODIFIER:
       {
            IN NATURAL LANGUAGE MODE
          | IN NATURAL LANGUAGE MODE WITH QUERY EXPANSION
          | IN BOOLEAN MODE
          | WITH QUERY EXPANSION
       }

MySQL has support for full-text indexing and searching:

   * A full-text index in MySQL is an index of type 'FULLTEXT'.

   * Full-text indexes can be used only with 'MyISAM' tables.  (In MySQL
     5.6 and up, they can also be used with 'InnoDB' tables.)  Full-text
     indexes can be created only for *note 'CHAR': char, *note
     'VARCHAR': char, or *note 'TEXT': blob. columns.

   * A 'FULLTEXT' index definition can be given in the *note 'CREATE
     TABLE': create-table. statement when a table is created, or added
     later using *note 'ALTER TABLE': alter-table. or *note 'CREATE
     INDEX': create-index.

   * For large data sets, it is much faster to load your data into a
     table that has no 'FULLTEXT' index and then create the index after
     that, than to load data into a table that has an existing
     'FULLTEXT' index.

Full-text searching is performed using 'MATCH() ... AGAINST' syntax.
'MATCH()' takes a comma-separated list that names the columns to be
searched.  'AGAINST' takes a string to search for, and an optional
modifier that indicates what type of search to perform.  The search
string must be a string value that is constant during query evaluation.
This rules out, for example, a table column because that can differ for
each row.

There are three types of full-text searches:

   * A natural language search interprets the search string as a phrase
     in natural human language (a phrase in free text).  There are no
     special operators, with the exception of double quote (")
     characters.  The stopword list applies.  In addition, words that
     are present in 50% or more of the rows are considered common and do
     not match.

     Full-text searches are natural language searches if the 'IN NATURAL
     LANGUAGE MODE' modifier is given or if no modifier is given.  For
     more information, see *note fulltext-natural-language::.

   * A boolean search interprets the search string using the rules of a
     special query language.  The string contains the words to search
     for.  It can also contain operators that specify requirements such
     that a word must be present or absent in matching rows, or that it
     should be weighted higher or lower than usual.  Common words such
     as 'some' or 'then' are stopwords and do not match if present in
     the search string.  The 'IN BOOLEAN MODE' modifier specifies a
     boolean search.  For more information, see *note
     fulltext-boolean::.

   * A query expansion search is a modification of a natural language
     search.  The search string is used to perform a natural language
     search.  Then words from the most relevant rows returned by the
     search are added to the search string and the search is done again.
     The query returns the rows from the second search.  The 'IN NATURAL
     LANGUAGE MODE WITH QUERY EXPANSION' or 'WITH QUERY EXPANSION'
     modifier specifies a query expansion search.  For more information,
     see *note fulltext-query-expansion::.

Constraints on full-text searching are listed in *note
fulltext-restrictions::.

The *note 'myisam_ftdump': myisam-ftdump. utility can be used to dump
the contents of a full-text index.  This may be helpful for debugging
full-text queries.  See *note myisam-ftdump::.


File: manual.info.tmp,  Node: fulltext-natural-language,  Next: fulltext-boolean,  Prev: fulltext-search,  Up: fulltext-search

12.9.1 Natural Language Full-Text Searches
------------------------------------------

By default or with the 'IN NATURAL LANGUAGE MODE' modifier, the
'MATCH()' function performs a natural language search for a string
against a _text collection_.  A collection is a set of one or more
columns included in a 'FULLTEXT' index.  The search string is given as
the argument to 'AGAINST()'.  For each row in the table, 'MATCH()'
returns a relevance value; that is, a similarity measure between the
search string and the text in that row in the columns named in the
'MATCH()' list.

     mysql> CREATE TABLE articles (
               id INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,
               title VARCHAR(200),
               body TEXT,
               FULLTEXT (title,body)
             ) ENGINE=InnoDB;
     Query OK, 0 rows affected (0.08 sec)

     mysql> INSERT INTO articles (title,body) VALUES
             ('MySQL Tutorial','DBMS stands for DataBase ...'),
             ('How To Use MySQL Well','After you went through a ...'),
             ('Optimizing MySQL','In this tutorial we will show ...'),
             ('1001 MySQL Tricks','1. Never run mysqld as root. 2. ...'),
             ('MySQL vs. YourSQL','In the following database comparison ...'),
             ('MySQL Security','When configured properly, MySQL ...');
     Query OK, 6 rows affected (0.01 sec)
     Records: 6  Duplicates: 0  Warnings: 0

     mysql> SELECT * FROM articles
             WHERE MATCH (title,body)
             AGAINST ('database' IN NATURAL LANGUAGE MODE);
     +----+-------------------+------------------------------------------+
     | id | title             | body                                     |
     +----+-------------------+------------------------------------------+
     |  1 | MySQL Tutorial    | DBMS stands for DataBase ...             |
     |  5 | MySQL vs. YourSQL | In the following database comparison ... |
     +----+-------------------+------------------------------------------+
     2 rows in set (0.00 sec)

By default, the search is performed in case-insensitive fashion.
However, you can perform a case-sensitive full-text search by using a
binary collation for the indexed columns.  For example, a column that
uses the 'latin1' character set of can be assigned a collation of
'latin1_bin' to make it case-sensitive for full-text searches.

When 'MATCH()' is used in a 'WHERE' clause, as in the example shown
earlier, the rows returned are automatically sorted with the highest
relevance first.  Relevance values are nonnegative floating-point
numbers.  Zero relevance means no similarity.  Relevance is computed
based on the number of words in the row (document), the number of unique
words in the row, the total number of words in the collection, and the
number of rows that contain a particular word.

*Note*:

The term 'document' may be used interchangeably with the term 'row', and
both terms refer to the indexed part of the row.  The term 'collection'
refers to the indexed columns and encompasses all rows.

To simply count matches, you could use a query like this:

     mysql> SELECT COUNT(*) FROM articles
         -> WHERE MATCH (title,body)
         -> AGAINST ('database' IN NATURAL LANGUAGE MODE);
     +----------+
     | COUNT(*) |
     +----------+
     |        2 |
     +----------+
     1 row in set (0.00 sec)

However, you might find it quicker to rewrite the query as follows:

     mysql> SELECT
         -> COUNT(IF(MATCH (title,body) AGAINST ('database' IN NATURAL LANGUAGE MODE), 1, NULL))
         -> AS count
         -> FROM articles;
     +-------+
     | count |
     +-------+
     |     2 |
     +-------+
     1 row in set (0.03 sec)

The first query sorts the results by relevance whereas the second does
not.  However, the second query performs a full table scan and the first
does not.  The first may be faster if the search matches few rows;
otherwise, the second may be faster because it would read many rows
anyway.

For natural-language full-text searches, it is a requirement that the
columns named in the 'MATCH()' function be the same columns included in
some 'FULLTEXT' index in your table.  For the preceding query, note that
the columns named in the 'MATCH()' function ('title' and 'body') are the
same as those named in the definition of the 'article' table's
'FULLTEXT' index.  If you wanted to search the 'title' or 'body'
separately, you would need to create separate 'FULLTEXT' indexes for
each column.

It is also possible to perform a boolean search or a search with query
expansion.  These search types are described in *note
fulltext-boolean::, and *note fulltext-query-expansion::.

A full-text search that uses an index can name columns only from a
single table in the 'MATCH()' clause because an index cannot span
multiple tables.  A boolean search can be done in the absence of an
index (albeit more slowly), in which case it is possible to name columns
from multiple tables.

The preceding example is a basic illustration that shows how to use the
'MATCH()' function where rows are returned in order of decreasing
relevance.  The next example shows how to retrieve the relevance values
explicitly.  Returned rows are not ordered because the *note 'SELECT':
select. statement includes neither 'WHERE' nor 'ORDER BY' clauses:

     mysql> SELECT id, MATCH (title,body)
         -> AGAINST ('Tutorial' IN NATURAL LANGUAGE MODE) AS score
         -> FROM articles;
     +----+------------------+
     | id | score            |
     +----+------------------+
     |  1 | 0.65545833110809 |
     |  2 |                0 |
     |  3 | 0.66266459226608 |
     |  4 |                0 |
     |  5 |                0 |
     |  6 |                0 |
     +----+------------------+
     6 rows in set (0.00 sec)

The following example is more complex.  The query returns the relevance
values and it also sorts the rows in order of decreasing relevance.  To
achieve this result, specify 'MATCH()' twice: once in the *note
'SELECT': select. list and once in the 'WHERE' clause.  This causes no
additional overhead, because the MySQL optimizer notices that the two
'MATCH()' calls are identical and invokes the full-text search code only
once.

     mysql> SELECT id, body, MATCH (title,body) AGAINST
         -> ('Security implications of running MySQL as root'
         -> IN NATURAL LANGUAGE MODE) AS score
         -> FROM articles WHERE MATCH (title,body) AGAINST
         -> ('Security implications of running MySQL as root'
         -> IN NATURAL LANGUAGE MODE);
     +----+-------------------------------------+-----------------+
     | id | body                                | score           |
     +----+-------------------------------------+-----------------+
     |  4 | 1. Never run mysqld as root. 2. ... | 1.5219271183014 |
     |  6 | When configured properly, MySQL ... | 1.3114095926285 |
     +----+-------------------------------------+-----------------+
     2 rows in set (0.00 sec)

A phrase that is enclosed within double quote ('"') characters matches
only rows that contain the phrase _literally, as it was typed_.  The
full-text engine splits the phrase into words and performs a search in
the 'FULLTEXT' index for the words.  Nonword characters need not be
matched exactly: Phrase searching requires only that matches contain
exactly the same words as the phrase and in the same order.  For
example, '"test phrase"' matches '"test, phrase"'.  If the phrase
contains no words that are in the index, the result is empty.  For
example, if all words are either stopwords or shorter than the minimum
length of indexed words, the result is empty.

The MySQL 'FULLTEXT' implementation regards any sequence of true word
characters (letters, digits, and underscores) as a word.  That sequence
may also contain apostrophes ('''), but not more than one in a row.
This means that 'aaa'bbb' is regarded as one word, but 'aaa''bbb' is
regarded as two words.  Apostrophes at the beginning or the end of a
word are stripped by the 'FULLTEXT' parser; ''aaa'bbb'' would be parsed
as 'aaa'bbb'.

The 'FULLTEXT' parser determines where words start and end by looking
for certain delimiter characters; for example, ' ' (space), ',' (comma),
and '.' (period).  If words are not separated by delimiters (as in, for
example, Chinese), the 'FULLTEXT' parser cannot determine where a word
begins or ends.  To be able to add words or other indexed terms in such
languages to a 'FULLTEXT' index, you must preprocess them so that they
are separated by some arbitrary delimiter.

It is possible to write a plugin that replaces the built-in full-text
parser.  For details, see *note plugin-api::.  For example parser plugin
source code, see the 'plugin/fulltext' directory of a MySQL source
distribution.

Some words are ignored in full-text searches:

   * Any word that is too short is ignored.  The default minimum length
     of words that are found by full-text searches is four characters.

   * Words in the stopword list are ignored.  A stopword is a word such
     as 'the' or 'some' that is so common that it is considered to have
     zero semantic value.  There is a built-in stopword list, but it can
     be overwritten by a user-defined list.

The default stopword list is given in *note fulltext-stopwords::.  The
default minimum word length and stopword list can be changed as
described in *note fulltext-fine-tuning::.

Every correct word in the collection and in the query is weighted
according to its significance in the collection or query.  Consequently,
a word that is present in many documents has a lower weight (and may
even have a zero weight), because it has lower semantic value in this
particular collection.  Conversely, if the word is rare, it receives a
higher weight.  The weights of the words are combined to compute the
relevance of the row.

Such a technique works best with large collections (in fact, it was
carefully tuned this way).  For very small tables, word distribution
does not adequately reflect their semantic value, and this model may
sometimes produce bizarre results.  For example, although the word
'MySQL' is present in every row of the 'articles' table shown earlier, a
search for the word produces no results:

     mysql> SELECT * FROM articles
         -> WHERE MATCH (title,body)
         -> AGAINST ('MySQL' IN NATURAL LANGUAGE MODE);
     Empty set (0.00 sec)

The search result is empty because the word 'MySQL' is present in at
least 50% of the rows.  As such, it is effectively treated as a
stopword.  For large data sets, this is the most desirable behavior: A
natural language query should not return every second row from a 1GB
table.  For small data sets, it may be less desirable.

A word that matches half of the rows in a table is less likely to locate
relevant documents.  In fact, it most likely finds plenty of irrelevant
documents.  We all know this happens far too often when we are trying to
find something on the Internet with a search engine.  It is with this
reasoning that rows containing the word are assigned a low semantic
value for _the particular data set in which they occur_.  A given word
may reach the 50% threshold in one data set but not another.

The 50% threshold has a significant implication when you first try
full-text searching to see how it works: If you create a table and
insert only one or two rows of text into it, every word in the text
occurs in at least 50% of the rows.  As a result, no search returns any
results.  Be sure to insert at least three rows, and preferably many
more.  Users who need to bypass the 50% limitation can use the boolean
search mode; see *note fulltext-boolean::.


File: manual.info.tmp,  Node: fulltext-boolean,  Next: fulltext-query-expansion,  Prev: fulltext-natural-language,  Up: fulltext-search

12.9.2 Boolean Full-Text Searches
---------------------------------

MySQL can perform boolean full-text searches using the 'IN BOOLEAN MODE'
modifier.  With this modifier, certain characters have special meaning
at the beginning or end of words in the search string.  In the following
query, the '+' and '-' operators indicate that a word is required to be
present or absent, respectively, for a match to occur.  Thus, the query
retrieves all the rows that contain the word 'MySQL' but that do _not_
contain the word 'YourSQL':

     mysql> SELECT * FROM articles WHERE MATCH (title,body)
         -> AGAINST ('+MySQL -YourSQL' IN BOOLEAN MODE);
     +----+-----------------------+-------------------------------------+
     | id | title                 | body                                |
     +----+-----------------------+-------------------------------------+
     |  1 | MySQL Tutorial        | DBMS stands for DataBase ...        |
     |  2 | How To Use MySQL Well | After you went through a ...        |
     |  3 | Optimizing MySQL      | In this tutorial we will show ...   |
     |  4 | 1001 MySQL Tricks     | 1. Never run mysqld as root. 2. ... |
     |  6 | MySQL Security        | When configured properly, MySQL ... |
     +----+-----------------------+-------------------------------------+

*Note*:

In implementing this feature, MySQL uses what is sometimes referred to
as _implied Boolean logic_, in which

   * '+' stands for 'AND'

   * '-' stands for 'NOT'

   * [_no operator_] implies 'OR'

Boolean full-text searches have these characteristics:

   * They do not use the 50% threshold.

   * They do not automatically sort rows in order of decreasing
     relevance.  You can see this from the preceding query result: The
     row with the highest relevance is the one that contains 'MySQL'
     twice, but it is listed last, not first.

   * They can work even without a 'FULLTEXT' index, although a search
     executed in this fashion would be quite slow.

   * The minimum and maximum word length full-text parameters apply.

   * The stopword list applies.

The boolean full-text search capability supports the following
operators:

   * '+'

     A leading plus sign indicates that this word _must_ be present in
     each row that is returned.

   * '-'

     A leading minus sign indicates that this word must _not_ be present
     in any of the rows that are returned.

     Note: The '-' operator acts only to exclude rows that are otherwise
     matched by other search terms.  Thus, a boolean-mode search that
     contains only terms preceded by '-' returns an empty result.  It
     does not return 'all rows except those containing any of the
     excluded terms.'

   * (no operator)

     By default (when neither '+' nor '-' is specified) the word is
     optional, but the rows that contain it are rated higher.  This
     mimics the behavior of 'MATCH() ... AGAINST()' without the 'IN
     BOOLEAN MODE' modifier.

   * '> <'

     These two operators are used to change a word's contribution to the
     relevance value that is assigned to a row.  The '>' operator
     increases the contribution and the '<' operator decreases it.  See
     the example following this list.

   * '( )'

     Parentheses group words into subexpressions.  Parenthesized groups
     can be nested.

   * '~'

     A leading tilde acts as a negation operator, causing the word's
     contribution to the row's relevance to be negative.  This is useful
     for marking 'noise' words.  A row containing such a word is rated
     lower than others, but is not excluded altogether, as it would be
     with the '-' operator.

   * '*'

     The asterisk serves as the truncation (or wildcard) operator.
     Unlike the other operators, it should be _appended_ to the word to
     be affected.  Words match if they begin with the word preceding the
     '*' operator.

     If a word is specified with the truncation operator, it is not
     stripped from a boolean query, even if it is too short (as
     determined from the 'ft_min_word_len' setting) or a stopword.  This
     occurs because the word is not seen as too short or a stopword, but
     as a prefix that must be present in the document in the form of a
     word that begins with the prefix.  Suppose that
     'ft_min_word_len=4'.  Then a search for ''+WORD +the*'' will likely
     return fewer rows than a search for ''+WORD +the'':

        * The former query remains as is and requires both WORD and
          'the*' (a word starting with 'the') to be present in the
          document.

        * The latter query is transformed to '+WORD' (requiring only
          WORD to be present).  'the' is both too short and a stopword,
          and either condition is enough to cause it to be ignored.

   * '"'

     A phrase that is enclosed within double quote ('"') characters
     matches only rows that contain the phrase _literally, as it was
     typed_.  The full-text engine splits the phrase into words and
     performs a search in the 'FULLTEXT' index for the words.  Nonword
     characters need not be matched exactly: Phrase searching requires
     only that matches contain exactly the same words as the phrase and
     in the same order.  For example, '"test phrase"' matches '"test,
     phrase"'.

     If the phrase contains no words that are in the index, the result
     is empty.  For example, if all words are either stopwords or
     shorter than the minimum length of indexed words, the result is
     empty.

The following examples demonstrate some search strings that use boolean
full-text operators:

   * ''apple banana''

     Find rows that contain at least one of the two words.

   * ''+apple +juice''

     Find rows that contain both words.

   * ''+apple macintosh''

     Find rows that contain the word 'apple', but rank rows higher if
     they also contain 'macintosh'.

   * ''+apple -macintosh''

     Find rows that contain the word 'apple' but not 'macintosh'.

   * ''+apple ~macintosh''

     Find rows that contain the word 'apple', but if the row also
     contains the word 'macintosh', rate it lower than if row does not.
     This is 'softer' than a search for ''+apple -macintosh'', for which
     the presence of 'macintosh' causes the row not to be returned at
     all.

   * ''+apple +(>turnover <strudel)''

     Find rows that contain the words 'apple' and 'turnover', or 'apple'
     and 'strudel' (in any order), but rank 'apple turnover' higher than
     'apple strudel'.

   * ''apple*''

     Find rows that contain words such as 'apple', 'apples',
     'applesauce', or 'applet'.

   * ''"some words"''

     Find rows that contain the exact phrase 'some words' (for example,
     rows that contain 'some words of wisdom' but not 'some noise
     words').  Note that the '"' characters that enclose the phrase are
     operator characters that delimit the phrase.  They are not the
     quotation marks that enclose the search string itself.


File: manual.info.tmp,  Node: fulltext-query-expansion,  Next: fulltext-stopwords,  Prev: fulltext-boolean,  Up: fulltext-search

12.9.3 Full-Text Searches with Query Expansion
----------------------------------------------

Full-text search supports query expansion (and in particular, its
variant 'blind query expansion').  This is generally useful when a
search phrase is too short, which often means that the user is relying
on implied knowledge that the full-text search engine lacks.  For
example, a user searching for 'database' may really mean that 'MySQL',
'Oracle', 'DB2', and 'RDBMS' all are phrases that should match
'databases' and should be returned, too.  This is implied knowledge.

Blind query expansion (also known as automatic relevance feedback) is
enabled by adding 'WITH QUERY EXPANSION' or 'IN NATURAL LANGUAGE MODE
WITH QUERY EXPANSION' following the search phrase.  It works by
performing the search twice, where the search phrase for the second
search is the original search phrase concatenated with the few most
highly relevant documents from the first search.  Thus, if one of these
documents contains the word 'databases' and the word 'MySQL', the second
search finds the documents that contain the word 'MySQL' even if they do
not contain the word 'database'.  The following example shows this
difference:

     mysql> SELECT * FROM articles
         -> WHERE MATCH (title,body)
         -> AGAINST ('database' IN NATURAL LANGUAGE MODE);
     +----+-------------------+------------------------------------------+
     | id | title             | body                                     |
     +----+-------------------+------------------------------------------+
     |  5 | MySQL vs. YourSQL | In the following database comparison ... |
     |  1 | MySQL Tutorial    | DBMS stands for DataBase ...             |
     +----+-------------------+------------------------------------------+
     2 rows in set (0.00 sec)

     mysql> SELECT * FROM articles
         -> WHERE MATCH (title,body)
         -> AGAINST ('database' WITH QUERY EXPANSION);
     +----+-------------------+------------------------------------------+
     | id | title             | body                                     |
     +----+-------------------+------------------------------------------+
     |  1 | MySQL Tutorial    | DBMS stands for DataBase ...             |
     |  5 | MySQL vs. YourSQL | In the following database comparison ... |
     |  3 | Optimizing MySQL  | In this tutorial we will show ...        |
     +----+-------------------+------------------------------------------+
     3 rows in set (0.00 sec)

Another example could be searching for books by Georges Simenon about
Maigret, when a user is not sure how to spell 'Maigret'.  A search for
'Megre and the reluctant witnesses' finds only 'Maigret and the
Reluctant Witnesses' without query expansion.  A search with query
expansion finds all books with the word 'Maigret' on the second pass.

*Note*:

Because blind query expansion tends to increase noise significantly by
returning nonrelevant documents, it is meaningful to use only when a
search phrase is rather short.


File: manual.info.tmp,  Node: fulltext-stopwords,  Next: fulltext-restrictions,  Prev: fulltext-query-expansion,  Up: fulltext-search

12.9.4 Full-Text Stopwords
--------------------------

The stopword list is loaded and searched for full-text queries using the
server character set and collation (the values of the
'character_set_server' and 'collation_server' system variables).  False
hits or misses may occur for stopword lookups if the stopword file or
columns used for full-text indexing or searches have a character set or
collation different from 'character_set_server' or 'collation_server'.

Case sensitivity of stopword lookups depends on the server collation.
For example, lookups are case-insensitive if the collation is
'latin1_swedish_ci', whereas lookups are case-sensitive if the collation
is 'latin1_general_cs' or 'latin1_bin'.

The stopword file is loaded and searched using 'latin1' if
'character_set_server' is 'ucs2', 'utf16', or 'utf32'.

The following list shows the default full-text stopwords.  In a MySQL
source distribution, you can find this list in the
'storage/myisam/ft_static.c' file.

     a's           able          about         above         according
     accordingly   across        actually      after         afterwards
     again         against       ain't         all           allow
     allows        almost        alone         along         already
     also          although      always        am            among
     amongst       an            and           another       any
     anybody       anyhow        anyone        anything      anyway
     anyways       anywhere      apart         appear        appreciate
     appropriate   are           aren't        around        as
     aside         ask           asking        associated    at
     available     away          awfully       be            became
     because       become        becomes       becoming      been
     before        beforehand    behind        being         believe
     below         beside        besides       best          better
     between       beyond        both          brief         but
     by            c'mon         c's           came          can
     can't         cannot        cant          cause         causes
     certain       certainly     changes       clearly       co
     com           come          comes         concerning    consequently
     consider      considering   contain       containing    contains
     corresponding could         couldn't      course        currently
     definitely    described     despite       did           didn't
     different     do            does          doesn't       doing
     don't         done          down          downwards     during
     each          edu           eg            eight         either
     else          elsewhere     enough        entirely      especially
     et            etc           even          ever          every
     everybody     everyone      everything    everywhere    ex
     exactly       example       except        far           few
     fifth         first         five          followed      following
     follows       for           former        formerly      forth
     four          from          further       furthermore   get
     gets          getting       given         gives         go
     goes          going         gone          got           gotten
     greetings     had           hadn't        happens       hardly
     has           hasn't        have          haven't       having
     he            he's          hello         help          hence
     her           here          here's        hereafter     hereby
     herein        hereupon      hers          herself       hi
     him           himself       his           hither        hopefully
     how           howbeit       however       i'd           i'll
     i'm           i've          ie            if            ignored
     immediate     in            inasmuch      inc           indeed
     indicate      indicated     indicates     inner         insofar
     instead       into          inward        is            isn't
     it            it'd          it'll         it's          its
     itself        just          keep          keeps         kept
     know          known         knows         last          lately
     later         latter        latterly      least         less
     lest          let           let's         like          liked
     likely        little        look          looking       looks
     ltd           mainly        many          may           maybe
     me            mean          meanwhile     merely        might
     more          moreover      most          mostly        much
     must          my            myself        name          namely
     nd            near          nearly        necessary     need
     needs         neither       never         nevertheless  new
     next          nine          no            nobody        non
     none          noone         nor           normally      not
     nothing       novel         now           nowhere       obviously
     of            off           often         oh            ok
     okay          old           on            once          one
     ones          only          onto          or            other
     others        otherwise     ought         our           ours
     ourselves     out           outside       over          overall
     own           particular    particularly  per           perhaps
     placed        please        plus          possible      presumably
     probably      provides      que           quite         qv
     rather        rd            re            really        reasonably
     regarding     regardless    regards       relatively    respectively
     right         said          same          saw           say
     saying        says          second        secondly      see
     seeing        seem          seemed        seeming       seems
     seen          self          selves        sensible      sent
     serious       seriously     seven         several       shall
     she           should        shouldn't     since         six
     so            some          somebody      somehow       someone
     something     sometime      sometimes     somewhat      somewhere
     soon          sorry         specified     specify       specifying
     still         sub           such          sup           sure
     t's           take          taken         tell          tends
     th            than          thank         thanks        thanx
     that          that's        thats         the           their
     theirs        them          themselves    then          thence
     there         there's       thereafter    thereby       therefore
     therein       theres        thereupon     these         they
     they'd        they'll       they're       they've       think
     third         this          thorough      thoroughly    those
     though        three         through       throughout    thru
     thus          to            together      too           took
     toward        towards       tried         tries         truly
     try           trying        twice         two           un
     under         unfortunately unless        unlikely      until
     unto          up            upon          us            use
     used          useful        uses          using         usually
     value         various       very          via           viz
     vs            want          wants         was           wasn't
     way           we            we'd          we'll         we're
     we've         welcome       well          went          were
     weren't       what          what's        whatever      when
     whence        whenever      where         where's       whereafter
     whereas       whereby       wherein       whereupon     wherever
     whether       which         while         whither       who
     who's         whoever       whole         whom          whose
     why           will          willing       wish          with
     within        without       won't         wonder        would
     wouldn't      yes           yet           you           you'd
     you'll        you're        you've        your          yours
     yourself      yourselves    zero


File: manual.info.tmp,  Node: fulltext-restrictions,  Next: fulltext-fine-tuning,  Prev: fulltext-stopwords,  Up: fulltext-search

12.9.5 Full-Text Restrictions
-----------------------------

   * Full-text searches are supported for 'MyISAM' tables only.  (In
     MySQL 5.6 and up, they can also be used with 'InnoDB' tables.)

   * Full-text searches are not supported for partitioned tables.  See
     *note partitioning-limitations::.

   * Full-text searches can be used with most multibyte character sets.
     The exception is that for Unicode, the 'utf8' character set can be
     used, but not the 'ucs2' character set.  However, although
     'FULLTEXT' indexes on 'ucs2' columns cannot be used, you can
     perform 'IN BOOLEAN MODE' searches on a 'ucs2' column that has no
     such index.

     The remarks for 'utf8' also apply to 'utf8mb4', and the remarks for
     'ucs2' also apply to 'utf16' and 'utf32'.

   * Ideographic languages such as Chinese and Japanese do not have word
     delimiters.  Therefore, the 'FULLTEXT' parser _cannot determine
     where words begin and end in these and other such languages_.  The
     implications of this and some workarounds for the problem are
     described in *note fulltext-search::.

   * Although the use of multiple character sets within a single table
     is supported, all columns in a 'FULLTEXT' index must use the same
     character set and collation.

   * The 'MATCH()' column list must match exactly the column list in
     some 'FULLTEXT' index definition for the table, unless this
     'MATCH()' is 'IN BOOLEAN MODE'.  Boolean-mode searches can be done
     on nonindexed columns, although they are likely to be slow.

   * The argument to 'AGAINST()' must be a string value that is constant
     during query evaluation.  This rules out, for example, a table
     column because that can differ for each row.

   * Index hints are more limited for 'FULLTEXT' searches than for
     non-'FULLTEXT' searches.  See *note index-hints::.

   * The '%' character is not a supported wildcard character for
     full-text searches.


File: manual.info.tmp,  Node: fulltext-fine-tuning,  Next: full-text-adding-collation,  Prev: fulltext-restrictions,  Up: fulltext-search

12.9.6 Fine-Tuning MySQL Full-Text Search
-----------------------------------------

MySQL's full-text search capability has few user-tunable parameters.
You can exert more control over full-text searching behavior if you have
a MySQL source distribution because some changes require source code
modifications.  See *note source-installation::.

Full-text search is carefully tuned for the most effectiveness.
Modifying the default behavior in most cases can actually decrease
effectiveness.  _Do not alter the MySQL sources unless you know what you
are doing_.

Most full-text variables described in this section must be set at server
startup time.  A server restart is required to change them; they cannot
be modified while the server is running.

Some variable changes require that you rebuild the 'FULLTEXT' indexes in
your tables.  Instructions for doing so are given later in this section.

   * The minimum and maximum lengths of words to be indexed are defined
     by the 'ft_min_word_len' and 'ft_max_word_len' system variables.
     (See *note server-system-variables::.)  The default minimum value
     is four characters; the default maximum is version dependent.  If
     you change either value, you must rebuild your 'FULLTEXT' indexes.
     For example, if you want three-character words to be searchable,
     you can set the 'ft_min_word_len' variable by putting the following
     lines in an option file:

          [mysqld]
          ft_min_word_len=3

     Then restart the server and rebuild your 'FULLTEXT' indexes.  Note
     particularly the remarks regarding *note 'myisamchk': myisamchk. in
     the instructions following this list.

   * 
     To override the default stopword list, set the 'ft_stopword_file'
     system variable.  (See *note server-system-variables::.)  The
     variable value should be the path name of the file containing the
     stopword list, or the empty string to disable stopword filtering.
     The server looks for the file in the data directory unless an
     absolute path name is given to specify a different directory.
     After changing the value of this variable or the contents of the
     stopword file, restart the server and rebuild your 'FULLTEXT'
     indexes.

     The stopword list is free-form.  That is, you may use any
     nonalphanumeric character such as newline, space, or comma to
     separate stopwords.  Exceptions are the underscore character ('_')
     and a single apostrophe (''') which are treated as part of a word.
     The character set of the stopword list is the server's default
     character set; see *note charset-server::.

   * The 50% threshold for natural language searches is determined by
     the particular weighting scheme chosen.  To disable it, look for
     the following line in 'storage/myisam/ftdefs.h':

          #define GWS_IN_USE GWS_PROB

     Change that line to this:

          #define GWS_IN_USE GWS_FREQ

     Then recompile MySQL. There is no need to rebuild the indexes in
     this case.

     *Note*:

     By making this change, you _severely_ decrease MySQL's ability to
     provide adequate relevance values for the 'MATCH()' function.  If
     you really need to search for such common words, it would be better
     to search using 'IN BOOLEAN MODE' instead, which does not observe
     the 50% threshold.

   * To change the operators used for boolean full-text searches, set
     the 'ft_boolean_syntax' system variable.  This variable can be
     changed while the server is running, but you must have privileges
     sufficient to set global system variables (see *note
     system-variable-privileges::).  No rebuilding of indexes is
     necessary in this case.  See *note server-system-variables::, which
     describes the rules governing how to set this variable.

   * If you want to change the set of characters that are considered
     word characters, you can do so in several ways, as described in the
     following list.  After making the modification, you must rebuild
     the indexes for each table that contains any 'FULLTEXT' indexes.
     Suppose that you want to treat the hyphen character ('-') as a word
     character.  Use one of these methods:

        * Modify the MySQL source: In 'storage/myisam/ftdefs.h', see the
          'true_word_char()' and 'misc_word_char()' macros.  Add ''-''
          to one of those macros and recompile MySQL.

        * Modify a character set file: This requires no recompilation.
          The 'true_word_char()' macro uses a 'character type' table to
          distinguish letters and numbers from other characters.  .  You
          can edit the contents of the '<ctype><map>' array in one of
          the character set XML files to specify that ''-'' is a
          'letter.' Then use the given character set for your 'FULLTEXT'
          indexes.  For information about the '<ctype><map>' array
          format, see *note character-arrays::.

        * Add a new collation for the character set used by the indexed
          columns, and alter the columns to use that collation.  For
          general information about adding collations, see *note
          adding-collation::.  For an example specific to full-text
          indexing, see *note full-text-adding-collation::.

If you modify full-text variables that affect indexing
('ft_min_word_len', 'ft_max_word_len', or 'ft_stopword_file'), or if you
change the stopword file itself, you must rebuild your 'FULLTEXT'
indexes after making the changes and restarting the server.  To rebuild
the indexes in this case, it is sufficient to do a 'QUICK' repair
operation:

     mysql> REPAIR TABLE TBL_NAME QUICK;

Alternatively, use *note 'ALTER TABLE': alter-table. with the 'DROP
INDEX' and 'ADD INDEX' options to drop and re-create each 'FULLTEXT'
index.  In some cases, this may be faster than a repair operation.

Each table that contains any 'FULLTEXT' index must be repaired as just
shown.  Otherwise, queries for the table may yield incorrect results,
and modifications to the table will cause the server to see the table as
corrupt and in need of repair.

If you use *note 'myisamchk': myisamchk. to perform an operation that
modifies table indexes (such as repair or analyze), the 'FULLTEXT'
indexes are rebuilt using the _default_ full-text parameter values for
minimum word length, maximum word length, and stopword file unless you
specify otherwise.  This can result in queries failing.

The problem occurs because these parameters are known only by the
server.  They are not stored in 'MyISAM' index files.  To avoid the
problem if you have modified the minimum or maximum word length or
stopword file values used by the server, specify the same
'ft_min_word_len', 'ft_max_word_len', and 'ft_stopword_file' values for
*note 'myisamchk': myisamchk. that you use for *note 'mysqld': mysqld.
For example, if you have set the minimum word length to 3, you can
repair a table with *note 'myisamchk': myisamchk. like this:

     shell> myisamchk --recover --ft_min_word_len=3 TBL_NAME.MYI

To ensure that *note 'myisamchk': myisamchk. and the server use the same
values for full-text parameters, place each one in both the '[mysqld]'
and '[myisamchk]' sections of an option file:

     [mysqld]
     ft_min_word_len=3

     [myisamchk]
     ft_min_word_len=3

An alternative to using *note 'myisamchk': myisamchk. for index
modification is to use the *note 'REPAIR TABLE': repair-table, *note
'ANALYZE TABLE': analyze-table, *note 'OPTIMIZE TABLE': optimize-table,
or *note 'ALTER TABLE': alter-table. statements.  These statements are
performed by the server, which knows the proper full-text parameter
values to use.


File: manual.info.tmp,  Node: full-text-adding-collation,  Prev: fulltext-fine-tuning,  Up: fulltext-search

12.9.7 Adding a Collation for Full-Text Indexing
------------------------------------------------

This section describes how to add a new collation for full-text
searches.  The sample collation is like 'latin1_swedish_ci' but treats
the ''-'' character as a letter rather than as a punctuation character
so that it can be indexed as a word character.  General information
about adding collations is given in *note adding-collation::; it is
assumed that you have read it and are familiar with the files involved.

To add a collation for full-text indexing, use the following procedure.
The instructions here add a collation for a simple character set, which
as discussed in *note adding-collation::, can be created using a
configuration file that describes the character set properties.  For a
complex character set such as Unicode, create collations using C source
files that describe the character set properties.

  1. Add a collation to the 'Index.xml' file.  The collation ID must be
     unused, so choose a value different from 62 if that ID is already
     taken on your system.

          <charset name="latin1">
          ...
          <collation name="latin1_fulltext_ci" id="62"/>
          </charset>

  2. Declare the sort order for the collation in the 'latin1.xml' file.
     In this case, the order can be copied from 'latin1_swedish_ci':

          <collation name="latin1_fulltext_ci">
          <map>
          00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F
          10 11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F
          20 21 22 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F
          30 31 32 33 34 35 36 37 38 39 3A 3B 3C 3D 3E 3F
          40 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F
          50 51 52 53 54 55 56 57 58 59 5A 5B 5C 5D 5E 5F
          60 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F
          50 51 52 53 54 55 56 57 58 59 5A 7B 7C 7D 7E 7F
          80 81 82 83 84 85 86 87 88 89 8A 8B 8C 8D 8E 8F
          90 91 92 93 94 95 96 97 98 99 9A 9B 9C 9D 9E 9F
          A0 A1 A2 A3 A4 A5 A6 A7 A8 A9 AA AB AC AD AE AF
          B0 B1 B2 B3 B4 B5 B6 B7 B8 B9 BA BB BC BD BE BF
          41 41 41 41 5C 5B 5C 43 45 45 45 45 49 49 49 49
          44 4E 4F 4F 4F 4F 5D D7 D8 55 55 55 59 59 DE DF
          41 41 41 41 5C 5B 5C 43 45 45 45 45 49 49 49 49
          44 4E 4F 4F 4F 4F 5D F7 D8 55 55 55 59 59 DE FF
          </map>
          </collation>

  3. Modify the 'ctype' array in 'latin1.xml'.  Change the value
     corresponding to 0x2D (which is the code for the ''-'' character)
     from 10 (punctuation) to 01 (uppercase letter).  In the following
     array, this is the element in the fourth row down, third value from
     the end.

          <ctype>
          <map>
          00
          20 20 20 20 20 20 20 20 20 28 28 28 28 28 20 20
          20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20
          48 10 10 10 10 10 10 10 10 10 10 10 10 01 10 10
          84 84 84 84 84 84 84 84 84 84 10 10 10 10 10 10
          10 81 81 81 81 81 81 01 01 01 01 01 01 01 01 01
          01 01 01 01 01 01 01 01 01 01 01 10 10 10 10 10
          10 82 82 82 82 82 82 02 02 02 02 02 02 02 02 02
          02 02 02 02 02 02 02 02 02 02 02 10 10 10 10 20
          10 00 10 02 10 10 10 10 10 10 01 10 01 00 01 00
          00 10 10 10 10 10 10 10 10 10 02 10 02 00 02 01
          48 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10
          10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10
          01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01
          01 01 01 01 01 01 01 10 01 01 01 01 01 01 01 02
          02 02 02 02 02 02 02 02 02 02 02 02 02 02 02 02
          02 02 02 02 02 02 02 10 02 02 02 02 02 02 02 02
          </map>
          </ctype>

  4. Restart the server.

  5. To employ the new collation, include it in the definition of
     columns that are to use it:

          mysql> DROP TABLE IF EXISTS t1;
          Query OK, 0 rows affected (0.13 sec)

          mysql> CREATE TABLE t1 (
              -> a TEXT CHARACTER SET latin1 COLLATE latin1_fulltext_ci,
              -> FULLTEXT INDEX(a)
              -> ) ENGINE=MyISAM;
          Query OK, 0 rows affected (0.47 sec)

  6. Test the collation to verify that hyphen is considered as a word
     character:

          mysql> INSERT INTO t1 VALUEs ('----'),('....'),('abcd');
          Query OK, 3 rows affected (0.22 sec)
          Records: 3  Duplicates: 0  Warnings: 0

          mysql> SELECT * FROM t1 WHERE MATCH a AGAINST ('----' IN BOOLEAN MODE);
          +------+
          | a    |
          +------+
          | ---- |
          +------+
          1 row in set (0.00 sec)


File: manual.info.tmp,  Node: cast-functions,  Next: xml-functions,  Prev: fulltext-search,  Up: functions

12.10 Cast Functions and Operators
==================================

*Cast Functions and Operators*

Name                          Description
                              
'BINARY'                      Cast a string to a binary string
                              
'CAST()'                      Cast a value as a certain type
                              
'CONVERT()'                   Cast a value as a certain type

Cast functions and operators enable conversion of values from one data
type to another.

'CONVERT()' with a 'USING' clause converts data between different
character sets:

     CONVERT(EXPR USING TRANSCODING_NAME)

In MySQL, transcoding names are the same as the corresponding character
set names.

Examples:

     SELECT CONVERT('test' USING utf8);
     SELECT CONVERT(_latin1'Mu"ller' USING utf8);
     INSERT INTO utf8_table (utf8_column)
         SELECT CONVERT(latin1_column USING utf8) FROM latin1_table;

To convert strings between different character sets, you can also use
'CONVERT()' without 'USING', or 'CAST()':

     CONVERT(STRING, CHAR[(N)] CHARACTER SET CHARSET_NAME)
     CAST(STRING AS CHAR[(N)] CHARACTER SET CHARSET_NAME)

Examples:

     SELECT CONVERT('test', CHAR CHARACTER SET utf8);
     SELECT CAST('test' AS CHAR CHARACTER SET utf8);

If you specify 'CHARACTER SET CHARSET_NAME' as just shown, the character
set and collation of the result are CHARSET_NAME and the default
collation of CHARSET_NAME.  If you omit 'CHARACTER SET CHARSET_NAME',
the character set and collation of the result are defined by the
'character_set_connection' and 'collation_connection' system variables
that determine the default connection character set and collation (see
*note charset-connection::).

A 'COLLATE' clause is not permitted within a 'CONVERT()' or 'CAST()'
call, but you can apply it to the function result.  For example, these
are legal:

     SELECT CONVERT('test' USING utf8) COLLATE utf8_bin;
     SELECT CONVERT('test', CHAR CHARACTER SET utf8) COLLATE utf8_bin;
     SELECT CAST('test' AS CHAR CHARACTER SET utf8) COLLATE utf8_bin;

But these are illegal:

     SELECT CONVERT('test' USING utf8 COLLATE utf8_bin);
     SELECT CONVERT('test', CHAR CHARACTER SET utf8 COLLATE utf8_bin);
     SELECT CAST('test' AS CHAR CHARACTER SET utf8 COLLATE utf8_bin);

Normally, you cannot compare a *note 'BLOB': blob. value or other binary
string in case-insensitive fashion because binary strings use the
'binary' character set, which has no collation with the concept of
lettercase.  To perform a case-insensitive comparison, first use the
'CONVERT()' or 'CAST()' function to convert the value to a nonbinary
string.  Comparisons of the resulting string use its collation.  For
example, if the conversion result character set has a case-insensitive
collation, a 'LIKE' operation is not case-sensitive.  That is true for
the following operation because the default 'latin1' collation
('latin1_swedish_ci') is not case-sensitive:

     SELECT 'A' LIKE CONVERT(BLOB_COL USING latin1)
       FROM TBL_NAME;

To specify a particular collation for the converted string, use a
'COLLATE' clause following the 'CONVERT()' call:

     SELECT 'A' LIKE CONVERT(BLOB_COL USING latin1) COLLATE latin1_german1_ci
       FROM TBL_NAME;

To use a different character set, substitute its name for 'latin1' in
the preceding statements (and similarly to use a different collation).

'CONVERT()' and 'CAST()' can be used more generally for comparing
strings represented in different character sets.  For example, a
comparison of these strings results in an error because they have
different character sets:

     mysql> SET @s1 = _latin1 'abc', @s2 = _latin2 'abc';
     mysql> SELECT @s1 = @s2;
     ERROR 1267 (HY000): Illegal mix of collations (latin1_swedish_ci,IMPLICIT)
     and (latin2_general_ci,IMPLICIT) for operation '='

Converting one of the strings to a character set compatible with the
other enables the comparison to occur without error:

     mysql> SELECT @s1 = CONVERT(@s2 USING latin1);
     +---------------------------------+
     | @s1 = CONVERT(@s2 USING latin1) |
     +---------------------------------+
     |                               1 |
     +---------------------------------+

For string literals, another way to specify the character set is to use
a character set introducer.  '_latin1' and '_latin2' in the preceding
example are instances of introducers.  Unlike conversion functions such
as 'CAST()', or 'CONVERT()', which convert a string from one character
set to another, an introducer designates a string literal as having a
particular character set, with no conversion involved.  For more
information, see *note charset-introducer::.

Character set conversion is also useful preceding lettercase conversion
of binary strings.  'LOWER()' and 'UPPER()' are ineffective when applied
directly to binary strings because the concept of lettercase does not
apply.  To perform lettercase conversion of a binary string, first
convert it to a nonbinary string using a character set appropriate for
the data stored in the string:

     mysql> SET @str = BINARY 'New York';
     mysql> SELECT LOWER(@str), LOWER(CONVERT(@str USING latin1));
     +-------------+-----------------------------------+
     | LOWER(@str) | LOWER(CONVERT(@str USING latin1)) |
     +-------------+-----------------------------------+
     | New York    | new york                          |
     +-------------+-----------------------------------+

Be aware that if you convert an indexed column using 'BINARY', 'CAST()',
or 'CONVERT()', MySQL may not be able to use the index efficiently.

The cast functions are useful for creating a column with a specific type
in a *note 'CREATE TABLE ... SELECT': create-table. statement:


     mysql> CREATE TABLE new_table SELECT CAST('2000-01-01' AS DATE) AS c1;
     mysql> SHOW CREATE TABLE new_table\G
     *************************** 1. row ***************************
            Table: new_table
     Create Table: CREATE TABLE `new_table` (
       `c1` date DEFAULT NULL
     ) ENGINE=InnoDB DEFAULT CHARSET=latin1

The cast functions are useful for sorting *note 'ENUM': enum. columns in
lexical order.  Normally, sorting of *note 'ENUM': enum. columns occurs
using the internal numeric values.  Casting the values to *note 'CHAR':
char. results in a lexical sort:

     SELECT ENUM_COL FROM TBL_NAME ORDER BY CAST(ENUM_COL AS CHAR);

'CAST()' also changes the result if you use it as part of a more complex
expression such as 'CONCAT('Date: ',CAST(NOW() AS DATE))'.

For temporal values, there is little need to use 'CAST()' to extract
data in different formats.  Instead, use a function such as 'EXTRACT()',
'DATE_FORMAT()', or 'TIME_FORMAT()'.  See *note
date-and-time-functions::.

To cast a string to a number, you normally need do nothing other than
use the string value in numeric context:

     mysql> SELECT 1+'1';
            -> 2

That is also true for hexadecimal and bit literals, which are binary
strings by default:

     mysql> SELECT X'41', X'41'+0;
             -> 'A', 65
     mysql> SELECT b'1100001', b'1100001'+0;
             -> 'a', 97

A string used in an arithmetic operation is converted to a
floating-point number during expression evaluation.

A number used in string context is converted to a string:

     mysql> SELECT CONCAT('hello you ',2);
             -> 'hello you 2'

For information about implicit conversion of numbers to strings, see
*note type-conversion::.

When using an explicit 'CAST()' on a *note 'TIMESTAMP': datetime. value
in a statement that does not select from any tables, the value is
treated by MySQL as a string prior to performing any conversion.  This
results in the value being truncated when casting to a numeric type, as
shown here:

     mysql> SELECT CAST(TIMESTAMP '2014-09-08 18:07:54' AS SIGNED);
     +-------------------------------------------------+
     | CAST(TIMESTAMP '2014-09-08 18:07:54' AS SIGNED) |
     +-------------------------------------------------+
     |                                            2014 |
     +-------------------------------------------------+
     1 row in set, 1 warning (0.00 sec)

     mysql> SHOW WARNINGS;
     +---------+------+----------------------------------------------------------+
     | Level   | Code | Message                                                  |
     +---------+------+----------------------------------------------------------+
     | Warning | 1292 | Truncated incorrect INTEGER value: '2014-09-08 18:07:54' |
     +---------+------+----------------------------------------------------------+
     1 row in set (0.00 sec)

This does not apply when selecting rows from a table, as shown here:

     mysql> USE test;

     Database changed
     mysql> CREATE TABLE c_test (col TIMESTAMP);
     Query OK, 0 rows affected (0.07 sec)

     mysql> INSERT INTO c_test VALUES ('2014-09-08 18:07:54');
     Query OK, 1 row affected (0.05 sec)

     mysql> SELECT col, CAST(col AS UNSIGNED) AS c_col FROM c_test;
     +---------------------+----------------+
     | col                 | c_col          |
     +---------------------+----------------+
     | 2014-09-08 18:07:54 | 20140908180754 |
     +---------------------+----------------+
     1 row in set (0.00 sec)

This is a known issue which is resolved in MySQL 5.6.

MySQL supports arithmetic with both signed and unsigned 64-bit values.
For numeric operators (such as '+' or '-') where one of the operands is
an unsigned integer, the result is unsigned by default (see *note
arithmetic-functions::).  To override this, use the 'SIGNED' or
'UNSIGNED' cast operator to cast a value to a signed or unsigned 64-bit
integer, respectively.

     mysql> SELECT 1 - 2;
             -> -1
     mysql> SELECT CAST(1 - 2 AS UNSIGNED);
             -> 18446744073709551615
     mysql> SELECT CAST(CAST(1 - 2 AS UNSIGNED) AS SIGNED);
             -> -1

If either operand is a floating-point value, the result is a
floating-point value and is not affected by the preceding rule.  (In
this context, *note 'DECIMAL': fixed-point-types. column values are
regarded as floating-point values.)

     mysql> SELECT CAST(1 AS UNSIGNED) - 2.0;
             -> -1.0

The SQL mode affects the result of conversion operations (see *note
sql-mode::).  Examples:

   * For conversion of a 'zero' date string to a date, 'CONVERT()' and
     'CAST()' return 'NULL' and produce a warning when the
     'NO_ZERO_DATE' SQL mode is enabled.

   * For integer subtraction, if the 'NO_UNSIGNED_SUBTRACTION' SQL mode
     is enabled, the subtraction result is signed even if any operand is
     unsigned.

The following list describes the available cast functions and operators:

   * 
     'BINARY' EXPR

     The 'BINARY' operator converts the expression to a binary string (a
     string that has the 'binary' character set and 'binary' collation).
     A common use for 'BINARY' is to force a character string comparison
     to be done byte by byte using numeric byte values rather than
     character by character.  The 'BINARY' operator also causes trailing
     spaces in comparisons to be significant.  For information about the
     differences between the 'binary' collation of the 'binary'
     character set and the '_bin' collations of nonbinary character
     sets, see *note charset-binary-collations::.

          mysql> SELECT 'a' = 'A';
                  -> 1
          mysql> SELECT BINARY 'a' = 'A';
                  -> 0
          mysql> SELECT 'a' = 'a ';
                  -> 1
          mysql> SELECT BINARY 'a' = 'a ';
                  -> 0

     In a comparison, 'BINARY' affects the entire operation; it can be
     given before either operand with the same result.

     To convert a string expression to a binary string, these constructs
     are equivalent:

          BINARY EXPR
          CAST(EXPR AS BINARY)
          CONVERT(EXPR USING BINARY)

     If a value is a string literal, it can be designated as a binary
     string without performing any conversion by using the '_binary'
     character set introducer:

          mysql> SELECT 'a' = 'A';
                  -> 1
          mysql> SELECT _binary 'a' = 'A';
                  -> 0

     For information about introducers, see *note charset-introducer::.

     The 'BINARY' operator in expressions differs in effect from the
     'BINARY' attribute in character column definitions.  A character
     column defined with the 'BINARY' attribute is assigned the table
     default character set and the binary ('_bin') collation of that
     character set.  Every nonbinary character set has a '_bin'
     collation.  For example, if the table default character set is
     'utf8', these two column definitions are equivalent:

          CHAR(10) BINARY
          CHAR(10) CHARACTER SET utf8 COLLATE utf8_bin

     The use of 'CHARACTER SET binary' in the definition of a *note
     'CHAR': char, *note 'VARCHAR': char, or *note 'TEXT': blob. column
     causes the column to be treated as the corresponding binary string
     data type.  For example, the following pairs of definitions are
     equivalent:

          CHAR(10) CHARACTER SET binary
          BINARY(10)

          VARCHAR(10) CHARACTER SET binary
          VARBINARY(10)

          TEXT CHARACTER SET binary
          BLOB

   * 
     'CAST(EXPR AS TYPE)'

     The 'CAST()' function takes an expression of any type and produces
     a result value of the specified type, similar to 'CONVERT()'.  For
     more information, see the description of 'CONVERT()'.

     'CAST()' is standard SQL syntax.

   * 
     'CONVERT(EXPR,TYPE)', 'CONVERT(EXPR USING TRANSCODING_NAME)'

     The 'CONVERT()' function takes an expression of any type and
     produces a result value of the specified type.

     Discussion of 'CONVERT(EXPR, TYPE)' syntax here also applies to
     'CAST(EXPR AS TYPE)', which is equivalent.

     'CONVERT(... USING ...)' is standard SQL syntax.  The non-'USING'
     form of 'CONVERT()' is ODBC syntax.

     'CONVERT()' with 'USING' converts data between different character
     sets.  In MySQL, transcoding names are the same as the
     corresponding character set names.  For example, this statement
     converts the string ''abc'' in the default character set to the
     corresponding string in the 'utf8' character set:

          SELECT CONVERT('abc' USING utf8);

     'CONVERT()' without 'USING' and 'CAST()' take an expression and a
     TYPE value specifying the result type.  These TYPE values are
     permitted:

        * 'BINARY[(N)]'

          Produces a string with the *note 'BINARY': binary-varbinary.
          data type.  For a description of how this affects comparisons,
          see *note binary-varbinary::.  If the optional length N is
          given, 'BINARY(N)' causes the cast to use no more than N bytes
          of the argument.  Values shorter than N bytes are padded with
          '0x00' bytes to a length of N.

        * 'CHAR[(N)] [CHARSET_INFO]'

          Produces a string with the *note 'CHAR': char. data type.  If
          the optional length N is given, 'CHAR(N)' causes the cast to
          use no more than N characters of the argument.  No padding
          occurs for values shorter than N characters.

          With no CHARSET_INFO clause, 'CHAR' produces a string with the
          default character set.  To specify the character set
          explicitly, these CHARSET_INFO values are permitted:

             * 'CHARACTER SET CHARSET_NAME': Produces a string with the
               given character set.

             * 'ASCII': Shorthand for 'CHARACTER SET latin1'.

             * 'UNICODE': Shorthand for 'CHARACTER SET ucs2'.

          In all cases, the string has the character set default
          collation.

        * 'DATE'

          Produces a *note 'DATE': datetime. value.

        * 'DATETIME'

          Produces a *note 'DATETIME': datetime. value.

        * 'DECIMAL[(M[,D])]'

          Produces a *note 'DECIMAL': fixed-point-types. value.  If the
          optional M and D values are given, they specify the maximum
          number of digits (the precision) and the number of digits
          following the decimal point (the scale).

        * 'NCHAR[(N)]'

          Like 'CHAR', but produces a string with the national character
          set.  See *note charset-national::.

          Unlike 'CHAR', 'NCHAR' does not permit trailing character set
          information to be specified.

        * 'SIGNED [INTEGER]'

          Produces a signed integer value.

        * 'TIME'

          Produces a *note 'TIME': time. value.

        * 'UNSIGNED [INTEGER]'

          Produces an unsigned integer value.


File: manual.info.tmp,  Node: xml-functions,  Next: bit-functions,  Prev: cast-functions,  Up: functions

12.11 XML Functions
===================

*XML Functions*

Name                          Description
                              
'ExtractValue()'              Extract a value from an XML string using
                              XPath notation
                              
'UpdateXML()'                 Return replaced XML fragment

This section discusses XML and related functionality in MySQL.

*Note*:

It is possible to obtain XML-formatted output from MySQL in the *note
'mysql': mysql. and *note 'mysqldump': mysqldump. clients by invoking
them with the '--xml' option.  See *note mysql::, and *note mysqldump::.

Two functions providing basic XPath 1.0 (XML Path Language, version 1.0)
capabilities are available.  Some basic information about XPath syntax
and usage is provided later in this section; however, an in-depth
discussion of these topics is beyond the scope of this manual, and you
should refer to the XML Path Language (XPath) 1.0 standard
(http://www.w3.org/TR/xpath) for definitive information.  A useful
resource for those new to XPath or who desire a refresher in the basics
is the Zvon.org XPath Tutorial (http://www.zvon.org/xxl/XPathTutorial/),
which is available in several languages.

*Note*:

These functions remain under development.  We continue to improve these
and other aspects of XML and XPath functionality in MySQL 5.5 and
onwards.  You may discuss these, ask questions about them, and obtain
help from other users with them in the MySQL XML User Forum
(https://forums.mysql.com/list.php?44).

XPath expressions used with these functions support user variables and
local stored program variables.  User variables are weakly checked;
variables local to stored programs are strongly checked (see also Bug
#26518):

   * User variables (weak checking)

     Variables using the syntax '$@VARIABLE_NAME' (that is, user
     variables) are not checked.  No warnings or errors are issued by
     the server if a variable has the wrong type or has previously not
     been assigned a value.  This also means the user is fully
     responsible for any typographical errors, since no warnings will be
     given if (for example) '$@myvariable' is used where '$@myvariable'
     was intended.

     Example:

          mysql> SET @xml = '<a><b>X</b><b>Y</b></a>';
          Query OK, 0 rows affected (0.00 sec)

          mysql> SET @i =1, @j = 2;
          Query OK, 0 rows affected (0.00 sec)

          mysql> SELECT @i, ExtractValue(@xml, '//b[$@i]');
          +------+--------------------------------+
          | @i   | ExtractValue(@xml, '//b[$@i]') |
          +------+--------------------------------+
          |    1 | X                              |
          +------+--------------------------------+
          1 row in set (0.00 sec)

          mysql> SELECT @j, ExtractValue(@xml, '//b[$@j]');
          +------+--------------------------------+
          | @j   | ExtractValue(@xml, '//b[$@j]') |
          +------+--------------------------------+
          |    2 | Y                              |
          +------+--------------------------------+
          1 row in set (0.00 sec)

          mysql> SELECT @k, ExtractValue(@xml, '//b[$@k]');
          +------+--------------------------------+
          | @k   | ExtractValue(@xml, '//b[$@k]') |
          +------+--------------------------------+
          | NULL |                                |
          +------+--------------------------------+
          1 row in set (0.00 sec)

   * Variables in stored programs (strong checking)

     Variables using the syntax '$VARIABLE_NAME' can be declared and
     used with these functions when they are called inside stored
     programs.  Such variables are local to the stored program in which
     they are defined, and are strongly checked for type and value.

     Example:

          mysql> DELIMITER |

          mysql> CREATE PROCEDURE myproc ()
              -> BEGIN
              ->   DECLARE i INT DEFAULT 1;
              ->   DECLARE xml VARCHAR(25) DEFAULT '<a>X</a><a>Y</a><a>Z</a>';
              ->
              ->   WHILE i < 4 DO
              ->     SELECT xml, i, ExtractValue(xml, '//a[$i]');
              ->     SET i = i+1;
              ->   END WHILE;
              -> END |
          Query OK, 0 rows affected (0.01 sec)

          mysql> DELIMITER ;

          mysql> CALL myproc();
          +--------------------------+---+------------------------------+
          | xml                      | i | ExtractValue(xml, '//a[$i]') |
          +--------------------------+---+------------------------------+
          | <a>X</a><a>Y</a><a>Z</a> | 1 | X                            |
          +--------------------------+---+------------------------------+
          1 row in set (0.00 sec)

          +--------------------------+---+------------------------------+
          | xml                      | i | ExtractValue(xml, '//a[$i]') |
          +--------------------------+---+------------------------------+
          | <a>X</a><a>Y</a><a>Z</a> | 2 | Y                            |
          +--------------------------+---+------------------------------+
          1 row in set (0.01 sec)

          +--------------------------+---+------------------------------+
          | xml                      | i | ExtractValue(xml, '//a[$i]') |
          +--------------------------+---+------------------------------+
          | <a>X</a><a>Y</a><a>Z</a> | 3 | Z                            |
          +--------------------------+---+------------------------------+
          1 row in set (0.01 sec)

     Parameters

     Variables used in XPath expressions inside stored routines that are
     passed in as parameters are also subject to strong checking.

Expressions containing user variables or variables local to stored
programs must otherwise (except for notation) conform to the rules for
XPath expressions containing variables as given in the XPath 1.0
specification.

*Note*:

A user variable used to store an XPath expression is treated as an empty
string.  Because of this, it is not possible to store an XPath
expression as a user variable.  (Bug #32911)

   * 
     'ExtractValue(XML_FRAG, XPATH_EXPR)'

     'ExtractValue()' takes two string arguments, a fragment of XML
     markup XML_FRAG and an XPath expression XPATH_EXPR (also known as a
     _locator_); it returns the text ('CDATA') of the first text node
     which is a child of the element or elements matched by the XPath
     expression.  In MySQL 5.5, the XPath expression can contain at most
     127 characters.  (This limitation is lifted in MySQL 5.6.)

     Using this function is the equivalent of performing a match using
     the XPATH_EXPR after appending '/text()'.  In other words,
     'ExtractValue('<a><b>Sakila</b></a>', '/a/b')' and
     'ExtractValue('<a><b>Sakila</b></a>', '/a/b/text()')' produce the
     same result.

     If multiple matches are found, the content of the first child text
     node of each matching element is returned (in the order matched) as
     a single, space-delimited string.

     If no matching text node is found for the expression (including the
     implicit '/text()')--for whatever reason, as long as XPATH_EXPR is
     valid, and XML_FRAG consists of elements which are properly nested
     and closed--an empty string is returned.  No distinction is made
     between a match on an empty element and no match at all.  This is
     by design.

     If you need to determine whether no matching element was found in
     XML_FRAG or such an element was found but contained no child text
     nodes, you should test the result of an expression that uses the
     XPath 'count()' function.  For example, both of these statements
     return an empty string, as shown here:

          mysql> SELECT ExtractValue('<a><b/></a>', '/a/b');
          +-------------------------------------+
          | ExtractValue('<a><b/></a>', '/a/b') |
          +-------------------------------------+
          |                                     |
          +-------------------------------------+
          1 row in set (0.00 sec)

          mysql> SELECT ExtractValue('<a><c/></a>', '/a/b');
          +-------------------------------------+
          | ExtractValue('<a><c/></a>', '/a/b') |
          +-------------------------------------+
          |                                     |
          +-------------------------------------+
          1 row in set (0.00 sec)

     However, you can determine whether there was actually a matching
     element using the following:

          mysql> SELECT ExtractValue('<a><b/></a>', 'count(/a/b)');
          +-------------------------------------+
          | ExtractValue('<a><b/></a>', 'count(/a/b)') |
          +-------------------------------------+
          | 1                                   |
          +-------------------------------------+
          1 row in set (0.00 sec)

          mysql> SELECT ExtractValue('<a><c/></a>', 'count(/a/b)');
          +-------------------------------------+
          | ExtractValue('<a><c/></a>', 'count(/a/b)') |
          +-------------------------------------+
          | 0                                   |
          +-------------------------------------+
          1 row in set (0.01 sec)

     *Important*:

     'ExtractValue()' returns only 'CDATA', and does not return any tags
     that might be contained within a matching tag, nor any of their
     content (see the result returned as 'val1' in the following
     example).

          mysql> SELECT
              ->   ExtractValue('<a>ccc<b>ddd</b></a>', '/a') AS val1,
              ->   ExtractValue('<a>ccc<b>ddd</b></a>', '/a/b') AS val2,
              ->   ExtractValue('<a>ccc<b>ddd</b></a>', '//b') AS val3,
              ->   ExtractValue('<a>ccc<b>ddd</b></a>', '/b') AS val4,
              ->   ExtractValue('<a>ccc<b>ddd</b><b>eee</b></a>', '//b') AS val5;

          +------+------+------+------+---------+
          | val1 | val2 | val3 | val4 | val5    |
          +------+------+------+------+---------+
          | ccc  | ddd  | ddd  |      | ddd eee |
          +------+------+------+------+---------+

     This function uses the current SQL collation for making comparisons
     with 'contains()', performing the same collation aggregation as
     other string functions (such as 'CONCAT()'), in taking into account
     the collation coercibility of their arguments; see *note
     charset-collation-coercibility::, for an explanation of the rules
     governing this behavior.

     (Previously, binary--that is, case-sensitive--comparison was always
     used.)

     'NULL' is returned if XML_FRAG contains elements which are not
     properly nested or closed, and a warning is generated, as shown in
     this example:

          mysql> SELECT ExtractValue('<a>c</a><b', '//a');
          +-----------------------------------+
          | ExtractValue('<a>c</a><b', '//a') |
          +-----------------------------------+
          | NULL                              |
          +-----------------------------------+
          1 row in set, 1 warning (0.00 sec)

          mysql> SHOW WARNINGS\G
          *************************** 1. row ***************************
            Level: Warning
             Code: 1525
          Message: Incorrect XML value: 'parse error at line 1 pos 11:
                   END-OF-INPUT unexpected ('>' wanted)'
          1 row in set (0.00 sec)

          mysql> SELECT ExtractValue('<a>c</a><b/>', '//a');
          +-------------------------------------+
          | ExtractValue('<a>c</a><b/>', '//a') |
          +-------------------------------------+
          | c                                   |
          +-------------------------------------+
          1 row in set (0.00 sec)

   * 
     'UpdateXML(XML_TARGET, XPATH_EXPR, NEW_XML)'

     This function replaces a single portion of a given fragment of XML
     markup XML_TARGET with a new XML fragment NEW_XML, and then returns
     the changed XML. The portion of XML_TARGET that is replaced matches
     an XPath expression XPATH_EXPR supplied by the user.  In MySQL 5.5,
     the XPath expression can contain at most 127 characters.  (This
     limitation is lifted in MySQL 5.6.)

     If no expression matching XPATH_EXPR is found, or if multiple
     matches are found, the function returns the original XML_TARGET XML
     fragment.  All three arguments should be strings.

          mysql> SELECT
              ->   UpdateXML('<a><b>ccc</b><d></d></a>', '/a', '<e>fff</e>') AS val1,
              ->   UpdateXML('<a><b>ccc</b><d></d></a>', '/b', '<e>fff</e>') AS val2,
              ->   UpdateXML('<a><b>ccc</b><d></d></a>', '//b', '<e>fff</e>') AS val3,
              ->   UpdateXML('<a><b>ccc</b><d></d></a>', '/a/d', '<e>fff</e>') AS val4,
              ->   UpdateXML('<a><d></d><b>ccc</b><d></d></a>', '/a/d', '<e>fff</e>') AS val5
              -> \G

          *************************** 1. row ***************************
          val1: <e>fff</e>
          val2: <a><b>ccc</b><d></d></a>
          val3: <a><e>fff</e><d></d></a>
          val4: <a><b>ccc</b><e>fff</e></a>
          val5: <a><d></d><b>ccc</b><d></d></a>

*Note*:

A discussion in depth of XPath syntax and usage are beyond the scope of
this manual.  Please see the XML Path Language (XPath) 1.0 specification
(http://www.w3.org/TR/xpath) for definitive information.  A useful
resource for those new to XPath or who are wishing a refresher in the
basics is the Zvon.org XPath Tutorial
(http://www.zvon.org/xxl/XPathTutorial/), which is available in several
languages.

Descriptions and examples of some basic XPath expressions follow:

   * '/TAG'

     Matches '<TAG/>' if and only if '<TAG/>' is the root element.

     Example: '/a' has a match in '<a><b/></a>' because it matches the
     outermost (root) tag.  It does not match the inner A element in
     '<b><a/></b>' because in this instance it is the child of another
     element.

   * '/TAG1/TAG2'

     Matches '<TAG2/>' if and only if it is a child of '<TAG1/>', and
     '<TAG1/>' is the root element.

     Example: '/a/b' matches the B element in the XML fragment
     '<a><b/></a>' because it is a child of the root element A.  It does
     not have a match in '<b><a/></b>' because in this case, B is the
     root element (and hence the child of no other element).  Nor does
     the XPath expression have a match in '<a><c><b/></c></a>'; here, B
     is a descendant of A, but not actually a child of A.

     This construct is extendable to three or more elements.  For
     example, the XPath expression '/a/b/c' matches the C element in the
     fragment '<a><b><c/></b></a>'.

   * '//TAG'

     Matches any instance of '<TAG>'.

     Example: '//a' matches the A element in any of the following:
     '<a><b><c/></b></a>'; '<c><a><b/></a></b>'; '<c><b><a/></b></c>'.

     '//' can be combined with '/'.  For example, '//a/b' matches the B
     element in either of the fragments '<a><b/></a>' or
     '<c><a><b/></a></c>'.

     *Note*:

     '//TAG' is the equivalent of '/descendant-or-self::*/TAG'.  A
     common error is to confuse this with '/descendant-or-self::TAG',
     although the latter expression can actually lead to very different
     results, as can be seen here:

          mysql> SET @xml = '<a><b><c>w</c><b>x</b><d>y</d>z</b></a>';
          Query OK, 0 rows affected (0.00 sec)

          mysql> SELECT @xml;
          +-----------------------------------------+
          | @xml                                    |
          +-----------------------------------------+
          | <a><b><c>w</c><b>x</b><d>y</d>z</b></a> |
          +-----------------------------------------+
          1 row in set (0.00 sec)

          mysql> SELECT ExtractValue(@xml, '//b[1]');
          +------------------------------+
          | ExtractValue(@xml, '//b[1]') |
          +------------------------------+
          | x z                          |
          +------------------------------+
          1 row in set (0.00 sec)

          mysql> SELECT ExtractValue(@xml, '//b[2]');
          +------------------------------+
          | ExtractValue(@xml, '//b[2]') |
          +------------------------------+
          |                              |
          +------------------------------+
          1 row in set (0.01 sec)

          mysql> SELECT ExtractValue(@xml, '/descendant-or-self::*/b[1]');
          +---------------------------------------------------+
          | ExtractValue(@xml, '/descendant-or-self::*/b[1]') |
          +---------------------------------------------------+
          | x z                                               |
          +---------------------------------------------------+
          1 row in set (0.06 sec)

          mysql> SELECT ExtractValue(@xml, '/descendant-or-self::*/b[2]');
          +---------------------------------------------------+
          | ExtractValue(@xml, '/descendant-or-self::*/b[2]') |
          +---------------------------------------------------+
          |                                                   |
          +---------------------------------------------------+
          1 row in set (0.00 sec)

          mysql> SELECT ExtractValue(@xml, '/descendant-or-self::b[1]');
          +-------------------------------------------------+
          | ExtractValue(@xml, '/descendant-or-self::b[1]') |
          +-------------------------------------------------+
          | z                                               |
          +-------------------------------------------------+
          1 row in set (0.00 sec)

          mysql> SELECT ExtractValue(@xml, '/descendant-or-self::b[2]');
          +-------------------------------------------------+
          | ExtractValue(@xml, '/descendant-or-self::b[2]') |
          +-------------------------------------------------+
          | x                                               |
          +-------------------------------------------------+
          1 row in set (0.00 sec)

   * The '*' operator acts as a 'wildcard' that matches any element.
     For example, the expression '/*/b' matches the B element in either
     of the XML fragments '<a><b/></a>' or '<c><b/></c>'.  However, the
     expression does not produce a match in the fragment '<b><a/></b>'
     because B must be a child of some other element.  The wildcard may
     be used in any position: The expression '/*/b/*' will match any
     child of a B element that is itself not the root element.

   * You can match any of several locators using the '|' (*note 'UNION':
     union.) operator.  For example, the expression '//b|//c' matches
     all B and C elements in the XML target.

   * It is also possible to match an element based on the value of one
     or more of its attributes.  This done using the syntax
     'TAG[@ATTRIBUTE="VALUE"]'.  For example, the expression
     '//b[@id="idB"]' matches the second B element in the fragment
     '<a><b id="idA"/><c/><b id="idB"/></a>'.  To match against _any_
     element having 'ATTRIBUTE="VALUE"', use the XPath expression
     '//*[ATTRIBUTE="VALUE"]'.

     To filter multiple attribute values, simply use multiple
     attribute-comparison clauses in succession.  For example, the
     expression '//b[@c="x"][@d="y"]' matches the element '<b c="x"
     d="y"/>' occurring anywhere in a given XML fragment.

     To find elements for which the same attribute matches any of
     several values, you can use multiple locators joined by the '|'
     operator.  For example, to match all B elements whose C attributes
     have either of the values 23 or 17, use the expression
     '//b[@c="23"]|//b[@c="17"]'.  You can also use the logical 'or'
     operator for this purpose: '//b[@c="23" or @c="17"]'.

     *Note*:

     The difference between 'or' and '|' is that 'or' joins conditions,
     while '|' joins result sets.

XPath Limitations

The XPath syntax supported by these functions is currently subject to
the following limitations:

   * Nodeset-to-nodeset comparison (such as ''/a/b[@c=@d]'') is not
     supported.

   * All of the standard XPath comparison operators are supported.  (Bug
     #22823)

   * Relative locator expressions are resolved in the context of the
     root node.  For example, consider the following query and result:

          mysql> SELECT ExtractValue(
              ->   '<a><b c="1">X</b><b c="2">Y</b></a>',
              ->    'a/b'
              -> ) AS result;
          +--------+
          | result |
          +--------+
          | X Y    |
          +--------+
          1 row in set (0.03 sec)

     In this case, the locator 'a/b' resolves to '/a/b'.

     Relative locators are also supported within predicates.  In the
     following example, 'd[../@c="1"]' is resolved as '/a/b[@c="1"]/d':

          mysql> SELECT ExtractValue(
              ->      '<a>
              ->        <b c="1"><d>X</d></b>
              ->        <b c="2"><d>X</d></b>
              ->      </a>',
              ->      'a/b/d[../@c="1"]')
              -> AS result;
          +--------+
          | result |
          +--------+
          | X      |
          +--------+
          1 row in set (0.00 sec)

   * Locators prefixed with expressions that evaluate as scalar
     values--including variable references, literals, numbers, and
     scalar function calls--are not permitted, and their use results in
     an error.

   * The '::' operator is not supported in combination with node types
     such as the following:

        * 'AXIS::comment()'

        * 'AXIS::text()'

        * 'AXIS::processing-instructions()'

        * 'AXIS::node()'

     However, name tests (such as 'AXIS::NAME' and 'AXIS::*') are
     supported, as shown in these examples:

          mysql> SELECT ExtractValue('<a><b>x</b><c>y</c></a>','/a/child::b');
          +-------------------------------------------------------+
          | ExtractValue('<a><b>x</b><c>y</c></a>','/a/child::b') |
          +-------------------------------------------------------+
          | x                                                     |
          +-------------------------------------------------------+
          1 row in set (0.02 sec)

          mysql> SELECT ExtractValue('<a><b>x</b><c>y</c></a>','/a/child::*');
          +-------------------------------------------------------+
          | ExtractValue('<a><b>x</b><c>y</c></a>','/a/child::*') |
          +-------------------------------------------------------+
          | x y                                                   |
          +-------------------------------------------------------+
          1 row in set (0.01 sec)

   * 'Up-and-down' navigation is not supported in cases where the path
     would lead 'above' the root element.  That is, you cannot use
     expressions which match on descendants of ancestors of a given
     element, where one or more of the ancestors of the current element
     is also an ancestor of the root element (see Bug #16321).

   * The following XPath functions are not supported, or have known
     issues as indicated:

        * 'id()'

        * 'lang()'

        * 'local-name()'

        * 'name()'

        * 'namespace-uri()'

        * 'normalize-space()'

        * 'starts-with()'

        * 'string()'

        * 'substring-after()'

        * 'substring-before()'

        * 'translate()'

   * The following axes are not supported:

        * 'following-sibling'

        * 'following'

        * 'preceding-sibling'

        * 'preceding'

XPath expressions passed as arguments to 'ExtractValue()' and
'UpdateXML()' may contain the colon character (':') in element
selectors, which enables their use with markup employing XML namespaces
notation.  For example:

     mysql> SET @xml = '<a>111<b:c>222<d>333</d><e:f>444</e:f></b:c></a>';
     Query OK, 0 rows affected (0.00 sec)

     mysql> SELECT ExtractValue(@xml, '//e:f');
     +-----------------------------+
     | ExtractValue(@xml, '//e:f') |
     +-----------------------------+
     | 444                         |
     +-----------------------------+
     1 row in set (0.00 sec)

     mysql> SELECT UpdateXML(@xml, '//b:c', '<g:h>555</g:h>');
     +--------------------------------------------+
     | UpdateXML(@xml, '//b:c', '<g:h>555</g:h>') |
     +--------------------------------------------+
     | <a>111<g:h>555</g:h></a>                   |
     +--------------------------------------------+
     1 row in set (0.00 sec)

This is similar in some respects to what is permitted by Apache Xalan
(http://xalan.apache.org/) and some other parsers, and is much simpler
than requiring namespace declarations or the use of the
'namespace-uri()' and 'local-name()' functions.

Error handling

For both 'ExtractValue()' and 'UpdateXML()', the XPath locator used must
be valid and the XML to be searched must consist of elements which are
properly nested and closed.  If the locator is invalid, an error is
generated:

     mysql> SELECT ExtractValue('<a>c</a><b/>', '/&a');
     ERROR 1105 (HY000): XPATH syntax error: '&a'

If XML_FRAG does not consist of elements which are properly nested and
closed, 'NULL' is returned and a warning is generated, as shown in this
example:

     mysql> SELECT ExtractValue('<a>c</a><b', '//a');
     +-----------------------------------+
     | ExtractValue('<a>c</a><b', '//a') |
     +-----------------------------------+
     | NULL                              |
     +-----------------------------------+
     1 row in set, 1 warning (0.00 sec)

     mysql> SHOW WARNINGS\G
     *************************** 1. row ***************************
       Level: Warning
        Code: 1525
     Message: Incorrect XML value: 'parse error at line 1 pos 11:
              END-OF-INPUT unexpected ('>' wanted)'
     1 row in set (0.00 sec)

     mysql> SELECT ExtractValue('<a>c</a><b/>', '//a');
     +-------------------------------------+
     | ExtractValue('<a>c</a><b/>', '//a') |
     +-------------------------------------+
     | c                                   |
     +-------------------------------------+
     1 row in set (0.00 sec)

*Important*:

The replacement XML used as the third argument to 'UpdateXML()' is _not_
checked to determine whether it consists solely of elements which are
properly nested and closed.

XPath Injection

_code injection_ occurs when malicious code is introduced into the
system to gain unauthorized access to privileges and data.  It is based
on exploiting assumptions made by developers about the type and content
of data input from users.  XPath is no exception in this regard.

A common scenario in which this can happen is the case of application
which handles authorization by matching the combination of a login name
and password with those found in an XML file, using an XPath expression
like this one:

     //user[login/text()='neapolitan' and password/text()='1c3cr34m']/attribute::id

This is the XPath equivalent of an SQL statement like this one:

     SELECT id FROM users WHERE login='neapolitan' AND password='1c3cr34m';

A PHP application employing XPath might handle the login process like
this:

     <?php

       $file     =   "users.xml";

       $login    =   $POST["login"];
       $password =   $POST["password"];

       $xpath = "//user[login/text()=$login and password/text()=$password]/attribute::id";

       if( file_exists($file) )
       {
         $xml = simplexml_load_file($file);

         if($result = $xml->xpath($xpath))
           echo "You are now logged in as user $result[0].";
         else
           echo "Invalid login name or password.";
       }
       else
         exit("Failed to open $file.");

     ?>

No checks are performed on the input.  This means that a malevolent user
can 'short-circuit' the test by entering '' or 1=1' for both the login
name and password, resulting in $xpath being evaluated as shown here:

     //user[login/text()='' or 1=1 and password/text()='' or 1=1]/attribute::id

Since the expression inside the square brackets always evaluates as
'true', it is effectively the same as this one, which matches the 'id'
attribute of every 'user' element in the XML document:

     //user/attribute::id

One way in which this particular attack can be circumvented is simply by
quoting the variable names to be interpolated in the definition of
'$xpath', forcing the values passed from a Web form to be converted to
strings:

     $xpath = "//user[login/text()='$login' and password/text()='$password']/attribute::id";

This is the same strategy that is often recommended for preventing SQL
injection attacks.  In general, the practices you should follow for
preventing XPath injection attacks are the same as for preventing SQL
injection:

   * Never accepted untested data from users in your application.

   * Check all user-submitted data for type; reject or convert data that
     is of the wrong type

   * Test numeric data for out of range values; truncate, round, or
     reject values that are out of range.  Test strings for illegal
     characters and either strip them out or reject input containing
     them.

   * Do not output explicit error messages that might provide an
     unauthorized user with clues that could be used to compromise the
     system; log these to a file or database table instead.

Just as SQL injection attacks can be used to obtain information about
database schemas, so can XPath injection be used to traverse XML files
to uncover their structure, as discussed in Amit Klein's paper Blind
XPath Injection
(http://www.packetstormsecurity.org/papers/bypass/Blind_XPath_Injection_20040518.pdf)
(PDF file, 46KB).

It is also important to check the output being sent back to the client.
Consider what can happen when we use the MySQL 'ExtractValue()'
function:

     mysql> SELECT ExtractValue(
         ->     LOAD_FILE('users.xml'),
         ->     '//user[login/text()="" or 1=1 and password/text()="" or 1=1]/attribute::id'
         -> ) AS id;
     +-------------------------------+
     | id                            |
     +-------------------------------+
     | 00327 13579 02403 42354 28570 |
     +-------------------------------+
     1 row in set (0.01 sec)

Because 'ExtractValue()' returns multiple matches as a single
space-delimited string, this injection attack provides every valid ID
contained within 'users.xml' to the user as a single row of output.  As
an extra safeguard, you should also test output before returning it to
the user.  Here is a simple example:

     mysql> SELECT @id = ExtractValue(
         ->     LOAD_FILE('users.xml'),
         ->     '//user[login/text()="" or 1=1 and password/text()="" or 1=1]/attribute::id'
         -> );
     Query OK, 0 rows affected (0.00 sec)

     mysql> SELECT IF(
         ->     INSTR(@id, ' ') = 0,
         ->     @id,
         ->     'Unable to retrieve user ID')
         -> AS singleID;
     +----------------------------+
     | singleID                   |
     +----------------------------+
     | Unable to retrieve user ID |
     +----------------------------+
     1 row in set (0.00 sec)

In general, the guidelines for returning data to users securely are the
same as for accepting user input.  These can be summed up as:

   * Always test outgoing data for type and permissible values.

   * Never permit unauthorized users to view error messages that might
     provide information about the application that could be used to
     exploit it.


File: manual.info.tmp,  Node: bit-functions,  Next: encryption-functions,  Prev: xml-functions,  Up: functions

12.12 Bit Functions and Operators
=================================

*Bit Functions and Operators*

Name                          Description
                              
'&'                           Bitwise AND
                              
'>>'                          Right shift
                              
'<<'                          Left shift
                              
'^'                           Bitwise XOR
                              
'BIT_COUNT()'                 Return the number of bits that are set
                              
'|'                           Bitwise OR
                              
'~'                           Bitwise inversion

Bit functions and operators comprise 'BIT_COUNT()', 'BIT_AND()',
'BIT_OR()', 'BIT_XOR()', '&', '|', '^', '~', '<<', and '>>'.
('BIT_AND()', 'BIT_OR()', and 'BIT_XOR()' are aggregate functions
described at *note group-by-functions::.)  Bit functions and operators
require *note 'BIGINT': integer-types. (64-bit integer) arguments and
return *note 'BIGINT': integer-types. values, so they have a maximum
range of 64 bits.  Arguments of other types (such as the *note 'BINARY':
binary-varbinary. and *note 'VARBINARY': binary-varbinary. binary string
types) are converted to *note 'BIGINT': integer-types. and truncation
might occur.

The following list describes available bit functions and operators:

   * 
     '|'

     Bitwise OR.

     The result is an unsigned 64-bit integer.

          mysql> SELECT 29 | 15;
                  -> 31

   * 
     '&'

     Bitwise AND.

     The result is an unsigned 64-bit integer.

          mysql> SELECT 29 & 15;
                  -> 13

   * 
     '^'

     Bitwise XOR.

     The result is an unsigned 64-bit integer.

          mysql> SELECT 1 ^ 1;
                  -> 0
          mysql> SELECT 1 ^ 0;
                  -> 1
          mysql> SELECT 11 ^ 3;
                  -> 8

   * 
     '<<'

     Shifts a longlong (*note 'BIGINT': integer-types.) number to the
     left.

     The result is an unsigned 64-bit integer.  The value is truncated
     to 64 bits.  In particular, if the shift count is greater or equal
     to the width of an unsigned 64-bit number, the result is zero.

          mysql> SELECT 1 << 2;
                  -> 4

   * 
     '>>'

     Shifts a longlong (*note 'BIGINT': integer-types.) number to the
     right.

     The result is an unsigned 64-bit integer.  The value is truncated
     to 64 bits.  In particular, if the shift count is greater or equal
     to the width of an unsigned 64-bit number, the result is zero.

          mysql> SELECT 4 >> 2;
                  -> 1

   * 
     '~'

     Invert all bits.

     The result is an unsigned 64-bit integer.

          mysql> SELECT 5 & ~1;
                  -> 4

   * 
     'BIT_COUNT(N)'

     Returns the number of bits that are set in the argument N as an
     unsigned 64-bit integer, or 'NULL' if the argument is 'NULL'.

          mysql> SELECT BIT_COUNT(29), BIT_COUNT(b'101010');
                  -> 4, 3


File: manual.info.tmp,  Node: encryption-functions,  Next: locking-functions,  Prev: bit-functions,  Up: functions

12.13 Encryption and Compression Functions
==========================================

*Encryption Functions*

Name                          Description
                              
'AES_DECRYPT()'               Decrypt using AES
                              
'AES_ENCRYPT()'               Encrypt using AES
                              
'COMPRESS()'                  Return result as a binary string
                              
'DECODE()'                    Decode a string encrypted using ENCODE()
                              
'DES_DECRYPT()'               Decrypt a string
                              
'DES_ENCRYPT()'               Encrypt a string
                              
'ENCODE()'                    Encode a string
                              
'ENCRYPT()'                   Encrypt a string
                              
'MD5()'                       Calculate MD5 checksum
                              
'OLD_PASSWORD()'              Return the value of the pre-4.1
                              implementation of PASSWORD
                              
'PASSWORD()'                  Calculate and return a password string
                              
'SHA1()', 'SHA()'             Calculate an SHA-1 160-bit checksum
                              
'SHA2()'                      Calculate an SHA-2 checksum
                              
'UNCOMPRESS()'                Uncompress a string compressed
                              
'UNCOMPRESSED_LENGTH()'       Return the length of a string before
                              compression

Many encryption and compression functions return strings for which the
result might contain arbitrary byte values.  If you want to store these
results, use a column with a *note 'VARBINARY': binary-varbinary. or
*note 'BLOB': blob. binary string data type.  This will avoid potential
problems with trailing space removal or character set conversion that
would change data values, such as may occur if you use a nonbinary
string data type (*note 'CHAR': char, *note 'VARCHAR': char, *note
'TEXT': blob.).

Some encryption functions return strings of ASCII characters: 'MD5()',
'OLD_PASSWORD()', 'PASSWORD()', 'SHA()', 'SHA1()'.  Their return value
is a string that has a character set and collation determined by the
'character_set_connection' and 'collation_connection' system variables.
This is a nonbinary string unless the character set is 'binary'.

If an application stores values from a function such as 'MD5()' or
'SHA1()' that returns a string of hex digits, more efficient storage and
comparisons can be obtained by converting the hex representation to
binary using 'UNHEX()' and storing the result in a *note 'BINARY(N)':
binary-varbinary. column.  Each pair of hexadecimal digits requires one
byte in binary form, so the value of N depends on the length of the hex
string.  N is 16 for an 'MD5()' value and 20 for a 'SHA1()' value.  For
'SHA2()', N ranges from 28 to 32 depending on the argument specifying
the desired bit length of the result.

The size penalty for storing the hex string in a *note 'CHAR': char.
column is at least two times, up to eight times if the value is stored
in a column that uses the 'utf8' character set (where each character
uses 4 bytes).  Storing the string also results in slower comparisons
because of the larger values and the need to take character set
collation rules into account.

Suppose that an application stores 'MD5()' string values in a *note
'CHAR(32)': char. column:

     CREATE TABLE md5_tbl (md5_val CHAR(32), ...);
     INSERT INTO md5_tbl (md5_val, ...) VALUES(MD5('abcdef'), ...);

To convert hex strings to more compact form, modify the application to
use 'UNHEX()' and *note 'BINARY(16)': binary-varbinary. instead as
follows:

     CREATE TABLE md5_tbl (md5_val BINARY(16), ...);
     INSERT INTO md5_tbl (md5_val, ...) VALUES(UNHEX(MD5('abcdef')), ...);

Applications should be prepared to handle the very rare case that a
hashing function produces the same value for two different input values.
One way to make collisions detectable is to make the hash column a
primary key.

*Note*:

Exploits for the MD5 and SHA-1 algorithms have become known.  You may
wish to consider using another one-way encryption function described in
this section instead, such as 'SHA2()'.

*Caution*:

Passwords or other sensitive values supplied as arguments to encryption
functions are sent as cleartext to the MySQL server unless an SSL
connection is used.  Also, such values will appear in any MySQL logs to
which they are written.  To avoid these types of exposure, applications
can encrypt sensitive values on the client side before sending them to
the server.  The same considerations apply to encryption keys.  To avoid
exposing these, applications can use stored procedures to encrypt and
decrypt values on the server side.

   * 
     'AES_DECRYPT(CRYPT_STR,KEY_STR)'

     This function decrypts data using the official AES (Advanced
     Encryption Standard) algorithm.  For more information, see the
     description of 'AES_ENCRYPT()'.

   * 
     'AES_ENCRYPT(STR,KEY_STR)'

     'AES_ENCRYPT()' and 'AES_DECRYPT()' implement encryption and
     decryption of data using the official AES (Advanced Encryption
     Standard) algorithm, previously known as 'Rijndael.' The AES
     standard permits various key lengths.  These functions implement
     AES with a 128-bit key length, but you can extend them to 256 bits
     by modifying the source.  The key length is a trade off between
     performance and security.

     'AES_ENCRYPT()' encrypts the string STR using the key string
     KEY_STR and returns a binary string containing the encrypted
     output.  'AES_DECRYPT()' decrypts the encrypted string CRYPT_STR
     using the key string KEY_STR and returns the original plaintext
     string.  If either function argument is 'NULL', the function
     returns 'NULL'.

     The STR and CRYPT_STR arguments can be any length, and padding is
     automatically added to STR so it is a multiple of a block as
     required by block-based algorithms such as AES. This padding is
     automatically removed by the 'AES_DECRYPT()' function.  The length
     of CRYPT_STR can be calculated using this formula:

          16 * (trunc(STRING_LENGTH / 16) + 1)

     For a key length of 128 bits, the most secure way to pass a key to
     the KEY_STR argument is to create a truly random 128-bit value and
     pass it as a binary value.  For example:

          INSERT INTO t
          VALUES (1,AES_ENCRYPT('text',UNHEX('F3229A0B371ED2D9441B830D21A390C3')));

     A passphrase can be used to generate an AES key by hashing the
     passphrase.  For example:

          INSERT INTO t
          VALUES (1,AES_ENCRYPT('text', UNHEX(SHA2('My secret passphrase',512))));

     Do not pass a password or passphrase directly to CRYPT_STR, hash it
     first.  Previous versions of this documentation suggested the
     former approach, but it is no longer recommended as the examples
     shown here are more secure.

     If 'AES_DECRYPT()' detects invalid data or incorrect padding, it
     returns 'NULL'.  However, it is possible for 'AES_DECRYPT()' to
     return a non-'NULL' value (possibly garbage) if the input data or
     the key is invalid.

   * 
     'COMPRESS(STRING_TO_COMPRESS)'

     Compresses a string and returns the result as a binary string.
     This function requires MySQL to have been compiled with a
     compression library such as 'zlib'.  Otherwise, the return value is
     always 'NULL'.  The compressed string can be uncompressed with
     'UNCOMPRESS()'.

          mysql> SELECT LENGTH(COMPRESS(REPEAT('a',1000)));
                  -> 21
          mysql> SELECT LENGTH(COMPRESS(''));
                  -> 0
          mysql> SELECT LENGTH(COMPRESS('a'));
                  -> 13
          mysql> SELECT LENGTH(COMPRESS(REPEAT('a',16)));
                  -> 15

     The compressed string contents are stored the following way:

        * Empty strings are stored as empty strings.

        * Nonempty strings are stored as a 4-byte length of the
          uncompressed string (low byte first), followed by the
          compressed string.  If the string ends with space, an extra
          '.' character is added to avoid problems with endspace
          trimming should the result be stored in a *note 'CHAR': char.
          or *note 'VARCHAR': char. column.  (However, use of nonbinary
          string data types such as *note 'CHAR': char. or *note
          'VARCHAR': char. to store compressed strings is not
          recommended anyway because character set conversion may occur.
          Use a *note 'VARBINARY': binary-varbinary. or *note 'BLOB':
          blob. binary string column instead.)

   * 
     'DECODE(CRYPT_STR,PASS_STR)'

     Decrypts the encrypted string CRYPT_STR using PASS_STR as the
     password.  CRYPT_STR should be a string returned from 'ENCODE()'.

   * 
     'DES_DECRYPT(CRYPT_STR[,KEY_STR])'

     Decrypts a string encrypted with 'DES_ENCRYPT()'.  If an error
     occurs, this function returns 'NULL'.

     This function works only if MySQL has been configured with SSL
     support.  See *note encrypted-connections::.

     If no KEY_STR argument is given, 'DES_DECRYPT()' examines the first
     byte of the encrypted string to determine the DES key number that
     was used to encrypt the original string, and then reads the key
     from the DES key file to decrypt the message.  For this to work,
     the user must have the 'SUPER' privilege.  The key file can be
     specified with the '--des-key-file' server option.

     If you pass this function a KEY_STR argument, that string is used
     as the key for decrypting the message.

     If the CRYPT_STR argument does not appear to be an encrypted
     string, MySQL returns the given CRYPT_STR.

   * 
     'DES_ENCRYPT(STR[,{KEY_NUM|KEY_STR}])'

     Encrypts the string with the given key using the Triple-DES
     algorithm.

     This function works only if MySQL has been configured with SSL
     support.  See *note encrypted-connections::.

     The encryption key to use is chosen based on the second argument to
     'DES_ENCRYPT()', if one was given.  With no argument, the first key
     from the DES key file is used.  With a KEY_NUM argument, the given
     key number (0 to 9) from the DES key file is used.  With a KEY_STR
     argument, the given key string is used to encrypt STR.

     The key file can be specified with the '--des-key-file' server
     option.

     The return string is a binary string where the first character is
     'CHAR(128 | KEY_NUM)'.  If an error occurs, 'DES_ENCRYPT()' returns
     'NULL'.

     The 128 is added to make it easier to recognize an encrypted key.
     If you use a string key, KEY_NUM is 127.

     The string length for the result is given by this formula:

          NEW_LEN = ORIG_LEN + (8 - (ORIG_LEN % 8)) + 1

     Each line in the DES key file has the following format:

          KEY_NUM DES_KEY_STR

     Each KEY_NUM value must be a number in the range from '0' to '9'.
     Lines in the file may be in any order.  DES_KEY_STR is the string
     that is used to encrypt the message.  There should be at least one
     space between the number and the key.  The first key is the default
     key that is used if you do not specify any key argument to
     'DES_ENCRYPT()'.

     You can tell MySQL to read new key values from the key file with
     the 'FLUSH DES_KEY_FILE' statement.  This requires the 'RELOAD'
     privilege.

     One benefit of having a set of default keys is that it gives
     applications a way to check for the existence of encrypted column
     values, without giving the end user the right to decrypt those
     values.

          mysql> SELECT customer_address FROM customer_table
               > WHERE crypted_credit_card = DES_ENCRYPT('credit_card_number');

   * 
     'ENCODE(STR,PASS_STR)'

     Encrypt STR using PASS_STR as the password.  The result is a binary
     string of the same length as STR.  To decrypt the result, use
     'DECODE()'.

     The 'ENCODE()' function should no longer be used.  If you still
     need to use 'ENCODE()', a salt value must be used with it to reduce
     risk.  For example:

          ENCODE('cleartext', CONCAT('my_random_salt','my_secret_password'))

     A new random salt value must be used whenever a password is
     updated.

   * 
     'ENCRYPT(STR[,SALT])'

     Encrypts STR using the Unix 'crypt()' system call and returns a
     binary string.  The SALT argument must be a string with at least
     two characters or the result will be 'NULL'.  If no SALT argument
     is given, a random value is used.

          mysql> SELECT ENCRYPT('hello');
                  -> 'VxuFAJXVARROc'

     'ENCRYPT()' ignores all but the first eight characters of STR, at
     least on some systems.  This behavior is determined by the
     implementation of the underlying 'crypt()' system call.

     The use of 'ENCRYPT()' with the 'ucs2', 'utf16', or 'utf32'
     multibyte character sets is not recommended because the system call
     expects a string terminated by a zero byte.

     If 'crypt()' is not available on your system (as is the case with
     Windows), 'ENCRYPT()' always returns 'NULL'.

   * 
     'MD5(STR)'

     Calculates an MD5 128-bit checksum for the string.  The value is
     returned as a string of 32 hexadecimal digits, or 'NULL' if the
     argument was 'NULL'.  The return value can, for example, be used as
     a hash key.  See the notes at the beginning of this section about
     storing hash values efficiently.

     The return value is a string in the connection character set.

          mysql> SELECT MD5('testing');
                  -> 'ae2b1fca515949e5d54fb22b8ed95575'

     This is the 'RSA Data Security, Inc. MD5 Message-Digest Algorithm.'

     See the note regarding the MD5 algorithm at the beginning this
     section.

   * 
     'OLD_PASSWORD(STR)'

     'OLD_PASSWORD()' was added when the implementation of 'PASSWORD()'
     was changed in MySQL 4.1 to improve security.  'OLD_PASSWORD()'
     returns the value of the pre-4.1 implementation of 'PASSWORD()' as
     a string, and is intended to permit you to reset passwords for any
     pre-4.1 clients that need to connect to your MySQL server without
     locking them out.  See *note password-hashing::.

     The return value is a string in the connection character set.

     *Note*:

     Passwords that use the pre-4.1 hashing method are less secure than
     passwords that use the native password hashing method and should be
     avoided.

   * 
     'PASSWORD(STR)'

     Returns a hashed password string calculated from the cleartext
     password STR.  The return value is a string in the connection
     character set, or 'NULL' if the argument is 'NULL'.  This function
     is the SQL interface to the algorithm used by the server to encrypt
     MySQL passwords for storage in the 'mysql.user' grant table.

     The 'old_passwords' system variable controls the password hashing
     method used by the 'PASSWORD()' function.  It also influences
     password hashing performed by *note 'CREATE USER': create-user. and
     *note 'GRANT': grant. statements that specify a password using an
     'IDENTIFIED BY' clause.

     The following table shows, for each password hashing method, the
     permitted value of 'old_passwords' and which authentication plugins
     use the hashing method.

     Password Hashing Method       old_passwords  Associated Authentication
                                   Value          Plugin
                                                  
     MySQL 4.1 native hashing      '0' or 'OFF'   'mysql_native_password'
                                                  
     Pre-4.1 ('old') hashing       '1' or 'ON'    'mysql_old_password'
                                   

     If 'old_passwords=1', 'PASSWORD(STR)' returns the same value as
     'OLD_PASSWORD(STR)'.  The latter function is not affected by the
     value of 'old_passwords'.

          mysql> SET old_passwords = 0;
          mysql> SELECT PASSWORD('mypass'), OLD_PASSWORD('mypass');
          +-------------------------------------------+------------------------+
          | PASSWORD('mypass')                        | OLD_PASSWORD('mypass') |
          +-------------------------------------------+------------------------+
          | *6C8989366EAF75BB670AD8EA7A7FC1176A95CEF4 | 6f8c114b58f2ce9e       |
          +-------------------------------------------+------------------------+

          mysql> SET old_passwords = 1;
          mysql> SELECT PASSWORD('mypass'), OLD_PASSWORD('mypass');
          +--------------------+------------------------+
          | PASSWORD('mypass') | OLD_PASSWORD('mypass') |
          +--------------------+------------------------+
          | 6f8c114b58f2ce9e   | 6f8c114b58f2ce9e       |
          +--------------------+------------------------+

     Encryption performed by 'PASSWORD()' is one-way (not reversible).
     It is not the same type of encryption as used for Unix passwords;
     for that, use 'ENCRYPT()'.

     *Note*:

     'PASSWORD()' is used by the authentication system in MySQL Server;
     you should _not_ use it in your own applications.  For that
     purpose, consider a more secure function such as 'AES_ENCRYPT()' or
     'SHA2()' instead.  Also see section 2 (Challenge-Response
     Authentication Mechanism (CRAM)), for more information about
     handling passwords and authentication securely in your
     applications.

     *Note*:

     Passwords that use the pre-4.1 hashing method are less secure than
     passwords that use the native password hashing method and should be
     avoided.

     *Caution*:

     Statements that invoke 'PASSWORD()' may be recorded in server logs
     or on the client side in a history file such as '~/.mysql_history',
     which means that cleartext passwords may be read by anyone having
     read access to that information.  For information about password
     logging in the server logs, see *note password-logging::.  For
     similar information about client-side logging, see *note
     mysql-logging::.

   * 
     'SHA1(STR)', 'SHA(STR)'

     Calculates an SHA-1 160-bit checksum for the string, as described
     in RFC 3174 (Secure Hash Algorithm).  The value is returned as a
     string of 40 hexadecimal digits, or 'NULL' if the argument was
     'NULL'.  One of the possible uses for this function is as a hash
     key.  See the notes at the beginning of this section about storing
     hash values efficiently.  'SHA()' is synonymous with 'SHA1()'.

     The return value is a string in the connection character set.

          mysql> SELECT SHA1('abc');
                  -> 'a9993e364706816aba3e25717850c26c9cd0d89d'

     'SHA1()' can be considered a cryptographically more secure
     equivalent of 'MD5()'.  However, see the note regarding the MD5 and
     SHA-1 algorithms at the beginning this section.

   * 
     'SHA2(STR, HASH_LENGTH)'

     Calculates the SHA-2 family of hash functions (SHA-224, SHA-256,
     SHA-384, and SHA-512).  The first argument is the plaintext string
     to be hashed.  The second argument indicates the desired bit length
     of the result, which must have a value of 224, 256, 384, 512, or 0
     (which is equivalent to 256).  If either argument is 'NULL' or the
     hash length is not one of the permitted values, the return value is
     'NULL'.  Otherwise, the function result is a hash value containing
     the desired number of bits.  See the notes at the beginning of this
     section about storing hash values efficiently.

     The return value is a string in the connection character set.

          mysql> SELECT SHA2('abc', 224);
                  -> '23097d223405d8228642a477bda255b32aadbce4bda0b3f7e36c9da7'

     This function works only if MySQL has been configured with SSL
     support.  See *note encrypted-connections::.

     'SHA2()' can be considered cryptographically more secure than
     'MD5()' or 'SHA1()'.

   * 
     'UNCOMPRESS(STRING_TO_UNCOMPRESS)'

     Uncompresses a string compressed by the 'COMPRESS()' function.  If
     the argument is not a compressed value, the result is 'NULL'.  This
     function requires MySQL to have been compiled with a compression
     library such as 'zlib'.  Otherwise, the return value is always
     'NULL'.

          mysql> SELECT UNCOMPRESS(COMPRESS('any string'));
                  -> 'any string'
          mysql> SELECT UNCOMPRESS('any string');
                  -> NULL

   * 
     'UNCOMPRESSED_LENGTH(COMPRESSED_STRING)'

     Returns the length that the compressed string had before being
     compressed.

          mysql> SELECT UNCOMPRESSED_LENGTH(COMPRESS(REPEAT('a',30)));
                  -> 30


File: manual.info.tmp,  Node: locking-functions,  Next: information-functions,  Prev: encryption-functions,  Up: functions

12.14 Locking Functions
=======================

This section describes functions used to manipulate user-level locks.

*Locking Functions*

Name                          Description
                              
'GET_LOCK()'                  Get a named lock
                              
'IS_FREE_LOCK()'              Whether the named lock is free
                              
'IS_USED_LOCK()'              Whether the named lock is in use; return
                              connection identifier if true
                              
'RELEASE_LOCK()'              Release the named lock

   * 
     'GET_LOCK(STR,TIMEOUT)'

     Tries to obtain a lock with a name given by the string STR, using a
     timeout of TIMEOUT seconds.  A negative TIMEOUT value means
     infinite timeout.

     Returns '1' if the lock was obtained successfully, '0' if the
     attempt timed out (for example, because another client has
     previously locked the name), or 'NULL' if an error occurred (such
     as running out of memory or the thread was killed with *note
     'mysqladmin kill': mysqladmin.).

     A lock obtained with 'GET_LOCK()' is released explicitly by
     executing 'RELEASE_LOCK()' or implicitly when your session
     terminates (either normally or abnormally).  Locks obtained with
     'GET_LOCK()' are not released when transactions commit or roll
     back.

     *Important*:

     The behavior of 'GET_LOCK()' changes in MySQL 5.7.  In
     consideration of future upgrades, limit the STR value to 64
     characters or less and do not rely on subsequent calls to
     'GET_LOCK()' releasing previous locks.

     'GET_LOCK()' can be used to implement application locks or to
     simulate record locks.  Names are locked on a server-wide basis.
     If a name has been locked within one session, 'GET_LOCK()' blocks
     any request by another session for a lock with the same name.  This
     enables clients that agree on a given lock name to use the name to
     perform cooperative advisory locking.  But be aware that it also
     enables a client that is not among the set of cooperating clients
     to lock a name, either inadvertently or deliberately, and thus
     prevent any of the cooperating clients from locking that name.  One
     way to reduce the likelihood of this is to use lock names that are
     database-specific or application-specific.  For example, use lock
     names of the form DB_NAME.STR or APP_NAME.STR.

          mysql> SELECT GET_LOCK('lock1',10);
                  -> 1
          mysql> SELECT IS_FREE_LOCK('lock2');
                  -> 1
          mysql> SELECT GET_LOCK('lock2',10);
                  -> 1
          mysql> SELECT RELEASE_LOCK('lock2');
                  -> 1
          mysql> SELECT RELEASE_LOCK('lock1');
                  -> NULL

     The second 'RELEASE_LOCK()' call returns 'NULL' because the lock
     ''lock1'' was automatically released by the second 'GET_LOCK()'
     call.

     If multiple clients are waiting for a lock, the order in which they
     will acquire it is undefined.  Applications should not assume that
     clients will acquire the lock in the same order that they issued
     the lock requests.

     'GET_LOCK()' is unsafe for statement-based replication.  A warning
     is logged if you use this function when 'binlog_format' is set to
     'STATEMENT'.

   * 
     'IS_FREE_LOCK(STR)'

     Checks whether the lock named STR is free to use (that is, not
     locked).  Returns '1' if the lock is free (no one is using the
     lock), '0' if the lock is in use, and 'NULL' if an error occurs
     (such as an incorrect argument).

     This function is unsafe for statement-based replication.  A warning
     is logged if you use this function when 'binlog_format' is set to
     'STATEMENT'.

   * 
     'IS_USED_LOCK(STR)'

     Checks whether the lock named STR is in use (that is, locked).  If
     so, it returns the connection identifier of the client session that
     holds the lock.  Otherwise, it returns 'NULL'.

     This function is unsafe for statement-based replication.  A warning
     is logged if you use this function when 'binlog_format' is set to
     'STATEMENT'.

   * 
     'RELEASE_LOCK(STR)'

     Releases the lock named by the string STR that was obtained with
     'GET_LOCK()'.  Returns '1' if the lock was released, '0' if the
     lock was not established by this thread (in which case the lock is
     not released), and 'NULL' if the named lock did not exist.  The
     lock does not exist if it was never obtained by a call to
     'GET_LOCK()' or if it has previously been released.

     The *note 'DO': do. statement is convenient to use with
     'RELEASE_LOCK()'.  See *note do::.

     This function is unsafe for statement-based replication.  A warning
     is logged if you use this function when 'binlog_format' is set to
     'STATEMENT'.


File: manual.info.tmp,  Node: information-functions,  Next: spatial-analysis-functions,  Prev: locking-functions,  Up: functions

12.15 Information Functions
===========================

*Information Functions*

Name                          Description
                              
'BENCHMARK()'                 Repeatedly execute an expression
                              
'CHARSET()'                   Return the character set of the argument
                              
'COERCIBILITY()'              Return the collation coercibility value
                              of the string argument
                              
'COLLATION()'                 Return the collation of the string
                              argument
                              
'CONNECTION_ID()'             Return the connection ID (thread ID) for
                              the connection
                              
'CURRENT_USER()',             The authenticated user name and host name
'CURRENT_USER'                

'DATABASE()'                  Return the default (current) database
                              name
                              
'FOUND_ROWS()'                For a SELECT with a LIMIT clause, the
                              number of rows that would be returned
                              were there no LIMIT clause
                              
'LAST_INSERT_ID()'            Value of the AUTOINCREMENT column for the
                              last INSERT
                              
'ROW_COUNT()'                 The number of rows updated
                              
'SCHEMA()'                    Synonym for DATABASE()
                              
'SESSION_USER()'              Synonym for USER()
                              
'SYSTEM_USER()'               Synonym for USER()
                              
'USER()'                      The user name and host name provided by
                              the client
                              
'VERSION()'                   Return a string that indicates the MySQL
                              server version

   * 
     'BENCHMARK(COUNT,EXPR)'

     The 'BENCHMARK()' function executes the expression EXPR repeatedly
     COUNT times.  It may be used to time how quickly MySQL processes
     the expression.  The result value is '0', or 'NULL' for
     inappropriate arguments such as a 'NULL' or negative repeat count.

     The intended use is from within the *note 'mysql': mysql. client,
     which reports query execution times:

          mysql> SELECT BENCHMARK(1000000,AES_ENCRYPT('hello','goodbye'));
          +---------------------------------------------------+
          | BENCHMARK(1000000,AES_ENCRYPT('hello','goodbye')) |
          +---------------------------------------------------+
          |                                                 0 |
          +---------------------------------------------------+
          1 row in set (4.74 sec)

     The time reported is elapsed time on the client end, not CPU time
     on the server end.  It is advisable to execute 'BENCHMARK()'
     several times, and to interpret the result with regard to how
     heavily loaded the server machine is.

     'BENCHMARK()' is intended for measuring the runtime performance of
     scalar expressions, which has some significant implications for the
     way that you use it and interpret the results:

        * Only scalar expressions can be used.  Although the expression
          can be a subquery, it must return a single column and at most
          a single row.  For example, 'BENCHMARK(10, (SELECT * FROM t))'
          will fail if the table 't' has more than one column or more
          than one row.

        * Executing a 'SELECT EXPR' statement N times differs from
          executing 'SELECT BENCHMARK(N, EXPR)' in terms of the amount
          of overhead involved.  The two have very different execution
          profiles and you should not expect them to take the same
          amount of time.  The former involves the parser, optimizer,
          table locking, and runtime evaluation N times each.  The
          latter involves only runtime evaluation N times, and all the
          other components just once.  Memory structures already
          allocated are reused, and runtime optimizations such as local
          caching of results already evaluated for aggregate functions
          can alter the results.  Use of 'BENCHMARK()' thus measures
          performance of the runtime component by giving more weight to
          that component and removing the 'noise' introduced by the
          network, parser, optimizer, and so forth.

   * 
     'CHARSET(STR)'

     Returns the character set of the string argument.

          mysql> SELECT CHARSET('abc');
                  -> 'latin1'
          mysql> SELECT CHARSET(CONVERT('abc' USING utf8));
                  -> 'utf8'
          mysql> SELECT CHARSET(USER());
                  -> 'utf8'

   * 
     'COERCIBILITY(STR)'

     Returns the collation coercibility value of the string argument.

          mysql> SELECT COERCIBILITY('abc' COLLATE latin1_swedish_ci);
                  -> 0
          mysql> SELECT COERCIBILITY(USER());
                  -> 3
          mysql> SELECT COERCIBILITY('abc');
                  -> 4
          mysql> SELECT COERCIBILITY(1000);
                  -> 5

     The return values have the meanings shown in the following table.
     Lower values have higher precedence.

     CoercibilityMeaning     Example
                             
     '0'         Explicit    Value with 'COLLATE' clause
                 collation   
                 
     '1'         No          Concatenation of strings with different
                 collation   collations
                             
     '2'         Implicit    Column value, stored routine parameter or local
                 collation   variable
                             
     '3'         System      'USER()' return value
                 constant    
                 
     '4'         Coercible   Literal string
                             
     '5'         Numeric     Numeric or temporal value
                             
     '5'         Ignorable   'NULL' or an expression derived from 'NULL'
                 

     For more information, see *note charset-collation-coercibility::.

   * 
     'COLLATION(STR)'

     Returns the collation of the string argument.

          mysql> SELECT COLLATION('abc');
                  -> 'latin1_swedish_ci'
          mysql> SELECT COLLATION(_utf8'abc');
                  -> 'utf8_general_ci'

   * 
     'CONNECTION_ID()'

     Returns the connection ID (thread ID) for the connection.  Every
     connection has an ID that is unique among the set of currently
     connected clients.

     The value returned by 'CONNECTION_ID()' is the same type of value
     as displayed in the 'ID' column of the *note
     'INFORMATION_SCHEMA.PROCESSLIST': processlist-table. table, the
     'Id' column of *note 'SHOW PROCESSLIST': show-processlist. output,
     and the 'PROCESSLIST_ID' column of the Performance Schema *note
     'threads': threads-table. table.

          mysql> SELECT CONNECTION_ID();
                  -> 23786

   * 
     'CURRENT_USER', 'CURRENT_USER()'

     Returns the user name and host name combination for the MySQL
     account that the server used to authenticate the current client.
     This account determines your access privileges.  The return value
     is a string in the 'utf8' character set.

     The value of 'CURRENT_USER()' can differ from the value of
     'USER()'.

          mysql> SELECT USER();
                  -> 'davida@localhost'
          mysql> SELECT * FROM mysql.user;
          ERROR 1044: Access denied for user ''@'localhost' to
          database 'mysql'
          mysql> SELECT CURRENT_USER();
                  -> '@localhost'

     The example illustrates that although the client specified a user
     name of 'davida' (as indicated by the value of the 'USER()'
     function), the server authenticated the client using an anonymous
     user account (as seen by the empty user name part of the
     'CURRENT_USER()' value).  One way this might occur is that there is
     no account listed in the grant tables for 'davida'.

     Within a stored program or view, 'CURRENT_USER()' returns the
     account for the user who defined the object (as given by its
     'DEFINER' value) unless defined with the 'SQL SECURITY INVOKER'
     characteristic.  In the latter case, 'CURRENT_USER()' returns the
     object's invoker.

     Triggers and events have no option to define the 'SQL SECURITY'
     characteristic, so for these objects, 'CURRENT_USER()' returns the
     account for the user who defined the object.  To return the
     invoker, use 'USER()' or 'SESSION_USER()'.

     The following statements support use of the 'CURRENT_USER()'
     function to take the place of the name of (and, possibly, a host
     for) an affected user or a definer; in such cases, 'CURRENT_USER()'
     is expanded where and as needed:

        * *note 'DROP USER': drop-user.

        * *note 'RENAME USER': rename-user.

        * *note 'GRANT': grant.

        * *note 'REVOKE': revoke.

        * *note 'CREATE FUNCTION': create-function.

        * *note 'CREATE PROCEDURE': create-procedure.

        * *note 'CREATE TRIGGER': create-trigger.

        * *note 'CREATE EVENT': create-event.

        * *note 'CREATE VIEW': create-view.

        * *note 'ALTER EVENT': alter-event.

        * *note 'ALTER VIEW': alter-view.

        * *note 'SET PASSWORD': set-password.

     For information about the implications that this expansion of
     'CURRENT_USER()' has for replication, see *note
     replication-features-current-user::.

   * 
     'DATABASE()'

     Returns the default (current) database name as a string in the
     'utf8' character set.  If there is no default database,
     'DATABASE()' returns 'NULL'.  Within a stored routine, the default
     database is the database that the routine is associated with, which
     is not necessarily the same as the database that is the default in
     the calling context.

          mysql> SELECT DATABASE();
                  -> 'test'

     If there is no default database, 'DATABASE()' returns 'NULL'.

   * 
     'FOUND_ROWS()'

     A *note 'SELECT': select. statement may include a 'LIMIT' clause to
     restrict the number of rows the server returns to the client.  In
     some cases, it is desirable to know how many rows the statement
     would have returned without the 'LIMIT', but without running the
     statement again.  To obtain this row count, include an
     'SQL_CALC_FOUND_ROWS' option in the *note 'SELECT': select.
     statement, and then invoke 'FOUND_ROWS()' afterward:

          mysql> SELECT SQL_CALC_FOUND_ROWS * FROM TBL_NAME
              -> WHERE id > 100 LIMIT 10;
          mysql> SELECT FOUND_ROWS();

     The second *note 'SELECT': select. returns a number indicating how
     many rows the first *note 'SELECT': select. would have returned had
     it been written without the 'LIMIT' clause.

     In the absence of the 'SQL_CALC_FOUND_ROWS' option in the most
     recent successful *note 'SELECT': select. statement, 'FOUND_ROWS()'
     returns the number of rows in the result set returned by that
     statement.  If the statement includes a 'LIMIT' clause,
     'FOUND_ROWS()' returns the number of rows up to the limit.  For
     example, 'FOUND_ROWS()' returns 10 or 60, respectively, if the
     statement includes 'LIMIT 10' or 'LIMIT 50, 10'.

     The row count available through 'FOUND_ROWS()' is transient and not
     intended to be available past the statement following the 'SELECT
     SQL_CALC_FOUND_ROWS' statement.  If you need to refer to the value
     later, save it:

          mysql> SELECT SQL_CALC_FOUND_ROWS * FROM ... ;
          mysql> SET @rows = FOUND_ROWS();

     If you are using 'SELECT SQL_CALC_FOUND_ROWS', MySQL must calculate
     how many rows are in the full result set.  However, this is faster
     than running the query again without 'LIMIT', because the result
     set need not be sent to the client.

     'SQL_CALC_FOUND_ROWS' and 'FOUND_ROWS()' can be useful in
     situations when you want to restrict the number of rows that a
     query returns, but also determine the number of rows in the full
     result set without running the query again.  An example is a Web
     script that presents a paged display containing links to the pages
     that show other sections of a search result.  Using 'FOUND_ROWS()'
     enables you to determine how many other pages are needed for the
     rest of the result.

     The use of 'SQL_CALC_FOUND_ROWS' and 'FOUND_ROWS()' is more complex
     for *note 'UNION': union. statements than for simple *note
     'SELECT': select. statements, because 'LIMIT' may occur at multiple
     places in a *note 'UNION': union.  It may be applied to individual
     *note 'SELECT': select. statements in the *note 'UNION': union, or
     global to the *note 'UNION': union. result as a whole.

     The intent of 'SQL_CALC_FOUND_ROWS' for *note 'UNION': union. is
     that it should return the row count that would be returned without
     a global 'LIMIT'.  The conditions for use of 'SQL_CALC_FOUND_ROWS'
     with *note 'UNION': union. are:

        * The 'SQL_CALC_FOUND_ROWS' keyword must appear in the first
          *note 'SELECT': select. of the *note 'UNION': union.

        * The value of 'FOUND_ROWS()' is exact only if *note 'UNION
          ALL': union. is used.  If *note 'UNION': union. without 'ALL'
          is used, duplicate removal occurs and the value of
          'FOUND_ROWS()' is only approximate.

        * If no 'LIMIT' is present in the *note 'UNION': union,
          'SQL_CALC_FOUND_ROWS' is ignored and returns the number of
          rows in the temporary table that is created to process the
          *note 'UNION': union.

     Beyond the cases described here, the behavior of 'FOUND_ROWS()' is
     undefined (for example, its value following a *note 'SELECT':
     select. statement that fails with an error).

     *Important*:

     'FOUND_ROWS()' is not replicated reliably using statement-based
     replication.  This function is automatically replicated using
     row-based replication.

   * 
     'LAST_INSERT_ID()', 'LAST_INSERT_ID(EXPR)'

     With no argument, 'LAST_INSERT_ID()' returns a 64-bit value
     representing the first automatically generated value successfully
     inserted for an 'AUTO_INCREMENT' column as a result of the most
     recently executed *note 'INSERT': insert. statement.  The value has
     a type of 'BIGINT UNSIGNED' as of MySQL 5.5.29, 'BIGINT' (signed)
     before that.  The value of 'LAST_INSERT_ID()' remains unchanged if
     no rows are successfully inserted.

     With an argument, 'LAST_INSERT_ID()' returns an unsigned integer as
     of MySQL 5.5.29, a signed integer before that.

     For example, after inserting a row that generates an
     'AUTO_INCREMENT' value, you can get the value like this:

          mysql> SELECT LAST_INSERT_ID();
                  -> 195

     The currently executing statement does not affect the value of
     'LAST_INSERT_ID()'.  Suppose that you generate an 'AUTO_INCREMENT'
     value with one statement, and then refer to 'LAST_INSERT_ID()' in a
     multiple-row *note 'INSERT': insert. statement that inserts rows
     into a table with its own 'AUTO_INCREMENT' column.  The value of
     'LAST_INSERT_ID()' will remain stable in the second statement; its
     value for the second and later rows is not affected by the earlier
     row insertions.  (However, if you mix references to
     'LAST_INSERT_ID()' and 'LAST_INSERT_ID(EXPR)', the effect is
     undefined.)

     If the previous statement returned an error, the value of
     'LAST_INSERT_ID()' is undefined.  For transactional tables, if the
     statement is rolled back due to an error, the value of
     'LAST_INSERT_ID()' is left undefined.  For manual *note 'ROLLBACK':
     commit, the value of 'LAST_INSERT_ID()' is not restored to that
     before the transaction; it remains as it was at the point of the
     *note 'ROLLBACK': commit.

     Prior to MySQL 5.5.35, this function was not replicated correctly
     if replication filtering rules were in use.  (Bug #17234370, Bug
     #69861)

     Within the body of a stored routine (procedure or function) or a
     trigger, the value of 'LAST_INSERT_ID()' changes the same way as
     for statements executed outside the body of these kinds of objects.
     The effect of a stored routine or trigger upon the value of
     'LAST_INSERT_ID()' that is seen by following statements depends on
     the kind of routine:

        * If a stored procedure executes statements that change the
          value of 'LAST_INSERT_ID()', the changed value is seen by
          statements that follow the procedure call.

        * For stored functions and triggers that change the value, the
          value is restored when the function or trigger ends, so
          following statements will not see a changed value.

     The ID that was generated is maintained in the server on a
     _per-connection basis_.  This means that the value returned by the
     function to a given client is the first 'AUTO_INCREMENT' value
     generated for most recent statement affecting an 'AUTO_INCREMENT'
     column _by that client_.  This value cannot be affected by other
     clients, even if they generate 'AUTO_INCREMENT' values of their
     own.  This behavior ensures that each client can retrieve its own
     ID without concern for the activity of other clients, and without
     the need for locks or transactions.

     The value of 'LAST_INSERT_ID()' is not changed if you set the
     'AUTO_INCREMENT' column of a row to a non-'magic' value (that is, a
     value that is not 'NULL' and not '0').

     *Important*:

     If you insert multiple rows using a single *note 'INSERT': insert.
     statement, 'LAST_INSERT_ID()' returns the value generated for the
     _first_ inserted row _only_.  The reason for this is to make it
     possible to reproduce easily the same *note 'INSERT': insert.
     statement against some other server.

     For example:

          mysql> USE test;

          mysql> CREATE TABLE t (
                 id INT AUTO_INCREMENT NOT NULL PRIMARY KEY,
                 name VARCHAR(10) NOT NULL
                 );

          mysql> INSERT INTO t VALUES (NULL, 'Bob');

          mysql> SELECT * FROM t;
          +----+------+
          | id | name |
          +----+------+
          |  1 | Bob  |
          +----+------+

          mysql> SELECT LAST_INSERT_ID();
          +------------------+
          | LAST_INSERT_ID() |
          +------------------+
          |                1 |
          +------------------+

          mysql> INSERT INTO t VALUES
                 (NULL, 'Mary'), (NULL, 'Jane'), (NULL, 'Lisa');

          mysql> SELECT * FROM t;
          +----+------+
          | id | name |
          +----+------+
          |  1 | Bob  |
          |  2 | Mary |
          |  3 | Jane |
          |  4 | Lisa |
          +----+------+

          mysql> SELECT LAST_INSERT_ID();
          +------------------+
          | LAST_INSERT_ID() |
          +------------------+
          |                2 |
          +------------------+

     Although the second *note 'INSERT': insert. statement inserted
     three new rows into 't', the ID generated for the first of these
     rows was '2', and it is this value that is returned by
     'LAST_INSERT_ID()' for the following *note 'SELECT': select.
     statement.

     If you use *note 'INSERT IGNORE': insert. and the row is ignored,
     the 'LAST_INSERT_ID()' remains unchanged from the current value (or
     0 is returned if the connection has not yet performed a successful
     'INSERT') and, for non-transactional tables, the 'AUTO_INCREMENT'
     counter is not incremented.  For 'InnoDB' tables, the
     'AUTO_INCREMENT' counter is incremented if
     'innodb_autoinc_lock_mode' is set to '1' or '2', as demonstrated in
     the following example:

          mysql> USE test;

          mysql> SELECT @@innodb_autoinc_lock_mode;
          +----------------------------+
          | @@innodb_autoinc_lock_mode |
          +----------------------------+
          |                          1 |
          +----------------------------+

          mysql> CREATE TABLE `t` (
                 `id` INT(11) NOT NULL AUTO_INCREMENT,
                 `val` INT(11) DEFAULT NULL,
                 PRIMARY KEY (`id`),
                 UNIQUE KEY `i1` (`val`)
                 ) ENGINE=InnoDB DEFAULT CHARSET=latin1;

          # Insert two rows

          mysql> INSERT INTO t (val) VALUES (1),(2);

          # With auto_increment_offset=1, the inserted rows
          # result in an AUTO_INCREMENT value of 3

          mysql> SHOW CREATE TABLE t\G
          *************************** 1. row ***************************
                 Table: t
          Create Table: CREATE TABLE `t` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `val` int(11) DEFAULT NULL,
            PRIMARY KEY (`id`),
            UNIQUE KEY `i1` (`val`)
          ) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=latin1

          # LAST_INSERT_ID() returns the first automatically generated
          # value that is successfully inserted for the AUTO_INCREMENT column

          mysql> SELECT LAST_INSERT_ID();
          +------------------+
          | LAST_INSERT_ID() |
          +------------------+
          |                1 |
          +------------------+

          # The attempted insertion of duplicate rows fail but errors are ignored

          mysql> INSERT IGNORE INTO t (val) VALUES (1),(2);
          Query OK, 0 rows affected (0.00 sec)
          Records: 2  Duplicates: 2  Warnings: 0

          # With innodb_autoinc_lock_mode=1, the AUTO_INCREMENT counter
          # is incremented for the ignored rows

          mysql> SHOW CREATE TABLE t\G
          *************************** 1. row ***************************
                 Table: t
          Create Table: CREATE TABLE `t` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `val` int(11) DEFAULT NULL,
            PRIMARY KEY (`id`),
            UNIQUE KEY `i1` (`val`)
          ) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=latin1

          # The LAST_INSERT_ID is unchanged because the previous insert was unsuccessful

          mysql> SELECT LAST_INSERT_ID();
          +------------------+
          | LAST_INSERT_ID() |
          +------------------+
          |                1 |
          +------------------+

     For more information, see *note innodb-auto-increment-handling::.

     If EXPR is given as an argument to 'LAST_INSERT_ID()', the value of
     the argument is returned by the function and is remembered as the
     next value to be returned by 'LAST_INSERT_ID()'.  This can be used
     to simulate sequences:

       1. Create a table to hold the sequence counter and initialize it:

               mysql> CREATE TABLE sequence (id INT NOT NULL);
               mysql> INSERT INTO sequence VALUES (0);

       2. Use the table to generate sequence numbers like this:

               mysql> UPDATE sequence SET id=LAST_INSERT_ID(id+1);
               mysql> SELECT LAST_INSERT_ID();

          The *note 'UPDATE': update. statement increments the sequence
          counter and causes the next call to 'LAST_INSERT_ID()' to
          return the updated value.  The *note 'SELECT': select.
          statement retrieves that value.  The *note
          'mysql_insert_id()': mysql-insert-id. C API function can also
          be used to get the value.  See *note mysql-insert-id::.

     You can generate sequences without calling 'LAST_INSERT_ID()', but
     the utility of using the function this way is that the ID value is
     maintained in the server as the last automatically generated value.
     It is multi-user safe because multiple clients can issue the *note
     'UPDATE': update. statement and get their own sequence value with
     the *note 'SELECT': select. statement (or *note
     'mysql_insert_id()': mysql-insert-id.), without affecting or being
     affected by other clients that generate their own sequence values.

     Note that *note 'mysql_insert_id()': mysql-insert-id. is only
     updated after *note 'INSERT': insert. and *note 'UPDATE': update.
     statements, so you cannot use the C API function to retrieve the
     value for 'LAST_INSERT_ID(EXPR)' after executing other SQL
     statements like *note 'SELECT': select. or *note 'SET':
     set-variable.

   * 
     'ROW_COUNT()'

     'ROW_COUNT()' returns a value as follows:

        * DDL statements: 0.  This applies to statements such as *note
          'CREATE TABLE': create-table. or *note 'DROP TABLE':
          drop-table.

        * DML statements other than *note 'SELECT': select.: The number
          of affected rows.  This applies to statements such as *note
          'UPDATE': update, *note 'INSERT': insert, or *note 'DELETE':
          delete. (as before), but now also to statements such as *note
          'ALTER TABLE': alter-table. and *note 'LOAD DATA': load-data.

        * *note 'SELECT': select.: -1 if the statement returns a result
          set, or the number of rows 'affected' if it does not.  For
          example, for 'SELECT * FROM t1', 'ROW_COUNT()' returns -1.
          For 'SELECT * FROM t1 INTO OUTFILE 'FILE_NAME'', 'ROW_COUNT()'
          returns the number of rows written to the file.

        * *note 'SIGNAL': signal. statements: 0.

     For *note 'UPDATE': update. statements, the affected-rows value by
     default is the number of rows actually changed.  If you specify the
     'CLIENT_FOUND_ROWS' flag to *note 'mysql_real_connect()':
     mysql-real-connect. when connecting to *note 'mysqld': mysqld, the
     affected-rows value is the number of rows 'found'; that is, matched
     by the 'WHERE' clause.

     For *note 'REPLACE': replace. statements, the affected-rows value
     is 2 if the new row replaced an old row, because in this case, one
     row was inserted after the duplicate was deleted.

     For *note 'INSERT ... ON DUPLICATE KEY UPDATE':
     insert-on-duplicate. statements, the affected-rows value per row is
     1 if the row is inserted as a new row, 2 if an existing row is
     updated, and 0 if an existing row is set to its current values.  If
     you specify the 'CLIENT_FOUND_ROWS' flag, the affected-rows value
     is 1 (not 0) if an existing row is set to its current values.

     The 'ROW_COUNT()' value is similar to the value from the *note
     'mysql_affected_rows()': mysql-affected-rows. C API function and
     the row count that the *note 'mysql': mysql. client displays
     following statement execution.

          mysql> INSERT INTO t VALUES(1),(2),(3);
          Query OK, 3 rows affected (0.00 sec)
          Records: 3  Duplicates: 0  Warnings: 0

          mysql> SELECT ROW_COUNT();
          +-------------+
          | ROW_COUNT() |
          +-------------+
          |           3 |
          +-------------+
          1 row in set (0.00 sec)

          mysql> DELETE FROM t WHERE i IN(1,2);
          Query OK, 2 rows affected (0.00 sec)

          mysql> SELECT ROW_COUNT();
          +-------------+
          | ROW_COUNT() |
          +-------------+
          |           2 |
          +-------------+
          1 row in set (0.00 sec)

     *Important*:

     'ROW_COUNT()' is not replicated reliably using statement-based
     replication.  This function is automatically replicated using
     row-based replication.

   * 
     'SCHEMA()'

     This function is a synonym for 'DATABASE()'.

   * 
     'SESSION_USER()'

     'SESSION_USER()' is a synonym for 'USER()'.

   * 
     'SYSTEM_USER()'

     'SYSTEM_USER()' is a synonym for 'USER()'.

   * 
     'USER()'

     Returns the current MySQL user name and host name as a string in
     the 'utf8' character set.

          mysql> SELECT USER();
                  -> 'davida@localhost'

     The value indicates the user name you specified when connecting to
     the server, and the client host from which you connected.  The
     value can be different from that of 'CURRENT_USER()'.

   * 
     'VERSION()'

     Returns a string that indicates the MySQL server version.  The
     string uses the 'utf8' character set.  The value might have a
     suffix in addition to the version number.  See the description of
     the 'version' system variable in *note server-system-variables::.

     This function is unsafe for statement-based replication.  A warning
     is logged if you use this function when 'binlog_format' is set to
     'STATEMENT'.

          mysql> SELECT VERSION();
                  -> '5.5.62-standard'


File: manual.info.tmp,  Node: spatial-analysis-functions,  Next: group-by-functions-and-modifiers,  Prev: information-functions,  Up: functions

12.16 Spatial Analysis Functions
================================

* Menu:

* spatial-function-reference::   Spatial Function Reference
* spatial-function-argument-handling::  Argument Handling by Spatial Functions
* gis-wkt-functions::            Functions That Create Geometry Values from WKT Values
* gis-wkb-functions::            Functions That Create Geometry Values from WKB Values
* gis-mysql-specific-functions::  MySQL-Specific Functions That Create Geometry Values
* gis-format-conversion-functions::  Geometry Format Conversion Functions
* gis-property-functions::       Geometry Property Functions
* spatial-operator-functions::   Spatial Operator Functions
* spatial-relation-functions::   Functions That Test Spatial Relations Between Geometry Objects

MySQL provides functions to perform various operations on spatial data.
These functions can be grouped into several major categories according
to the type of operation they perform:

   * Functions that create geometries in various formats (WKT, WKB,
     internal)

   * Functions that convert geometries between formats

   * Functions that access qualitative or quantitative properties of a
     geometry

   * Functions that describe relations between two geometries

   * Functions that create new geometries from existing ones

For general background about MySQL support for using spatial data, see
*note spatial-types::.


File: manual.info.tmp,  Node: spatial-function-reference,  Next: spatial-function-argument-handling,  Prev: spatial-analysis-functions,  Up: spatial-analysis-functions

12.16.1 Spatial Function Reference
----------------------------------

The following table lists each spatial function and provides a short
description of each one.

*Spatial Functions*

Name                          Description
                              
'Area()'                      Return Polygon or MultiPolygon area
                              
'AsBinary()', 'AsWKB()'       Convert from internal geometry format to
                              WKB
                              
'AsText()', 'AsWKT()'         Convert from internal geometry format to
                              WKT
                              
'Centroid()'                  Return centroid as a point
                              
'Contains()'                  Whether MBR of one geometry contains MBR
                              of another
                              
'Crosses()'                   Whether one geometry crosses another
                              
'Dimension()'                 Dimension of geometry
                              
'Disjoint()'                  Whether MBRs of two geometries are
                              disjoint
                              
'EndPoint()'                  End Point of LineString
                              
'Envelope()'                  Return MBR of geometry
                              
'Equals()'                    Whether MBRs of two geometries are equal
                              
'ExteriorRing()'              Return exterior ring of Polygon
                              
'GeomCollFromText()',         Return geometry collection from WKT
'GeometryCollectionFromText()'

'GeomCollFromWKB()',          Return geometry collection from WKB
'GeometryCollectionFromWKB()' 

'GeometryCollection()'        Construct geometry collection from
                              geometries
                              
'GeometryN()'                 Return N-th geometry from geometry
                              collection
                              
'GeometryType()'              Return name of geometry type
                              
'GeomFromText()',             Return geometry from WKT
'GeometryFromText()'          

'GeomFromWKB()',              Return geometry from WKB
'GeometryFromWKB()'           

'GLength()'                   Return length of LineString
                              
'InteriorRingN()'             Return N-th interior ring of Polygon
                              
'Intersects()'                Whether MBRs of two geometries intersect
                              
'IsClosed()'                  Whether a geometry is closed and simple
                              
'IsEmpty()'                   Placeholder function
                              
'IsSimple()'                  Whether a geometry is simple
                              
'LineFromText()',             Construct LineString from WKT
'LineStringFromText()'        

'LineFromWKB()',              Construct LineString from WKB
'LineStringFromWKB()'         

'LineString()'                Construct LineString from Point values
                              
'MBRContains()'               Whether MBR of one geometry contains MBR
                              of another
                              
'MBRDisjoint()'               Whether MBRs of two geometries are
                              disjoint
                              
'MBREqual()'                  Whether MBRs of two geometries are equal
                              
'MBRIntersects()'             Whether MBRs of two geometries intersect
                              
'MBROverlaps()'               Whether MBRs of two geometries overlap
                              
'MBRTouches()'                Whether MBRs of two geometries touch
                              
'MBRWithin()'                 Whether MBR of one geometry is within MBR
                              of another
                              
'MLineFromText()',            Construct MultiLineString from WKT
'MultiLineStringFromText()'   

'MLineFromWKB()',             Construct MultiLineString from WKB
'MultiLineStringFromWKB()'    

'MPointFromText()',           Construct MultiPoint from WKT
'MultiPointFromText()'        

'MPointFromWKB()',            Construct MultiPoint from WKB
'MultiPointFromWKB()'         

'MPolyFromText()',            Construct MultiPolygon from WKT
'MultiPolygonFromText()'      

'MPolyFromWKB()',             Construct MultiPolygon from WKB
'MultiPolygonFromWKB()'       

'MultiLineString()'           Contruct MultiLineString from LineString
                              values
                              
'MultiPoint()'                Construct MultiPoint from Point values
                              
'MultiPolygon()'              Construct MultiPolygon from Polygon
                              values
                              
'NumGeometries()'             Return number of geometries in geometry
                              collection
                              
'NumInteriorRings()'          Return number of interior rings in
                              Polygon
                              
'NumPoints()'                 Return number of points in LineString
                              
'Overlaps()'                  Whether MBRs of two geometries overlap
                              
'Point()'                     Construct Point from coordinates
                              
'PointFromText()'             Construct Point from WKT
                              
'PointFromWKB()'              Construct Point from WKB
                              
'PointN()'                    Return N-th point from LineString
                              
'PolyFromText()',             Construct Polygon from WKT
'PolygonFromText()'           

'PolyFromWKB()',              Construct Polygon from WKB
'PolygonFromWKB()'            

'Polygon()'                   Construct Polygon from LineString
                              arguments
                              
'SRID()'                      Return spatial reference system ID for
                              geometry
                              
'StartPoint()'                Start Point of LineString
                              
'Touches()'                   Whether one geometry touches another
                              
'Within()'                    Whether MBR of one geometry is within MBR
                              of another
                              
'X()'                         Return X coordinate of Point
                              
'Y()'                         Return Y coordinate of Point


File: manual.info.tmp,  Node: spatial-function-argument-handling,  Next: gis-wkt-functions,  Prev: spatial-function-reference,  Up: spatial-analysis-functions

12.16.2 Argument Handling by Spatial Functions
----------------------------------------------

Spatial values, or geometries, have the properties described at *note
gis-class-geometry::.  The following discussion lists general spatial
function argument-handling characteristics.  Specific functions or
groups of functions may have additional argument-handling
characteristics, as discussed in the sections where those function
descriptions occur.

Spatial functions are defined only for valid geometry values.  If an
invalid geometry is passed to a spatial function, the result is
undefined.

The spatial reference identifier (SRID) of a geometry identifies the
coordinate space in which the geometry is defined.  In MySQL, the SRID
value is an integer associated with the geometry value.  The maximum
usable SRID value is 2^32−1.  If a larger value is given, only the
lower 32 bits are used.

Geometry values produced by any spatial function inherit the SRID of the
geometry arguments.


File: manual.info.tmp,  Node: gis-wkt-functions,  Next: gis-wkb-functions,  Prev: spatial-function-argument-handling,  Up: spatial-analysis-functions

12.16.3 Functions That Create Geometry Values from WKT Values
-------------------------------------------------------------

These functions take as arguments a Well-Known Text (WKT) representation
and, optionally, a spatial reference system identifier (SRID). They
return the corresponding geometry.

'GeomFromText()' accepts a WKT value of any geometry type as its first
argument.  Other functions provide type-specific construction functions
for construction of geometry values of each geometry type.

For a description of WKT format, see *note gis-wkt-format::.

   * 
     'GeomCollFromText(WKT[, SRID])', 'GeometryCollectionFromText(WKT[,
     SRID])'

     Constructs a 'GeometryCollection' value using its WKT
     representation and SRID.

   * 
     'GeomFromText(WKT[, SRID])', 'GeometryFromText(WKT[, SRID])'

     Constructs a geometry value of any type using its WKT
     representation and SRID.

   * 
     'LineFromText(WKT[, SRID])', 'LineStringFromText(WKT[, SRID])'

     Constructs a 'LineString' value using its WKT representation and
     SRID.

   * 
     'MLineFromText(WKT[, SRID])', 'MultiLineStringFromText(WKT[,
     SRID])'

     Constructs a 'MultiLineString' value using its WKT representation
     and SRID.

   * 
     'MPointFromText(WKT[, SRID])', 'MultiPointFromText(WKT[, SRID])'

     Constructs a 'MultiPoint' value using its WKT representation and
     SRID.

   * 
     'MPolyFromText(WKT[, SRID])', 'MultiPolygonFromText(WKT[, SRID])'

     Constructs a 'MultiPolygon' value using its WKT representation and
     SRID.

   * 
     'PointFromText(WKT[, SRID])'

     Constructs a 'Point' value using its WKT representation and SRID.

   * 
     'PolyFromText(WKT[, SRID])', 'PolygonFromText(WKT[, SRID])'

     Constructs a 'Polygon' value using its WKT representation and SRID.


File: manual.info.tmp,  Node: gis-wkb-functions,  Next: gis-mysql-specific-functions,  Prev: gis-wkt-functions,  Up: spatial-analysis-functions

12.16.4 Functions That Create Geometry Values from WKB Values
-------------------------------------------------------------

These functions take as arguments a *note 'BLOB': blob. containing a
Well-Known Binary (WKB) representation and, optionally, a spatial
reference system identifier (SRID). They return the corresponding
geometry.

'GeomFromWKB()' accepts a WKB value of any geometry type as its first
argument.  Other functions provide type-specific construction functions
for construction of geometry values of each geometry type.

These functions also accept geometry objects as returned by the
functions in *note gis-mysql-specific-functions::.  Thus, those
functions may be used to provide the first argument to the functions in
this section.

For a description of WKB format, see *note gis-wkb-format::.

   * 
     'GeomCollFromWKB(WKB[, SRID])', 'GeometryCollectionFromWKB(WKB[,
     SRID])'

     Constructs a 'GeometryCollection' value using its WKB
     representation and SRID.

   * 
     'GeomFromWKB(WKB[, SRID])', 'GeometryFromWKB(WKB[, SRID])'

     Constructs a geometry value of any type using its WKB
     representation and SRID.

   * 
     'LineFromWKB(WKB[, SRID])', 'LineStringFromWKB(WKB[, SRID])'

     Constructs a 'LineString' value using its WKB representation and
     SRID.

   * 
     'MLineFromWKB(WKB[, SRID])', 'MultiLineStringFromWKB(WKB[, SRID])'

     Constructs a 'MultiLineString' value using its WKB representation
     and SRID.

   * 
     'MPointFromWKB(WKB[, SRID])', 'MultiPointFromWKB(WKB[, SRID])'

     Constructs a 'MultiPoint' value using its WKB representation and
     SRID.

   * 
     'MPolyFromWKB(WKB[, SRID])', 'MultiPolygonFromWKB(WKB[, SRID])'

     Constructs a 'MultiPolygon' value using its WKB representation and
     SRID.

   * 
     'PointFromWKB(WKB[, SRID])'

     Constructs a 'Point' value using its WKB representation and SRID.

   * 
     'PolyFromWKB(WKB[, SRID])', 'PolygonFromWKB(WKB[, SRID])'

     Constructs a 'Polygon' value using its WKB representation and SRID.


File: manual.info.tmp,  Node: gis-mysql-specific-functions,  Next: gis-format-conversion-functions,  Prev: gis-wkb-functions,  Up: spatial-analysis-functions

12.16.5 MySQL-Specific Functions That Create Geometry Values
------------------------------------------------------------

MySQL provides a set of useful nonstandard functions for creating
geometry values.  The functions described in this section are MySQL
extensions to the OpenGIS specification.

These functions produce geometry objects from either WKB values or
geometry objects as arguments.  If any argument is not a proper WKB or
geometry representation of the proper object type, the return value is
'NULL'.

For example, you can insert the geometry return value from 'Point()'
directly into a 'POINT' column:

     INSERT INTO t1 (pt_col) VALUES(Point(1,2));

   * 'GeometryCollection(G [, G] ...)'

     Constructs a 'GeometryCollection' value from the geometry
     arguments.

     If an argument contains a nonsupported geometry, the return value
     is 'NULL'.

   * 'LineString(PT [, PT] ...)'

     Constructs a 'LineString' value from a number of 'Point' or WKB
     'Point' arguments.  If the number of arguments is less than two,
     the return value is 'NULL'.

   * 'MultiLineString(LS [, LS] ...)'

     Constructs a 'MultiLineString' value using 'LineString' or WKB
     'LineString' arguments.

   * 'MultiPoint(PT [, PT2] ...)'

     Constructs a 'MultiPoint' value using 'Point' or WKB 'Point'
     arguments.

   * 'MultiPolygon(POLY [, POLY] ...)'

     Constructs a 'MultiPolygon' value from a set of 'Polygon' or WKB
     'Polygon' arguments.

   * 'Point(X, Y)'

     Constructs a 'Point' using its coordinates.

   * 'Polygon(LS [, LS] ...)'

     Constructs a 'Polygon' value from a number of 'LineString' or WKB
     'LineString' arguments.  If any argument does not represent a
     'LinearRing' (that is, not a closed and simple 'LineString'), the
     return value is 'NULL'.


File: manual.info.tmp,  Node: gis-format-conversion-functions,  Next: gis-property-functions,  Prev: gis-mysql-specific-functions,  Up: spatial-analysis-functions

12.16.6 Geometry Format Conversion Functions
--------------------------------------------

MySQL supports the functions listed in this section for converting
geometry values from internal geometry format to WKT or WKB format.

There are also functions to convert a string from WKT or WKB format to
internal geometry format.  See *note gis-wkt-functions::, and *note
gis-wkb-functions::.

   * 'AsBinary(G)', 'AsWKB(G)'

     Converts a value in internal geometry format to its WKB
     representation and returns the binary result.

     The result is 'NULL' if the geometry argument is 'NULL' or not a
     syntactically well-formed geometry.

          SELECT AsBinary(g) FROM geom;

   * 'AsText(G)', 'AsWKT(G)'

     Converts a value in internal geometry format to its WKT
     representation and returns the string result.

     The result is 'NULL' if the geometry argument is 'NULL' or not a
     syntactically well-formed geometry.

          mysql> SET @g = 'LineString(1 1,2 2,3 3)';
          mysql> SELECT AsText(GeomFromText(@g));
          +--------------------------+
          | AsText(GeomFromText(@g)) |
          +--------------------------+
          | LINESTRING(1 1,2 2,3 3)  |
          +--------------------------+


File: manual.info.tmp,  Node: gis-property-functions,  Next: spatial-operator-functions,  Prev: gis-format-conversion-functions,  Up: spatial-analysis-functions

12.16.7 Geometry Property Functions
-----------------------------------

* Menu:

* gis-general-property-functions::  General Geometry Property Functions
* gis-point-property-functions::  Point Property Functions
* gis-linestring-property-functions::  LineString and MultiLineString Property Functions
* gis-polygon-property-functions::  Polygon and MultiPolygon Property Functions
* gis-geometrycollection-property-functions::  GeometryCollection Property Functions

Each function that belongs to this group takes a geometry value as its
argument and returns some quantitative or qualitative property of the
geometry.  Some functions restrict their argument type.  Such functions
return 'NULL' if the argument is of an incorrect geometry type.  For
example, the 'Area()' polygon function returns 'NULL' if the object type
is neither 'Polygon' nor 'MultiPolygon'.


File: manual.info.tmp,  Node: gis-general-property-functions,  Next: gis-point-property-functions,  Prev: gis-property-functions,  Up: gis-property-functions

12.16.7.1 General Geometry Property Functions
.............................................

The functions listed in this section do not restrict their argument and
accept a geometry value of any type.

   * 'Dimension(G)'

     Returns the inherent dimension of the geometry value G.  The result
     can be −1, 0, 1, or 2.  The meaning of these values is given in
     *note gis-class-geometry::.

          mysql> SELECT Dimension(GeomFromText('LineString(1 1,2 2)'));
          +------------------------------------------------+
          | Dimension(GeomFromText('LineString(1 1,2 2)')) |
          +------------------------------------------------+
          |                                              1 |
          +------------------------------------------------+

   * 'Envelope(G)'

     Returns the minimum bounding rectangle (MBR) for the geometry value
     G.  The result is returned as a 'Polygon' value that is defined by
     the corner points of the bounding box:

          POLYGON((MINX MINY, MAXX MINY, MAXX MAXY, MINX MAXY, MINX MINY))

          mysql> SELECT AsText(Envelope(GeomFromText('LineString(1 1,2 2)')));
          +-------------------------------------------------------+
          | AsText(Envelope(GeomFromText('LineString(1 1,2 2)'))) |
          +-------------------------------------------------------+
          | POLYGON((1 1,2 1,2 2,1 2,1 1))                        |
          +-------------------------------------------------------+

   * 'GeometryType(G)'

     Returns a binary string indicating the name of the geometry type of
     which the geometry instance G is a member.  The name corresponds to
     one of the instantiable 'Geometry' subclasses.

          mysql> SELECT GeometryType(GeomFromText('POINT(1 1)'));
          +------------------------------------------+
          | GeometryType(GeomFromText('POINT(1 1)')) |
          +------------------------------------------+
          | POINT                                    |
          +------------------------------------------+

   * 'IsEmpty(G)'

     This function is a placeholder that returns 0 for any valid
     geometry value, 1 for any invalid geometry value or 'NULL'.

     MySQL does not support GIS 'EMPTY' values such as 'POINT EMPTY'.

   * 'IsSimple(G)'

     In MySQL 5.5, this function is a placeholder that always returns 0.

     The descriptions of the instantiable geometric classes given under
     *note opengis-geometry-model:: includes the specific conditions
     that cause class instances to be classified as not simple.

   * 'SRID(G)'

     Returns an integer indicating the spatial reference system ID
     associated with the geometry value G.

          mysql> SELECT SRID(GeomFromText('LineString(1 1,2 2)',101));
          +-----------------------------------------------+
          | SRID(GeomFromText('LineString(1 1,2 2)',101)) |
          +-----------------------------------------------+
          |                                           101 |
          +-----------------------------------------------+


File: manual.info.tmp,  Node: gis-point-property-functions,  Next: gis-linestring-property-functions,  Prev: gis-general-property-functions,  Up: gis-property-functions

12.16.7.2 Point Property Functions
..................................

A 'Point' consists of X and Y coordinates, which may be obtained using
the following functions:

   * 
     'X(P)'

     Returns the X-coordinate value for the 'Point' object P as a
     double-precision number.

          mysql> SELECT X(Point(56.7, 53.34));
          +-----------------------+
          | X(Point(56.7, 53.34)) |
          +-----------------------+
          |                  56.7 |
          +-----------------------+

   * 
     'Y(P)'

     Returns the Y-coordinate value for the 'Point' object P as a
     double-precision number.

          mysql> SELECT Y(Point(56.7, 53.34));
          +-----------------------+
          | Y(Point(56.7, 53.34)) |
          +-----------------------+
          |                 53.34 |
          +-----------------------+


File: manual.info.tmp,  Node: gis-linestring-property-functions,  Next: gis-polygon-property-functions,  Prev: gis-point-property-functions,  Up: gis-property-functions

12.16.7.3 LineString and MultiLineString Property Functions
...........................................................

A 'LineString' consists of 'Point' values.  You can extract particular
points of a 'LineString', count the number of points that it contains,
or obtain its length.

Some functions in this section also work for 'MultiLineString' values.

   * 
     'EndPoint(LS)'

     Returns the 'Point' that is the endpoint of the 'LineString' value
     LS.  If the argument is 'NULL' or an empty geometry, the return
     value is 'NULL'.

          mysql> SET @ls = 'LineString(1 1,2 2,3 3)';
          mysql> SELECT AsText(EndPoint(GeomFromText(@ls)));
          +-------------------------------------+
          | AsText(EndPoint(GeomFromText(@ls))) |
          +-------------------------------------+
          | POINT(3 3)                          |
          +-------------------------------------+

   * 
     'GLength(LS)'

     Returns a double-precision number indicating the length of the
     'LineString' or 'MultiLineString' value LS in its associated
     spatial reference.  The length of a 'MultiLineString' value is
     equal to the sum of the lengths of its elements.  If the argument
     is 'NULL' or an empty geometry, the return value is 'NULL'.

          mysql> SET @ls = 'LineString(1 1,2 2,3 3)';
          mysql> SELECT GLength(GeomFromText(@ls));
          +----------------------------+
          | GLength(GeomFromText(@ls)) |
          +----------------------------+
          |         2.8284271247461903 |
          +----------------------------+

          mysql> SET @mls = 'MultiLineString((1 1,2 2,3 3),(4 4,5 5))';
          mysql> SELECT GLength(GeomFromText(@mls));
          +-----------------------------+
          | GLength(GeomFromText(@mls)) |
          +-----------------------------+
          |           4.242640687119286 |
          +-----------------------------+

     'GLength()' is a nonstandard name.  It corresponds to the OpenGIS
     'Length()' function.  (There is an existing SQL function 'Length()'
     that calculates the length of string values.)

   * 
     'IsClosed(LS)'

     For a 'LineString' value LS, 'IsClosed()' returns 1 if LS is closed
     (that is, its 'StartPoint()' and 'EndPoint()' values are the same).
     If the argument is 'NULL' or an empty geometry, the return value is
     'NULL'.

     For a 'MultiLineString' value LS, 'IsClosed()' returns 1 if LS is
     closed (that is, the 'StartPoint()' and 'EndPoint()' values are the
     same for each 'LineString' in LS).

     'IsClosed()' returns 0 if LS is not closed.

          mysql> SET @ls1 = 'LineString(1 1,2 2,3 3,2 2)';
          mysql> SET @ls2 = 'LineString(1 1,2 2,3 3,1 1)';

          mysql> SELECT IsClosed(GeomFromText(@ls1));
          +------------------------------+
          | IsClosed(GeomFromText(@ls1)) |
          +------------------------------+
          |                            0 |
          +------------------------------+

          mysql> SELECT IsClosed(GeomFromText(@ls2));
          +------------------------------+
          | IsClosed(GeomFromText(@ls2)) |
          +------------------------------+
          |                            1 |
          +------------------------------+

          mysql> SET @ls3 = 'MultiLineString((1 1,2 2,3 3),(4 4,5 5))';

          mysql> SELECT IsClosed(GeomFromText(@ls3));
          +------------------------------+
          | IsClosed(GeomFromText(@ls3)) |
          +------------------------------+
          |                            0 |
          +------------------------------+

   * 
     'NumPoints(LS)'

     Returns the number of 'Point' objects in the 'LineString' value LS.
     If the argument is 'NULL' or an empty geometry, the return value is
     'NULL'.

          mysql> SET @ls = 'LineString(1 1,2 2,3 3)';
          mysql> SELECT NumPoints(GeomFromText(@ls));
          +------------------------------+
          | NumPoints(GeomFromText(@ls)) |
          +------------------------------+
          |                            3 |
          +------------------------------+

   * 
     'PointN(LS, N)'

     Returns the N-th 'Point' in the 'Linestring' value LS.  Points are
     numbered beginning with 1.  If any argument is 'NULL' or the
     geometry argument is an empty geometry, the return value is 'NULL'.

          mysql> SET @ls = 'LineString(1 1,2 2,3 3)';
          mysql> SELECT AsText(PointN(GeomFromText(@ls),2));
          +-------------------------------------+
          | AsText(PointN(GeomFromText(@ls),2)) |
          +-------------------------------------+
          | POINT(2 2)                          |
          +-------------------------------------+

   * 
     'StartPoint(LS)'

     Returns the 'Point' that is the start point of the 'LineString'
     value LS.  If the argument is 'NULL' or an empty geometry, the
     return value is 'NULL'.

          mysql> SET @ls = 'LineString(1 1,2 2,3 3)';
          mysql> SELECT AsText(StartPoint(GeomFromText(@ls)));
          +---------------------------------------+
          | AsText(StartPoint(GeomFromText(@ls))) |
          +---------------------------------------+
          | POINT(1 1)                            |
          +---------------------------------------+


File: manual.info.tmp,  Node: gis-polygon-property-functions,  Next: gis-geometrycollection-property-functions,  Prev: gis-linestring-property-functions,  Up: gis-property-functions

12.16.7.4 Polygon and MultiPolygon Property Functions
.....................................................

Functions in this section return properties of 'Polygon' or
'MultiPolygon' values.

   * 
     'Area({POLY|MPOLY})'

     Returns a double-precision number indicating the area of the
     'Polygon' or 'MultiPolygon' argument, as measured in its spatial
     reference system.  For arguments of dimension 0 or 1, the result is
     0.  If the argument is an empty geometry the return value is 0.  If
     the argument is 'NULL' the return value is 'NULL'.

          mysql> SET @poly =
                 'Polygon((0 0,0 3,3 0,0 0),(1 1,1 2,2 1,1 1))';
          mysql> SELECT Area(GeomFromText(@poly));
          +---------------------------+
          | Area(GeomFromText(@poly)) |
          +---------------------------+
          |                         4 |
          +---------------------------+

          mysql> SET @mpoly =
                 'MultiPolygon(((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1)))';
          mysql> SELECT Area(GeomFromText(@mpoly));
          +----------------------------+
          | Area(GeomFromText(@mpoly)) |
          +----------------------------+
          |                          8 |
          +----------------------------+

   * 
     'Centroid({POLY|MPOLY})'

     Returns the mathematical centroid for the 'Polygon' or
     'MultiPolygon' argument as a 'Point'.  The result is not guaranteed
     to be on the argument.  If the argument is 'NULL' or an empty
     geometry, the return value is 'NULL'.

          mysql> SET @poly =
                 GeomFromText('POLYGON((0 0,10 0,10 10,0 10,0 0),(5 5,7 5,7 7,5 7,5 5))');
          mysql> SELECT GeometryType(@poly),AsText(Centroid(@poly));
          +---------------------+--------------------------------------------+
          | GeometryType(@poly) | AsText(Centroid(@poly))                    |
          +---------------------+--------------------------------------------+
          | POLYGON             | POINT(4.958333333333333 4.958333333333333) |
          +---------------------+--------------------------------------------+

   * 
     'ExteriorRing(POLY)'

     Returns the exterior ring of the 'Polygon' value POLY as a
     'LineString'.  If the argument is 'NULL' or an empty geometry, the
     return value is 'NULL'.

          mysql> SET @poly =
                 'Polygon((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1))';
          mysql> SELECT AsText(ExteriorRing(GeomFromText(@poly)));
          +-------------------------------------------+
          | AsText(ExteriorRing(GeomFromText(@poly))) |
          +-------------------------------------------+
          | LINESTRING(0 0,0 3,3 3,3 0,0 0)           |
          +-------------------------------------------+

   * 
     'InteriorRingN(POLY, N)'

     Returns the N-th interior ring for the 'Polygon' value POLY as a
     'LineString'.  Rings are numbered beginning with 1.  If the
     argument is 'NULL' or an empty geometry, the return value is
     'NULL'.

          mysql> SET @poly =
                 'Polygon((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1))';
          mysql> SELECT AsText(InteriorRingN(GeomFromText(@poly),1));
          +----------------------------------------------+
          | AsText(InteriorRingN(GeomFromText(@poly),1)) |
          +----------------------------------------------+
          | LINESTRING(1 1,1 2,2 2,2 1,1 1)              |
          +----------------------------------------------+

   * 
     'NumInteriorRings(POLY)'

     Returns the number of interior rings in the 'Polygon' value POLY.
     If the argument is 'NULL' or an empty geometry, the return value is
     'NULL'.

          mysql> SET @poly =
                 'Polygon((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1))';
          mysql> SELECT NumInteriorRings(GeomFromText(@poly));
          +---------------------------------------+
          | NumInteriorRings(GeomFromText(@poly)) |
          +---------------------------------------+
          |                                     1 |
          +---------------------------------------+


File: manual.info.tmp,  Node: gis-geometrycollection-property-functions,  Prev: gis-polygon-property-functions,  Up: gis-property-functions

12.16.7.5 GeometryCollection Property Functions
...............................................

These functions return properties of 'GeometryCollection' values.

   * 
     'GeometryN(GC, N)'

     Returns the N-th geometry in the 'GeometryCollection' value GC.
     Geometries are numbered beginning with 1.  If any argument is
     'NULL' or the geometry argument is an empty geometry, the return
     value is 'NULL'.

          mysql> SET @gc = 'GeometryCollection(Point(1 1),LineString(2 2, 3 3))';
          mysql> SELECT AsText(GeometryN(GeomFromText(@gc),1));
          +----------------------------------------+
          | AsText(GeometryN(GeomFromText(@gc),1)) |
          +----------------------------------------+
          | POINT(1 1)                             |
          +----------------------------------------+

   * 
     'NumGeometries(GC)'

     Returns the number of geometries in the 'GeometryCollection' value
     GC.  If the argument is 'NULL' or an empty geometry, the return
     value is 'NULL'.

          mysql> SET @gc = 'GeometryCollection(Point(1 1),LineString(2 2, 3 3))';
          mysql> SELECT NumGeometries(GeomFromText(@gc));
          +----------------------------------+
          | NumGeometries(GeomFromText(@gc)) |
          +----------------------------------+
          |                                2 |
          +----------------------------------+


File: manual.info.tmp,  Node: spatial-operator-functions,  Next: spatial-relation-functions,  Prev: gis-property-functions,  Up: spatial-analysis-functions

12.16.8 Spatial Operator Functions
----------------------------------

*note gis-property-functions::, discusses several functions that
construct new geometries from existing ones.  See that section for
descriptions of these functions:

   * 'Envelope(G)'

   * 'StartPoint(LS)'

   * 'EndPoint(LS)'

   * 'PointN(LS, N)'

   * 'ExteriorRing(POLY)'

   * 'InteriorRingN(POLY, N)'

   * 'GeometryN(GC, N)'


File: manual.info.tmp,  Node: spatial-relation-functions,  Prev: spatial-operator-functions,  Up: spatial-analysis-functions

12.16.9 Functions That Test Spatial Relations Between Geometry Objects
----------------------------------------------------------------------

* Menu:

* spatial-relation-functions-object-shapes::  Spatial Relation Functions That Use Object Shapes
* spatial-relation-functions-mbr::  Spatial Relation Functions That Use Minimum Bounding Rectangles

The functions described in this section take two geometries as arguments
and return a qualitative or quantitative relation between them.

MySQL implements two sets of functions using function names defined by
the OpenGIS specification.  One set tests the relationship between two
geometry values using precise object shapes, the other set uses object
minimum bounding rectangles (MBRs).

There is also a MySQL-specific set of MBR-based functions available to
test the relationship between two geometry values.


File: manual.info.tmp,  Node: spatial-relation-functions-object-shapes,  Next: spatial-relation-functions-mbr,  Prev: spatial-relation-functions,  Up: spatial-relation-functions

12.16.9.1 Spatial Relation Functions That Use Object Shapes
...........................................................

The OpenGIS specification defines the following functions to test the
relationship between two geometry values 'g1' and 'g2', using precise
object shapes.  The return values 1 and 0 indicate true and false,
respectively.

   * 
     'Crosses(G1, G2)'

     The term _spatially crosses_ denotes a spatial relation between two
     given geometries that has the following properties:

        * The two geometries intersect.

        * Their intersection results in a geometry that has a dimension
          that is one less than the maximum dimension of the two given
          geometries.

        * Their intersection is not equal to either of the two given
          geometries.

     This function returns 1 or 0 to indicate whether G1 spatially
     crosses G2.  If 'g1' is a 'Polygon' or a 'MultiPolygon', or if G2
     is a 'Point' or a 'MultiPoint', the return value is 'NULL'.

   * 
     'Touches(G1, G2)'

     Two geometries _spatially touch_ if their interiors do not
     intersect, but the boundary of one of the geometries intersects
     either the boundary or the interior of the other.

     This function returns 1 or 0 to indicate whether G1 spatially
     touches G2.


File: manual.info.tmp,  Node: spatial-relation-functions-mbr,  Prev: spatial-relation-functions-object-shapes,  Up: spatial-relation-functions

12.16.9.2 Spatial Relation Functions That Use Minimum Bounding Rectangles
.........................................................................

MySQL provides several MySQL-specific functions that test the
relationship between minimum bounding rectangles (MBRs) of two
geometries 'g1' and 'g2'.  The return values 1 and 0 indicate true and
false, respectively.

A corresponding set of MBR functions defined according to the OpenGIS
specification is described later in this section.

   * 
     'MBRContains(G1, G2)'

     Returns 1 or 0 to indicate whether the minimum bounding rectangle
     of G1 contains the minimum bounding rectangle of G2.  This tests
     the opposite relationship as 'MBRWithin()'.

          mysql> SET @g1 = GeomFromText('Polygon((0 0,0 3,3 3,3 0,0 0))');
          mysql> SET @g2 = GeomFromText('Point(1 1)');
          mysql> SELECT MBRContains(@g1,@g2), MBRWithin(@g2,@g1);
          +----------------------+--------------------+
          | MBRContains(@g1,@g2) | MBRWithin(@g2,@g1) |
          +----------------------+--------------------+
          |                    1 |                  1 |
          +----------------------+--------------------+

   * 
     'MBRDisjoint(G1, G2)'

     Returns 1 or 0 to indicate whether the minimum bounding rectangles
     of the two geometries G1 and G2 are disjoint (do not intersect).

   * 
     'MBREqual(G1, G2)'

     Returns 1 or 0 to indicate whether the minimum bounding rectangles
     of the two geometries G1 and G2 are the same.

   * 
     'MBRIntersects(G1, G2)'

     Returns 1 or 0 to indicate whether the minimum bounding rectangles
     of the two geometries G1 and G2 intersect.

   * 
     'MBROverlaps(G1, G2)'

     Two geometries _spatially overlap_ if they intersect and their
     intersection results in a geometry of the same dimension but not
     equal to either of the given geometries.

     This function returns 1 or 0 to indicate whether the minimum
     bounding rectangles of the two geometries G1 and G2 overlap.

   * 
     'MBRTouches(G1, G2)'

     Two geometries _spatially touch_ if their interiors do not
     intersect, but the boundary of one of the geometries intersects
     either the boundary or the interior of the other.

     This function returns 1 or 0 to indicate whether the minimum
     bounding rectangles of the two geometries G1 and G2 touch.

   * 
     'MBRWithin(G1, G2)'

     Returns 1 or 0 to indicate whether the minimum bounding rectangle
     of G1 is within the minimum bounding rectangle of G2.  This tests
     the opposite relationship as 'MBRContains()'.

          mysql> SET @g1 = GeomFromText('Polygon((0 0,0 3,3 3,3 0,0 0))');
          mysql> SET @g2 = GeomFromText('Polygon((0 0,0 5,5 5,5 0,0 0))');
          mysql> SELECT MBRWithin(@g1,@g2), MBRWithin(@g2,@g1);
          +--------------------+--------------------+
          | MBRWithin(@g1,@g2) | MBRWithin(@g2,@g1) |
          +--------------------+--------------------+
          |                  1 |                  0 |
          +--------------------+--------------------+

The OpenGIS specification defines the following functions that test the
relationship between two geometry values 'g1' and 'g2'.  The MySQL
implementation uses minimum bounding rectangles, so these functions
return the same result as the corresponding MBR-based functions
described earlier in this section.  The return values 1 and 0 indicate
true and false, respectively.

   * 
     'Contains(G1, G2)'

     Returns 1 or 0 to indicate whether G1 completely contains G2.  This
     tests the opposite relationship as 'Within()'.

   * 
     'Disjoint(G1, G2)'

     Returns 1 or 0 to indicate whether G1 is spatially disjoint from
     (does not intersect) G2.

   * 
     'Equals(G1, G2)'

     Returns 1 or 0 to indicate whether G1 is spatially equal to G2.

   * 
     'Intersects(G1, G2)'

     Returns 1 or 0 to indicate whether G1 spatially intersects G2.

   * 
     'Overlaps(G1, G2)'

     Two geometries _spatially overlap_ if they intersect and their
     intersection results in a geometry of the same dimension but not
     equal to either of the given geometries.

     This function returns 1 or 0 to indicate whether G1 spatially
     overlaps G2.

   * 
     'Within(G1, G2)'

     Returns 1 or 0 to indicate whether G1 is spatially within G2.  This
     tests the opposite relationship as 'Contains()'.


File: manual.info.tmp,  Node: group-by-functions-and-modifiers,  Next: miscellaneous-functions,  Prev: spatial-analysis-functions,  Up: functions

12.17 Aggregate (GROUP BY) Functions
====================================

* Menu:

* group-by-functions::           Aggregate (GROUP BY) Function Descriptions
* group-by-modifiers::           GROUP BY Modifiers
* group-by-handling::            MySQL Handling of GROUP BY


File: manual.info.tmp,  Node: group-by-functions,  Next: group-by-modifiers,  Prev: group-by-functions-and-modifiers,  Up: group-by-functions-and-modifiers

12.17.1 Aggregate (GROUP BY) Function Descriptions
--------------------------------------------------

This section describes group (aggregate) functions that operate on sets
of values.

*Aggregate (GROUP BY) Functions*

Name                          Description
                              
'AVG()'                       Return the average value of the argument
                              
'BIT_AND()'                   Return bitwise AND
                              
'BIT_OR()'                    Return bitwise OR
                              
'BIT_XOR()'                   Return bitwise XOR
                              
'COUNT()'                     Return a count of the number of rows
                              returned
                              
'COUNT(DISTINCT)'             Return the count of a number of different
                              values
                              
'GROUP_CONCAT()'              Return a concatenated string
                              
'MAX()'                       Return the maximum value
                              
'MIN()'                       Return the minimum value
                              
'STD()'                       Return the population standard deviation
                              
'STDDEV()'                    Return the population standard deviation
                              
'STDDEV_POP()'                Return the population standard deviation
                              
'STDDEV_SAMP()'               Return the sample standard deviation
                              
'SUM()'                       Return the sum
                              
'VAR_POP()'                   Return the population standard variance
                              
'VAR_SAMP()'                  Return the sample variance
                              
'VARIANCE()'                  Return the population standard variance

Unless otherwise stated, group functions ignore 'NULL' values.

If you use a group function in a statement containing no 'GROUP BY'
clause, it is equivalent to grouping on all rows.  For more information,
see *note group-by-handling::.

For numeric arguments, the variance and standard deviation functions
return a *note 'DOUBLE': floating-point-types. value.  The 'SUM()' and
'AVG()' functions return a *note 'DECIMAL': fixed-point-types. value for
exact-value arguments (integer or *note 'DECIMAL': fixed-point-types.),
and a *note 'DOUBLE': floating-point-types. value for approximate-value
arguments (*note 'FLOAT': floating-point-types. or *note 'DOUBLE':
floating-point-types.).

The 'SUM()' and 'AVG()' aggregate functions do not work with temporal
values.  (They convert the values to numbers, losing everything after
the first nonnumeric character.)  To work around this problem, convert
to numeric units, perform the aggregate operation, and convert back to a
temporal value.  Examples:

     SELECT SEC_TO_TIME(SUM(TIME_TO_SEC(TIME_COL))) FROM TBL_NAME;
     SELECT FROM_DAYS(SUM(TO_DAYS(DATE_COL))) FROM TBL_NAME;

Functions such as 'SUM()' or 'AVG()' that expect a numeric argument cast
the argument to a number if necessary.  For *note 'SET': set. or *note
'ENUM': enum. values, the cast operation causes the underlying numeric
value to be used.

The 'BIT_AND()', 'BIT_OR()', and 'BIT_XOR()' aggregate functions perform
bit operations.  They require *note 'BIGINT': integer-types. (64-bit
integer) arguments and return *note 'BIGINT': integer-types. values.
Arguments of other types are converted to *note 'BIGINT': integer-types.
and truncation might occur.

   * 
     'AVG([DISTINCT] EXPR)'

     Returns the average value of 'EXPR'.  The 'DISTINCT' option can be
     used to return the average of the distinct values of EXPR.

     If there are no matching rows, 'AVG()' returns 'NULL'.

          mysql> SELECT student_name, AVG(test_score)
                 FROM student
                 GROUP BY student_name;

   * 
     'BIT_AND(EXPR)'

     Returns the bitwise 'AND' of all bits in EXPR.  The calculation is
     performed with 64-bit (*note 'BIGINT': integer-types.) precision.

     If there are no matching rows, 'BIT_AND()' returns a neutral value
     (all bits set to 1).

   * 
     'BIT_OR(EXPR)'

     Returns the bitwise 'OR' of all bits in EXPR.  The calculation is
     performed with 64-bit (*note 'BIGINT': integer-types.) precision.

     If there are no matching rows, 'BIT_OR()' returns a neutral value
     (all bits set to 0).

   * 
     'BIT_XOR(EXPR)'

     Returns the bitwise 'XOR' of all bits in EXPR.  The calculation is
     performed with 64-bit (*note 'BIGINT': integer-types.) precision.

     If there are no matching rows, 'BIT_XOR()' returns a neutral value
     (all bits set to 0).

   * 
     'COUNT(EXPR)'

     Returns a count of the number of non-'NULL' values of EXPR in the
     rows retrieved by a *note 'SELECT': select. statement.  The result
     is a *note 'BIGINT': integer-types. value.

     If there are no matching rows, 'COUNT()' returns '0'.

          mysql> SELECT student.student_name,COUNT(*)
                 FROM student,course
                 WHERE student.student_id=course.student_id
                 GROUP BY student_name;

     'COUNT(*)' is somewhat different in that it returns a count of the
     number of rows retrieved, whether or not they contain 'NULL'
     values.

     For transactional storage engines such as 'InnoDB', storing an
     exact row count is problematic.  Multiple transactions may be
     occurring at the same time, each of which may affect the count.

     'InnoDB' does not keep an internal count of rows in a table because
     concurrent transactions might 'see' different numbers of rows at
     the same time.  Consequently, 'SELECT COUNT(*)' statements only
     count rows visible to the current transaction.

     To process a 'SELECT COUNT(*)' statement, 'InnoDB' scans an index
     of the table, which takes some time if the index is not entirely in
     the buffer pool.  For a faster count, create a counter table and
     let your application update it according to the inserts and deletes
     it does.  However, this method may not scale well in situations
     where thousands of concurrent transactions are initiating updates
     to the same counter table.  If an approximate row count is
     sufficient, use *note 'SHOW TABLE STATUS': show-table-status.

     'InnoDB' handles 'SELECT COUNT(*)' and 'SELECT COUNT(1)' operations
     in the same way.  There is no performance difference.

     For 'MyISAM' tables, 'COUNT(*)' is optimized to return very quickly
     if the *note 'SELECT': select. retrieves from one table, no other
     columns are retrieved, and there is no 'WHERE' clause.  For
     example:

          mysql> SELECT COUNT(*) FROM student;

     This optimization only applies to 'MyISAM' tables, because an exact
     row count is stored for this storage engine and can be accessed
     very quickly.  'COUNT(1)' is only subject to the same optimization
     if the first column is defined as 'NOT NULL'.

   * 
     'COUNT(DISTINCT EXPR,[EXPR...])'

     Returns a count of the number of rows with different non-'NULL'
     EXPR values.

     If there are no matching rows, 'COUNT(DISTINCT)' returns '0'.

          mysql> SELECT COUNT(DISTINCT results) FROM student;

     In MySQL, you can obtain the number of distinct expression
     combinations that do not contain 'NULL' by giving a list of
     expressions.  In standard SQL, you would have to do a concatenation
     of all expressions inside 'COUNT(DISTINCT ...)'.

   * 
     'GROUP_CONCAT(EXPR)'

     This function returns a string result with the concatenated
     non-'NULL' values from a group.  It returns 'NULL' if there are no
     non-'NULL' values.  The full syntax is as follows:

          GROUP_CONCAT([DISTINCT] EXPR [,EXPR ...]
                       [ORDER BY {UNSIGNED_INTEGER | COL_NAME | EXPR}
                           [ASC | DESC] [,COL_NAME ...]]
                       [SEPARATOR STR_VAL])

          mysql> SELECT student_name,
                   GROUP_CONCAT(test_score)
                 FROM student
                 GROUP BY student_name;

     Or:

          mysql> SELECT student_name,
                   GROUP_CONCAT(DISTINCT test_score
                                ORDER BY test_score DESC SEPARATOR ' ')
                 FROM student
                 GROUP BY student_name;

     In MySQL, you can get the concatenated values of expression
     combinations.  To eliminate duplicate values, use the 'DISTINCT'
     clause.  To sort values in the result, use the 'ORDER BY' clause.
     To sort in reverse order, add the 'DESC' (descending) keyword to
     the name of the column you are sorting by in the 'ORDER BY' clause.
     The default is ascending order; this may be specified explicitly
     using the 'ASC' keyword.  The default separator between values in a
     group is comma (',').  To specify a separator explicitly, use
     'SEPARATOR' followed by the string literal value that should be
     inserted between group values.  To eliminate the separator
     altogether, specify 'SEPARATOR '''.

     The result is truncated to the maximum length that is given by the
     'group_concat_max_len' system variable, which has a default value
     of 1024.  The value can be set higher, although the effective
     maximum length of the return value is constrained by the value of
     'max_allowed_packet'.  The syntax to change the value of
     'group_concat_max_len' at runtime is as follows, where VAL is an
     unsigned integer:

          SET [GLOBAL | SESSION] group_concat_max_len = VAL;

     The return value is a nonbinary or binary string, depending on
     whether the arguments are nonbinary or binary strings.  The result
     type is *note 'TEXT': blob. or *note 'BLOB': blob. unless
     'group_concat_max_len' is less than or equal to 512, in which case
     the result type is *note 'VARCHAR': char. or *note 'VARBINARY':
     binary-varbinary.

     See also 'CONCAT()' and 'CONCAT_WS()': *note string-functions::.

   * 
     'MAX([DISTINCT] EXPR)'

     Returns the maximum value of EXPR.  'MAX()' may take a string
     argument; in such cases, it returns the maximum string value.  See
     *note mysql-indexes::.  The 'DISTINCT' keyword can be used to find
     the maximum of the distinct values of EXPR, however, this produces
     the same result as omitting 'DISTINCT'.

     If there are no matching rows, 'MAX()' returns 'NULL'.

          mysql> SELECT student_name, MIN(test_score), MAX(test_score)
                 FROM student
                 GROUP BY student_name;

     For 'MAX()', MySQL currently compares *note 'ENUM': enum. and *note
     'SET': set. columns by their string value rather than by the
     string's relative position in the set.  This differs from how
     'ORDER BY' compares them.

   * 
     'MIN([DISTINCT] EXPR)'

     Returns the minimum value of EXPR.  'MIN()' may take a string
     argument; in such cases, it returns the minimum string value.  See
     *note mysql-indexes::.  The 'DISTINCT' keyword can be used to find
     the minimum of the distinct values of EXPR, however, this produces
     the same result as omitting 'DISTINCT'.

     If there are no matching rows, 'MIN()' returns 'NULL'.

          mysql> SELECT student_name, MIN(test_score), MAX(test_score)
                 FROM student
                 GROUP BY student_name;

     For 'MIN()', MySQL currently compares *note 'ENUM': enum. and *note
     'SET': set. columns by their string value rather than by the
     string's relative position in the set.  This differs from how
     'ORDER BY' compares them.

   * 
     'STD(EXPR)'

     Returns the population standard deviation of EXPR.  'STD()' is a
     synonym for the standard SQL function 'STDDEV_POP()', provided as a
     MySQL extension.

     If there are no matching rows, 'STD()' returns 'NULL'.

   * 
     'STDDEV(EXPR)'

     Returns the population standard deviation of EXPR.  'STDDEV()' is a
     synonym for the standard SQL function 'STDDEV_POP()', provided for
     compatibility with Oracle.

     If there are no matching rows, 'STDDEV()' returns 'NULL'.

   * 
     'STDDEV_POP(EXPR)'

     Returns the population standard deviation of EXPR (the square root
     of 'VAR_POP()').  You can also use 'STD()' or 'STDDEV()', which are
     equivalent but not standard SQL.

     If there are no matching rows, 'STDDEV_POP()' returns 'NULL'.

   * 
     'STDDEV_SAMP(EXPR)'

     Returns the sample standard deviation of EXPR (the square root of
     'VAR_SAMP()'.

     If there are no matching rows, 'STDDEV_SAMP()' returns 'NULL'.

   * 
     'SUM([DISTINCT] EXPR)'

     Returns the sum of EXPR.  If the return set has no rows, 'SUM()'
     returns 'NULL'.  The 'DISTINCT' keyword can be used to sum only the
     distinct values of EXPR.

     If there are no matching rows, 'SUM()' returns 'NULL'.

   * 
     'VAR_POP(EXPR)'

     Returns the population standard variance of EXPR.  It considers
     rows as the whole population, not as a sample, so it has the number
     of rows as the denominator.  You can also use 'VARIANCE()', which
     is equivalent but is not standard SQL.

     If there are no matching rows, 'VAR_POP()' returns 'NULL'.

   * 
     'VAR_SAMP(EXPR)'

     Returns the sample variance of EXPR.  That is, the denominator is
     the number of rows minus one.

     If there are no matching rows, 'VAR_SAMP()' returns 'NULL'.

   * 
     'VARIANCE(EXPR)'

     Returns the population standard variance of EXPR.  'VARIANCE()' is
     a synonym for the standard SQL function 'VAR_POP()', provided as a
     MySQL extension.

     If there are no matching rows, 'VARIANCE()' returns 'NULL'.


File: manual.info.tmp,  Node: group-by-modifiers,  Next: group-by-handling,  Prev: group-by-functions,  Up: group-by-functions-and-modifiers

12.17.2 GROUP BY Modifiers
--------------------------

The 'GROUP BY' clause permits a 'WITH ROLLUP' modifier that causes
summary output to include extra rows that represent higher-level (that
is, super-aggregate) summary operations.  'ROLLUP' thus enables you to
answer questions at multiple levels of analysis with a single query.
For example, 'ROLLUP' can be used to provide support for OLAP (Online
Analytical Processing) operations.

Suppose that a 'sales' table has 'year', 'country', 'product', and
'profit' columns for recording sales profitability:

     CREATE TABLE sales
     (
         year    INT,
         country VARCHAR(20),
         product VARCHAR(32),
         profit  INT
     );

To summarize table contents per year, use a simple 'GROUP BY' like this:

     mysql> SELECT year, SUM(profit) AS profit
            FROM sales
            GROUP BY year;
     +------+--------+
     | year | profit |
     +------+--------+
     | 2000 |   4525 |
     | 2001 |   3010 |
     +------+--------+

The output shows the total (aggregate) profit for each year.  To also
determine the total profit summed over all years, you must add up the
individual values yourself or run an additional query.  Or you can use
'ROLLUP', which provides both levels of analysis with a single query.
Adding a 'WITH ROLLUP' modifier to the 'GROUP BY' clause causes the
query to produce another (super-aggregate) row that shows the grand
total over all year values:

     mysql> SELECT year, SUM(profit) AS profit
            FROM sales
            GROUP BY year WITH ROLLUP;
     +------+--------+
     | year | profit |
     +------+--------+
     | 2000 |   4525 |
     | 2001 |   3010 |
     | NULL |   7535 |
     +------+--------+

The 'NULL' value in the 'year' column identifies the grand total
super-aggregate line.

'ROLLUP' has a more complex effect when there are multiple 'GROUP BY'
columns.  In this case, each time there is a change in value in any but
the last grouping column, the query produces an extra super-aggregate
summary row.

For example, without 'ROLLUP', a summary of the 'sales' table based on
'year', 'country', and 'product' might look like this, where the output
indicates summary values only at the year/country/product level of
analysis:

     mysql> SELECT year, country, product, SUM(profit) AS profit
            FROM sales
            GROUP BY year, country, product;
     +------+---------+------------+--------+
     | year | country | product    | profit |
     +------+---------+------------+--------+
     | 2000 | Finland | Computer   |   1500 |
     | 2000 | Finland | Phone      |    100 |
     | 2000 | India   | Calculator |    150 |
     | 2000 | India   | Computer   |   1200 |
     | 2000 | USA     | Calculator |     75 |
     | 2000 | USA     | Computer   |   1500 |
     | 2001 | Finland | Phone      |     10 |
     | 2001 | USA     | Calculator |     50 |
     | 2001 | USA     | Computer   |   2700 |
     | 2001 | USA     | TV         |    250 |
     +------+---------+------------+--------+

With 'ROLLUP' added, the query produces several extra rows:

     mysql> SELECT year, country, product, SUM(profit) AS profit
            FROM sales
            GROUP BY year, country, product WITH ROLLUP;
     +------+---------+------------+--------+
     | year | country | product    | profit |
     +------+---------+------------+--------+
     | 2000 | Finland | Computer   |   1500 |
     | 2000 | Finland | Phone      |    100 |
     | 2000 | Finland | NULL       |   1600 |
     | 2000 | India   | Calculator |    150 |
     | 2000 | India   | Computer   |   1200 |
     | 2000 | India   | NULL       |   1350 |
     | 2000 | USA     | Calculator |     75 |
     | 2000 | USA     | Computer   |   1500 |
     | 2000 | USA     | NULL       |   1575 |
     | 2000 | NULL    | NULL       |   4525 |
     | 2001 | Finland | Phone      |     10 |
     | 2001 | Finland | NULL       |     10 |
     | 2001 | USA     | Calculator |     50 |
     | 2001 | USA     | Computer   |   2700 |
     | 2001 | USA     | TV         |    250 |
     | 2001 | USA     | NULL       |   3000 |
     | 2001 | NULL    | NULL       |   3010 |
     | NULL | NULL    | NULL       |   7535 |
     +------+---------+------------+--------+

Now the output includes summary information at four levels of analysis,
not just one:

   * Following each set of product rows for a given year and country, an
     extra super-aggregate summary row appears showing the total for all
     products.  These rows have the 'product' column set to 'NULL'.

   * Following each set of rows for a given year, an extra
     super-aggregate summary row appears showing the total for all
     countries and products.  These rows have the 'country' and
     'products' columns set to 'NULL'.

   * Finally, following all other rows, an extra super-aggregate summary
     row appears showing the grand total for all years, countries, and
     products.  This row has the 'year', 'country', and 'products'
     columns set to 'NULL'.

The 'NULL' indicators in each super-aggregate row are produced when the
row is sent to the client.  The server looks at the columns named in the
'GROUP BY' clause following the leftmost one that has changed value.
For any column in the result set with a name that matches any of those
names, its value is set to 'NULL'.  (If you specify grouping columns by
column position, the server identifies which columns to set to 'NULL' by
position.)

Because the 'NULL' values in the super-aggregate rows are placed into
the result set at such a late stage in query processing, you can test
them as 'NULL' values only in the select list or 'HAVING' clause.  You
cannot test them as 'NULL' values in join conditions or the 'WHERE'
clause to determine which rows to select.  For example, you cannot add
'WHERE product IS NULL' to the query to eliminate from the output all
but the super-aggregate rows.

The 'NULL' values do appear as 'NULL' on the client side and can be
tested as such using any MySQL client programming interface.  However,
at this point, you cannot distinguish whether a 'NULL' represents a
regular grouped value or a super-aggregate value.

*Other Considerations When using ROLLUP*

The following discussion lists some behaviors specific to the MySQL
implementation of 'ROLLUP'.

When you use 'ROLLUP', you cannot also use an 'ORDER BY' clause to sort
the results.  In other words, 'ROLLUP' and 'ORDER BY' are mutually
exclusive in MySQL. However, you still have some control over sort
order.  'GROUP BY' in MySQL implicitly sorts results by default (in the
absence of 'ASC' or 'DESC' designators).  However, implicit 'GROUP BY'
sorting in MySQL is deprecated.  To achieve a specific sort order of
grouped results:

   * Use explicit 'ASC' and 'DESC' keywords with columns named in the
     'GROUP BY' list to specify sort order for individual columns.  In
     this case, the super-aggregate summary rows added by 'ROLLUP' still
     appear after the rows from which they are calculated, regardless of
     the sort order.

   * To work around the restriction that prevents using 'ROLLUP' with
     'ORDER BY', generate the grouped result set as a derived table and
     apply 'ORDER BY' to it.  For example:

          mysql> SELECT * FROM
                   (SELECT year, SUM(profit) AS profit
                   FROM sales GROUP BY year WITH ROLLUP) AS dt
                 ORDER BY year DESC;
          +------+--------+
          | year | profit |
          +------+--------+
          | 2001 |   3010 |
          | 2000 |   4525 |
          | NULL |   7535 |
          +------+--------+

     In this case, the super-aggregate summary rows sort with the rows
     from which they are calculated, and their placement depends on sort
     order (at the beginning for ascending sort, at the end for
     descending sort).

'LIMIT' can be used to restrict the number of rows returned to the
client.  'LIMIT' is applied after 'ROLLUP', so the limit applies against
the extra rows added by 'ROLLUP'.  For example:

     mysql> SELECT year, country, product, SUM(profit) AS profit
            FROM sales
            GROUP BY year, country, product WITH ROLLUP
            LIMIT 5;
     +------+---------+------------+--------+
     | year | country | product    | profit |
     +------+---------+------------+--------+
     | 2000 | Finland | Computer   |   1500 |
     | 2000 | Finland | Phone      |    100 |
     | 2000 | Finland | NULL       |   1600 |
     | 2000 | India   | Calculator |    150 |
     | 2000 | India   | Computer   |   1200 |
     +------+---------+------------+--------+

Using 'LIMIT' with 'ROLLUP' may produce results that are more difficult
to interpret, because there is less context for understanding the
super-aggregate rows.

A MySQL extension permits a column that does not appear in the 'GROUP
BY' list to be named in the select list.  (For information about
nonaggregated columns and 'GROUP BY', see *note group-by-handling::.)
In this case, the server is free to choose any value from this
nonaggregated column in summary rows, and this includes the extra rows
added by 'WITH ROLLUP'.  For example, in the following query, 'country'
is a nonaggregated column that does not appear in the 'GROUP BY' list
and values chosen for this column are nondeterministic:

     mysql> SELECT year, country, SUM(profit) AS profit
            FROM sales
            GROUP BY year WITH ROLLUP;
     +------+---------+--------+
     | year | country | profit |
     +------+---------+--------+
     | 2000 | India   |   4525 |
     | 2001 | USA     |   3010 |
     | NULL | USA     |   7535 |
     +------+---------+--------+

This behavior is permitted when the 'ONLY_FULL_GROUP_BY' SQL mode is not
enabled.  If that mode is enabled, the server rejects the query as
illegal because 'country' is not listed in the 'GROUP BY' clause.


File: manual.info.tmp,  Node: group-by-handling,  Prev: group-by-modifiers,  Up: group-by-functions-and-modifiers

12.17.3 MySQL Handling of GROUP BY
----------------------------------

In standard SQL, a query that includes a 'GROUP BY' clause cannot refer
to nonaggregated columns in the select list that are not named in the
'GROUP BY' clause.  For example, this query is illegal in standard SQL
because the nonaggregated 'name' column in the select list does not
appear in the 'GROUP BY':

     SELECT o.custid, c.name, MAX(o.payment)
       FROM orders AS o, customers AS c
       WHERE o.custid = c.custid
       GROUP BY o.custid;

For the query to be legal, the 'name' column must be omitted from the
select list or named in the 'GROUP BY' clause.

MySQL extends the standard SQL use of 'GROUP BY' so that the select list
can refer to nonaggregated columns not named in the 'GROUP BY' clause.
This means that the preceding query is legal in MySQL. You can use this
feature to get better performance by avoiding unnecessary column sorting
and grouping.  However, this is useful primarily when all values in each
nonaggregated column not named in the 'GROUP BY' are the same for each
group.  The server is free to choose any value from each group, so
unless they are the same, the values chosen are nondeterministic.
Furthermore, the selection of values from each group cannot be
influenced by adding an 'ORDER BY' clause.  Result set sorting occurs
after values have been chosen, and 'ORDER BY' does not affect which
values within each group the server chooses.

A similar MySQL extension applies to the 'HAVING' clause.  In standard
SQL, a query cannot refer to nonaggregated columns in the 'HAVING'
clause that are not named in the 'GROUP BY' clause.  To simplify
calculations, a MySQL extension permits references to such columns.
This extension assumes that the nongrouped columns have the same
group-wise values.  Otherwise, the result is nondeterministic.

To disable the MySQL 'GROUP BY' extension and enable standard SQL
behavior, enable the 'ONLY_FULL_GROUP_BY' SQL mode.  In this case,
columns not named in the 'GROUP BY' clause cannot be used in the select
list or 'HAVING' clause unless enclosed in an aggregate function.

The select list extension also applies to 'ORDER BY'.  That is, you can
refer to nonaggregated columns in the 'ORDER BY' clause that do not
appear in the 'GROUP BY' clause.  (However, as mentioned previously,
'ORDER BY' does not affect which values are chosen from nonaggregated
columns; it only sorts them after they have been chosen.)  This
extension does not apply if the 'ONLY_FULL_GROUP_BY' SQL mode is
enabled.

If a query has aggregate functions and no 'GROUP BY' clause, it cannot
have nonaggregated columns in the select list, 'HAVING' condition, or
'ORDER BY' list with 'ONLY_FULL_GROUP_BY' enabled:


     mysql> SELECT name, MAX(age) FROM t;
     ERROR 1140 (42000): Mixing of GROUP columns (MIN(),MAX(),COUNT(),...)
     with no GROUP columns is illegal if there is no GROUP BY clause

Without 'GROUP BY', there is a single group and it is nondeterministic
which 'name' value to choose for the group.

Another MySQL extension to standard SQL permits references in the
'HAVING' clause to aliased expressions in the select list.  Enabling
'ONLY_FULL_GROUP_BY' prevents this.  For example, the following query
returns 'name' values that occur only once in table 'orders'; the query
is accepted regardless of whether 'ONLY_FULL_GROUP_BY' is enabled:

     SELECT name, COUNT(name) FROM orders
       GROUP BY name
       HAVING COUNT(name) = 1;

The following query is accepted only if 'ONLY_FULL_GROUP_BY' is
disabled.

     SELECT name, COUNT(name) AS c FROM orders
       GROUP BY name
       HAVING c = 1;

If you are trying to follow standard SQL, you can use only column
expressions in 'GROUP BY' clauses.  As a workaround, use an alias for
the expression:

     SELECT id, FLOOR(value/100) AS val
       FROM TBL_NAME
       GROUP BY id, val;

MySQL permits noncolumn expressions in 'GROUP BY' clauses, so the alias
is unnecessary:

     SELECT id, FLOOR(value/100)
       FROM TBL_NAME
       GROUP BY id, FLOOR(value/100);


File: manual.info.tmp,  Node: miscellaneous-functions,  Next: precision-math,  Prev: group-by-functions-and-modifiers,  Up: functions

12.18 Miscellaneous Functions
=============================

*Miscellaneous Functions*

Name                          Description
                              
'DEFAULT()'                   Return the default value for a table
                              column
                              
'INET_ATON()'                 Return the numeric value of an IP address
                              
'INET_NTOA()'                 Return the IP address from a numeric
                              value
                              
'MASTER_POS_WAIT()'           Block until the slave has read and
                              applied all updates up to the specified
                              position
                              
'NAME_CONST()'                Cause the column to have the given name
                              
'SLEEP()'                     Sleep for a number of seconds
                              
'UUID()'                      Return a Universal Unique Identifier
                              (UUID)
                              
'UUID_SHORT()'                Return an integer-valued universal
                              identifier
                              
'VALUES()'                    Define the values to be used during an
                              INSERT

   * 
     'DEFAULT(COL_NAME)'

     Returns the default value for a table column.  An error results if
     the column has no default value.

          mysql> UPDATE t SET i = DEFAULT(i)+1 WHERE id < 100;

   * 'FORMAT(X,D)'

     Formats the number X to a format like ''#,###,###.##'', rounded to
     D decimal places, and returns the result as a string.  For details,
     see *note string-functions::.

   * 
     'INET_ATON(EXPR)'

     Given the dotted-quad representation of an IPv4 network address as
     a string, returns an integer that represents the numeric value of
     the address in network byte order (big endian).  'INET_ATON()'
     returns 'NULL' if it does not understand its argument.

          mysql> SELECT INET_ATON('10.0.5.9');
                  -> 167773449

     For this example, the return value is calculated as 10x256^3 +
     0x256^2 + 5x256 + 9.

     'INET_ATON()' may or may not return a non-'NULL' result for
     short-form IP addresses (such as ''127.1'' as a representation of
     ''127.0.0.1'').  Because of this, 'INET_ATON()'a should not be used
     for such addresses.

     *Note*:

     To store values generated by 'INET_ATON()', use an 'INT UNSIGNED'
     column rather than *note 'INT': integer-types, which is signed.  If
     you use a signed column, values corresponding to IP addresses for
     which the first octet is greater than 127 cannot be stored
     correctly.  See *note out-of-range-and-overflow::.

   * 
     'INET_NTOA(EXPR)'

     Given a numeric IPv4 network address in network byte order, returns
     the dotted-quad representation of the address as a string.
     'INET_NTOA()' returns 'NULL' if it does not understand its
     argument.

     The return value is a string in the connection character set.

          mysql> SELECT INET_NTOA(167773449);
                  -> '10.0.5.9'

   * 
     'MASTER_POS_WAIT(LOG_NAME,LOG_POS[,TIMEOUT])'

     This function is useful for control of master/slave
     synchronization.  It blocks until the slave has read and applied
     all updates up to the specified position in the master log.  The
     return value is the number of log events the slave had to wait for
     to advance to the specified position.  The function returns 'NULL'
     if the slave SQL thread is not started, the slave's master
     information is not initialized, the arguments are incorrect, or an
     error occurs.  It returns '-1' if the timeout has been exceeded.
     If the slave SQL thread stops while 'MASTER_POS_WAIT()' is waiting,
     the function returns 'NULL'.  If the slave is past the specified
     position, the function returns immediately.

     If a TIMEOUT value is specified, 'MASTER_POS_WAIT()' stops waiting
     when TIMEOUT seconds have elapsed.  TIMEOUT must be greater than 0;
     a zero or negative TIMEOUT means no timeout.  The lock is
     exclusive.  While held by one session, other sessions cannot obtain
     a lock of the same name.

     This function is unsafe for statement-based replication.  A warning
     is logged if you use this function when 'binlog_format' is set to
     'STATEMENT'.

   * 
     'NAME_CONST(NAME,VALUE)'

     Returns the given value.  When used to produce a result set column,
     'NAME_CONST()' causes the column to have the given name.  The
     arguments should be constants.

          mysql> SELECT NAME_CONST('myname', 14);
          +--------+
          | myname |
          +--------+
          |     14 |
          +--------+

     This function is for internal use only.  The server uses it when
     writing statements from stored programs that contain references to
     local program variables, as described in *note
     stored-programs-logging::.  You might see this function in the
     output from *note 'mysqlbinlog': mysqlbinlog.

     For your applications, you can obtain exactly the same result as in
     the example just shown by using simple aliasing, like this:

          mysql> SELECT 14 AS myname;
          +--------+
          | myname |
          +--------+
          |     14 |
          +--------+
          1 row in set (0.00 sec)

     See *note select::, for more information about column aliases.

   * 
     'SLEEP(DURATION)'

     Sleeps (pauses) for the number of seconds given by the DURATION
     argument, then returns 0.  If 'SLEEP()' is interrupted, it returns
     1.  The duration may have a fractional part.

     When sleep returns normally (without interruption), it returns 0:

          mysql> SELECT SLEEP(1000);
          +-------------+
          | SLEEP(1000) |
          +-------------+
          |           0 |
          +-------------+

     When 'SLEEP()' is the only thing invoked by a query that is
     interrupted, it returns 1 and the query itself returns no error.
     This statement is interrupted using *note 'KILL QUERY': kill. from
     another session:

          mysql> SELECT SLEEP(1000);
          +-------------+
          | SLEEP(1000) |
          +-------------+
          |           1 |
          +-------------+

     When 'SLEEP()' is only part of a query that is interrupted, the
     query returns an error.  This statement is interrupted using *note
     'KILL QUERY': kill. from another session:

          mysql> SELECT 1 FROM t1 WHERE SLEEP(1000);
          ERROR 1317 (70100): Query execution was interrupted

     This function is unsafe for statement-based replication.  A warning
     is logged if you use this function when 'binlog_format' is set to
     'STATEMENT'.

   * 
     'UUID()'

     Returns a Universal Unique Identifier (UUID) generated according to
     RFC 4122, 'A Universally Unique IDentifier (UUID) URN Namespace'
     (<http://www.ietf.org/rfc/rfc4122.txt>).

     A UUID is designed as a number that is globally unique in space and
     time.  Two calls to 'UUID()' are expected to generate two different
     values, even if these calls are performed on two separate devices
     not connected to each other.

     *Warning*:

     Although 'UUID()' values are intended to be unique, they are not
     necessarily unguessable or unpredictable.  If unpredictability is
     required, UUID values should be generated some other way.

     'UUID()' returns a value that conforms to UUID version 1 as
     described in RFC 4122.  The value is a 128-bit number represented
     as a 'utf8' string of five hexadecimal numbers in
     'aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee' format:

        * The first three numbers are generated from the low, middle,
          and high parts of a timestamp.  The high part also includes
          the UUID version number.

        * The fourth number preserves temporal uniqueness in case the
          timestamp value loses monotonicity (for example, due to
          daylight saving time).

        * The fifth number is an IEEE 802 node number that provides
          spatial uniqueness.  A random number is substituted if the
          latter is not available (for example, because the host device
          has no Ethernet card, or it is unknown how to find the
          hardware address of an interface on the host operating
          system).  In this case, spatial uniqueness cannot be
          guaranteed.  Nevertheless, a collision should have _very_ low
          probability.

          The MAC address of an interface is taken into account only on
          FreeBSD, Linux, and Windows.  On other operating systems,
          MySQL uses a randomly generated 48-bit number.

          mysql> SELECT UUID();
                  -> '6ccd780c-baba-1026-9564-5b8c656024db'

     This function is unsafe for statement-based replication.  A warning
     is logged if you use this function when 'binlog_format' is set to
     'STATEMENT'.

   * 
     'UUID_SHORT()'

     Returns a 'short' universal identifier as a 64-bit unsigned
     integer.  Values returned by 'UUID_SHORT()' differ from the
     string-format 128-bit identifiers returned by the 'UUID()' function
     and have different uniqueness properties.  The value of
     'UUID_SHORT()' is guaranteed to be unique if the following
     conditions hold:

        * The 'server_id' value of the current server is between 0 and
          255 and is unique among your set of master and slave servers

        * You do not set back the system time for your server host
          between *note 'mysqld': mysqld. restarts

        * You invoke 'UUID_SHORT()' on average fewer than 16 million
          times per second between *note 'mysqld': mysqld. restarts

     The 'UUID_SHORT()' return value is constructed this way:

            (server_id & 255) << 56
          + (server_startup_time_in_seconds << 24)
          + incremented_variable++;

          mysql> SELECT UUID_SHORT();
                  -> 92395783831158784

     *Note*:

     'UUID_SHORT()' does not work with statement-based replication.

   * 
     'VALUES(COL_NAME)'

     In an *note 'INSERT ... ON DUPLICATE KEY UPDATE':
     insert-on-duplicate. statement, you can use the 'VALUES(COL_NAME)'
     function in the *note 'UPDATE': update. clause to refer to column
     values from the *note 'INSERT': insert. portion of the statement.
     In other words, 'VALUES(COL_NAME)' in the *note 'UPDATE': update.
     clause refers to the value of COL_NAME that would be inserted, had
     no duplicate-key conflict occurred.  This function is especially
     useful in multiple-row inserts.  The 'VALUES()' function is
     meaningful only in the 'ON DUPLICATE KEY UPDATE' clause of *note
     'INSERT': insert. statements and returns 'NULL' otherwise.  See
     *note insert-on-duplicate::.

          mysql> INSERT INTO table (a,b,c) VALUES (1,2,3),(4,5,6)
              -> ON DUPLICATE KEY UPDATE c=VALUES(a)+VALUES(b);


File: manual.info.tmp,  Node: precision-math,  Prev: miscellaneous-functions,  Up: functions

12.19 Precision Math
====================

* Menu:

* precision-math-numbers::       Types of Numeric Values
* precision-math-decimal-characteristics::  DECIMAL Data Type Characteristics
* precision-math-expressions::   Expression Handling
* precision-math-rounding::      Rounding Behavior
* precision-math-examples::      Precision Math Examples

MySQL provides support for precision math: numeric value handling that
results in extremely accurate results and a high degree control over
invalid values.  Precision math is based on these two features:

   * SQL modes that control how strict the server is about accepting or
     rejecting invalid data.

   * The MySQL library for fixed-point arithmetic.

These features have several implications for numeric operations and
provide a high degree of compliance with standard SQL:

   * *Precise calculations*: For exact-value numbers, calculations do
     not introduce floating-point errors.  Instead, exact precision is
     used.  For example, MySQL treats a number such as '.0001' as an
     exact value rather than as an approximation, and summing it 10,000
     times produces a result of exactly '1', not a value that is merely
     'close' to 1.

   * *Well-defined rounding behavior*: For exact-value numbers, the
     result of 'ROUND()' depends on its argument, not on environmental
     factors such as how the underlying C library works.

   * *Platform independence*: Operations on exact numeric values are the
     same across different platforms such as Windows and Unix.

   * *Control over handling of invalid values*: Overflow and division by
     zero are detectable and can be treated as errors.  For example, you
     can treat a value that is too large for a column as an error rather
     than having the value truncated to lie within the range of the
     column's data type.  Similarly, you can treat division by zero as
     an error rather than as an operation that produces a result of
     'NULL'.  The choice of which approach to take is determined by the
     setting of the server SQL mode.

The following discussion covers several aspects of how precision math
works, including possible incompatibilities with older applications.  At
the end, some examples are given that demonstrate how MySQL handles
numeric operations precisely.  For information about controlling the SQL
mode, see *note sql-mode::.


File: manual.info.tmp,  Node: precision-math-numbers,  Next: precision-math-decimal-characteristics,  Prev: precision-math,  Up: precision-math

12.19.1 Types of Numeric Values
-------------------------------

The scope of precision math for exact-value operations includes the
exact-value data types (integer and *note 'DECIMAL': fixed-point-types.
types) and exact-value numeric literals.  Approximate-value data types
and numeric literals are handled as floating-point numbers.

Exact-value numeric literals have an integer part or fractional part, or
both.  They may be signed.  Examples: '1', '.2', '3.4', '-5', '-6.78',
'+9.10'.

Approximate-value numeric literals are represented in scientific
notation with a mantissa and exponent.  Either or both parts may be
signed.  Examples: '1.2E3', '1.2E-3', '-1.2E3', '-1.2E-3'.

Two numbers that look similar may be treated differently.  For example,
'2.34' is an exact-value (fixed-point) number, whereas '2.34E0' is an
approximate-value (floating-point) number.

The *note 'DECIMAL': fixed-point-types. data type is a fixed-point type
and calculations are exact.  In MySQL, the *note 'DECIMAL':
fixed-point-types. type has several synonyms: *note 'NUMERIC':
fixed-point-types, *note 'DEC': fixed-point-types, *note 'FIXED':
fixed-point-types.  The integer types also are exact-value types.

The *note 'FLOAT': floating-point-types. and *note 'DOUBLE':
floating-point-types. data types are floating-point types and
calculations are approximate.  In MySQL, types that are synonymous with
*note 'FLOAT': floating-point-types. or *note 'DOUBLE':
floating-point-types. are *note 'DOUBLE PRECISION':
floating-point-types. and *note 'REAL': floating-point-types.


File: manual.info.tmp,  Node: precision-math-decimal-characteristics,  Next: precision-math-expressions,  Prev: precision-math-numbers,  Up: precision-math

12.19.2 DECIMAL Data Type Characteristics
-----------------------------------------

This section discusses the characteristics of the *note 'DECIMAL':
fixed-point-types. data type (and its synonyms), with particular regard
to the following topics:

   * Maximum number of digits

   * Storage format

   * Storage requirements

   * The nonstandard MySQL extension to the upper range of *note
     'DECIMAL': fixed-point-types. columns

Possible incompatibilities with applications that are written for older
versions of MySQL (prior to 5.0.3) are noted throughout this section.

The declaration syntax for a *note 'DECIMAL': fixed-point-types. column
is 'DECIMAL(M,D)'.  The ranges of values for the arguments are as
follows:

   * M is the maximum number of digits (the precision).  It has a range
     of 1 to 65.  (Older versions of MySQL permitted a range of 1 to
     254.)

   * D is the number of digits to the right of the decimal point (the
     scale).  It has a range of 0 to 30 and must be no larger than M.

If D is omitted, the default is 0.  If M is omitted, the default is 10.

The maximum value of 65 for M means that calculations on *note
'DECIMAL': fixed-point-types. values are accurate up to 65 digits.  This
limit of 65 digits of precision also applies to exact-value numeric
literals, so the maximum range of such literals differs from before.
(In older versions of MySQL, decimal values could have up to 254 digits.
However, calculations were done using floating-point and thus were
approximate, not exact.)

Values for *note 'DECIMAL': fixed-point-types. columns are stored using
a binary format that packs nine decimal digits into 4 bytes.  The
storage requirements for the integer and fractional parts of each value
are determined separately.  Each multiple of nine digits requires 4
bytes, and any remaining digits left over require some fraction of 4
bytes.  The storage required for remaining digits is given by the
following table.

Leftover Digits    Number of Bytes
                   
0                  0
                   
1-2                1
                   
3-4                2
                   
5-6                3
                   
7-9                4

For example, a 'DECIMAL(18,9)' column has nine digits on either side of
the decimal point, so the integer part and the fractional part each
require 4 bytes.  A 'DECIMAL(20,6)' column has fourteen integer digits
and six fractional digits.  The integer digits require four bytes for
nine of the digits and 3 bytes for the remaining five digits.  The six
fractional digits require 3 bytes.

Unlike some older versions of MySQL, *note 'DECIMAL': fixed-point-types.
columns in MySQL 5.5 do not store a leading '+' character or '-'
character or leading '0' digits.  If you insert '+0003.1' into a
'DECIMAL(5,1)' column, it is stored as '3.1'.  For negative numbers, a
literal '-' character is not stored.  Applications that rely on the
older behavior must be modified to account for this change.

*note 'DECIMAL': fixed-point-types. columns do not permit values larger
than the range implied by the column definition.  For example, a
'DECIMAL(3,0)' column supports a range of '-999' to '999'.  A
'DECIMAL(M,D)' column permits up to M - D digits to the left of the
decimal point.  This is not compatible with applications relying on
older versions of MySQL that permitted storing an extra digit in lieu of
a '+' sign.

The SQL standard requires that the precision of 'NUMERIC(M,D)' be
_exactly_ M digits.  For 'DECIMAL(M,D)', the standard requires a
precision of at least M digits but permits more.  In MySQL,
'DECIMAL(M,D)' and 'NUMERIC(M,D)' are the same, and both have a
precision of exactly M digits.

For a full explanation of the internal format of 'DECIMAL' values, see
the file 'strings/decimal.c' in a MySQL source distribution.  The format
is explained (with an example) in the 'decimal2bin()' function.

For more detailed information about porting applications that rely on
the old treatment of the *note 'DECIMAL': fixed-point-types. data type,
see the 'MySQL 5.0 Reference Manual'.


File: manual.info.tmp,  Node: precision-math-expressions,  Next: precision-math-rounding,  Prev: precision-math-decimal-characteristics,  Up: precision-math

12.19.3 Expression Handling
---------------------------

With precision math, exact-value numbers are used as given whenever
possible.  For example, numbers in comparisons are used exactly as given
without a change in value.  In strict SQL mode, for *note 'INSERT':
insert. into a column with an exact data type (*note 'DECIMAL':
fixed-point-types. or integer), a number is inserted with its exact
value if it is within the column range.  When retrieved, the value
should be the same as what was inserted.  (If strict SQL mode is not
enabled, truncation for *note 'INSERT': insert. is permissible.)

Handling of a numeric expression depends on what kind of values the
expression contains:

   * If any approximate values are present, the expression is
     approximate and is evaluated using floating-point arithmetic.

   * If no approximate values are present, the expression contains only
     exact values.  If any exact value contains a fractional part (a
     value following the decimal point), the expression is evaluated
     using *note 'DECIMAL': fixed-point-types. exact arithmetic and has
     a precision of 65 digits.  The term 'exact' is subject to the
     limits of what can be represented in binary.  For example,
     '1.0/3.0' can be approximated in decimal notation as '.333...', but
     not written as an exact number, so '(1.0/3.0)*3.0' does not
     evaluate to exactly '1.0'.

   * Otherwise, the expression contains only integer values.  The
     expression is exact and is evaluated using integer arithmetic and
     has a precision the same as *note 'BIGINT': integer-types. (64
     bits).

If a numeric expression contains any strings, they are converted to
double-precision floating-point values and the expression is
approximate.

Inserts into numeric columns are affected by the SQL mode, which is
controlled by the 'sql_mode' system variable.  (See *note sql-mode::.)
The following discussion mentions strict mode (selected by the
'STRICT_ALL_TABLES' or 'STRICT_TRANS_TABLES' mode values) and
'ERROR_FOR_DIVISION_BY_ZERO'.  To turn on all restrictions, you can
simply use 'TRADITIONAL' mode, which includes both strict mode values
and 'ERROR_FOR_DIVISION_BY_ZERO':

     SET sql_mode='TRADITIONAL';

If a number is inserted into an exact type column (*note 'DECIMAL':
fixed-point-types. or integer), it is inserted with its exact value if
it is within the column range and precision.

If the value has too many digits in the fractional part, rounding occurs
and a note is generated.  Rounding is done as described in *note
precision-math-rounding::.  Truncation due to rounding of the fractional
part is not an error, even in strict mode.

If the value has too many digits in the integer part, it is too large
(out of range) and is handled as follows:

   * If strict mode is not enabled, the value is truncated to the
     nearest legal value and a warning is generated.

   * If strict mode is enabled, an overflow error occurs.

Underflow is not detected, so underflow handling is undefined.

For inserts of strings into numeric columns, conversion from string to
number is handled as follows if the string has nonnumeric contents:

   * A string that does not begin with a number cannot be used as a
     number and produces an error in strict mode, or a warning
     otherwise.  This includes the empty string.

   * A string that begins with a number can be converted, but the
     trailing nonnumeric portion is truncated.  If the truncated portion
     contains anything other than spaces, this produces an error in
     strict mode, or a warning otherwise.

By default, division by zero produces a result of 'NULL' and no warning.
By setting the SQL mode appropriately, division by zero can be
restricted.

With the 'ERROR_FOR_DIVISION_BY_ZERO' SQL mode enabled, MySQL handles
division by zero differently:

   * If strict mode is not enabled, a warning occurs.

   * If strict mode is enabled, inserts and updates involving division
     by zero are prohibited, and an error occurs.

In other words, inserts and updates involving expressions that perform
division by zero can be treated as errors, but this requires
'ERROR_FOR_DIVISION_BY_ZERO' in addition to strict mode.

Suppose that we have this statement:

     INSERT INTO t SET i = 1/0;

This is what happens for combinations of strict and
'ERROR_FOR_DIVISION_BY_ZERO' modes.

'sql_mode' Value                     Result
                                     
'''' (Default)                       No warning, no error; 'i' is set
                                     to 'NULL'.
                                     
strict                               No warning, no error; 'i' is set
                                     to 'NULL'.
                                     
'ERROR_FOR_DIVISION_BY_ZERO'         Warning, no error; 'i' is set to
                                     'NULL'.
                                     
strict,'ERROR_FOR_DIVISION_BY_ZERO'  Error condition; no row is
                                     inserted.


File: manual.info.tmp,  Node: precision-math-rounding,  Next: precision-math-examples,  Prev: precision-math-expressions,  Up: precision-math

12.19.4 Rounding Behavior
-------------------------

This section discusses precision math rounding for the 'ROUND()'
function and for inserts into columns with exact-value types (*note
'DECIMAL': fixed-point-types. and integer).

The 'ROUND()' function rounds differently depending on whether its
argument is exact or approximate:

   * For exact-value numbers, 'ROUND()' uses the 'round half up' rule: A
     value with a fractional part of .5 or greater is rounded up to the
     next integer if positive or down to the next integer if negative.
     (In other words, it is rounded away from zero.)  A value with a
     fractional part less than .5 is rounded down to the next integer if
     positive or up to the next integer if negative.  (In other words,
     it is rounded toward zero.)

   * For approximate-value numbers, the result depends on the C library.
     On many systems, this means that 'ROUND()' uses the 'round to
     nearest even' rule: A value with a fractional part exactly half way
     between two integers is rounded to the nearest even integer.

The following example shows how rounding differs for exact and
approximate values:

     mysql> SELECT ROUND(2.5), ROUND(25E-1);
     +------------+--------------+
     | ROUND(2.5) | ROUND(25E-1) |
     +------------+--------------+
     | 3          |            2 |
     +------------+--------------+

For inserts into a *note 'DECIMAL': fixed-point-types. or integer
column, the target is an exact data type, so rounding uses 'round half
away from zero,' regardless of whether the value to be inserted is exact
or approximate:

     mysql> CREATE TABLE t (d DECIMAL(10,0));
     Query OK, 0 rows affected (0.00 sec)

     mysql> INSERT INTO t VALUES(2.5),(2.5E0);
     Query OK, 2 rows affected, 2 warnings (0.00 sec)
     Records: 2  Duplicates: 0  Warnings: 2

     mysql> SHOW WARNINGS;
     +-------+------+----------------------------------------+
     | Level | Code | Message                                |
     +-------+------+----------------------------------------+
     | Note  | 1265 | Data truncated for column 'd' at row 1 |
     | Note  | 1265 | Data truncated for column 'd' at row 2 |
     +-------+------+----------------------------------------+
     2 rows in set (0.00 sec)

     mysql> SELECT d FROM t;
     +------+
     | d    |
     +------+
     |    3 |
     |    3 |
     +------+
     2 rows in set (0.00 sec)

The *note 'SHOW WARNINGS': show-warnings. statement displays the notes
that are generated by truncation due to rounding of the fractional part.
Such truncation is not an error, even in strict SQL mode (see *note
precision-math-expressions::).


File: manual.info.tmp,  Node: precision-math-examples,  Prev: precision-math-rounding,  Up: precision-math

12.19.5 Precision Math Examples
-------------------------------

This section provides some examples that show precision math query
results in MySQL. These examples demonstrate the principles described in
*note precision-math-expressions::, and *note precision-math-rounding::.

*Example 1*.  Numbers are used with their exact value as given when
possible:

     mysql> SELECT (.1 + .2) = .3;
     +----------------+
     | (.1 + .2) = .3 |
     +----------------+
     |              1 |
     +----------------+

For floating-point values, results are inexact:

     mysql> SELECT (.1E0 + .2E0) = .3E0;
     +----------------------+
     | (.1E0 + .2E0) = .3E0 |
     +----------------------+
     |                    0 |
     +----------------------+

Another way to see the difference in exact and approximate value
handling is to add a small number to a sum many times.  Consider the
following stored procedure, which adds '.0001' to a variable 1,000
times.

     CREATE PROCEDURE p ()
     BEGIN
       DECLARE i INT DEFAULT 0;
       DECLARE d DECIMAL(10,4) DEFAULT 0;
       DECLARE f FLOAT DEFAULT 0;
       WHILE i < 10000 DO
         SET d = d + .0001;
         SET f = f + .0001E0;
         SET i = i + 1;
       END WHILE;
       SELECT d, f;
     END;

The sum for both 'd' and 'f' logically should be 1, but that is true
only for the decimal calculation.  The floating-point calculation
introduces small errors:

     +--------+------------------+
     | d      | f                |
     +--------+------------------+
     | 1.0000 | 0.99999999999991 |
     +--------+------------------+

*Example 2*.  Multiplication is performed with the scale required by
standard SQL. That is, for two numbers X1 and X2 that have scale S1 and
S2, the scale of the result is 'S1 + S2':

     mysql> SELECT .01 * .01;
     +-----------+
     | .01 * .01 |
     +-----------+
     | 0.0001    |
     +-----------+

*Example 3*.  Rounding behavior for exact-value numbers is well-defined:

Rounding behavior (for example, with the 'ROUND()' function) is
independent of the implementation of the underlying C library, which
means that results are consistent from platform to platform.

   * Rounding for exact-value columns (*note 'DECIMAL':
     fixed-point-types. and integer) and exact-valued numbers uses the
     'round half away from zero' rule.  A value with a fractional part
     of .5 or greater is rounded away from zero to the nearest integer,
     as shown here:

          mysql> SELECT ROUND(2.5), ROUND(-2.5);
          +------------+-------------+
          | ROUND(2.5) | ROUND(-2.5) |
          +------------+-------------+
          | 3          | -3          |
          +------------+-------------+

   * Rounding for floating-point values uses the C library, which on
     many systems uses the 'round to nearest even' rule.  A value with a
     fractional part exactly half way between two integers is rounded to
     the nearest even integer:

          mysql> SELECT ROUND(2.5E0), ROUND(-2.5E0);
          +--------------+---------------+
          | ROUND(2.5E0) | ROUND(-2.5E0) |
          +--------------+---------------+
          |            2 |            -2 |
          +--------------+---------------+

*Example 4*.  In strict mode, inserting a value that is out of range for
a column causes an error, rather than truncation to a legal value.

When MySQL is not running in strict mode, truncation to a legal value
occurs:

     mysql> SET sql_mode='';
     Query OK, 0 rows affected (0.00 sec)

     mysql> CREATE TABLE t (i TINYINT);
     Query OK, 0 rows affected (0.01 sec)

     mysql> INSERT INTO t SET i = 128;
     Query OK, 1 row affected, 1 warning (0.00 sec)

     mysql> SELECT i FROM t;
     +------+
     | i    |
     +------+
     |  127 |
     +------+
     1 row in set (0.00 sec)

However, an error occurs if strict mode is in effect:

     mysql> SET sql_mode='STRICT_ALL_TABLES';
     Query OK, 0 rows affected (0.00 sec)

     mysql> CREATE TABLE t (i TINYINT);
     Query OK, 0 rows affected (0.00 sec)

     mysql> INSERT INTO t SET i = 128;
     ERROR 1264 (22003): Out of range value adjusted for column 'i' at row 1

     mysql> SELECT i FROM t;
     Empty set (0.00 sec)

*Example 5*: In strict mode and with 'ERROR_FOR_DIVISION_BY_ZERO' set,
division by zero causes an error, not a result of 'NULL'.

In nonstrict mode, division by zero has a result of 'NULL':

     mysql> SET sql_mode='';
     Query OK, 0 rows affected (0.01 sec)

     mysql> CREATE TABLE t (i TINYINT);
     Query OK, 0 rows affected (0.00 sec)

     mysql> INSERT INTO t SET i = 1 / 0;
     Query OK, 1 row affected (0.00 sec)

     mysql> SELECT i FROM t;
     +------+
     | i    |
     +------+
     | NULL |
     +------+
     1 row in set (0.03 sec)

However, division by zero is an error if the proper SQL modes are in
effect:

     mysql> SET sql_mode='STRICT_ALL_TABLES,ERROR_FOR_DIVISION_BY_ZERO';
     Query OK, 0 rows affected (0.00 sec)

     mysql> CREATE TABLE t (i TINYINT);
     Query OK, 0 rows affected (0.00 sec)

     mysql> INSERT INTO t SET i = 1 / 0;
     ERROR 1365 (22012): Division by 0

     mysql> SELECT i FROM t;
     Empty set (0.01 sec)

*Example 6*.  Exact-value literals are evaluated as exact values.

Prior to MySQL 5.0.3, exact-value and approximate-value literals both
are evaluated as double-precision floating-point values:

     mysql> SELECT VERSION();
     +------------+
     | VERSION()  |
     +------------+
     | 4.1.18-log |
     +------------+
     1 row in set (0.01 sec)

     mysql> CREATE TABLE t SELECT 2.5 AS a, 25E-1 AS b;
     Query OK, 1 row affected (0.07 sec)
     Records: 1  Duplicates: 0  Warnings: 0

     mysql> DESCRIBE t;
     +-------+-------------+------+-----+---------+-------+
     | Field | Type        | Null | Key | Default | Extra |
     +-------+-------------+------+-----+---------+-------+
     | a     | double(3,1) |      |     | 0.0     |       |
     | b     | double      |      |     | 0       |       |
     +-------+-------------+------+-----+---------+-------+
     2 rows in set (0.04 sec)

As of MySQL 5.0.3, the approximate-value literal is evaluated using
floating point, but the exact-value literal is handled as *note
'DECIMAL': fixed-point-types.:

     mysql> SELECT VERSION();
     +-----------------+
     | VERSION()       |
     +-----------------+
     | 5.1.6-alpha-log |
     +-----------------+
     1 row in set (0.11 sec)

     mysql> CREATE TABLE t SELECT 2.5 AS a, 25E-1 AS b;
     Query OK, 1 row affected (0.01 sec)
     Records: 1  Duplicates: 0  Warnings: 0

     mysql> DESCRIBE t;
     +-------+-----------------------+------+-----+---------+-------+
     | Field | Type                  | Null | Key | Default | Extra |
     +-------+-----------------------+------+-----+---------+-------+
     | a     | decimal(2,1) unsigned | NO   |     | 0.0     |       |
     | b     | double                | NO   |     | 0       |       |
     +-------+-----------------------+------+-----+---------+-------+
     2 rows in set (0.01 sec)

*Example 7*.  If the argument to an aggregate function is an exact
numeric type, the result is also an exact numeric type, with a scale at
least that of the argument.

Consider these statements:

     mysql> CREATE TABLE t (i INT, d DECIMAL, f FLOAT);
     mysql> INSERT INTO t VALUES(1,1,1);
     mysql> CREATE TABLE y SELECT AVG(i), AVG(d), AVG(f) FROM t;

Before MySQL 5.0.3, the result is a double no matter the argument type:

     mysql> DESCRIBE y;
     +--------+--------------+------+-----+---------+-------+
     | Field  | Type         | Null | Key | Default | Extra |
     +--------+--------------+------+-----+---------+-------+
     | AVG(i) | double(17,4) | YES  |     | NULL    |       |
     | AVG(d) | double(17,4) | YES  |     | NULL    |       |
     | AVG(f) | double       | YES  |     | NULL    |       |
     +--------+--------------+------+-----+---------+-------+

As of MySQL 5.0.3, the result is a double only for the floating-point
argument.  For exact type arguments, the result is also an exact type:

     mysql> DESCRIBE y;
     +--------+---------------+------+-----+---------+-------+
     | Field  | Type          | Null | Key | Default | Extra |
     +--------+---------------+------+-----+---------+-------+
     | AVG(i) | decimal(14,4) | YES  |     | NULL    |       |
     | AVG(d) | decimal(14,4) | YES  |     | NULL    |       |
     | AVG(f) | double        | YES  |     | NULL    |       |
     +--------+---------------+------+-----+---------+-------+

The result is a double only for the floating-point argument.  For exact
type arguments, the result is also an exact type.


File: manual.info.tmp,  Node: sql-statements,  Next: innodb-storage-engine,  Prev: functions,  Up: Top

13 SQL Statements
*****************

* Menu:

* sql-data-definition-statements::  Data Definition Statements
* sql-data-manipulation-statements::  Data Manipulation Statements
* sql-transactional-statements::  Transactional and Locking Statements
* sql-replication-statements::   Replication Statements
* sql-prepared-statements::      Prepared Statements
* sql-compound-statements::      Compound-Statements
* sql-server-administration-statements::  Database Administration Statements
* sql-utility-statements::       Utility Statements

This chapter describes the syntax for the SQL statements supported by
MySQL.


File: manual.info.tmp,  Node: sql-data-definition-statements,  Next: sql-data-manipulation-statements,  Prev: sql-statements,  Up: sql-statements

13.1 Data Definition Statements
===============================

* Menu:

* alter-database::               ALTER DATABASE Statement
* alter-event::                  ALTER EVENT Statement
* alter-function::               ALTER FUNCTION Statement
* alter-logfile-group::          ALTER LOGFILE GROUP Statement
* alter-procedure::              ALTER PROCEDURE Statement
* alter-server::                 ALTER SERVER Statement
* alter-table::                  ALTER TABLE Statement
* alter-tablespace::             ALTER TABLESPACE Statement
* alter-view::                   ALTER VIEW Statement
* create-database::              CREATE DATABASE Statement
* create-event::                 CREATE EVENT Statement
* create-function::              CREATE FUNCTION Statement
* create-index::                 CREATE INDEX Statement
* create-logfile-group::         CREATE LOGFILE GROUP Statement
* create-procedure::             CREATE PROCEDURE and CREATE FUNCTION Statements
* create-server::                CREATE SERVER Statement
* create-table::                 CREATE TABLE Statement
* create-tablespace::            CREATE TABLESPACE Statement
* create-trigger::               CREATE TRIGGER Statement
* create-view::                  CREATE VIEW Statement
* drop-database::                DROP DATABASE Statement
* drop-event::                   DROP EVENT Statement
* drop-function::                DROP FUNCTION Statement
* drop-index::                   DROP INDEX Statement
* drop-logfile-group::           DROP LOGFILE GROUP Statement
* drop-procedure::               DROP PROCEDURE and DROP FUNCTION Statements
* drop-server::                  DROP SERVER Statement
* drop-table::                   DROP TABLE Statement
* drop-tablespace::              DROP TABLESPACE Statement
* drop-trigger::                 DROP TRIGGER Statement
* drop-view::                    DROP VIEW Statement
* rename-table::                 RENAME TABLE Statement
* truncate-table::               TRUNCATE TABLE Statement


File: manual.info.tmp,  Node: alter-database,  Next: alter-event,  Prev: sql-data-definition-statements,  Up: sql-data-definition-statements

13.1.1 ALTER DATABASE Statement
-------------------------------

     ALTER {DATABASE | SCHEMA} [DB_NAME]
         ALTER_SPECIFICATION ...
     ALTER {DATABASE | SCHEMA} DB_NAME
         UPGRADE DATA DIRECTORY NAME

     ALTER_SPECIFICATION:
         [DEFAULT] CHARACTER SET [=] CHARSET_NAME
       | [DEFAULT] COLLATE [=] COLLATION_NAME

*note 'ALTER DATABASE': alter-database. enables you to change the
overall characteristics of a database.  These characteristics are stored
in the 'db.opt' file in the database directory.  To use *note 'ALTER
DATABASE': alter-database, you need the 'ALTER' privilege on the
database.  *note 'ALTER SCHEMA': alter-database. is a synonym for *note
'ALTER DATABASE': alter-database.

The database name can be omitted from the first syntax, in which case
the statement applies to the default database.

*National Language Characteristics*

The 'CHARACTER SET' clause changes the default database character set.
The 'COLLATE' clause changes the default database collation.  *note
charset::, discusses character set and collation names.

You can see what character sets and collations are available using,
respectively, the *note 'SHOW CHARACTER SET': show-character-set. and
*note 'SHOW COLLATION': show-collation. statements.  See *note
show-character-set::, and *note show-collation::, for more information.

If you change the default character set or collation for a database,
stored routines that use the database defaults must be dropped and
recreated so that they use the new defaults.  (In a stored routine,
variables with character data types use the database defaults if the
character set or collation are not specified explicitly.  See *note
create-procedure::.)

*Upgrading from Versions Older than MySQL 5.1*

The syntax that includes the 'UPGRADE DATA DIRECTORY NAME' clause
updates the name of the directory associated with the database to use
the encoding implemented in MySQL 5.1 for mapping database names to
database directory names (see *note identifier-mapping::).  This clause
is for use under these conditions:

   * It is intended when upgrading MySQL to 5.1 or later from older
     versions.

   * It is intended to update a database directory name to the current
     encoding format if the name contains special characters that need
     encoding.

   * The statement is used by *note 'mysqlcheck': mysqlcheck. (as
     invoked by *note 'mysql_upgrade': mysql-upgrade.).

For example, if a database in MySQL 5.0 has the name 'a-b-c', the name
contains instances of the '-' (dash) character.  In MySQL 5.0, the
database directory is also named 'a-b-c', which is not necessarily safe
for all file systems.  In MySQL 5.1 and later, the same database name is
encoded as 'a@002db@002dc' to produce a file system-neutral directory
name.

When a MySQL installation is upgraded to MySQL 5.1 or later from an
older version,the server displays a name such as 'a-b-c' (which is in
the old format) as '#mysql50#a-b-c', and you must refer to the name
using the '#mysql50#' prefix.  Use 'UPGRADE DATA DIRECTORY NAME' in this
case to explicitly tell the server to re-encode the database directory
name to the current encoding format:

     ALTER DATABASE `#mysql50#a-b-c` UPGRADE DATA DIRECTORY NAME;

After executing this statement, you can refer to the database as 'a-b-c'
without the special '#mysql50#' prefix.


File: manual.info.tmp,  Node: alter-event,  Next: alter-function,  Prev: alter-database,  Up: sql-data-definition-statements

13.1.2 ALTER EVENT Statement
----------------------------

     ALTER
         [DEFINER = USER]
         EVENT EVENT_NAME
         [ON SCHEDULE SCHEDULE]
         [ON COMPLETION [NOT] PRESERVE]
         [RENAME TO NEW_EVENT_NAME]
         [ENABLE | DISABLE | DISABLE ON SLAVE]
         [COMMENT 'STRING']
         [DO EVENT_BODY]

The *note 'ALTER EVENT': alter-event. statement changes one or more of
the characteristics of an existing event without the need to drop and
recreate it.  The syntax for each of the 'DEFINER', 'ON SCHEDULE', 'ON
COMPLETION', 'COMMENT', 'ENABLE' / 'DISABLE', and *note 'DO': do.
clauses is exactly the same as when used with *note 'CREATE EVENT':
create-event.  (See *note create-event::.)

Any user can alter an event defined on a database for which that user
has the 'EVENT' privilege.  When a user executes a successful *note
'ALTER EVENT': alter-event. statement, that user becomes the definer for
the affected event.

*note 'ALTER EVENT': alter-event. works only with an existing event:

     mysql> ALTER EVENT no_such_event
          >     ON SCHEDULE
          >       EVERY '2:3' DAY_HOUR;
     ERROR 1517 (HY000): Unknown event 'no_such_event'

In each of the following examples, assume that the event named 'myevent'
is defined as shown here:

     CREATE EVENT myevent
         ON SCHEDULE
           EVERY 6 HOUR
         COMMENT 'A sample comment.'
         DO
           UPDATE myschema.mytable SET mycol = mycol + 1;

The following statement changes the schedule for 'myevent' from once
every six hours starting immediately to once every twelve hours,
starting four hours from the time the statement is run:

     ALTER EVENT myevent
         ON SCHEDULE
           EVERY 12 HOUR
         STARTS CURRENT_TIMESTAMP + INTERVAL 4 HOUR;

It is possible to change multiple characteristics of an event in a
single statement.  This example changes the SQL statement executed by
'myevent' to one that deletes all records from 'mytable'; it also
changes the schedule for the event such that it executes once, one day
after this *note 'ALTER EVENT': alter-event. statement is run.

     ALTER EVENT myevent
         ON SCHEDULE
           AT CURRENT_TIMESTAMP + INTERVAL 1 DAY
         DO
           TRUNCATE TABLE myschema.mytable;

Specify the options in an *note 'ALTER EVENT': alter-event. statement
only for those characteristics that you want to change; omitted options
keep their existing values.  This includes any default values for *note
'CREATE EVENT': create-event. such as 'ENABLE'.

To disable 'myevent', use this *note 'ALTER EVENT': alter-event.
statement:

     ALTER EVENT myevent
         DISABLE;

The 'ON SCHEDULE' clause may use expressions involving built-in MySQL
functions and user variables to obtain any of the TIMESTAMP or INTERVAL
values which it contains.  You cannot use stored routines or
user-defined functions in such expressions, and you cannot use any table
references; however, you can use 'SELECT FROM DUAL'.  This is true for
both *note 'ALTER EVENT': alter-event. and *note 'CREATE EVENT':
create-event. statements.  References to stored routines, user-defined
functions, and tables in such cases are specifically not permitted, and
fail with an error (see Bug #22830).

Although an *note 'ALTER EVENT': alter-event. statement that contains
another *note 'ALTER EVENT': alter-event. statement in its *note 'DO':
do. clause appears to succeed, when the server attempts to execute the
resulting scheduled event, the execution fails with an error.

To rename an event, use the *note 'ALTER EVENT': alter-event.
statement's 'RENAME TO' clause.  This statement renames the event
'myevent' to 'yourevent':

     ALTER EVENT myevent
         RENAME TO yourevent;

You can also move an event to a different database using 'ALTER EVENT
... RENAME TO ...' and 'DB_NAME.EVENT_NAME' notation, as shown here:

     ALTER EVENT olddb.myevent
         RENAME TO newdb.myevent;

To execute the previous statement, the user executing it must have the
'EVENT' privilege on both the 'olddb' and 'newdb' databases.

*Note*:

There is no 'RENAME EVENT' statement.

The value 'DISABLE ON SLAVE' is used on a replication slave instead of
'ENABLE' or 'DISABLE' to indicate an event that was created on the
master and replicated to the slave, but that is not executed on the
slave.  Normally, 'DISABLE ON SLAVE' is set automatically as required;
however, there are some circumstances under which you may want or need
to change it manually.  See *note replication-features-invoked::, for
more information.


File: manual.info.tmp,  Node: alter-function,  Next: alter-logfile-group,  Prev: alter-event,  Up: sql-data-definition-statements

13.1.3 ALTER FUNCTION Statement
-------------------------------

     ALTER FUNCTION FUNC_NAME [CHARACTERISTIC ...]

     CHARACTERISTIC:
         COMMENT 'STRING'
       | LANGUAGE SQL
       | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }
       | SQL SECURITY { DEFINER | INVOKER }

This statement can be used to change the characteristics of a stored
function.  More than one change may be specified in an *note 'ALTER
FUNCTION': alter-function. statement.  However, you cannot change the
parameters or body of a stored function using this statement; to make
such changes, you must drop and re-create the function using *note 'DROP
FUNCTION': drop-function. and *note 'CREATE FUNCTION': create-function.

You must have the 'ALTER ROUTINE' privilege for the function.  (That
privilege is granted automatically to the function creator.)  If binary
logging is enabled, the *note 'ALTER FUNCTION': alter-function.
statement might also require the 'SUPER' privilege, as described in
*note stored-programs-logging::.


File: manual.info.tmp,  Node: alter-logfile-group,  Next: alter-procedure,  Prev: alter-function,  Up: sql-data-definition-statements

13.1.4 ALTER LOGFILE GROUP Statement
------------------------------------

     ALTER LOGFILE GROUP LOGFILE_GROUP
         ADD UNDOFILE 'FILE_NAME'
         [INITIAL_SIZE [=] SIZE]
         [WAIT]
         ENGINE [=] ENGINE_NAME

This statement adds an 'UNDO' file named 'FILE_NAME' to an existing log
file group LOGFILE_GROUP.  An *note 'ALTER LOGFILE GROUP':
alter-logfile-group. statement has one and only one 'ADD UNDOFILE'
clause.  No 'DROP UNDOFILE' clause is currently supported.

*Note*:

All NDB Cluster Disk Data objects share the same namespace.  This means
that _each Disk Data object_ must be uniquely named (and not merely each
Disk Data object of a given type).  For example, you cannot have a
tablespace and an undo log file with the same name, or an undo log file
and a data file with the same name.

The optional 'INITIAL_SIZE' parameter sets the 'UNDO' file's initial
size in bytes; if not specified, the initial size defaults to 134217728
(128 MB). Prior to MySQL NDB Cluster 7.2.14, this value was required to
be specified using digits (Bug #13116514, Bug #16104705, Bug #62858); in
MySQL NDB Cluster 7.2.14 and later, you may optionally follow SIZE with
a one-letter abbreviation for an order of magnitude, similar to those
used in 'my.cnf'.  Generally, this is one of the letters 'M' (megabytes)
or 'G' (gigabytes).

On 32-bit systems, the maximum supported value for 'INITIAL_SIZE' is
4294967296 (4 GB). (Bug #29186)

The minimum allowed value for 'INITIAL_SIZE' is 1048576 (1 MB). (Bug
#29574)

*Note*:

'WAIT' is parsed but otherwise ignored.  This keyword currently has no
effect, and is intended for future expansion.

The 'ENGINE' parameter (required) determines the storage engine which is
used by this log file group, with ENGINE_NAME being the name of the
storage engine.  Currently, the only accepted values for ENGINE_NAME are
'*note 'NDBCLUSTER': mysql-cluster.' and '*note 'NDB': mysql-cluster.'.
The two values are equivalent.

Here is an example, which assumes that the log file group 'lg_3' has
already been created using *note 'CREATE LOGFILE GROUP':
create-logfile-group. (see *note create-logfile-group::):

     ALTER LOGFILE GROUP lg_3
         ADD UNDOFILE 'undo_10.dat'
         INITIAL_SIZE=32M
         ENGINE=NDBCLUSTER;

When *note 'ALTER LOGFILE GROUP': alter-logfile-group. is used with
'ENGINE = NDBCLUSTER' (alternatively, 'ENGINE = NDB'), an 'UNDO' log
file is created on each NDB Cluster data node.  You can verify that the
'UNDO' files were created and obtain information about them by querying
the *note 'INFORMATION_SCHEMA.FILES': files-table. table.  For example:

     mysql> SELECT FILE_NAME, LOGFILE_GROUP_NUMBER, EXTRA
         -> FROM INFORMATION_SCHEMA.FILES
         -> WHERE LOGFILE_GROUP_NAME = 'lg_3';
     +-------------+----------------------+----------------+
     | FILE_NAME   | LOGFILE_GROUP_NUMBER | EXTRA          |
     +-------------+----------------------+----------------+
     | newdata.dat |                    0 | CLUSTER_NODE=3 |
     | newdata.dat |                    0 | CLUSTER_NODE=4 |
     | undo_10.dat |                   11 | CLUSTER_NODE=3 |
     | undo_10.dat |                   11 | CLUSTER_NODE=4 |
     +-------------+----------------------+----------------+
     4 rows in set (0.01 sec)

(See *note files-table::.)

Memory used for 'UNDO_BUFFER_SIZE' comes from the global pool whose size
is determined by the value of the 'SharedGlobalMemory' data node
configuration parameter.  This includes any default value implied for
this option by the setting of the 'InitialLogFileGroup' data node
configuration parameter.

*note 'ALTER LOGFILE GROUP': alter-logfile-group. is useful only with
Disk Data storage for NDB Cluster.  For more information, see *note
mysql-cluster-disk-data::.


File: manual.info.tmp,  Node: alter-procedure,  Next: alter-server,  Prev: alter-logfile-group,  Up: sql-data-definition-statements

13.1.5 ALTER PROCEDURE Statement
--------------------------------

     ALTER PROCEDURE PROC_NAME [CHARACTERISTIC ...]

     CHARACTERISTIC:
         COMMENT 'STRING'
       | LANGUAGE SQL
       | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }
       | SQL SECURITY { DEFINER | INVOKER }

This statement can be used to change the characteristics of a stored
procedure.  More than one change may be specified in an *note 'ALTER
PROCEDURE': alter-procedure. statement.  However, you cannot change the
parameters or body of a stored procedure using this statement; to make
such changes, you must drop and re-create the procedure using *note
'DROP PROCEDURE': drop-procedure. and *note 'CREATE PROCEDURE':
create-procedure.

You must have the 'ALTER ROUTINE' privilege for the procedure.  By
default, that privilege is granted automatically to the procedure
creator.  This behavior can be changed by disabling the
'automatic_sp_privileges' system variable.  See *note
stored-routines-privileges::.


File: manual.info.tmp,  Node: alter-server,  Next: alter-table,  Prev: alter-procedure,  Up: sql-data-definition-statements

13.1.6 ALTER SERVER Statement
-----------------------------

     ALTER SERVER  SERVER_NAME
         OPTIONS (OPTION [, OPTION] ...)

Alters the server information for 'SERVER_NAME', adjusting any of the
options permitted in the *note 'CREATE SERVER': create-server.
statement.  The corresponding fields in the 'mysql.servers' table are
updated accordingly.  This statement requires the 'SUPER' privilege.

For example, to update the 'USER' option:

     ALTER SERVER s OPTIONS (USER 'sally');

'ALTER SERVER' causes an implicit commit.  See *note implicit-commit::.

'ALTER SERVER' is not written to the binary log, regardless of the
logging format that is in use.


File: manual.info.tmp,  Node: alter-table,  Next: alter-tablespace,  Prev: alter-server,  Up: sql-data-definition-statements

13.1.7 ALTER TABLE Statement
----------------------------

* Menu:

* alter-table-partition-operations::  ALTER TABLE Partition Operations
* alter-table-examples::         ALTER TABLE Examples

     ALTER [ONLINE|OFFLINE] [IGNORE] TABLE TBL_NAME
         [ALTER_SPECIFICATION [, ALTER_SPECIFICATION] ...]
         [PARTITION_OPTIONS]

     ALTER_SPECIFICATION:
         TABLE_OPTIONS
       | ADD [COLUMN] COL_NAME COLUMN_DEFINITION
             [FIRST | AFTER COL_NAME]
       | ADD [COLUMN] (COL_NAME COLUMN_DEFINITION,...)
       | ADD {INDEX|KEY} [INDEX_NAME]
             [INDEX_TYPE] (KEY_PART,...) [INDEX_OPTION] ...
       | ADD {FULLTEXT|SPATIAL} [INDEX|KEY] [INDEX_NAME]
             (KEY_PART,...) [INDEX_OPTION] ...
       | ADD [CONSTRAINT [SYMBOL]] PRIMARY KEY
             [INDEX_TYPE] (KEY_PART,...)
             [INDEX_OPTION] ...
       | ADD [CONSTRAINT [SYMBOL]] UNIQUE [INDEX|KEY]
             [INDEX_NAME] [INDEX_TYPE] (KEY_PART,...)
             [INDEX_OPTION] ...
       | ADD [CONSTRAINT [SYMBOL]] FOREIGN KEY
             [INDEX_NAME] (COL_NAME,...)
             REFERENCE_DEFINITION
       | ADD CHECK (EXPR)
       | ALTER [COLUMN] COL_NAME {SET DEFAULT LITERAL | DROP DEFAULT}
       | CHANGE [COLUMN] OLD_COL_NAME NEW_COL_NAME COLUMN_DEFINITION
             [FIRST|AFTER COL_NAME]
       | [DEFAULT] CHARACTER SET [=] CHARSET_NAME [COLLATE [=] COLLATION_NAME]
       | CONVERT TO CHARACTER SET CHARSET_NAME [COLLATE COLLATION_NAME]
       | {DISABLE|ENABLE} KEYS
       | {DISCARD|IMPORT} TABLESPACE
       | DROP [COLUMN] COL_NAME
       | DROP {INDEX|KEY} INDEX_NAME
       | DROP PRIMARY KEY
       | DROP FOREIGN KEY FK_SYMBOL
       | FORCE
       | MODIFY [COLUMN] COL_NAME COLUMN_DEFINITION
             [FIRST | AFTER COL_NAME]
       | ORDER BY COL_NAME [, COL_NAME] ...
       | RENAME [TO|AS] NEW_TBL_NAME

     PARTITION_OPTIONS:
         PARTITION_OPTION [PARTITION_OPTION] ...

     PARTITION_OPTION:
         ADD PARTITION (PARTITION_DEFINITION)
       | DROP PARTITION PARTITION_NAMES
       | TRUNCATE PARTITION {PARTITION_NAMES | ALL}
       | COALESCE PARTITION NUMBER
       | REORGANIZE PARTITION [PARTITION_NAMES INTO (PARTITION_DEFINITIONS)]
       | ANALYZE PARTITION {PARTITION_NAMES | ALL}
       | CHECK PARTITION {PARTITION_NAMES | ALL}
       | OPTIMIZE PARTITION {PARTITION_NAMES | ALL}
       | REBUILD PARTITION {PARTITION_NAMES | ALL}
       | REPAIR PARTITION {PARTITION_NAMES | ALL}
       | PARTITION BY PARTITIONING_EXPRESSION
       | REMOVE PARTITIONING

     KEY_PART:
         COL_NAME [(LENGTH)] [ASC | DESC]

     INDEX_TYPE:
         USING {BTREE | HASH}

     INDEX_OPTION:
         KEY_BLOCK_SIZE [=] VALUE
       | INDEX_TYPE
       | WITH PARSER PARSER_NAME
       | COMMENT 'STRING'

     TABLE_OPTIONS:
         TABLE_OPTION [[,] TABLE_OPTION] ...

     TABLE_OPTION:
         AUTO_INCREMENT [=] VALUE
       | AVG_ROW_LENGTH [=] VALUE
       | [DEFAULT] CHARACTER SET [=] CHARSET_NAME
       | CHECKSUM [=] {0 | 1}
       | [DEFAULT] COLLATE [=] COLLATION_NAME
       | COMMENT [=] 'STRING'
       | CONNECTION [=] 'CONNECT_STRING'
       | {DATA|INDEX} DIRECTORY [=] 'ABSOLUTE PATH TO DIRECTORY'
       | DELAY_KEY_WRITE [=] {0 | 1}
       | ENGINE [=] ENGINE_NAME
       | INSERT_METHOD [=] { NO | FIRST | LAST }
       | KEY_BLOCK_SIZE [=] VALUE
       | MAX_ROWS [=] VALUE
       | MIN_ROWS [=] VALUE
       | PACK_KEYS [=] {0 | 1 | DEFAULT}
       | PASSWORD [=] 'STRING'
       | ROW_FORMAT [=] {DEFAULT|DYNAMIC|FIXED|COMPRESSED|REDUNDANT|COMPACT}
       | TABLESPACE TABLESPACE_NAME [STORAGE {DISK|MEMORY}]
       | UNION [=] (TBL_NAME[,TBL_NAME]...)

*note 'ALTER TABLE': alter-table. changes the structure of a table.  For
example, you can add or delete columns, create or destroy indexes,
change the type of existing columns, or rename columns or the table
itself.  You can also change characteristics such as the storage engine
used for the table or the table comment.

   * To use *note 'ALTER TABLE': alter-table, you need 'ALTER',
     'CREATE', and 'INSERT' privileges for the table.  Renaming a table
     requires 'ALTER' and 'DROP' on the old table, 'ALTER', 'CREATE',
     and 'INSERT' on the new table.

   * Following the table name, specify the alterations to be made.  If
     none are given, *note 'ALTER TABLE': alter-table. does nothing.

   * The syntax for many of the permissible alterations is similar to
     clauses of the *note 'CREATE TABLE': create-table. statement.
     COLUMN_DEFINITION clauses use the same syntax for 'ADD' and
     'CHANGE' as for *note 'CREATE TABLE': create-table.  For more
     information, see *note create-table::.

   * The word 'COLUMN' is optional and can be omitted.

   * Multiple 'ADD', 'ALTER', 'DROP', and 'CHANGE' clauses are permitted
     in a single *note 'ALTER TABLE': alter-table. statement, separated
     by commas.  This is a MySQL extension to standard SQL, which
     permits only one of each clause per *note 'ALTER TABLE':
     alter-table. statement.  For example, to drop multiple columns in a
     single statement, do this:

          ALTER TABLE t2 DROP COLUMN c, DROP COLUMN d;

   * If a storage engine does not support an attempted *note 'ALTER
     TABLE': alter-table. operation, a warning may result.  Such
     warnings can be displayed with *note 'SHOW WARNINGS':
     show-warnings.  See *note show-warnings::.  For information on
     troubleshooting *note 'ALTER TABLE': alter-table, see *note
     alter-table-problems::.

   * For usage examples, see *note alter-table-examples::.

   * With the *note 'mysql_info()': mysql-info. C API function, you can
     find out how many rows were copied by *note 'ALTER TABLE':
     alter-table, and (when 'IGNORE' is used) how many rows were deleted
     due to duplication of unique key values.  See *note mysql-info::.

There are several additional aspects to the 'ALTER TABLE' statement,
described under the following topics in this section:

   * *note alter-table-options::

   * *note alter-table-performance::

   * *note alter-table-add-drop-column::

   * *note alter-table-redefine-column::

   * *note alter-table-index::

   * *note alter-table-foreign-key::

   * *note alter-table-character-set::

   * *note alter-table-discard-import::

   * *note alter-table-row-order::

   * *note alter-table-partition-options::

*Table Options*

TABLE_OPTIONS signifies table options of the kind that can be used in
the *note 'CREATE TABLE': create-table. statement, such as 'ENGINE',
'AUTO_INCREMENT', 'AVG_ROW_LENGTH', 'MAX_ROWS', or 'ROW_FORMAT'.

For descriptions of all table options, see *note create-table::.
However, *note 'ALTER TABLE': alter-table. ignores 'DATA DIRECTORY' and
'INDEX DIRECTORY' when given as table options.  *note 'ALTER TABLE':
alter-table. permits them only as partitioning options, and, as of MySQL
5.5.54, requires that you have the 'FILE' privilege.

Use of table options with *note 'ALTER TABLE': alter-table. provides a
convenient way of altering single table characteristics.  For example:

   * If 't1' is currently not an 'InnoDB' table, this statement changes
     its storage engine to 'InnoDB':

          ALTER TABLE t1 ENGINE = InnoDB;

        * See *note converting-tables-to-innodb:: for considerations
          when switching tables to the 'InnoDB' storage engine.

        * When you specify an 'ENGINE' clause, *note 'ALTER TABLE':
          alter-table. rebuilds the table.  This is true even if the
          table already has the specified storage engine.

        * You can also use 'ALTER TABLE TBL_NAME FORCE' to perform a
          'null' alter operation that rebuilds the table.

        * The outcome of attempting to change the storage engine of a
          table is affected by whether the desired storage engine is
          available and the setting of the 'NO_ENGINE_SUBSTITUTION' SQL
          mode, as described in *note sql-mode::.

        * To prevent inadvertent loss of data, *note 'ALTER TABLE':
          alter-table. cannot be used to change the storage engine of a
          table to 'MERGE' or 'BLACKHOLE'.

   * To change the 'InnoDB' table to use compressed row-storage format:

          ALTER TABLE t1 ROW_FORMAT = COMPRESSED;

   * To reset the current auto-increment value:

          ALTER TABLE t1 AUTO_INCREMENT = 13;

     You cannot reset the counter to a value less than or equal to any
     that have already been used.  For 'MyISAM', if the value is less
     than or equal to the maximum value currently in the
     'AUTO_INCREMENT' column, the value is reset to the current maximum
     plus one.  For 'InnoDB', _if the value is less than the current
     maximum value in the column, no error occurs and the current
     sequence value is not changed._

   * To change the default table character set:

          ALTER TABLE t1 CHARACTER SET = utf8;

     See also *note alter-table-character-set::.

   * To add (or change) a table comment:

          ALTER TABLE t1 COMMENT = 'New table comment';

To verify that the table options were changed as intended, use *note
'SHOW CREATE TABLE': show-create-table, or query the *note
'INFORMATION_SCHEMA.TABLES': tables-table. table.

*Performance and Space Requirements*

*note 'ALTER TABLE': alter-table. operations are processed using either
the _table-copy_ method or _in-place_ method.  Operations that use the
table-copy method are performed on a temporary copy of the original
table, which can require more time, particularly for large tables.
Operations that use the in place method do not create temporary copy of
the table and tend to be faster.

*note 'ALTER TABLE': alter-table. operations that are performed on a
temporary copy of the original table wait for other operations that are
modifying the table to complete.  After alterations are applied to the
table copy, data is copied over, the original table is deleted, and the
table copy is renamed to the name of the original table.  While the
*note 'ALTER TABLE': alter-table. operation executes, the original table
is readable by other sessions (with the exception noted shortly).
Updates and writes to the table started after the *note 'ALTER TABLE':
alter-table. operation begins are stalled until the new table is ready,
then are automatically redirected to the new table.  The temporary copy
of the table is created in the database directory of the original table
unless it is a 'RENAME TO' operation that moves the table to a database
that resides in a different directory.

The exception referred to earlier is that *note 'ALTER TABLE':
alter-table. blocks reads (not just writes) at the point where it is
ready to install a new version of the table '.frm' file, discard the old
file, and clear outdated table structures from the table and table
definition caches.  At this point, it must acquire an exclusive lock.
To do so, it waits for current readers to finish, and blocks new reads
and writes.

To force use of the table-copy method for an 'ALTER TABLE' operation
that would otherwise not use it, enable the 'old_alter_table' system
variable.

For 'InnoDB' tables, a table-copying *note 'ALTER TABLE': alter-table.
operation on table that resides in a shared tablespace such as the
system tablespace can increase the amount of space used by the
tablespace.  Such operations require as much additional space as the
data in the table plus indexes.  For a table residing in a shared
tablespace, the additional space used during the operation is not
released back to the operating system as it is for a table that resides
in a file-per-table tablespace.

*note 'ALTER TABLE': alter-table. operations that use the in-place
method include:

   * 'ALTER TABLE TBL_NAME RENAME TO NEW_TBL_NAME' operations executed
     without any other options.  MySQL renames files that correspond to
     the table TBL_NAME without making a copy.  (You can also use the
     *note 'RENAME TABLE': rename-table. statement to rename tables.
     See *note rename-table::.)  Privileges granted specifically for the
     renamed table are not migrated to the new name.  They must be
     changed manually.

   * Operations that only modify table metadata.  These operations are
     immediate because the server only alters the table '.frm' file, not
     touch table contents.  Metadata-only operations include:

        * Renaming a column (except for *note 'InnoDB':
          innodb-storage-engine. tables).

        * Changing the default value of a column (except for *note
          'NDB': mysql-cluster. tables; see *note
          mysql-cluster-online-limitations::).

        * Changing the definition of an *note 'ENUM': enum. or *note
          'SET': set. column by adding new enumeration or set members to
          the _end_ of the list of valid member values, as long as the
          storage size of the data type does not change.  For example,
          adding a member to a *note 'SET': set. column that has 8
          members changes the required storage per value from 1 byte to
          2 bytes; this requires a table copy.  Adding members in the
          middle of the list causes renumbering of existing members,
          which requires a table copy.

   * Adding or dropping a secondary index, for *note 'InnoDB':
     innodb-storage-engine. and *note 'NDBCLUSTER': mysql-cluster.
     tables.  See *note innodb-create-index::.

   * For *note 'NDBCLUSTER': mysql-cluster. tables, operations that add
     and drop indexes on variable-width columns.  These operations occur
     online, without table copying and without blocking concurrent DML
     actions for most of their duration.  See *note
     mysql-cluster-online-operations::.

For 'MyISAM' tables, you can speed up index re-creation (the slowest
part of the alteration process) by setting the 'myisam_sort_buffer_size'
system variable to a high value.

'ALTER TABLE' with 'ADD PARTITION', 'DROP PARTITION', 'COALESCE
PARTITION', 'REBUILD PARTITION', or 'REORGANIZE PARTITION' does not
create temporary tables (except when used with *note 'NDB':
mysql-cluster. tables); however, these operations can and do create
temporary partition files.

'ADD' or 'DROP' operations for 'RANGE' or 'LIST' partitions are
immediate operations or nearly so.  'ADD' or 'COALESCE' operations for
'HASH' or 'KEY' partitions copy data between all partitions, unless
'LINEAR HASH' or 'LINEAR KEY' was used; this is effectively the same as
creating a new table, although the 'ADD' or 'COALESCE' operation is
performed partition by partition.  'REORGANIZE' operations copy only
changed partitions and do not touch unchanged ones.

*Note*:

Pending *note 'INSERT DELAYED': insert-delayed. statements are lost if a
table is write locked and *note 'ALTER TABLE': alter-table. is used to
modify the table structure.

*Adding and Dropping Columns*

Use 'ADD' to add new columns to a table, and 'DROP' to remove existing
columns.  'DROP COL_NAME' is a MySQL extension to standard SQL.

To add a column at a specific position within a table row, use 'FIRST'
or 'AFTER COL_NAME'.  The default is to add the column last.

If a table contains only one column, the column cannot be dropped.  If
what you intend is to remove the table, use the *note 'DROP TABLE':
drop-table. statement instead.

If columns are dropped from a table, the columns are also removed from
any index of which they are a part.  If all columns that make up an
index are dropped, the index is dropped as well.

*Renaming, Redefining, and Reordering Columns*

The 'CHANGE', 'MODIFY', and 'ALTER' clauses enable the names and
definitions of existing columns to be altered.  They have these
comparative characteristics:

   * 'CHANGE':

        * Can rename a column and change its definition, or both.

        * Has more capability than 'MODIFY', but at the expense of
          convenience for some operations.  'CHANGE' requires naming the
          column twice if not renaming it.

        * With 'FIRST' or 'AFTER', can reorder columns.

   * 'MODIFY':

        * Can change a column definition but not its name.

        * More convenient than 'CHANGE' to change a column definition
          without renaming it.

        * With 'FIRST' or 'AFTER', can reorder columns.

   * 'ALTER': Used only to change a column default value.

'CHANGE' is a MySQL extension to standard SQL. 'MODIFY' is a MySQL
extension for Oracle compatibility.

To alter a column to change both its name and definition, use 'CHANGE',
specifying the old and new names and the new definition.  For example,
to rename an 'INT NOT NULL' column from 'a' to 'b' and change its
definition to use the 'BIGINT' data type while retaining the 'NOT NULL'
attribute, do this:

     ALTER TABLE t1 CHANGE a b BIGINT NOT NULL;

To change a column definition but not its name, use 'CHANGE' or
'MODIFY'.  With 'CHANGE', the syntax requires two column names, so you
must specify the same name twice to leave the name unchanged.  For
example, to change the definition of column 'b', do this:

     ALTER TABLE t1 CHANGE b b INT NOT NULL;

'MODIFY' is more convenient to change the definition without changing
the name because it requires the column name only once:

     ALTER TABLE t1 MODIFY b INT NOT NULL;

To change a column name but not its definition, use 'CHANGE'.  The
syntax requires a column definition, so to leave the definition
unchanged, you must respecify the definition the column currently has.
For example, to rename an 'INT NOT NULL' column from 'b' to 'a', do
this:

     ALTER TABLE t1 CHANGE b a INT NOT NULL;

For column definition changes using 'CHANGE' or 'MODIFY', the definition
must include the data type and all attributes that should apply to the
new column, other than index attributes such as 'PRIMARY KEY' or
'UNIQUE'.  Attributes present in the original definition but not
specified for the new definition are not carried forward.  Suppose that
a column 'col1' is defined as 'INT UNSIGNED DEFAULT 1 COMMENT 'my
column'' and you modify the column as follows, intending to change only
'INT' to 'BIGINT':

     ALTER TABLE t1 MODIFY col1 BIGINT;

That statement changes the data type from 'INT' to 'BIGINT', but it also
drops the 'UNSIGNED', 'DEFAULT', and 'COMMENT' attributes.  To retain
them, the statement must include them explicitly:

     ALTER TABLE t1 MODIFY col1 BIGINT UNSIGNED DEFAULT 1 COMMENT 'my column';

For data type changes using 'CHANGE' or 'MODIFY', MySQL tries to convert
existing column values to the new type as well as possible.

*Warning*:

This conversion may result in alteration of data.  For example, if you
shorten a string column, values may be truncated.  To prevent the
operation from succeeding if conversions to the new data type would
result in loss of data, enable strict SQL mode before using *note 'ALTER
TABLE': alter-table. (see *note sql-mode::).

If you use 'CHANGE' or 'MODIFY' to shorten a column for which an index
exists on the column, and the resulting column length is less than the
index length, MySQL shortens the index automatically.

For columns renamed by 'CHANGE', MySQL automatically renames these
references to the renamed column:

   * Indexes that refer to the old column, including indexes and
     disabled 'MyISAM' indexes.

For columns renamed by 'CHANGE', MySQL does not automatically rename
these references to the renamed column:

   * Foreign keys that refer to the old column.

   * Partition expressions that refer to the renamed column.  You must
     use 'CHANGE' to redefine such expressions in the same *note 'ALTER
     TABLE': alter-table. statement as the one that renames the column.

   * Views and stored programs that refer to the renamed column.  You
     must manually alter the definition of these objects to refer to the
     new column name.

To reorder columns within a table, use 'FIRST' and 'AFTER' in 'CHANGE'
or 'MODIFY' operations.

'ALTER ... SET DEFAULT' or 'ALTER ... DROP DEFAULT' specify a new
default value for a column or remove the old default value,
respectively.  If the old default is removed and the column can be
'NULL', the new default is 'NULL'.  If the column cannot be 'NULL',
MySQL assigns a default value as described in *note
data-type-defaults::.

*Primary Keys and Indexes*

'DROP PRIMARY KEY' drops the primary key.  If there is no primary key,
an error occurs.  For information about the performance characteristics
of primary keys, especially for 'InnoDB' tables, see *note
primary-key-optimization::.

If you add a 'UNIQUE INDEX' or 'PRIMARY KEY' to a table, MySQL stores it
before any nonunique index to permit detection of duplicate keys as
early as possible.

'IGNORE' is a MySQL extension to standard SQL. It controls how *note
'ALTER TABLE': alter-table. works if there are duplicates on unique keys
in the new table or if warnings occur when strict mode is enabled.  If
'IGNORE' is not specified, the copy is aborted and rolled back if
duplicate-key errors occur.  If 'IGNORE' is specified, only one row is
used of rows with duplicates on a unique key.  The other conflicting
rows are deleted.  Incorrect values are truncated to the closest
matching acceptable value.

*Note*:

Due to a bug related to Fast Index Creation (Bug #40344), 'ALTER IGNORE
TABLE ... ADD UNIQUE INDEX' does not delete duplicate rows.  The
'IGNORE' keyword is ignored.  If any duplicate rows exist, the operation
fails with a 'Duplicate entry' error.  A workaround is to set
'old_alter_table=1' prior to running an 'ALTER IGNORE TABLE ... ADD
UNIQUE INDEX' statement.

     SET SESSION old_alter_table=1

*note 'DROP INDEX': drop-index. removes an index.  This is a MySQL
extension to standard SQL. See *note drop-index::.  To determine index
names, use 'SHOW INDEX FROM TBL_NAME'.

Some storage engines permit you to specify an index type when creating
an index.  The syntax for the INDEX_TYPE specifier is 'USING TYPE_NAME'.
For details about 'USING', see *note create-index::.  The preferred
position is after the column list.  Support for use of the option before
the column list will be removed in a future MySQL release.

INDEX_OPTION values specify additional options for an index.  For
details about permissible INDEX_OPTION values, see *note create-index::.

If you use *note 'ALTER TABLE': alter-table. on a 'MyISAM' table, all
nonunique indexes are created in a separate batch (as for *note 'REPAIR
TABLE': repair-table.).  This should make *note 'ALTER TABLE':
alter-table. much faster when you have many indexes.

For 'MyISAM' tables, key updating can be controlled explicitly.  Use
'ALTER TABLE ... DISABLE KEYS' to tell MySQL to stop updating nonunique
indexes.  Then use 'ALTER TABLE ... ENABLE KEYS' to re-create missing
indexes.  'MyISAM' does this with a special algorithm that is much
faster than inserting keys one by one, so disabling keys before
performing bulk insert operations should give a considerable speedup.
Using 'ALTER TABLE ... DISABLE KEYS' requires the 'INDEX' privilege in
addition to the privileges mentioned earlier.

While the nonunique indexes are disabled, they are ignored for
statements such as *note 'SELECT': select. and *note 'EXPLAIN': explain.
that otherwise would use them.

After an *note 'ALTER TABLE': alter-table. statement, it may be
necessary to run *note 'ANALYZE TABLE': analyze-table. to update index
cardinality information.  See *note show-index::.

*Foreign Keys and Other Constraints*

If *note 'ALTER TABLE': alter-table. for an 'InnoDB' table results in
changes to column values (for example, because a column is truncated),
'InnoDB''s 'FOREIGN KEY' constraint checks do not notice possible
violations caused by changing the values.

The 'FOREIGN KEY' and 'REFERENCES' clauses are supported by the 'InnoDB'
storage engine, which implements 'ADD [CONSTRAINT [SYMBOL]] FOREIGN KEY
[INDEX_NAME] (...) REFERENCES ... (...)'.  See *note
create-table-foreign-keys::.  For other storage engines, the clauses are
parsed but ignored.

The 'CHECK' constraint clause is parsed but ignored by all storage
engines.  See *note create-table::.  The reason for accepting but
ignoring syntax clauses is for compatibility, to make it easier to port
code from other SQL servers, and to run applications that create tables
with references.  See *note differences-from-ansi::.

For *note 'ALTER TABLE': alter-table, unlike *note 'CREATE TABLE':
create-table, 'ADD FOREIGN KEY' ignores INDEX_NAME if given and uses an
automatically generated foreign key name.  As a workaround, include the
'CONSTRAINT' clause to specify the foreign key name:

     ADD CONSTRAINT NAME FOREIGN KEY (....) ...

*Important*:

MySQL silently ignores inline 'REFERENCES' specifications, where the
references are defined as part of the column specification.  MySQL
accepts only 'REFERENCES' clauses defined as part of a separate 'FOREIGN
KEY' specification.

*Note*:

Partitioned 'InnoDB' tables do not support foreign keys.  For more
information, see *note partitioning-limitations-storage-engines::.

'InnoDB' supports the use of *note 'ALTER TABLE': alter-table. to drop
foreign keys:

     ALTER TABLE TBL_NAME DROP FOREIGN KEY FK_SYMBOL;

Adding and dropping a foreign key in separate clauses of a single *note
'ALTER TABLE': alter-table. statement may be problematic in some cases
and is therefore unsupported.  Use separate statements for each
operation.

'ALTER TABLE TBL_NAME RENAME NEW_TBL_NAME' changes internally generated
foreign key constraint names and user-defined foreign key constraint
names that begin with the string 'TBL_NAME_ibfk_' to reflect the new
table name.  'InnoDB' interprets foreign key constraint names that begin
with the string 'TBL_NAME_ibfk_' as internally generated names.

*Changing the Character Set*

To change the table default character set and all character columns
(*note 'CHAR': char, *note 'VARCHAR': char, *note 'TEXT': blob.) to a
new character set, use a statement like this:

     ALTER TABLE TBL_NAME
     CONVERT TO CHARACTER SET CHARSET_NAME [COLLATE COLLATION_NAME];

The statement also changes the collation of all character columns.  If
you specify no 'COLLATE' clause to indicate which collation to use, the
statement uses default collation for the character set.  If this
collation is inappropriate for the intended table use (for example, if
it would change from a case-sensitive collation to a case-insensitive
collation), specify a collation explicitly.

For a column that has a data type of *note 'VARCHAR': char. or one of
the *note 'TEXT': blob. types, 'CONVERT TO CHARACTER SET' changes the
data type as necessary to ensure that the new column is long enough to
store as many characters as the original column.  For example, a *note
'TEXT': blob. column has two length bytes, which store the byte-length
of values in the column, up to a maximum of 65,535.  For a 'latin1'
*note 'TEXT': blob. column, each character requires a single byte, so
the column can store up to 65,535 characters.  If the column is
converted to 'utf8', each character might require up to three bytes, for
a maximum possible length of 3 x 65,535 = 196,605 bytes.  That length
does not fit in a *note 'TEXT': blob. column's length bytes, so MySQL
converts the data type to *note 'MEDIUMTEXT': blob, which is the
smallest string type for which the length bytes can record a value of
196,605.  Similarly, a *note 'VARCHAR': char. column might be converted
to *note 'MEDIUMTEXT': blob.

To avoid data type changes of the type just described, do not use
'CONVERT TO CHARACTER SET'.  Instead, use 'MODIFY' to change individual
columns.  For example:

     ALTER TABLE t MODIFY latin1_text_col TEXT CHARACTER SET utf8;
     ALTER TABLE t MODIFY latin1_varchar_col VARCHAR(M) CHARACTER SET utf8;

If you specify 'CONVERT TO CHARACTER SET binary', the *note 'CHAR':
char, *note 'VARCHAR': char, and *note 'TEXT': blob. columns are
converted to their corresponding binary string types (*note 'BINARY':
binary-varbinary, *note 'VARBINARY': binary-varbinary, *note 'BLOB':
blob.).  This means that the columns no longer will have a character set
and a subsequent 'CONVERT TO' operation will not apply to them.

If CHARSET_NAME is 'DEFAULT' in a 'CONVERT TO CHARACTER SET' operation,
the character set named by the 'character_set_database' system variable
is used.

*Warning*:

The 'CONVERT TO' operation converts column values between the original
and named character sets.  This is _not_ what you want if you have a
column in one character set (like 'latin1') but the stored values
actually use some other, incompatible character set (like 'utf8').  In
this case, you have to do the following for each such column:

     ALTER TABLE t1 CHANGE c1 c1 BLOB;
     ALTER TABLE t1 CHANGE c1 c1 TEXT CHARACTER SET utf8;

The reason this works is that there is no conversion when you convert to
or from *note 'BLOB': blob. columns.

To change only the _default_ character set for a table, use this
statement:

     ALTER TABLE TBL_NAME DEFAULT CHARACTER SET CHARSET_NAME;

The word 'DEFAULT' is optional.  The default character set is the
character set that is used if you do not specify the character set for
columns that you add to a table later (for example, with 'ALTER TABLE
... ADD column').

When the 'foreign_key_checks' system variable is enabled, which is the
default setting, character set conversion is not permitted on tables
that include a character string column used in a foreign key constraint.
The workaround is to disable 'foreign_key_checks' before performing the
character set conversion.  You must perform the conversion on both
tables involved in the foreign key constraint before re-enabling
'foreign_key_checks'.  If you re-enable 'foreign_key_checks' after
converting only one of the tables, an 'ON DELETE CASCADE' or 'ON UPDATE
CASCADE' operation could corrupt data in the referencing table due to
implicit conversion that occurs during these operations (Bug #45290, Bug
#74816).

*Discarding and Importing InnoDB Tablespaces*

For an 'InnoDB' table that is created with its own tablespace in an
'.ibd' file, that file can be discarded and imported.  To discard the
'.ibd' file, use this statement:

     ALTER TABLE TBL_NAME DISCARD TABLESPACE;

This deletes the current '.ibd' file, so be sure that you have a backup
first.  Attempting to access the table while the tablespace file is
discarded results in an error.

To import the backup '.ibd' file back into the table, copy it into the
database directory, and then issue this statement:

     ALTER TABLE TBL_NAME IMPORT TABLESPACE;

The tablespace file must have been created on the server into which it
is imported later.

*Note*:

The *note 'ALTER TABLE ... IMPORT TABLESPACE': alter-table. feature does
not enforce foreign key constraints on imported data.

See *note innodb-file-per-table-tablespaces::.

*Row Order for MyISAM Tables*

'ORDER BY' enables you to create the new table with the rows in a
specific order.  This option is useful primarily when you know that you
query the rows in a certain order most of the time.  By using this
option after major changes to the table, you might be able to get higher
performance.  In some cases, it might make sorting easier for MySQL if
the table is in order by the column that you want to order it by later.

*Note*:

The table does not remain in the specified order after inserts and
deletes.

'ORDER BY' syntax permits one or more column names to be specified for
sorting, each of which optionally can be followed by 'ASC' or 'DESC' to
indicate ascending or descending sort order, respectively.  The default
is ascending order.  Only column names are permitted as sort criteria;
arbitrary expressions are not permitted.  This clause should be given
last after any other clauses.

'ORDER BY' does not make sense for 'InnoDB' tables because 'InnoDB'
always orders table rows according to the clustered index.

When used on a partitioned table, 'ALTER TABLE ... ORDER BY' orders rows
within each partition only.

*Partitioning Options*

PARTITION_OPTIONS signifies options that can be used with partitioned
tables for repartitioning, to add, drop, discard, merge, and split
partitions, and to perform partitioning maintenance.

It is possible for an *note 'ALTER TABLE': alter-table. statement to
contain a 'PARTITION BY' or 'REMOVE PARTITIONING' clause in an addition
to other alter specifications, but the 'PARTITION BY' or 'REMOVE
PARTITIONING' clause must be specified last after any other
specifications.  The 'ADD PARTITION', 'DROP PARTITION', 'COALESCE
PARTITION', 'REORGANIZE PARTITION', 'ANALYZE PARTITION', 'CHECK
PARTITION', and 'REPAIR PARTITION' options cannot be combined with other
alter specifications in a single 'ALTER TABLE', since the options just
listed act on individual partitions.

For a list of partition options and a description of each, see *note
create-table::.  For additional information, see *note
alter-table-partition-operations::.


File: manual.info.tmp,  Node: alter-table-partition-operations,  Next: alter-table-examples,  Prev: alter-table,  Up: alter-table

13.1.7.1 ALTER TABLE Partition Operations
.........................................

Partitioning-related clauses for *note 'ALTER TABLE': alter-table. can
be used with partitioned tables for repartitioning, to add, drop,
discard, merge, and split partitions, and to perform partitioning
maintenance.

   * Simply using a PARTITION_OPTIONS clause with *note 'ALTER TABLE':
     alter-table. on a partitioned table repartitions the table
     according to the partitioning scheme defined by the
     PARTITION_OPTIONS.  This clause always begins with 'PARTITION BY',
     and follows the same syntax and other rules as apply to the
     PARTITION_OPTIONS clause for *note 'CREATE TABLE': create-table.
     (for more detailed information, see *note create-table::), and can
     also be used to partition an existing table that is not already
     partitioned.  For example, consider a (nonpartitioned) table
     defined as shown here:

          CREATE TABLE t1 (
              id INT,
              year_col INT
          );

     This table can be partitioned by 'HASH', using the 'id' column as
     the partitioning key, into 8 partitions by means of this statement:

          ALTER TABLE t1
              PARTITION BY HASH(id)
              PARTITIONS 8;

     MySQL 5.5.31 and later supports an 'ALGORITHM' option with
     '[SUB]PARTITION BY [LINEAR] KEY'.  'ALGORITHM=1' causes the server
     to use the same key-hashing functions as MySQL 5.1 when computing
     the placement of rows in partitions; 'ALGORITHM=2' means that the
     server employs the key-hashing functions implemented and used by
     default for new 'KEY' partitioned tables in MySQL 5.5 and later.
     (Partitioned tables created with the key-hashing functions employed
     in MySQL 5.5 and later cannot be used by a MySQL 5.1 server.)  Not
     specifying the option has the same effect as using 'ALGORITHM=2'.
     This option is intended for use chiefly when upgrading or
     downgrading '[LINEAR] KEY' partitioned tables between MySQL 5.1 and
     later MySQL versions, or for creating tables partitioned by 'KEY'
     or 'LINEAR KEY' on a MySQL 5.5 or later server which can be used on
     a MySQL 5.1 server.

     To upgrade a 'KEY' partitioned table that was created in MySQL 5.1,
     first execute *note 'SHOW CREATE TABLE': show-create-table. and
     note the exact columns and number of partitions shown.  Now execute
     an 'ALTER TABLE' statement using exactly the same column list and
     number of partitions as in the 'CREATE TABLE' statement, while
     adding 'ALGORITHM=2' immediately following the 'PARTITION BY'
     keywords.  (You should also include the 'LINEAR' keyword if it was
     used for the original table definition.)  An example from a session
     in the *note 'mysql': mysql. client is shown here:

          mysql> SHOW CREATE TABLE p\G
          *************************** 1. row ***************************
                 Table: p
          Create Table: CREATE TABLE `p` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `cd` datetime NOT NULL,
            PRIMARY KEY (`id`)
          ) ENGINE=InnoDB DEFAULT CHARSET=latin1
          /*!50100 _PARTITION BY LINEAR KEY (id)
          PARTITIONS 32_ */
          1 row in set (0.00 sec)

          mysql> ALTER TABLE p _PARTITION BY LINEAR KEY ALGORITHM=2 (id) PARTITIONS 32_;
          Query OK, 0 rows affected (5.34 sec)
          Records: 0  Duplicates: 0  Warnings: 0

          mysql> SHOW CREATE TABLE p\G
          *************************** 1. row ***************************
                 Table: p
          Create Table: CREATE TABLE `p` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `cd` datetime NOT NULL,
            PRIMARY KEY (`id`)
          ) ENGINE=InnoDB DEFAULT CHARSET=latin1
          /*!50100 PARTITION BY LINEAR KEY (id)
          PARTITIONS 32 */
          1 row in set (0.00 sec)

     Downgrading a table created using the default key-hashing used in
     MySQL 5.5 and later to enable its use by a MySQL 5.1 server is
     similar, except in this case you should use 'ALGORITHM=1' to force
     the table's partitions to be rebuilt using the MySQL 5.1
     key-hashing functions.  It is recommended that you not do this
     except when necessary for compatibility with a MySQL 5.1 server, as
     the improved 'KEY' hashing functions used by default in MySQL 5.5
     and later provide fixes for a number of issues found in the older
     implementation.

     *Note*:

     A table upgraded by means of 'ALTER TABLE ... PARTITION BY
     ALGORITHM=2 [LINEAR] KEY ...' can no longer be used by a MySQL 5.1
     server.  (Such a table would need to be downgraded with 'ALTER
     TABLE ... PARTITION BY ALGORITHM=1 [LINEAR] KEY ...' before it
     could be used again by a MySQL 5.1 server.)

     The table that results from using an 'ALTER TABLE ... PARTITION BY'
     statement must follow the same rules as one created using 'CREATE
     TABLE ... PARTITION BY'.  This includes the rules governing the
     relationship between any unique keys (including any primary key)
     that the table might have, and the column or columns used in the
     partitioning expression, as discussed in *note
     partitioning-limitations-partitioning-keys-unique-keys::.  The
     'CREATE TABLE ... PARTITION BY' rules for specifying the number of
     partitions also apply to 'ALTER TABLE ... PARTITION BY'.

     The PARTITION_DEFINITION clause for 'ALTER TABLE ADD PARTITION'
     supports the same options as the clause of the same name for the
     *note 'CREATE TABLE': create-table. statement.  (See *note
     create-table::, for the syntax and description.)  Suppose that you
     have the partitioned table created as shown here:

          CREATE TABLE t1 (
              id INT,
              year_col INT
          )
          PARTITION BY RANGE (year_col) (
              PARTITION p0 VALUES LESS THAN (1991),
              PARTITION p1 VALUES LESS THAN (1995),
              PARTITION p2 VALUES LESS THAN (1999)
          );

     You can add a new partition 'p3' to this table for storing values
     less than '2002' as follows:

          ALTER TABLE t1 ADD PARTITION (PARTITION p3 VALUES LESS THAN (2002));

     'DROP PARTITION' can be used to drop one or more 'RANGE' or 'LIST'
     partitions.  This statement cannot be used with 'HASH' or 'KEY'
     partitions; instead, use 'COALESCE PARTITION' (see below).  Any
     data that was stored in the dropped partitions named in the
     PARTITION_NAMES list is discarded.  For example, given the table
     't1' defined previously, you can drop the partitions named 'p0' and
     'p1' as shown here:

          ALTER TABLE t1 DROP PARTITION p0, p1;

     *Note*:

     'DROP PARTITION' does not work with tables that use the *note
     'NDBCLUSTER': mysql-cluster. storage engine.  See *note
     partitioning-management-range-list::, and *note
     mysql-cluster-limitations::.

     'ADD PARTITION' and 'DROP PARTITION' do not currently support 'IF
     [NOT] EXISTS'.

     Renames of partitioned tables are supported.  You can rename
     individual partitions indirectly using 'ALTER TABLE ... REORGANIZE
     PARTITION'; however, this operation copies the partition's data.

     To delete rows from selected partitions, use the 'TRUNCATE
     PARTITION' option.  This option takes a list of one or more
     comma-separated partition names.  For example, consider the table
     't1' as defined here:

          CREATE TABLE t1 (
              id INT,
              year_col INT
          )
          PARTITION BY RANGE (year_col) (
              PARTITION p0 VALUES LESS THAN (1991),
              PARTITION p1 VALUES LESS THAN (1995),
              PARTITION p2 VALUES LESS THAN (1999),
              PARTITION p3 VALUES LESS THAN (2003),
              PARTITION p4 VALUES LESS THAN (2007)
          );

     To delete all rows from partition 'p0', use the following
     statement:

          ALTER TABLE t1 TRUNCATE PARTITION p0;

     The statement just shown has the same effect as the following *note
     'DELETE': delete. statement:

          DELETE FROM t1 WHERE year_col < 1991;

     When truncating multiple partitions, the partitions do not have to
     be contiguous: This can greatly simplify delete operations on
     partitioned tables that would otherwise require very complex
     'WHERE' conditions if done with *note 'DELETE': delete. statements.
     For example, this statement deletes all rows from partitions 'p1'
     and 'p3':

          ALTER TABLE t1 TRUNCATE PARTITION p1, p3;

     An equivalent *note 'DELETE': delete. statement is shown here:

          DELETE FROM t1 WHERE
              (year_col >= 1991 AND year_col < 1995)
              OR
              (year_col >= 2003 AND year_col < 2007);

     If you use the 'ALL' keyword in place of the list of partition
     names, the statement acts on all table partitions.

     'TRUNCATE PARTITION' merely deletes rows; it does not alter the
     definition of the table itself, or of any of its partitions.

     *Note*:

     'TRUNCATE PARTITION' does not work with subpartitions.

     To verify that the rows were dropped, check the
     'INFORMATION_SCHEMA.PARTITIONS' table, using a query such as this
     one:

          SELECT PARTITION_NAME, TABLE_ROWS
              FROM INFORMATION_SCHEMA.PARTITIONS
              WHERE TABLE_NAME = 't1';

     'TRUNCATE PARTITION' is supported only for partitioned tables that
     use the *note 'MyISAM': myisam-storage-engine, *note 'InnoDB':
     innodb-storage-engine, or *note 'MEMORY': memory-storage-engine.
     storage engine.  It also works on *note 'BLACKHOLE':
     blackhole-storage-engine. tables (but has no effect).  It is not
     supported for *note 'ARCHIVE': archive-storage-engine. tables.

     'COALESCE PARTITION' can be used with a table that is partitioned
     by 'HASH' or 'KEY' to reduce the number of partitions by NUMBER.
     Suppose that you have created table 't2' as follows:

          CREATE TABLE t2 (
              name VARCHAR (30),
              started DATE
          )
          PARTITION BY HASH( YEAR(started) )
          PARTITIONS 6;

     To reduce the number of partitions used by 't2' from 6 to 4, use
     the following statement:

          ALTER TABLE t2 COALESCE PARTITION 2;

     The data contained in the last NUMBER partitions will be merged
     into the remaining partitions.  In this case, partitions 4 and 5
     will be merged into the first 4 partitions (the partitions numbered
     0, 1, 2, and 3).

     To change some but not all the partitions used by a partitioned
     table, you can use 'REORGANIZE PARTITION'.  This statement can be
     used in several ways:

        * To merge a set of partitions into a single partition.  This is
          done by naming several partitions in the PARTITION_NAMES list
          and supplying a single definition for PARTITION_DEFINITION.

        * To split an existing partition into several partitions.
          Accomplish this by naming a single partition for
          PARTITION_NAMES and providing multiple PARTITION_DEFINITIONS.

        * To change the ranges for a subset of partitions defined using
          'VALUES LESS THAN' or the value lists for a subset of
          partitions defined using 'VALUES IN'.

        * This statement may also be used without the 'PARTITION_NAMES
          INTO (PARTITION_DEFINITIONS)' option on tables that are
          automatically partitioned using 'HASH' partitioning to force
          redistribution of data.  (Currently, only *note 'NDB':
          mysql-cluster. tables are automatically partitioned in this
          way.)  This is useful in NDB Cluster where, after you have
          added new NDB Cluster data nodes online to an existing NDB
          Cluster, you wish to redistribute existing NDB Cluster table
          data to the new data nodes.  In such cases, you should invoke
          the statement with the 'ONLINE' option; in other words, as
          shown here:

               ALTER ONLINE TABLE TABLE REORGANIZE PARTITION;

          You cannot perform other DDL concurrently with online table
          reorganization--that is, no other DDL statements can be issued
          while an 'ALTER ONLINE TABLE ... REORGANIZE PARTITION'
          statement is executing.  For more information about adding NDB
          Cluster data nodes online, see *note
          mysql-cluster-online-add-node::.

          'ALTER ONLINE TABLE ... REORGANIZE PARTITION' does not work
          with tables which were created using the 'MAX_ROWS' option,
          because it uses the constant 'MAX_ROWS' value specified in the
          original *note 'CREATE TABLE': create-table. statement to
          determine the number of partitions required, so no new
          partitions are created.  Beginning with MySQL NDB Cluster
          7.2.6, you can use 'ALTER ONLINE TABLE ... MAX_ROWS=ROWS' to
          increase the maximum number of rows for such a table; in this
          case, 'ALTER ONLINE TABLE ... REORGANIZE PARTITION' is not
          needed (and causes an error if executed).  The value of ROWS
          must be greater than the value specified for 'MAX_ROWS' in the
          original 'CREATE TABLE' statement for this to work.

          Attempting to use 'REORGANIZE PARTITION' without the
          'PARTITION_NAMES INTO (PARTITION_DEFINITIONS)' option on
          explicitly partitioned tables results in the error 'REORGANIZE
          PARTITION without parameters can only be used on
          auto-partitioned tables using HASH partitioning'.

     *Note*:

     For partitions that have not been explicitly named, MySQL
     automatically provides the default names 'p0', 'p1', 'p2', and so
     on.  The same is true with regard to subpartitions.

     For more detailed information about and examples of 'ALTER TABLE
     ... REORGANIZE PARTITION' statements, see *note
     partitioning-management-range-list::.

   * Several options provide partition maintenance and repair
     functionality analogous to that implemented for nonpartitioned
     tables by statements such as *note 'CHECK TABLE': check-table. and
     *note 'REPAIR TABLE': repair-table. (which are also supported for
     partitioned tables; for more information, see *note
     table-maintenance-statements::).  These include 'ANALYZE
     PARTITION', 'CHECK PARTITION', 'OPTIMIZE PARTITION', 'REBUILD
     PARTITION', and 'REPAIR PARTITION'.  Each of these options takes a
     PARTITION_NAMES clause consisting of one or more names of
     partitions, separated by commas.  The partitions must already exist
     in the table to be altered.  You can also use the 'ALL' keyword in
     place of PARTITION_NAMES, in which case the statement acts on all
     table partitions.  For more information and examples, see *note
     partitioning-maintenance::.

     Prior to MySQL 5.5.30, it was not safe to execute multiple
     concurrent 'REBUILD TABLE' operations on partitioned tables,
     whether on the same or different tables.  (Bug #14589559, Bug
     #66645)

     Some MySQL storage engines, such as *note 'InnoDB':
     innodb-storage-engine, do not support per-partition optimization.
     For a partitioned table using such a storage engine, 'ALTER TABLE
     ... OPTIMIZE PARTITION' rebuilds the entire table.  This is a known
     issue.  Beginning with MySQL 5.5.30, running this statement on such
     a table causes the entire table to rebuilt and analyzed, and an
     appropriate warning to be issued.  (Bug #11751825, Bug #42822)

     To work around this problem, use the statements 'ALTER TABLE ...
     REBUILD PARTITION' and 'ALTER TABLE ... ANALYZE PARTITION' instead.

     The 'ANALYZE PARTITION', 'CHECK PARTITION', 'OPTIMIZE PARTITION',
     and 'REPAIR PARTITION' options are not permitted for tables which
     are not partitioned.

   * 'REMOVE PARTITIONING' enables you to remove a table's partitioning
     without otherwise affecting the table or its data.  This option can
     be combined with other *note 'ALTER TABLE': alter-table. options
     such as those used to add, drop, or rename columns or indexes.

   * Using the 'ENGINE' option with *note 'ALTER TABLE': alter-table.
     changes the storage engine used by the table without affecting the
     partitioning.

It is possible for an *note 'ALTER TABLE': alter-table. statement to
contain a 'PARTITION BY' or 'REMOVE PARTITIONING' clause in an addition
to other alter specifications, but the 'PARTITION BY' or 'REMOVE
PARTITIONING' clause must be specified last after any other
specifications.

The 'ADD PARTITION', 'DROP PARTITION', 'COALESCE PARTITION', 'REORGANIZE
PARTITION', 'ANALYZE PARTITION', 'CHECK PARTITION', and 'REPAIR
PARTITION' options cannot be combined with other alter specifications in
a single 'ALTER TABLE', since the options just listed act on individual
partitions.  For more information, see *note
alter-table-partition-operations::.

Only a single instance of any one of the following options can be used
in a given *note 'ALTER TABLE': alter-table. statement: 'PARTITION BY',
'ADD PARTITION', 'DROP PARTITION', 'TRUNCATE PARTITION', 'REORGANIZE
PARTITION', or 'COALESCE PARTITION', 'ANALYZE PARTITION', 'CHECK
PARTITION', 'OPTIMIZE PARTITION', 'REBUILD PARTITION', 'REMOVE
PARTITIONING'.

For example, the following two statements are invalid:

     ALTER TABLE t1 ANALYZE PARTITION p1, ANALYZE PARTITION p2;

     ALTER TABLE t1 ANALYZE PARTITION p1, CHECK PARTITION p2;

In the first case, you can analyze partitions 'p1' and 'p2' of table
't1' concurrently using a single statement with a single 'ANALYZE
PARTITION' option that lists both of the partitions to be analyzed, like
this:

     ALTER TABLE t1 ANALYZE PARTITION p1, p2;

In the second case, it is not possible to perform 'ANALYZE' and 'CHECK'
operations on different partitions of the same table concurrently.
Instead, you must issue two separate statements, like this:

     ALTER TABLE t1 ANALYZE PARTITION p1;
     ALTER TABLE t1 CHECK PARTITION p2;

'ANALYZE', 'CHECK', 'OPTIMIZE', 'REBUILD', 'REPAIR', and 'TRUNCATE'
operations are not supported for subpartitions.


File: manual.info.tmp,  Node: alter-table-examples,  Prev: alter-table-partition-operations,  Up: alter-table

13.1.7.2 ALTER TABLE Examples
.............................

Begin with a table 't1' created as shown here:

     CREATE TABLE t1 (a INTEGER, b CHAR(10));

To rename the table from 't1' to 't2':

     ALTER TABLE t1 RENAME t2;

To change column 'a' from *note 'INTEGER': integer-types. to 'TINYINT
NOT NULL' (leaving the name the same), and to change column 'b' from
'CHAR(10)' to 'CHAR(20)' as well as renaming it from 'b' to 'c':

     ALTER TABLE t2 MODIFY a TINYINT NOT NULL, CHANGE b c CHAR(20);

To add a new *note 'TIMESTAMP': datetime. column named 'd':

     ALTER TABLE t2 ADD d TIMESTAMP;

To add an index on column 'd' and a 'UNIQUE' index on column 'a':

     ALTER TABLE t2 ADD INDEX (d), ADD UNIQUE (a);

To remove column 'c':

     ALTER TABLE t2 DROP COLUMN c;

To add a new 'AUTO_INCREMENT' integer column named 'c':

     ALTER TABLE t2 ADD c INT UNSIGNED NOT NULL AUTO_INCREMENT,
       ADD PRIMARY KEY (c);

We indexed 'c' (as a 'PRIMARY KEY') because 'AUTO_INCREMENT' columns
must be indexed, and we declare 'c' as 'NOT NULL' because primary key
columns cannot be 'NULL'.

For *note 'NDB': mysql-cluster. tables, it is also possible to change
the storage type used for a table or column.  For example, consider an
*note 'NDB': mysql-cluster. table created as shown here:

     mysql> CREATE TABLE t1 (c1 INT) TABLESPACE ts_1 ENGINE NDB;
     Query OK, 0 rows affected (1.27 sec)

To convert this table to disk-based storage, you can use the following
*note 'ALTER TABLE': alter-table. statement:

     mysql> ALTER TABLE t1 TABLESPACE ts_1 STORAGE DISK;
     Query OK, 0 rows affected (2.99 sec)
     Records: 0  Duplicates: 0  Warnings: 0

     mysql> SHOW CREATE TABLE t1\G
     *************************** 1. row ***************************
            Table: t1
     Create Table: CREATE TABLE `t1` (
       `c1` int(11) DEFAULT NULL
     ) /*!50100 TABLESPACE ts_1 STORAGE DISK */
     ENGINE=ndbcluster DEFAULT CHARSET=latin1
     1 row in set (0.01 sec)

It is not necessary that the tablespace was referenced when the table
was originally created; however, the tablespace must be referenced by
the *note 'ALTER TABLE': alter-table.:

     mysql> CREATE TABLE t2 (c1 INT) ts_1 ENGINE NDB;
     Query OK, 0 rows affected (1.00 sec)

     mysql> ALTER TABLE t2 STORAGE DISK;
     ERROR 1005 (HY000): Can't create table 'c.#sql-1750_3' (errno: 140)
     mysql> ALTER TABLE t2 TABLESPACE ts_1 STORAGE DISK;
     Query OK, 0 rows affected (3.42 sec)
     Records: 0  Duplicates: 0  Warnings: 0
     mysql> SHOW CREATE TABLE t2\G
     *************************** 1. row ***************************
            Table: t1
     Create Table: CREATE TABLE `t2` (
       `c1` int(11) DEFAULT NULL
     ) /*!50100 TABLESPACE ts_1 STORAGE DISK */
     ENGINE=ndbcluster DEFAULT CHARSET=latin1
     1 row in set (0.01 sec)

To change the storage type of an individual column, you can use 'ALTER
TABLE ... MODIFY [COLUMN]'.  For example, suppose you create an NDB
Cluster Disk Data table with two columns, using this *note 'CREATE
TABLE': create-table. statement:

     mysql> CREATE TABLE t3 (c1 INT, c2 INT)
         ->     TABLESPACE ts_1 STORAGE DISK ENGINE NDB;
     Query OK, 0 rows affected (1.34 sec)

To change column 'c2' from disk-based to in-memory storage, include a
STORAGE MEMORY clause in the column definition used by the ALTER TABLE
statement, as shown here:

     mysql> ALTER TABLE t3 MODIFY c2 INT STORAGE MEMORY;
     Query OK, 0 rows affected (3.14 sec)
     Records: 0  Duplicates: 0  Warnings: 0

You can make an in-memory column into a disk-based column by using
'STORAGE DISK' in a similar fashion.

Column 'c1' uses disk-based storage, since this is the default for the
table (determined by the table-level 'STORAGE DISK' clause in the *note
'CREATE TABLE': create-table. statement).  However, column 'c2' uses
in-memory storage, as can be seen here in the output of SHOW *note
'CREATE TABLE': create-table.:

     mysql> SHOW CREATE TABLE t3\G
     *************************** 1. row ***************************
            Table: t3
     Create Table: CREATE TABLE `t3` (
       `c1` int(11) DEFAULT NULL,
       `c2` int(11) /*!50120 STORAGE MEMORY */ DEFAULT NULL
     ) /*!50100 TABLESPACE ts_1 STORAGE DISK */ ENGINE=ndbcluster DEFAULT CHARSET=latin1
     1 row in set (0.02 sec)

When you add an 'AUTO_INCREMENT' column, column values are filled in
with sequence numbers automatically.  For 'MyISAM' tables, you can set
the first sequence number by executing 'SET INSERT_ID=VALUE' before
*note 'ALTER TABLE': alter-table. or by using the 'AUTO_INCREMENT=VALUE'
table option.

With 'MyISAM' tables, if you do not change the 'AUTO_INCREMENT' column,
the sequence number is not affected.  If you drop an 'AUTO_INCREMENT'
column and then add another 'AUTO_INCREMENT' column, the numbers are
resequenced beginning with 1.

When replication is used, adding an 'AUTO_INCREMENT' column to a table
might not produce the same ordering of the rows on the slave and the
master.  This occurs because the order in which the rows are numbered
depends on the specific storage engine used for the table and the order
in which the rows were inserted.  If it is important to have the same
order on the master and slave, the rows must be ordered before assigning
an 'AUTO_INCREMENT' number.  Assuming that you want to add an
'AUTO_INCREMENT' column to the table 't1', the following statements
produce a new table 't2' identical to 't1' but with an 'AUTO_INCREMENT'
column:

     CREATE TABLE t2 (id INT AUTO_INCREMENT PRIMARY KEY)
     SELECT * FROM t1 ORDER BY col1, col2;

This assumes that the table 't1' has columns 'col1' and 'col2'.

This set of statements will also produce a new table 't2' identical to
't1', with the addition of an 'AUTO_INCREMENT' column:

     CREATE TABLE t2 LIKE t1;
     ALTER TABLE t2 ADD id INT AUTO_INCREMENT PRIMARY KEY;
     INSERT INTO t2 SELECT * FROM t1 ORDER BY col1, col2;

*Important*:

To guarantee the same ordering on both master and slave, _all_ columns
of 't1' must be referenced in the 'ORDER BY' clause.

Regardless of the method used to create and populate the copy having the
'AUTO_INCREMENT' column, the final step is to drop the original table
and then rename the copy:

     DROP TABLE t1;
     ALTER TABLE t2 RENAME t1;


File: manual.info.tmp,  Node: alter-tablespace,  Next: alter-view,  Prev: alter-table,  Up: sql-data-definition-statements

13.1.8 ALTER TABLESPACE Statement
---------------------------------

     ALTER TABLESPACE TABLESPACE_NAME
         {ADD|DROP} DATAFILE 'FILE_NAME'
         [INITIAL_SIZE [=] SIZE]
         [WAIT]
         ENGINE [=] ENGINE_NAME

This statement is used either to add a new data file, or to drop a data
file from a tablespace.

The 'ADD DATAFILE' variant enables you to specify an initial size using
an 'INITIAL_SIZE' clause, where SIZE is measured in bytes; the default
value is 134217728 (128 MB). Prior to MySQL NDB Cluster 7.2.14, this
value was required to be specified using digits (Bug #13116514, Bug
#16104705, Bug #62858); in MySQL NDB Cluster 7.2.14 and later, you may
optionally follow SIZE with a one-letter abbreviation for an order of
magnitude, similar to those used in 'my.cnf'.  Generally, this is one of
the letters 'M' (megabytes) or 'G' (gigabytes).

*Note*:

All NDB Cluster Disk Data objects share the same namespace.  This means
that _each Disk Data object_ must be uniquely named (and not merely each
Disk Data object of a given type).  For example, you cannot have a
tablespace and a data file with the same name, or an undo log file and a
tablespace with the same name.

On 32-bit systems, the maximum supported value for 'INITIAL_SIZE' is
4294967296 (4 GB). (Bug #29186)

'INITIAL_SIZE' is rounded, explicitly, as for *note 'CREATE TABLESPACE':
create-tablespace.

Once a data file has been created, its size cannot be changed; however,
you can add more data files to the tablespace using additional 'ALTER
TABLESPACE ... ADD DATAFILE' statements.

Using 'DROP DATAFILE' with *note 'ALTER TABLESPACE': alter-tablespace.
drops the data file 'FILE_NAME' from the tablespace.  You cannot drop a
data file from a tablespace which is in use by any table; in other
words, the data file must be empty (no extents used).  See *note
mysql-cluster-disk-data-objects::.  In addition, any data file to be
dropped must previously have been added to the tablespace with *note
'CREATE TABLESPACE': create-tablespace. or *note 'ALTER TABLESPACE':
alter-tablespace.

Both 'ALTER TABLESPACE ... ADD DATAFILE' and 'ALTER TABLESPACE ... DROP
DATAFILE' require an 'ENGINE' clause which specifies the storage engine
used by the tablespace.  Currently, the only accepted values for
ENGINE_NAME are *note 'NDB': mysql-cluster. and *note 'NDBCLUSTER':
mysql-cluster.

'WAIT' is parsed but otherwise ignored, and so has no effect in MySQL
5.5.  It is intended for future expansion.

When 'ALTER TABLESPACE ... ADD DATAFILE' is used with 'ENGINE = NDB', a
data file is created on each Cluster data node.  You can verify that the
data files were created and obtain information about them by querying
the *note 'INFORMATION_SCHEMA.FILES': files-table. table.  For example,
the following query shows all data files belonging to the tablespace
named 'newts':

     mysql> SELECT LOGFILE_GROUP_NAME, FILE_NAME, EXTRA
         -> FROM INFORMATION_SCHEMA.FILES
         -> WHERE TABLESPACE_NAME = 'newts' AND FILE_TYPE = 'DATAFILE';
     +--------------------+--------------+----------------+
     | LOGFILE_GROUP_NAME | FILE_NAME    | EXTRA          |
     +--------------------+--------------+----------------+
     | lg_3               | newdata.dat  | CLUSTER_NODE=3 |
     | lg_3               | newdata.dat  | CLUSTER_NODE=4 |
     | lg_3               | newdata2.dat | CLUSTER_NODE=3 |
     | lg_3               | newdata2.dat | CLUSTER_NODE=4 |
     +--------------------+--------------+----------------+
     2 rows in set (0.03 sec)

See *note files-table::.

*note 'ALTER TABLESPACE': alter-tablespace. is useful only with Disk
Data storage for NDB Cluster.  See *note mysql-cluster-disk-data::.


File: manual.info.tmp,  Node: alter-view,  Next: create-database,  Prev: alter-tablespace,  Up: sql-data-definition-statements

13.1.9 ALTER VIEW Statement
---------------------------

     ALTER
         [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]
         [DEFINER = USER]
         [SQL SECURITY { DEFINER | INVOKER }]
         VIEW VIEW_NAME [(COLUMN_LIST)]
         AS SELECT_STATEMENT
         [WITH [CASCADED | LOCAL] CHECK OPTION]

This statement changes the definition of a view, which must exist.  The
syntax is similar to that for *note 'CREATE VIEW': create-view. see
*note create-view::).  This statement requires the 'CREATE VIEW' and
'DROP' privileges for the view, and some privilege for each column
referred to in the *note 'SELECT': select. statement.  *note 'ALTER
VIEW': alter-view. is permitted only to the definer or users with the
'SUPER' privilege.


File: manual.info.tmp,  Node: create-database,  Next: create-event,  Prev: alter-view,  Up: sql-data-definition-statements

13.1.10 CREATE DATABASE Statement
---------------------------------

     CREATE {DATABASE | SCHEMA} [IF NOT EXISTS] DB_NAME
         [CREATE_SPECIFICATION] ...

     CREATE_SPECIFICATION:
         [DEFAULT] CHARACTER SET [=] CHARSET_NAME
       | [DEFAULT] COLLATE [=] COLLATION_NAME

*note 'CREATE DATABASE': create-database. creates a database with the
given name.  To use this statement, you need the 'CREATE' privilege for
the database.  *note 'CREATE SCHEMA': create-database. is a synonym for
*note 'CREATE DATABASE': create-database.

An error occurs if the database exists and you did not specify 'IF NOT
EXISTS'.

*note 'CREATE DATABASE': create-database. is not permitted within a
session that has an active *note 'LOCK TABLES': lock-tables. statement.

CREATE_SPECIFICATION options specify database characteristics.  Database
characteristics are stored in the 'db.opt' file in the database
directory.  The 'CHARACTER SET' clause specifies the default database
character set.  The 'COLLATE' clause specifies the default database
collation.  *note charset::, discusses character set and collation
names.

A database in MySQL is implemented as a directory containing files that
correspond to tables in the database.  Because there are no tables in a
database when it is initially created, the *note 'CREATE DATABASE':
create-database. statement creates only a directory under the MySQL data
directory and the 'db.opt' file.  Rules for permissible database names
are given in *note identifiers::.  If a database name contains special
characters, the name for the database directory contains encoded
versions of those characters as described in *note identifier-mapping::.

If you manually create a directory under the data directory (for
example, with 'mkdir'), the server considers it a database directory and
it shows up in the output of *note 'SHOW DATABASES': show-databases.

MySQL has no limit on the number of databases.  The underlying file
system may have a limit on the number of directories.

You can also use the *note 'mysqladmin': mysqladmin. program to create
databases.  See *note mysqladmin::.


File: manual.info.tmp,  Node: create-event,  Next: create-function,  Prev: create-database,  Up: sql-data-definition-statements

13.1.11 CREATE EVENT Statement
------------------------------

     CREATE
         [DEFINER = USER]
         EVENT
         [IF NOT EXISTS]
         EVENT_NAME
         ON SCHEDULE SCHEDULE
         [ON COMPLETION [NOT] PRESERVE]
         [ENABLE | DISABLE | DISABLE ON SLAVE]
         [COMMENT 'STRING']
         DO EVENT_BODY;

     SCHEDULE:
         AT TIMESTAMP [+ INTERVAL INTERVAL] ...
       | EVERY INTERVAL
         [STARTS TIMESTAMP [+ INTERVAL INTERVAL] ...]
         [ENDS TIMESTAMP [+ INTERVAL INTERVAL] ...]

     INTERVAL:
         QUANTITY {YEAR | QUARTER | MONTH | DAY | HOUR | MINUTE |
                   WEEK | SECOND | YEAR_MONTH | DAY_HOUR | DAY_MINUTE |
                   DAY_SECOND | HOUR_MINUTE | HOUR_SECOND | MINUTE_SECOND}

This statement creates and schedules a new event.  The event will not
run unless the Event Scheduler is enabled.  For information about
checking Event Scheduler status and enabling it if necessary, see *note
events-configuration::.

*note 'CREATE EVENT': create-event. requires the 'EVENT' privilege for
the schema in which the event is to be created.  If the 'DEFINER' clause
is present, the privileges required depend on the USER value, as
discussed in *note stored-objects-security::.

The minimum requirements for a valid *note 'CREATE EVENT': create-event.
statement are as follows:

   * The keywords *note 'CREATE EVENT': create-event. plus an event
     name, which uniquely identifies the event in a database schema.

   * An 'ON SCHEDULE' clause, which determines when and how often the
     event executes.

   * A *note 'DO': do. clause, which contains the SQL statement to be
     executed by an event.

This is an example of a minimal *note 'CREATE EVENT': create-event.
statement:

     CREATE EVENT myevent
         ON SCHEDULE AT CURRENT_TIMESTAMP + INTERVAL 1 HOUR
         DO
           UPDATE myschema.mytable SET mycol = mycol + 1;

The previous statement creates an event named 'myevent'.  This event
executes once--one hour following its creation--by running an SQL
statement that increments the value of the 'myschema.mytable' table's
'mycol' column by 1.

The EVENT_NAME must be a valid MySQL identifier with a maximum length of
64 characters.  Event names are not case-sensitive, so you cannot have
two events named 'myevent' and 'MyEvent' in the same schema.  In
general, the rules governing event names are the same as those for names
of stored routines.  See *note identifiers::.

An event is associated with a schema.  If no schema is indicated as part
of EVENT_NAME, the default (current) schema is assumed.  To create an
event in a specific schema, qualify the event name with a schema using
'SCHEMA_NAME.EVENT_NAME' syntax.

The 'DEFINER' clause specifies the MySQL account to be used when
checking access privileges at event execution time.  If the 'DEFINER'
clause is present, the USER value should be a MySQL account specified as
''USER_NAME'@'HOST_NAME'', 'CURRENT_USER', or 'CURRENT_USER()'.  The
permitted USER values depend on the privileges you hold, as discussed in
*note stored-objects-security::.  Also see that section for additional
information about event security.

If the 'DEFINER' clause is omitted, the default definer is the user who
executes the *note 'CREATE EVENT': create-event. statement.  This is the
same as specifying 'DEFINER = CURRENT_USER' explicitly.

Within an event body, the 'CURRENT_USER' function returns the account
used to check privileges at event execution time, which is the 'DEFINER'
user.  For information about user auditing within events, see *note
account-activity-auditing::.

'IF NOT EXISTS' has the same meaning for *note 'CREATE EVENT':
create-event. as for *note 'CREATE TABLE': create-table.: If an event
named EVENT_NAME already exists in the same schema, no action is taken,
and no error results.  (However, a warning is generated in such cases.)

The 'ON SCHEDULE' clause determines when, how often, and for how long
the EVENT_BODY defined for the event repeats.  This clause takes one of
two forms:

   * 'AT TIMESTAMP' is used for a one-time event.  It specifies that the
     event executes one time only at the date and time given by
     TIMESTAMP, which must include both the date and time, or must be an
     expression that resolves to a datetime value.  You may use a value
     of either the *note 'DATETIME': datetime. or *note 'TIMESTAMP':
     datetime. type for this purpose.  If the date is in the past, a
     warning occurs, as shown here:

          mysql> SELECT NOW();
          +---------------------+
          | NOW()               |
          +---------------------+
          | 2006-02-10 23:59:01 |
          +---------------------+
          1 row in set (0.04 sec)

          mysql> CREATE EVENT e_totals
              ->     ON SCHEDULE AT '2006-02-10 23:59:00'
              ->     DO INSERT INTO test.totals VALUES (NOW());
          Query OK, 0 rows affected, 1 warning (0.00 sec)

          mysql> SHOW WARNINGS\G
          *************************** 1. row ***************************
            Level: Note
             Code: 1588
          Message: Event execution time is in the past and ON COMPLETION NOT
                   PRESERVE is set. The event was dropped immediately after
                   creation.

     *note 'CREATE EVENT': create-event. statements which are themselves
     invalid--for whatever reason--fail with an error.

     You may use 'CURRENT_TIMESTAMP' to specify the current date and
     time.  In such a case, the event acts as soon as it is created.

     To create an event which occurs at some point in the future
     relative to the current date and time--such as that expressed by
     the phrase 'three weeks from now'--you can use the optional clause
     '+ INTERVAL INTERVAL'.  The INTERVAL portion consists of two parts,
     a quantity and a unit of time, and follows the syntax rules
     described in *note temporal-intervals::, except that you cannot use
     any units keywords that involving microseconds when defining an
     event.  With some interval types, complex time units may be used.
     For example, 'two minutes and ten seconds' can be expressed as '+
     INTERVAL '2:10' MINUTE_SECOND'.

     You can also combine intervals.  For example, 'AT CURRENT_TIMESTAMP
     + INTERVAL 3 WEEK + INTERVAL 2 DAY' is equivalent to 'three weeks
     and two days from now'.  Each portion of such a clause must begin
     with '+ INTERVAL'.

   * To repeat actions at a regular interval, use an 'EVERY' clause.
     The 'EVERY' keyword is followed by an INTERVAL as described in the
     previous discussion of the 'AT' keyword.  ('+ INTERVAL' is _not_
     used with 'EVERY'.)  For example, 'EVERY 6 WEEK' means 'every six
     weeks'.

     Although '+ INTERVAL' clauses are not permitted in an 'EVERY'
     clause, you can use the same complex time units permitted in a '+
     INTERVAL'.

     An 'EVERY' clause may contain an optional 'STARTS' clause.
     'STARTS' is followed by a TIMESTAMP value that indicates when the
     action should begin repeating, and may also use '+ INTERVAL
     INTERVAL' to specify an amount of time 'from now'.  For example,
     'EVERY 3 MONTH STARTS CURRENT_TIMESTAMP + INTERVAL 1 WEEK' means
     'every three months, beginning one week from now'.  Similarly, you
     can express 'every two weeks, beginning six hours and fifteen
     minutes from now' as 'EVERY 2 WEEK STARTS CURRENT_TIMESTAMP +
     INTERVAL '6:15' HOUR_MINUTE'.  Not specifying 'STARTS' is the same
     as using 'STARTS CURRENT_TIMESTAMP'--that is, the action specified
     for the event begins repeating immediately upon creation of the
     event.

     An 'EVERY' clause may contain an optional 'ENDS' clause.  The
     'ENDS' keyword is followed by a TIMESTAMP value that tells MySQL
     when the event should stop repeating.  You may also use '+ INTERVAL
     INTERVAL' with 'ENDS'; for instance, 'EVERY 12 HOUR STARTS
     CURRENT_TIMESTAMP + INTERVAL 30 MINUTE ENDS CURRENT_TIMESTAMP +
     INTERVAL 4 WEEK' is equivalent to 'every twelve hours, beginning
     thirty minutes from now, and ending four weeks from now'.  Not
     using 'ENDS' means that the event continues executing indefinitely.

     'ENDS' supports the same syntax for complex time units as 'STARTS'
     does.

     You may use 'STARTS', 'ENDS', both, or neither in an 'EVERY'
     clause.

     If a repeating event does not terminate within its scheduling
     interval, the result may be multiple instances of the event
     executing simultaneously.  If this is undesirable, you should
     institute a mechanism to prevent simultaneous instances.  For
     example, you could use the 'GET_LOCK()' function, or row or table
     locking.

The 'ON SCHEDULE' clause may use expressions involving built-in MySQL
functions and user variables to obtain any of the TIMESTAMP or INTERVAL
values which it contains.  You may not use stored functions or
user-defined functions in such expressions, nor may you use any table
references; however, you may use 'SELECT FROM DUAL'.  This is true for
both *note 'CREATE EVENT': create-event. and *note 'ALTER EVENT':
alter-event. statements.  References to stored functions, user-defined
functions, and tables in such cases are specifically not permitted, and
fail with an error (see Bug #22830).

Times in the 'ON SCHEDULE' clause are interpreted using the current
session 'time_zone' value.  This becomes the event time zone; that is,
the time zone that is used for event scheduling and is in effect within
the event as it executes.  These times are converted to UTC and stored
along with the event time zone in the 'mysql.event' table.  This enables
event execution to proceed as defined regardless of any subsequent
changes to the server time zone or daylight saving time effects.  For
additional information about representation of event times, see *note
events-metadata::.  See also *note show-events::, and *note
events-table::.

Normally, once an event has expired, it is immediately dropped.  You can
override this behavior by specifying 'ON COMPLETION PRESERVE'.  Using
'ON COMPLETION NOT PRESERVE' merely makes the default nonpersistent
behavior explicit.

You can create an event but prevent it from being active using the
'DISABLE' keyword.  Alternatively, you can use 'ENABLE' to make explicit
the default status, which is active.  This is most useful in conjunction
with *note 'ALTER EVENT': alter-event. (see *note alter-event::).

A third value may also appear in place of 'ENABLE' or 'DISABLE';
'DISABLE ON SLAVE' is set for the status of an event on a replication
slave to indicate that the event was created on the master and
replicated to the slave, but is not executed on the slave.  See *note
replication-features-invoked::.

You may supply a comment for an event using a 'COMMENT' clause.  COMMENT
may be any string of up to 64 characters that you wish to use for
describing the event.  The comment text, being a string literal, must be
surrounded by quotation marks.

The *note 'DO': do. clause specifies an action carried by the event, and
consists of an SQL statement.  Nearly any valid MySQL statement that can
be used in a stored routine can also be used as the action statement for
a scheduled event.  (See *note stored-program-restrictions::.)  For
example, the following event 'e_hourly' deletes all rows from the
'sessions' table once per hour, where this table is part of the
'site_activity' schema:

     CREATE EVENT e_hourly
         ON SCHEDULE
           EVERY 1 HOUR
         COMMENT 'Clears out sessions table each hour.'
         DO
           DELETE FROM site_activity.sessions;

MySQL stores the 'sql_mode' system variable setting in effect when an
event is created or altered, and always executes the event with this
setting in force, _regardless of the current server SQL mode when the
event begins executing_.

A *note 'CREATE EVENT': create-event. statement that contains an *note
'ALTER EVENT': alter-event. statement in its *note 'DO': do. clause
appears to succeed; however, when the server attempts to execute the
resulting scheduled event, the execution fails with an error.

*Note*:

Statements such as *note 'SELECT': select. or *note 'SHOW': show. that
merely return a result set have no effect when used in an event; the
output from these is not sent to the MySQL Monitor, nor is it stored
anywhere.  However, you can use statements such as *note 'SELECT ...
INTO': select. and *note 'INSERT INTO ... SELECT': insert-select. that
store a result.  (See the next example in this section for an instance
of the latter.)

The schema to which an event belongs is the default schema for table
references in the *note 'DO': do. clause.  Any references to tables in
other schemas must be qualified with the proper schema name.

As with stored routines, you can use compound-statement syntax in the
*note 'DO': do. clause by using the 'BEGIN' and 'END' keywords, as shown
here:

     delimiter |

     CREATE EVENT e_daily
         ON SCHEDULE
           EVERY 1 DAY
         COMMENT 'Saves total number of sessions then clears the table each day'
         DO
           BEGIN
             INSERT INTO site_activity.totals (time, total)
               SELECT CURRENT_TIMESTAMP, COUNT(*)
                 FROM site_activity.sessions;
             DELETE FROM site_activity.sessions;
           END |

     delimiter ;

This example uses the 'delimiter' command to change the statement
delimiter.  See *note stored-programs-defining::.

More complex compound statements, such as those used in stored routines,
are possible in an event.  This example uses local variables, an error
handler, and a flow control construct:

     delimiter |

     CREATE EVENT e
         ON SCHEDULE
           EVERY 5 SECOND
         DO
           BEGIN
             DECLARE v INTEGER;
             DECLARE CONTINUE HANDLER FOR SQLEXCEPTION BEGIN END;

             SET v = 0;

             WHILE v < 5 DO
               INSERT INTO t1 VALUES (0);
               UPDATE t2 SET s1 = s1 + 1;
               SET v = v + 1;
             END WHILE;
         END |

     delimiter ;

There is no way to pass parameters directly to or from events; however,
it is possible to invoke a stored routine with parameters within an
event:

     CREATE EVENT e_call_myproc
         ON SCHEDULE
           AT CURRENT_TIMESTAMP + INTERVAL 1 DAY
         DO CALL myproc(5, 27);

If an event's definer has privileges sufficient to set global system
variables (see *note system-variable-privileges::), the event can read
and write global variables.  As granting such privileges entails a
potential for abuse, extreme care must be taken in doing so.

Generally, any statements that are valid in stored routines may be used
for action statements executed by events.  For more information about
statements permitted within stored routines, see *note
stored-routines-syntax::.  You can create an event as part of a stored
routine, but an event cannot be created by another event.


File: manual.info.tmp,  Node: create-function,  Next: create-index,  Prev: create-event,  Up: sql-data-definition-statements

13.1.12 CREATE FUNCTION Statement
---------------------------------

The *note 'CREATE FUNCTION': create-function. statement is used to
create stored functions and user-defined functions (UDFs):

   * For information about creating stored functions, see *note
     create-procedure::.

   * For information about creating user-defined functions, see *note
     create-function-udf::.


File: manual.info.tmp,  Node: create-index,  Next: create-logfile-group,  Prev: create-function,  Up: sql-data-definition-statements

13.1.13 CREATE INDEX Statement
------------------------------

     CREATE [ONLINE | OFFLINE] [UNIQUE | FULLTEXT | SPATIAL] INDEX INDEX_NAME
         [INDEX_TYPE]
         ON TBL_NAME (KEY_PART,...)
         [INDEX_OPTION] ...

     KEY_PART:
         COL_NAME [(LENGTH)] [ASC | DESC]

     INDEX_OPTION:
         KEY_BLOCK_SIZE [=] VALUE
       | INDEX_TYPE
       | WITH PARSER PARSER_NAME
       | COMMENT 'STRING'

     INDEX_TYPE:
         USING {BTREE | HASH}

Normally, you create all indexes on a table at the time the table itself
is created with *note 'CREATE TABLE': create-table.  See *note
create-table::.  This guideline is especially important for *note
'InnoDB': innodb-storage-engine. tables, where the primary key
determines the physical layout of rows in the data file.  *note 'CREATE
INDEX': create-index. enables you to add indexes to existing tables.

*note 'CREATE INDEX': create-index. is mapped to an *note 'ALTER TABLE':
alter-table. statement to create indexes.  See *note alter-table::.
*note 'CREATE INDEX': create-index. cannot be used to create a 'PRIMARY
KEY'; use *note 'ALTER TABLE': alter-table. instead.  For more
information about indexes, see *note mysql-indexes::.

An index specification of the form '(KEY_PART1, KEY_PART2, ...)' creates
an index with multiple key parts.  Index key values are formed by
concatenating the values of the given key parts.  For example '(col1,
col2, col3)' specifies a multiple-column index with index keys
consisting of values from 'col1', 'col2', and 'col3'.

A KEY_PART specification can end with 'ASC' or 'DESC'.  These keywords
are permitted for future extensions for specifying ascending or
descending index value storage.  Currently, they are parsed but ignored;
index values are always stored in ascending order.

The following sections describe different aspects of the *note 'CREATE
INDEX': create-index. statement:

   * *note create-index-column-prefixes::

   * *note create-index-unique::

   * *note create-index-fulltext::

   * *note create-index-spatial::

   * *note create-index-options::

   * *note create-index-copying::

*Column Prefix Key Parts*

For string columns, indexes can be created that use only the leading
part of column values, using 'COL_NAME(LENGTH)' syntax to specify an
index prefix length:

   * Prefixes can be specified for *note 'CHAR': char, *note 'VARCHAR':
     char, *note 'BINARY': binary-varbinary, and *note 'VARBINARY':
     binary-varbinary. key parts.

   * Prefixes _must_ be specified for *note 'BLOB': blob. and *note
     'TEXT': blob. key parts.  Additionally, *note 'BLOB': blob. and
     *note 'TEXT': blob. columns can be indexed only for 'InnoDB',
     'MyISAM', and 'BLACKHOLE' tables.

   * Prefix _limits_ are measured in bytes.  However, prefix _lengths_
     for index specifications in *note 'CREATE TABLE': create-table,
     *note 'ALTER TABLE': alter-table, and *note 'CREATE INDEX':
     create-index. statements are interpreted as number of characters
     for nonbinary string types (*note 'CHAR': char, *note 'VARCHAR':
     char, *note 'TEXT': blob.) and number of bytes for binary string
     types (*note 'BINARY': binary-varbinary, *note 'VARBINARY':
     binary-varbinary, *note 'BLOB': blob.).  Take this into account
     when specifying a prefix length for a nonbinary string column that
     uses a multibyte character set.

     Prefix support and lengths of prefixes (where supported) are
     storage engine dependent.  For example, a prefix can be up to 767
     bytes long for *note 'InnoDB': innodb-storage-engine. tables or
     3072 bytes if the 'innodb_large_prefix' option is enabled.  For
     *note 'MyISAM': myisam-storage-engine. tables, the prefix length
     limit is 1000 bytes.  The *note 'NDB': mysql-cluster. storage
     engine does not support prefixes (see *note
     mysql-cluster-limitations-unsupported::).

The statement shown here creates an index using the first 10 characters
of the 'name' column (assuming that 'name' has a nonbinary string type):

     CREATE INDEX part_of_name ON customer (name(10));

If names in the column usually differ in the first 10 characters,
lookups performed using this index should not be much slower than using
an index created from the entire 'name' column.  Also, using column
prefixes for indexes can make the index file much smaller, which could
save a lot of disk space and might also speed up *note 'INSERT': insert.
operations.

*Unique Indexes*

A 'UNIQUE' index creates a constraint such that all values in the index
must be distinct.  An error occurs if you try to add a new row with a
key value that matches an existing row.  If you specify a prefix value
for a column in a 'UNIQUE' index, the column values must be unique
within the prefix length.  A 'UNIQUE' index permits multiple 'NULL'
values for columns that can contain 'NULL'.

If a table has a 'PRIMARY KEY' or 'UNIQUE NOT NULL' index that consists
of a single column that has an integer type, you can use '_rowid' to
refer to the indexed column in *note 'SELECT': select. statements, as
follows:

   * '_rowid' refers to the 'PRIMARY KEY' column if there is a 'PRIMARY
     KEY' consisting of a single integer column.  If there is a 'PRIMARY
     KEY' but it does not consist of a single integer column, '_rowid'
     cannot be used.

   * Otherwise, '_rowid' refers to the column in the first 'UNIQUE NOT
     NULL' index if that index consists of a single integer column.  If
     the first 'UNIQUE NOT NULL' index does not consist of a single
     integer column, '_rowid' cannot be used.

*Full-Text Indexes*

'FULLTEXT' indexes are supported only for *note 'MyISAM':
myisam-storage-engine. tables and can include only *note 'CHAR': char,
*note 'VARCHAR': char, and *note 'TEXT': blob. columns.  Indexing always
happens over the entire column; column prefix indexing is not supported
and any prefix length is ignored if specified.  See *note
fulltext-search::, for details of operation.

*Spatial Indexes*

The *note 'MyISAM': myisam-storage-engine, *note 'InnoDB':
innodb-storage-engine, *note 'NDB': mysql-cluster, and *note 'ARCHIVE':
archive-storage-engine. storage engines support spatial columns such as
*note 'POINT': spatial-type-overview. and *note 'GEOMETRY':
spatial-type-overview.  (*note spatial-types::, describes the spatial
data types.)  However, support for spatial column indexing varies among
engines.  Spatial and nonspatial indexes on spatial columns are
available according to the following rules.

Spatial indexes on spatial columns (created using 'SPATIAL INDEX') have
these characteristics:

   * Available only for *note 'MyISAM': myisam-storage-engine. tables.
     Specifying 'SPATIAL INDEX' for other storage engines results in an
     error.

   * Indexed columns must be 'NOT NULL'.

   * Column prefix lengths are prohibited.  The full width of each
     column is indexed.

Nonspatial indexes on spatial columns (created with 'INDEX', 'UNIQUE',
or 'PRIMARY KEY') have these characteristics:

   * Permitted for any storage engine that supports spatial columns
     except *note 'ARCHIVE': archive-storage-engine.

   * Columns can be 'NULL' unless the index is a primary key.

   * For each spatial column in a non-'SPATIAL' index except *note
     'POINT': spatial-type-overview. columns, a column prefix length
     must be specified.  (This is the same requirement as for indexed
     *note 'BLOB': blob. columns.)  The prefix length is given in bytes.

   * The index type for a non-'SPATIAL' index depends on the storage
     engine.  Currently, B-tree is used.

   * Permitted for a column that can have 'NULL' values only for *note
     'InnoDB': innodb-storage-engine, *note 'MyISAM':
     myisam-storage-engine, and *note 'MEMORY': memory-storage-engine.
     tables.

*Index Options*

Following the key part list, index options can be given.  An
INDEX_OPTION value can be any of the following:

   * 'KEY_BLOCK_SIZE [=] VALUE'

     For *note 'MyISAM': myisam-storage-engine. tables, 'KEY_BLOCK_SIZE'
     optionally specifies the size in bytes to use for index key blocks.
     The value is treated as a hint; a different size could be used if
     necessary.  A 'KEY_BLOCK_SIZE' value specified for an individual
     index definition overrides a table-level 'KEY_BLOCK_SIZE' value.

     'KEY_BLOCK_SIZE' is not supported at the index level for *note
     'InnoDB': innodb-storage-engine. tables.  See *note create-table::.

   * INDEX_TYPE

     Some storage engines permit you to specify an index type when
     creating an index.  For example:

          CREATE TABLE lookup (id INT) ENGINE = MEMORY;
          CREATE INDEX id_index ON lookup (id) USING BTREE;

     *note create-index-storage-engine-index-types:: shows the
     permissible index type values supported by different storage
     engines.  Where multiple index types are listed, the first one is
     the default when no index type specifier is given.  Storage engines
     not listed in the table do not support an INDEX_TYPE clause in
     index definitions.

     *Index Types Per Storage Engine*

     Storage        Permissible Index Types
     Engine         

     *note 'InnoDB': innodb-storage-engine.'BTREE'
                    
     *note 'MyISAM': myisam-storage-engine.'BTREE'
                    
     *note 'MEMORY': memory-storage-engine./'HEAP''HASH', 'BTREE'
                    
     *note 'NDB': mysql-cluster.'BTREE', 'HASH' (see note in text)

     The INDEX_TYPE clause cannot be used for 'FULLTEXT INDEX' or
     'SPATIAL INDEX' specifications.  Full-text index implementation is
     storage engine dependent.  Spatial indexes are implemented as
     R-tree indexes.

     'BTREE' indexes are implemented by the *note 'NDB': mysql-cluster.
     storage engine as T-tree indexes.

     *Note*:

     For indexes on *note 'NDB': mysql-cluster. table columns, the
     'USING' option can be specified only for a unique index or primary
     key.  'USING HASH' prevents the creation of an ordered index;
     otherwise, creating a unique index or primary key on an *note
     'NDB': mysql-cluster. table automatically results in the creation
     of both an ordered index and a hash index, each of which indexes
     the same set of columns.

     For unique indexes that include one or more 'NULL' columns of an
     *note 'NDB': mysql-cluster. table, the hash index can be used only
     to look up literal values, which means that 'IS [NOT] NULL'
     conditions require a full scan of the table.  One workaround is to
     make sure that a unique index using one or more 'NULL' columns on
     such a table is always created in such a way that it includes the
     ordered index; that is, avoid employing 'USING HASH' when creating
     the index.

     If you specify an index type that is not valid for a given storage
     engine, but another index type is available that the engine can use
     without affecting query results, the engine uses the available
     type.  The parser recognizes 'RTREE' as a type name, but currently
     this cannot be specified for any storage engine.

     *Note*:

     Use of the INDEX_TYPE option before the 'ON TBL_NAME' clause is
     deprecated; support for use of the option in this position will be
     removed in a future MySQL release.  If an INDEX_TYPE option is
     given in both the earlier and later positions, the final option
     applies.

     'TYPE TYPE_NAME' is recognized as a synonym for 'USING TYPE_NAME'.
     However, 'USING' is the preferred form.

     The following tables show index characteristics for the storage
     engines that support the INDEX_TYPE option.

     *InnoDB Storage Engine Index Characteristics*

     Index       Index   Stores      Permits        IS NULL Scan   IS NOT NULL
     Class       Type    NULL        Multiple       Type           Scan Type
                         VALUES      NULL Values                   
                                     
     Primary     'BTREE' No          No             N/A            N/A
     key                                                           

     Unique      'BTREE' Yes         Yes            Index          Index
                                                                   
     Key         'BTREE' Yes         Yes            Index          Index
                                                    

     *MyISAM Storage Engine Index Characteristics*

     Index       Index   Stores      Permits        IS NULL Scan   IS NOT NULL
     Class       Type    NULL        Multiple       Type           Scan Type
                         VALUES      NULL Values                   
                                     
     Primary     'BTREE' No          No             N/A            N/A
     key                                                           

     Unique      'BTREE' Yes         Yes            Index          Index
                                                                   
     Key         'BTREE' Yes         Yes            Index          Index
                                                                   
     'FULLTEXT'  N/A     Yes         Yes            Table          Table
                                                                   
     'SPATIAL'   N/A     No          No             N/A            N/A
                                                    

     *MEMORY Storage Engine Index Characteristics*

     Index       Index   Stores      Permits        IS NULL Scan   IS NOT NULL
     Class       Type    NULL        Multiple       Type           Scan Type
                         VALUES      NULL Values                   
                                     
     Primary     'BTREE' No          No             N/A            N/A
     key                                                           

     Unique      'BTREE' Yes         Yes            Index          Index
                                                                   
     Key         'BTREE' Yes         Yes            Index          Index
                                                                   
     Primary     'HASH'  No          No             N/A            N/A
     key                                                           

     Unique      'HASH'  Yes         Yes            Index          Index
                                                                   
     Key         'HASH'  Yes         Yes            Index          Index
                                                    

     *NDB Storage Engine Index Characteristics*

     Index       Index   Stores      Permits        IS NULL Scan   IS NOT NULL
     Class       Type    NULL        Multiple       Type           Scan Type
                         VALUES      NULL Values                   
                                     
     Primary     'BTREE' No          No             Index          Index
     key                                                           

     Unique      'BTREE' Yes         Yes            Index          Index
                                                                   
     Key         'BTREE' Yes         Yes            Index          Index
                                                                   
     Primary     'HASH'  No          No             Table (see     Table (see
     key                                            note 1)        note 1)
                                                                   
     Unique      'HASH'  Yes         Yes            Table (see     Table (see
                                                    note 1)        note 1)
                                                                   
     Key         'HASH'  Yes         Yes            Table (see     Table (see
                                                    note 1)        note 1)
                                                    

     Table note:

     1.  If 'USING HASH' is specified that prevents creation of an
     implicit ordered index.

   * 'WITH PARSER PARSER_NAME'

     This option can be used only with 'FULLTEXT' indexes.  It
     associates a parser plugin with the index if full-text indexing and
     searching operations need special handling.  See *note
     plugin-api::, for details on creating plugins.

   * 'COMMENT 'STRING''

     Index definitions can include an optional comment of up to 1024
     characters.

*Table Copying and Locking Options*

Indexes on variable-width columns of *note 'NDBCLUSTER': mysql-cluster.
tables are created online; that is, without any table copying.  The
table is not locked against access from other NDB Cluster API nodes,
although it is locked against other operations on the _same_ API node
for the duration of the operation.  This is done automatically by the
server whenever it determines that it is possible to do so; you do not
have to use any special SQL syntax or server options to cause it to
happen.

In standard MySQL 5.5 releases, it is not possible to override the
server when it determines that an index is to be created without table
copying.  In NDB Cluster, you can create indexes offline (which causes
the table to be locked to all API nodes in the cluster) using the
'OFFLINE' keyword.  The rules and limitations governing 'CREATE OFFLINE
INDEX' and 'CREATE ONLINE INDEX' are the same as for 'ALTER OFFLINE
TABLE ... ADD INDEX' and 'ALTER ONLINE TABLE ... ADD INDEX'.  You cannot
cause the noncopying creation of an index that would normally be created
offline by using the 'ONLINE' keyword: If it is not possible to perform
the *note 'CREATE INDEX': create-index. operation without table copying,
the server ignores the 'ONLINE' keyword.  For more information, see
*note mysql-cluster-online-operations::.

The 'ONLINE' and 'OFFLINE' keywords are available only in NDB Cluster;
attempting to use these keywords in standard MySQL Server 5.5 releases
results in a syntax error.


File: manual.info.tmp,  Node: create-logfile-group,  Next: create-procedure,  Prev: create-index,  Up: sql-data-definition-statements

13.1.14 CREATE LOGFILE GROUP Statement
--------------------------------------

     CREATE LOGFILE GROUP LOGFILE_GROUP
         ADD UNDOFILE 'UNDO_FILE'
         [INITIAL_SIZE [=] INITIAL_SIZE]
         [UNDO_BUFFER_SIZE [=] UNDO_BUFFER_SIZE]
         [REDO_BUFFER_SIZE [=] REDO_BUFFER_SIZE]
         [NODEGROUP [=] NODEGROUP_ID]
         [WAIT]
         [COMMENT [=] 'STRING']
         ENGINE [=] ENGINE_NAME

This statement creates a new log file group named LOGFILE_GROUP having a
single 'UNDO' file named 'UNDO_FILE'.  A *note 'CREATE LOGFILE GROUP':
create-logfile-group. statement has one and only one 'ADD UNDOFILE'
clause.  For rules covering the naming of log file groups, see *note
identifiers::.

*Note*:

All NDB Cluster Disk Data objects share the same namespace.  This means
that _each Disk Data object_ must be uniquely named (and not merely each
Disk Data object of a given type).  For example, you cannot have a
tablespace and a log file group with the same name, or a tablespace and
a data file with the same name.

In MySQL NDB Cluster 7.2, you can have only one log file group per
Cluster at any given time.  (See Bug #16386)

The optional 'INITIAL_SIZE' parameter sets the 'UNDO' file's initial
size; if not specified, it defaults to '128M' (128 megabytes).  The
optional 'UNDO_BUFFER_SIZE' parameter sets the size used by the 'UNDO'
buffer for the log file group; The default value for 'UNDO_BUFFER_SIZE'
is '8M' (eight megabytes); this value cannot exceed the amount of system
memory available.  Both of these parameters are specified in bytes.  In
MySQL NDB Cluster 7.2.14 and later, you may optionally follow either or
both of these with a one-letter abbreviation for an order of magnitude,
similar to those used in 'my.cnf'.  Generally, this is one of the
letters 'M' (for megabytes) or 'G' (for gigabytes).  Prior to MySQL NDB
Cluster 7.2.14, the values for these options could only be specified
using digits.  (Bug #13116514, Bug #16104705, Bug #62858)

Memory used for 'UNDO_BUFFER_SIZE' comes from the global pool whose size
is determined by the value of the 'SharedGlobalMemory' data node
configuration parameter.  This includes any default value implied for
this option by the setting of the 'InitialLogFileGroup' data node
configuration parameter.

The maximum permitted for 'UNDO_BUFFER_SIZE' is 629145600 (600 MB).

On 32-bit systems, the maximum supported value for 'INITIAL_SIZE' is
4294967296 (4 GB). (Bug #29186)

The minimum allowed value for 'INITIAL_SIZE' is 1048576 (1 MB).

The 'ENGINE' option determines the storage engine to be used by this log
file group, with ENGINE_NAME being the name of the storage engine.  In
MySQL 5.5, this must be *note 'NDB': mysql-cluster. (or *note
'NDBCLUSTER': mysql-cluster.).  If 'ENGINE' is not set, MySQL tries to
use the engine specified by the 'default_storage_engine' server system
variable (formerly 'storage_engine').  In any case, if the engine is not
specified as *note 'NDB': mysql-cluster. or *note 'NDBCLUSTER':
mysql-cluster, the 'CREATE LOGFILE GROUP' statement appears to succeed
but actually fails to create the log file group, as shown here:

     mysql> CREATE LOGFILE GROUP lg1
         ->     ADD UNDOFILE 'undo.dat' INITIAL_SIZE = 10M;
     Query OK, 0 rows affected, 1 warning (0.00 sec)

     mysql> SHOW WARNINGS;
     +-------+------+------------------------------------------------------------------------------------------------+
     | Level | Code | Message                                                                                        |
     +-------+------+------------------------------------------------------------------------------------------------+
     | Error | 1478 | Table storage engine 'InnoDB' does not support the create option 'TABLESPACE or LOGFILE GROUP' |
     +-------+------+------------------------------------------------------------------------------------------------+
     1 row in set (0.00 sec)

     mysql> DROP LOGFILE GROUP lg1 ENGINE = NDB;
     ERROR 1529 (HY000): Failed to drop LOGFILE GROUP

     mysql> CREATE LOGFILE GROUP lg1
         ->     ADD UNDOFILE 'undo.dat' INITIAL_SIZE = 10M
         ->     ENGINE = NDB;
     Query OK, 0 rows affected (2.97 sec)

The fact that the 'CREATE LOGFILE GROUP' statement does not actually
return an error when a non-'NDB' storage engine is named, but rather
appears to succeed, is a known issue which we hope to address in a
future release of NDB Cluster.

REDO_BUFFER_SIZE, 'NODEGROUP', 'WAIT', and 'COMMENT' are parsed but
ignored, and so have no effect in MySQL 5.5.  These options are intended
for future expansion.

When used with 'ENGINE [=] NDB', a log file group and associated 'UNDO'
log file are created on each Cluster data node.  You can verify that the
'UNDO' files were created and obtain information about them by querying
the *note 'INFORMATION_SCHEMA.FILES': files-table. table.  For example:

     mysql> SELECT LOGFILE_GROUP_NAME, LOGFILE_GROUP_NUMBER, EXTRA
         -> FROM INFORMATION_SCHEMA.FILES
         -> WHERE FILE_NAME = 'undo_10.dat';
     +--------------------+----------------------+----------------+
     | LOGFILE_GROUP_NAME | LOGFILE_GROUP_NUMBER | EXTRA          |
     +--------------------+----------------------+----------------+
     | lg_3               |                   11 | CLUSTER_NODE=3 |
     | lg_3               |                   11 | CLUSTER_NODE=4 |
     +--------------------+----------------------+----------------+
     2 rows in set (0.06 sec)

*note 'CREATE LOGFILE GROUP': create-logfile-group. is useful only with
Disk Data storage for NDB Cluster.  See *note mysql-cluster-disk-data::.


File: manual.info.tmp,  Node: create-procedure,  Next: create-server,  Prev: create-logfile-group,  Up: sql-data-definition-statements

13.1.15 CREATE PROCEDURE and CREATE FUNCTION Statements
-------------------------------------------------------

     CREATE
         [DEFINER = USER]
         PROCEDURE SP_NAME ([PROC_PARAMETER[,...]])
         [CHARACTERISTIC ...] ROUTINE_BODY

     CREATE
         [DEFINER = USER]
         FUNCTION SP_NAME ([FUNC_PARAMETER[,...]])
         RETURNS TYPE
         [CHARACTERISTIC ...] ROUTINE_BODY

     PROC_PARAMETER:
         [ IN | OUT | INOUT ] PARAM_NAME TYPE

     FUNC_PARAMETER:
         PARAM_NAME TYPE

     TYPE:
         ANY VALID MYSQL DATA TYPE

     CHARACTERISTIC:
         COMMENT 'STRING'
       | LANGUAGE SQL
       | [NOT] DETERMINISTIC
       | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }
       | SQL SECURITY { DEFINER | INVOKER }

     ROUTINE_BODY:
         VALID SQL ROUTINE STATEMENT

These statements create stored routines.  By default, a routine is
associated with the default database.  To associate the routine
explicitly with a given database, specify the name as DB_NAME.SP_NAME
when you create it.

The *note 'CREATE FUNCTION': create-function. statement is also used in
MySQL to support UDFs (user-defined functions).  See *note
adding-functions::.  A UDF can be regarded as an external stored
function.  Stored functions share their namespace with UDFs.  See *note
function-resolution::, for the rules describing how the server
interprets references to different kinds of functions.

To invoke a stored procedure, use the *note 'CALL': call. statement (see
*note call::).  To invoke a stored function, refer to it in an
expression.  The function returns a value during expression evaluation.

*note 'CREATE PROCEDURE': create-procedure. and *note 'CREATE FUNCTION':
create-function. require the 'CREATE ROUTINE' privilege.  If the
'DEFINER' clause is present, the privileges required depend on the USER
value, as discussed in *note stored-objects-security::.  If binary
logging is enabled, *note 'CREATE FUNCTION': create-function. might
require the 'SUPER' privilege, as discussed in *note
stored-programs-logging::.

By default, MySQL automatically grants the 'ALTER ROUTINE' and 'EXECUTE'
privileges to the routine creator.  This behavior can be changed by
disabling the 'automatic_sp_privileges' system variable.  See *note
stored-routines-privileges::.

The 'DEFINER' and 'SQL SECURITY' clauses specify the security context to
be used when checking access privileges at routine execution time, as
described later in this section.

If the routine name is the same as the name of a built-in SQL function,
a syntax error occurs unless you use a space between the name and the
following parenthesis when defining the routine or invoking it later.
For this reason, avoid using the names of existing SQL functions for
your own stored routines.

The 'IGNORE_SPACE' SQL mode applies to built-in functions, not to stored
routines.  It is always permissible to have spaces after a stored
routine name, regardless of whether 'IGNORE_SPACE' is enabled.

The parameter list enclosed within parentheses must always be present.
If there are no parameters, an empty parameter list of '()' should be
used.  Parameter names are not case-sensitive.

Each parameter is an 'IN' parameter by default.  To specify otherwise
for a parameter, use the keyword 'OUT' or 'INOUT' before the parameter
name.

*Note*:

Specifying a parameter as 'IN', 'OUT', or 'INOUT' is valid only for a
'PROCEDURE'.  For a 'FUNCTION', parameters are always regarded as 'IN'
parameters.

An 'IN' parameter passes a value into a procedure.  The procedure might
modify the value, but the modification is not visible to the caller when
the procedure returns.  An 'OUT' parameter passes a value from the
procedure back to the caller.  Its initial value is 'NULL' within the
procedure, and its value is visible to the caller when the procedure
returns.  An 'INOUT' parameter is initialized by the caller, can be
modified by the procedure, and any change made by the procedure is
visible to the caller when the procedure returns.

For each 'OUT' or 'INOUT' parameter, pass a user-defined variable in the
*note 'CALL': call. statement that invokes the procedure so that you can
obtain its value when the procedure returns.  If you are calling the
procedure from within another stored procedure or function, you can also
pass a routine parameter or local routine variable as an 'OUT' or
'INOUT' parameter.  If you are calling the procedure from within a
trigger, you can also pass 'NEW.COL_NAME' as an 'OUT' or 'INOUT'
parameter.

For information about the effect of unhandled conditions on procedure
parameters, see *note conditions-and-parameters::.

Routine parameters cannot be referenced in statements prepared within
the routine; see *note stored-program-restrictions::.

The following example shows a simple stored procedure that uses an 'OUT'
parameter:

     mysql> delimiter //

     mysql> CREATE PROCEDURE simpleproc (OUT param1 INT)
         -> BEGIN
         ->   SELECT COUNT(*) INTO param1 FROM t;
         -> END//
     Query OK, 0 rows affected (0.00 sec)

     mysql> delimiter ;

     mysql> CALL simpleproc(@a);
     Query OK, 0 rows affected (0.00 sec)

     mysql> SELECT @a;
     +------+
     | @a   |
     +------+
     | 3    |
     +------+
     1 row in set (0.00 sec)

The example uses the *note 'mysql': mysql. client 'delimiter' command to
change the statement delimiter from ';' to '//' while the procedure is
being defined.  This enables the ';' delimiter used in the procedure
body to be passed through to the server rather than being interpreted by
*note 'mysql': mysql. itself.  See *note stored-programs-defining::.

The 'RETURNS' clause may be specified only for a 'FUNCTION', for which
it is mandatory.  It indicates the return type of the function, and the
function body must contain a 'RETURN VALUE' statement.  If the *note
'RETURN': return. statement returns a value of a different type, the
value is coerced to the proper type.  For example, if a function
specifies an *note 'ENUM': enum. or *note 'SET': set. value in the
'RETURNS' clause, but the *note 'RETURN': return. statement returns an
integer, the value returned from the function is the string for the
corresponding *note 'ENUM': enum. member of set of *note 'SET': set.
members.

The following example function takes a parameter, performs an operation
using an SQL function, and returns the result.  In this case, it is
unnecessary to use 'delimiter' because the function definition contains
no internal ';' statement delimiters:

     mysql> CREATE FUNCTION hello (s CHAR(20))
     mysql> RETURNS CHAR(50) DETERMINISTIC
         -> RETURN CONCAT('Hello, ',s,'!');
     Query OK, 0 rows affected (0.00 sec)

     mysql> SELECT hello('world');
     +----------------+
     | hello('world') |
     +----------------+
     | Hello, world!  |
     +----------------+
     1 row in set (0.00 sec)

Parameter types and function return types can be declared to use any
valid data type.  The 'COLLATE' attribute can be used if preceded by a
'CHARACTER SET' specification.

The ROUTINE_BODY consists of a valid SQL routine statement.  This can be
a simple statement such as *note 'SELECT': select. or *note 'INSERT':
insert, or a compound statement written using 'BEGIN' and 'END'.
Compound statements can contain declarations, loops, and other control
structure statements.  The syntax for these statements is described in
*note sql-compound-statements::.  In practice, stored functions tend to
use compound statements, unless the body consists of a single *note
'RETURN': return. statement.

MySQL permits routines to contain DDL statements, such as 'CREATE' and
'DROP'.  MySQL also permits stored procedures (but not stored functions)
to contain SQL transaction statements such as *note 'COMMIT': commit.
Stored functions may not contain statements that perform explicit or
implicit commit or rollback.  Support for these statements is not
required by the SQL standard, which states that each DBMS vendor may
decide whether to permit them.

Statements that return a result set can be used within a stored
procedure but not within a stored function.  This prohibition includes
*note 'SELECT': select. statements that do not have an 'INTO VAR_LIST'
clause and other statements such as *note 'SHOW': show, *note 'EXPLAIN':
explain, and *note 'CHECK TABLE': check-table.  For statements that can
be determined at function definition time to return a result set, a 'Not
allowed to return a result set from a function' error occurs
('ER_SP_NO_RETSET').  For statements that can be determined only at
runtime to return a result set, a 'PROCEDURE %s can't return a result
set in the given context' error occurs ('ER_SP_BADSELECT').

*note 'USE': use. statements within stored routines are not permitted.
When a routine is invoked, an implicit 'USE DB_NAME' is performed (and
undone when the routine terminates).  The causes the routine to have the
given default database while it executes.  References to objects in
databases other than the routine default database should be qualified
with the appropriate database name.

For additional information about statements that are not permitted in
stored routines, see *note stored-program-restrictions::.

For information about invoking stored procedures from within programs
written in a language that has a MySQL interface, see *note call::.

MySQL stores the 'sql_mode' system variable setting in effect when a
routine is created or altered, and always executes the routine with this
setting in force, _regardless of the current server SQL mode when the
routine begins executing_.

The switch from the SQL mode of the invoker to that of the routine
occurs after evaluation of arguments and assignment of the resulting
values to routine parameters.  If you define a routine in strict SQL
mode but invoke it in nonstrict mode, assignment of arguments to routine
parameters does not take place in strict mode.  If you require that
expressions passed to a routine be assigned in strict SQL mode, you
should invoke the routine with strict mode in effect.

The 'COMMENT' characteristic is a MySQL extension, and may be used to
describe the stored routine.  This information is displayed by the *note
'SHOW CREATE PROCEDURE': show-create-procedure. and *note 'SHOW CREATE
FUNCTION': show-create-function. statements.

The 'LANGUAGE' characteristic indicates the language in which the
routine is written.  The server ignores this characteristic; only SQL
routines are supported.

A routine is considered 'deterministic' if it always produces the same
result for the same input parameters, and 'not deterministic' otherwise.
If neither 'DETERMINISTIC' nor 'NOT DETERMINISTIC' is given in the
routine definition, the default is 'NOT DETERMINISTIC'.  To declare that
a function is deterministic, you must specify 'DETERMINISTIC'
explicitly.

Assessment of the nature of a routine is based on the 'honesty' of the
creator: MySQL does not check that a routine declared 'DETERMINISTIC' is
free of statements that produce nondeterministic results.  However,
misdeclaring a routine might affect results or affect performance.
Declaring a nondeterministic routine as 'DETERMINISTIC' might lead to
unexpected results by causing the optimizer to make incorrect execution
plan choices.  Declaring a deterministic routine as 'NONDETERMINISTIC'
might diminish performance by causing available optimizations not to be
used.

If binary logging is enabled, the 'DETERMINISTIC' characteristic affects
which routine definitions MySQL accepts.  See *note
stored-programs-logging::.

A routine that contains the 'NOW()' function (or its synonyms) or
'RAND()' is nondeterministic, but it might still be replication-safe.
For 'NOW()', the binary log includes the timestamp and replicates
correctly.  'RAND()' also replicates correctly as long as it is called
only a single time during the execution of a routine.  (You can consider
the routine execution timestamp and random number seed as implicit
inputs that are identical on the master and slave.)

Several characteristics provide information about the nature of data use
by the routine.  In MySQL, these characteristics are advisory only.  The
server does not use them to constrain what kinds of statements a routine
will be permitted to execute.

   * 'CONTAINS SQL' indicates that the routine does not contain
     statements that read or write data.  This is the default if none of
     these characteristics is given explicitly.  Examples of such
     statements are 'SET @x = 1' or 'DO RELEASE_LOCK('abc')', which
     execute but neither read nor write data.

   * 'NO SQL' indicates that the routine contains no SQL statements.

   * 'READS SQL DATA' indicates that the routine contains statements
     that read data (for example, *note 'SELECT': select.), but not
     statements that write data.

   * 'MODIFIES SQL DATA' indicates that the routine contains statements
     that may write data (for example, *note 'INSERT': insert. or *note
     'DELETE': delete.).

The 'SQL SECURITY' characteristic can be 'DEFINER' or 'INVOKER' to
specify the security context; that is, whether the routine executes
using the privileges of the account named in the routine 'DEFINER'
clause or the user who invokes it.  This account must have permission to
access the database with which the routine is associated.  The default
value is 'DEFINER'.  The user who invokes the routine must have the
'EXECUTE' privilege for it, as must the 'DEFINER' account if the routine
executes in definer security context.

The 'DEFINER' clause specifies the MySQL account to be used when
checking access privileges at routine execution time for routines that
have the 'SQL SECURITY DEFINER' characteristic.

If the 'DEFINER' clause is present, the USER value should be a MySQL
account specified as ''USER_NAME'@'HOST_NAME'', 'CURRENT_USER', or
'CURRENT_USER()'.  The permitted USER values depend on the privileges
you hold, as discussed in *note stored-objects-security::.  Also see
that section for additional information about stored routine security.

If the 'DEFINER' clause is omitted, the default definer is the user who
executes the *note 'CREATE PROCEDURE': create-procedure. or *note
'CREATE FUNCTION': create-function. statement.  This is the same as
specifying 'DEFINER = CURRENT_USER' explicitly.

Within the body of a stored routine that is defined with the 'SQL
SECURITY DEFINER' characteristic, the 'CURRENT_USER' function returns
the routine's 'DEFINER' value.  For information about user auditing
within stored routines, see *note account-activity-auditing::.

Consider the following procedure, which displays a count of the number
of MySQL accounts listed in the 'mysql.user' system table:

     CREATE DEFINER = 'admin'@'localhost' PROCEDURE account_count()
     BEGIN
       SELECT 'Number of accounts:', COUNT(*) FROM mysql.user;
     END;

The procedure is assigned a 'DEFINER' account of ''admin'@'localhost''
no matter which user defines it.  It executes with the privileges of
that account no matter which user invokes it (because the default
security characteristic is 'DEFINER').  The procedure succeeds or fails
depending on whether invoker has the 'EXECUTE' privilege for it and
''admin'@'localhost'' has the 'SELECT' privilege for the 'mysql.user'
system table.

Now suppose that the procedure is defined with the 'SQL SECURITY
INVOKER' characteristic:

     CREATE DEFINER = 'admin'@'localhost' PROCEDURE account_count()
     SQL SECURITY INVOKER
     BEGIN
       SELECT 'Number of accounts:', COUNT(*) FROM mysql.user;
     END;

The procedure still has a 'DEFINER' of ''admin'@'localhost'', but in
this case, it executes with the privileges of the invoking user.  Thus,
the procedure succeeds or fails depending on whether the invoker has the
'EXECUTE' privilege for it and the 'SELECT' privilege for the
'mysql.user' system table.

The server handles the data type of a routine parameter, local routine
variable created with *note 'DECLARE': declare, or function return value
as follows:

   * Assignments are checked for data type mismatches and overflow.
     Conversion and overflow problems result in warnings, or errors in
     strict SQL mode.

   * Only scalar values can be assigned.  For example, a statement such
     as 'SET x = (SELECT 1, 2)' is invalid.

   * For character data types, if 'CHARACTER SET' is includedd in the
     declaration, the specified character set and its default collation
     is used.  If the 'COLLATE' attribute is also present, that
     collation is used rather than the default collation.

     Prior to MySQL 5.5.3, if there is a 'CHARACTER SET' attribute in
     the declaration, the 'COLLATE' attribute is not supported, and the
     character set's default collation is used.  (This includes use of
     'BINARY', which in this context specifies the binary collation of
     the character set.)  If there is no 'CHARACTER SET' attribute, the
     database character set and its default collation (rather than the
     database collation) are used.

     If 'CHARACTER SET' and 'COLLATE' are not present, the database
     character set and collation in effect at routine creation time are
     used.  To avoid having the server use the database character set
     and collation, provide an explicit 'CHARACTER SET' and a 'COLLATE'
     attribute for character data parameters.

     If you change the database default character set or collation,
     stored routines that use the database defaults must be dropped and
     recreated so that they use the new defaults.

     The database character set and collation are given by the value of
     the 'character_set_database' and 'collation_database' system
     variables.  For more information, see *note charset-database::.


File: manual.info.tmp,  Node: create-server,  Next: create-table,  Prev: create-procedure,  Up: sql-data-definition-statements

13.1.16 CREATE SERVER Statement
-------------------------------

     CREATE SERVER SERVER_NAME
         FOREIGN DATA WRAPPER WRAPPER_NAME
         OPTIONS (OPTION [, OPTION] ...)

     OPTION:
       { HOST CHARACTER-LITERAL
       | DATABASE CHARACTER-LITERAL
       | USER CHARACTER-LITERAL
       | PASSWORD CHARACTER-LITERAL
       | SOCKET CHARACTER-LITERAL
       | OWNER CHARACTER-LITERAL
       | PORT NUMERIC-LITERAL }

This statement creates the definition of a server for use with the
'FEDERATED' storage engine.  The 'CREATE SERVER' statement creates a new
row in the 'servers' table in the 'mysql' database.  This statement
requires the 'SUPER' privilege.

The 'SERVER_NAME' should be a unique reference to the server.  Server
definitions are global within the scope of the server, it is not
possible to qualify the server definition to a specific database.
'SERVER_NAME' has a maximum length of 64 characters (names longer than
64 characters are silently truncated), and is case-insensitive.  You may
specify the name as a quoted string.

The 'WRAPPER_NAME' is an identifier and may be quoted with single
quotation marks.

For each 'OPTION' you must specify either a character literal or numeric
literal.  Character literals are UTF-8, support a maximum length of 64
characters and default to a blank (empty) string.  String literals are
silently truncated to 64 characters.  Numeric literals must be a number
between 0 and 9999, default value is 0.

*Note*:

The 'OWNER' option is currently not applied, and has no effect on the
ownership or operation of the server connection that is created.

The 'CREATE SERVER' statement creates an entry in the 'mysql.servers'
table that can later be used with the *note 'CREATE TABLE':
create-table. statement when creating a 'FEDERATED' table.  The options
that you specify will be used to populate the columns in the
'mysql.servers' table.  The table columns are 'Server_name', 'Host',
'Db', 'Username', 'Password', 'Port' and 'Socket'.

For example:

     CREATE SERVER s
     FOREIGN DATA WRAPPER mysql
     OPTIONS (USER 'Remote', HOST '198.51.100.106', DATABASE 'test');

Be sure to specify all options necessary to establish a connection to
the server.  The user name, host name, and database name are mandatory.
Other options might be required as well, such as password.

The data stored in the table can be used when creating a connection to a
'FEDERATED' table:

     CREATE TABLE t (s1 INT) ENGINE=FEDERATED CONNECTION='s';

For more information, see *note federated-storage-engine::.

'CREATE SERVER' causes an implicit commit.  See *note implicit-commit::.

'CREATE SERVER' is not written to the binary log, regardless of the
logging format that is in use.


File: manual.info.tmp,  Node: create-table,  Next: create-tablespace,  Prev: create-server,  Up: sql-data-definition-statements

13.1.17 CREATE TABLE Statement
------------------------------

* Menu:

* create-table-statement-retention::  CREATE TABLE Statement Retention
* create-table-files::           Files Created by CREATE TABLE
* create-temporary-table::       CREATE TEMPORARY TABLE Statement
* create-table-like::            CREATE TABLE ... LIKE Statement
* create-table-select::          CREATE TABLE ... SELECT Statement
* create-table-foreign-keys::    FOREIGN KEY Constraints
* silent-column-changes::        Silent Column Specification Changes

     CREATE [TEMPORARY] TABLE [IF NOT EXISTS] TBL_NAME
         (CREATE_DEFINITION,...)
         [TABLE_OPTIONS]
         [PARTITION_OPTIONS]

     CREATE [TEMPORARY] TABLE [IF NOT EXISTS] TBL_NAME
         [(CREATE_DEFINITION,...)]
         [TABLE_OPTIONS]
         [PARTITION_OPTIONS]
         [IGNORE | REPLACE]
         [AS] QUERY_EXPRESSION

     CREATE [TEMPORARY] TABLE [IF NOT EXISTS] TBL_NAME
         { LIKE OLD_TBL_NAME | (LIKE OLD_TBL_NAME) }

     CREATE_DEFINITION:
         COL_NAME COLUMN_DEFINITION
       | {INDEX|KEY} [INDEX_NAME] [INDEX_TYPE] (KEY_PART,...)
           [INDEX_OPTION] ...
       | {FULLTEXT|SPATIAL} [INDEX|KEY] [INDEX_NAME] (KEY_PART,...)
           [INDEX_OPTION] ...
       | [CONSTRAINT [SYMBOL]] PRIMARY KEY
           [INDEX_TYPE] (KEY_PART,...)
           [INDEX_OPTION] ...
       | [CONSTRAINT [SYMBOL]] UNIQUE [INDEX|KEY]
           [INDEX_NAME] [INDEX_TYPE] (KEY_PART,...)
           [INDEX_OPTION] ...
       | [CONSTRAINT [SYMBOL]] FOREIGN KEY
           [INDEX_NAME] (COL_NAME,...)
           REFERENCE_DEFINITION
       | CHECK (EXPR)

     COLUMN_DEFINITION:
         DATA_TYPE [NOT NULL | NULL] [DEFAULT DEFAULT_VALUE]
           [AUTO_INCREMENT] [UNIQUE [KEY]] [[PRIMARY] KEY]
           [COMMENT 'STRING']
           [COLLATE COLLATION_NAME]
           [COLUMN_FORMAT {FIXED|DYNAMIC|DEFAULT}]
           [STORAGE {DISK|MEMORY}]
           [REFERENCE_DEFINITION]

     DATA_TYPE:
         (see *note data-types::)

     KEY_PART:
         COL_NAME [(LENGTH)] [ASC | DESC]

     INDEX_TYPE:
         USING {BTREE | HASH}

     INDEX_OPTION:
         KEY_BLOCK_SIZE [=] VALUE
       | INDEX_TYPE
       | WITH PARSER PARSER_NAME
       | COMMENT 'STRING'

     REFERENCE_DEFINITION:
         REFERENCES TBL_NAME (KEY_PART,...)
           [MATCH FULL | MATCH PARTIAL | MATCH SIMPLE]
           [ON DELETE REFERENCE_OPTION]
           [ON UPDATE REFERENCE_OPTION]

     REFERENCE_OPTION:
         RESTRICT | CASCADE | SET NULL | NO ACTION | SET DEFAULT

     TABLE_OPTIONS:
         TABLE_OPTION [[,] TABLE_OPTION] ...

     TABLE_OPTION:
         AUTO_INCREMENT [=] VALUE
       | AVG_ROW_LENGTH [=] VALUE
       | [DEFAULT] CHARACTER SET [=] CHARSET_NAME
       | CHECKSUM [=] {0 | 1}
       | [DEFAULT] COLLATE [=] COLLATION_NAME
       | COMMENT [=] 'STRING'
       | CONNECTION [=] 'CONNECT_STRING'
       | {DATA|INDEX} DIRECTORY [=] 'ABSOLUTE PATH TO DIRECTORY'
       | DELAY_KEY_WRITE [=] {0 | 1}
       | ENGINE [=] ENGINE_NAME
       | INSERT_METHOD [=] { NO | FIRST | LAST }
       | KEY_BLOCK_SIZE [=] VALUE
       | MAX_ROWS [=] VALUE
       | MIN_ROWS [=] VALUE
       | PACK_KEYS [=] {0 | 1 | DEFAULT}
       | PASSWORD [=] 'STRING'
       | ROW_FORMAT [=] {DEFAULT|DYNAMIC|FIXED|COMPRESSED|REDUNDANT|COMPACT}
       | TABLESPACE TABLESPACE_NAME [STORAGE {DISK|MEMORY}]
       | UNION [=] (TBL_NAME[,TBL_NAME]...)

     PARTITION_OPTIONS:
         PARTITION BY
             { [LINEAR] HASH(EXPR)
             | [LINEAR] KEY [ALGORITHM={1|2}] (COLUMN_LIST)
             | RANGE{(EXPR) | COLUMNS(COLUMN_LIST)}
             | LIST{(EXPR) | COLUMNS(COLUMN_LIST)} }
         [PARTITIONS NUM]
         [SUBPARTITION BY
             { [LINEAR] HASH(EXPR)
             | [LINEAR] KEY [ALGORITHM={1|2}] (COLUMN_LIST) }
           [SUBPARTITIONS NUM]
         ]
         [(PARTITION_DEFINITION [, PARTITION_DEFINITION] ...)]

     PARTITION_DEFINITION:
         PARTITION PARTITION_NAME
             [VALUES
                 {LESS THAN {(EXPR | VALUE_LIST) | MAXVALUE}
                 |
                 IN (VALUE_LIST)}]
             [[STORAGE] ENGINE [=] ENGINE_NAME]
             [COMMENT [=] 'STRING' ]
             [DATA DIRECTORY [=] 'DATA_DIR']
             [INDEX DIRECTORY [=] 'INDEX_DIR']
             [MAX_ROWS [=] MAX_NUMBER_OF_ROWS]
             [MIN_ROWS [=] MIN_NUMBER_OF_ROWS]
             [TABLESPACE [=] TABLESPACE_NAME]
             [NODEGROUP [=] NODE_GROUP_ID]
             [(SUBPARTITION_DEFINITION [, SUBPARTITION_DEFINITION] ...)]

     SUBPARTITION_DEFINITION:
         SUBPARTITION LOGICAL_NAME
             [[STORAGE] ENGINE [=] ENGINE_NAME]
             [COMMENT [=] 'STRING' ]
             [DATA DIRECTORY [=] 'DATA_DIR']
             [INDEX DIRECTORY [=] 'INDEX_DIR']
             [MAX_ROWS [=] MAX_NUMBER_OF_ROWS]
             [MIN_ROWS [=] MIN_NUMBER_OF_ROWS]
             [TABLESPACE [=] TABLESPACE_NAME]
             [NODEGROUP [=] NODE_GROUP_ID]

     QUERY_EXPRESSION:
         SELECT ...   (SOME VALID SELECT OR UNION STATEMENT)

*note 'CREATE TABLE': create-table. creates a table with the given name.
You must have the 'CREATE' privilege for the table.

By default, tables are created in the default database, using the *note
'InnoDB': innodb-storage-engine. storage engine.  An error occurs if the
table exists, if there is no default database, or if the database does
not exist.

MySQL has no limit on the number of tables.  The underlying file system
may have a limit on the number of files that represent tables.
Individual storage engines may impose engine-specific constraints.
'InnoDB' permits up to 4 billion tables.

For information about the physical representation of a table, see *note
create-table-files::.

The original *note 'CREATE TABLE': create-table. statement, including
all specifications and table options are stored by MySQL when the table
is created.  For more information, see *note
create-table-statement-retention::.

There are several aspects to the *note 'CREATE TABLE': create-table.
statement, described under the following topics in this section:

   * *note create-table-name::

   * *note create-table-temporary-tables::

   * *note create-table-clone-copy::

   * *note create-table-types-attributes::

   * *note create-table-indexes-keys::

   * *note create-table-options::

   * *note create-table-partitioning::

*Table Name*

   * 'TBL_NAME'

     The table name can be specified as DB_NAME.TBL_NAME to create the
     table in a specific database.  This works regardless of whether
     there is a default database, assuming that the database exists.  If
     you use quoted identifiers, quote the database and table names
     separately.  For example, write '`mydb`.`mytbl`', not
     '`mydb.mytbl`'.

     Rules for permissible table names are given in *note identifiers::.

   * 'IF NOT EXISTS'

     Prevents an error from occurring if the table exists.  However,
     there is no verification that the existing table has a structure
     identical to that indicated by the *note 'CREATE TABLE':
     create-table. statement.

*Temporary Tables*

You can use the 'TEMPORARY' keyword when creating a table.  A
'TEMPORARY' table is visible only within the current session, and is
dropped automatically when the session is closed.  For more information,
see *note create-temporary-table::.

*Table Cloning and Copying*

   * 'LIKE'

     Use 'CREATE TABLE ... LIKE' to create an empty table based on the
     definition of another table, including any column attributes and
     indexes defined in the original table:

          CREATE TABLE NEW_TBL LIKE ORIG_TBL;

     For more information, see *note create-table-like::.

   * '[AS] QUERY_EXPRESSION'

     To create one table from another, add a *note 'SELECT': select.
     statement at the end of the *note 'CREATE TABLE': create-table.
     statement:

          CREATE TABLE NEW_TBL AS SELECT * FROM ORIG_TBL;

     For more information, see *note create-table-select::.

   * 'IGNORE|REPLACE'

     The 'IGNORE' and 'REPLACE' options indicate how to handle rows that
     duplicate unique key values when copying a table using a *note
     'SELECT': select. statement.

     For more information, see *note create-table-select::.

*Column Data Types and Attributes*

There is a hard limit of 4096 columns per table, but the effective
maximum may be less for a given table and depends on the factors
discussed in *note column-count-limit::.

   * 'DATA_TYPE'

     DATA_TYPE represents the data type in a column definition.  For a
     full description of the syntax available for specifying column data
     types, as well as information about the properties of each type,
     see *note data-types::.

        * Some attributes do not apply to all data types.
          'AUTO_INCREMENT' applies only to integer and floating-point
          types.  'DEFAULT' does not apply to the *note 'BLOB': blob. or
          *note 'TEXT': blob. types.

        * Character data types (*note 'CHAR': char, *note 'VARCHAR':
          char, the *note 'TEXT': blob. types, *note 'ENUM': enum, *note
          'SET': set, and any synonyms) can include 'CHARACTER SET' to
          specify the character set for the column.  'CHARSET' is a
          synonym for 'CHARACTER SET'.  A collation for the character
          set can be specified with the 'COLLATE' attribute, along with
          any other attributes.  For details, see *note charset::.
          Example:

               CREATE TABLE t (c CHAR(20) CHARACTER SET utf8 COLLATE utf8_bin);

          MySQL 5.5 interprets length specifications in character column
          definitions in characters.  Lengths for *note 'BINARY':
          binary-varbinary. and *note 'VARBINARY': binary-varbinary. are
          in bytes.

        * For *note 'CHAR': char, *note 'VARCHAR': char, *note 'BINARY':
          binary-varbinary, and *note 'VARBINARY': binary-varbinary.
          columns, indexes can be created that use only the leading part
          of column values, using 'COL_NAME(LENGTH)' syntax to specify
          an index prefix length.  *note 'BLOB': blob. and *note 'TEXT':
          blob. columns also can be indexed, but a prefix length _must_
          be given.  Prefix lengths are given in characters for
          nonbinary string types and in bytes for binary string types.
          That is, index entries consist of the first LENGTH characters
          of each column value for *note 'CHAR': char, *note 'VARCHAR':
          char, and *note 'TEXT': blob. columns, and the first LENGTH
          bytes of each column value for *note 'BINARY':
          binary-varbinary, *note 'VARBINARY': binary-varbinary, and
          *note 'BLOB': blob. columns.  Indexing only a prefix of column
          values like this can make the index file much smaller.  For
          additional information about index prefixes, see *note
          create-index::.

          Only the 'InnoDB' and 'MyISAM' storage engines support
          indexing on *note 'BLOB': blob. and *note 'TEXT': blob.
          columns.  For example:

               CREATE TABLE test (blob_col BLOB, INDEX(blob_col(10)));

   * 'NOT NULL | NULL'

     If neither 'NULL' nor 'NOT NULL' is specified, the column is
     treated as though 'NULL' had been specified.

     In MySQL 5.5, only the 'InnoDB', 'MyISAM', and 'MEMORY' storage
     engines support indexes on columns that can have 'NULL' values.  In
     other cases, you must declare indexed columns as 'NOT NULL' or an
     error results.

   * 'DEFAULT'

     Specifies a default value for a column.  For more information about
     default value handling, including the case that a column definition
     includes no explicit 'DEFAULT' value, see *note
     data-type-defaults::.

     *note 'CREATE TABLE': create-table. fails if a date-valued default
     is not correct according to the 'NO_ZERO_IN_DATE' SQL mode, even if
     strict SQL mode is not enabled.  For example, 'c1 DATE DEFAULT
     '2010-00-00'' causes *note 'CREATE TABLE': create-table. to fail
     with 'Invalid default value for 'c1''.

   * 'AUTO_INCREMENT'

     An integer or floating-point column can have the additional
     attribute 'AUTO_INCREMENT'.  When you insert a value of 'NULL'
     (recommended) or '0' into an indexed 'AUTO_INCREMENT' column, the
     column is set to the next sequence value.  Typically this is
     'VALUE+1', where VALUE is the largest value for the column
     currently in the table.  'AUTO_INCREMENT' sequences begin with '1'.

     To retrieve an 'AUTO_INCREMENT' value after inserting a row, use
     the 'LAST_INSERT_ID()' SQL function or the *note
     'mysql_insert_id()': mysql-insert-id. C API function.  See *note
     information-functions::, and *note mysql-insert-id::.

     If the 'NO_AUTO_VALUE_ON_ZERO' SQL mode is enabled, you can store
     '0' in 'AUTO_INCREMENT' columns as '0' without generating a new
     sequence value.  See *note sql-mode::.

     There can be only one 'AUTO_INCREMENT' column per table, it must be
     indexed, and it cannot have a 'DEFAULT' value.  An 'AUTO_INCREMENT'
     column works properly only if it contains only positive values.
     Inserting a negative number is regarded as inserting a very large
     positive number.  This is done to avoid precision problems when
     numbers 'wrap' over from positive to negative and also to ensure
     that you do not accidentally get an 'AUTO_INCREMENT' column that
     contains '0'.

     For 'MyISAM' tables, you can specify an 'AUTO_INCREMENT' secondary
     column in a multiple-column key.  See *note
     example-auto-increment::.

     To make MySQL compatible with some ODBC applications, you can find
     the 'AUTO_INCREMENT' value for the last inserted row with the
     following query:

          SELECT * FROM TBL_NAME WHERE AUTO_COL IS NULL

     This method requires that 'sql_auto_is_null' variable is not set to
     0.  See *note server-system-variables::.

     For information about 'InnoDB' and 'AUTO_INCREMENT', see *note
     innodb-auto-increment-handling::.  For information about
     'AUTO_INCREMENT' and MySQL Replication, see *note
     replication-features-auto-increment::.

   * 'COMMENT'

     A comment for a column can be specified with the 'COMMENT' option,
     up to 1024 characters long (255 characters before MySQL 5.5.3).
     The comment is displayed by the *note 'SHOW CREATE TABLE':
     show-create-table. and *note 'SHOW FULL COLUMNS': show-columns.
     statements.

   * 'COLUMN_FORMAT'

     In NDB Cluster, it is also possible to specify a data storage
     format for individual columns of *note 'NDB': mysql-cluster. tables
     using 'COLUMN_FORMAT'.  Permissible column formats are 'FIXED',
     'DYNAMIC', and 'DEFAULT'.  'FIXED' is used to specify fixed-width
     storage, 'DYNAMIC' permits the column to be variable-width, and
     'DEFAULT' causes the column to use fixed-width or variable-width
     storage as determined by the column's data type (possibly
     overridden by a 'ROW_FORMAT' specifier).

     For *note 'NDB': mysql-cluster. tables, the default value for
     'COLUMN_FORMAT' is 'DEFAULT'.

     In NDB Cluster, the maximum possible offset for a column defined
     with 'COLUMN_FORMAT=FIXED' is 8188 bytes.  For more information and
     possible workarounds, see *note
     mysql-cluster-limitations-database-objects::.

     'COLUMN_FORMAT' currently has no effect on columns of tables using
     storage engines other than *note 'NDB': mysql-cluster.  In MySQL
     5.5 and later, 'COLUMN_FORMAT' is silently ignored.

   * 'STORAGE'

     For *note 'NDB': mysql-cluster. tables, it is possible to specify
     whether the column is stored on disk or in memory by using a
     'STORAGE' clause.  'STORAGE DISK' causes the column to be stored on
     disk, and 'STORAGE MEMORY' causes in-memory storage to be used.
     The *note 'CREATE TABLE': create-table. statement used must still
     include a 'TABLESPACE' clause:

          mysql> CREATE TABLE t1 (
              ->     c1 INT STORAGE DISK,
              ->     c2 INT STORAGE MEMORY
              -> ) ENGINE NDB;
          ERROR 1005 (HY000): Can't create table 'c.t1' (errno: 140)

          mysql> CREATE TABLE t1 (
              ->     c1 INT STORAGE DISK,
              ->     c2 INT STORAGE MEMORY
              -> ) TABLESPACE ts_1 ENGINE NDB;
          Query OK, 0 rows affected (1.06 sec)

     For *note 'NDB': mysql-cluster. tables, 'STORAGE DEFAULT' is
     equivalent to 'STORAGE MEMORY'.

     The 'STORAGE' clause has no effect on tables using storage engines
     other than *note 'NDB': mysql-cluster.  The 'STORAGE' keyword is
     supported only in the build of *note 'mysqld': mysqld. that is
     supplied with NDB Cluster; it is not recognized in any other
     version of MySQL, where any attempt to use the 'STORAGE' keyword
     causes a syntax error.

*Indexes and Foreign Keys*

Several keywords apply to creation of indexes and foreign keys.  For
general background in addition to the following descriptions, see *note
create-index::, and *note create-table-foreign-keys::.

   * 'CONSTRAINT SYMBOL'

     The 'CONSTRAINT SYMBOL' clause may be given to name a constraint.
     If the clause is not given, or a SYMBOL is not included following
     the 'CONSTRAINT' keyword, MySQL automatically generates a
     constraint name.  The SYMBOL value, if used, must be unique per
     schema (database), per constraint type.  A duplicate SYMBOL results
     in an error.  See also the discussion about length limits of
     generated constraint identifiers at *note identifier-length::.

     The SQL standard specifies that all types of constraints (primary
     key, unique index, foreign key, check) belong to the same
     namespace.  In MySQL, each constraint type has its own namespace
     per schema.  Consequently, names for each type of constraint must
     be unique per schema.

   * 'PRIMARY KEY'

     A unique index where all key columns must be defined as 'NOT NULL'.
     If they are not explicitly declared as 'NOT NULL', MySQL declares
     them so implicitly (and silently).  A table can have only one
     'PRIMARY KEY'.  The name of a 'PRIMARY KEY' is always 'PRIMARY',
     which thus cannot be used as the name for any other kind of index.

     If you do not have a 'PRIMARY KEY' and an application asks for the
     'PRIMARY KEY' in your tables, MySQL returns the first 'UNIQUE'
     index that has no 'NULL' columns as the 'PRIMARY KEY'.

     In 'InnoDB' tables, keep the 'PRIMARY KEY' short to minimize
     storage overhead for secondary indexes.  Each secondary index entry
     contains a copy of the primary key columns for the corresponding
     row.  (See *note innodb-index-types::.)

     In the created table, a 'PRIMARY KEY' is placed first, followed by
     all 'UNIQUE' indexes, and then the nonunique indexes.  This helps
     the MySQL optimizer to prioritize which index to use and also more
     quickly to detect duplicated 'UNIQUE' keys.

     A 'PRIMARY KEY' can be a multiple-column index.  However, you
     cannot create a multiple-column index using the 'PRIMARY KEY' key
     attribute in a column specification.  Doing so only marks that
     single column as primary.  You must use a separate 'PRIMARY
     KEY(KEY_PART, ...)' clause.

     If a table has a 'PRIMARY KEY' or 'UNIQUE NOT NULL' index that
     consists of a single column that has an integer type, you can use
     '_rowid' to refer to the indexed column in *note 'SELECT': select.
     statements, as described in *note create-index-unique::.

     In MySQL, the name of a 'PRIMARY KEY' is 'PRIMARY'.  For other
     indexes, if you do not assign a name, the index is assigned the
     same name as the first indexed column, with an optional suffix
     ('_2', '_3', '...') to make it unique.  You can see index names for
     a table using 'SHOW INDEX FROM TBL_NAME'.  See *note show-index::.

   * 'KEY | INDEX'

     'KEY' is normally a synonym for 'INDEX'.  The key attribute
     'PRIMARY KEY' can also be specified as just 'KEY' when given in a
     column definition.  This was implemented for compatibility with
     other database systems.

   * 'UNIQUE'

     A 'UNIQUE' index creates a constraint such that all values in the
     index must be distinct.  An error occurs if you try to add a new
     row with a key value that matches an existing row.  For all
     engines, a 'UNIQUE' index permits multiple 'NULL' values for
     columns that can contain 'NULL'.  If you specify a prefix value for
     a column in a 'UNIQUE' index, the column values must be unique
     within the prefix length.

     If a table has a 'PRIMARY KEY' or 'UNIQUE NOT NULL' index that
     consists of a single column that has an integer type, you can use
     '_rowid' to refer to the indexed column in *note 'SELECT': select.
     statements, as described in *note create-index-unique::.

   * 'FULLTEXT'

     A 'FULLTEXT' index is a special type of index used for full-text
     searches.  Only the 'MyISAM' storage engine supports 'FULLTEXT'
     indexes.  They can be created only from *note 'CHAR': char, *note
     'VARCHAR': char, and *note 'TEXT': blob. columns.  Indexing always
     happens over the entire column; column prefix indexing is not
     supported and any prefix length is ignored if specified.  See *note
     fulltext-search::, for details of operation.  A 'WITH PARSER'
     clause can be specified as an INDEX_OPTION value to associate a
     parser plugin with the index if full-text indexing and searching
     operations need special handling.  This clause is valid only for
     'FULLTEXT' indexes.  See *note plugin-api::, for details on
     creating plugins.

   * 'SPATIAL'

     You can create 'SPATIAL' indexes on spatial data types.  Spatial
     types are supported only for 'MyISAM' tables and indexed columns
     must be declared as 'NOT NULL'.  See *note spatial-types::.

   * 'FOREIGN KEY'

     MySQL supports foreign keys, which let you cross-reference related
     data across tables, and foreign key constraints, which help keep
     this spread-out data consistent.  For definition and option
     information, see REFERENCE_DEFINITION, and REFERENCE_OPTION.

     Partitioned tables employing the *note 'InnoDB':
     innodb-storage-engine. storage engine do not support foreign keys.
     See *note partitioning-limitations::, for more information.

   * 'CHECK'

     The 'CHECK' clause is parsed but ignored by all storage engines.

   * 'KEY_PART'

        * A KEY_PART specification can end with 'ASC' or 'DESC'.  These
          keywords are permitted for future extensions for specifying
          ascending or descending index value storage.  Currently, they
          are parsed but ignored; index values are always stored in
          ascending order.

        * Prefixes, defined by the LENGTH attribute, can be up to 767
          bytes long for 'InnoDB' tables or 3072 bytes if the
          'innodb_large_prefix' option is enabled.  For MyISAM tables,
          the prefix length limit is 1000 bytes.

          Prefix _limits_ are measured in bytes.  However, prefix
          _lengths_ for index specifications in *note 'CREATE TABLE':
          create-table, *note 'ALTER TABLE': alter-table, and *note
          'CREATE INDEX': create-index. statements are interpreted as
          number of characters for nonbinary string types (*note 'CHAR':
          char, *note 'VARCHAR': char, *note 'TEXT': blob.) and number
          of bytes for binary string types (*note 'BINARY':
          binary-varbinary, *note 'VARBINARY': binary-varbinary, *note
          'BLOB': blob.).  Take this into account when specifying a
          prefix length for a nonbinary string column that uses a
          multibyte character set.

   * 'INDEX_TYPE'

     Some storage engines permit you to specify an index type when
     creating an index.  The syntax for the INDEX_TYPE specifier is
     'USING TYPE_NAME'.

     Example:

          CREATE TABLE lookup
            (id INT, INDEX USING BTREE (id))
            ENGINE = MEMORY;

     The preferred position for 'USING' is after the index column list.
     It can be given before the column list, but support for use of the
     option in that position is deprecated and will be removed in a
     future MySQL release.

   * 'INDEX_OPTION'

     INDEX_OPTION values specify additional options for an index.

        * 'KEY_BLOCK_SIZE'

          For *note 'MyISAM': myisam-storage-engine. tables,
          'KEY_BLOCK_SIZE' optionally specifies the size in bytes to use
          for index key blocks.  The value is treated as a hint; a
          different size could be used if necessary.  A 'KEY_BLOCK_SIZE'
          value specified for an individual index definition overrides
          the table-level 'KEY_BLOCK_SIZE' value.

          For information about the table-level 'KEY_BLOCK_SIZE'
          attribute, see *note create-table-options::.

        * 'WITH PARSER'

          A 'WITH PARSER' clause can be specified as an INDEX_OPTION
          value to associate a parser plugin with the index if full-text
          indexing and searching operations need special handling.  This
          clause is valid only for 'FULLTEXT' indexes.  See *note
          plugin-api::, for details on creating plugins.

        * 'COMMENT'

          As of MySQL 5.5.3, index definitions can include an optional
          comment of up to 1024 characters.

     For more information about permissible INDEX_OPTION values, see
     *note create-index::.  For more information about indexes, see
     *note mysql-indexes::.

   * 'REFERENCE_DEFINITION'

     For REFERENCE_DEFINITION syntax details and examples, see *note
     create-table-foreign-keys::.

     *note 'InnoDB': innodb-storage-engine. tables support checking of
     foreign key constraints.  The columns of the referenced table must
     always be explicitly named.  Both 'ON DELETE' and 'ON UPDATE'
     actions on foreign keys.  For more detailed information and
     examples, see *note create-table-foreign-keys::.

     For other storage engines, MySQL Server parses and ignores the
     'FOREIGN KEY' and 'REFERENCES' syntax in *note 'CREATE TABLE':
     create-table. statements.  See *note ansi-diff-foreign-keys::.

     *Important*:

     For users familiar with the ANSI/ISO SQL Standard, please note that
     no storage engine, including 'InnoDB', recognizes or enforces the
     'MATCH' clause used in referential integrity constraint
     definitions.  Use of an explicit 'MATCH' clause will not have the
     specified effect, and also causes 'ON DELETE' and 'ON UPDATE'
     clauses to be ignored.  For these reasons, specifying 'MATCH'
     should be avoided.

     The 'MATCH' clause in the SQL standard controls how 'NULL' values
     in a composite (multiple-column) foreign key are handled when
     comparing to a primary key.  'InnoDB' essentially implements the
     semantics defined by 'MATCH SIMPLE', which permit a foreign key to
     be all or partially 'NULL'.  In that case, the (child table) row
     containing such a foreign key is permitted to be inserted, and does
     not match any row in the referenced (parent) table.  It is possible
     to implement other semantics using triggers.

     Additionally, MySQL requires that the referenced columns be indexed
     for performance.  However, 'InnoDB' does not enforce any
     requirement that the referenced columns be declared 'UNIQUE' or
     'NOT NULL'.  The handling of foreign key references to nonunique
     keys or keys that contain 'NULL' values is not well defined for
     operations such as 'UPDATE' or 'DELETE CASCADE'.  You are advised
     to use foreign keys that reference only keys that are both 'UNIQUE'
     (or 'PRIMARY') and 'NOT NULL'.

     MySQL parses but ignores 'inline 'REFERENCES' specifications' (as
     defined in the SQL standard) where the references are defined as
     part of the column specification.  MySQL accepts 'REFERENCES'
     clauses only when specified as part of a separate 'FOREIGN KEY'
     specification.

   * 'REFERENCE_OPTION'

     For information about the 'RESTRICT', 'CASCADE', 'SET NULL', 'NO
     ACTION', and 'SET DEFAULT' options, see *note
     create-table-foreign-keys::.

*Table Options*

Table options are used to optimize the behavior of the table.  In most
cases, you do not have to specify any of them.  These options apply to
all storage engines unless otherwise indicated.  Options that do not
apply to a given storage engine may be accepted and remembered as part
of the table definition.  Such options then apply if you later use *note
'ALTER TABLE': alter-table. to convert the table to use a different
storage engine.

   * 'ENGINE'

     Specifies the storage engine for the table, using one of the names
     shown in the following table.  The engine name can be unquoted or
     quoted.  The quoted name ''DEFAULT'' is equivalent to specifying
     the default storage engine name.

     Storage Engine     Description
                        
     'InnoDB'           Transaction-safe tables with row locking and
                        foreign keys.  The default storage engine for
                        new tables.  See *note innodb-storage-engine::,
                        and in particular *note innodb-introduction:: if
                        you have MySQL experience but are new to
                        'InnoDB'.
                        
     'MyISAM'           The binary portable storage engine that is
                        primarily used for read-only or read-mostly
                        workloads.  See *note myisam-storage-engine::.
                        
     'MEMORY'           The data for this storage engine is stored only
                        in memory.  See *note memory-storage-engine::.
                        
     'CSV'              Tables that store rows in comma-separated values
                        format.  See *note csv-storage-engine::.
                        
     'ARCHIVE'          The archiving storage engine.  See
                        *note archive-storage-engine::.
                        
     'EXAMPLE'          An example engine.  See
                        *note example-storage-engine::.
                        
     'FEDERATED'        Storage engine that accesses remote tables.  See
                        *note federated-storage-engine::.
                        
     'HEAP'             This is a synonym for 'MEMORY'.
                        
     'MERGE'            A collection of 'MyISAM' tables used as one
                        table.  Also known as 'MRG_MyISAM'.  See
                        *note merge-storage-engine::.
                        
     *note 'NDBCLUSTER': mysql-cluster.Clustered, fault-tolerant, memory-based tables.
                        Also known as *note 'NDB': mysql-cluster.  See
                        *note mysql-cluster::.

     If a storage engine is specified that is not available, MySQL uses
     the default engine instead.  Normally, this is 'MyISAM'.  For
     example, if a table definition includes the 'ENGINE=INNODB' option
     but the MySQL server does not support 'INNODB' tables, the table is
     created as a 'MyISAM' table.  This makes it possible to have a
     replication setup where you have transactional tables on the master
     but tables created on the slave are nontransactional (to get more
     speed).  In MySQL 5.5, a warning occurs if the storage engine
     specification is not honored.

     Engine substitution can be controlled by the setting of the
     'NO_ENGINE_SUBSTITUTION' SQL mode, as described in *note
     sql-mode::.

     *Note*:

     The older 'TYPE' option was synonymous with 'ENGINE'.  'TYPE' was
     deprecated in MySQL 4.0 and removed in MySQL 5.5.  _When upgrading
     to MySQL 5.5 or later, you must convert existing applications that
     rely on 'TYPE' to use 'ENGINE' instead_.

   * 'AUTO_INCREMENT'

     The initial 'AUTO_INCREMENT' value for the table.  In MySQL 5.5,
     this works for 'MyISAM', 'MEMORY', 'InnoDB', and 'ARCHIVE' tables.
     To set the first auto-increment value for engines that do not
     support the 'AUTO_INCREMENT' table option, insert a 'dummy' row
     with a value one less than the desired value after creating the
     table, and then delete the dummy row.

     For engines that support the 'AUTO_INCREMENT' table option in *note
     'CREATE TABLE': create-table. statements, you can also use 'ALTER
     TABLE TBL_NAME AUTO_INCREMENT = N' to reset the 'AUTO_INCREMENT'
     value.  The value cannot be set lower than the maximum value
     currently in the column.

   * 'AVG_ROW_LENGTH'

     An approximation of the average row length for your table.  You
     need to set this only for large tables with variable-size rows.

     When you create a 'MyISAM' table, MySQL uses the product of the
     'MAX_ROWS' and 'AVG_ROW_LENGTH' options to decide how big the
     resulting table is.  If you don't specify either option, the
     maximum size for 'MyISAM' data and index files is 256TB by default.
     (If your operating system does not support files that large, table
     sizes are constrained by the file size limit.)  If you want to keep
     down the pointer sizes to make the index smaller and faster and you
     don't really need big files, you can decrease the default pointer
     size by setting the 'myisam_data_pointer_size' system variable.
     (See *note server-system-variables::.)  If you want all your tables
     to be able to grow above the default limit and are willing to have
     your tables slightly slower and larger than necessary, you can
     increase the default pointer size by setting this variable.
     Setting the value to 7 permits table sizes up to 65,536TB.

   * '[DEFAULT] CHARACTER SET'

     Specifies a default character set for the table.  'CHARSET' is a
     synonym for 'CHARACTER SET'.  If the character set name is
     'DEFAULT', the database character set is used.

   * 'CHECKSUM'

     Set this to 1 if you want MySQL to maintain a live checksum for all
     rows (that is, a checksum that MySQL updates automatically as the
     table changes).  This makes the table a little slower to update,
     but also makes it easier to find corrupted tables.  The *note
     'CHECKSUM TABLE': checksum-table. statement reports the checksum.
     ('MyISAM' only.)

   * '[DEFAULT] COLLATE'

     Specifies a default collation for the table.

   * 'COMMENT'

     A comment for the table, up to 2048 characters long (60 characters
     before MySQL 5.5.3).

   * 'CONNECTION'

     The connection string for a 'FEDERATED' table.

     *Note*:

     Older versions of MySQL used a 'COMMENT' option for the connection
     string.

   * 'DATA DIRECTORY', 'INDEX DIRECTORY'

     By using 'DATA DIRECTORY='DIRECTORY'' or 'INDEX
     DIRECTORY='DIRECTORY'' you can specify where the 'MyISAM' storage
     engine should put a table's data file and index file.  The
     directory must be the full path name to the directory, not a
     relative path.

     As of MySQL 5.5.54, you must have the 'FILE' privilege to use the
     'DATA DIRECTORY' or 'INDEX DIRECTORY' table option.

     *Important*:

     Table-level 'DATA DIRECTORY' and 'INDEX DIRECTORY' options are
     ignored for partitioned tables.  (Bug #32091)

     These options work only when you are not using the
     '--skip-symbolic-links' option.  Your operating system must also
     have a working, thread-safe 'realpath()' call.  See *note
     symbolic-links-to-tables::, for more complete information.

     If a 'MyISAM' table is created with no 'DATA DIRECTORY' option, the
     '.MYD' file is created in the database directory.  By default, if
     'MyISAM' finds an existing '.MYD' file in this case, it overwrites
     it.  The same applies to '.MYI' files for tables created with no
     'INDEX DIRECTORY' option.  To suppress this behavior, start the
     server with the '--keep_files_on_create' option, in which case
     'MyISAM' will not overwrite existing files and returns an error
     instead.

     If a 'MyISAM' table is created with a 'DATA DIRECTORY' or 'INDEX
     DIRECTORY' option and an existing '.MYD' or '.MYI' file is found,
     MyISAM always returns an error.  It will not overwrite a file in
     the specified directory.

     *Important*:

     You cannot use path names that contain the MySQL data directory
     with 'DATA DIRECTORY' or 'INDEX DIRECTORY'.  This includes
     partitioned tables and individual table partitions.  (See Bug
     #32167.)

   * 'DELAY_KEY_WRITE'

     Set this to 1 if you want to delay key updates for the table until
     the table is closed.  See the description of the 'delay_key_write'
     system variable in *note server-system-variables::.  ('MyISAM'
     only.)

   * 'INSERT_METHOD'

     If you want to insert data into a 'MERGE' table, you must specify
     with 'INSERT_METHOD' the table into which the row should be
     inserted.  'INSERT_METHOD' is an option useful for 'MERGE' tables
     only.  Use a value of 'FIRST' or 'LAST' to have inserts go to the
     first or last table, or a value of 'NO' to prevent inserts.  See
     *note merge-storage-engine::.

   * 'KEY_BLOCK_SIZE'

     For *note 'MyISAM': myisam-storage-engine. tables, 'KEY_BLOCK_SIZE'
     optionally specifies the size in bytes to use for index key blocks.
     The value is treated as a hint; a different size could be used if
     necessary.  A 'KEY_BLOCK_SIZE' value specified for an individual
     index definition overrides the table-level 'KEY_BLOCK_SIZE' value.

     For *note 'InnoDB': innodb-storage-engine. tables, 'KEY_BLOCK_SIZE'
     specifies the page size in kilobytes to use for compressed 'InnoDB'
     tables.  The 'KEY_BLOCK_SIZE' value is treated as a hint; a
     different size could be used by 'InnoDB' if necessary.  Valid
     'KEY_BLOCK_SIZE' values include 0, 1, 2, 4, 8, and 16.  A value of
     0 represents the default compressed page size, which is half of the
     'InnoDB' page size.

     Oracle recommends enabling 'innodb_strict_mode' when specifying
     'KEY_BLOCK_SIZE' for 'InnoDB' tables.  When 'innodb_strict_mode' is
     enabled, specifying an invalid 'KEY_BLOCK_SIZE' value returns an
     error.  If 'innodb_strict_mode' is disabled, an invalid
     'KEY_BLOCK_SIZE' value results in a warning, and the
     'KEY_BLOCK_SIZE' option is ignored.

     The 'Create_options' column in response to *note 'SHOW TABLE
     STATUS': show-table-status. reports the originally specified
     'KEY_BLOCK_SIZE' option, as does *note 'SHOW CREATE TABLE':
     show-create-table.

     'InnoDB' only supports 'KEY_BLOCK_SIZE' at the table level.

   * 'MAX_ROWS'

     The maximum number of rows you plan to store in the table.  This is
     not a hard limit, but rather a hint to the storage engine that the
     table must be able to store at least this many rows.

     The *note 'NDB': mysql-cluster. storage engine treats this value as
     a maximum.  If you plan to create very large NDB Cluster tables
     (containing millions of rows), you should use this option to insure
     that *note 'NDB': mysql-cluster. allocates sufficient number of
     index slots in the hash table used for storing hashes of the
     table's primary keys by setting 'MAX_ROWS = 2 * ROWS', where ROWS
     is the number of rows that you expect to insert into the table.

     The maximum 'MAX_ROWS' value is 4294967295; larger values are
     truncated to this limit.

   * 'MIN_ROWS'

     The minimum number of rows you plan to store in the table.  The
     *note 'MEMORY': memory-storage-engine. storage engine uses this
     option as a hint about memory use.

   * 'PACK_KEYS'

     Takes effect only with 'MyISAM' tables.  Set this option to 1 if
     you want to have smaller indexes.  This usually makes updates
     slower and reads faster.  Setting the option to 0 disables all
     packing of keys.  Setting it to 'DEFAULT' tells the storage engine
     to pack only long *note 'CHAR': char, *note 'VARCHAR': char, *note
     'BINARY': binary-varbinary, or *note 'VARBINARY': binary-varbinary.
     columns.

     If you do not use 'PACK_KEYS', the default is to pack strings, but
     not numbers.  If you use 'PACK_KEYS=1', numbers are packed as well.

     When packing binary number keys, MySQL uses prefix compression:

        * Every key needs one extra byte to indicate how many bytes of
          the previous key are the same for the next key.

        * The pointer to the row is stored in high-byte-first order
          directly after the key, to improve compression.

     This means that if you have many equal keys on two consecutive
     rows, all following 'same' keys usually only take two bytes
     (including the pointer to the row).  Compare this to the ordinary
     case where the following keys takes 'storage_size_for_key +
     pointer_size' (where the pointer size is usually 4).  Conversely,
     you get a significant benefit from prefix compression only if you
     have many numbers that are the same.  If all keys are totally
     different, you use one byte more per key, if the key is not a key
     that can have 'NULL' values.  (In this case, the packed key length
     is stored in the same byte that is used to mark if a key is
     'NULL'.)

   * 'PASSWORD'

     This option is unused.  If you have a need to scramble your '.frm'
     files and make them unusable to any other MySQL server, please
     contact our sales department.

   * 'ROW_FORMAT'

     Defines the physical format in which the rows are stored.

     When executing a *note 'CREATE TABLE': create-table. statement with
     strict mode disabled, if you specify a row format that is not
     supported by the storage engine that is used for the table, the
     table is created using that storage engine's default row format.
     The information reported in the 'Row_format' column in response to
     *note 'SHOW TABLE STATUS': show-table-status. is the actual row
     format used.  This may differ from the value in the
     'Create_options' column because the original *note 'CREATE TABLE':
     create-table. definition is retained during creation.  *note 'SHOW
     CREATE TABLE': show-create-table. also reports the row format used
     in the original *note 'CREATE TABLE': create-table. statement.

     Row format choices differ depending on the storage engine used for
     the table.

     For 'InnoDB' tables:

        * Rows are stored in compact format ('ROW_FORMAT=COMPACT') by
          default.

        * The noncompact format used in older versions of MySQL can
          still be requested by specifying 'ROW_FORMAT=REDUNDANT'.

        * To enable compression for 'InnoDB' tables, specify
          'ROW_FORMAT=COMPRESSED' and follow the procedures in *note
          innodb-compression::.

        * For more efficient 'InnoDB' storage of data types, especially
          *note 'BLOB': blob. types, specify 'ROW_FORMAT=DYNAMIC' and
          follow the procedures in *note innodb-row-format-dynamic::.
          Both the 'COMPRESSED' and 'DYNAMIC' row formats require
          creating the table with the configuration settings
          'innodb_file_per_table=1' and 'innodb_file_format=barracuda'.

        * When you specify a non-default 'ROW_FORMAT' clause, consider
          also enabling the 'innodb_strict_mode' configuration option.

        * 'ROW_FORMAT=FIXED' is not supported.  If 'ROW_FORMAT=FIXED' is
          specified while 'innodb_strict_mode' is disabled, 'InnoDB'
          issues a warning and assumes 'ROW_FORMAT=COMPACT'.  If
          'ROW_FORMAT=FIXED' is specified while 'innodb_strict_mode' is
          enabled, 'InnoDB' returns an error.

        * For additional information about 'InnoDB' row formats, see
          *note innodb-row-format::.

     For 'MyISAM' tables, the option value can be 'FIXED' or 'DYNAMIC'
     for static or variable-length row format.  *note 'myisampack':
     myisampack. sets the type to 'COMPRESSED'.  See *note
     myisam-table-formats::.

   * 'TABLESPACE'

     The 'TABLESPACE' and 'STORAGE' table options are employed only with
     *note 'NDBCLUSTER': mysql-cluster. tables.  The tablespace named
     TABLESPACE_NAME must already have been created using *note 'CREATE
     TABLESPACE': create-tablespace.  'STORAGE' determines the type of
     storage used (disk or memory), and can be either 'DISK' or
     'MEMORY'.

     'TABLESPACE ... STORAGE DISK' assigns a table to an NDB Cluster
     Disk Data tablespace.  See *note mysql-cluster-disk-data::, for
     more information.

     *Important*:

     A 'STORAGE' clause cannot be used in a *note 'CREATE TABLE':
     create-table. statement without a 'TABLESPACE' clause.

   * *note 'UNION': union.

     Used to access a collection of identical 'MyISAM' tables as one.
     This works only with 'MERGE' tables.  See *note
     merge-storage-engine::.

     You must have 'SELECT', 'UPDATE', and 'DELETE' privileges for the
     tables you map to a 'MERGE' table.

     *Note*:

     Formerly, all tables used had to be in the same database as the
     'MERGE' table itself.  This restriction no longer applies.

*Table Partitioning*

PARTITION_OPTIONS can be used to control partitioning of the table
created with *note 'CREATE TABLE': create-table.

Not all options shown in the syntax for PARTITION_OPTIONS at the
beginning of this section are available for all partitioning types.
Please see the listings for the following individual types for
information specific to each type, and see *note partitioning::, for
more complete information about the workings of and uses for
partitioning in MySQL, as well as additional examples of table creation
and other statements relating to MySQL partitioning.

   * 'PARTITION BY'

     If used, a PARTITION_OPTIONS clause begins with 'PARTITION BY'.
     This clause contains the function that is used to determine the
     partition; the function returns an integer value ranging from 1 to
     NUM, where NUM is the number of partitions.  (The maximum number of
     user-defined partitions which a table may contain is 1024; the
     number of subpartitions--discussed later in this section--is
     included in this maximum.)

     Partitions can be modified, merged, added to tables, and dropped
     from tables.  For basic information about the MySQL statements to
     accomplish these tasks, see *note alter-table::.  For more detailed
     descriptions and examples, see *note partitioning-management::.

     *Note*:

     The expression (EXPR) used in a 'PARTITION BY' clause cannot refer
     to any columns not in the table being created; such references are
     specifically not permitted and cause the statement to fail with an
     error.  (Bug #29444)

   * 'HASH(EXPR)'

     Hashes one or more columns to create a key for placing and locating
     rows.  EXPR is an expression using one or more table columns.  This
     can be any valid MySQL expression (including MySQL functions) that
     yields a single integer value.  For example, these are both valid
     *note 'CREATE TABLE': create-table. statements using 'PARTITION BY
     HASH':

          CREATE TABLE t1 (col1 INT, col2 CHAR(5))
              PARTITION BY HASH(col1);

          CREATE TABLE t1 (col1 INT, col2 CHAR(5), col3 DATETIME)
              PARTITION BY HASH ( YEAR(col3) );

     You may not use either 'VALUES LESS THAN' or 'VALUES IN' clauses
     with 'PARTITION BY HASH'.

     'PARTITION BY HASH' uses the remainder of EXPR divided by the
     number of partitions (that is, the modulus).  For examples and
     additional information, see *note partitioning-hash::.

     The 'LINEAR' keyword entails a somewhat different algorithm.  In
     this case, the number of the partition in which a row is stored is
     calculated as the result of one or more logical 'AND' operations.
     For discussion and examples of linear hashing, see *note
     partitioning-linear-hash::.

   * 'KEY [ALGORITHM={1|2}] (COLUMN_LIST)': This is similar to 'HASH',
     except that MySQL supplies the hashing function so as to guarantee
     an even data distribution.  The COLUMN_LIST argument is simply a
     list of 1 or more table columns (maximum: 16).  This example shows
     a simple table partitioned by key, with 4 partitions:

          CREATE TABLE tk (col1 INT, col2 CHAR(5), col3 DATE)
              PARTITION BY KEY(col3)
              PARTITIONS 4;

     For tables that are partitioned by key, you can employ linear
     partitioning by using the 'LINEAR' keyword.  This has the same
     effect as with tables that are partitioned by 'HASH'.  That is, the
     partition number is found using the '&' operator rather than the
     modulus (see *note partitioning-linear-hash::, and *note
     partitioning-key::, for details).  This example uses linear
     partitioning by key to distribute data between 5 partitions:

          CREATE TABLE tk (col1 INT, col2 CHAR(5), col3 DATE)
              PARTITION BY LINEAR KEY(col3)
              PARTITIONS 5;

     The 'ALGORITHM={1|2}' option is supported with '[SUB]PARTITION BY
     [LINEAR] KEY' beginning with MySQL 5.5.31.  'ALGORITHM=1' causes
     the server to use the same key-hashing functions as MySQL 5.1;
     'ALGORITHM=2' means that the server employs the key-hashing
     functions implemented and used by default for new 'KEY' partitioned
     tables in MySQL 5.5 and later.  (Partitioned tables created with
     the key-hashing functions employed in MySQL 5.5 and later cannot be
     used by a MySQL 5.1 server.)  Not specifying the option has the
     same effect as using 'ALGORITHM=2'.  This option is intended for
     use chiefly when upgrading or downgrading '[LINEAR] KEY'
     partitioned tables between MySQL 5.1 and later MySQL versions, or
     for creating tables partitioned by 'KEY' or 'LINEAR KEY' on a MySQL
     5.5 or later server which can be used on a MySQL 5.1 server.  For
     more information, see *note alter-table-partition-operations::.

     *note 'mysqldump': mysqldump. in MySQL 5.5.31 and later writes this
     option encased in versioned comments, like this:

          CREATE TABLE t1 (a INT)
          /*!50100 PARTITION BY KEY */ _/*!50531 ALGORITHM = 1 */_ /*!50100 ()
                PARTITIONS 3 */

     This causes MySQL 5.5.30 and earlier servers to ignore the option,
     which would otherwise cause a syntax error in those versions.  If
     you plan to load a dump made on a MySQL 5.5.31 or later MySQL 5.5
     server where you use tables that are partitioned or subpartitioned
     by 'KEY' into a MySQL 5.6 server previous to version 5.6.11, be
     sure to consult Changes in MySQL 5.6
     (https://dev.mysql.com/doc/refman/5.6/en/upgrading-from-previous-series.html),
     before proceeding.  (The information found there also applies if
     you are loading a dump containing 'KEY' partitioned or
     subpartitioned tables made from a MySQL 5.6.11 or later server into
     a MySQL 5.5.30 or earlier server.)

     Also in MySQL 5.5.31 and later, 'ALGORITHM=1' is shown when
     necessary in the output of *note 'SHOW CREATE TABLE':
     show-create-table. using versioned comments in the same manner as
     *note 'mysqldump': mysqldump.  'ALGORITHM=2' is always omitted from
     'SHOW CREATE TABLE' output, even if this option was specified when
     creating the original table.

     You may not use either 'VALUES LESS THAN' or 'VALUES IN' clauses
     with 'PARTITION BY KEY'.

   * 'RANGE(EXPR)'

     In this case, EXPR shows a range of values using a set of 'VALUES
     LESS THAN' operators.  When using range partitioning, you must
     define at least one partition using 'VALUES LESS THAN'.  You cannot
     use 'VALUES IN' with range partitioning.

     *Note*:

     For tables partitioned by 'RANGE', 'VALUES LESS THAN' must be used
     with either an integer literal value or an expression that
     evaluates to a single integer value.  In MySQL 5.5, you can
     overcome this limitation in a table that is defined using
     'PARTITION BY RANGE COLUMNS', as described later in this section.

     Suppose that you have a table that you wish to partition on a
     column containing year values, according to the following scheme.

     Partition Number:             Years Range:
                                   
     0                             1990 and earlier
                                   
     1                             1991 to 1994
                                   
     2                             1995 to 1998
                                   
     3                             1999 to 2002
                                   
     4                             2003 to 2005
                                   
     5                             2006 and later

     A table implementing such a partitioning scheme can be realized by
     the *note 'CREATE TABLE': create-table. statement shown here:

          CREATE TABLE t1 (
              year_col  INT,
              some_data INT
          )
          PARTITION BY RANGE (year_col) (
              PARTITION p0 VALUES LESS THAN (1991),
              PARTITION p1 VALUES LESS THAN (1995),
              PARTITION p2 VALUES LESS THAN (1999),
              PARTITION p3 VALUES LESS THAN (2002),
              PARTITION p4 VALUES LESS THAN (2006),
              PARTITION p5 VALUES LESS THAN MAXVALUE
          );

     'PARTITION ... VALUES LESS THAN ...' statements work in a
     consecutive fashion.  'VALUES LESS THAN MAXVALUE' works to specify
     'leftover' values that are greater than the maximum value otherwise
     specified.

     'VALUES LESS THAN' clauses work sequentially in a manner similar to
     that of the 'case' portions of a 'switch ... case' block (as found
     in many programming languages such as C, Java, and PHP). That is,
     the clauses must be arranged in such a way that the upper limit
     specified in each successive 'VALUES LESS THAN' is greater than
     that of the previous one, with the one referencing 'MAXVALUE'
     coming last of all in the list.

   * 'RANGE COLUMNS(COLUMN_LIST)'

     This variant on 'RANGE' was introduced in MySQL 5.5.0 to facilitate
     partition pruning for queries using range conditions on multiple
     columns (that is, having conditions such as 'WHERE a = 1 AND b <
     10' or 'WHERE a = 1 AND b = 10 AND c < 10').  It enables you to
     specify value ranges in multiple columns by using a list of columns
     in the 'COLUMNS' clause and a set of column values in each
     'PARTITION ... VALUES LESS THAN (VALUE_LIST)' partition definition
     clause.  (In the simplest case, this set consists of a single
     column.)  The maximum number of columns that can be referenced in
     the COLUMN_LIST and VALUE_LIST is 16.

     The COLUMN_LIST used in the 'COLUMNS' clause may contain only names
     of columns; each column in the list must be one of the following
     MySQL data types: the integer types; the string types; and time or
     date column types.  Columns using 'BLOB', 'TEXT', 'SET', 'ENUM',
     'BIT', or spatial data types are not permitted; columns that use
     floating-point number types are also not permitted.  You also may
     not use functions or arithmetic expressions in the 'COLUMNS'
     clause.

     The 'VALUES LESS THAN' clause used in a partition definition must
     specify a literal value for each column that appears in the
     'COLUMNS()' clause; that is, the list of values used for each
     'VALUES LESS THAN' clause must contain the same number of values as
     there are columns listed in the 'COLUMNS' clause.  An attempt to
     use more or fewer values in a 'VALUES LESS THAN' clause than there
     are in the 'COLUMNS' clause causes the statement to fail with the
     error 'Inconsistency in usage of column lists for partitioning...'.
     You cannot use 'NULL' for any value appearing in 'VALUES LESS
     THAN'.  It is possible to use 'MAXVALUE' more than once for a given
     column other than the first, as shown in this example:

          CREATE TABLE rc (
              a INT NOT NULL,
              b INT NOT NULL
          )
          PARTITION BY RANGE COLUMNS(a,b) (
              PARTITION p0 VALUES LESS THAN (10,5),
              PARTITION p1 VALUES LESS THAN (20,10),
              PARTITION p2 VALUES LESS THAN (50,MAXVALUE),
              PARTITION p3 VALUES LESS THAN (65,MAXVALUE),
              PARTITION p4 VALUES LESS THAN (MAXVALUE,MAXVALUE)
          );

     Each value used in a 'VALUES LESS THAN' value list must match the
     type of the corresponding column exactly; no conversion is made.
     For example, you cannot use the string ''1'' for a value that
     matches a column that uses an integer type (you must use the
     numeral '1' instead), nor can you use the numeral '1' for a value
     that matches a column that uses a string type (in such a case, you
     must use a quoted string: ''1'').

     For more information, see *note partitioning-range::, and *note
     partitioning-pruning::.

   * 'LIST(EXPR)'

     This is useful when assigning partitions based on a table column
     with a restricted set of possible values, such as a state or
     country code.  In such a case, all rows pertaining to a certain
     state or country can be assigned to a single partition, or a
     partition can be reserved for a certain set of states or countries.
     It is similar to 'RANGE', except that only 'VALUES IN' may be used
     to specify permissible values for each partition.

     'VALUES IN' is used with a list of values to be matched.  For
     instance, you could create a partitioning scheme such as the
     following:

          CREATE TABLE client_firms (
              id   INT,
              name VARCHAR(35)
          )
          PARTITION BY LIST (id) (
              PARTITION r0 VALUES IN (1, 5, 9, 13, 17, 21),
              PARTITION r1 VALUES IN (2, 6, 10, 14, 18, 22),
              PARTITION r2 VALUES IN (3, 7, 11, 15, 19, 23),
              PARTITION r3 VALUES IN (4, 8, 12, 16, 20, 24)
          );

     When using list partitioning, you must define at least one
     partition using 'VALUES IN'.  You cannot use 'VALUES LESS THAN'
     with 'PARTITION BY LIST'.

     *Note*:

     For tables partitioned by 'LIST', the value list used with 'VALUES
     IN' must consist of integer values only.  In MySQL 5.5, you can
     overcome this limitation using partitioning by 'LIST COLUMNS',
     which is described later in this section.

   * 'LIST COLUMNS(COLUMN_LIST)'

     This variant on 'LIST' was introduced in MySQL 5.5.0 to facilitate
     partition pruning for queries using comparison conditions on
     multiple columns (that is, having conditions such as 'WHERE a = 5
     AND b = 5' or 'WHERE a = 1 AND b = 10 AND c = 5').  It enables you
     to specify values in multiple columns by using a list of columns in
     the 'COLUMNS' clause and a set of column values in each 'PARTITION
     ... VALUES IN (VALUE_LIST)' partition definition clause.

     The rules governing regarding data types for the column list used
     in 'LIST COLUMNS(COLUMN_LIST)' and the value list used in 'VALUES
     IN(VALUE_LIST)' are the same as those for the column list used in
     'RANGE COLUMNS(COLUMN_LIST)' and the value list used in 'VALUES
     LESS THAN(VALUE_LIST)', respectively, except that in the 'VALUES
     IN' clause, 'MAXVALUE' is not permitted, and you may use 'NULL'.

     There is one important difference between the list of values used
     for 'VALUES IN' with 'PARTITION BY LIST COLUMNS' as opposed to when
     it is used with 'PARTITION BY LIST'.  When used with 'PARTITION BY
     LIST COLUMNS', each element in the 'VALUES IN' clause must be a
     _set_ of column values; the number of values in each set must be
     the same as the number of columns used in the 'COLUMNS' clause, and
     the data types of these values must match those of the columns (and
     occur in the same order).  In the simplest case, the set consists
     of a single column.  The maximum number of columns that can be used
     in the COLUMN_LIST and in the elements making up the VALUE_LIST is
     16.

     The table defined by the following 'CREATE TABLE' statement
     provides an example of a table using 'LIST COLUMNS' partitioning:

          CREATE TABLE lc (
              a INT NULL,
              b INT NULL
          )
          PARTITION BY LIST COLUMNS(a,b) (
              PARTITION p0 VALUES IN( (0,0), (NULL,NULL) ),
              PARTITION p1 VALUES IN( (0,1), (0,2), (0,3), (1,1), (1,2) ),
              PARTITION p2 VALUES IN( (1,0), (2,0), (2,1), (3,0), (3,1) ),
              PARTITION p3 VALUES IN( (1,3), (2,2), (2,3), (3,2), (3,3) )
          );

   * 'PARTITIONS NUM'

     The number of partitions may optionally be specified with a
     'PARTITIONS NUM' clause, where NUM is the number of partitions.  If
     both this clause _and_ any 'PARTITION' clauses are used, NUM must
     be equal to the total number of any partitions that are declared
     using 'PARTITION' clauses.

     *Note*:

     Whether or not you use a 'PARTITIONS' clause in creating a table
     that is partitioned by 'RANGE' or 'LIST', you must still include at
     least one 'PARTITION VALUES' clause in the table definition (see
     below).

   * 'SUBPARTITION BY'

     A partition may optionally be divided into a number of
     subpartitions.  This can be indicated by using the optional
     'SUBPARTITION BY' clause.  Subpartitioning may be done by 'HASH' or
     'KEY'.  Either of these may be 'LINEAR'.  These work in the same
     way as previously described for the equivalent partitioning types.
     (It is not possible to subpartition by 'LIST' or 'RANGE'.)

     The number of subpartitions can be indicated using the
     'SUBPARTITIONS' keyword followed by an integer value.

   * Rigorous checking of the value used in 'PARTITIONS' or
     'SUBPARTITIONS' clauses is applied and this value must adhere to
     the following rules:

        * The value must be a positive, nonzero integer.

        * No leading zeros are permitted.

        * The value must be an integer literal, and cannot not be an
          expression.  For example, 'PARTITIONS 0.2E+01' is not
          permitted, even though '0.2E+01' evaluates to '2'.  (Bug
          #15890)

   * 'PARTITION_DEFINITION'

     Each partition may be individually defined using a
     PARTITION_DEFINITION clause.  The individual parts making up this
     clause are as follows:

        * 'PARTITION PARTITION_NAME'

          Specifies a logical name for the partition.

        * 'VALUES'

          For range partitioning, each partition must include a 'VALUES
          LESS THAN' clause; for list partitioning, you must specify a
          'VALUES IN' clause for each partition.  This is used to
          determine which rows are to be stored in this partition.  See
          the discussions of partitioning types in *note partitioning::,
          for syntax examples.

        * 'COMMENT'

          An optional 'COMMENT' clause may be used to specify a string
          that describes the partition.  Example:

               COMMENT = 'Data for the years previous to 1999'

        * 'DATA DIRECTORY' and 'INDEX DIRECTORY'

          'DATA DIRECTORY' and 'INDEX DIRECTORY' may be used to indicate
          the directory where, respectively, the data and indexes for
          this partition are to be stored.  Both the 'DATA_DIR' and the
          'INDEX_DIR' must be absolute system path names.

          As of MySQL 5.5.54, you must have the 'FILE' privilege to use
          the 'DATA DIRECTORY' or 'INDEX DIRECTORY' partition option.

          Example:

               CREATE TABLE th (id INT, name VARCHAR(30), adate DATE)
               PARTITION BY LIST(YEAR(adate))
               (
                 PARTITION p1999 VALUES IN (1995, 1999, 2003)
                   DATA DIRECTORY = '/var/appdata/95/data'
                   INDEX DIRECTORY = '/var/appdata/95/idx',
                 PARTITION p2000 VALUES IN (1996, 2000, 2004)
                   DATA DIRECTORY = '/var/appdata/96/data'
                   INDEX DIRECTORY = '/var/appdata/96/idx',
                 PARTITION p2001 VALUES IN (1997, 2001, 2005)
                   DATA DIRECTORY = '/var/appdata/97/data'
                   INDEX DIRECTORY = '/var/appdata/97/idx',
                 PARTITION p2002 VALUES IN (1998, 2002, 2006)
                   DATA DIRECTORY = '/var/appdata/98/data'
                   INDEX DIRECTORY = '/var/appdata/98/idx'
               );

          'DATA DIRECTORY' and 'INDEX DIRECTORY' behave in the same way
          as in the *note 'CREATE TABLE': create-table. statement's
          TABLE_OPTION clause as used for 'MyISAM' tables.

          One data directory and one index directory may be specified
          per partition.  If left unspecified, the data and indexes are
          stored by default in the table's database directory.

          On Windows, the 'DATA DIRECTORY' and 'INDEX DIRECTORY' options
          are not supported for individual partitions or subpartitions.
          These options are ignored on Windows, except that a warning is
          generated.  (Bug #30459)

          *Note*:

          The 'DATA DIRECTORY' and 'INDEX DIRECTORY' options are ignored
          for creating partitioned tables if 'NO_DIR_IN_CREATE' is in
          effect.  (Bug #24633)

        * 'MAX_ROWS' and 'MIN_ROWS'

          May be used to specify, respectively, the maximum and minimum
          number of rows to be stored in the partition.  The values for
          MAX_NUMBER_OF_ROWS and MIN_NUMBER_OF_ROWS must be positive
          integers.  As with the table-level options with the same
          names, these act only as 'suggestions' to the server and are
          not hard limits.

        * 'TABLESPACE'

          The optional 'TABLESPACE' clause may be used to designate a
          tablespace for the partition.  Used for NDB Cluster only.

        * '[STORAGE] ENGINE'

          The partitioning handler accepts a '[STORAGE] ENGINE' option
          for both 'PARTITION' and 'SUBPARTITION'.  Currently, the only
          way in which this can be used is to set all partitions or all
          subpartitions to the same storage engine, and an attempt to
          set different storage engines for partitions or subpartitions
          in the same table will give rise to the error 'ERROR 1469
          (HY000): The mix of handlers in the partitions is not
          permitted in this version of MySQL'.  We expect to lift this
          restriction on partitioning in a future MySQL release.

        * 'NODEGROUP'

          The 'NODEGROUP' option can be used to make this partition act
          as part of the node group identified by NODE_GROUP_ID.  This
          option is applicable only to NDB Cluster.

   * 'SUBPARTITION_DEFINITION'

     The partition definition may optionally contain one or more
     SUBPARTITION_DEFINITION clauses.  Each of these consists at a
     minimum of the 'SUBPARTITION NAME', where NAME is an identifier for
     the subpartition.  Except for the replacement of the 'PARTITION'
     keyword with 'SUBPARTITION', the syntax for a subpartition
     definition is identical to that for a partition definition.

     Subpartitioning must be done by 'HASH' or 'KEY', and can be done
     only on 'RANGE' or 'LIST' partitions.  See *note
     partitioning-subpartitions::.


File: manual.info.tmp,  Node: create-table-statement-retention,  Next: create-table-files,  Prev: create-table,  Up: create-table

13.1.17.1 CREATE TABLE Statement Retention
..........................................

The original *note 'CREATE TABLE': create-table. statement, including
all specifications and table options are stored by MySQL when the table
is created.  The information is retained so that if you change storage
engines, collations or other settings using an *note 'ALTER TABLE':
alter-table. statement, the original table options specified are
retained.  This enables you to change between *note 'InnoDB':
innodb-storage-engine. and *note 'MyISAM': myisam-storage-engine. table
types even though the row formats supported by the two engines are
different.

Because the text of the original statement is retained, but due to the
way that certain values and options may be silently reconfigured (such
as the 'ROW_FORMAT'), the active table definition (accessible through
*note 'DESCRIBE': describe. or with *note 'SHOW TABLE STATUS':
show-table-status.) and the table creation string (accessible through
*note 'SHOW CREATE TABLE': show-create-table.) will report different
values.


File: manual.info.tmp,  Node: create-table-files,  Next: create-temporary-table,  Prev: create-table-statement-retention,  Up: create-table

13.1.17.2 Files Created by CREATE TABLE
.......................................

MySQL represents each table by an '.frm' table format (definition) file
in the database directory.  The storage engine for the table might
create other files as well.

For 'InnoDB' tables, the file storage is controlled by the
'innodb_file_per_table' configuration option.  For each 'InnoDB' table
created when this option is turned on, the table data and all associated
indexes are stored in a .ibd file located inside the database directory.
When this option is turned off, all 'InnoDB' tables and indexes are
stored in the system tablespace, represented by one or more ibdata*
files.

For 'MyISAM' tables, the storage engine creates data and index files.
Thus, for each 'MyISAM' table TBL_NAME, there are three disk files.

File                   Purpose
                       
'TBL_NAME.frm'         Table format (definition) file
                       
'TBL_NAME.MYD'         Data file
                       
'TBL_NAME.MYI'         Index file

*note storage-engines::, describes what files each storage engine
creates to represent tables.  If a table name contains special
characters, the names for the table files contain encoded versions of
those characters as described in *note identifier-mapping::.

*Limits Imposed by .frm File Structure*

As described previously, each table has an '.frm' file that contains the
table definition.  The server uses the following expression to check
some of the table information stored in the file against an upper limit
of 64KB:

     if (info_length+(ulong) create_fields.elements*FCOMP+288+
         n_length+int_length+com_length > 65535L || int_count > 255)

The portion of the information stored in the '.frm' file that is checked
against the expression cannot grow beyond the 64KB limit, so if the
table definition reaches this size, no more columns can be added.

The relevant factors in the expression are:

   * 'info_length' is space needed for 'screens.' This is related to
     MySQL's Unireg heritage.

   * 'create_fields.elements' is the number of columns.

   * 'FCOMP' is 17.

   * 'n_length' is the total length of all column names, including one
     byte per name as a separator.

   * 'int_length' is related to the list of values for *note 'ENUM':
     enum. and *note 'SET': set. columns.  In this context, 'int' does
     not mean 'integer.' It means 'interval,' a term that refers
     collectively to *note 'ENUM': enum. and *note 'SET': set. columns.

   * 'int_count' is the number of unique *note 'ENUM': enum. and *note
     'SET': set. definitions.

   * 'com_length' is the total length of column comments.

The expression just described has several implications for permitted
table definitions:

   * Using long column names can reduce the maximum number of columns,
     as can the inclusion of *note 'ENUM': enum. or *note 'SET': set.
     columns, or use of column comments.

   * A table can have no more than 255 unique *note 'ENUM': enum. and
     *note 'SET': set. definitions.  Columns with identical element
     lists are considered the same against this limt.  For example, if a
     table contains these two columns, they count as one (not two)
     toward this limit because the definitions are identical:

          e1 ENUM('a','b','c')
          e2 ENUM('a','b','c')

   * The sum of the length of element names in the unique *note 'ENUM':
     enum. and *note 'SET': set. definitions counts toward the 64KB
     limit, so although the theoretical limit on number of elements in a
     given *note 'ENUM': enum. column is 65,535, the practical limit is
     less than 3000.


File: manual.info.tmp,  Node: create-temporary-table,  Next: create-table-like,  Prev: create-table-files,  Up: create-table

13.1.17.3 CREATE TEMPORARY TABLE Statement
..........................................

You can use the 'TEMPORARY' keyword when creating a table.  A
'TEMPORARY' table is visible only within the current session, and is
dropped automatically when the session is closed.  This means that two
different sessions can use the same temporary table name without
conflicting with each other or with an existing non-'TEMPORARY' table of
the same name.  (The existing table is hidden until the temporary table
is dropped.)

*note 'CREATE TABLE': create-table. causes an implicit commit, except
when used with the 'TEMPORARY' keyword.  See *note implicit-commit::.

'TEMPORARY' tables have a very loose relationship with databases
(schemas).  Dropping a database does not automatically drop any
'TEMPORARY' tables created within that database.  Also, you can create a
'TEMPORARY' table in a nonexistent database if you qualify the table
name with the database name in the 'CREATE TABLE' statement.  In this
case, all subsequent references to the table must be qualified with the
database name.

To create a temporary table, you must have the 'CREATE TEMPORARY TABLES'
privilege.  However, other operations on a temporary table, such as
*note 'INSERT': insert, *note 'UPDATE': update, or *note 'SELECT':
select, require additional privileges for those operations for the
database containing the temporary table, or for the nontemporary table
of the same name.

To keep privileges for temporary and nontemporary tables separate, a
common workaround for this situation is to create a database dedicated
to the use of temporary tables.  Then for that database, a user can be
granted the 'CREATE TEMPORARY TABLES' privilege, along with any other
privileges required for temporary table operations done by that user.


File: manual.info.tmp,  Node: create-table-like,  Next: create-table-select,  Prev: create-temporary-table,  Up: create-table

13.1.17.4 CREATE TABLE ... LIKE Statement
.........................................

Use 'CREATE TABLE ... LIKE' to create an empty table based on the
definition of another table, including any column attributes and indexes
defined in the original table:

     CREATE TABLE NEW_TBL LIKE ORIG_TBL;

The copy is created using the same version of the table storage format
as the original table.  The 'SELECT' privilege is required on the
original table.

'LIKE' works only for base tables, not for views.

*Important*:

Beginning with MySQL 5.5.3, you cannot execute 'CREATE TABLE' or 'CREATE
TABLE ... LIKE' while a *note 'LOCK TABLES': lock-tables. statement is
in effect.

Also as of MySQL 5.5.3, *note 'CREATE TABLE ... LIKE': create-table.
makes the same checks as *note 'CREATE TABLE': create-table. and does
not just copy the '.frm' file.  This means that if the current SQL mode
is different from the mode in effect when the original table was
created, the table definition might be considered invalid for the new
mode and the statement will fail.

'CREATE TABLE ... LIKE' does not preserve any 'DATA DIRECTORY' or 'INDEX
DIRECTORY' table options that were specified for the original table, or
any foreign key definitions.

If the original table is a 'TEMPORARY' table, 'CREATE TABLE ... LIKE'
does not preserve 'TEMPORARY'.  To create a 'TEMPORARY' destination
table, use 'CREATE TEMPORARY TABLE ... LIKE'.


File: manual.info.tmp,  Node: create-table-select,  Next: create-table-foreign-keys,  Prev: create-table-like,  Up: create-table

13.1.17.5 CREATE TABLE ... SELECT Statement
...........................................

You can create one table from another by adding a *note 'SELECT':
select. statement at the end of the *note 'CREATE TABLE': create-table.
statement:

     CREATE TABLE NEW_TBL [AS] SELECT * FROM ORIG_TBL;

MySQL creates new columns for all elements in the *note 'SELECT':
select.  For example:

     mysql> CREATE TABLE test (a INT NOT NULL AUTO_INCREMENT,
         ->        PRIMARY KEY (a), KEY(b))
         ->        ENGINE=MyISAM SELECT b,c FROM test2;

This creates a *note 'MyISAM': myisam-storage-engine. table with three
columns, 'a', 'b', and 'c'.  The 'ENGINE' option is part of the *note
'CREATE TABLE': create-table. statement, and should not be used
following the *note 'SELECT': select.; this would result in a syntax
error.  The same is true for other *note 'CREATE TABLE': create-table.
options such as 'CHARSET'.

Notice that the columns from the *note 'SELECT': select. statement are
appended to the right side of the table, not overlapped onto it.  Take
the following example:

     mysql> SELECT * FROM foo;
     +---+
     | n |
     +---+
     | 1 |
     +---+

     mysql> CREATE TABLE bar (m INT) SELECT n FROM foo;
     Query OK, 1 row affected (0.02 sec)
     Records: 1  Duplicates: 0  Warnings: 0

     mysql> SELECT * FROM bar;
     +------+---+
     | m    | n |
     +------+---+
     | NULL | 1 |
     +------+---+
     1 row in set (0.00 sec)

For each row in table 'foo', a row is inserted in 'bar' with the values
from 'foo' and default values for the new columns.

In a table resulting from *note 'CREATE TABLE ... SELECT': create-table,
columns named only in the *note 'CREATE TABLE': create-table. part come
first.  Columns named in both parts or only in the *note 'SELECT':
select. part come after that.  The data type of *note 'SELECT': select.
columns can be overridden by also specifying the column in the *note
'CREATE TABLE': create-table. part.

If any errors occur while copying the data to the table, it is
automatically dropped and not created.

You can precede the *note 'SELECT': select. by 'IGNORE' or 'REPLACE' to
indicate how to handle rows that duplicate unique key values.  With
'IGNORE', rows that duplicate an existing row on a unique key value are
discarded.  With 'REPLACE', new rows replace rows that have the same
unique key value.  If neither 'IGNORE' nor 'REPLACE' is specified,
duplicate unique key values result in an error.

Because the ordering of the rows in the underlying *note 'SELECT':
select. statements cannot always be determined, 'CREATE TABLE ... IGNORE
SELECT' and 'CREATE TABLE ... REPLACE SELECT' statements in MySQL 5.5.18
and later are flagged as unsafe for statement-based replication.  With
this change, such statements produce a warning in the error log when
using statement-based mode and are written to the binary log using the
row-based format when using 'MIXED' mode.  See also *note
replication-sbr-rbr::.

*note 'CREATE TABLE ... SELECT': create-table. does not automatically
create any indexes for you.  This is done intentionally to make the
statement as flexible as possible.  If you want to have indexes in the
created table, you should specify these before the *note 'SELECT':
select. statement:

     mysql> CREATE TABLE bar (UNIQUE (n)) SELECT n FROM foo;

Some conversion of data types might occur.  For example, the
'AUTO_INCREMENT' attribute is not preserved, and *note 'VARCHAR': char.
columns can become *note 'CHAR': char. columns.  Retrained attributes
are 'NULL' (or 'NOT NULL') and, for those columns that have them,
'CHARACTER SET', 'COLLATION', 'COMMENT', and the 'DEFAULT' clause.

When creating a table with *note 'CREATE TABLE ... SELECT':
create-table-select, make sure to alias any function calls or
expressions in the query.  If you do not, the 'CREATE' statement might
fail or result in undesirable column names.

     CREATE TABLE artists_and_works
       SELECT artist.name, COUNT(work.artist_id) AS number_of_works
       FROM artist LEFT JOIN work ON artist.id = work.artist_id
       GROUP BY artist.id;

You can also explicitly specify the data type for a column in the
created table:

     CREATE TABLE foo (a TINYINT NOT NULL) SELECT b+1 AS a FROM bar;

For *note 'CREATE TABLE ... SELECT': create-table, if 'IF NOT EXISTS' is
given and the destination table already exists, the result is version
dependent.  Before MySQL 5.5.6, MySQL handles the statement as follows:

   * The table definition given in the *note 'CREATE TABLE':
     create-table. part is ignored.  No error occurs, even if the
     definition does not match that of the existing table.  MySQL
     attempts to insert the rows from the *note 'SELECT': select. part
     anyway.

   * If there is a mismatch between the number of columns in the table
     and the number of columns produced by the *note 'SELECT': select.
     part, the selected values are assigned to the rightmost columns.
     For example, if the table contains N columns and the *note
     'SELECT': select. produces M columns, where M < N, the selected
     values are assigned to the M rightmost columns in the table.  Each
     of the initial N − M columns is assigned its default value,
     either that specified explicitly in the column definition or the
     implicit column data type default if the definition contains no
     default.  If the *note 'SELECT': select. part produces too many
     columns (M > N), an error occurs.

   * If strict SQL mode is enabled and any of these initial columns do
     not have an explicit default value, the statement fails with an
     error.

The following example illustrates 'IF NOT EXISTS' handling:

     mysql> CREATE TABLE t1 (i1 INT DEFAULT 0, i2 INT, i3 INT, i4 INT);
     Query OK, 0 rows affected (0.05 sec)

     mysql> CREATE TABLE IF NOT EXISTS t1 (c1 CHAR(10)) SELECT 1, 2;
     Query OK, 1 row affected, 1 warning (0.01 sec)
     Records: 1  Duplicates: 0  Warnings: 0

     mysql> SELECT * FROM t1;
     +------+------+------+------+
     | i1   | i2   | i3   | i4   |
     +------+------+------+------+
     |    0 | NULL |    1 |    2 |
     +------+------+------+------+
     1 row in set (0.00 sec)

As of MySQL 5.5.6, handling of *note 'CREATE TABLE IF NOT EXISTS ...
SELECT': create-table-select. statements was changed for the case that
the destination table already exists.  This change also involves a
change in MySQL 5.1 beginning with 5.1.51.

   * Previously, for *note 'CREATE TABLE IF NOT EXISTS ... SELECT':
     create-table-select, MySQL produced a warning that the table
     exists, but inserted the rows and wrote the statement to the binary
     log anyway.  By contrast, *note 'CREATE TABLE ... SELECT':
     create-table-select. (without 'IF NOT EXISTS') failed with an
     error, but MySQL inserted no rows and did not write the statement
     to the binary log.

   * MySQL now handles both statements the same way when the destination
     table exists, in that neither statement inserts rows or is written
     to the binary log.  The difference between them is that MySQL
     produces a warning when 'IF NOT EXISTS' is present and an error
     when it is not.

This change means that, for the preceding example, the *note 'CREATE
TABLE IF NOT EXISTS ... SELECT': create-table-select. statement inserts
nothing into the destination table as of MySQL 5.5.6.

This change in handling of 'IF NOT EXISTS' results in an incompatibility
for statement-based replication from a MySQL 5.1 master with the
original behavior and a MySQL 5.5 slave with the new behavior.  Suppose
that *note 'CREATE TABLE IF NOT EXISTS ... SELECT': create-table-select.
is executed on the master and the destination table exists.  The result
is that rows are inserted on the master but not on the slave.
(Row-based replication does not have this problem.)

To address this issue, statement-based binary logging for *note 'CREATE
TABLE IF NOT EXISTS ... SELECT': create-table-select. is changed in
MySQL 5.1 as of 5.1.51:

   * If the destination table does not exist, there is no change: The
     statement is logged as is.

   * If the destination table does exist, the statement is logged as the
     equivalent pair of *note 'CREATE TABLE IF NOT EXISTS':
     create-table-select. and *note 'INSERT ... SELECT': insert-select.
     statements.  (If the *note 'SELECT': select. in the original
     statement is preceded by 'IGNORE' or *note 'REPLACE': replace, the
     *note 'INSERT': insert. becomes *note 'INSERT IGNORE': insert. or
     *note 'REPLACE': replace, respectively.)

This change provides forward compatibility for statement-based
replication from MySQL 5.1 to 5.5 because when the destination table
exists, the rows will be inserted on both the master and slave.  To take
advantage of this compatibility measure, the 5.1 server must be at least
5.1.51 and the 5.5 server must be at least 5.5.6.

To upgrade an existing 5.1-to-5.5 replication scenario, upgrade the
master first to 5.1.51 or higher.  Note that this differs from the usual
replication upgrade advice of upgrading the slave first.

A workaround for applications that wish to achieve the original effect
(rows inserted regardless of whether the destination table exists) is to
use *note 'CREATE TABLE IF NOT EXISTS': create-table-select. and *note
'INSERT ... SELECT': insert-select. statements rather than *note 'CREATE
TABLE IF NOT EXISTS ... SELECT': create-table-select. statements.

Along with the change just described, the following related change was
made: Previously, if an existing view was named as the destination table
for *note 'CREATE TABLE IF NOT EXISTS ... SELECT': create-table-select,
rows were inserted into the underlying base table and the statement was
written to the binary log.  As of MySQL 5.1.51 and 5.5.6, nothing is
inserted or logged.

To ensure that the binary log can be used to re-create the original
tables, MySQL does not permit concurrent inserts during *note 'CREATE
TABLE ... SELECT': create-table.


File: manual.info.tmp,  Node: create-table-foreign-keys,  Next: silent-column-changes,  Prev: create-table-select,  Up: create-table

13.1.17.6 FOREIGN KEY Constraints
.................................

MySQL supports foreign keys, which permit cross-referencing related data
across tables, and foreign key constraints, which help keep the related
data consistent.

A foreign key relationship involves a parent table that holds the
initial column values, and a child table with column values that
reference the parent column values.  A foreign key constraint is defined
on the child table.

The essential syntax for a defining a foreign key constraint in a *note
'CREATE TABLE': create-table. or *note 'ALTER TABLE': alter-table.
statement includes the following:

     [CONSTRAINT [SYMBOL]] FOREIGN KEY
         [INDEX_NAME] (COL_NAME, ...)
         REFERENCES TBL_NAME (COL_NAME,...)
         [ON DELETE REFERENCE_OPTION]
         [ON UPDATE REFERENCE_OPTION]

     REFERENCE_OPTION:
         RESTRICT | CASCADE | SET NULL | NO ACTION | SET DEFAULT

Foreign key constraint usage is described under the following topics in
this section:

   * *note foreign-key-identifiers::

   * *note foreign-key-restrictions::

   * *note foreign-key-referential-actions::

   * *note foreign-key-examples::

   * *note foreign-key-adding::

   * *note foreign-key-dropping::

   * *note foreign-key-checks::

   * *note foreign-key-metadata::

   * *note foreign-key-errors::

*Identifiers*

Foreign key constraint naming is governed by the following rules:

   * The 'CONSTRAINT' SYMBOL value is used, if defined.

   * If the 'CONSTRAINT' SYMBOL clause is not defined, or a symbol is
     not included following the 'CONSTRAINT' keyword, a constraint name
     name is generated automatically.

   * The 'CONSTRAINT SYMBOL' value, if defined, must be unique in the
     database.  A duplicate SYMBOL results in an error similar to:
     'ERROR 1005 (HY000): Can't create table 'test.fk1' (errno: 121)'.

Table and column identifiers in a 'FOREIGN KEY ... REFERENCES' clause
can be quoted within backticks ('`').  Alternatively, double quotation
marks ('"') can be used if the 'ANSI_QUOTES' SQL mode is enabled.  The
'lower_case_table_names' system variable setting is also taken into
account.

*Conditions and Restrictions*

Foreign key constraints are subject to the following conditions and
restrictions:

   * Parent and child tables must use the same storage engine, and they
     cannot be defined as temporary tables.

   * Creating a foreign key constraint requires at least one of the
     'SELECT', 'INSERT', 'UPDATE', 'DELETE', or 'REFERENCES' privileges
     on the parent table as of 5.5.41.

   * Corresponding columns in the foreign key and the referenced key
     must have similar data types.  _The size and sign of integer types
     must be the same_.  The length of string types need not be the
     same.  For nonbinary (character) string columns, the character set
     and collation must be the same.

   * MySQL supports foreign key references between one column and
     another within a table.  (A column cannot have a foreign key
     reference to itself.)  In these cases, a 'child table record'
     refers to a dependent record within the same table.

   * MySQL requires indexes on foreign keys and referenced keys so that
     foreign key checks can be fast and not require a table scan.  In
     the referencing table, there must be an index where the foreign key
     columns are listed as the _first_ columns in the same order.  Such
     an index is created on the referencing table automatically if it
     does not exist.  This index might be silently dropped later if you
     create another index that can be used to enforce the foreign key
     constraint.  INDEX_NAME, if given, is used as described previously.

   * 'InnoDB' permits a foreign key to reference any index column or
     group of columns.  However, in the referenced table, there must be
     an index where the referenced columns are the _first_ columns in
     the same order.  Hidden columns that 'InnoDB' adds to an index are
     also considered (see *note innodb-index-types::).

     'InnoDB' does not require an explicit unique key (or primary key)
     on any column referenced as a foreign key, which is an extension of
     standard SQL.

   * Index prefixes on foreign key columns are not supported.
     Consequently, *note 'BLOB': blob. and *note 'TEXT': blob. columns
     cannot be included in a foreign key because indexes on those
     columns must always include a prefix length.

   * *note 'InnoDB': innodb-storage-engine. does not currently support
     foreign keys for tables with user-defined partitioning.  This
     includes both parent and child tables.

   * A table in a foreign key relationship cannot be altered to use
     another storage engine.  To change the storage engine, you must
     drop any foreign key constraints first.

For information about how the MySQL implementation of foreign key
constraints differs from the SQL standard, see *note
ansi-diff-foreign-keys::.

*Referential Actions*

When an *note 'UPDATE': update. or *note 'DELETE': delete. operation
affects a key value in the parent table that has matching rows in the
child table, the result depends on the _referential action_ specified by
'ON UPDATE' and 'ON DELETE' subclauses of the 'FOREIGN KEY' clause.
Referential actions include:

   * 'CASCADE': Delete or update the row from the parent table and
     automatically delete or update the matching rows in the child
     table.  Both 'ON DELETE CASCADE' and 'ON UPDATE CASCADE' are
     supported.  Between two tables, do not define several 'ON UPDATE
     CASCADE' clauses that act on the same column in the parent table or
     in the child table.

     *Note*:

     Cascaded foreign key actions do not activate triggers.

   * 'SET NULL': Delete or update the row from the parent table and set
     the foreign key column or columns in the child table to 'NULL'.
     Both 'ON DELETE SET NULL' and 'ON UPDATE SET NULL' clauses are
     supported.

     If you specify a 'SET NULL' action, _make sure that you have not
     declared the columns in the child table as 'NOT NULL'_.

   * 'RESTRICT': Rejects the delete or update operation for the parent
     table.  Specifying 'RESTRICT' (or 'NO ACTION') is the same as
     omitting the 'ON DELETE' or 'ON UPDATE' clause.

   * 'NO ACTION': A keyword from standard SQL. In MySQL, equivalent to
     'RESTRICT'.  The MySQL Server rejects the delete or update
     operation for the parent table if there is a related foreign key
     value in the referenced table.  Some database systems have deferred
     checks, and 'NO ACTION' is a deferred check.  In MySQL, foreign key
     constraints are checked immediately, so 'NO ACTION' is the same as
     'RESTRICT'.

   * 'SET DEFAULT': This action is recognized by the MySQL parser, but
     *note 'InnoDB': innodb-storage-engine. rejects table definitions
     containing 'ON DELETE SET DEFAULT' or 'ON UPDATE SET DEFAULT'
     clauses.

For storage engines that support foreign keys, MySQL rejects any *note
'INSERT': insert. or *note 'UPDATE': update. operation that attempts to
create a foreign key value in a child table if there is no matching
candidate key value in the parent table.

For an 'ON DELETE' or 'ON UPDATE' that is not specified, the default
action is always 'RESTRICT'.

'InnoDB' performs cascading operations using a depth-first search
algorithm on the records of the index that corresponds to the foreign
key constraint.

*Foreign Key Constraint Examples*

This simple example relates 'parent' and 'child' tables through a
single-column foreign key:

     CREATE TABLE parent (
         id INT NOT NULL,
         PRIMARY KEY (id)
     ) ENGINE=INNODB;

     CREATE TABLE child (
         id INT,
         parent_id INT,
         INDEX par_ind (parent_id),
         FOREIGN KEY (parent_id)
             REFERENCES parent(id)
             ON DELETE CASCADE
     ) ENGINE=INNODB;

This is a more complex example in which a 'product_order' table has
foreign keys for two other tables.  One foreign key references a
two-column index in the 'product' table.  The other references a
single-column index in the 'customer' table:

     CREATE TABLE product (
         category INT NOT NULL, id INT NOT NULL,
         price DECIMAL,
         PRIMARY KEY(category, id)
     )   ENGINE=INNODB;

     CREATE TABLE customer (
         id INT NOT NULL,
         PRIMARY KEY (id)
     )   ENGINE=INNODB;

     CREATE TABLE product_order (
         no INT NOT NULL AUTO_INCREMENT,
         product_category INT NOT NULL,
         product_id INT NOT NULL,
         customer_id INT NOT NULL,

         PRIMARY KEY(no),
         INDEX (product_category, product_id),
         INDEX (customer_id),

         FOREIGN KEY (product_category, product_id)
           REFERENCES product(category, id)
           ON UPDATE CASCADE ON DELETE RESTRICT,

         FOREIGN KEY (customer_id)
           REFERENCES customer(id)
     )   ENGINE=INNODB;

*Adding Foreign Key Constraints*

You can add a foreign key constraint to an existing table using the
following *note 'ALTER TABLE': alter-table. syntax:

     ALTER TABLE TBL_NAME
         ADD [CONSTRAINT [SYMBOL]] FOREIGN KEY
         [INDEX_NAME] (COL_NAME, ...)
         REFERENCES TBL_NAME (COL_NAME,...)
         [ON DELETE REFERENCE_OPTION]
         [ON UPDATE REFERENCE_OPTION]

The foreign key can be self referential (referring to the same table).
When you add a foreign key constraint to a table using *note 'ALTER
TABLE': alter-table, _remember to create the required indexes first._

*Dropping Foreign Key Constraints*

You can drop a foreign key constraint using the following *note 'ALTER
TABLE': alter-table. syntax:

     ALTER TABLE TBL_NAME DROP FOREIGN KEY FK_SYMBOL;

If the 'FOREIGN KEY' clause defined a 'CONSTRAINT' name when you created
the constraint, you can refer to that name to drop the foreign key
constraint.  Otherwise, a constraint name was generated internally, and
you must use that value.  To determine the foreign key constraint name,
use *note 'SHOW CREATE TABLE': show-create-table.:

     mysql> SHOW CREATE TABLE child\G
     *************************** 1. row ***************************
            Table: child
     Create Table: CREATE TABLE `child` (
       `id` int(11) DEFAULT NULL,
       `parent_id` int(11) DEFAULT NULL,
       KEY `par_ind` (`parent_id`),
       CONSTRAINT `child_ibfk_1` FOREIGN KEY (`parent_id`)
       REFERENCES `parent` (`id`) ON DELETE CASCADE
     ) ENGINE=InnoDB DEFAULT CHARSET=latin1

     mysql> ALTER TABLE child DROP FOREIGN KEY `child_ibfk_1`;

Adding and dropping a foreign key in separate clauses of a single *note
'ALTER TABLE': alter-table. statement may be problematic in some cases
and is therefore unsupported.  Use separate statements for each
operation.

If an *note 'ALTER TABLE': alter-table. statement results in changes to
column values (for example, because a column is truncated), MySQL's
foreign key constraint checks do not notice possible violations caused
by changing the values.

*Foreign Key Checks*

Foreign key checking is controlled by the 'foreign_key_checks' variable,
which is enabled by default.  Typically, you leave this variable enabled
during normal operation to enforce referential integrity.

The 'foreign_key_checks' variable is dynamic and supports both global
and session scopes.  For information about using system variables, see
*note using-system-variables::.

Disabling foreign key checking is useful when:

   * Dropping a table that is referenced by a foreign key constraint.  A
     referenced table can only be dropped after 'foreign_key_checks' is
     disabled.  When you drop a table, constraints defined on the table
     are also dropped.

   * Reloading tables in different order than required by their foreign
     key relationships.  For example, *note 'mysqldump': mysqldump.
     produces correct definitions of tables in the dump file, including
     foreign key constraints for child tables.  To make it easier to
     reload dump files for tables with foreign key relationships, *note
     'mysqldump': mysqldump. automatically includes a statement in the
     dump output that disables 'foreign_key_checks'.  This enables you
     to import the tables in any order in case the dump file contains
     tables that are not correctly ordered for foreign keys.  Disabling
     'foreign_key_checks' also speeds up the import operation by
     avoiding foreign key checks.

   * Executing *note 'LOAD DATA': load-data. operations, to avoid
     foreign key checking.

   * Performing an *note 'ALTER TABLE': alter-table. operation on a
     table that has a foreign key relationship.

When 'foreign_key_checks' is disabled, foreign key constraints are
ignored, with the following exceptions:

   * Recreating a table that was previously dropped returns an error if
     the table definition does not conform to the foreign key
     constraints that reference the table.  The table must have the
     correct column names and types.  It must also have indexes on the
     referenced keys.  If these requirements are not satisfied, MySQL
     returns Error 1005 that refers to errno: 150 in the error message,
     which means that a foreign key constraint was not correctly formed.

   * Altering a table returns an error (errno: 150) if a foreign key
     definition is incorrectly formed for the altered table.

   * Dropping an index required by a foreign key constraint.  The
     foreign key constraint must be removed before dropping the index.

   * Creating a foreign key constraint where a column references a
     nonmatching column type.

Disabling 'foreign_key_checks' has these additional implications:

   * It is permitted to drop a database that contains tables with
     foreign keys that are referenced by tables outside the database.

   * It is permitted to drop a table with foreign keys referenced by
     other tables.

   * Enabling 'foreign_key_checks' does not trigger a scan of table
     data, which means that rows added to a table while
     'foreign_key_checks' is disabled are not checked for consistency
     when 'foreign_key_checks' is re-enabled.

*Foreign Key Definitions and Metadata*

To view a foreign key definition, use *note 'SHOW CREATE TABLE':
show-create-table.:

     mysql> SHOW CREATE TABLE child\G
     *************************** 1. row ***************************
            Table: child
     Create Table: CREATE TABLE `child` (
       `id` int(11) DEFAULT NULL,
       `parent_id` int(11) DEFAULT NULL,
       KEY `par_ind` (`parent_id`),
       CONSTRAINT `child_ibfk_1` FOREIGN KEY (`parent_id`)
       REFERENCES `parent` (`id`) ON DELETE CASCADE
     ) ENGINE=InnoDB DEFAULT CHARSET=latin1

You can obtain information about foreign keys from the *note
'INFORMATION_SCHEMA.KEY_COLUMN_USAGE': key-column-usage-table. table.
An example of a query against this table is shown here:

     mysql> SELECT TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME, CONSTRAINT_NAME
            FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE
            WHERE REFERENCED_TABLE_SCHEMA IS NOT NULL;
     +--------------+------------+-------------+-----------------+
     | TABLE_SCHEMA | TABLE_NAME | COLUMN_NAME | CONSTRAINT_NAME |
     +--------------+------------+-------------+-----------------+
     | test         | child      | parent_id   | child_ibfk_1    |
     +--------------+------------+-------------+-----------------+

*Foreign Key Errors*

In the event of a foreign key error involving 'InnoDB' tables (usually
Error 150 in the MySQL Server), information about the latest foreign key
error can be obtained by checking *note 'SHOW ENGINE INNODB STATUS':
show-engine. output.

     mysql> SHOW ENGINE INNODB STATUS\G
     ...
     ------------------------
     LATEST FOREIGN KEY ERROR
     ------------------------
     141016 15:37:30 Transaction:
     TRANSACTION 3D005, ACTIVE 0 sec inserting
     mysql tables in use 1, locked 1
     4 lock struct(s), heap size 1248, 3 row lock(s), undo log entries 3
     MySQL thread id 1, OS thread handle 0x7f0ee440e700, query id 70 localhost root
     update
     INSERT INTO child VALUES
         (NULL, 1)
         , (NULL, 2)
         , (NULL, 3)
         , (NULL, 4)
         , (NULL, 5)
         , (NULL, 6)
     Foreign key constraint fails for table `mysql`.`child`:
     ,
       CONSTRAINT `child_ibfk_1` FOREIGN KEY (`parent_id`) REFERENCES `parent` (`id`)
       ON DELETE CASCADE ON UPDATE CASCADE
     Trying to add in child table, in index `par_ind` tuple:
     DATA TUPLE: 2 fields;
      0: len 4; hex 80000003; asc     ;;
      1: len 4; hex 80000003; asc     ;;

     But in parent table `mysql`.`parent`, in index `PRIMARY`,
     the closest match we can find is record:
     PHYSICAL RECORD: n_fields 3; compact format; info bits 0
      0: len 4; hex 80000004; asc     ;;
      1: len 6; hex 00000003d002; asc       ;;
      2: len 7; hex 8300001d480137; asc     H 7;;
     ...

*Warning*:

'ER_NO_REFERENCED_ROW_2' and 'ER_ROW_IS_REFERENCED_2' error messages for
foreign key operations expose information about parent tables, even if
the user has no parent table access privileges.  To hide information
about parent tables, include the appropriate condition handlers in
application code and stored programs.


File: manual.info.tmp,  Node: silent-column-changes,  Prev: create-table-foreign-keys,  Up: create-table

13.1.17.7 Silent Column Specification Changes
.............................................

In some cases, MySQL silently changes column specifications from those
given in a *note 'CREATE TABLE': create-table. or *note 'ALTER TABLE':
alter-table. statement.  These might be changes to a data type, to
attributes associated with a data type, or to an index specification.

All changes are subject to the internal row-size limit of 65,535 bytes,
which may cause some attempts at data type changes to fail.  See *note
column-count-limit::.

   * *note 'TIMESTAMP': datetime. display sizes are discarded.

     Also note that *note 'TIMESTAMP': datetime. columns are 'NOT NULL'
     by default.

   * Columns that are part of a 'PRIMARY KEY' are made 'NOT NULL' even
     if not declared that way.

   * Trailing spaces are automatically deleted from *note 'ENUM': enum.
     and *note 'SET': set. member values when the table is created.

   * MySQL maps certain data types used by other SQL database vendors to
     MySQL types.  See *note other-vendor-data-types::.

   * If you include a 'USING' clause to specify an index type that is
     not permitted for a given storage engine, but there is another
     index type available that the engine can use without affecting
     query results, the engine uses the available type.

   * If strict SQL mode is not enabled, a *note 'VARCHAR': char. column
     with a length specification greater than 65535 is converted to
     *note 'TEXT': blob, and a *note 'VARBINARY': binary-varbinary.
     column with a length specification greater than 65535 is converted
     to *note 'BLOB': blob.  Otherwise, an error occurs in either of
     these cases.

   * Specifying the 'CHARACTER SET binary' attribute for a character
     data type causes the column to be created as the corresponding
     binary data type: *note 'CHAR': char. becomes *note 'BINARY':
     binary-varbinary, *note 'VARCHAR': char. becomes *note 'VARBINARY':
     binary-varbinary, and *note 'TEXT': blob. becomes *note 'BLOB':
     blob.  For the *note 'ENUM': enum. and *note 'SET': set. data
     types, this does not occur; they are created as declared.  Suppose
     that you specify a table using this definition:

          CREATE TABLE t
          (
            c1 VARCHAR(10) CHARACTER SET binary,
            c2 TEXT CHARACTER SET binary,
            c3 ENUM('a','b','c') CHARACTER SET binary
          );

     The resulting table has this definition:

          CREATE TABLE t
          (
            c1 VARBINARY(10),
            c2 BLOB,
            c3 ENUM('a','b','c') CHARACTER SET binary
          );

To see whether MySQL used a data type other than the one you specified,
issue a *note 'DESCRIBE': describe. or *note 'SHOW CREATE TABLE':
show-create-table. statement after creating or altering the table.

Certain other data type changes can occur if you compress a table using
*note 'myisampack': myisampack.  See *note compressed-format::.


File: manual.info.tmp,  Node: create-tablespace,  Next: create-trigger,  Prev: create-table,  Up: sql-data-definition-statements

13.1.18 CREATE TABLESPACE Statement
-----------------------------------

     CREATE TABLESPACE TABLESPACE_NAME
         ADD DATAFILE 'FILE_NAME'
         USE LOGFILE GROUP LOGFILE_GROUP
         [EXTENT_SIZE [=] EXTENT_SIZE]
         [INITIAL_SIZE [=] INITIAL_SIZE]
         [AUTOEXTEND_SIZE [=] AUTOEXTEND_SIZE]
         [MAX_SIZE [=] MAX_SIZE]
         [NODEGROUP [=] NODEGROUP_ID]
         [WAIT]
         [COMMENT [=] COMMENT_TEXT]
         ENGINE [=] ENGINE_NAME

This statement is used to create a tablespace, which can contain one or
more data files, providing storage space for tables.  One data file is
created and added to the tablespace using this statement.  Additional
data files may be added to the tablespace by using the *note 'ALTER
TABLESPACE': alter-tablespace. statement (see *note alter-tablespace::).
For rules covering the naming of tablespaces, see *note identifiers::.

*Note*:

All NDB Cluster Disk Data objects share the same namespace.  This means
that _each Disk Data object_ must be uniquely named (and not merely each
Disk Data object of a given type).  For example, you cannot have a
tablespace and a log file group with the same name, or a tablespace and
a data file with the same name.

A log file group of one or more 'UNDO' log files must be assigned to the
tablespace to be created with the 'USE LOGFILE GROUP' clause.
LOGFILE_GROUP must be an existing log file group created with *note
'CREATE LOGFILE GROUP': create-logfile-group. (see *note
create-logfile-group::).  Multiple tablespaces may use the same log file
group for 'UNDO' logging.

The 'EXTENT_SIZE' sets the size, in bytes, of the extents used by any
files belonging to the tablespace.  The default value is 1M. The minimum
size is 32K, and theoretical maximum is 2G, although the practical
maximum size depends on a number of factors.  In most cases, changing
the extent size does not have any measurable effect on performance, and
the default value is recommended for all but the most unusual
situations.

An _extent_ is a unit of disk space allocation.  One extent is filled
with as much data as that extent can contain before another extent is
used.  In theory, up to 65,535 (64K) extents may used per data file;
however, the recommended maximum is 32,768 (32K). The recommended
maximum size for a single data file is 32G--that is, 32K extents x 1 MB
per extent.  In addition, once an extent is allocated to a given
partition, it cannot be used to store data from a different partition;
an extent cannot store data from more than one partition.  This means,
for example that a tablespace having a single datafile whose
'INITIAL_SIZE' is 256 MB and whose 'EXTENT_SIZE' is 128M has just two
extents, and so can be used to store data from at most two different
disk data table partitions.

You can see how many extents remain free in a given data file by
querying the *note 'INFORMATION_SCHEMA.FILES': files-table. table, and
so derive an estimate for how much space remains free in the file.  For
further discussion and examples, see *note files-table::.

The 'INITIAL_SIZE' parameter sets the data file's total size in bytes.
Once the file has been created, its size cannot be changed; however, you
can add more data files to the tablespace using 'ALTER TABLESPACE ...
ADD DATAFILE'.  See *note alter-tablespace::.

'INITIAL_SIZE' is optional; its default value is 134217728 (128 MB).

On 32-bit systems, the maximum supported value for 'INITIAL_SIZE' is
4294967296 (4 GB). (Bug #29186)

When setting 'EXTENT_SIZE', you may optionally follow the number with a
one-letter abbreviation for an order of magnitude, similar to those used
in 'my.cnf'.  Generally, this is one of the letters 'M' (for megabytes)
or 'G' (for gigabytes).  In MySQL NDB Cluster 7.2.14 and later, these
abbreviations are also supported when specifying 'INITIAL_SIZE' as well.
(Bug #13116514, Bug #16104705, Bug #62858)

'INITIAL_SIZE', 'EXTENT_SIZE', and 'UNDO_BUFFER_SIZE' are subject to
rounding as follows:

   * 'EXTENT_SIZE' and 'UNDO_BUFFER_SIZE' are each rounded up to the
     nearest whole multiple of 32K.

   * 'INITIAL_SIZE' is rounded _down_ to the nearest whole multiple of
     32K.

     For data files, _INITIAL_SIZE_ is subject to further rounding; the
     result just obtained is rounded up to the nearest whole multiple of
     'EXTENT_SIZE' (after any rounding).

The rounding just described is done explicitly, and a warning is issued
by the MySQL Server when any such rounding is performed.  The rounded
values are also used by the NDB kernel for calculating *note
'INFORMATION_SCHEMA.FILES': files-table. column values and other
purposes.  However, to avoid an unexpected result, we suggest that you
always use whole multiples of 32K in specifying these options.

'AUTOEXTEND_SIZE', 'MAX_SIZE', 'NODEGROUP', 'WAIT', and 'COMMENT' are
parsed but ignored, and so currently have no effect.  These options are
intended for future expansion.

The 'ENGINE' parameter determines the storage engine which uses this
tablespace, with ENGINE_NAME being the name of the storage engine.
Currently, ENGINE_NAME must be one of the values *note 'NDB':
mysql-cluster. or *note 'NDBCLUSTER': mysql-cluster.

When *note 'CREATE TABLESPACE': create-tablespace. is used with 'ENGINE
= NDB', a tablespace and associated data file are created on each
Cluster data node.  You can verify that the data files were created and
obtain information about them by querying the *note
'INFORMATION_SCHEMA.FILES': files-table. table.  For example:

     mysql> SELECT LOGFILE_GROUP_NAME, FILE_NAME, EXTRA
         -> FROM INFORMATION_SCHEMA.FILES
         -> WHERE TABLESPACE_NAME = 'newts' AND FILE_TYPE = 'DATAFILE';
     +--------------------+-------------+----------------+
     | LOGFILE_GROUP_NAME | FILE_NAME   | EXTRA          |
     +--------------------+-------------+----------------+
     | lg_3               | newdata.dat | CLUSTER_NODE=3 |
     | lg_3               | newdata.dat | CLUSTER_NODE=4 |
     +--------------------+-------------+----------------+
     2 rows in set (0.01 sec)

(See *note files-table::.)

*note 'CREATE TABLESPACE': create-tablespace. is useful only with Disk
Data storage for NDB Cluster.  See *note mysql-cluster-disk-data::.


File: manual.info.tmp,  Node: create-trigger,  Next: create-view,  Prev: create-tablespace,  Up: sql-data-definition-statements

13.1.19 CREATE TRIGGER Statement
--------------------------------

     CREATE
         [DEFINER = USER]
         TRIGGER TRIGGER_NAME
         TRIGGER_TIME TRIGGER_EVENT
         ON TBL_NAME FOR EACH ROW
         TRIGGER_BODY

     TRIGGER_TIME: { BEFORE | AFTER }

     TRIGGER_EVENT: { INSERT | UPDATE | DELETE }

This statement creates a new trigger.  A trigger is a named database
object that is associated with a table, and that activates when a
particular event occurs for the table.  The trigger becomes associated
with the table named TBL_NAME, which must refer to a permanent table.
You cannot associate a trigger with a 'TEMPORARY' table or a view.

Trigger names exist in the schema namespace, meaning that all triggers
must have unique names within a schema.  Triggers in different schemas
can have the same name.

This section describes *note 'CREATE TRIGGER': create-trigger. syntax.
For additional discussion, see *note trigger-syntax::.

*note 'CREATE TRIGGER': create-trigger. requires the 'TRIGGER' privilege
for the table associated with the trigger.  If the 'DEFINER' clause is
present, the privileges required depend on the USER value, as discussed
in *note stored-objects-security::.  If binary logging is enabled, *note
'CREATE TRIGGER': create-trigger. might require the 'SUPER' privilege,
as discussed in *note stored-programs-logging::.

The 'DEFINER' clause determines the security context to be used when
checking access privileges at trigger activation time, as described
later in this section.

TRIGGER_TIME is the trigger action time.  It can be 'BEFORE' or 'AFTER'
to indicate that the trigger activates before or after each row to be
modified.

Basic column value checks occur prior to trigger activation, so you
cannot use 'BEFORE' triggers to convert values inappropriate for the
column type to valid values.

TRIGGER_EVENT indicates the kind of operation that activates the
trigger.  These TRIGGER_EVENT values are permitted:

   * *note 'INSERT': insert.: The trigger activates whenever a new row
     is inserted into the table (for example, through *note 'INSERT':
     insert, *note 'LOAD DATA': load-data, and *note 'REPLACE': replace.
     statements).

   * *note 'UPDATE': update.: The trigger activates whenever a row is
     modified (for example, through *note 'UPDATE': update. statements).

   * *note 'DELETE': delete.: The trigger activates whenever a row is
     deleted from the table (for example, through *note 'DELETE':
     delete. and *note 'REPLACE': replace. statements).  *note 'DROP
     TABLE': drop-table. and *note 'TRUNCATE TABLE': truncate-table.
     statements on the table do _not_ activate this trigger, because
     they do not use *note 'DELETE': delete.  Dropping a partition does
     not activate *note 'DELETE': delete. triggers, either.

The TRIGGER_EVENT does not represent a literal type of SQL statement
that activates the trigger so much as it represents a type of table
operation.  For example, an *note 'INSERT': insert. trigger activates
not only for *note 'INSERT': insert. statements but also *note 'LOAD
DATA': load-data. statements because both statements insert rows into a
table.

A potentially confusing example of this is the 'INSERT INTO ... ON
DUPLICATE KEY UPDATE ...' syntax: a 'BEFORE INSERT' trigger activates
for every row, followed by either an 'AFTER INSERT' trigger or both the
'BEFORE UPDATE' and 'AFTER UPDATE' triggers, depending on whether there
was a duplicate key for the row.

*Note*:

Cascaded foreign key actions do not activate triggers.

There cannot be multiple triggers for a given table that have the same
trigger event and action time.  For example, you cannot have two 'BEFORE
UPDATE' triggers for a table.  But you can have a 'BEFORE UPDATE' and a
'BEFORE INSERT' trigger, or a 'BEFORE UPDATE' and an 'AFTER UPDATE'
trigger.

TRIGGER_BODY is the statement to execute when the trigger activates.  To
execute multiple statements, use the *note 'BEGIN ... END': begin-end.
compound statement construct.  This also enables you to use the same
statements that are permissible within stored routines.  See *note
begin-end::.  Some statements are not permitted in triggers; see *note
stored-program-restrictions::.

Within the trigger body, you can refer to columns in the subject table
(the table associated with the trigger) by using the aliases 'OLD' and
'NEW'.  'OLD.COL_NAME' refers to a column of an existing row before it
is updated or deleted.  'NEW.COL_NAME' refers to the column of a new row
to be inserted or an existing row after it is updated.

MySQL stores the 'sql_mode' system variable setting in effect when a
trigger is created, and always executes the trigger body with this
setting in force, _regardless of the current server SQL mode when the
trigger begins executing_.

The 'DEFINER' clause specifies the MySQL account to be used when
checking access privileges at trigger activation time.  If the 'DEFINER'
clause is present, the USER value should be a MySQL account specified as
''USER_NAME'@'HOST_NAME'', 'CURRENT_USER', or 'CURRENT_USER()'.  The
permitted USER values depend on the privileges you hold, as discussed in
*note stored-objects-security::.  Also see that section for additional
information about trigger security.

If the 'DEFINER' clause is omitted, the default definer is the user who
executes the *note 'CREATE TRIGGER': create-trigger. statement.  This is
the same as specifying 'DEFINER = CURRENT_USER' explicitly.

MySQL takes the 'DEFINER' user into account when checking trigger
privileges as follows:

   * At *note 'CREATE TRIGGER': create-trigger. time, the user who
     issues the statement must have the 'TRIGGER' privilege.

   * At trigger activation time, privileges are checked against the
     'DEFINER' user.  This user must have these privileges:

        * The 'TRIGGER' privilege for the subject table.

        * The 'SELECT' privilege for the subject table if references to
          table columns occur using 'OLD.COL_NAME' or 'NEW.COL_NAME' in
          the trigger body.

        * The 'UPDATE' privilege for the subject table if table columns
          are targets of 'SET NEW.COL_NAME = VALUE' assignments in the
          trigger body.

        * Whatever other privileges normally are required for the
          statements executed by the trigger.

Within a trigger body, the 'CURRENT_USER' function returns the account
used to check privileges at trigger activation time.  This is the
'DEFINER' user, not the user whose actions caused the trigger to be
activated.  For information about user auditing within triggers, see
*note account-activity-auditing::.

If you use *note 'LOCK TABLES': lock-tables. to lock a table that has
triggers, the tables used within the trigger are also locked, as
described in *note lock-tables-and-triggers::.

For additional discussion of trigger use, see *note trigger-syntax::.


File: manual.info.tmp,  Node: create-view,  Next: drop-database,  Prev: create-trigger,  Up: sql-data-definition-statements

13.1.20 CREATE VIEW Statement
-----------------------------

     CREATE
         [OR REPLACE]
         [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]
         [DEFINER = USER]
         [SQL SECURITY { DEFINER | INVOKER }]
         VIEW VIEW_NAME [(COLUMN_LIST)]
         AS SELECT_STATEMENT
         [WITH [CASCADED | LOCAL] CHECK OPTION]

The *note 'CREATE VIEW': create-view. statement creates a new view, or
replaces an existing view if the 'OR REPLACE' clause is given.  If the
view does not exist, *note 'CREATE OR REPLACE VIEW': create-view. is the
same as *note 'CREATE VIEW': create-view.  If the view does exist, *note
'CREATE OR REPLACE VIEW': create-view. replaces it.

For information about restrictions on view use, see *note
view-restrictions::.

The SELECT_STATEMENT is a *note 'SELECT': select. statement that
provides the definition of the view.  (Selecting from the view selects,
in effect, using the *note 'SELECT': select. statement.)  The
SELECT_STATEMENT can select from base tables or other views.

The view definition is 'frozen' at creation time and is not affected by
subsequent changes to the definitions of the underlying tables.  For
example, if a view is defined as 'SELECT *' on a table, new columns
added to the table later do not become part of the view, and columns
dropped from the table will result in an error when selecting from the
view.

The 'ALGORITHM' clause affects how MySQL processes the view.  The
'DEFINER' and 'SQL SECURITY' clauses specify the security context to be
used when checking access privileges at view invocation time.  The 'WITH
CHECK OPTION' clause can be given to constrain inserts or updates to
rows in tables referenced by the view.  These clauses are described
later in this section.

The *note 'CREATE VIEW': create-view. statement requires the 'CREATE
VIEW' privilege for the view, and some privilege for each column
selected by the *note 'SELECT': select. statement.  For columns used
elsewhere in the *note 'SELECT': select. statement, you must have the
'SELECT' privilege.  If the 'OR REPLACE' clause is present, you must
also have the 'DROP' privilege for the view.  If the 'DEFINER' clause is
present, the privileges required depend on the USER value, as discussed
in *note stored-objects-security::.

When a view is referenced, privilege checking occurs as described later
in this section.

A view belongs to a database.  By default, a new view is created in the
default database.  To create the view explicitly in a given database,
use DB_NAME.VIEW_NAME syntax to qualify the view name with the database
name:

     CREATE VIEW test.v AS SELECT * FROM t;

Unqualified table or view names in the *note 'SELECT': select. statement
are also interpreted with respect to the default database.  A view can
refer to tables or views in other databases by qualifying the table or
view name with the appropriate database name.

Within a database, base tables and views share the same namespace, so a
base table and a view cannot have the same name.

Columns retrieved by the *note 'SELECT': select. statement can be simple
references to table columns, or expressions that use functions, constant
values, operators, and so forth.

A view must have unique column names with no duplicates, just like a
base table.  By default, the names of the columns retrieved by the *note
'SELECT': select. statement are used for the view column names.  To
define explicit names for the view columns, specify the optional
COLUMN_LIST clause as a list of comma-separated identifiers.  The number
of names in COLUMN_LIST must be the same as the number of columns
retrieved by the *note 'SELECT': select. statement.

A view can be created from many kinds of *note 'SELECT': select.
statements.  It can refer to base tables or other views.  It can use
joins, *note 'UNION': union, and subqueries.  The *note 'SELECT':
select. need not even refer to any tables:

     CREATE VIEW v_today (today) AS SELECT CURRENT_DATE;

The following example defines a view that selects two columns from
another table as well as an expression calculated from those columns:

     mysql> CREATE TABLE t (qty INT, price INT);
     mysql> INSERT INTO t VALUES(3, 50);
     mysql> CREATE VIEW v AS SELECT qty, price, qty*price AS value FROM t;
     mysql> SELECT * FROM v;
     +------+-------+-------+
     | qty  | price | value |
     +------+-------+-------+
     |    3 |    50 |   150 |
     +------+-------+-------+

A view definition is subject to the following restrictions:

   * The *note 'SELECT': select. statement cannot contain a subquery in
     the 'FROM' clause.

   * The *note 'SELECT': select. statement cannot refer to system
     variables or user-defined variables.

   * Within a stored program, the *note 'SELECT': select. statement
     cannot refer to program parameters or local variables.

   * The *note 'SELECT': select. statement cannot refer to prepared
     statement parameters.

   * Any table or view referred to in the definition must exist.  If,
     after the view has been created, a table or view that the
     definition refers to is dropped, use of the view results in an
     error.  To check a view definition for problems of this kind, use
     the *note 'CHECK TABLE': check-table. statement.

   * The definition cannot refer to a 'TEMPORARY' table, and you cannot
     create a 'TEMPORARY' view.

   * You cannot associate a trigger with a view.

   * Aliases for column names in the *note 'SELECT': select. statement
     are checked against the maximum column length of 64 characters (not
     the maximum alias length of 256 characters).

'ORDER BY' is permitted in a view definition, but it is ignored if you
select from a view using a statement that has its own 'ORDER BY' or
filtering or grouping.  When 'ORDER BY' is combined with 'LIMIT' or
'OFFSET' in a view definition, the ordering is always enforced before
the query result is used by the outer query, but it does not guarantee
that the same ordering is used in the end result.  As a workaround, add
an 'ORDER BY' clause to the outer query.

For other options or clauses in the definition, they are added to the
options or clauses of the statement that references the view, but the
effect is undefined.  For example, if a view definition includes a
'LIMIT' clause, and you select from the view using a statement that has
its own 'LIMIT' clause, it is undefined which limit applies.  This same
principle applies to options such as 'ALL', 'DISTINCT', or
'SQL_SMALL_RESULT' that follow the *note 'SELECT': select. keyword, and
to clauses such as 'INTO', 'FOR UPDATE', 'LOCK IN SHARE MODE', and
'PROCEDURE'.

The results obtained from a view may be affected if you change the query
processing environment by changing system variables:

     mysql> CREATE VIEW v (mycol) AS SELECT 'abc';
     Query OK, 0 rows affected (0.01 sec)

     mysql> SET sql_mode = '';
     Query OK, 0 rows affected (0.00 sec)

     mysql> SELECT "mycol" FROM v;
     +-------+
     | mycol |
     +-------+
     | mycol |
     +-------+
     1 row in set (0.01 sec)

     mysql> SET sql_mode = 'ANSI_QUOTES';
     Query OK, 0 rows affected (0.00 sec)

     mysql> SELECT "mycol" FROM v;
     +-------+
     | mycol |
     +-------+
     | abc   |
     +-------+
     1 row in set (0.00 sec)

The 'DEFINER' and 'SQL SECURITY' clauses determine which MySQL account
to use when checking access privileges for the view when a statement is
executed that references the view.  The valid 'SQL SECURITY'
characteristic values are 'DEFINER' (the default) and 'INVOKER'.  These
indicate that the required privileges must be held by the user who
defined or invoked the view, respectively.

If the 'DEFINER' clause is present, the USER value should be a MySQL
account specified as ''USER_NAME'@'HOST_NAME'', 'CURRENT_USER', or
'CURRENT_USER()'.  The permitted USER values depend on the privileges
you hold, as discussed in *note stored-objects-security::.  Also see
that section for additional information about view security.

If the 'DEFINER' clause is omitted, the default definer is the user who
executes the *note 'CREATE VIEW': create-view. statement.  This is the
same as specifying 'DEFINER = CURRENT_USER' explicitly.

Within a view definition, the 'CURRENT_USER' function returns the view's
'DEFINER' value by default.  For views defined with the 'SQL SECURITY
INVOKER' characteristic, 'CURRENT_USER' returns the account for the
view's invoker.  For information about user auditing within views, see
*note account-activity-auditing::.

Within a stored routine that is defined with the 'SQL SECURITY DEFINER'
characteristic, 'CURRENT_USER' returns the routine's 'DEFINER' value.
This also affects a view defined within such a routine, if the view
definition contains a 'DEFINER' value of 'CURRENT_USER'.

MySQL checks view privileges like this:

   * At view definition time, the view creator must have the privileges
     needed to use the top-level objects accessed by the view.  For
     example, if the view definition refers to table columns, the
     creator must have some privilege for each column in the select list
     of the definition, and the 'SELECT' privilege for each column used
     elsewhere in the definition.  If the definition refers to a stored
     function, only the privileges needed to invoke the function can be
     checked.  The privileges required at function invocation time can
     be checked only as it executes: For different invocations,
     different execution paths within the function might be taken.

   * The user who references a view must have appropriate privileges to
     access it ('SELECT' to select from it, 'INSERT' to insert into it,
     and so forth.)

   * When a view has been referenced, privileges for objects accessed by
     the view are checked against the privileges held by the view
     'DEFINER' account or invoker, depending on whether the 'SQL
     SECURITY' characteristic is 'DEFINER' or 'INVOKER', respectively.

   * If reference to a view causes execution of a stored function,
     privilege checking for statements executed within the function
     depend on whether the function 'SQL SECURITY' characteristic is
     'DEFINER' or 'INVOKER'.  If the security characteristic is
     'DEFINER', the function runs with the privileges of the 'DEFINER'
     account.  If the characteristic is 'INVOKER', the function runs
     with the privileges determined by the view's 'SQL SECURITY'
     characteristic.

Example: A view might depend on a stored function, and that function
might invoke other stored routines.  For example, the following view
invokes a stored function 'f()':

     CREATE VIEW v AS SELECT * FROM t WHERE t.id = f(t.name);

Suppose that 'f()' contains a statement such as this:

     IF name IS NULL then
       CALL p1();
     ELSE
       CALL p2();
     END IF;

The privileges required for executing statements within 'f()' need to be
checked when 'f()' executes.  This might mean that privileges are needed
for 'p1()' or 'p2()', depending on the execution path within 'f()'.
Those privileges must be checked at runtime, and the user who must
possess the privileges is determined by the 'SQL SECURITY' values of the
view 'v' and the function 'f()'.

The 'DEFINER' and 'SQL SECURITY' clauses for views are extensions to
standard SQL. In standard SQL, views are handled using the rules for
'SQL SECURITY DEFINER'.  The standard says that the definer of the view,
which is the same as the owner of the view's schema, gets applicable
privileges on the view (for example, 'SELECT') and may grant them.
MySQL has no concept of a schema 'owner', so MySQL adds a clause to
identify the definer.  The 'DEFINER' clause is an extension where the
intent is to have what the standard has; that is, a permanent record of
who defined the view.  This is why the default 'DEFINER' value is the
account of the view creator.

The optional 'ALGORITHM' clause is a MySQL extension to standard SQL. It
affects how MySQL processes the view.  'ALGORITHM' takes three values:
'MERGE', 'TEMPTABLE', or 'UNDEFINED'.  The default algorithm is
'UNDEFINED' if no 'ALGORITHM' clause is present.  For more information,
see *note view-algorithms::, as well as Optimizing Derived Tables
(https://dev.mysql.com/doc/refman/5.6/en/derived-table-optimization.html).

Some views are updatable.  That is, you can use them in statements such
as *note 'UPDATE': update, *note 'DELETE': delete, or *note 'INSERT':
insert. to update the contents of the underlying table.  For a view to
be updatable, there must be a one-to-one relationship between the rows
in the view and the rows in the underlying table.  There are also
certain other constructs that make a view nonupdatable.

The 'WITH CHECK OPTION' clause can be given for an updatable view to
prevent inserts or updates to rows except those for which the 'WHERE'
clause in the SELECT_STATEMENT is true.

In a 'WITH CHECK OPTION' clause for an updatable view, the 'LOCAL' and
'CASCADED' keywords determine the scope of check testing when the view
is defined in terms of another view.  The 'LOCAL' keyword restricts the
'CHECK OPTION' only to the view being defined.  'CASCADED' causes the
checks for underlying views to be evaluated as well.  When neither
keyword is given, the default is 'CASCADED'.

For more information about updatable views and the 'WITH CHECK OPTION'
clause, see *note view-updatability::, and *note view-check-option::.


File: manual.info.tmp,  Node: drop-database,  Next: drop-event,  Prev: create-view,  Up: sql-data-definition-statements

13.1.21 DROP DATABASE Statement
-------------------------------

     DROP {DATABASE | SCHEMA} [IF EXISTS] DB_NAME

*note 'DROP DATABASE': drop-database. drops all tables in the database
and deletes the database.  Be _very_ careful with this statement!  To
use *note 'DROP DATABASE': drop-database, you need the 'DROP' privilege
on the database.  *note 'DROP SCHEMA': drop-database. is a synonym for
*note 'DROP DATABASE': drop-database.

*Important*:

When a database is dropped, privileges granted specifically for the
database are _not_ automatically dropped.  They must be dropped
manually.  See *note grant::.

'IF EXISTS' is used to prevent an error from occurring if the database
does not exist.

If the default database is dropped, the default database is unset (the
'DATABASE()' function returns 'NULL').

If you use *note 'DROP DATABASE': drop-database. on a symbolically
linked database, both the link and the original database are deleted.

*note 'DROP DATABASE': drop-database. returns the number of tables that
were removed.  This corresponds to the number of '.frm' files removed.

The *note 'DROP DATABASE': drop-database. statement removes from the
given database directory those files and directories that MySQL itself
may create during normal operation:

   * All files with the following extensions:

        * '.frm'

        * '.BAK'

        * '.DAT'

        * '.HSH'

        * '.MRG'

        * '.MYD'

        * '.MYI'

        * '.TRG'

        * '.TRN'

        * '.db'

        * '.ibd'

        * '.ndb'

        * '.par'

   * The 'db.opt' file, if it exists.

If other files or directories remain in the database directory after
MySQL removes those just listed, the database directory cannot be
removed.  In this case, you must remove any remaining files or
directories manually and issue the *note 'DROP DATABASE': drop-database.
statement again.

Dropping a database does not remove any 'TEMPORARY' tables that were
created in that database.  'TEMPORARY' tables are automatically removed
when the session that created them ends.  See *note
create-temporary-table::.

You can also drop databases with *note 'mysqladmin': mysqladmin.  See
*note mysqladmin::.


File: manual.info.tmp,  Node: drop-event,  Next: drop-function,  Prev: drop-database,  Up: sql-data-definition-statements

13.1.22 DROP EVENT Statement
----------------------------

     DROP EVENT [IF EXISTS] EVENT_NAME

This statement drops the event named EVENT_NAME.  The event immediately
ceases being active, and is deleted completely from the server.

If the event does not exist, the error 'ERROR 1517 (HY000): Unknown
event 'EVENT_NAME'' results.  You can override this and cause the
statement to generate a warning for nonexistent events instead using 'IF
EXISTS'.

This statement requires the 'EVENT' privilege for the schema to which
the event to be dropped belongs.


File: manual.info.tmp,  Node: drop-function,  Next: drop-index,  Prev: drop-event,  Up: sql-data-definition-statements

13.1.23 DROP FUNCTION Statement
-------------------------------

The *note 'DROP FUNCTION': drop-function. statement is used to drop
stored functions and user-defined functions (UDFs):

   * For information about dropping stored functions, see *note
     drop-procedure::.

   * For information about dropping user-defined functions, see *note
     drop-function-udf::.


File: manual.info.tmp,  Node: drop-index,  Next: drop-logfile-group,  Prev: drop-function,  Up: sql-data-definition-statements

13.1.24 DROP INDEX Statement
----------------------------

     DROP [ONLINE|OFFLINE] INDEX INDEX_NAME ON TBL_NAME

*note 'DROP INDEX': drop-index. drops the index named INDEX_NAME from
the table TBL_NAME.  This statement is mapped to an *note 'ALTER TABLE':
alter-table. statement to drop the index.  See *note alter-table::.

To drop a primary key, the index name is always 'PRIMARY', which must be
specified as a quoted identifier because 'PRIMARY' is a reserved word:

     DROP INDEX `PRIMARY` ON t;

Indexes on variable-width columns of *note 'NDB': mysql-cluster. tables
are dropped online; that is, without any table copying.  The table is
not locked against access from other NDB Cluster API nodes, although it
is locked against other operations on the _same_ API node for the
duration of the operation.  This is done automatically by the server
whenever it determines that it is possible to do so; you do not have to
use any special SQL syntax or server options to cause it to happen.

In standard MySQL 5.5 releases, it is not possible to override the
server when it determines that an index is to be dropped without table
copying.  In NDB Cluster, you can drop indexes offline (which causes the
table to be locked for all API nodes in the cluster) using the 'OFFLINE'
keyword.  The rules and limitations governing 'DROP OFFLINE INDEX' and
'DROP ONLINE INDEX' are the same as for 'ALTER OFFLINE TABLE ... DROP
INDEX' and 'ALTER ONLINE TABLE ... DROP INDEX'.  You cannot cause the
noncopying dropping of an index that would normally be dropped offline
by using the 'ONLINE' keyword: If it is not possible to perform the
'DROP' operation without table copying, the server ignores the 'ONLINE'
keyword.  For more information, see *note
mysql-cluster-online-operations::.

The 'ONLINE' and 'OFFLINE' keywords are available only in NDB Cluster;
attempting to use these keywords in standard MySQL Server 5.5 releases
results in a syntax error.


File: manual.info.tmp,  Node: drop-logfile-group,  Next: drop-procedure,  Prev: drop-index,  Up: sql-data-definition-statements

13.1.25 DROP LOGFILE GROUP Statement
------------------------------------

     DROP LOGFILE GROUP LOGFILE_GROUP
         ENGINE [=] ENGINE_NAME

This statement drops the log file group named LOGFILE_GROUP.  The log
file group must already exist or an error results.  (For information on
creating log file groups, see *note create-logfile-group::.)

*Important*:

Before dropping a log file group, you must drop all tablespaces that use
that log file group for 'UNDO' logging.

The required 'ENGINE' clause provides the name of the storage engine
used by the log file group to be dropped.  Currently, the only permitted
values for ENGINE_NAME are *note 'NDB': mysql-cluster. and *note
'NDBCLUSTER': mysql-cluster.

*note 'DROP LOGFILE GROUP': drop-logfile-group. is useful only with Disk
Data storage for NDB Cluster.  See *note mysql-cluster-disk-data::.


File: manual.info.tmp,  Node: drop-procedure,  Next: drop-server,  Prev: drop-logfile-group,  Up: sql-data-definition-statements

13.1.26 DROP PROCEDURE and DROP FUNCTION Statements
---------------------------------------------------

     DROP {PROCEDURE | FUNCTION} [IF EXISTS] SP_NAME

This statement is used to drop a stored procedure or function.  That is,
the specified routine is removed from the server.  You must have the
'ALTER ROUTINE' privilege for the routine.  (If the
'automatic_sp_privileges' system variable is enabled, that privilege and
'EXECUTE' are granted automatically to the routine creator when the
routine is created and dropped from the creator when the routine is
dropped.  See *note stored-routines-privileges::.)

The 'IF EXISTS' clause is a MySQL extension.  It prevents an error from
occurring if the procedure or function does not exist.  A warning is
produced that can be viewed with *note 'SHOW WARNINGS': show-warnings.

*note 'DROP FUNCTION': drop-function. is also used to drop user-defined
functions (see *note drop-function-udf::).


File: manual.info.tmp,  Node: drop-server,  Next: drop-table,  Prev: drop-procedure,  Up: sql-data-definition-statements

13.1.27 DROP SERVER Statement
-----------------------------

     DROP SERVER [ IF EXISTS ] SERVER_NAME

Drops the server definition for the server named 'SERVER_NAME'.  The
corresponding row in the 'mysql.servers' table is deleted.  This
statement requires the 'SUPER' privilege.

Dropping a server for a table does not affect any 'FEDERATED' tables
that used this connection information when they were created.  See *note
create-server::.

'DROP SERVER' causes an implicit commit.  See *note implicit-commit::.

'DROP SERVER' is not written to the binary log, regardless of the
logging format that is in use.


File: manual.info.tmp,  Node: drop-table,  Next: drop-tablespace,  Prev: drop-server,  Up: sql-data-definition-statements

13.1.28 DROP TABLE Statement
----------------------------

     DROP [TEMPORARY] TABLE [IF EXISTS]
         TBL_NAME [, TBL_NAME] ...
         [RESTRICT | CASCADE]

*note 'DROP TABLE': drop-table. removes one or more tables.  You must
have the 'DROP' privilege for each table.

_Be careful_ with this statement!  For each table, it removes the table
definition and all table data.  If the table is partitioned, the
statement removes the table definition, all its partitions, all data
stored in those partitions, and all partition definitions associated
with the dropped table.

Dropping a table also drops any triggers for the table.

*note 'DROP TABLE': drop-table. causes an implicit commit, except when
used with the 'TEMPORARY' keyword.  See *note implicit-commit::.

*Important*:

When a table is dropped, privileges granted specifically for the table
are _not_ automatically dropped.  They must be dropped manually.  See
*note grant::.

If any tables named in the argument list do not exist, *note 'DROP
TABLE': drop-table. behavior depends on whether the 'IF EXISTS' clause
is given:

   * Without 'IF EXISTS', the statement drops all named tables that do
     exist, and returns an error indicating which nonexisting tables it
     was unable to drop.

   * With 'IF EXISTS', no error occurs for nonexisting tables.  The
     statement drops all named tables that do exist, and generates a
     'NOTE' diagnostic for each nonexistent table.  These notes can be
     displayed with *note 'SHOW WARNINGS': show-warnings.  See *note
     show-warnings::.

'IF EXISTS' can also be useful for dropping tables in unusual
circumstances under which there is an '.frm' file but no table managed
by the storage engine.  (For example, if an abnormal server exit occurs
after removal of the table from the storage engine but before '.frm'
file removal.)

The 'TEMPORARY' keyword has the following effects:

   * The statement drops only 'TEMPORARY' tables.

   * The statement does not cause an implicit commit.

   * No access rights are checked.  A 'TEMPORARY' table is visible only
     with the session that created it, so no check is necessary.

Including the 'TEMPORARY' keyword is a good way to prevent accidentally
dropping non-'TEMPORARY' tables.

The 'RESTRICT' and 'CASCADE' keywords do nothing.  They are permitted to
make porting easier from other database systems.


File: manual.info.tmp,  Node: drop-tablespace,  Next: drop-trigger,  Prev: drop-table,  Up: sql-data-definition-statements

13.1.29 DROP TABLESPACE Statement
---------------------------------

     DROP TABLESPACE TABLESPACE_NAME
         ENGINE [=] ENGINE_NAME

This statement drops a tablespace that was previously created using
*note 'CREATE TABLESPACE': create-tablespace. (see *note
create-tablespace::).

*Important*:

The tablespace to be dropped must not contain any data files; in other
words, before you can drop a tablespace, you must first drop each of its
data files using 'ALTER TABLESPACE ... DROP DATAFILE' (see *note
alter-tablespace::).

The 'ENGINE' clause (required) specifies the storage engine used by the
tablespace.  Currently, the only accepted values for ENGINE_NAME are
*note 'NDB': mysql-cluster. and *note 'NDBCLUSTER': mysql-cluster.

*note 'DROP TABLESPACE': drop-tablespace. is useful only with Disk Data
storage for NDB Cluster.  See *note mysql-cluster-disk-data::.


File: manual.info.tmp,  Node: drop-trigger,  Next: drop-view,  Prev: drop-tablespace,  Up: sql-data-definition-statements

13.1.30 DROP TRIGGER Statement
------------------------------

     DROP TRIGGER [IF EXISTS] [SCHEMA_NAME.]TRIGGER_NAME

This statement drops a trigger.  The schema (database) name is optional.
If the schema is omitted, the trigger is dropped from the default
schema.  *note 'DROP TRIGGER': drop-trigger. requires the 'TRIGGER'
privilege for the table associated with the trigger.

Use 'IF EXISTS' to prevent an error from occurring for a trigger that
does not exist.  A 'NOTE' is generated for a nonexistent trigger when
using 'IF EXISTS'.  See *note show-warnings::.

Triggers for a table are also dropped if you drop the table.

*Note*:

When upgrading from a version of MySQL older than MySQL 5.0.10 to 5.0.10
or higher--including all MySQL 5.5 releases--you must drop all triggers
and re-create them.  Otherwise, *note 'DROP TRIGGER': drop-trigger. does
not work for older triggers after the upgrade.  See *note
upgrading-from-previous-series::, for a suggested upgrade procedure.


File: manual.info.tmp,  Node: drop-view,  Next: rename-table,  Prev: drop-trigger,  Up: sql-data-definition-statements

13.1.31 DROP VIEW Statement
---------------------------

     DROP VIEW [IF EXISTS]
         VIEW_NAME [, VIEW_NAME] ...
         [RESTRICT | CASCADE]

*note 'DROP VIEW': drop-view. removes one or more views.  You must have
the 'DROP' privilege for each view.

If any views named in the argument list do not exist, the statement
returns an error indicating by name which nonexisting views it was
unable to drop, but also drops all views in the list that do exist.

The 'IF EXISTS' clause prevents an error from occurring for views that
don't exist.  When this clause is given, a 'NOTE' is generated for each
nonexistent view.  See *note show-warnings::.

'RESTRICT' and 'CASCADE', if given, are parsed and ignored.


File: manual.info.tmp,  Node: rename-table,  Next: truncate-table,  Prev: drop-view,  Up: sql-data-definition-statements

13.1.32 RENAME TABLE Statement
------------------------------

     RENAME TABLE
         TBL_NAME TO NEW_TBL_NAME
         [, TBL_NAME2 TO NEW_TBL_NAME2] ...

*note 'RENAME TABLE': rename-table. renames one or more tables.  You
must have 'ALTER' and 'DROP' privileges for the original table, and
'CREATE' and 'INSERT' privileges for the new table.

For example, to rename a table named 'old_table' to 'new_table', use
this statement:

     RENAME TABLE old_table TO new_table;

That statement is equivalent to the following *note 'ALTER TABLE':
alter-table. statement:

     ALTER TABLE old_table RENAME new_table;

'RENAME TABLE', unlike *note 'ALTER TABLE': alter-table, can rename
multiple tables within a single statement:

     RENAME TABLE old_table1 TO new_table1,
                  old_table2 TO new_table2,
                  old_table3 TO new_table3;

Renaming operations are performed left to right.  Thus, to swap two
table names, do this (assuming that a table with the intermediary name
'tmp_table' does not already exist):

     RENAME TABLE old_table TO tmp_table,
                  new_table TO old_table,
                  tmp_table TO new_table;

Metadata locks on tables are acquired in name order, which in some cases
can make a difference in operation outcome when multiple transactions
execute concurrently.  See *note metadata-locking::.

To execute 'RENAME TABLE', there must be no active transactions or
tables locked with 'LOCK TABLES'.  With the transaction table locking
conditions satisfied, the rename operation is done atomically; no other
session can access any of the tables while the rename is in progress.

If any errors occur during a 'RENAME TABLE', the statement fails and no
changes are made.

You can use 'RENAME TABLE' to move a table from one database to another:

     RENAME TABLE CURRENT_DB.TBL_NAME TO OTHER_DB.TBL_NAME;

Using this method to move all tables from one database to a different
one in effect renames the database (an operation for which MySQL has no
single statement), except that the original database continues to exist,
albeit with no tables.

Like 'RENAME TABLE', 'ALTER TABLE ... RENAME' can also be used to move a
table to a different database.  Regardless of the statement used, if the
rename operation would move the table to a database located on a
different file system, the success of the outcome is platform specific
and depends on the underlying operating system calls used to move table
files.

If a table has triggers, attempts to rename the table into a different
database fail with a 'Trigger in wrong schema'
('ER_TRG_IN_WRONG_SCHEMA') error.

To rename 'TEMPORARY' tables, 'RENAME TABLE' does not work.  Use *note
'ALTER TABLE': alter-table. instead.

'RENAME TABLE' works for views, except that views cannot be renamed into
a different database.

Any privileges granted specifically for a renamed table or view are not
migrated to the new name.  They must be changed manually.

'RENAME TABLE TBL_NAME TO NEW_TBL_NAME' changes internally generated
foreign key constraint names and user-defined foreign key constraint
names that begin with the string 'TBL_NAME_ibfk_' to reflect the new
table name.  'InnoDB' interprets foreign key constraint names that begin
with the string 'TBL_NAME_ibfk_' as internally generated names.

Foreign key constraint names that point to the renamed table are
automatically updated unless there is a conflict, in which case the
statement fails with an error.  A conflict occurs if the renamed
constraint name already exists.  In such cases, you must drop and
re-create the foreign keys for them to function properly.


File: manual.info.tmp,  Node: truncate-table,  Prev: rename-table,  Up: sql-data-definition-statements

13.1.33 TRUNCATE TABLE Statement
--------------------------------

     TRUNCATE [TABLE] TBL_NAME

*note 'TRUNCATE TABLE': truncate-table. empties a table completely.  It
requires the 'DROP' privilege.

Logically, *note 'TRUNCATE TABLE': truncate-table. is similar to a *note
'DELETE': delete. statement that deletes all rows, or a sequence of
*note 'DROP TABLE': drop-table. and *note 'CREATE TABLE': create-table.
statements.  To achieve high performance, it bypasses the DML method of
deleting data.  Thus, it cannot be rolled back, it does not cause 'ON
DELETE' triggers to fire, and it cannot be performed for 'InnoDB' tables
with parent-child foreign key relationships.

Although *note 'TRUNCATE TABLE': truncate-table. is similar to *note
'DELETE': delete, it is classified as a DDL statement rather than a DML
statement.  It differs from *note 'DELETE': delete. in the following
ways:

   * Truncate operations drop and re-create the table, which is much
     faster than deleting rows one by one, particularly for large
     tables.

   * Truncate operations cause an implicit commit, and so cannot be
     rolled back.  See *note implicit-commit::.

   * Truncation operations cannot be performed if the session holds an
     active table lock.

   * *note 'TRUNCATE TABLE': truncate-table. fails for an 'InnoDB' table
     if there are any 'FOREIGN KEY' constraints from other tables that
     reference the table.  Foreign key constraints between columns of
     the same table are permitted.

   * Truncation operations do not return a meaningful value for the
     number of deleted rows.  The usual result is '0 rows affected,'
     which should be interpreted as 'no information.'

   * As long as the table format file 'TBL_NAME.frm' is valid, the table
     can be re-created as an empty table with *note 'TRUNCATE TABLE':
     truncate-table, even if the data or index files have become
     corrupted.

   * Any 'AUTO_INCREMENT' value is reset to its start value.  This is
     true even for 'MyISAM' and 'InnoDB', which normally do not reuse
     sequence values.

   * When used with partitioned tables, *note 'TRUNCATE TABLE':
     truncate-table. preserves the partitioning; that is, the data and
     index files are dropped and re-created, while the partition
     definitions ('.par') file is unaffected.

   * The *note 'TRUNCATE TABLE': truncate-table. statement does not
     invoke 'ON DELETE' triggers.

*note 'TRUNCATE TABLE': truncate-table. for a table closes all handlers
for the table that were opened with *note 'HANDLER OPEN': handler.

*note 'TRUNCATE TABLE': truncate-table. is treated for purposes of
binary logging and replication as *note 'DROP TABLE': drop-table.
followed by *note 'CREATE TABLE': create-table.--that is, as DDL rather
than DML. This is due to the fact that, when using *note 'InnoDB':
innodb-storage-engine. and other transactional storage engines where the
transaction isolation level does not permit statement-based logging
('READ COMMITTED' or 'READ UNCOMMITTED'), the statement was not logged
and replicated when using 'STATEMENT' or 'MIXED' logging mode.  (Bug
#36763) However, it is still applied on replication slaves using *note
'InnoDB': innodb-storage-engine. in the manner described previously.

On a system with a large 'InnoDB' buffer pool and
'innodb_adaptive_hash_index' enabled, 'TRUNCATE TABLE' operations may
cause a temporary drop in system performance due to an LRU scan that
occurs when removing an 'InnoDB' table's adaptive hash index entries.
The problem was addressed for *note 'DROP TABLE': drop-table. in MySQL
5.5.23 (Bug #13704145, Bug #64284) but remains a known issue for
'TRUNCATE TABLE' (Bug #68184).

*note 'TRUNCATE TABLE': truncate-table. can be used with Performance
Schema summary tables, but the effect is to reset the summary columns to
0 or 'NULL', not to remove rows.  See *note
performance-schema-summary-tables::.


File: manual.info.tmp,  Node: sql-data-manipulation-statements,  Next: sql-transactional-statements,  Prev: sql-data-definition-statements,  Up: sql-statements

13.2 Data Manipulation Statements
=================================

* Menu:

* call::                         CALL Statement
* delete::                       DELETE Statement
* do::                           DO Statement
* handler::                      HANDLER Statement
* insert::                       INSERT Statement
* load-data::                    LOAD DATA Statement
* load-xml::                     LOAD XML Statement
* replace::                      REPLACE Statement
* select::                       SELECT Statement
* subqueries::                   Subqueries
* update::                       UPDATE Statement


File: manual.info.tmp,  Node: call,  Next: delete,  Prev: sql-data-manipulation-statements,  Up: sql-data-manipulation-statements

13.2.1 CALL Statement
---------------------

     CALL SP_NAME([PARAMETER[,...]])
     CALL SP_NAME[()]

The *note 'CALL': call. statement invokes a stored procedure that was
defined previously with *note 'CREATE PROCEDURE': create-procedure.

Stored procedures that take no arguments can be invoked without
parentheses.  That is, 'CALL p()' and 'CALL p' are equivalent.

*note 'CALL': call. can pass back values to its caller using parameters
that are declared as 'OUT' or 'INOUT' parameters.  When the procedure
returns, a client program can also obtain the number of rows affected
for the final statement executed within the routine: At the SQL level,
call the 'ROW_COUNT()' function; from the C API, call the *note
'mysql_affected_rows()': mysql-affected-rows. function.

For information about the effect of unhandled conditions on procedure
parameters, see *note conditions-and-parameters::.

To get back a value from a procedure using an 'OUT' or 'INOUT'
parameter, pass the parameter by means of a user variable, and then
check the value of the variable after the procedure returns.  (If you
are calling the procedure from within another stored procedure or
function, you can also pass a routine parameter or local routine
variable as an 'IN' or 'INOUT' parameter.)  For an 'INOUT' parameter,
initialize its value before passing it to the procedure.  The following
procedure has an 'OUT' parameter that the procedure sets to the current
server version, and an 'INOUT' value that the procedure increments by
one from its current value:

     CREATE PROCEDURE p (OUT ver_param VARCHAR(25), INOUT incr_param INT)
     BEGIN
       # Set value of OUT parameter
       SELECT VERSION() INTO ver_param;
       # Increment value of INOUT parameter
       SET incr_param = incr_param + 1;
     END;

Before calling the procedure, initialize the variable to be passed as
the 'INOUT' parameter.  After calling the procedure, the values of the
two variables will have been set or modified:

     mysql> SET @increment = 10;
     mysql> CALL p(@version, @increment);
     mysql> SELECT @version, @increment;
     +------------------+------------+
     | @version         | @increment |
     +------------------+------------+
     | 5.5.58-debug-log |         11 |
     +------------------+------------+

In prepared *note 'CALL': call. statements used with *note 'PREPARE':
prepare. and *note 'EXECUTE': execute, placeholders can be used for 'IN'
parameters, 'OUT', and 'INOUT' parameters.  These types of parameters
can be used as follows:

     mysql> SET @increment = 10;
     mysql> PREPARE s FROM 'CALL p(?, ?)';
     mysql> EXECUTE s USING @version, @increment;
     mysql> SELECT @version, @increment;
     +------------------+------------+
     | @version         | @increment |
     +------------------+------------+
     | 5.5.58-debug-log |         11 |
     +------------------+------------+

To write C programs that use the *note 'CALL': call. SQL statement to
execute stored procedures that produce result sets, the
'CLIENT_MULTI_RESULTS' flag must be enabled.  This is because each *note
'CALL': call. returns a result to indicate the call status, in addition
to any result sets that might be returned by statements executed within
the procedure.  'CLIENT_MULTI_RESULTS' must also be enabled if *note
'CALL': call. is used to execute any stored procedure that contains
prepared statements.  It cannot be determined when such a procedure is
loaded whether those statements will produce result sets, so it is
necessary to assume that they will.

'CLIENT_MULTI_RESULTS' can be enabled when you call *note
'mysql_real_connect()': mysql-real-connect, either explicitly by passing
the 'CLIENT_MULTI_RESULTS' flag itself, or implicitly by passing
'CLIENT_MULTI_STATEMENTS' (which also enables 'CLIENT_MULTI_RESULTS').
'CLIENT_MULTI_RESULTS' is enabled by default.

To process the result of a *note 'CALL': call. statement executed using
*note 'mysql_query()': mysql-query. or *note 'mysql_real_query()':
mysql-real-query, use a loop that calls *note 'mysql_next_result()':
mysql-next-result. to determine whether there are more results.  For an
example, see *note c-api-multiple-queries::.

C programs can use the prepared-statement interface to execute *note
'CALL': call. statements and access 'OUT' and 'INOUT' parameters.  This
is done by processing the result of a *note 'CALL': call. statement
using a loop that calls *note 'mysql_stmt_next_result()':
mysql-stmt-next-result. to determine whether there are more results.
For an example, see *note c-api-prepared-call-statements::.  Languages
that provide a MySQL interface can use prepared *note 'CALL': call.
statements to directly retrieve 'OUT' and 'INOUT' procedure parameters.


File: manual.info.tmp,  Node: delete,  Next: do,  Prev: call,  Up: sql-data-manipulation-statements

13.2.2 DELETE Statement
-----------------------

*note 'DELETE': delete. is a DML statement that removes rows from a
table.

Single-table syntax:

     DELETE [LOW_PRIORITY] [QUICK] [IGNORE] FROM TBL_NAME
         [WHERE WHERE_CONDITION]
         [ORDER BY ...]
         [LIMIT ROW_COUNT]

Multiple-table syntax:

     DELETE [LOW_PRIORITY] [QUICK] [IGNORE]
         TBL_NAME[.*] [, TBL_NAME[.*]] ...
         FROM TABLE_REFERENCES
         [WHERE WHERE_CONDITION]

     DELETE [LOW_PRIORITY] [QUICK] [IGNORE]
         FROM TBL_NAME[.*] [, TBL_NAME[.*]] ...
         USING TABLE_REFERENCES
         [WHERE WHERE_CONDITION]

For the single-table syntax, the *note 'DELETE': delete. statement
deletes rows from TBL_NAME and returns a count of the number of deleted
rows.  This count can be obtained by calling the 'ROW_COUNT()' function
(see *note information-functions::).  The 'WHERE' clause, if given,
specifies the conditions that identify which rows to delete.  With no
'WHERE' clause, all rows are deleted.  If the 'ORDER BY' clause is
specified, the rows are deleted in the order that is specified.  The
'LIMIT' clause places a limit on the number of rows that can be deleted.

For the multiple-table syntax, *note 'DELETE': delete. deletes from each
TBL_NAME the rows that satisfy the conditions.  In this case, 'ORDER BY'
and 'LIMIT' cannot be used.

WHERE_CONDITION is an expression that evaluates to true for each row to
be deleted.  It is specified as described in *note select::.

You cannot delete from a table and select from the same table in a
subquery.

You need the 'DELETE' privilege on a table to delete rows from it.  You
need only the 'SELECT' privilege for any columns that are only read,
such as those named in the 'WHERE' clause.

As stated, a *note 'DELETE': delete. statement with no 'WHERE' clause
deletes all rows.  A faster way to do this, when you do not need to know
the number of deleted rows, is to use *note 'TRUNCATE TABLE':
truncate-table.  However, within a transaction or if you have a lock on
the table, *note 'TRUNCATE TABLE': truncate-table. cannot be used
whereas *note 'DELETE': delete. can.  See *note truncate-table::, and
*note lock-tables::.

If you delete the row containing the maximum value for an
'AUTO_INCREMENT' column, the value is not reused for a 'MyISAM' or
'InnoDB' table.  If you delete all rows in the table with 'DELETE FROM
TBL_NAME' (without a 'WHERE' clause) in 'autocommit' mode, the sequence
starts over for all storage engines except 'InnoDB' and 'MyISAM'.  There
are some exceptions to this behavior for 'InnoDB' tables, as discussed
in *note innodb-auto-increment-handling::.

For 'MyISAM' tables, you can specify an 'AUTO_INCREMENT' secondary
column in a multiple-column key.  In this case, reuse of values deleted
from the top of the sequence occurs even for 'MyISAM' tables.  See *note
example-auto-increment::.

The *note 'DELETE': delete. statement supports the following modifiers:

   * If you specify the 'LOW_PRIORITY' modifier, the server delays
     execution of the *note 'DELETE': delete. until no other clients are
     reading from the table.  This affects only storage engines that use
     only table-level locking (such as 'MyISAM', 'MEMORY', and 'MERGE').

   * For 'MyISAM' tables, if you use the 'QUICK' modifier, the storage
     engine does not merge index leaves during delete, which may speed
     up some kinds of delete operations.

   * The 'IGNORE' modifier causes MySQL to ignore errors during the
     process of deleting rows.  (Errors encountered during the parsing
     stage are processed in the usual manner.)  Errors that are ignored
     due to the use of 'IGNORE' are returned as warnings.

The speed of delete operations may also be affected by factors discussed
in *note delete-optimization::.

In 'MyISAM' tables, deleted rows are maintained in a linked list and
subsequent *note 'INSERT': insert. operations reuse old row positions.
To reclaim unused space and reduce file sizes, use the *note 'OPTIMIZE
TABLE': optimize-table. statement or the *note 'myisamchk': myisamchk.
utility to reorganize tables.  *note 'OPTIMIZE TABLE': optimize-table.
is easier to use, but *note 'myisamchk': myisamchk. is faster.  See
*note optimize-table::, and *note myisamchk::.

The 'QUICK' modifier affects whether index leaves are merged for delete
operations.  'DELETE QUICK' is most useful for applications where index
values for deleted rows are replaced by similar index values from rows
inserted later.  In this case, the holes left by deleted values are
reused.

'DELETE QUICK' is not useful when deleted values lead to underfilled
index blocks spanning a range of index values for which new inserts
occur again.  In this case, use of 'QUICK' can lead to wasted space in
the index that remains unreclaimed.  Here is an example of such a
scenario:

  1. Create a table that contains an indexed 'AUTO_INCREMENT' column.

  2. Insert many rows into the table.  Each insert results in an index
     value that is added to the high end of the index.

  3. Delete a block of rows at the low end of the column range using
     'DELETE QUICK'.

In this scenario, the index blocks associated with the deleted index
values become underfilled but are not merged with other index blocks due
to the use of 'QUICK'.  They remain underfilled when new inserts occur,
because new rows do not have index values in the deleted range.
Furthermore, they remain underfilled even if you later use *note
'DELETE': delete. without 'QUICK', unless some of the deleted index
values happen to lie in index blocks within or adjacent to the
underfilled blocks.  To reclaim unused index space under these
circumstances, use *note 'OPTIMIZE TABLE': optimize-table.

If you are going to delete many rows from a table, it might be faster to
use 'DELETE QUICK' followed by *note 'OPTIMIZE TABLE': optimize-table.
This rebuilds the index rather than performing many index block merge
operations.

The MySQL-specific 'LIMIT ROW_COUNT' option to *note 'DELETE': delete.
tells the server the maximum number of rows to be deleted before control
is returned to the client.  This can be used to ensure that a given
*note 'DELETE': delete. statement does not take too much time.  You can
simply repeat the *note 'DELETE': delete. statement until the number of
affected rows is less than the 'LIMIT' value.

If the *note 'DELETE': delete. statement includes an 'ORDER BY' clause,
rows are deleted in the order specified by the clause.  This is useful
primarily in conjunction with 'LIMIT'.  For example, the following
statement finds rows matching the 'WHERE' clause, sorts them by
'timestamp_column', and deletes the first (oldest) one:

     DELETE FROM somelog WHERE user = 'jcole'
     ORDER BY timestamp_column LIMIT 1;

'ORDER BY' may also be useful in some cases to delete rows in an order
required to avoid referential integrity violations.

If you are deleting many rows from a large table, you may exceed the
lock table size for an 'InnoDB' table.  To avoid this problem, or simply
to minimize the time that the table remains locked, the following
strategy (which does not use *note 'DELETE': delete. at all) might be
helpful:

  1. Select the rows _not_ to be deleted into an empty table that has
     the same structure as the original table:

          INSERT INTO t_copy SELECT * FROM t WHERE ... ;

  2. Use *note 'RENAME TABLE': rename-table. to atomically move the
     original table out of the way and rename the copy to the original
     name:

          RENAME TABLE t TO t_old, t_copy TO t;

  3. Drop the original table:

          DROP TABLE t_old;

No other sessions can access the tables involved while *note 'RENAME
TABLE': rename-table. executes, so the rename operation is not subject
to concurrency problems.  See *note rename-table::.

You can specify multiple tables in a *note 'DELETE': delete. statement
to delete rows from one or more tables depending on the condition in the
'WHERE' clause.  You cannot use 'ORDER BY' or 'LIMIT' in a
multiple-table 'DELETE'.  The TABLE_REFERENCES clause lists the tables
involved in the join, as described in *note join::.

For the first multiple-table syntax, only matching rows from the tables
listed before the 'FROM' clause are deleted.  For the second
multiple-table syntax, only matching rows from the tables listed in the
'FROM' clause (before the 'USING' clause) are deleted.  The effect is
that you can delete rows from many tables at the same time and have
additional tables that are used only for searching:

     DELETE t1, t2 FROM t1 INNER JOIN t2 INNER JOIN t3
     WHERE t1.id=t2.id AND t2.id=t3.id;

Or:

     DELETE FROM t1, t2 USING t1 INNER JOIN t2 INNER JOIN t3
     WHERE t1.id=t2.id AND t2.id=t3.id;

These statements use all three tables when searching for rows to delete,
but delete matching rows only from tables 't1' and 't2'.

The preceding examples use 'INNER JOIN', but multiple-table *note
'DELETE': delete. statements can use other types of join permitted in
*note 'SELECT': select. statements, such as 'LEFT JOIN'.  For example,
to delete rows that exist in 't1' that have no match in 't2', use a
'LEFT JOIN':

     DELETE t1 FROM t1 LEFT JOIN t2 ON t1.id=t2.id WHERE t2.id IS NULL;

The syntax permits '.*' after each TBL_NAME for compatibility with
'Access'.

If you use a multiple-table *note 'DELETE': delete. statement involving
'InnoDB' tables for which there are foreign key constraints, the MySQL
optimizer might process tables in an order that differs from that of
their parent/child relationship.  In this case, the statement fails and
rolls back.  Instead, you should delete from a single table and rely on
the 'ON DELETE' capabilities that 'InnoDB' provides to cause the other
tables to be modified accordingly.

*Note*:

If you declare an alias for a table, you must use the alias when
referring to the table:

     DELETE t1 FROM test AS t1, test2 WHERE ...

Table aliases in a multiple-table *note 'DELETE': delete. should be
declared only in the TABLE_REFERENCES part of the statement.  Elsewhere,
alias references are permitted but not alias declarations.

Correct:

     DELETE a1, a2 FROM t1 AS a1 INNER JOIN t2 AS a2
     WHERE a1.id=a2.id;

     DELETE FROM a1, a2 USING t1 AS a1 INNER JOIN t2 AS a2
     WHERE a1.id=a2.id;

Incorrect:

     DELETE t1 AS a1, t2 AS a2 FROM t1 INNER JOIN t2
     WHERE a1.id=a2.id;

     DELETE FROM t1 AS a1, t2 AS a2 USING t1 INNER JOIN t2
     WHERE a1.id=a2.id;


File: manual.info.tmp,  Node: do,  Next: handler,  Prev: delete,  Up: sql-data-manipulation-statements

13.2.3 DO Statement
-------------------

     DO EXPR [, EXPR] ...

*note 'DO': do. executes the expressions but does not return any
results.  In most respects, *note 'DO': do. is shorthand for 'SELECT
EXPR, ...', but has the advantage that it is slightly faster when you do
not care about the result.

*note 'DO': do. is useful primarily with functions that have side
effects, such as 'RELEASE_LOCK()'.

Example: This *note 'SELECT': select. statement pauses, but also
produces a result set:

     mysql> SELECT SLEEP(5);
     +----------+
     | SLEEP(5) |
     +----------+
     |        0 |
     +----------+
     1 row in set (5.02 sec)

*note 'DO': do, on the other hand, pauses without producing a result
set.:

     mysql> DO SLEEP(5);
     Query OK, 0 rows affected (4.99 sec)

This could be useful, for example in a stored function or trigger, which
prohibit statements that produce result sets.

*note 'DO': do. only executes expressions.  It cannot be used in all
cases where 'SELECT' can be used.  For example, 'DO id FROM t1' is
invalid because it references a table.


File: manual.info.tmp,  Node: handler,  Next: insert,  Prev: do,  Up: sql-data-manipulation-statements

13.2.4 HANDLER Statement
------------------------

     HANDLER TBL_NAME OPEN [ [AS] ALIAS]

     HANDLER TBL_NAME READ INDEX_NAME { = | <= | >= | < | > } (VALUE1,VALUE2,...)
         [ WHERE WHERE_CONDITION ] [LIMIT ... ]
     HANDLER TBL_NAME READ INDEX_NAME { FIRST | NEXT | PREV | LAST }
         [ WHERE WHERE_CONDITION ] [LIMIT ... ]
     HANDLER TBL_NAME READ { FIRST | NEXT }
         [ WHERE WHERE_CONDITION ] [LIMIT ... ]

     HANDLER TBL_NAME CLOSE

The 'HANDLER' statement provides direct access to table storage engine
interfaces.  It is available for 'InnoDB' and 'MyISAM' tables.

The 'HANDLER ... OPEN' statement opens a table, making it accessible
using subsequent 'HANDLER ... READ' statements.  This table object is
not shared by other sessions and is not closed until the session calls
'HANDLER ... CLOSE' or the session terminates.

If you open the table using an alias, further references to the open
table with other 'HANDLER' statements must use the alias rather than the
table name.  If you do not use an alias, but open the table using a
table name qualified by the database name, further references must use
the unqualified table name.  For example, for a table opened using
'mydb.mytable', further references must use 'mytable'.

The first 'HANDLER ... READ' syntax fetches a row where the index
specified satisfies the given values and the 'WHERE' condition is met.
If you have a multiple-column index, specify the index column values as
a comma-separated list.  Either specify values for all the columns in
the index, or specify values for a leftmost prefix of the index columns.
Suppose that an index 'my_idx' includes three columns named 'col_a',
'col_b', and 'col_c', in that order.  The 'HANDLER' statement can
specify values for all three columns in the index, or for the columns in
a leftmost prefix.  For example:

     HANDLER ... READ my_idx = (col_a_val,col_b_val,col_c_val) ...
     HANDLER ... READ my_idx = (col_a_val,col_b_val) ...
     HANDLER ... READ my_idx = (col_a_val) ...

To employ the 'HANDLER' interface to refer to a table's 'PRIMARY KEY',
use the quoted identifier '`PRIMARY`':

     HANDLER TBL_NAME READ `PRIMARY` ...

The second 'HANDLER ... READ' syntax fetches a row from the table in
index order that matches the 'WHERE' condition.

The third 'HANDLER ... READ' syntax fetches a row from the table in
natural row order that matches the 'WHERE' condition.  It is faster than
'HANDLER TBL_NAME READ INDEX_NAME' when a full table scan is desired.
Natural row order is the order in which rows are stored in a 'MyISAM'
table data file.  This statement works for 'InnoDB' tables as well, but
there is no such concept because there is no separate data file.

Without a 'LIMIT' clause, all forms of 'HANDLER ... READ' fetch a single
row if one is available.  To return a specific number of rows, include a
'LIMIT' clause.  It has the same syntax as for the *note 'SELECT':
select. statement.  See *note select::.

'HANDLER ... CLOSE' closes a table that was opened with 'HANDLER ...
OPEN'.

There are several reasons to use the 'HANDLER' interface instead of
normal *note 'SELECT': select. statements:

   * 'HANDLER' is faster than *note 'SELECT': select.:

        * A designated storage engine handler object is allocated for
          the 'HANDLER ... OPEN'.  The object is reused for subsequent
          'HANDLER' statements for that table; it need not be
          reinitialized for each one.

        * There is less parsing involved.

        * There is no optimizer or query-checking overhead.

        * The handler interface does not have to provide a consistent
          look of the data (for example, dirty reads are permitted), so
          the storage engine can use optimizations that *note 'SELECT':
          select. does not normally permit.

   * 'HANDLER' makes it easier to port to MySQL applications that use a
     low-level 'ISAM'-like interface.

   * 'HANDLER' enables you to traverse a database in a manner that is
     difficult (or even impossible) to accomplish with *note 'SELECT':
     select.  The 'HANDLER' interface is a more natural way to look at
     data when working with applications that provide an interactive
     user interface to the database.

'HANDLER' is a somewhat low-level statement.  For example, it does not
provide consistency.  That is, 'HANDLER ... OPEN' does _not_ take a
snapshot of the table, and does _not_ lock the table.  This means that
after a 'HANDLER ... OPEN' statement is issued, table data can be
modified (by the current session or other sessions) and these
modifications might be only partially visible to 'HANDLER ... NEXT' or
'HANDLER ... PREV' scans.

An open handler can be closed and marked for reopen, in which case the
handler loses its position in the table.  This occurs when both of the
following circumstances are true:

   * Any session executes 'FLUSH TABLES' or DDL statements on the
     handler's table.

   * The session in which the handler is open executes non-'HANDLER'
     statements that use tables.

*note 'TRUNCATE TABLE': truncate-table. for a table closes all handlers
for the table that were opened with *note 'HANDLER OPEN': handler.

If a table is flushed with 'FLUSH TABLES TBL_NAME WITH READ LOCK' was
opened with 'HANDLER', the handler is implicitly flushed and loses its
position.

'HANDLER' is not supported with partitioned tables.


File: manual.info.tmp,  Node: insert,  Next: load-data,  Prev: handler,  Up: sql-data-manipulation-statements

13.2.5 INSERT Statement
-----------------------

* Menu:

* insert-select::                INSERT ... SELECT Statement
* insert-on-duplicate::          INSERT ... ON DUPLICATE KEY UPDATE Statement
* insert-delayed::               INSERT DELAYED Statement

     INSERT [LOW_PRIORITY | DELAYED | HIGH_PRIORITY] [IGNORE]
         [INTO] TBL_NAME
         [(COL_NAME [, COL_NAME] ...)]
         {VALUES | VALUE} (VALUE_LIST) [, (VALUE_LIST)] ...
         [ON DUPLICATE KEY UPDATE ASSIGNMENT_LIST]

     INSERT [LOW_PRIORITY | DELAYED | HIGH_PRIORITY] [IGNORE]
         [INTO] TBL_NAME
         SET ASSIGNMENT_LIST
         [ON DUPLICATE KEY UPDATE ASSIGNMENT_LIST]

     INSERT [LOW_PRIORITY | HIGH_PRIORITY] [IGNORE]
         [INTO] TBL_NAME
         [(COL_NAME [, COL_NAME] ...)]
         SELECT ...
         [ON DUPLICATE KEY UPDATE ASSIGNMENT_LIST]

     VALUE:
         {EXPR | DEFAULT}

     VALUE_LIST:
         VALUE [, VALUE] ...

     ASSIGNMENT:
         COL_NAME = VALUE

     ASSIGNMENT_LIST:
         ASSIGNMENT [, ASSIGNMENT] ...

*note 'INSERT': insert. inserts new rows into an existing table.  The
*note 'INSERT ... VALUES': insert. and *note 'INSERT ... SET': insert.
forms of the statement insert rows based on explicitly specified values.
The *note 'INSERT ... SELECT': insert-select. form inserts rows selected
from another table or tables.  *note 'INSERT': insert. with an 'ON
DUPLICATE KEY UPDATE' clause enables existing rows to be updated if a
row to be inserted would cause a duplicate value in a 'UNIQUE' index or
'PRIMARY KEY'.

For additional information about *note 'INSERT ... SELECT':
insert-select. and *note 'INSERT ... ON DUPLICATE KEY UPDATE':
insert-on-duplicate, see *note insert-select::, and *note
insert-on-duplicate::.

Inserting into a table requires the 'INSERT' privilege for the table.
If the 'ON DUPLICATE KEY UPDATE' clause is used and a duplicate key
causes an *note 'UPDATE': update. to be performed instead, the statement
requires the 'UPDATE' privilege for the columns to be updated.  For
columns that are read but not modified you need only the 'SELECT'
privilege (such as for a column referenced only on the right hand side
of an COL_NAME=EXPR assignment in an 'ON DUPLICATE KEY UPDATE' clause).

You can use *note 'REPLACE': replace. instead of *note 'INSERT': insert.
to overwrite old rows.  *note 'REPLACE': replace. is the counterpart to
*note 'INSERT IGNORE': insert. in the treatment of new rows that contain
unique key values that duplicate old rows: The new rows replace the old
rows rather than being discarded.  See *note replace::.

TBL_NAME is the table into which rows should be inserted.  Specify the
columns for which the statement provides values as follows:

   * Provide a parenthesized list of comma-separated column names
     following the table name.  In this case, a value for each named
     column must be provided by the 'VALUES' list or the *note 'SELECT':
     select. statement.

   * If you do not specify a list of column names for *note 'INSERT ...
     VALUES': insert. or *note 'INSERT ... SELECT': insert-select,
     values for every column in the table must be provided by the
     'VALUES' list or the *note 'SELECT': select. statement.  If you do
     not know the order of the columns in the table, use 'DESCRIBE
     TBL_NAME' to find out.

   * A 'SET' clause indicates columns explicitly by name, together with
     the value to assign each one.

Column values can be given in several ways:

   * If strict SQL mode is not enabled, any column not explicitly given
     a value is set to its default (explicit or implicit) value.  For
     example, if you specify a column list that does not name all the
     columns in the table, unnamed columns are set to their default
     values.  Default value assignment is described in *note
     data-type-defaults::.  See also *note constraint-invalid-data::.

     If strict SQL mode is enabled, an *note 'INSERT': insert. statement
     generates an error if it does not specify an explicit value for
     every column that has no default value.  See *note sql-mode::.

   * If both the column list and the 'VALUES' list are empty, *note
     'INSERT': insert. creates a row with each column set to its default
     value:

          INSERT INTO TBL_NAME () VALUES();

     If strict mode is not enabled, MySQL uses the implicit default
     value for any column that has no explicitly defined default.  If
     strict mode is enabled, an error occurs if any column has no
     default value.

   * Use the keyword 'DEFAULT' to set a column explicitly to its default
     value.  This makes it easier to write *note 'INSERT': insert.
     statements that assign values to all but a few columns, because it
     enables you to avoid writing an incomplete 'VALUES' list that does
     not include a value for each column in the table.  Otherwise, you
     must provide the list of column names corresponding to each value
     in the 'VALUES' list.

   * In expressions, you can use 'DEFAULT(COL_NAME)' to produce the
     default value for column COL_NAME.

   * Type conversion of an expression EXPR that provides a column value
     might occur if the expression data type does not match the column
     data type.  Conversion of a given value can result in different
     inserted values depending on the column type.  For example,
     inserting the string ''1999.0e-2'' into an *note 'INT':
     integer-types, *note 'FLOAT': floating-point-types, *note
     'DECIMAL(10,6)': fixed-point-types, or *note 'YEAR': year. column
     inserts the value '1999', '19.9921', '19.992100', or '1999',
     respectively.  The value stored in the *note 'INT': integer-types.
     and *note 'YEAR': year. columns is '1999' because the
     string-to-number conversion looks only at as much of the initial
     part of the string as may be considered a valid integer or year.
     For the *note 'FLOAT': floating-point-types. and *note 'DECIMAL':
     fixed-point-types. columns, the string-to-number conversion
     considers the entire string a valid numeric value.

   * An expression EXPR can refer to any column that was set earlier in
     a value list.  For example, you can do this because the value for
     'col2' refers to 'col1', which has previously been assigned:

          INSERT INTO TBL_NAME (col1,col2) VALUES(15,col1*2);

     But the following is not legal, because the value for 'col1' refers
     to 'col2', which is assigned after 'col1':

          INSERT INTO TBL_NAME (col1,col2) VALUES(col2*2,15);

     An exception occurs for columns that contain 'AUTO_INCREMENT'
     values.  Because 'AUTO_INCREMENT' values are generated after other
     value assignments, any reference to an 'AUTO_INCREMENT' column in
     the assignment returns a '0'.

*note 'INSERT': insert. statements that use 'VALUES' syntax can insert
multiple rows.  To do this, include multiple lists of comma-separated
column values, with lists enclosed within parentheses and separated by
commas.  Example:

     INSERT INTO TBL_NAME (a,b,c) VALUES(1,2,3),(4,5,6),(7,8,9);

Each values list must contain exactly as many values as are to be
inserted per row.  The following statement is invalid because it
contains one list of nine values, rather than three lists of three
values each:

     INSERT INTO TBL_NAME (a,b,c) VALUES(1,2,3,4,5,6,7,8,9);

'VALUE' is a synonym for 'VALUES' in this context.  Neither implies
anything about the number of values lists, nor about the number of
values per list.  Either may be used whether there is a single values
list or multiple lists, and regardless of the number of values per list.

The affected-rows value for an *note 'INSERT': insert. can be obtained
using the 'ROW_COUNT()' SQL function or the *note
'mysql_affected_rows()': mysql-affected-rows. C API function.  See *note
information-functions::, and *note mysql-affected-rows::.

If you use an *note 'INSERT ... VALUES': insert. statement with multiple
value lists or *note 'INSERT ... SELECT': insert-select, the statement
returns an information string in this format:

     Records: N1 Duplicates: N2 Warnings: N3

If you are using the C API, the information string can be obtained by
invoking the *note 'mysql_info()': mysql-info. function.  See *note
mysql-info::.

'Records' indicates the number of rows processed by the statement.
(This is not necessarily the number of rows actually inserted because
'Duplicates' can be nonzero.)  'Duplicates' indicates the number of rows
that could not be inserted because they would duplicate some existing
unique index value.  'Warnings' indicates the number of attempts to
insert column values that were problematic in some way.  Warnings can
occur under any of the following conditions:

   * Inserting 'NULL' into a column that has been declared 'NOT NULL'.
     For multiple-row *note 'INSERT': insert. statements or *note
     'INSERT INTO ... SELECT': insert-select. statements, the column is
     set to the implicit default value for the column data type.  This
     is '0' for numeric types, the empty string ('''') for string types,
     and the 'zero' value for date and time types.  *note 'INSERT INTO
     ... SELECT': insert-select. statements are handled the same way as
     multiple-row inserts because the server does not examine the result
     set from the *note 'SELECT': select. to see whether it returns a
     single row.  (For a single-row *note 'INSERT': insert, no warning
     occurs when 'NULL' is inserted into a 'NOT NULL' column.  Instead,
     the statement fails with an error.)

   * Setting a numeric column to a value that lies outside the column's
     range.  The value is clipped to the closest endpoint of the range.

   * Assigning a value such as ''10.34 a'' to a numeric column.  The
     trailing nonnumeric text is stripped off and the remaining numeric
     part is inserted.  If the string value has no leading numeric part,
     the column is set to '0'.

   * Inserting a string into a string column (*note 'CHAR': char, *note
     'VARCHAR': char, *note 'TEXT': blob, or *note 'BLOB': blob.) that
     exceeds the column's maximum length.  The value is truncated to the
     column's maximum length.

   * Inserting a value into a date or time column that is illegal for
     the data type.  The column is set to the appropriate zero value for
     the type.

   * For *note 'INSERT': insert. examples involving 'AUTO_INCREMET'
     column values, see *note example-auto-increment::.

     If *note 'INSERT': insert. inserts a row into a table that has an
     'AUTO_INCREMENT' column, you can find the value used for that
     column by using the 'LAST_INSERT_ID()' SQL function or the *note
     'mysql_insert_id()': mysql-insert-id. C API function.

     *Note*:

     These two functions do not always behave identically.  The behavior
     of *note 'INSERT': insert. statements with respect to
     'AUTO_INCREMENT' columns is discussed further in *note
     information-functions::, and *note mysql-insert-id::.

The *note 'INSERT': insert. statement supports the following modifiers:

   * If you use the 'DELAYED' modifier, the server puts the row or rows
     to be inserted into a buffer, and the client issuing the *note
     'INSERT DELAYED': insert-delayed. statement can then continue
     immediately.  If the table is in use, the server holds the rows.
     When the table is free, the server begins inserting rows, checking
     periodically to see whether there are any new read requests for the
     table.  If there are, the delayed row queue is suspended until the
     table becomes free again.  See *note insert-delayed::.

     'DELAYED' is ignored with *note 'INSERT ... SELECT': insert-select.
     or *note 'INSERT ... ON DUPLICATE KEY UPDATE': insert-on-duplicate.

     'DELAYED' is also disregarded for an *note 'INSERT': insert. that
     uses functions accessing tables or triggers, or that is called from
     a function or a trigger.

   * If you use the 'LOW_PRIORITY' modifier, execution of the *note
     'INSERT': insert. is delayed until no other clients are reading
     from the table.  This includes other clients that began reading
     while existing clients are reading, and while the 'INSERT
     LOW_PRIORITY' statement is waiting.  It is possible, therefore, for
     a client that issues an 'INSERT LOW_PRIORITY' statement to wait for
     a very long time (or even forever) in a read-heavy environment.
     (This is in contrast to *note 'INSERT DELAYED': insert-delayed,
     which lets the client continue at once.)

     'LOW_PRIORITY' affects only storage engines that use only
     table-level locking (such as 'MyISAM', 'MEMORY', and 'MERGE').

     *Note*:

     'LOW_PRIORITY' should normally not be used with 'MyISAM' tables
     because doing so disables concurrent inserts.  See *note
     concurrent-inserts::.

   * If you specify 'HIGH_PRIORITY', it overrides the effect of the
     '--low-priority-updates' option if the server was started with that
     option.  It also causes concurrent inserts not to be used.  See
     *note concurrent-inserts::.

     'HIGH_PRIORITY' affects only storage engines that use only
     table-level locking (such as 'MyISAM', 'MEMORY', and 'MERGE').

   * If you use the 'IGNORE' modifier, errors that occur while executing
     the *note 'INSERT': insert. statement are ignored.  For example,
     without 'IGNORE', a row that duplicates an existing 'UNIQUE' index
     or 'PRIMARY KEY' value in the table causes a duplicate-key error
     and the statement is aborted.  With 'IGNORE', the row is discarded
     and no error occurs.  Ignored errors may generate warnings instead,
     although duplicate-key errors do not.

     'IGNORE' has a similar effect on inserts into partitioned tables
     where no partition matching a given value is found.  Without
     'IGNORE', such *note 'INSERT': insert. statements are aborted with
     an error.  When *note 'INSERT IGNORE': insert. is used, the insert
     operation fails silently for rows containing the unmatched value,
     but inserts rows that are matched.  For an example, see *note
     partitioning-list::.

     Data conversions that would trigger errors abort the statement if
     'IGNORE' is not specified.  With 'IGNORE', invalid values are
     adjusted to the closest values and inserted; warnings are produced
     but the statement does not abort.  You can determine with the *note
     'mysql_info()': mysql-info. C API function how many rows were
     actually inserted into the table.

   * If you specify 'ON DUPLICATE KEY UPDATE', and a row is inserted
     that would cause a duplicate value in a 'UNIQUE' index or 'PRIMARY
     KEY', an *note 'UPDATE': update. of the old row occurs.  The
     affected-rows value per row is 1 if the row is inserted as a new
     row, 2 if an existing row is updated, and 0 if an existing row is
     set to its current values.  If you specify the 'CLIENT_FOUND_ROWS'
     flag to the *note 'mysql_real_connect()': mysql-real-connect. C API
     function when connecting to *note 'mysqld': mysqld, the
     affected-rows value is 1 (not 0) if an existing row is set to its
     current values.  See *note insert-on-duplicate::.

An 'INSERT' statement affecting a partitioned table using a storage
engine such as *note 'MyISAM': myisam-storage-engine. that employs
table-level locks locks all partitions of the table.  This does not
occur with tables using storage engines such as *note 'InnoDB':
innodb-storage-engine. that employ row-level locking.  This issue is
resolved in MySQL 5.6.  For more information, see *note
partitioning-limitations-locking::.


File: manual.info.tmp,  Node: insert-select,  Next: insert-on-duplicate,  Prev: insert,  Up: insert

13.2.5.1 INSERT ... SELECT Statement
....................................

     INSERT [LOW_PRIORITY | HIGH_PRIORITY] [IGNORE]
         [INTO] TBL_NAME
         [(COL_NAME [, COL_NAME] ...)]
         SELECT ...
         [ON DUPLICATE KEY UPDATE ASSIGNMENT_LIST]

     VALUE:
         {EXPR | DEFAULT}

     ASSIGNMENT:
         COL_NAME = VALUE

     ASSIGNMENT_LIST:
         ASSIGNMENT [, ASSIGNMENT] ...

With *note 'INSERT ... SELECT': insert-select, you can quickly insert
many rows into a table from the result of a *note 'SELECT': select.
statement, which can select from one or many tables.  For example:

     INSERT INTO tbl_temp2 (fld_id)
       SELECT tbl_temp1.fld_order_id
       FROM tbl_temp1 WHERE tbl_temp1.fld_order_id > 100;

The following conditions hold for *note 'INSERT ... SELECT':
insert-select. statements:

   * Specify 'IGNORE' to ignore rows that would cause duplicate-key
     violations.

   * 'DELAYED' is ignored with *note 'INSERT ... SELECT': insert-select.

   * The target table of the *note 'INSERT': insert. statement may
     appear in the 'FROM' clause of the *note 'SELECT': select. part of
     the query.  However, you cannot insert into a table and select from
     the same table in a subquery.

     When selecting from and inserting into the same table, MySQL
     creates an internal temporary table to hold the rows from the *note
     'SELECT': select. and then inserts those rows into the target
     table.  However, you cannot use 'INSERT INTO t ... SELECT ... FROM
     t' when 't' is a 'TEMPORARY' table, because 'TEMPORARY' tables
     cannot be referred to twice in the same statement.  See *note
     internal-temporary-tables::, and *note temporary-table-problems::.

   * 'AUTO_INCREMENT' columns work as usual.

   * To ensure that the binary log can be used to re-create the original
     tables, MySQL does not permit concurrent inserts for *note 'INSERT
     ... SELECT': insert-select. statements (see *note
     concurrent-inserts::).

   * To avoid ambiguous column reference problems when the *note
     'SELECT': select. and the *note 'INSERT': insert. refer to the same
     table, provide a unique alias for each table used in the *note
     'SELECT': select. part, and qualify column names in that part with
     the appropriate alias.

For *note 'INSERT ... SELECT': insert-on-duplicate. statements, see
*note insert-on-duplicate:: for conditions under which the *note
'SELECT': select. columns can be referred to in an 'ON DUPLICATE KEY
UPDATE' clause.

The order in which a *note 'SELECT': select. statement with no 'ORDER
BY' clause returns rows is nondeterministic.  This means that, when
using replication, there is no guarantee that such a *note 'SELECT':
select. returns rows in the same order on the master and the slave,
which can lead to inconsistencies between them.  To prevent this from
occurring, always write 'INSERT ... SELECT' statements that are to be
replicated using an 'ORDER BY' clause that produces the same row order
on the master and the slave.  See also *note
replication-features-limit::.

Due to this issue, beginning with MySQL 5.5.18, *note 'INSERT ... SELECT
ON DUPLICATE KEY UPDATE': insert-on-duplicate. and *note 'INSERT IGNORE
... SELECT': insert-select. statements are flagged as unsafe for
statement-based replication.  Such statements produce a warning in the
error log when using statement-based mode and are written to the binary
log using the row-based format when using 'MIXED' mode.  (Bug #11758262,
Bug #50439)

See also *note replication-sbr-rbr::.

An 'INSERT ... SELECT' statement affecting partitioned tables using a
storage engine such as *note 'MyISAM': myisam-storage-engine. that
employs table-level locks locks all partitions of the source and target
tables.  This does not occur with tables using storage engines such as
*note 'InnoDB': innodb-storage-engine. that employ row-level locking.
This issue is resolved in MySQL 5.6.  For more information, see *note
partitioning-limitations-locking::.


File: manual.info.tmp,  Node: insert-on-duplicate,  Next: insert-delayed,  Prev: insert-select,  Up: insert

13.2.5.2 INSERT ... ON DUPLICATE KEY UPDATE Statement
.....................................................

If you specify an 'ON DUPLICATE KEY UPDATE' clause and a row to be
inserted would cause a duplicate value in a 'UNIQUE' index or 'PRIMARY
KEY', an *note 'UPDATE': update. of the old row occurs.  For example, if
column 'a' is declared as 'UNIQUE' and contains the value '1', the
following two statements have similar effect:

     INSERT INTO t1 (a,b,c) VALUES (1,2,3)
       ON DUPLICATE KEY UPDATE c=c+1;

     UPDATE t1 SET c=c+1 WHERE a=1;

(The effects are not identical for an 'InnoDB' table where 'a' is an
auto-increment column.  With an auto-increment column, an 'INSERT'
statement increases the auto-increment value but 'UPDATE' does not.)

If column 'b' is also unique, the *note 'INSERT': insert. is equivalent
to this *note 'UPDATE': update. statement instead:

     UPDATE t1 SET c=c+1 WHERE a=1 OR b=2 LIMIT 1;

If 'a=1 OR b=2' matches several rows, only _one_ row is updated.  In
general, you should try to avoid using an 'ON DUPLICATE KEY UPDATE'
clause on tables with multiple unique indexes.

With 'ON DUPLICATE KEY UPDATE', the affected-rows value per row is 1 if
the row is inserted as a new row, 2 if an existing row is updated, and 0
if an existing row is set to its current values.  If you specify the
'CLIENT_FOUND_ROWS' flag to the *note 'mysql_real_connect()':
mysql-real-connect. C API function when connecting to *note 'mysqld':
mysqld, the affected-rows value is 1 (not 0) if an existing row is set
to its current values.

If a table contains an 'AUTO_INCREMENT' column and *note 'INSERT ... ON
DUPLICATE KEY UPDATE': insert-on-duplicate. inserts or updates a row,
the 'LAST_INSERT_ID()' function returns the 'AUTO_INCREMENT' value.

The 'ON DUPLICATE KEY UPDATE' clause can contain multiple column
assignments, separated by commas.

In assignment value expressions in the 'ON DUPLICATE KEY UPDATE' clause,
you can use the 'VALUES(COL_NAME)' function to refer to column values
from the *note 'INSERT': insert. portion of the *note 'INSERT ... ON
DUPLICATE KEY UPDATE': insert-on-duplicate. statement.  In other words,
'VALUES(COL_NAME)' in the 'ON DUPLICATE KEY UPDATE' clause refers to the
value of COL_NAME that would be inserted, had no duplicate-key conflict
occurred.  This function is especially useful in multiple-row inserts.
The 'VALUES()' function is meaningful only in the 'ON DUPLICATE KEY
UPDATE' clause or *note 'INSERT': insert. statements and returns 'NULL'
otherwise.  Example:

     INSERT INTO t1 (a,b,c) VALUES (1,2,3),(4,5,6)
       ON DUPLICATE KEY UPDATE c=VALUES(a)+VALUES(b);

That statement is identical to the following two statements:

     INSERT INTO t1 (a,b,c) VALUES (1,2,3)
       ON DUPLICATE KEY UPDATE c=3;
     INSERT INTO t1 (a,b,c) VALUES (4,5,6)
       ON DUPLICATE KEY UPDATE c=9;

The 'DELAYED' option is ignored when you use 'ON DUPLICATE KEY UPDATE'.

For *note 'INSERT ... SELECT': insert-on-duplicate. statements, these
rules apply regarding acceptable forms of 'SELECT' query expressions
that you can refer to in an 'ON DUPLICATE KEY UPDATE' clause:

   * References to columns from queries on a single table, which may be
     a derived table.

   * References to columns from queries on a join over multiple tables.

   * References to columns from 'DISTINCT' queries.

   * References to columns in other tables, as long as the *note
     'SELECT': select. does not use 'GROUP BY'.  One side effect is that
     you must qualify references to nonunique column names.

References to columns from a *note 'UNION': union. do not work reliably.
To work around this restriction, rewrite the *note 'UNION': union. as a
derived table so that its rows can be treated as a single-table result
set.  For example, this statement is problematic:

     INSERT INTO t1 (a, b)
       SELECT c, d FROM t2
       UNION
       SELECT e, f FROM t3
     ON DUPLICATE KEY UPDATE b = b + c;

Instead, use an equivalent statement that rewrites the *note 'UNION':
union. as a derived table:

     INSERT INTO t1 (a, b)
     SELECT * FROM
       (SELECT c, d FROM t2
        UNION
        SELECT e, f FROM t3) AS dt
     ON DUPLICATE KEY UPDATE b = b + c;

The technique of rewriting a query as a derived table also enables
references to columns from 'GROUP BY' queries.

Because the results of *note 'INSERT ... SELECT': insert-select.
statements depend on the ordering of rows from the *note 'SELECT':
select. and this order cannot always be guaranteed, it is possible when
logging *note 'INSERT ... SELECT ON DUPLICATE KEY UPDATE':
insert-on-duplicate. statements for the master and the slave to diverge.
Thus, in MySQL 5.5.18 and later, *note 'INSERT ... SELECT ON DUPLICATE
KEY UPDATE': insert-on-duplicate. statements are flagged as unsafe for
statement-based replication.  With this change, such statements produce
a warning in the error log when using statement-based mode and are
written to the binary using the row-based format when using 'MIXED'
mode.  In addition, beginning with MySQL 5.5.24, an *note 'INSERT ... ON
DUPLICATE KEY UPDATE': insert-on-duplicate. statement against a table
having more than one unique or primary key is also marked as unsafe.
(Bug #11765650, Bug #58637)

See also *note replication-sbr-rbr::.

An 'INSERT ... ON DUPLICATE KEY UPDATE' on a partitioned table using a
storage engine such as *note 'MyISAM': myisam-storage-engine. that
employs table-level locks locks all partitions of the table.  This does
not occur with tables using storage engines such as *note 'InnoDB':
innodb-storage-engine. that employ row-level locking.  This issue is
resolved in MySQL 5.6.  For more information, see *note
partitioning-limitations-locking::.


File: manual.info.tmp,  Node: insert-delayed,  Prev: insert-on-duplicate,  Up: insert

13.2.5.3 INSERT DELAYED Statement
.................................

     INSERT DELAYED ...

The 'DELAYED' option for the *note 'INSERT': insert. statement is a
MySQL extension to standard SQL that is very useful if you have clients
that cannot or need not wait for the *note 'INSERT': insert. to
complete.  This is a common situation when you use MySQL for logging and
you also periodically run *note 'SELECT': select. and *note 'UPDATE':
update. statements that take a long time to complete.

When a client uses *note 'INSERT DELAYED': insert-delayed, it gets an
okay from the server at once, and the row is queued to be inserted when
the table is not in use by any other thread.

Another major benefit of using *note 'INSERT DELAYED': insert-delayed.
is that inserts from many clients are bundled together and written in
one block.  This is much faster than performing many separate inserts.

*Note*:

*note 'INSERT DELAYED': insert-delayed. is slower than a normal *note
'INSERT': insert. if the table is not otherwise in use.  There is also
the additional overhead for the server to handle a separate thread for
each table for which there are delayed rows.  This means that you should
use *note 'INSERT DELAYED': insert-delayed. only when you are really
sure that you need it.

The queued rows are held only in memory until they are inserted into the
table.  This means that if you terminate *note 'mysqld': mysqld.
forcibly (for example, with 'kill -9') or if *note 'mysqld': mysqld.
dies unexpectedly, _any queued rows that have not been written to disk
are lost_.

There are some constraints on the use of 'DELAYED':

   * *note 'INSERT DELAYED': insert-delayed. works only with 'MyISAM',
     'MEMORY', 'ARCHIVE', and 'BLACKHOLE' tables.  For engines that do
     not support 'DELAYED', an error occurs.

   * An error occurs for *note 'INSERT DELAYED': insert-delayed. if used
     with a table that has been locked with 'LOCK TABLES' because the
     insert must be handled by a separate thread, not by the session
     that holds the lock.

   * For 'MyISAM' tables, if there are no free blocks in the middle of
     the data file, concurrent *note 'SELECT': select. and *note
     'INSERT': insert. statements are supported.  Under these
     circumstances, you very seldom need to use *note 'INSERT DELAYED':
     insert-delayed. with 'MyISAM'.

   * *note 'INSERT DELAYED': insert-delayed. should be used only for
     *note 'INSERT': insert. statements that specify value lists.  The
     server ignores 'DELAYED' for *note 'INSERT ... SELECT':
     insert-select. or *note 'INSERT ... ON DUPLICATE KEY UPDATE':
     insert-on-duplicate. statements.

   * Because the *note 'INSERT DELAYED': insert-delayed. statement
     returns immediately, before the rows are inserted, you cannot use
     'LAST_INSERT_ID()' to get the 'AUTO_INCREMENT' value that the
     statement might generate.

   * 'DELAYED' rows are not visible to *note 'SELECT': select.
     statements until they actually have been inserted.

   * *note 'INSERT DELAYED': insert-delayed. is handled as a simple
     *note 'INSERT': insert. (that is, without the 'DELAYED' option)
     whenever the value of 'binlog_format' is 'STATEMENT' or 'MIXED'.
     (In the latter case, the statement does not trigger a switch to
     row-based logging, and so is logged using the statement-based
     format.)

     This does not apply when using row-based binary logging mode
     ('binlog_format' set to 'ROW'), in which *note 'INSERT DELAYED':
     insert-delayed. statements are always executed using the 'DELAYED'
     option as specified, and logged as row-update events.

   * 'DELAYED' is ignored on slave replication servers, so that *note
     'INSERT DELAYED': insert-delayed. is treated as a normal *note
     'INSERT': insert. on slaves.  This is because 'DELAYED' could cause
     the slave to have different data than the master.

   * Pending *note 'INSERT DELAYED': insert-delayed. statements are lost
     if a table is write locked and *note 'ALTER TABLE': alter-table. is
     used to modify the table structure.

   * *note 'INSERT DELAYED': insert-delayed. is not supported for views.

   * *note 'INSERT DELAYED': insert-delayed. is not supported for
     partitioned tables.

The following describes in detail what happens when you use the
'DELAYED' option to *note 'INSERT': insert. or *note 'REPLACE': replace.
In this description, the 'thread' is the thread that received an *note
'INSERT DELAYED': insert-delayed. statement and 'handler' is the thread
that handles all *note 'INSERT DELAYED': insert-delayed. statements for
a particular table.

   * When a thread executes a 'DELAYED' statement for a table, a handler
     thread is created to process all 'DELAYED' statements for the
     table, if no such handler already exists.

   * The thread checks whether the handler has previously acquired a
     'DELAYED' lock; if not, it tells the handler thread to do so.  The
     'DELAYED' lock can be obtained even if other threads have a 'READ'
     or 'WRITE' lock on the table.  However, the handler waits for all
     *note 'ALTER TABLE': alter-table. locks or 'FLUSH TABLES'
     statements to finish, to ensure that the table structure is up to
     date.

   * The thread executes the *note 'INSERT': insert. statement, but
     instead of writing the row to the table, it puts a copy of the
     final row into a queue that is managed by the handler thread.  Any
     syntax errors are noticed by the thread and reported to the client
     program.

   * The client cannot obtain from the server the number of duplicate
     rows or the 'AUTO_INCREMENT' value for the resulting row, because
     the *note 'INSERT': insert. returns before the insert operation has
     been completed.  (If you use the C API, the *note 'mysql_info()':
     mysql-info. function does not return anything meaningful, for the
     same reason.)

   * The binary log is updated by the handler thread when the row is
     inserted into the table.  In case of multiple-row inserts, the
     binary log is updated when the first row is inserted.

   * 
     Each time that 'delayed_insert_limit' rows are written, the handler
     checks whether any *note 'SELECT': select. statements are still
     pending.  If so, it permits these to execute before continuing.

   * 
     When the handler has no more rows in its queue, the table is
     unlocked.  If no new *note 'INSERT DELAYED': insert-delayed.
     statements are received within 'delayed_insert_timeout' seconds,
     the handler terminates.

   * If more than 'delayed_queue_size' rows are pending in a specific
     handler queue, the thread requesting *note 'INSERT DELAYED':
     insert-delayed. waits until there is room in the queue.  This is
     done to ensure that *note 'mysqld': mysqld. does not use all memory
     for the delayed memory queue.

   * The handler thread shows up in the MySQL process list with
     'delayed_insert' in the 'Command' column.  It is killed if you
     execute a 'FLUSH TABLES' statement or kill it with 'KILL
     THREAD_ID'.  However, before exiting, it first stores all queued
     rows into the table.  During this time it does not accept any new
     *note 'INSERT': insert. statements from other threads.  If you
     execute an *note 'INSERT DELAYED': insert-delayed. statement after
     this, a new handler thread is created.

     This means that *note 'INSERT DELAYED': insert-delayed. statements
     have higher priority than normal *note 'INSERT': insert. statements
     if there is an *note 'INSERT DELAYED': insert-delayed. handler
     running.  Other update statements have to wait until the *note
     'INSERT DELAYED': insert-delayed. queue is empty, someone
     terminates the handler thread (with 'KILL THREAD_ID'), or someone
     executes a 'FLUSH TABLES'.

   * The following status variables provide information about *note
     'INSERT DELAYED': insert-delayed. statements.

     Status Variable                  Meaning
                                      
     'Delayed_insert_threads'         Number of handler threads
                                      
     'Delayed_writes'                 Number of rows written with
                                      *note 'INSERT DELAYED': insert-delayed.
                                      
     'Not_flushed_delayed_rows'       Number of rows waiting to be written

     You can view these variables by issuing a *note 'SHOW STATUS':
     show-status. statement or by executing a *note 'mysqladmin
     extended-status': mysqladmin. command.


File: manual.info.tmp,  Node: load-data,  Next: load-xml,  Prev: insert,  Up: sql-data-manipulation-statements

13.2.6 LOAD DATA Statement
--------------------------

     LOAD DATA
         [LOW_PRIORITY | CONCURRENT] [LOCAL]
         INFILE 'FILE_NAME'
         [REPLACE | IGNORE]
         INTO TABLE TBL_NAME
         [CHARACTER SET CHARSET_NAME]
         [{FIELDS | COLUMNS}
             [TERMINATED BY 'STRING']
             [[OPTIONALLY] ENCLOSED BY 'CHAR']
             [ESCAPED BY 'CHAR']
         ]
         [LINES
             [STARTING BY 'STRING']
             [TERMINATED BY 'STRING']
         ]
         [IGNORE NUMBER {LINES | ROWS}]
         [(COL_NAME_OR_USER_VAR
             [, COL_NAME_OR_USER_VAR] ...)]
         [SET COL_NAME={EXPR | DEFAULT},
             [, COL_NAME={EXPR | DEFAULT}] ...]

The *note 'LOAD DATA': load-data. statement reads rows from a text file
into a table at a very high speed.  *note 'LOAD DATA': load-data. is the
complement of *note 'SELECT ... INTO OUTFILE': select-into.  (See *note
select-into::.)  To write data from a table to a file, use *note 'SELECT
... INTO OUTFILE': select-into.  To read the file back into a table, use
*note 'LOAD DATA': load-data.  The syntax of the 'FIELDS' and 'LINES'
clauses is the same for both statements.

You can also load data files by using the *note 'mysqlimport':
mysqlimport. utility; see *note mysqlimport::.  *note 'mysqlimport':
mysqlimport. operates by sending a *note 'LOAD DATA': load-data.
statement to the server.

For more information about the efficiency of *note 'INSERT': insert.
versus *note 'LOAD DATA': load-data. and speeding up *note 'LOAD DATA':
load-data, see *note insert-optimization::.

   * *note load-data-partitioning-support::

   * *note load-data-input-file::

   * *note load-data-concurrency::

   * *note load-data-duplicate-key-handling::

   * *note load-data-index-handling::

   * *note load-data-field-line-handling::

   * *note load-data-column-list::

   * *note load-data-input-preprocessing::

   * *note load-data-statement-result-information::

   * *note load-data-miscellaneous::

*Partitioned Table Support*

For partitioned tables using storage engines that employ table locks,
such as *note 'MyISAM': myisam-storage-engine, any locks caused by *note
'LOAD DATA': load-data. perform locks on all partitions of the table.
This does not apply to tables using storage engines which employ
row-level locking, such as *note 'InnoDB': innodb-storage-engine.  For
more information, see *note partitioning-limitations-locking::.

*Input File Name, Location, and Content Interpretation*

The file name must be given as a literal string.  On Windows, specify
backslashes in path names as forward slashes or doubled backslashes.
The 'character_set_filesystem' system variable controls the
interpretation of the file name character set.

The server uses the character set indicated by the
'character_set_database' system variable to interpret the information in
the file.  *note 'SET NAMES': set-names. and the setting of
'character_set_client' do not affect interpretation of input.  If the
contents of the input file use a character set that differs from the
default, it is usually preferable to specify the character set of the
file by using the 'CHARACTER SET' clause.  A character set of 'binary'
specifies 'no conversion.'

*note 'LOAD DATA': load-data. interprets all fields in the file as
having the same character set, regardless of the data types of the
columns into which field values are loaded.  For proper interpretation
of file contents, you must ensure that it was written with the correct
character set.  For example, if you write a data file with *note
'mysqldump -T': mysqldump. or by issuing a *note 'SELECT ... INTO
OUTFILE': select-into. statement in *note 'mysql': mysql, be sure to use
a '--default-character-set' option so that output is written in the
character set to be used when the file is loaded with *note 'LOAD DATA':
load-data.

*Note*:

It is not possible to load data files that use the 'ucs2', 'utf16', or
'utf32' character set.

*Concurrency Considerations*

If you use the 'LOW_PRIORITY' modifier, execution of the *note 'LOAD
DATA': load-data. statement is delayed until no other clients are
reading from the table.  This affects only storage engines that use only
table-level locking (such as 'MyISAM', 'MEMORY', and 'MERGE').

If you specify the 'CONCURRENT' modifier with a 'MyISAM' table that
satisfies the condition for concurrent inserts (that is, it contains no
free blocks in the middle), other threads can retrieve data from the
table while *note 'LOAD DATA': load-data. is executing.  This modifier
affects the performance of *note 'LOAD DATA': load-data. a bit, even if
no other thread is using the table at the same time.

For information about *note 'LOAD DATA': load-data. in relation to
replication, see *note replication-features-load-data::.

The 'LOCAL' modifier affects expected location of the file and error
handling, as described later.  'LOCAL' works only if your server and
your client both have been configured to permit it.  For example, if
*note 'mysqld': mysqld. was started with the 'local_infile' system
variable disabled, 'LOCAL' does not work.  See *note load-data-local::.

The 'LOCAL' modifier affects where the file is expected to be found:

   * If 'LOCAL' is specified, the file is read by the client program on
     the client host and sent to the server.  The file can be given as a
     full path name to specify its exact location.  If given as a
     relative path name, the name is interpreted relative to the
     directory in which the client program was started.

     When using 'LOCAL' with *note 'LOAD DATA': load-data, a copy of the
     file is created in the directory where the MySQL server stores
     temporary files.  See *note temporary-files::.  Lack of sufficient
     space for the copy in this directory can cause the *note 'LOAD DATA
     LOCAL': load-data. statement to fail.

   * If 'LOCAL' is not specified, the file must be located on the server
     host and is read directly by the server.  The server uses the
     following rules to locate the file:

        * If the file name is an absolute path name, the server uses it
          as given.

        * If the file name is a relative path name with one or more
          leading components, the server searches for the file relative
          to the server's data directory.

        * If a file name with no leading components is given, the server
          looks for the file in the database directory of the default
          database.

In the non-'LOCAL' case, these rules mean that a file named as
'./myfile.txt' is read from the server's data directory, whereas the
file named as 'myfile.txt' is read from the database directory of the
default database.  For example, if 'db1' is the default database, the
following *note 'LOAD DATA': load-data. statement reads the file
'data.txt' from the database directory for 'db1', even though the
statement explicitly loads the file into a table in the 'db2' database:

     LOAD DATA INFILE 'data.txt' INTO TABLE db2.my_table;

Non-'LOCAL' load operations read text files located on the server.  For
security reasons, such operations require that you have the 'FILE'
privilege.  See *note privileges-provided::.  Also, non-'LOCAL' load
operations are subject to the 'secure_file_priv' system variable
setting.  If the variable value is a nonempty directory name, the file
to be loaded must be located in that directory.  If the variable value
is empty (which is insecure), the file need only be readable by the
server.

Using 'LOCAL' is a bit slower than letting the server access the files
directly, because the file contents must be sent over the connection by
the client to the server.  On the other hand, you do not need the 'FILE'
privilege to load local files.

'LOCAL' also affects error handling:

   * With *note 'LOAD DATA': load-data, data-interpretation and
     duplicate-key errors terminate the operation.

   * With *note 'LOAD DATA LOCAL': load-data, data-interpretation and
     duplicate-key errors become warnings and the operation continues
     because the server has no way to stop transmission of the file in
     the middle of the operation.  For duplicate-key errors, this is the
     same as if 'IGNORE' is specified.  'IGNORE' is explained further
     later in this section.

*Duplicate-Key Handling*

The 'REPLACE' and 'IGNORE' modifiers control handling of input rows that
duplicate existing rows on unique key values:

   * If you specify 'REPLACE', input rows replace existing rows.  In
     other words, rows that have the same value for a primary key or
     unique index as an existing row.  See *note replace::.

   * If you specify 'IGNORE', rows that duplicate an existing row on a
     unique key value are discarded.

   * If you do not specify either modifier, the behavior depends on
     whether the 'LOCAL' modifier is specified.  Without 'LOCAL', an
     error occurs when a duplicate key value is found, and the rest of
     the text file is ignored.  With 'LOCAL', the default behavior is
     the same as if 'IGNORE' is specified; this is because the server
     has no way to stop transmission of the file in the middle of the
     operation.

*Index Handling*

To ignore foreign key constraints during the load operation, execute a
'SET foreign_key_checks = 0' statement before executing *note 'LOAD
DATA': load-data.

If you use *note 'LOAD DATA': load-data. on an empty 'MyISAM' table, all
nonunique indexes are created in a separate batch (as for *note 'REPAIR
TABLE': repair-table.).  Normally, this makes *note 'LOAD DATA':
load-data. much faster when you have many indexes.  In some extreme
cases, you can create the indexes even faster by turning them off with
*note 'ALTER TABLE ... DISABLE KEYS': alter-table. before loading the
file into the table and using *note 'ALTER TABLE ... ENABLE KEYS':
alter-table. to re-create the indexes after loading the file.  See *note
insert-optimization::.

*Field and Line Handling*

For both the *note 'LOAD DATA': load-data. and *note 'SELECT ... INTO
OUTFILE': select-into. statements, the syntax of the 'FIELDS' and
'LINES' clauses is the same.  Both clauses are optional, but 'FIELDS'
must precede 'LINES' if both are specified.

If you specify a 'FIELDS' clause, each of its subclauses ('TERMINATED
BY', '[OPTIONALLY] ENCLOSED BY', and 'ESCAPED BY') is also optional,
except that you must specify at least one of them.  Arguments to these
clauses are permitted to contain only ASCII characters.

If you specify no 'FIELDS' or 'LINES' clause, the defaults are the same
as if you had written this:

     FIELDS TERMINATED BY '\t' ENCLOSED BY '' ESCAPED BY '\\'
     LINES TERMINATED BY '\n' STARTING BY ''

Backslash is the MySQL escape character within strings in SQL
statements.  Thus, to specify a literal backslash, you must specify two
backslashes for the value to be interpreted as a single backslash.  The
escape sequences ''\t'' and ''\n'' specify tab and newline characters,
respectively.

In other words, the defaults cause *note 'LOAD DATA': load-data. to act
as follows when reading input:

   * Look for line boundaries at newlines.

   * Do not skip any line prefix.

   * Break lines into fields at tabs.

   * Do not expect fields to be enclosed within any quoting characters.

   * Interpret characters preceded by the escape character '\' as escape
     sequences.  For example, '\t', '\n', and '\\' signify tab, newline,
     and backslash, respectively.  See the discussion of 'FIELDS ESCAPED
     BY' later for the full list of escape sequences.

Conversely, the defaults cause *note 'SELECT ... INTO OUTFILE':
select-into. to act as follows when writing output:

   * Write tabs between fields.

   * Do not enclose fields within any quoting characters.

   * Use '\' to escape instances of tab, newline, or '\' that occur
     within field values.

   * Write newlines at the ends of lines.

*Note*:

For a text file generated on a Windows system, proper file reading might
require 'LINES TERMINATED BY '\r\n'' because Windows programs typically
use two characters as a line terminator.  Some programs, such as
'WordPad', might use '\r' as a line terminator when writing files.  To
read such files, use 'LINES TERMINATED BY '\r''.

If all the input lines have a common prefix that you want to ignore, you
can use 'LINES STARTING BY 'PREFIX_STRING'' to skip the prefix _and
anything before it_.  If a line does not include the prefix, the entire
line is skipped.  Suppose that you issue the following statement:

     LOAD DATA INFILE '/tmp/test.txt' INTO TABLE test
       FIELDS TERMINATED BY ','  LINES STARTING BY 'xxx';

If the data file looks like this:

     xxx"abc",1
     something xxx"def",2
     "ghi",3

The resulting rows will be '("abc",1)' and '("def",2)'.  The third row
in the file is skipped because it does not contain the prefix.

The 'IGNORE NUMBER LINES' option can be used to ignore lines at the
start of the file.  For example, you can use 'IGNORE 1 LINES' to skip an
initial header line containing column names:

     LOAD DATA INFILE '/tmp/test.txt' INTO TABLE test IGNORE 1 LINES;

When you use *note 'SELECT ... INTO OUTFILE': select-into. in tandem
with *note 'LOAD DATA': load-data. to write data from a database into a
file and then read the file back into the database later, the field- and
line-handling options for both statements must match.  Otherwise, *note
'LOAD DATA': load-data. will not interpret the contents of the file
properly.  Suppose that you use *note 'SELECT ... INTO OUTFILE':
select-into. to write a file with fields delimited by commas:

     SELECT * INTO OUTFILE 'data.txt'
       FIELDS TERMINATED BY ','
       FROM table2;

To read the comma-delimited file, the correct statement would be:

     LOAD DATA INFILE 'data.txt' INTO TABLE table2
       FIELDS TERMINATED BY ',';

If instead you tried to read the file with the statement shown
following, it wouldn't work because it instructs *note 'LOAD DATA':
load-data. to look for tabs between fields:

     LOAD DATA INFILE 'data.txt' INTO TABLE table2
       FIELDS TERMINATED BY '\t';

The likely result is that each input line would be interpreted as a
single field.

*note 'LOAD DATA': load-data. can be used to read files obtained from
external sources.  For example, many programs can export data in
comma-separated values (CSV) format, such that lines have fields
separated by commas and enclosed within double quotation marks, with an
initial line of column names.  If the lines in such a file are
terminated by carriage return/newline pairs, the statement shown here
illustrates the field- and line-handling options you would use to load
the file:

     LOAD DATA INFILE 'data.txt' INTO TABLE TBL_NAME
       FIELDS TERMINATED BY ',' ENCLOSED BY '"'
       LINES TERMINATED BY '\r\n'
       IGNORE 1 LINES;

If the input values are not necessarily enclosed within quotation marks,
use 'OPTIONALLY' before the 'ENCLOSED BY' option.

Any of the field- or line-handling options can specify an empty string
('''').  If not empty, the 'FIELDS [OPTIONALLY] ENCLOSED BY' and 'FIELDS
ESCAPED BY' values must be a single character.  The 'FIELDS TERMINATED
BY', 'LINES STARTING BY', and 'LINES TERMINATED BY' values can be more
than one character.  For example, to write lines that are terminated by
carriage return/linefeed pairs, or to read a file containing such lines,
specify a 'LINES TERMINATED BY '\r\n'' clause.

To read a file containing jokes that are separated by lines consisting
of '%%', you can do this

     CREATE TABLE jokes
       (a INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
       joke TEXT NOT NULL);
     LOAD DATA INFILE '/tmp/jokes.txt' INTO TABLE jokes
       FIELDS TERMINATED BY ''
       LINES TERMINATED BY '\n%%\n' (joke);

'FIELDS [OPTIONALLY] ENCLOSED BY' controls quoting of fields.  For
output (*note 'SELECT ... INTO OUTFILE': select-into.), if you omit the
word 'OPTIONALLY', all fields are enclosed by the 'ENCLOSED BY'
character.  An example of such output (using a comma as the field
delimiter) is shown here:

     "1","a string","100.20"
     "2","a string containing a , comma","102.20"
     "3","a string containing a \" quote","102.20"
     "4","a string containing a \", quote and comma","102.20"

If you specify 'OPTIONALLY', the 'ENCLOSED BY' character is used only to
enclose values from columns that have a string data type (such as *note
'CHAR': char, *note 'BINARY': binary-varbinary, *note 'TEXT': blob, or
*note 'ENUM': enum.):

     1,"a string",100.20
     2,"a string containing a , comma",102.20
     3,"a string containing a \" quote",102.20
     4,"a string containing a \", quote and comma",102.20

Occurrences of the 'ENCLOSED BY' character within a field value are
escaped by prefixing them with the 'ESCAPED BY' character.  Also, if you
specify an empty 'ESCAPED BY' value, it is possible to inadvertently
generate output that cannot be read properly by *note 'LOAD DATA':
load-data.  For example, the preceding output just shown would appear as
follows if the escape character is empty.  Observe that the second field
in the fourth line contains a comma following the quote, which
(erroneously) appears to terminate the field:

     1,"a string",100.20
     2,"a string containing a , comma",102.20
     3,"a string containing a " quote",102.20
     4,"a string containing a ", quote and comma",102.20

For input, the 'ENCLOSED BY' character, if present, is stripped from the
ends of field values.  (This is true regardless of whether 'OPTIONALLY'
is specified; 'OPTIONALLY' has no effect on input interpretation.)
Occurrences of the 'ENCLOSED BY' character preceded by the 'ESCAPED BY'
character are interpreted as part of the current field value.

If the field begins with the 'ENCLOSED BY' character, instances of that
character are recognized as terminating a field value only if followed
by the field or line 'TERMINATED BY' sequence.  To avoid ambiguity,
occurrences of the 'ENCLOSED BY' character within a field value can be
doubled and are interpreted as a single instance of the character.  For
example, if 'ENCLOSED BY '"'' is specified, quotation marks are handled
as shown here:

     "The ""BIG"" boss"  -> The "BIG" boss
     The "BIG" boss      -> The "BIG" boss
     The ""BIG"" boss    -> The ""BIG"" boss

'FIELDS ESCAPED BY' controls how to read or write special characters:

   * For input, if the 'FIELDS ESCAPED BY' character is not empty,
     occurrences of that character are stripped and the following
     character is taken literally as part of a field value.  Some
     two-character sequences that are exceptions, where the first
     character is the escape character.  These sequences are shown in
     the following table (using '\' for the escape character).  The
     rules for 'NULL' handling are described later in this section.

     Character   Escape Sequence
                 
     '\0'        An ASCII NUL ('X'00'') character
                 
     '\b'        A backspace character
                 
     '\n'        A newline (linefeed) character
                 
     '\r'        A carriage return character
                 
     '\t'        A tab character.
                 
     '\Z'        ASCII 26 (Control+Z)
                 
     '\N'        NULL

     For more information about '\'-escape syntax, see *note
     string-literals::.

     If the 'FIELDS ESCAPED BY' character is empty, escape-sequence
     interpretation does not occur.

   * For output, if the 'FIELDS ESCAPED BY' character is not empty, it
     is used to prefix the following characters on output:

        * The 'FIELDS ESCAPED BY' character.

        * The 'FIELDS [OPTIONALLY] ENCLOSED BY' character.

        * The first character of the 'FIELDS TERMINATED BY' and 'LINES
          TERMINATED BY' values, if the 'ENCLOSED BY' character is empty
          or unspecified.

        * ASCII '0' (what is actually written following the escape
          character is ASCII '0', not a zero-valued byte).

     If the 'FIELDS ESCAPED BY' character is empty, no characters are
     escaped and 'NULL' is output as 'NULL', not '\N'.  It is probably
     not a good idea to specify an empty escape character, particularly
     if field values in your data contain any of the characters in the
     list just given.

In certain cases, field- and line-handling options interact:

   * If 'LINES TERMINATED BY' is an empty string and 'FIELDS TERMINATED
     BY' is nonempty, lines are also terminated with 'FIELDS TERMINATED
     BY'.

   * If the 'FIELDS TERMINATED BY' and 'FIELDS ENCLOSED BY' values are
     both empty (''''), a fixed-row (nondelimited) format is used.  With
     fixed-row format, no delimiters are used between fields (but you
     can still have a line terminator).  Instead, column values are read
     and written using a field width wide enough to hold all values in
     the field.  For *note 'TINYINT': integer-types, *note 'SMALLINT':
     integer-types, *note 'MEDIUMINT': integer-types, *note 'INT':
     integer-types, and *note 'BIGINT': integer-types, the field widths
     are 4, 6, 8, 11, and 20, respectively, no matter what the declared
     display width is.

     'LINES TERMINATED BY' is still used to separate lines.  If a line
     does not contain all fields, the rest of the columns are set to
     their default values.  If you do not have a line terminator, you
     should set this to ''''.  In this case, the text file must contain
     all fields for each row.

     Fixed-row format also affects handling of 'NULL' values, as
     described later.

     *Note*:

     Fixed-size format does not work if you are using a multibyte
     character set.

Handling of 'NULL' values varies according to the 'FIELDS' and 'LINES'
options in use:

   * For the default 'FIELDS' and 'LINES' values, 'NULL' is written as a
     field value of '\N' for output, and a field value of '\N' is read
     as 'NULL' for input (assuming that the 'ESCAPED BY' character is
     '\').

   * If 'FIELDS ENCLOSED BY' is not empty, a field containing the
     literal word 'NULL' as its value is read as a 'NULL' value.  This
     differs from the word 'NULL' enclosed within 'FIELDS ENCLOSED BY'
     characters, which is read as the string ''NULL''.

   * If 'FIELDS ESCAPED BY' is empty, 'NULL' is written as the word
     'NULL'.

   * With fixed-row format (which is used when 'FIELDS TERMINATED BY'
     and 'FIELDS ENCLOSED BY' are both empty), 'NULL' is written as an
     empty string.  This causes both 'NULL' values and empty strings in
     the table to be indistinguishable when written to the file because
     both are written as empty strings.  If you need to be able to tell
     the two apart when reading the file back in, you should not use
     fixed-row format.

An attempt to load 'NULL' into a 'NOT NULL' column causes assignment of
the implicit default value for the column's data type and a warning, or
an error in strict SQL mode.  Implicit default values are discussed in
*note data-type-defaults::.

Some cases are not supported by *note 'LOAD DATA': load-data.:

   * Fixed-size rows ('FIELDS TERMINATED BY' and 'FIELDS ENCLOSED BY'
     both empty) and *note 'BLOB': blob. or *note 'TEXT': blob. columns.

   * If you specify one separator that is the same as or a prefix of
     another, *note 'LOAD DATA': load-data. cannot interpret the input
     properly.  For example, the following 'FIELDS' clause would cause
     problems:

          FIELDS TERMINATED BY '"' ENCLOSED BY '"'

   * If 'FIELDS ESCAPED BY' is empty, a field value that contains an
     occurrence of 'FIELDS ENCLOSED BY' or 'LINES TERMINATED BY'
     followed by the 'FIELDS TERMINATED BY' value causes *note 'LOAD
     DATA': load-data. to stop reading a field or line too early.  This
     happens because *note 'LOAD DATA': load-data. cannot properly
     determine where the field or line value ends.

*Column List Specification*

The following example loads all columns of the 'persondata' table:

     LOAD DATA INFILE 'persondata.txt' INTO TABLE persondata;

By default, when no column list is provided at the end of the *note
'LOAD DATA': load-data. statement, input lines are expected to contain a
field for each table column.  If you want to load only some of a table's
columns, specify a column list:

     LOAD DATA INFILE 'persondata.txt' INTO TABLE persondata
     (COL_NAME_OR_USER_VAR [, COL_NAME_OR_USER_VAR] ...);

You must also specify a column list if the order of the fields in the
input file differs from the order of the columns in the table.
Otherwise, MySQL cannot tell how to match input fields with table
columns.

*Input Preprocessing*

Each COL_NAME_OR_USER_VAR value is either a column name or a user
variable.  With user variables, the 'SET' clause enables you to perform
preprocessing transformations on their values before assigning the
result to columns.

User variables in the 'SET' clause can be used in several ways.  The
following example uses the first input column directly for the value of
't1.column1', and assigns the second input column to a user variable
that is subjected to a division operation before being used for the
value of 't1.column2':

     LOAD DATA INFILE 'file.txt'
       INTO TABLE t1
       (column1, @var1)
       SET column2 = @var1/100;

The 'SET' clause can be used to supply values not derived from the input
file.  The following statement sets 'column3' to the current date and
time:

     LOAD DATA INFILE 'file.txt'
       INTO TABLE t1
       (column1, column2)
       SET column3 = CURRENT_TIMESTAMP;

You can also discard an input value by assigning it to a user variable
and not assigning the variable to a table column:

     LOAD DATA INFILE 'file.txt'
       INTO TABLE t1
       (column1, @dummy, column2, @dummy, column3);

Use of the column/variable list and 'SET' clause is subject to the
following restrictions:

   * Assignments in the 'SET' clause should have only column names on
     the left hand side of assignment operators.

   * You can use subqueries in the right hand side of 'SET' assignments.
     A subquery that returns a value to be assigned to a column may be a
     scalar subquery only.  Also, you cannot use a subquery to select
     from the table that is being loaded.

   * Lines ignored by an 'IGNORE' clause are not processed for the
     column/variable list or 'SET' clause.

   * User variables cannot be used when loading data with fixed-row
     format because user variables do not have a display width.

When processing an input line, *note 'LOAD DATA': load-data. splits it
into fields and uses the values according to the column/variable list
and the 'SET' clause, if they are present.  Then the resulting row is
inserted into the table.  If there are 'BEFORE INSERT' or 'AFTER INSERT'
triggers for the table, they are activated before or after inserting the
row, respectively.

If an input line has too many fields, the extra fields are ignored and
the number of warnings is incremented.

If an input line has too few fields, the table columns for which input
fields are missing are set to their default values.  Default value
assignment is described in *note data-type-defaults::.

An empty field value is interpreted different from a missing field:

   * For string types, the column is set to the empty string.

   * For numeric types, the column is set to '0'.

   * For date and time types, the column is set to the appropriate
     'zero' value for the type.  See *note date-and-time-types::.

These are the same values that result if you assign an empty string
explicitly to a string, numeric, or date or time type explicitly in an
*note 'INSERT': insert. or *note 'UPDATE': update. statement.

Treatment of empty or incorrect field values differs from that just
described if the SQL mode is set to a restrictive value.  For example,
if 'sql_mode' is set to 'TRADITIONAL', conversion of an empty value or a
value such as ''x'' for a numeric column results in an error, not
conversion to 0.  (With 'LOCAL' or 'IGNORE', warnings occur rather than
errors, even with a restrictive 'sql_mode' value, and the row is
inserted using the same closest-value behavior used for nonrestrictive
SQL modes.  This occurs because the server has no way to stop
transmission of the file in the middle of the operation.)

*note 'TIMESTAMP': datetime. columns are set to the current date and
time only if there is a 'NULL' value for the column (that is, '\N') and
the column is not declared to permit 'NULL' values, or if the *note
'TIMESTAMP': datetime. column's default value is the current timestamp
and it is omitted from the field list when a field list is specified.

*note 'LOAD DATA': load-data. regards all input as strings, so you
cannot use numeric values for *note 'ENUM': enum. or *note 'SET': set.
columns the way you can with *note 'INSERT': insert. statements.  All
*note 'ENUM': enum. and *note 'SET': set. values must be specified as
strings.

*note 'BIT': bit-type. values cannot be loaded directly using binary
notation (for example, 'b'011010'').  To work around this, use the 'SET'
clause to strip off the leading 'b'' and trailing ''' and perform a
base-2 to base-10 conversion so that MySQL loads the values into the
*note 'BIT': bit-type. column properly:

     shell> cat /tmp/bit_test.txt
     b'10'
     b'1111111'
     shell> mysql test
     mysql> LOAD DATA INFILE '/tmp/bit_test.txt'
            INTO TABLE bit_test (@var1)
            SET b = CAST(CONV(MID(@var1, 3, LENGTH(@var1)-3), 2, 10) AS UNSIGNED);
     Query OK, 2 rows affected (0.00 sec)
     Records: 2  Deleted: 0  Skipped: 0  Warnings: 0

     mysql> SELECT BIN(b+0) FROM bit_test;
     +----------+
     | BIN(b+0) |
     +----------+
     | 10       |
     | 1111111  |
     +----------+
     2 rows in set (0.00 sec)

For *note 'BIT': bit-type. values in '0b' binary notation (for example,
'0b011010'), use this 'SET' clause instead to strip off the leading
'0b':

     SET b = CAST(CONV(MID(@var1, 3, LENGTH(@var1)-2), 2, 10) AS UNSIGNED)

*Statement Result Information*

When the *note 'LOAD DATA': load-data. statement finishes, it returns an
information string in the following format:

     Records: 1  Deleted: 0  Skipped: 0  Warnings: 0

Warnings occur under the same circumstances as when values are inserted
using the *note 'INSERT': insert. statement (see *note insert::), except
that *note 'LOAD DATA': load-data. also generates warnings when there
are too few or too many fields in the input row.

You can use *note 'SHOW WARNINGS': show-warnings. to get a list of the
first 'max_error_count' warnings as information about what went wrong.
See *note show-warnings::.

If you are using the C API, you can get information about the statement
by calling the *note 'mysql_info()': mysql-info. function.  See *note
mysql-info::.

*Miscellaneous Topics*

On Unix, if you need *note 'LOAD DATA': load-data. to read from a pipe,
you can use the following technique (the example loads a listing of the
'/' directory into the table 'db1.t1'):

     mkfifo /mysql/data/db1/ls.dat
     chmod 666 /mysql/data/db1/ls.dat
     find / -ls > /mysql/data/db1/ls.dat &
     mysql -e "LOAD DATA INFILE 'ls.dat' INTO TABLE t1" db1

Here you must run the command that generates the data to be loaded and
the *note 'mysql': mysql. commands either on separate terminals, or run
the data generation process in the background (as shown in the preceding
example).  If you do not do this, the pipe will block until data is read
by the *note 'mysql': mysql. process.


File: manual.info.tmp,  Node: load-xml,  Next: replace,  Prev: load-data,  Up: sql-data-manipulation-statements

13.2.7 LOAD XML Statement
-------------------------

     LOAD XML
         [LOW_PRIORITY | CONCURRENT] [LOCAL]
         INFILE 'FILE_NAME'
         [REPLACE | IGNORE]
         INTO TABLE [DB_NAME.]TBL_NAME
         [CHARACTER SET CHARSET_NAME]
         [ROWS IDENTIFIED BY '<TAGNAME>']
         [IGNORE NUMBER {LINES | ROWS}]
         [(FIELD_NAME_OR_USER_VAR
             [, FIELD_NAME_OR_USER_VAR] ...)]
         [SET COL_NAME={EXPR | DEFAULT},
             [, COL_NAME={EXPR | DEFAULT}] ...]

The *note 'LOAD XML': load-xml. statement reads data from an XML file
into a table.  The FILE_NAME must be given as a literal string.  The
TAGNAME in the optional 'ROWS IDENTIFIED BY' clause must also be given
as a literal string, and must be surrounded by angle brackets ('<' and
'>').

*note 'LOAD XML': load-xml. acts as the complement of running the *note
'mysql': mysql. client in XML output mode (that is, starting the client
with the '--xml' option).  To write data from a table to an XML file,
you can invoke the *note 'mysql': mysql. client with the '--xml' and
'-e' options from the system shell, as shown here:

     shell> mysql --xml -e 'SELECT * FROM mydb.mytable' > file.xml

To read the file back into a table, use *note 'LOAD XML': load-xml.  By
default, the '<row>' element is considered to be the equivalent of a
database table row; this can be changed using the 'ROWS IDENTIFIED BY'
clause.

This statement supports three different XML formats:

   * Column names as attributes and column values as attribute values:

          <ROW COLUMN1="VALUE1" COLUMN2="VALUE2" .../>

   * Column names as tags and column values as the content of these
     tags:

          <ROW>
            <COLUMN1>VALUE1</COLUMN1>
            <COLUMN2>VALUE2</COLUMN2>
          </ROW>

   * Column names are the 'name' attributes of '<field>' tags, and
     values are the contents of these tags:

          <row>
            <field name='COLUMN1'>VALUE1</field>
            <field name='COLUMN2'>VALUE2</field>
          </row>

     This is the format used by other MySQL tools, such as *note
     'mysqldump': mysqldump.

All three formats can be used in the same XML file; the import routine
automatically detects the format for each row and interprets it
correctly.  Tags are matched based on the tag or attribute name and the
column name.

Prior to MySQL 5.5.46, 'LOAD XML' did not handle empty XML elements in
the form '<element/>' correctly.  (Bug #67542, Bug #16171518)

The following clauses work essentially the same way for *note 'LOAD
XML': load-xml. as they do for *note 'LOAD DATA': load-data.:

   * 'LOW_PRIORITY' or 'CONCURRENT'

   * 'LOCAL'

   * 'REPLACE' or 'IGNORE'

   * 'CHARACTER SET'

   * 'SET'

See *note load-data::, for more information about these clauses.

'(FIELD_NAME_OR_USER_VAR, ...)' is a list of one or more comma-separated
XML fields or user variables.  The name of a user variable used for this
purpose must match the name of a field from the XML file, prefixed with
'@'.  You can use field names to select only desired fields.  User
variables can be employed to store the corresponding field values for
subsequent re-use.

The 'IGNORE NUMBER LINES' or 'IGNORE NUMBER ROWS' clause causes the
first NUMBER rows in the XML file to be skipped.  It is analogous to the
*note 'LOAD DATA': load-data. statement's 'IGNORE ... LINES' clause.

Suppose that we have a table named 'person', created as shown here:

     USE test;

     CREATE TABLE person (
         person_id INT NOT NULL PRIMARY KEY,
         fname VARCHAR(40) NULL,
         lname VARCHAR(40) NULL,
         created TIMESTAMP
     );

Suppose further that this table is initially empty.

Now suppose that we have a simple XML file 'person.xml', whose contents
are as shown here:

     <list>
       <person person_id="1" fname="Kapek" lname="Sainnouine"/>
       <person person_id="2" fname="Sajon" lname="Rondela"/>
       <person person_id="3"><fname>Likame</fname><lname>O"rrtmons</lname></person>
       <person person_id="4"><fname>Slar</fname><lname>Manlanth</lname></person>
       <person><field name="person_id">5</field><field name="fname">Stoma</field>
         <field name="lname">Milu</field></person>
       <person><field name="person_id">6</field><field name="fname">Nirtam</field>
         <field name="lname">Sklo"d</field></person>
       <person person_id="7"><fname>Sungam</fname><lname>Dulbaad</lname></person>
       <person person_id="8" fname="Sraref" lname="Encmelt"/>
     </list>

Each of the permissible XML formats discussed previously is represented
in this example file.

To import the data in 'person.xml' into the 'person' table, you can use
this statement:

     mysql> LOAD XML LOCAL INFILE 'person.xml'
         ->   INTO TABLE person
         ->   ROWS IDENTIFIED BY '<person>';

     Query OK, 8 rows affected (0.00 sec)
     Records: 8  Deleted: 0  Skipped: 0  Warnings: 0

Here, we assume that 'person.xml' is located in the MySQL data
directory.  If the file cannot be found, the following error results:

     ERROR 2 (HY000): File '/person.xml' not found (Errcode: 2)

The 'ROWS IDENTIFIED BY '<person>'' clause means that each '<person>'
element in the XML file is considered equivalent to a row in the table
into which the data is to be imported.  In this case, this is the
'person' table in the 'test' database.

As can be seen by the response from the server, 8 rows were imported
into the 'test.person' table.  This can be verified by a simple *note
'SELECT': select. statement:

     mysql> SELECT * FROM person;
     +-----------+--------+------------+---------------------+
     | person_id | fname  | lname      | created             |
     +-----------+--------+------------+---------------------+
     |         1 | Kapek  | Sainnouine | 2007-07-13 16:18:47 |
     |         2 | Sajon  | Rondela    | 2007-07-13 16:18:47 |
     |         3 | Likame | O"rrtmons   | 2007-07-13 16:18:47 |
     |         4 | Slar   | Manlanth   | 2007-07-13 16:18:47 |
     |         5 | Stoma  | Nilu       | 2007-07-13 16:18:47 |
     |         6 | Nirtam | Sklo"d      | 2007-07-13 16:18:47 |
     |         7 | Sungam | Dulbaad     | 2007-07-13 16:18:47 |
     |         8 | Sreraf | Encmelt    | 2007-07-13 16:18:47 |
     +-----------+--------+------------+---------------------+
     8 rows in set (0.00 sec)

This shows, as stated earlier in this section, that any or all of the 3
permitted XML formats may appear in a single file and be read using
*note 'LOAD XML': load-xml.

The inverse of the import operation just shown--that is, dumping MySQL
table data into an XML file--can be accomplished using the *note
'mysql': mysql. client from the system shell, as shown here:

     shell> mysql --xml -e "SELECT * FROM test.person" > person-dump.xml
     shell> cat person-dump.xml
     <?xml version="1.0"?>

     <resultset statement="SELECT * FROM test.person" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
       <row>
     	<field name="person_id">1</field>
     	<field name="fname">Kapek</field>
     	<field name="lname">Sainnouine</field>
       </row>

       <row>
     	<field name="person_id">2</field>
     	<field name="fname">Sajon</field>
     	<field name="lname">Rondela</field>
       </row>

       <row>
     	<field name="person_id">3</field>
     	<field name="fname">Likema</field>
     	<field name="lname">O"rrtmons</field>
       </row>

       <row>
     	<field name="person_id">4</field>
     	<field name="fname">Slar</field>
     	<field name="lname">Manlanth</field>
       </row>

       <row>
     	<field name="person_id">5</field>
     	<field name="fname">Stoma</field>
     	<field name="lname">Nilu</field>
       </row>

       <row>
     	<field name="person_id">6</field>
     	<field name="fname">Nirtam</field>
     	<field name="lname">Sklo"d</field>
       </row>

       <row>
     	<field name="person_id">7</field>
     	<field name="fname">Sungam</field>
     	<field name="lname">Dulbaad</field>
       </row>

       <row>
     	<field name="person_id">8</field>
     	<field name="fname">Sreraf</field>
     	<field name="lname">Encmelt</field>
       </row>
     </resultset>

*Note*:

The '--xml' option causes the *note 'mysql': mysql. client to use XML
formatting for its output; the '-e' option causes the client to execute
the SQL statement immediately following the option.  See *note mysql::.

You can verify that the dump is valid by creating a copy of the 'person'
table and importing the dump file into the new table, like this:

     mysql> USE test;
     mysql> CREATE TABLE person2 LIKE person;
     Query OK, 0 rows affected (0.00 sec)

     mysql> LOAD XML LOCAL INFILE 'person-dump.xml'
         ->   INTO TABLE person2;
     Query OK, 8 rows affected (0.01 sec)
     Records: 8  Deleted: 0  Skipped: 0  Warnings: 0

     mysql> SELECT * FROM person2;
     +-----------+--------+------------+---------------------+
     | person_id | fname  | lname      | created             |
     +-----------+--------+------------+---------------------+
     |         1 | Kapek  | Sainnouine | 2007-07-13 16:18:47 |
     |         2 | Sajon  | Rondela    | 2007-07-13 16:18:47 |
     |         3 | Likema | O"rrtmons   | 2007-07-13 16:18:47 |
     |         4 | Slar   | Manlanth   | 2007-07-13 16:18:47 |
     |         5 | Stoma  | Nilu       | 2007-07-13 16:18:47 |
     |         6 | Nirtam | Sklo"d      | 2007-07-13 16:18:47 |
     |         7 | Sungam | Dulbaad     | 2007-07-13 16:18:47 |
     |         8 | Sreraf | Encmelt    | 2007-07-13 16:18:47 |
     +-----------+--------+------------+---------------------+
     8 rows in set (0.00 sec)

There is no requirement that every field in the XML file be matched with
a column in the corresponding table.  Fields which have no corresponding
columns are skipped.  You can see this by first emptying the 'person2'
table and dropping the 'created' column, then using the same *note 'LOAD
XML': load-xml. statement we just employed previously, like this:

     mysql> TRUNCATE person2;
     Query OK, 8 rows affected (0.26 sec)

     mysql> ALTER TABLE person2 DROP COLUMN created;
     Query OK, 0 rows affected (0.52 sec)
     Records: 0  Duplicates: 0  Warnings: 0

     mysql> SHOW CREATE TABLE person2\G
     *************************** 1. row ***************************
            Table: person2
     Create Table: CREATE TABLE `person2` (
       `person_id` int(11) NOT NULL,
       `fname` varchar(40) DEFAULT NULL,
       `lname` varchar(40) DEFAULT NULL,
       PRIMARY KEY (`person_id`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8
     1 row in set (0.00 sec)

     mysql> LOAD XML LOCAL INFILE 'person-dump.xml'
         ->   INTO TABLE person2;
     Query OK, 8 rows affected (0.01 sec)
     Records: 8  Deleted: 0  Skipped: 0  Warnings: 0

     mysql> SELECT * FROM person2;
     +-----------+--------+------------+
     | person_id | fname  | lname      |
     +-----------+--------+------------+
     |         1 | Kapek  | Sainnouine |
     |         2 | Sajon  | Rondela    |
     |         3 | Likema | O"rrtmons   |
     |         4 | Slar   | Manlanth   |
     |         5 | Stoma  | Nilu       |
     |         6 | Nirtam | Sklo"d      |
     |         7 | Sungam | Dulbaad     |
     |         8 | Sreraf | Encmelt    |
     +-----------+--------+------------+
     8 rows in set (0.00 sec)

The order in which the fields are given within each row of the XML file
does not affect the operation of *note 'LOAD XML': load-xml.; the field
order can vary from row to row, and is not required to be in the same
order as the corresponding columns in the table.

As mentioned previously, you can use a '(FIELD_NAME_OR_USER_VAR, ...)'
list of one or more XML fields (to select desired fields only) or user
variables (to store the corresponding field values for later use).  User
variables can be especially useful when you want to insert data from an
XML file into table columns whose names do not match those of the XML
fields.  To see how this works, we first create a table named
'individual' whose structure matches that of the 'person' table, but
whose columns are named differently:

     mysql> CREATE TABLE individual (
         ->     individual_id INT NOT NULL PRIMARY KEY,
         ->     name1 VARCHAR(40) NULL,
         ->     name2 VARCHAR(40) NULL,
         ->     made TIMESTAMP
         -> );
     Query OK, 0 rows affected (0.42 sec)

In this case, you cannot simply load the XML file directly into the
table, because the field and column names do not match:

     mysql> LOAD XML INFILE '../bin/person-dump.xml' INTO TABLE test.individual;
     ERROR 1263 (22004): Column set to default value; NULL supplied to NOT NULL column 'individual_id' at row 1

This happens because the MySQL server looks for field names matching the
column names of the target table.  You can work around this problem by
selecting the field values into user variables, then setting the target
table's columns equal to the values of those variables using 'SET'.  You
can perform both of these operations in a single statement, as shown
here:

     mysql> LOAD XML INFILE '../bin/person-dump.xml'
         ->     INTO TABLE test.individual (@person_id, @fname, @lname, @created)
         ->     SET individual_id=@person_id, name1=@fname, name2=@lname, made=@created;
     Query OK, 8 rows affected (0.05 sec)
     Records: 8  Deleted: 0  Skipped: 0  Warnings: 0

     mysql> SELECT * FROM individual;
     +---------------+--------+------------+---------------------+
     | individual_id | name1  | name2      | made                |
     +---------------+--------+------------+---------------------+
     |             1 | Kapek  | Sainnouine | 2007-07-13 16:18:47 |
     |             2 | Sajon  | Rondela    | 2007-07-13 16:18:47 |
     |             3 | Likema | O"rrtmons   | 2007-07-13 16:18:47 |
     |             4 | Slar   | Manlanth   | 2007-07-13 16:18:47 |
     |             5 | Stoma  | Nilu       | 2007-07-13 16:18:47 |
     |             6 | Nirtam | Sklo"d      | 2007-07-13 16:18:47 |
     |             7 | Sungam | Dulbaad     | 2007-07-13 16:18:47 |
     |             8 | Srraf  | Encmelt    | 2007-07-13 16:18:47 |
     +---------------+--------+------------+---------------------+
     8 rows in set (0.00 sec)

The names of the user variables _must_ match those of the corresponding
fields from the XML file, with the addition of the required '@' prefix
to indicate that they are variables.  The user variables need not be
listed or assigned in the same order as the corresponding fields.

Using a 'ROWS IDENTIFIED BY '<TAGNAME>'' clause, it is possible to
import data from the same XML file into database tables with different
definitions.  For this example, suppose that you have a file named
'address.xml' which contains the following XML:

     <?xml version="1.0"?>

     <list>
       <person person_id="1">
         <fname>Robert</fname>
         <lname>Jones</lname>
         <address address_id="1" street="Mill Creek Road" zip="45365" city="Sidney"/>
         <address address_id="2" street="Main Street" zip="28681" city="Taylorsville"/>
       </person>

       <person person_id="2">
         <fname>Mary</fname>
         <lname>Smith</lname>
         <address address_id="3" street="River Road" zip="80239" city="Denver"/>
         <!-- <address address_id="4" street="North Street" zip="37920" city="Knoxville"/> -->
       </person>

     </list>

You can again use the 'test.person' table as defined previously in this
section, after clearing all the existing records from the table and then
showing its structure as shown here:

     mysql< TRUNCATE person;
     Query OK, 0 rows affected (0.04 sec)

     mysql< SHOW CREATE TABLE person\G
     *************************** 1. row ***************************
            Table: person
     Create Table: CREATE TABLE `person` (
       `person_id` int(11) NOT NULL,
       `fname` varchar(40) DEFAULT NULL,
       `lname` varchar(40) DEFAULT NULL,
       `created` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
       PRIMARY KEY (`person_id`)
     ) ENGINE=MyISAM DEFAULT CHARSET=latin1
     1 row in set (0.00 sec)

Now create an 'address' table in the 'test' database using the following
*note 'CREATE TABLE': create-table. statement:

     CREATE TABLE address (
         address_id INT NOT NULL PRIMARY KEY,
         person_id INT NULL,
         street VARCHAR(40) NULL,
         zip INT NULL,
         city VARCHAR(40) NULL,
         created TIMESTAMP
     );

To import the data from the XML file into the 'person' table, execute
the following *note 'LOAD XML': load-xml. statement, which specifies
that rows are to be specified by the '<person>' element, as shown here;

     mysql> LOAD XML LOCAL INFILE 'address.xml'
         ->   INTO TABLE person
         ->   ROWS IDENTIFIED BY '<person>';
     Query OK, 2 rows affected (0.00 sec)
     Records: 2  Deleted: 0  Skipped: 0  Warnings: 0

You can verify that the records were imported using a *note 'SELECT':
select. statement:

     mysql> SELECT * FROM person;
     +-----------+--------+-------+---------------------+
     | person_id | fname  | lname | created             |
     +-----------+--------+-------+---------------------+
     |         1 | Robert | Jones | 2007-07-24 17:37:06 |
     |         2 | Mary   | Smith | 2007-07-24 17:37:06 |
     +-----------+--------+-------+---------------------+
     2 rows in set (0.00 sec)

Since the '<address>' elements in the XML file have no corresponding
columns in the 'person' table, they are skipped.

To import the data from the '<address>' elements into the 'address'
table, use the *note 'LOAD XML': load-xml. statement shown here:

     mysql> LOAD XML LOCAL INFILE 'address.xml'
         ->   INTO TABLE address
         ->   ROWS IDENTIFIED BY '<address>';
     Query OK, 3 rows affected (0.00 sec)
     Records: 3  Deleted: 0  Skipped: 0  Warnings: 0

You can see that the data was imported using a *note 'SELECT': select.
statement such as this one:

     mysql> SELECT * FROM address;
     +------------+-----------+-----------------+-------+--------------+---------------------+
     | address_id | person_id | street          | zip   | city         | created             |
     +------------+-----------+-----------------+-------+--------------+---------------------+
     |          1 |         1 | Mill Creek Road | 45365 | Sidney       | 2007-07-24 17:37:37 |
     |          2 |         1 | Main Street     | 28681 | Taylorsville | 2007-07-24 17:37:37 |
     |          3 |         2 | River Road      | 80239 | Denver       | 2007-07-24 17:37:37 |
     +------------+-----------+-----------------+-------+--------------+---------------------+
     3 rows in set (0.00 sec)

The data from the '<address>' element that is enclosed in XML comments
is not imported.  However, since there is a 'person_id' column in the
'address' table, the value of the 'person_id' attribute from the parent
'<person>' element for each '<address>' _is_ imported into the 'address'
table.

Security Considerations

As with the *note 'LOAD DATA': load-data. statement, the transfer of the
XML file from the client host to the server host is initiated by the
MySQL server.  In theory, a patched server could be built that would
tell the client program to transfer a file of the server's choosing
rather than the file named by the client in the *note 'LOAD XML':
load-xml. statement.  Such a server could access any file on the client
host to which the client user has read access.

In a Web environment, clients usually connect to MySQL from a Web
server.  A user that can run any command against the MySQL server can
use *note 'LOAD XML LOCAL': load-xml. to read any files to which the Web
server process has read access.  In this environment, the client with
respect to the MySQL server is actually the Web server, not the remote
program being run by the user who connects to the Web server.

You can disable loading of XML files from clients by starting the server
with '--local-infile=0' or '--local-infile=OFF'.  This option can also
be used when starting the *note 'mysql': mysql. client to disable *note
'LOAD XML': load-xml. for the duration of the client session.

To prevent a client from loading XML files from the server, do not grant
the 'FILE' privilege to the corresponding MySQL user account, or revoke
this privilege if the client user account already has it.

*Important*:

Revoking the 'FILE' privilege (or not granting it in the first place)
keeps the user only from executing the *note 'LOAD XML': load-xml.
statement (as well as the 'LOAD_FILE()' function; it does _not_ prevent
the user from executing *note 'LOAD XML LOCAL': load-xml.  To disallow
this statement, you must start the server or the client with
'--local-infile=OFF'.

In other words, the 'FILE' privilege affects only whether the client can
read files on the server; it has no bearing on whether the client can
read files on the local file system.

For partitioned tables using storage engines that employ table locks,
such as *note 'MyISAM': myisam-storage-engine, any locks caused by *note
'LOAD XML': load-xml. perform locks on all partitions of the table.
This does not apply to tables using storage engines which employ
row-level locking, such as *note 'InnoDB': innodb-storage-engine.  For
more information, see *note partitioning-limitations-locking::.


File: manual.info.tmp,  Node: replace,  Next: select,  Prev: load-xml,  Up: sql-data-manipulation-statements

13.2.8 REPLACE Statement
------------------------

     REPLACE [LOW_PRIORITY | DELAYED]
         [INTO] TBL_NAME
         [(COL_NAME [, COL_NAME] ...)]
         {VALUES | VALUE} (VALUE_LIST) [, (VALUE_LIST)] ...

     REPLACE [LOW_PRIORITY | DELAYED]
         [INTO] TBL_NAME
         SET ASSIGNMENT_LIST

     REPLACE [LOW_PRIORITY | DELAYED]
         [INTO] TBL_NAME
         [(COL_NAME [, COL_NAME] ...)]
         SELECT ...

     VALUE:
         {EXPR | DEFAULT}

     VALUE_LIST:
         VALUE [, VALUE] ...

     ASSIGNMENT:
         COL_NAME = VALUE

     ASSIGNMENT_LIST:
         ASSIGNMENT [, ASSIGNMENT] ...

*note 'REPLACE': replace. works exactly like *note 'INSERT': insert,
except that if an old row in the table has the same value as a new row
for a 'PRIMARY KEY' or a 'UNIQUE' index, the old row is deleted before
the new row is inserted.  See *note insert::.

*note 'REPLACE': replace. is a MySQL extension to the SQL standard.  It
either inserts, or _deletes_ and inserts.  For another MySQL extension
to standard SQL--that either inserts or _updates_--see *note
insert-on-duplicate::.

*Note*:

*note 'REPLACE': replace. makes sense only if a table has a 'PRIMARY
KEY' or 'UNIQUE' index.  Otherwise, it becomes equivalent to *note
'INSERT': insert, because there is no index to be used to determine
whether a new row duplicates another.

Values for all columns are taken from the values specified in the *note
'REPLACE': replace. statement.  Any missing columns are set to their
default values, just as happens for *note 'INSERT': insert.  You cannot
refer to values from the current row and use them in the new row.  If
you use an assignment such as 'SET COL_NAME = COL_NAME + 1', the
reference to the column name on the right hand side is treated as
'DEFAULT(COL_NAME)', so the assignment is equivalent to 'SET COL_NAME =
DEFAULT(COL_NAME) + 1'.

To use *note 'REPLACE': replace, you must have both the 'INSERT' and
'DELETE' privileges for the table.

The *note 'REPLACE': replace. statement returns a count to indicate the
number of rows affected.  This is the sum of the rows deleted and
inserted.  If the count is 1 for a single-row *note 'REPLACE': replace,
a row was inserted and no rows were deleted.  If the count is greater
than 1, one or more old rows were deleted before the new row was
inserted.  It is possible for a single row to replace more than one old
row if the table contains multiple unique indexes and the new row
duplicates values for different old rows in different unique indexes.

The affected-rows count makes it easy to determine whether *note
'REPLACE': replace. only added a row or whether it also replaced any
rows: Check whether the count is 1 (added) or greater (replaced).

If you are using the C API, the affected-rows count can be obtained
using the *note 'mysql_affected_rows()': mysql-affected-rows. function.

You cannot replace into a table and select from the same table in a
subquery.

MySQL uses the following algorithm for *note 'REPLACE': replace. (and
*note 'LOAD DATA ... REPLACE': load-data.):

  1. Try to insert the new row into the table

  2. While the insertion fails because a duplicate-key error occurs for
     a primary key or unique index:

       1. Delete from the table the conflicting row that has the
          duplicate key value

       2. Try again to insert the new row into the table

It is possible that in the case of a duplicate-key error, a storage
engine may perform the 'REPLACE' as an update rather than a delete plus
insert, but the semantics are the same.  There are no user-visible
effects other than a possible difference in how the storage engine
increments 'Handler_XXX' status variables.

Because the results of 'REPLACE ... SELECT' statements depend on the
ordering of rows from the *note 'SELECT': select. and this order cannot
always be guaranteed, it is possible when logging these statements for
the master and the slave to diverge.  For this reason, in MySQL 5.5.18
and later, 'REPLACE ... SELECT' statements are flagged as unsafe for
statement-based replication.  With this change, such statements produce
a warning in the error log when using statement-based mode, and are
written to the binary log using the row-based format when using 'MIXED'
mode.  See also *note replication-sbr-rbr::.

When modifying an existing table that is not partitioned to accommodate
partitioning, or, when modifying the partitioning of an already
partitioned table, you may consider altering the table's primary key
(see *note partitioning-limitations-partitioning-keys-unique-keys::).
You should be aware that, if you do this, the results of 'REPLACE'
statements may be affected, just as they would be if you modified the
primary key of a nonpartitioned table.  Consider the table created by
the following *note 'CREATE TABLE': create-table. statement:

     CREATE TABLE test (
       id INT UNSIGNED NOT NULL AUTO_INCREMENT,
       data VARCHAR(64) DEFAULT NULL,
       ts TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
       PRIMARY KEY (id)
     );

When we create this table and run the statements shown in the mysql
client, the result is as follows:

     mysql> REPLACE INTO test VALUES (1, 'Old', '2014-08-20 18:47:00');
     Query OK, 1 row affected (0.04 sec)

     mysql> REPLACE INTO test VALUES (1, 'New', '2014-08-20 18:47:42');
     Query OK, 2 rows affected (0.04 sec)

     mysql> SELECT * FROM test;
     +----+------+---------------------+
     | id | data | ts                  |
     +----+------+---------------------+
     |  1 | New  | 2014-08-20 18:47:42 |
     +----+------+---------------------+
     1 row in set (0.00 sec)

Now we create a second table almost identical to the first, except that
the primary key now covers 2 columns, as shown here (emphasized text):

     CREATE TABLE test2 (
       id INT UNSIGNED NOT NULL AUTO_INCREMENT,
       data VARCHAR(64) DEFAULT NULL,
       ts TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
       _PRIMARY KEY (id, ts)_
     );

When we run on 'test2' the same two 'REPLACE' statements as we did on
the original 'test' table, we obtain a different result:

     mysql> REPLACE INTO test2 VALUES (1, 'Old', '2014-08-20 18:47:00');
     Query OK, 1 row affected (0.05 sec)

     mysql> REPLACE INTO test2 VALUES (1, 'New', '2014-08-20 18:47:42');
     Query OK, 1 row affected (0.06 sec)

     mysql> SELECT * FROM test2;
     +----+------+---------------------+
     | id | data | ts                  |
     +----+------+---------------------+
     |  1 | Old  | 2014-08-20 18:47:00 |
     |  1 | New  | 2014-08-20 18:47:42 |
     +----+------+---------------------+
     2 rows in set (0.00 sec)

This is due to the fact that, when run on 'test2', both the 'id' and
'ts' column values must match those of an existing row for the row to be
replaced; otherwise, a row is inserted.

A 'REPLACE' statement affecting a partitioned table using a storage
engine such as *note 'MyISAM': myisam-storage-engine. that employs
table-level locks locks all partitions of the table.  This does not
occur with tables using storage engines such as *note 'InnoDB':
innodb-storage-engine. that employ row-level locking.  This issue is
resolved in MySQL 5.6.  For more information, see *note
partitioning-limitations-locking::.


File: manual.info.tmp,  Node: select,  Next: subqueries,  Prev: replace,  Up: sql-data-manipulation-statements

13.2.9 SELECT Statement
-----------------------

* Menu:

* select-into::                  SELECT ... INTO Statement
* join::                         JOIN Clause
* union::                        UNION Clause

     SELECT
         [ALL | DISTINCT | DISTINCTROW ]
         [HIGH_PRIORITY]
         [STRAIGHT_JOIN]
         [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT]
         [SQL_CACHE | SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS]
         SELECT_EXPR [, SELECT_EXPR] ...
         [INTO_OPTION]
         [FROM TABLE_REFERENCES]
         [WHERE WHERE_CONDITION]
         [GROUP BY {COL_NAME | EXPR | POSITION}
           [ASC | DESC], ... [WITH ROLLUP]]
         [HAVING WHERE_CONDITION]
         [ORDER BY {COL_NAME | EXPR | POSITION}
           [ASC | DESC], ...]
         [LIMIT {[OFFSET,] ROW_COUNT | ROW_COUNT OFFSET OFFSET}]
         [PROCEDURE PROCEDURE_NAME(ARGUMENT_LIST)]
         [INTO_OPTION]
         [FOR UPDATE | LOCK IN SHARE MODE]

     INTO_OPTION: {
         INTO OUTFILE 'FILE_NAME'
             [CHARACTER SET CHARSET_NAME]
             EXPORT_OPTIONS
       | INTO DUMPFILE 'FILE_NAME'
       | INTO VAR_NAME [, VAR_NAME] ...
     }

*note 'SELECT': select. is used to retrieve rows selected from one or
more tables, and can include *note 'UNION': union. statements and
subqueries.  See *note union::, and *note subqueries::.

The most commonly used clauses of *note 'SELECT': select. statements are
these:

   * Each SELECT_EXPR indicates a column that you want to retrieve.
     There must be at least one SELECT_EXPR.

   * TABLE_REFERENCES indicates the table or tables from which to
     retrieve rows.  Its syntax is described in *note join::.

   * The 'WHERE' clause, if given, indicates the condition or conditions
     that rows must satisfy to be selected.  WHERE_CONDITION is an
     expression that evaluates to true for each row to be selected.  The
     statement selects all rows if there is no 'WHERE' clause.

     In the 'WHERE' expression, you can use any of the functions and
     operators that MySQL supports, except for aggregate (summary)
     functions.  See *note expressions::, and *note functions::.

*note 'SELECT': select. can also be used to retrieve rows computed
without reference to any table.

For example:

     mysql> SELECT 1 + 1;
             -> 2

You are permitted to specify 'DUAL' as a dummy table name in situations
where no tables are referenced:

     mysql> SELECT 1 + 1 FROM DUAL;
             -> 2

'DUAL' is purely for the convenience of people who require that all
*note 'SELECT': select. statements should have 'FROM' and possibly other
clauses.  MySQL may ignore the clauses.  MySQL does not require 'FROM
DUAL' if no tables are referenced.

In general, clauses used must be given in exactly the order shown in the
syntax description.  For example, a 'HAVING' clause must come after any
'GROUP BY' clause and before any 'ORDER BY' clause.  The 'INTO' clause,
if present, can appear in any position indicated by the syntax
description, but within a given statement can appear only once, not in
multiple positions.  For more information about 'INTO', see *note
select-into::.

The list of SELECT_EXPR terms comprises the select list that indicates
which columns to retrieve.  Terms specify a column or expression or can
use '*'-shorthand:

   * A select list consisting only of a single unqualified '*' can be
     used as shorthand to select all columns from all tables:

          SELECT * FROM t1 INNER JOIN t2 ...

   * 'TBL_NAME.*' can be used as a qualified shorthand to select all
     columns from the named table:

          SELECT t1.*, t2.* FROM t1 INNER JOIN t2 ...

   * Use of an unqualified '*' with other items in the select list may
     produce a parse error.  To avoid this problem, use a qualified
     'TBL_NAME.*' reference

          SELECT AVG(score), t1.* FROM t1 ...

The following list provides additional information about other 'SELECT'
clauses:

   * 
     A SELECT_EXPR can be given an alias using 'AS ALIAS_NAME'.  The
     alias is used as the expression's column name and can be used in
     'GROUP BY', 'ORDER BY', or 'HAVING' clauses.  For example:

          SELECT CONCAT(last_name,', ',first_name) AS full_name
            FROM mytable ORDER BY full_name;

     The 'AS' keyword is optional when aliasing a SELECT_EXPR with an
     identifier.  The preceding example could have been written like
     this:

          SELECT CONCAT(last_name,', ',first_name) full_name
            FROM mytable ORDER BY full_name;

     However, because the 'AS' is optional, a subtle problem can occur
     if you forget the comma between two SELECT_EXPR expressions: MySQL
     interprets the second as an alias name.  For example, in the
     following statement, 'columnb' is treated as an alias name:

          SELECT columna columnb FROM mytable;

     For this reason, it is good practice to be in the habit of using
     'AS' explicitly when specifying column aliases.

     It is not permissible to refer to a column alias in a 'WHERE'
     clause, because the column value might not yet be determined when
     the 'WHERE' clause is executed.  See *note problems-with-alias::.

   * 
     The 'FROM TABLE_REFERENCES' clause indicates the table or tables
     from which to retrieve rows.  If you name more than one table, you
     are performing a join.  For information on join syntax, see *note
     join::.  For each table specified, you can optionally specify an
     alias.

          TBL_NAME [[AS] ALIAS] [INDEX_HINT]

     The use of index hints provides the optimizer with information
     about how to choose indexes during query processing.  For a
     description of the syntax for specifying these hints, see *note
     index-hints::.

     You can use 'SET max_seeks_for_key=VALUE' as an alternative way to
     force MySQL to prefer key scans instead of table scans.  See *note
     server-system-variables::.

   * You can refer to a table within the default database as TBL_NAME,
     or as DB_NAME.TBL_NAME to specify a database explicitly.  You can
     refer to a column as COL_NAME, TBL_NAME.COL_NAME, or
     DB_NAME.TBL_NAME.COL_NAME.  You need not specify a TBL_NAME or
     DB_NAME.TBL_NAME prefix for a column reference unless the reference
     would be ambiguous.  See *note identifier-qualifiers::, for
     examples of ambiguity that require the more explicit column
     reference forms.

   * 
     A table reference can be aliased using 'TBL_NAME AS ALIAS_NAME' or
     TBL_NAME ALIAS_NAME.  These statements are equivalent:

          SELECT t1.name, t2.salary FROM employee AS t1, info AS t2
            WHERE t1.name = t2.name;

          SELECT t1.name, t2.salary FROM employee t1, info t2
            WHERE t1.name = t2.name;

   * 
     Columns selected for output can be referred to in 'ORDER BY' and
     'GROUP BY' clauses using column names, column aliases, or column
     positions.  Column positions are integers and begin with 1:

          SELECT college, region, seed FROM tournament
            ORDER BY region, seed;

          SELECT college, region AS r, seed AS s FROM tournament
            ORDER BY r, s;

          SELECT college, region, seed FROM tournament
            ORDER BY 2, 3;

     To sort in reverse order, add the 'DESC' (descending) keyword to
     the name of the column in the 'ORDER BY' clause that you are
     sorting by.  The default is ascending order; this can be specified
     explicitly using the 'ASC' keyword.

     If 'ORDER BY' occurs within a subquery and also is applied in the
     outer query, the outermost 'ORDER BY' takes precedence.  For
     example, results for the following statement are sorted in
     descending order, not ascending order:

          (SELECT ... ORDER BY a) ORDER BY a DESC;

     Use of column positions is deprecated because the syntax has been
     removed from the SQL standard.

   * 
     MySQL extends the 'GROUP BY' clause so that you can also specify
     'ASC' and 'DESC' after columns named in the clause:

          SELECT a, COUNT(b) FROM test_table GROUP BY a DESC;

   * 
     If you use 'GROUP BY', output rows are sorted according to the
     'GROUP BY' columns as if you had an 'ORDER BY' for the same
     columns.  To avoid the overhead of sorting that 'GROUP BY'
     produces, add 'ORDER BY NULL':

          SELECT a, COUNT(b) FROM test_table GROUP BY a ORDER BY NULL;

     Relying on implicit 'GROUP BY' sorting (that is, sorting in the
     absence of 'ASC' or 'DESC' designators) is deprecated.  To produce
     a given sort order, use explicit 'ASC' or 'DESC' designators for
     'GROUP BY' columns or provide an 'ORDER BY' clause.

   * 
     When you use 'ORDER BY' or 'GROUP BY' to sort a column in a *note
     'SELECT': select, the server sorts values using only the initial
     number of bytes indicated by the 'max_sort_length' system variable.

   * MySQL extends the use of 'GROUP BY' to permit selecting fields that
     are not mentioned in the 'GROUP BY' clause.  If you are not getting
     the results that you expect from your query, please read the
     description of 'GROUP BY' found in *note
     group-by-functions-and-modifiers::.

   * 'GROUP BY' permits a 'WITH ROLLUP' modifier.  See *note
     group-by-modifiers::.

   * 
     The 'HAVING' clause is applied nearly last, just before items are
     sent to the client, with no optimization.  ('LIMIT' is applied
     after 'HAVING'.)

     The SQL standard requires that 'HAVING' must reference only columns
     in the 'GROUP BY' clause or columns used in aggregate functions.
     However, MySQL supports an extension to this behavior, and permits
     'HAVING' to refer to columns in the *note 'SELECT': select. list
     and columns in outer subqueries as well.

     If the 'HAVING' clause refers to a column that is ambiguous, a
     warning occurs.  In the following statement, 'col2' is ambiguous
     because it is used as both an alias and a column name:

          SELECT COUNT(col1) AS col2 FROM t GROUP BY col2 HAVING col2 = 2;

     Preference is given to standard SQL behavior, so if a 'HAVING'
     column name is used both in 'GROUP BY' and as an aliased column in
     the output column list, preference is given to the column in the
     'GROUP BY' column.

   * Do not use 'HAVING' for items that should be in the 'WHERE' clause.
     For example, do not write the following:

          SELECT COL_NAME FROM TBL_NAME HAVING COL_NAME > 0;

     Write this instead:

          SELECT COL_NAME FROM TBL_NAME WHERE COL_NAME > 0;

   * The 'HAVING' clause can refer to aggregate functions, which the
     'WHERE' clause cannot:

          SELECT user, MAX(salary) FROM users
            GROUP BY user HAVING MAX(salary) > 10;

     (This did not work in some older versions of MySQL.)

   * MySQL permits duplicate column names.  That is, there can be more
     than one SELECT_EXPR with the same name.  This is an extension to
     standard SQL. Because MySQL also permits 'GROUP BY' and 'HAVING' to
     refer to SELECT_EXPR values, this can result in an ambiguity:

          SELECT 12 AS a, a FROM t GROUP BY a;

     In that statement, both columns have the name 'a'.  To ensure that
     the correct column is used for grouping, use different names for
     each SELECT_EXPR.

   * MySQL resolves unqualified column or alias references in 'ORDER BY'
     clauses by searching in the SELECT_EXPR values, then in the columns
     of the tables in the 'FROM' clause.  For 'GROUP BY' or 'HAVING'
     clauses, it searches the 'FROM' clause before searching in the
     SELECT_EXPR values.  (For 'GROUP BY' and 'HAVING', this differs
     from the pre-MySQL 5.0 behavior that used the same rules as for
     'ORDER BY'.)

   * 
     The 'LIMIT' clause can be used to constrain the number of rows
     returned by the *note 'SELECT': select. statement.  'LIMIT' takes
     one or two numeric arguments, which must both be nonnegative
     integer constants, with these exceptions:

        * Within prepared statements, 'LIMIT' parameters can be
          specified using '?' placeholder markers.

        * Within stored programs, 'LIMIT' parameters can be specified
          using integer-valued routine parameters or local variables.

     With two arguments, the first argument specifies the offset of the
     first row to return, and the second specifies the maximum number of
     rows to return.  The offset of the initial row is 0 (not 1):

          SELECT * FROM tbl LIMIT 5,10;  # Retrieve rows 6-15

     To retrieve all rows from a certain offset up to the end of the
     result set, you can use some large number for the second parameter.
     This statement retrieves all rows from the 96th row to the last:

          SELECT * FROM tbl LIMIT 95,18446744073709551615;

     With one argument, the value specifies the number of rows to return
     from the beginning of the result set:

          SELECT * FROM tbl LIMIT 5;     # Retrieve first 5 rows

     In other words, 'LIMIT ROW_COUNT' is equivalent to 'LIMIT 0,
     ROW_COUNT'.

     For prepared statements, you can use placeholders.  The following
     statements will return one row from the 'tbl' table:

          SET @a=1;
          PREPARE STMT FROM 'SELECT * FROM tbl LIMIT ?';
          EXECUTE STMT USING @a;

     The following statements will return the second to sixth row from
     the 'tbl' table:

          SET @skip=1; SET @numrows=5;
          PREPARE STMT FROM 'SELECT * FROM tbl LIMIT ?, ?';
          EXECUTE STMT USING @skip, @numrows;

     For compatibility with PostgreSQL, MySQL also supports the 'LIMIT
     ROW_COUNT OFFSET OFFSET' syntax.

     If 'LIMIT' occurs within a subquery and also is applied in the
     outer query, the outermost 'LIMIT' takes precedence.  For example,
     the following statement produces two rows, not one:

          (SELECT ... LIMIT 1) LIMIT 2;

   * 
     A 'PROCEDURE' clause names a procedure that should process the data
     in the result set.  For an example, see *note procedure-analyse::,
     which describes 'ANALYSE', a procedure that can be used to obtain
     suggestions for optimal column data types that may help reduce
     table sizes.

     A 'PROCEDURE' clause is not permitted in a *note 'UNION': union.
     statement.

   * The *note 'SELECT ... INTO': select-into. form of *note 'SELECT':
     select. enables the query result to be written to a file or stored
     in variables.  For more information, see *note select-into::.

   * 
     If you use 'FOR UPDATE' with a storage engine that uses page or row
     locks, rows examined by the query are write-locked until the end of
     the current transaction.  Using 'LOCK IN SHARE MODE' sets a shared
     lock that permits other transactions to read the examined rows but
     not to update or delete them.  See *note innodb-locking-reads::.

Following the *note 'SELECT': select. keyword, you can use a number of
modifiers that affect the operation of the statement.  'HIGH_PRIORITY',
'STRAIGHT_JOIN', and modifiers beginning with 'SQL_' are MySQL
extensions to standard SQL.

   * The 'ALL' and 'DISTINCT' modifiers specify whether duplicate rows
     should be returned.  'ALL' (the default) specifies that all
     matching rows should be returned, including duplicates.  'DISTINCT'
     specifies removal of duplicate rows from the result set.  It is an
     error to specify both modifiers.  'DISTINCTROW' is a synonym for
     'DISTINCT'.

   * 'HIGH_PRIORITY' gives the *note 'SELECT': select. higher priority
     than a statement that updates a table.  You should use this only
     for queries that are very fast and must be done at once.  A 'SELECT
     HIGH_PRIORITY' query that is issued while the table is locked for
     reading runs even if there is an update statement waiting for the
     table to be free.  This affects only storage engines that use only
     table-level locking (such as 'MyISAM', 'MEMORY', and 'MERGE').

     'HIGH_PRIORITY' cannot be used with *note 'SELECT': select.
     statements that are part of a *note 'UNION': union.

   * 'STRAIGHT_JOIN' forces the optimizer to join the tables in the
     order in which they are listed in the 'FROM' clause.  You can use
     this to speed up a query if the optimizer joins the tables in
     nonoptimal order.  'STRAIGHT_JOIN' also can be used in the
     TABLE_REFERENCES list.  See *note join::.

     'STRAIGHT_JOIN' does not apply to any table that the optimizer
     treats as a 'const' or 'system' table.  Such a table produces a
     single row, is read during the optimization phase of query
     execution, and references to its columns are replaced with the
     appropriate column values before query execution proceeds.  These
     tables will appear first in the query plan displayed by *note
     'EXPLAIN': explain.  See *note using-explain::.  This exception may
     not apply to 'const' or 'system' tables that are used on the
     'NULL'-complemented side of an outer join (that is, the right-side
     table of a 'LEFT JOIN' or the left-side table of a 'RIGHT JOIN'.

   * 'SQL_BIG_RESULT' or 'SQL_SMALL_RESULT' can be used with 'GROUP BY'
     or 'DISTINCT' to tell the optimizer that the result set has many
     rows or is small, respectively.  For 'SQL_BIG_RESULT', MySQL
     directly uses disk-based temporary tables if they are created, and
     prefers sorting to using a temporary table with a key on the 'GROUP
     BY' elements.  For 'SQL_SMALL_RESULT', MySQL uses in-memory
     temporary tables to store the resulting table instead of using
     sorting.  This should not normally be needed.

   * 'SQL_BUFFER_RESULT' forces the result to be put into a temporary
     table.  This helps MySQL free the table locks early and helps in
     cases where it takes a long time to send the result set to the
     client.  This modifier can be used only for top-level *note
     'SELECT': select. statements, not for subqueries or following *note
     'UNION': union.

   * 'SQL_CALC_FOUND_ROWS' tells MySQL to calculate how many rows there
     would be in the result set, disregarding any 'LIMIT' clause.  The
     number of rows can then be retrieved with 'SELECT FOUND_ROWS()'.
     See *note information-functions::.

   * The 'SQL_CACHE' and 'SQL_NO_CACHE' modifiers affect caching of
     query results in the query cache (see *note query-cache::).
     'SQL_CACHE' tells MySQL to store the result in the query cache if
     it is cacheable and the value of the 'query_cache_type' system
     variable is '2' or 'DEMAND'.  With 'SQL_NO_CACHE', the server does
     not use the query cache.  It neither checks the query cache to see
     whether the result is already cached, nor does it cache the query
     result.  (Due to a limitation in the parser, a space character must
     precede and follow the 'SQL_NO_CACHE' keyword; a nonspace such as a
     newline causes the server to check the query cache to see whether
     the result is already cached.)

     These two modifiers are mutually exclusive and an error occurs if
     they are both specified.  Also, these modifiers are not permitted
     in subqueries (including subqueries in the 'FROM' clause), and
     *note 'SELECT': select. statements in unions other than the first
     *note 'SELECT': select.

     For views, 'SQL_NO_CACHE' applies if it appears in any *note
     'SELECT': select. in the query.  For a cacheable query, 'SQL_CACHE'
     applies if it appears in the first *note 'SELECT': select. of a
     view referred to by the query.

A 'SELECT' from a partitioned table using a storage engine such as *note
'MyISAM': myisam-storage-engine. that employs table-level locks locks
all partitions of the table.  This does not occur with tables using
storage engines such as *note 'InnoDB': innodb-storage-engine. that
employ row-level locking.  This issue is resolved in MySQL 5.6.  For
more information, see *note partitioning-limitations-locking::.


File: manual.info.tmp,  Node: select-into,  Next: join,  Prev: select,  Up: select

13.2.9.1 SELECT ... INTO Statement
..................................

The *note 'SELECT ... INTO': select-into. form of *note 'SELECT':
select. enables a query result to be stored in variables or written to a
file:

   * 'SELECT ... INTO VAR_LIST' selects column values and stores them
     into variables.

   * 'SELECT ... INTO OUTFILE' writes the selected rows to a file.
     Column and line terminators can be specified to produce a specific
     output format.

   * 'SELECT ... INTO DUMPFILE' writes a single row to a file without
     any formatting.

A given *note 'SELECT': select. statement can contain at most one 'INTO'
clause, although as shown by the *note 'SELECT': select. syntax
description (see *note select::), the 'INTO' can appear in different
positions:

   * Before 'FROM'.  Example:

          SELECT * INTO @myvar FROM t1;

   * Before a trailing locking clause.  Example:

          SELECT * FROM t1 INTO @myvar FOR UPDATE;

An 'INTO' clause should not be used in a nested *note 'SELECT': select.
because such a *note 'SELECT': select. must return its result to the
outer context.  There are also constraints on the use of 'INTO' within
*note 'UNION': union. statements; see *note union::.

For the 'INTO VAR_LIST' variant:

   * VAR_LIST names a list of one or more variables, each of which can
     be a user-defined variable, stored procedure or function parameter,
     or stored program local variable.  (Within a prepared 'SELECT ...
     INTO VAR_LIST' statement, only user-defined variables are
     permitted; see *note local-variable-scope::.)

   * The selected values are assigned to the variables.  The number of
     variables must match the number of columns.  The query should
     return a single row.  If the query returns no rows, a warning with
     error code 1329 occurs ('No data'), and the variable values remain
     unchanged.  If the query returns multiple rows, error 1172 occurs
     ('Result consisted of more than one row').  If it is possible that
     the statement may retrieve multiple rows, you can use 'LIMIT 1' to
     limit the result set to a single row.

          SELECT id, data INTO @x, @y FROM test.t1 LIMIT 1;

User variable names are not case-sensitive.  See *note user-variables::.

The *note 'SELECT ... INTO OUTFILE 'FILE_NAME'': select-into. form of
*note 'SELECT': select. writes the selected rows to a file.  The file is
created on the server host, so you must have the 'FILE' privilege to use
this syntax.  FILE_NAME cannot be an existing file, which among other
things prevents files such as '/etc/passwd' and database tables from
being modified.  The 'character_set_filesystem' system variable controls
the interpretation of the file name.

The *note 'SELECT ... INTO OUTFILE': select-into. statement is intended
to enable dumping a table to a text file on the server host.  To create
the resulting file on some other host, *note 'SELECT ... INTO OUTFILE':
select-into. normally is unsuitable because there is no way to write a
path to the file relative to the server host file system, unless the
location of the file on the remote host can be accessed using a
network-mapped path on the server host file system.

Alternatively, if the MySQL client software is installed on the remote
host, you can use a client command such as 'mysql -e "SELECT ..." >
FILE_NAME' to generate the file on that host.

*note 'SELECT ... INTO OUTFILE': select-into. is the complement of *note
'LOAD DATA': load-data.  Column values are written converted to the
character set specified in the 'CHARACTER SET' clause.  If no such
clause is present, values are dumped using the 'binary' character set.
In effect, there is no character set conversion.  If a result set
contains columns in several character sets, so will the output data file
and it may not be possible to reload the file correctly.

The syntax for the EXPORT_OPTIONS part of the statement consists of the
same 'FIELDS' and 'LINES' clauses that are used with the *note 'LOAD
DATA': load-data. statement.  For information about the 'FIELDS' and
'LINES' clauses, including their default values and permissible values,
see *note load-data::.

'FIELDS ESCAPED BY' controls how to write special characters.  If the
'FIELDS ESCAPED BY' character is not empty, it is used when necessary to
avoid ambiguity as a prefix that precedes following characters on
output:

   * The 'FIELDS ESCAPED BY' character

   * The 'FIELDS [OPTIONALLY] ENCLOSED BY' character

   * The first character of the 'FIELDS TERMINATED BY' and 'LINES
     TERMINATED BY' values

   * ASCII 'NUL' (the zero-valued byte; what is actually written
     following the escape character is ASCII '0', not a zero-valued
     byte)

The 'FIELDS TERMINATED BY', 'ENCLOSED BY', 'ESCAPED BY', or 'LINES
TERMINATED BY' characters _must_ be escaped so that you can read the
file back in reliably.  ASCII 'NUL' is escaped to make it easier to view
with some pagers.

The resulting file need not conform to SQL syntax, so nothing else need
be escaped.

If the 'FIELDS ESCAPED BY' character is empty, no characters are escaped
and 'NULL' is output as 'NULL', not '\N'.  It is probably not a good
idea to specify an empty escape character, particularly if field values
in your data contain any of the characters in the list just given.

Here is an example that produces a file in the comma-separated values
(CSV) format used by many programs:

     SELECT a,b,a+b INTO OUTFILE '/tmp/result.txt'
       FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"'
       LINES TERMINATED BY '\n'
       FROM test_table;

If you use 'INTO DUMPFILE' instead of 'INTO OUTFILE', MySQL writes only
one row into the file, without any column or line termination and
without performing any escape processing.  This is useful for selecting
a *note 'BLOB': blob. value and storing it in a file.

*Note*:

Any file created by 'INTO OUTFILE' or 'INTO DUMPFILE' is writable by all
users on the server host.  The reason for this is that the MySQL server
cannot create a file that is owned by anyone other than the user under
whose account it is running.  (You should _never_ run *note 'mysqld':
mysqld. as 'root' for this and other reasons.)  The file thus must be
world-writable so that you can manipulate its contents.

If the 'secure_file_priv' system variable is set to a nonempty directory
name, the file to be written must be located in that directory.

In the context of *note 'SELECT ... INTO': select-into. statements that
occur as part of events executed by the Event Scheduler, diagnostics
messages (not only errors, but also warnings) are written to the error
log, and, on Windows, to the application event log.  For additional
information, see *note events-status-info::.


File: manual.info.tmp,  Node: join,  Next: union,  Prev: select-into,  Up: select

13.2.9.2 JOIN Clause
....................

MySQL supports the following 'JOIN' syntax for the TABLE_REFERENCES part
of *note 'SELECT': select. statements and multiple-table *note 'DELETE':
delete. and *note 'UPDATE': update. statements:

     TABLE_REFERENCES:
         ESCAPED_TABLE_REFERENCE [, ESCAPED_TABLE_REFERENCE] ...

     ESCAPED_TABLE_REFERENCE:
         TABLE_REFERENCE
       | { OJ TABLE_REFERENCE }

     TABLE_REFERENCE:
         TABLE_FACTOR
       | JOINED_TABLE

     TABLE_FACTOR:
         TBL_NAME [[AS] ALIAS] [INDEX_HINT_LIST]
       | TABLE_SUBQUERY [AS] ALIAS
       | ( TABLE_REFERENCES )

     JOINED_TABLE:
         TABLE_REFERENCE [INNER | CROSS] JOIN TABLE_FACTOR [JOIN_SPECIFICATION]
       | TABLE_REFERENCE STRAIGHT_JOIN TABLE_FACTOR
       | TABLE_REFERENCE STRAIGHT_JOIN TABLE_FACTOR ON SEARCH_CONDITION
       | TABLE_REFERENCE {LEFT|RIGHT} [OUTER] JOIN TABLE_REFERENCE JOIN_SPECIFICATION
       | TABLE_REFERENCE NATURAL [{LEFT|RIGHT} [OUTER]] JOIN TABLE_FACTOR

     JOIN_SPECIFICATION:
         ON SEARCH_CONDITION
       | USING (JOIN_COLUMN_LIST)

     JOIN_COLUMN_LIST:
         COLUMN_NAME [, COLUMN_NAME] ...

     INDEX_HINT_LIST:
         INDEX_HINT [, INDEX_HINT] ...

     INDEX_HINT:
         USE {INDEX|KEY}
           [FOR {JOIN|ORDER BY|GROUP BY}] ([INDEX_LIST])
       | {IGNORE|FORCE} {INDEX|KEY}
           [FOR {JOIN|ORDER BY|GROUP BY}] (INDEX_LIST)

     INDEX_LIST:
         INDEX_NAME [, INDEX_NAME] ...

A table reference is also known as a join expression.

The syntax of TABLE_FACTOR is extended in MySQL in comparison with
standard SQL. The standard accepts only TABLE_REFERENCE, not a list of
them inside a pair of parentheses.

This is a conservative extension if each comma in a list of
TABLE_REFERENCE items is considered as equivalent to an inner join.  For
example:

     SELECT * FROM t1 LEFT JOIN (t2, t3, t4)
                      ON (t2.a = t1.a AND t3.b = t1.b AND t4.c = t1.c)

is equivalent to:

     SELECT * FROM t1 LEFT JOIN (t2 CROSS JOIN t3 CROSS JOIN t4)
                      ON (t2.a = t1.a AND t3.b = t1.b AND t4.c = t1.c)

In MySQL, 'JOIN', 'CROSS JOIN', and 'INNER JOIN' are syntactic
equivalents (they can replace each other).  In standard SQL, they are
not equivalent.  'INNER JOIN' is used with an 'ON' clause, 'CROSS JOIN'
is used otherwise.

In general, parentheses can be ignored in join expressions containing
only inner join operations.  MySQL also supports nested joins.  See
*note nested-join-optimization::.

Index hints can be specified to affect how the MySQL optimizer makes use
of indexes.  For more information, see *note index-hints::.  The
'optimizer_switch' system variable is another way to influence optimizer
use of indexes.  See *note switchable-optimizations::.

The following list describes general factors to take into account when
writing joins:

   * A table reference can be aliased using 'TBL_NAME AS ALIAS_NAME' or
     TBL_NAME ALIAS_NAME:

          SELECT t1.name, t2.salary
            FROM employee AS t1 INNER JOIN info AS t2 ON t1.name = t2.name;

          SELECT t1.name, t2.salary
            FROM employee t1 INNER JOIN info t2 ON t1.name = t2.name;

   * A TABLE_SUBQUERY is also known as a derived table or subquery in
     the 'FROM' clause.  See *note derived-tables::.  Such subqueries
     _must_ include an alias to give the subquery result a table name.
     A trivial example follows:

          SELECT * FROM (SELECT 1, 2, 3) AS t1;

   * The maximum number of tables that can be referenced in a single
     join is 61.

   * 'INNER JOIN' and ',' (comma) are semantically equivalent in the
     absence of a join condition: both produce a Cartesian product
     between the specified tables (that is, each and every row in the
     first table is joined to each and every row in the second table).

     However, the precedence of the comma operator is less than that of
     'INNER JOIN', 'CROSS JOIN', 'LEFT JOIN', and so on.  If you mix
     comma joins with the other join types when there is a join
     condition, an error of the form 'Unknown column 'COL_NAME' in 'on
     clause'' may occur.  Information about dealing with this problem is
     given later in this section.

   * The SEARCH_CONDITION used with 'ON' is any conditional expression
     of the form that can be used in a 'WHERE' clause.  Generally, the
     'ON' clause serves for conditions that specify how to join tables,
     and the 'WHERE' clause restricts which rows to include in the
     result set.

   * If there is no matching row for the right table in the 'ON' or
     'USING' part in a 'LEFT JOIN', a row with all columns set to 'NULL'
     is used for the right table.  You can use this fact to find rows in
     a table that have no counterpart in another table:

          SELECT left_tbl.*
            FROM left_tbl LEFT JOIN right_tbl ON left_tbl.id = right_tbl.id
            WHERE right_tbl.id IS NULL;

     This example finds all rows in 'left_tbl' with an 'id' value that
     is not present in 'right_tbl' (that is, all rows in 'left_tbl' with
     no corresponding row in 'right_tbl').  See *note
     outer-join-optimization::.

   * The 'USING(JOIN_COLUMN_LIST)' clause names a list of columns that
     must exist in both tables.  If tables 'a' and 'b' both contain
     columns 'c1', 'c2', and 'c3', the following join compares
     corresponding columns from the two tables:

          a LEFT JOIN b USING (c1, c2, c3)

   * The 'NATURAL [LEFT] JOIN' of two tables is defined to be
     semantically equivalent to an 'INNER JOIN' or a 'LEFT JOIN' with a
     'USING' clause that names all columns that exist in both tables.

   * 'RIGHT JOIN' works analogously to 'LEFT JOIN'.  To keep code
     portable across databases, it is recommended that you use 'LEFT
     JOIN' instead of 'RIGHT JOIN'.

   * 
     The '{ OJ ... }' syntax shown in the join syntax description exists
     only for compatibility with ODBC. The curly braces in the syntax
     should be written literally; they are not metasyntax as used
     elsewhere in syntax descriptions.

          SELECT left_tbl.*
              FROM { OJ left_tbl LEFT OUTER JOIN right_tbl
                     ON left_tbl.id = right_tbl.id }
              WHERE right_tbl.id IS NULL;

     You can use other types of joins within '{ OJ ... }', such as
     'INNER JOIN' or 'RIGHT OUTER JOIN'.  This helps with compatibility
     with some third-party applications, but is not official ODBC
     syntax.

     The parser does not permit nested '{ OJ ... }' constructs (which
     are not legal ODBC syntax, anyway).  Queries that use such
     constructs should be rewritten.

   * 'STRAIGHT_JOIN' is similar to 'JOIN', except that the left table is
     always read before the right table.  This can be used for those
     (few) cases for which the join optimizer processes the tables in a
     suboptimal order.

Some join examples:

     SELECT * FROM table1, table2;

     SELECT * FROM table1 INNER JOIN table2 ON table1.id = table2.id;

     SELECT * FROM table1 LEFT JOIN table2 ON table1.id = table2.id;

     SELECT * FROM table1 LEFT JOIN table2 USING (id);

     SELECT * FROM table1 LEFT JOIN table2 ON table1.id = table2.id
       LEFT JOIN table3 ON table2.id = table3.id;

Natural joins and joins with 'USING', including outer join variants, are
processed according to the SQL:2003 standard:

   * Redundant columns of a 'NATURAL' join do not appear.  Consider this
     set of statements:

          CREATE TABLE t1 (i INT, j INT);
          CREATE TABLE t2 (k INT, j INT);
          INSERT INTO t1 VALUES(1, 1);
          INSERT INTO t2 VALUES(1, 1);
          SELECT * FROM t1 NATURAL JOIN t2;
          SELECT * FROM t1 JOIN t2 USING (j);

     In the first *note 'SELECT': select. statement, column 'j' appears
     in both tables and thus becomes a join column, so, according to
     standard SQL, it should appear only once in the output, not twice.
     Similarly, in the second SELECT statement, column 'j' is named in
     the 'USING' clause and should appear only once in the output, not
     twice.

     Thus, the statements produce this output:

          +------+------+------+
          | j    | i    | k    |
          +------+------+------+
          |    1 |    1 |    1 |
          +------+------+------+
          +------+------+------+
          | j    | i    | k    |
          +------+------+------+
          |    1 |    1 |    1 |
          +------+------+------+

     Redundant column elimination and column ordering occurs according
     to standard SQL, producing this display order:

        * First, coalesced common columns of the two joined tables, in
          the order in which they occur in the first table

        * Second, columns unique to the first table, in order in which
          they occur in that table

        * Third, columns unique to the second table, in order in which
          they occur in that table

     The single result column that replaces two common columns is
     defined using the coalesce operation.  That is, for two 't1.a' and
     't2.a' the resulting single join column 'a' is defined as 'a =
     COALESCE(t1.a, t2.a)', where:

          COALESCE(x, y) = (CASE WHEN x IS NOT NULL THEN x ELSE y END)

     If the join operation is any other join, the result columns of the
     join consist of the concatenation of all columns of the joined
     tables.

     A consequence of the definition of coalesced columns is that, for
     outer joins, the coalesced column contains the value of the
     non-'NULL' column if one of the two columns is always 'NULL'.  If
     neither or both columns are 'NULL', both common columns have the
     same value, so it doesn't matter which one is chosen as the value
     of the coalesced column.  A simple way to interpret this is to
     consider that a coalesced column of an outer join is represented by
     the common column of the inner table of a 'JOIN'.  Suppose that the
     tables 't1(a, b)' and 't2(a, c)' have the following contents:

          t1    t2
          ----  ----
          1 x   2 z
          2 y   3 w

     Then, for this join, column 'a' contains the values of 't1.a':

          mysql> SELECT * FROM t1 NATURAL LEFT JOIN t2;
          +------+------+------+
          | a    | b    | c    |
          +------+------+------+
          |    1 | x    | NULL |
          |    2 | y    | z    |
          +------+------+------+

     By contrast, for this join, column 'a' contains the values of
     't2.a'.

          mysql> SELECT * FROM t1 NATURAL RIGHT JOIN t2;
          +------+------+------+
          | a    | c    | b    |
          +------+------+------+
          |    2 | z    | y    |
          |    3 | w    | NULL |
          +------+------+------+

     Compare those results to the otherwise equivalent queries with
     'JOIN ... ON':

          mysql> SELECT * FROM t1 LEFT JOIN t2 ON (t1.a = t2.a);
          +------+------+------+------+
          | a    | b    | a    | c    |
          +------+------+------+------+
          |    1 | x    | NULL | NULL |
          |    2 | y    |    2 | z    |
          +------+------+------+------+

          mysql> SELECT * FROM t1 RIGHT JOIN t2 ON (t1.a = t2.a);
          +------+------+------+------+
          | a    | b    | a    | c    |
          +------+------+------+------+
          |    2 | y    |    2 | z    |
          | NULL | NULL |    3 | w    |
          +------+------+------+------+

   * A 'USING' clause can be rewritten as an 'ON' clause that compares
     corresponding columns.  However, although 'USING' and 'ON' are
     similar, they are not quite the same.  Consider the following two
     queries:

          a LEFT JOIN b USING (c1, c2, c3)
          a LEFT JOIN b ON a.c1 = b.c1 AND a.c2 = b.c2 AND a.c3 = b.c3

     With respect to determining which rows satisfy the join condition,
     both joins are semantically identical.

     With respect to determining which columns to display for 'SELECT *'
     expansion, the two joins are not semantically identical.  The
     'USING' join selects the coalesced value of corresponding columns,
     whereas the 'ON' join selects all columns from all tables.  For the
     'USING' join, 'SELECT *' selects these values:

          COALESCE(a.c1, b.c1), COALESCE(a.c2, b.c2), COALESCE(a.c3, b.c3)

     For the 'ON' join, 'SELECT *' selects these values:

          a.c1, a.c2, a.c3, b.c1, b.c2, b.c3

     With an inner join, 'COALESCE(a.c1, b.c1)' is the same as either
     'a.c1' or 'b.c1' because both columns will have the same value.
     With an outer join (such as 'LEFT JOIN'), one of the two columns
     can be 'NULL'.  That column is omitted from the result.

   * An 'ON' clause can refer only to its operands.

     Example:

          CREATE TABLE t1 (i1 INT);
          CREATE TABLE t2 (i2 INT);
          CREATE TABLE t3 (i3 INT);
          SELECT * FROM t1 JOIN t2 ON (i1 = i3) JOIN t3;

     The statement fails with an 'Unknown column 'i3' in 'on clause''
     error because 'i3' is a column in 't3', which is not an operand of
     the 'ON' clause.  To enable the join to be processed, rewrite the
     statement as follows:

          SELECT * FROM t1 JOIN t2 JOIN t3 ON (i1 = i3);

   * 'JOIN' has higher precedence than the comma operator (','), so the
     join expression 't1, t2 JOIN t3' is interpreted as '(t1, (t2 JOIN
     t3))', not as '((t1, t2) JOIN t3)'.  This affects statements that
     use an 'ON' clause because that clause can refer only to columns in
     the operands of the join, and the precedence affects interpretation
     of what those operands are.

     Example:

          CREATE TABLE t1 (i1 INT, j1 INT);
          CREATE TABLE t2 (i2 INT, j2 INT);
          CREATE TABLE t3 (i3 INT, j3 INT);
          INSERT INTO t1 VALUES(1, 1);
          INSERT INTO t2 VALUES(1, 1);
          INSERT INTO t3 VALUES(1, 1);
          SELECT * FROM t1, t2 JOIN t3 ON (t1.i1 = t3.i3);

     The 'JOIN' takes precedence over the comma operator, so the
     operands for the 'ON' clause are 't2' and 't3'.  Because 't1.i1' is
     not a column in either of the operands, the result is an 'Unknown
     column 't1.i1' in 'on clause'' error.

     To enable the join to be processed, use either of these strategies:

        * Group the first two tables explicitly with parentheses so that
          the operands for the 'ON' clause are '(t1, t2)' and 't3':

               SELECT * FROM (t1, t2) JOIN t3 ON (t1.i1 = t3.i3);

        * Avoid the use of the comma operator and use 'JOIN' instead:

               SELECT * FROM t1 JOIN t2 JOIN t3 ON (t1.i1 = t3.i3);

     The same precedence interpretation also applies to statements that
     mix the comma operator with 'INNER JOIN', 'CROSS JOIN', 'LEFT
     JOIN', and 'RIGHT JOIN', all of which have higher precedence than
     the comma operator.

   * A MySQL extension compared to the SQL:2003 standard is that MySQL
     permits you to qualify the common (coalesced) columns of 'NATURAL'
     or 'USING' joins, whereas the standard disallows that.


File: manual.info.tmp,  Node: union,  Prev: join,  Up: select

13.2.9.3 UNION Clause
.....................

     SELECT ...
     UNION [ALL | DISTINCT] SELECT ...
     [UNION [ALL | DISTINCT] SELECT ...]

*note 'UNION': union. combines the result from multiple *note 'SELECT':
select. statements into a single result set.  The result set column
names are taken from the column names of the first *note 'SELECT':
select. statement.

Selected columns listed in corresponding positions of each *note
'SELECT': select. statement should have the same data type.  (For
example, the first column selected by the first statement should have
the same type as the first column selected by the other statements.)  If
the data types of corresponding *note 'SELECT': select. columns do not
match, the types and lengths of the columns in the *note 'UNION': union.
result take into account the values retrieved by all of the *note
'SELECT': select. statements.  For example, consider the following:

     mysql> SELECT REPEAT('a',1) UNION SELECT REPEAT('b',10);
     +---------------+
     | REPEAT('a',1) |
     +---------------+
     | a             |
     | bbbbbbbbbb    |
     +---------------+

The *note 'SELECT': select. statements are normal select statements, but
with the following restrictions:

   * 'HIGH_PRIORITY' cannot be used with *note 'SELECT': select.
     statements that are part of a *note 'UNION': union.  If you specify
     it for the first *note 'SELECT': select, it has no effect.  If you
     specify it for any subsequent *note 'SELECT': select. statements, a
     syntax error results.

   * Only the last *note 'SELECT': select. statement can use an 'INTO'
     clause.  However, the entire *note 'UNION': union. result is
     written to the 'INTO' output destination.

By default, duplicate rows are removed from *note 'UNION': union.
results.  The optional 'DISTINCT' keyword has the same effect but makes
it explicit.  With the optional 'ALL' keyword, duplicate-row removal
does not occur and the result includes all matching rows from all the
*note 'SELECT': select. statements.

You can mix *note 'UNION ALL': union. and *note 'UNION DISTINCT': union.
in the same query.  Mixed *note 'UNION': union. types are treated such
that a 'DISTINCT' union overrides any 'ALL' union to its left.  A
'DISTINCT' union can be produced explicitly by using *note 'UNION
DISTINCT': union. or implicitly by using *note 'UNION': union. with no
following 'DISTINCT' or 'ALL' keyword.

To apply 'ORDER BY' or 'LIMIT' to an individual *note 'SELECT': select,
place the clause inside the parentheses that enclose the *note 'SELECT':
select.:

     (SELECT a FROM t1 WHERE a=10 AND B=1 ORDER BY a LIMIT 10)
     UNION
     (SELECT a FROM t2 WHERE a=11 AND B=2 ORDER BY a LIMIT 10);

Use of 'ORDER BY' for individual *note 'SELECT': select. statements
implies nothing about the order in which the rows appear in the final
result because *note 'UNION': union. by default produces an unordered
set of rows.  Therefore, 'ORDER BY' in this context typically is used in
conjunction with 'LIMIT', to determine the subset of the selected rows
to retrieve for the *note 'SELECT': select, even though it does not
necessarily affect the order of those rows in the final *note 'UNION':
union. result.  If 'ORDER BY' appears without 'LIMIT' in a *note
'SELECT': select, it is optimized away because it will have no effect,
anyway.

To use an 'ORDER BY' or 'LIMIT' clause to sort or limit the entire *note
'UNION': union. result, parenthesize the individual *note 'SELECT':
select. statements and place the 'ORDER BY' or 'LIMIT' after the last
one.  The following example uses both clauses:

     (SELECT a FROM t1 WHERE a=10 AND B=1)
     UNION
     (SELECT a FROM t2 WHERE a=11 AND B=2)
     ORDER BY a LIMIT 10;

A statement without parentheses is equivalent to one parenthesized as
just shown.

This kind of 'ORDER BY' cannot use column references that include a
table name (that is, names in TBL_NAME.COL_NAME format).  Instead,
provide a column alias in the first *note 'SELECT': select. statement
and refer to the alias in the 'ORDER BY'.  (Alternatively, refer to the
column in the 'ORDER BY' using its column position.  However, use of
column positions is deprecated.)

Also, if a column to be sorted is aliased, the 'ORDER BY' clause _must_
refer to the alias, not the column name.  The first of the following
statements is permitted, but the second fails with an 'Unknown column
'a' in 'order clause'' error:

     (SELECT a AS b FROM t) UNION (SELECT ...) ORDER BY b;
     (SELECT a AS b FROM t) UNION (SELECT ...) ORDER BY a;

To cause rows in a *note 'UNION': union. result to consist of the sets
of rows retrieved by each *note 'SELECT': select. one after the other,
select an additional column in each *note 'SELECT': select. to use as a
sort column and add an 'ORDER BY' following the last *note 'SELECT':
select.:

     (SELECT 1 AS sort_col, col1a, col1b, ... FROM t1)
     UNION
     (SELECT 2, col2a, col2b, ... FROM t2) ORDER BY sort_col;

To additionally maintain sort order within individual *note 'SELECT':
select. results, add a secondary column to the 'ORDER BY' clause:

     (SELECT 1 AS sort_col, col1a, col1b, ... FROM t1)
     UNION
     (SELECT 2, col2a, col2b, ... FROM t2) ORDER BY sort_col, col1a;

Use of an additional column also enables you to determine which *note
'SELECT': select. each row comes from.  Extra columns can provide other
identifying information as well, such as a string that indicates a table
name.


File: manual.info.tmp,  Node: subqueries,  Next: update,  Prev: select,  Up: sql-data-manipulation-statements

13.2.10 Subqueries
------------------

* Menu:

* scalar-subqueries::            The Subquery as Scalar Operand
* comparisons-using-subqueries::  Comparisons Using Subqueries
* any-in-some-subqueries::       Subqueries with ANY, IN, or SOME
* all-subqueries::               Subqueries with ALL
* row-subqueries::               Row Subqueries
* exists-and-not-exists-subqueries::  Subqueries with EXISTS or NOT EXISTS
* correlated-subqueries::        Correlated Subqueries
* derived-tables::               Derived Tables
* subquery-errors::              Subquery Errors
* optimizing-subqueries::        Optimizing Subqueries
* rewriting-subqueries::         Rewriting Subqueries as Joins
* subquery-restrictions::        Restrictions on Subqueries

A subquery is a *note 'SELECT': select. statement within another
statement.

All subquery forms and operations that the SQL standard requires are
supported, as well as a few features that are MySQL-specific.

Here is an example of a subquery:

     SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2);

In this example, 'SELECT * FROM t1 ...' is the _outer query_ (or _outer
statement_), and '(SELECT column1 FROM t2)' is the _subquery_.  We say
that the subquery is _nested_ within the outer query, and in fact it is
possible to nest subqueries within other subqueries, to a considerable
depth.  A subquery must always appear within parentheses.

The main advantages of subqueries are:

   * They allow queries that are _structured_ so that it is possible to
     isolate each part of a statement.

   * They provide alternative ways to perform operations that would
     otherwise require complex joins and unions.

   * Many people find subqueries more readable than complex joins or
     unions.  Indeed, it was the innovation of subqueries that gave
     people the original idea of calling the early SQL 'Structured Query
     Language.'

Here is an example statement that shows the major points about subquery
syntax as specified by the SQL standard and supported in MySQL:

     DELETE FROM t1
     WHERE s11 > ANY
      (SELECT COUNT(*) /* no hint */ FROM t2
       WHERE NOT EXISTS
        (SELECT * FROM t3
         WHERE ROW(5*t2.s1,77)=
          (SELECT 50,11*s1 FROM t4 UNION SELECT 50,77 FROM
           (SELECT * FROM t5) AS t5)));

A subquery can return a scalar (a single value), a single row, a single
column, or a table (one or more rows of one or more columns).  These are
called scalar, column, row, and table subqueries.  Subqueries that
return a particular kind of result often can be used only in certain
contexts, as described in the following sections.

There are few restrictions on the type of statements in which subqueries
can be used.  A subquery can contain many of the keywords or clauses
that an ordinary *note 'SELECT': select. can contain: 'DISTINCT', 'GROUP
BY', 'ORDER BY', 'LIMIT', joins, index hints, *note 'UNION': union.
constructs, comments, functions, and so on.

A subquery's outer statement can be any one of: *note 'SELECT': select,
*note 'INSERT': insert, *note 'UPDATE': update, *note 'DELETE': delete,
*note 'SET': set-variable, or *note 'DO': do.

In MySQL, you cannot modify a table and select from the same table in a
subquery.  This applies to statements such as *note 'DELETE': delete,
*note 'INSERT': insert, *note 'REPLACE': replace, *note 'UPDATE':
update, and (because subqueries can be used in the 'SET' clause) *note
'LOAD DATA': load-data.

For information about how the optimizer handles subqueries, see *note
subquery-optimization::.  For a discussion of restrictions on subquery
use, including performance issues for certain forms of subquery syntax,
see *note subquery-restrictions::.


File: manual.info.tmp,  Node: scalar-subqueries,  Next: comparisons-using-subqueries,  Prev: subqueries,  Up: subqueries

13.2.10.1 The Subquery as Scalar Operand
........................................

In its simplest form, a subquery is a scalar subquery that returns a
single value.  A scalar subquery is a simple operand, and you can use it
almost anywhere a single column value or literal is legal, and you can
expect it to have those characteristics that all operands have: a data
type, a length, an indication that it can be 'NULL', and so on.  For
example:

     CREATE TABLE t1 (s1 INT, s2 CHAR(5) NOT NULL);
     INSERT INTO t1 VALUES(100, 'abcde');
     SELECT (SELECT s2 FROM t1);

The subquery in this *note 'SELECT': select. returns a single value
(''abcde'') that has a data type of *note 'CHAR': char, a length of 5, a
character set and collation equal to the defaults in effect at *note
'CREATE TABLE': create-table. time, and an indication that the value in
the column can be 'NULL'.  Nullability of the value selected by a scalar
subquery is not copied because if the subquery result is empty, the
result is 'NULL'.  For the subquery just shown, if 't1' were empty, the
result would be 'NULL' even though 's2' is 'NOT NULL'.

There are a few contexts in which a scalar subquery cannot be used.  If
a statement permits only a literal value, you cannot use a subquery.
For example, 'LIMIT' requires literal integer arguments, and *note 'LOAD
DATA': load-data. requires a literal string file name.  You cannot use
subqueries to supply these values.

When you see examples in the following sections that contain the rather
spartan construct '(SELECT column1 FROM t1)', imagine that your own code
contains much more diverse and complex constructions.

Suppose that we make two tables:

     CREATE TABLE t1 (s1 INT);
     INSERT INTO t1 VALUES (1);
     CREATE TABLE t2 (s1 INT);
     INSERT INTO t2 VALUES (2);

Then perform a *note 'SELECT': select.:

     SELECT (SELECT s1 FROM t2) FROM t1;

The result is '2' because there is a row in 't2' containing a column
's1' that has a value of '2'.

A scalar subquery can be part of an expression, but remember the
parentheses, even if the subquery is an operand that provides an
argument for a function.  For example:

     SELECT UPPER((SELECT s1 FROM t1)) FROM t2;


File: manual.info.tmp,  Node: comparisons-using-subqueries,  Next: any-in-some-subqueries,  Prev: scalar-subqueries,  Up: subqueries

13.2.10.2 Comparisons Using Subqueries
......................................

The most common use of a subquery is in the form:

     NON_SUBQUERY_OPERAND COMPARISON_OPERATOR (SUBQUERY)

Where COMPARISON_OPERATOR is one of these operators:

     =  >  <  >=  <=  <>  !=  <=>

For example:

     ... WHERE 'a' = (SELECT column1 FROM t1)

MySQL also permits this construct:

     NON_SUBQUERY_OPERAND LIKE (SUBQUERY)

At one time the only legal place for a subquery was on the right side of
a comparison, and you might still find some old DBMSs that insist on
this.

Here is an example of a common-form subquery comparison that you cannot
do with a join.  It finds all the rows in table 't1' for which the
'column1' value is equal to a maximum value in table 't2':

     SELECT * FROM t1
       WHERE column1 = (SELECT MAX(column2) FROM t2);

Here is another example, which again is impossible with a join because
it involves aggregating for one of the tables.  It finds all rows in
table 't1' containing a value that occurs twice in a given column:

     SELECT * FROM t1 AS t
       WHERE 2 = (SELECT COUNT(*) FROM t1 WHERE t1.id = t.id);

For a comparison of the subquery to a scalar, the subquery must return a
scalar.  For a comparison of the subquery to a row constructor, the
subquery must be a row subquery that returns a row with the same number
of values as the row constructor.  See *note row-subqueries::.


File: manual.info.tmp,  Node: any-in-some-subqueries,  Next: all-subqueries,  Prev: comparisons-using-subqueries,  Up: subqueries

13.2.10.3 Subqueries with ANY, IN, or SOME
..........................................

Syntax:

     OPERAND COMPARISON_OPERATOR ANY (SUBQUERY)
     OPERAND IN (SUBQUERY)
     OPERAND COMPARISON_OPERATOR SOME (SUBQUERY)

Where COMPARISON_OPERATOR is one of these operators:

     =  >  <  >=  <=  <>  !=

The 'ANY' keyword, which must follow a comparison operator, means
'return 'TRUE' if the comparison is 'TRUE' for 'ANY' of the values in
the column that the subquery returns.' For example:

     SELECT s1 FROM t1 WHERE s1 > ANY (SELECT s1 FROM t2);

Suppose that there is a row in table 't1' containing '(10)'.  The
expression is 'TRUE' if table 't2' contains '(21,14,7)' because there is
a value '7' in 't2' that is less than '10'.  The expression is 'FALSE'
if table 't2' contains '(20,10)', or if table 't2' is empty.  The
expression is _unknown_ (that is, 'NULL') if table 't2' contains
'(NULL,NULL,NULL)'.

When used with a subquery, the word 'IN' is an alias for '= ANY'.  Thus,
these two statements are the same:

     SELECT s1 FROM t1 WHERE s1 = ANY (SELECT s1 FROM t2);
     SELECT s1 FROM t1 WHERE s1 IN    (SELECT s1 FROM t2);

'IN' and '= ANY' are not synonyms when used with an expression list.
'IN' can take an expression list, but '= ANY' cannot.  See *note
comparison-operators::.

'NOT IN' is not an alias for '<> ANY', but for '<> ALL'.  See *note
all-subqueries::.

The word 'SOME' is an alias for 'ANY'.  Thus, these two statements are
the same:

     SELECT s1 FROM t1 WHERE s1 <> ANY  (SELECT s1 FROM t2);
     SELECT s1 FROM t1 WHERE s1 <> SOME (SELECT s1 FROM t2);

Use of the word 'SOME' is rare, but this example shows why it might be
useful.  To most people, the English phrase 'a is not equal to any b'
means 'there is no b which is equal to a,' but that is not what is meant
by the SQL syntax.  The syntax means 'there is some b to which a is not
equal.' Using '<> SOME' instead helps ensure that everyone understands
the true meaning of the query.


File: manual.info.tmp,  Node: all-subqueries,  Next: row-subqueries,  Prev: any-in-some-subqueries,  Up: subqueries

13.2.10.4 Subqueries with ALL
.............................

Syntax:

     OPERAND COMPARISON_OPERATOR ALL (SUBQUERY)

The word 'ALL', which must follow a comparison operator, means 'return
'TRUE' if the comparison is 'TRUE' for 'ALL' of the values in the column
that the subquery returns.' For example:

     SELECT s1 FROM t1 WHERE s1 > ALL (SELECT s1 FROM t2);

Suppose that there is a row in table 't1' containing '(10)'.  The
expression is 'TRUE' if table 't2' contains '(-5,0,+5)' because '10' is
greater than all three values in 't2'.  The expression is 'FALSE' if
table 't2' contains '(12,6,NULL,-100)' because there is a single value
'12' in table 't2' that is greater than '10'.  The expression is
_unknown_ (that is, 'NULL') if table 't2' contains '(0,NULL,1)'.

Finally, the expression is 'TRUE' if table 't2' is empty.  So, the
following expression is 'TRUE' when table 't2' is empty:

     SELECT * FROM t1 WHERE 1 > ALL (SELECT s1 FROM t2);

But this expression is 'NULL' when table 't2' is empty:

     SELECT * FROM t1 WHERE 1 > (SELECT s1 FROM t2);

In addition, the following expression is 'NULL' when table 't2' is
empty:

     SELECT * FROM t1 WHERE 1 > ALL (SELECT MAX(s1) FROM t2);

In general, _tables containing 'NULL' values_ and _empty tables_ are
'edge cases.' When writing subqueries, always consider whether you have
taken those two possibilities into account.

'NOT IN' is an alias for '<> ALL'.  Thus, these two statements are the
same:

     SELECT s1 FROM t1 WHERE s1 <> ALL (SELECT s1 FROM t2);
     SELECT s1 FROM t1 WHERE s1 NOT IN (SELECT s1 FROM t2);


File: manual.info.tmp,  Node: row-subqueries,  Next: exists-and-not-exists-subqueries,  Prev: all-subqueries,  Up: subqueries

13.2.10.5 Row Subqueries
........................

Scalar or column subqueries return a single value or a column of values.
A _row subquery_ is a subquery variant that returns a single row and can
thus return more than one column value.  Legal operators for row
subquery comparisons are:

     =  >  <  >=  <=  <>  !=  <=>

Here are two examples:

     SELECT * FROM t1
       WHERE (col1,col2) = (SELECT col3, col4 FROM t2 WHERE id = 10);
     SELECT * FROM t1
       WHERE ROW(col1,col2) = (SELECT col3, col4 FROM t2 WHERE id = 10);

For both queries, if the table 't2' contains a single row with 'id =
10', the subquery returns a single row.  If this row has 'col3' and
'col4' values equal to the 'col1' and 'col2' values of any rows in 't1',
the 'WHERE' expression is 'TRUE' and each query returns those 't1' rows.
If the 't2' row 'col3' and 'col4' values are not equal the 'col1' and
'col2' values of any 't1' row, the expression is 'FALSE' and the query
returns an empty result set.  The expression is _unknown_ (that is,
'NULL') if the subquery produces no rows.  An error occurs if the
subquery produces multiple rows because a row subquery can return at
most one row.

For information about how each operator works for row comparisons, see
*note comparison-operators::.

The expressions '(1,2)' and 'ROW(1,2)' are sometimes called _row
constructors_.  The two are equivalent.  The row constructor and the row
returned by the subquery must contain the same number of values.

A row constructor is used for comparisons with subqueries that return
two or more columns.  When a subquery returns a single column, this is
regarded as a scalar value and not as a row, so a row constructor cannot
be used with a subquery that does not return at least two columns.
Thus, the following query fails with a syntax error:

     SELECT * FROM t1 WHERE ROW(1) = (SELECT column1 FROM t2)

Row constructors are legal in other contexts.  For example, the
following two statements are semantically equivalent (and are handled in
the same way by the optimizer):

     SELECT * FROM t1 WHERE (column1,column2) = (1,1);
     SELECT * FROM t1 WHERE column1 = 1 AND column2 = 1;

The following query answers the request, 'find all rows in table 't1'
that also exist in table 't2'':

     SELECT column1,column2,column3
       FROM t1
       WHERE (column1,column2,column3) IN
              (SELECT column1,column2,column3 FROM t2);

For more information about the optimizer and row constructors, see *note
row-constructor-optimization::


File: manual.info.tmp,  Node: exists-and-not-exists-subqueries,  Next: correlated-subqueries,  Prev: row-subqueries,  Up: subqueries

13.2.10.6 Subqueries with EXISTS or NOT EXISTS
..............................................

If a subquery returns any rows at all, 'EXISTS SUBQUERY' is 'TRUE', and
'NOT EXISTS SUBQUERY' is 'FALSE'.  For example:

     SELECT column1 FROM t1 WHERE EXISTS (SELECT * FROM t2);

Traditionally, an 'EXISTS' subquery starts with 'SELECT *', but it could
begin with 'SELECT 5' or 'SELECT column1' or anything at all.  MySQL
ignores the *note 'SELECT': select. list in such a subquery, so it makes
no difference.

For the preceding example, if 't2' contains any rows, even rows with
nothing but 'NULL' values, the 'EXISTS' condition is 'TRUE'.  This is
actually an unlikely example because a '[NOT] EXISTS' subquery almost
always contains correlations.  Here are some more realistic examples:

   * What kind of store is present in one or more cities?

          SELECT DISTINCT store_type FROM stores
            WHERE EXISTS (SELECT * FROM cities_stores
                          WHERE cities_stores.store_type = stores.store_type);

   * What kind of store is present in no cities?

          SELECT DISTINCT store_type FROM stores
            WHERE NOT EXISTS (SELECT * FROM cities_stores
                              WHERE cities_stores.store_type = stores.store_type);

   * What kind of store is present in all cities?

          SELECT DISTINCT store_type FROM stores s1
            WHERE NOT EXISTS (
              SELECT * FROM cities WHERE NOT EXISTS (
                SELECT * FROM cities_stores
                 WHERE cities_stores.city = cities.city
                 AND cities_stores.store_type = stores.store_type));

The last example is a double-nested 'NOT EXISTS' query.  That is, it has
a 'NOT EXISTS' clause within a 'NOT EXISTS' clause.  Formally, it
answers the question 'does a city exist with a store that is not in
'Stores''?  But it is easier to say that a nested 'NOT EXISTS' answers
the question 'is X 'TRUE' for all Y?'


File: manual.info.tmp,  Node: correlated-subqueries,  Next: derived-tables,  Prev: exists-and-not-exists-subqueries,  Up: subqueries

13.2.10.7 Correlated Subqueries
...............................

A _correlated subquery_ is a subquery that contains a reference to a
table that also appears in the outer query.  For example:

     SELECT * FROM t1
       WHERE column1 = ANY (SELECT column1 FROM t2
                            WHERE t2.column2 = t1.column2);

Notice that the subquery contains a reference to a column of 't1', even
though the subquery's 'FROM' clause does not mention a table 't1'.  So,
MySQL looks outside the subquery, and finds 't1' in the outer query.

Suppose that table 't1' contains a row where 'column1 = 5' and 'column2
= 6'; meanwhile, table 't2' contains a row where 'column1 = 5' and
'column2 = 7'.  The simple expression '... WHERE column1 = ANY (SELECT
column1 FROM t2)' would be 'TRUE', but in this example, the 'WHERE'
clause within the subquery is 'FALSE' (because '(5,6)' is not equal to
'(5,7)'), so the expression as a whole is 'FALSE'.

*Scoping rule:* MySQL evaluates from inside to outside.  For example:

     SELECT column1 FROM t1 AS x
       WHERE x.column1 = (SELECT column1 FROM t2 AS x
         WHERE x.column1 = (SELECT column1 FROM t3
           WHERE x.column2 = t3.column1));

In this statement, 'x.column2' must be a column in table 't2' because
'SELECT column1 FROM t2 AS x ...' renames 't2'.  It is not a column in
table 't1' because 'SELECT column1 FROM t1 ...' is an outer query that
is _farther out_.

For subqueries in 'HAVING' or 'ORDER BY' clauses, MySQL also looks for
column names in the outer select list.

For certain cases, a correlated subquery is optimized.  For example:

     VAL IN (SELECT KEY_VAL FROM TBL_NAME WHERE CORRELATED_CONDITION)

Otherwise, they are inefficient and likely to be slow.  Rewriting the
query as a join might improve performance.

Aggregate functions in correlated subqueries may contain outer
references, provided the function contains nothing but outer references,
and provided the function is not contained in another function or
expression.


File: manual.info.tmp,  Node: derived-tables,  Next: subquery-errors,  Prev: correlated-subqueries,  Up: subqueries

13.2.10.8 Derived Tables
........................

A derived table is an expression that generates a table within the scope
of a query 'FROM' clause.  For example, a subquery in a *note 'SELECT':
select. statement 'FROM' clause is a derived table:

     SELECT ... FROM (SUBQUERY) [AS] TBL_NAME ...

The '[AS] TBL_NAME' clause is mandatory because every table in a 'FROM'
clause must have a name.  Any columns in the derived table must have
unique names.

For the sake of illustration, assume that you have this table:

     CREATE TABLE t1 (s1 INT, s2 CHAR(5), s3 FLOAT);

Here is how to use a subquery in the 'FROM' clause, using the example
table:

     INSERT INTO t1 VALUES (1,'1',1.0);
     INSERT INTO t1 VALUES (2,'2',2.0);
     SELECT sb1,sb2,sb3
       FROM (SELECT s1 AS sb1, s2 AS sb2, s3*2 AS sb3 FROM t1) AS sb
       WHERE sb1 > 1;

Result:

     +------+------+------+
     | sb1  | sb2  | sb3  |
     +------+------+------+
     |    2 | 2    |    4 |
     +------+------+------+

Here is another example: Suppose that you want to know the average of a
set of sums for a grouped table.  This does not work:

     SELECT AVG(SUM(column1)) FROM t1 GROUP BY column1;

However, this query provides the desired information:

     SELECT AVG(sum_column1)
       FROM (SELECT SUM(column1) AS sum_column1
             FROM t1 GROUP BY column1) AS t1;

Notice that the column name used within the subquery ('sum_column1') is
recognized in the outer query.

A derived table can return a scalar, column, row, or table.

Derived tables are subject to these restrictions:

   * A derived table cannot be a correlated subquery.

   * A derived table cannot contain references to other tables of the
     same *note 'SELECT': select.

   * A derived table cannot contain outer references.  This is a MySQL
     restriction, not a restriction of the SQL standard.

Subqueries in the 'FROM' clause are executed even for the *note
'EXPLAIN': explain. statement (that is, derived temporary tables are
materialized).  This occurs because upper-level queries need information
about all tables during the optimization phase, and the table
represented by a subquery in the 'FROM' clause is unavailable unless the
subquery is executed.

It is possible under certain circumstances that using *note 'EXPLAIN
SELECT': explain. will modify table data.  This can occur if the outer
query accesses any tables and an inner query invokes a stored function
that changes one or more rows of a table.  Suppose that there are two
tables 't1' and 't2' in database 'd1', and a stored function 'f1' that
modifies 't2', created as shown here:

     CREATE DATABASE d1;
     USE d1;
     CREATE TABLE t1 (c1 INT);
     CREATE TABLE t2 (c1 INT);
     CREATE FUNCTION f1(p1 INT) RETURNS INT
       BEGIN
         INSERT INTO t2 VALUES (p1);
         RETURN p1;
       END;

Referencing the function directly in an *note 'EXPLAIN SELECT': explain.
has no effect on 't2', as shown here:

     mysql> SELECT * FROM t2;
     Empty set (0.02 sec)

     mysql> EXPLAIN SELECT f1(5)\G
     *************************** 1. row ***************************
                id: 1
       select_type: SIMPLE
             table: NULL
              type: NULL
     possible_keys: NULL
               key: NULL
           key_len: NULL
               ref: NULL
              rows: NULL
             Extra: No tables used
     1 row in set (0.01 sec)

     mysql> SELECT * FROM t2;
     Empty set (0.01 sec)

This is because the *note 'SELECT': select. statement did not reference
any tables, as can be seen in the 'table' and 'Extra' columns of the
output.  This is also true of the following nested *note 'SELECT':
select.:

     mysql> EXPLAIN SELECT NOW() AS a1, (SELECT f1(5)) AS a2\G
     *************************** 1. row ***************************
                id: 1
       select_type: PRIMARY
             table: NULL
              type: NULL
     possible_keys: NULL
               key: NULL
           key_len: NULL
               ref: NULL
              rows: NULL
          filtered: NULL
             Extra: No tables used
     1 row in set, 1 warning (0.00 sec)

     mysql> SHOW WARNINGS;
     +-------+------+------------------------------------------+
     | Level | Code | Message                                  |
     +-------+------+------------------------------------------+
     | Note  | 1249 | Select 2 was reduced during optimization |
     +-------+------+------------------------------------------+
     1 row in set (0.00 sec)

     mysql> SELECT * FROM t2;
     Empty set (0.00 sec)

However, if the outer *note 'SELECT': select. references any tables, the
optimizer executes the statement in the subquery as well, with the
result that 't2' is modified:

     mysql> EXPLAIN SELECT * FROM t1 AS a1, (SELECT f1(5)) AS a2\G
     *************************** 1. row ***************************
                id: 1
       select_type: PRIMARY
             table: <derived2>
              type: system
     possible_keys: NULL
               key: NULL
           key_len: NULL
               ref: NULL
              rows: 1
             Extra:
     *************************** 2. row ***************************
                id: 1
       select_type: PRIMARY
             table: a1
              type: ALL
     possible_keys: NULL
               key: NULL
           key_len: NULL
               ref: NULL
              rows: 1
             Extra:
     *************************** 3. row ***************************
                id: 2
       select_type: DERIVED
             table: NULL
              type: NULL
     possible_keys: NULL
               key: NULL
           key_len: NULL
               ref: NULL
              rows: NULL
             Extra: No tables used
     3 rows in set (0.00 sec)

     mysql> SELECT * FROM t2;
     +------+
     | c1   |
     +------+
     |    5 |
     +------+
     1 row in set (0.00 sec)

This also means that an *note 'EXPLAIN SELECT': explain. statement such
as the one shown here may take a long time to execute because the
'BENCHMARK()' function is executed once for each row in 't1':

     EXPLAIN SELECT * FROM t1 AS a1, (SELECT BENCHMARK(1000000, MD5(NOW())));


File: manual.info.tmp,  Node: subquery-errors,  Next: optimizing-subqueries,  Prev: derived-tables,  Up: subqueries

13.2.10.9 Subquery Errors
.........................

There are some errors that apply only to subqueries.  This section
describes them.

   * Unsupported subquery syntax:

          ERROR 1235 (ER_NOT_SUPPORTED_YET)
          SQLSTATE = 42000
          Message = "This version of MySQL doesn't yet support
          'LIMIT & IN/ALL/ANY/SOME subquery'"

     This means that MySQL does not support statements of the following
     form:

          SELECT * FROM t1 WHERE s1 IN (SELECT s2 FROM t2 ORDER BY s1 LIMIT 1)

   * Incorrect number of columns from subquery:

          ERROR 1241 (ER_OPERAND_COL)
          SQLSTATE = 21000
          Message = "Operand should contain 1 column(s)"

     This error occurs in cases like this:

          SELECT (SELECT column1, column2 FROM t2) FROM t1;

     You may use a subquery that returns multiple columns, if the
     purpose is row comparison.  In other contexts, the subquery must be
     a scalar operand.  See *note row-subqueries::.

   * Incorrect number of rows from subquery:

          ERROR 1242 (ER_SUBSELECT_NO_1_ROW)
          SQLSTATE = 21000
          Message = "Subquery returns more than 1 row"

     This error occurs for statements where the subquery must return at
     most one row but returns multiple rows.  Consider the following
     example:

          SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2);

     If 'SELECT column1 FROM t2' returns just one row, the previous
     query will work.  If the subquery returns more than one row, error
     1242 will occur.  In that case, the query should be rewritten as:

          SELECT * FROM t1 WHERE column1 = ANY (SELECT column1 FROM t2);

   * Incorrectly used table in subquery:

          Error 1093 (ER_UPDATE_TABLE_USED)
          SQLSTATE = HY000
          Message = "You can't specify target table 'x'
          for update in FROM clause"

     This error occurs in cases such as the following, which attempts to
     modify a table and select from the same table in the subquery:

          UPDATE t1 SET column2 = (SELECT MAX(column1) FROM t1);

     You can use a subquery for assignment within an *note 'UPDATE':
     update. statement because subqueries are legal in *note 'UPDATE':
     update. and *note 'DELETE': delete. statements as well as in *note
     'SELECT': select. statements.  However, you cannot use the same
     table (in this case, table 't1') for both the subquery 'FROM'
     clause and the update target.

For transactional storage engines, the failure of a subquery causes the
entire statement to fail.  For nontransactional storage engines, data
modifications made before the error was encountered are preserved.


File: manual.info.tmp,  Node: optimizing-subqueries,  Next: rewriting-subqueries,  Prev: subquery-errors,  Up: subqueries

13.2.10.10 Optimizing Subqueries
................................

Development is ongoing, so no optimization tip is reliable for the long
term.  The following list provides some interesting tricks that you
might want to play with.  See also *note subquery-optimization::.

   * Use subquery clauses that affect the number or order of the rows in
     the subquery.  For example:

          SELECT * FROM t1 WHERE t1.column1 IN
            (SELECT column1 FROM t2 ORDER BY column1);
          SELECT * FROM t1 WHERE t1.column1 IN
            (SELECT DISTINCT column1 FROM t2);
          SELECT * FROM t1 WHERE EXISTS
            (SELECT * FROM t2 LIMIT 1);

   * Replace a join with a subquery.  For example, try this:

          SELECT DISTINCT column1 FROM t1 WHERE t1.column1 IN (
            SELECT column1 FROM t2);

     Instead of this:

          SELECT DISTINCT t1.column1 FROM t1, t2
            WHERE t1.column1 = t2.column1;

   * Some subqueries can be transformed to joins for compatibility with
     older versions of MySQL that do not support subqueries.  However,
     in some cases, converting a subquery to a join may improve
     performance.  See *note rewriting-subqueries::.

   * Move clauses from outside to inside the subquery.  For example, use
     this query:

          SELECT * FROM t1
            WHERE s1 IN (SELECT s1 FROM t1 UNION ALL SELECT s1 FROM t2);

     Instead of this query:

          SELECT * FROM t1
            WHERE s1 IN (SELECT s1 FROM t1) OR s1 IN (SELECT s1 FROM t2);

     For another example, use this query:

          SELECT (SELECT column1 + 5 FROM t1) FROM t2;

     Instead of this query:

          SELECT (SELECT column1 FROM t1) + 5 FROM t2;

   * Use a row subquery instead of a correlated subquery.  For example,
     use this query:

          SELECT * FROM t1
            WHERE (column1,column2) IN (SELECT column1,column2 FROM t2);

     Instead of this query:

          SELECT * FROM t1
            WHERE EXISTS (SELECT * FROM t2 WHERE t2.column1=t1.column1
                          AND t2.column2=t1.column2);

   * Use 'NOT (a = ANY (...))' rather than 'a <> ALL (...)'.

   * Use 'x = ANY (TABLE CONTAINING (1,2))' rather than 'x=1 OR x=2'.

   * Use '= ANY' rather than 'EXISTS'.

   * For uncorrelated subqueries that always return one row, 'IN' is
     always slower than '='.  For example, use this query:

          SELECT * FROM t1
            WHERE t1.COL_NAME = (SELECT a FROM t2 WHERE b = SOME_CONST);

     Instead of this query:

          SELECT * FROM t1
            WHERE t1.COL_NAME IN (SELECT a FROM t2 WHERE b = SOME_CONST);

These tricks might cause programs to go faster or slower.  Using MySQL
facilities like the 'BENCHMARK()' function, you can get an idea about
what helps in your own situation.  See *note information-functions::.

Some optimizations that MySQL itself makes are:

   * MySQL executes uncorrelated subqueries only once.  Use *note
     'EXPLAIN': explain. to make sure that a given subquery really is
     uncorrelated.

   * MySQL rewrites 'IN', 'ALL', 'ANY', and 'SOME' subqueries in an
     attempt to take advantage of the possibility that the select-list
     columns in the subquery are indexed.

   * MySQL replaces subqueries of the following form with an
     index-lookup function, which *note 'EXPLAIN': explain. describes as
     a special join type ('unique_subquery' or 'index_subquery'):

          ... IN (SELECT INDEXED_COLUMN FROM SINGLE_TABLE ...)

   * MySQL enhances expressions of the following form with an expression
     involving 'MIN()' or 'MAX()', unless 'NULL' values or empty sets
     are involved:

          VALUE {ALL|ANY|SOME} {> | < | >= | <=} (UNCORRELATED SUBQUERY)

     For example, this 'WHERE' clause:

          WHERE 5 > ALL (SELECT x FROM t)

     might be treated by the optimizer like this:

          WHERE 5 > (SELECT MAX(x) FROM t)

See also MySQL Internals: How MySQL Transforms Subqueries
(https://dev.mysql.com/doc/internals/en/transformations.html).


File: manual.info.tmp,  Node: rewriting-subqueries,  Next: subquery-restrictions,  Prev: optimizing-subqueries,  Up: subqueries

13.2.10.11 Rewriting Subqueries as Joins
........................................

Sometimes there are other ways to test membership in a set of values
than by using a subquery.  Also, on some occasions, it is not only
possible to rewrite a query without a subquery, but it can be more
efficient to make use of some of these techniques rather than to use
subqueries.  One of these is the 'IN()' construct:

For example, this query:

     SELECT * FROM t1 WHERE id IN (SELECT id FROM t2);

Can be rewritten as:

     SELECT DISTINCT t1.* FROM t1, t2 WHERE t1.id=t2.id;

The queries:

     SELECT * FROM t1 WHERE id NOT IN (SELECT id FROM t2);
     SELECT * FROM t1 WHERE NOT EXISTS (SELECT id FROM t2 WHERE t1.id=t2.id);

Can be rewritten as:

     SELECT table1.*
       FROM table1 LEFT JOIN table2 ON table1.id=table2.id
       WHERE table2.id IS NULL;

A 'LEFT [OUTER] JOIN' can be faster than an equivalent subquery because
the server might be able to optimize it better--a fact that is not
specific to MySQL Server alone.  Prior to SQL-92, outer joins did not
exist, so subqueries were the only way to do certain things.  Today,
MySQL Server and many other modern database systems offer a wide range
of outer join types.

MySQL Server supports multiple-table *note 'DELETE': delete. statements
that can be used to efficiently delete rows based on information from
one table or even from many tables at the same time.  Multiple-table
*note 'UPDATE': update. statements are also supported.  See *note
delete::, and *note update::.


File: manual.info.tmp,  Node: subquery-restrictions,  Prev: rewriting-subqueries,  Up: subqueries

13.2.10.12 Restrictions on Subqueries
.....................................

   * Subquery optimization for 'IN' is not as effective as for the '='
     operator or for the 'IN(VALUE_LIST)' operator.

     A typical case for poor 'IN' subquery performance is when the
     subquery returns a small number of rows but the outer query returns
     a large number of rows to be compared to the subquery result.

     The problem is that, for a statement that uses an 'IN' subquery,
     the optimizer rewrites it as a correlated subquery.  Consider the
     following statement that uses an uncorrelated subquery:

          SELECT ... FROM t1 WHERE t1.a IN (SELECT b FROM t2);

     The optimizer rewrites the statement to a correlated subquery:

          SELECT ... FROM t1 WHERE EXISTS (SELECT 1 FROM t2 WHERE t2.b = t1.a);

     If the inner and outer queries return M and N rows, respectively,
     the execution time becomes on the order of O(MxN), rather than
     O(M+N) as it would be for an uncorrelated subquery.

     An implication is that an 'IN' subquery can be much slower than a
     query written using an 'IN(VALUE_LIST)' operator that lists the
     same values that the subquery would return.

   * In general, you cannot modify a table and select from the same
     table in a subquery.  For example, this limitation applies to
     statements of the following forms:

          DELETE FROM t WHERE ... (SELECT ... FROM t ...);
          UPDATE t ... WHERE col = (SELECT ... FROM t ...);
          {INSERT|REPLACE} INTO t (SELECT ... FROM t ...);

     Exception: The preceding prohibition does not apply if for the
     modified table you are using a derived table and that derived table
     is materialized rather than merged into the outer query.  Example:

          UPDATE t ... WHERE col = (SELECT * FROM (SELECT ... FROM t...) AS _t ...);

     Here the result from the derived table is materialized as a
     temporary table, so the relevant rows in 't' have already been
     selected by the time the update to 't' takes place.

   * Row comparison operations are only partially supported:

        * For 'EXPR [NOT] IN SUBQUERY', EXPR can be an N-tuple
          (specified using row constructor syntax) and the subquery can
          return rows of N-tuples.  The permitted syntax is therefore
          more specifically expressed as 'ROW_CONSTRUCTOR [NOT] IN
          TABLE_SUBQUERY'

        * For 'EXPR OP {ALL|ANY|SOME} SUBQUERY', EXPR must be a scalar
          value and the subquery must be a column subquery; it cannot
          return multiple-column rows.

     In other words, for a subquery that returns rows of N-tuples, this
     is supported:

          (EXPR_1, ..., EXPR_N) [NOT] IN TABLE_SUBQUERY

     But this is not supported:

          (EXPR_1, ..., EXPR_N) OP {ALL|ANY|SOME} SUBQUERY

     The reason for supporting row comparisons for 'IN' but not for the
     others is that 'IN' is implemented by rewriting it as a sequence of
     '=' comparisons and 'AND' operations.  This approach cannot be used
     for 'ALL', 'ANY', or 'SOME'.

   * Subqueries in the 'FROM' clause cannot be correlated subqueries.
     They are materialized in whole (evaluated to produce a result set)
     before evaluating the outer query, so they cannot be evaluated per
     row of the outer query.

   * MySQL does not support 'LIMIT' in subqueries for certain subquery
     operators:

          mysql> SELECT * FROM t1
                 WHERE s1 IN (SELECT s2 FROM t2 ORDER BY s1 LIMIT 1);
          ERROR 1235 (42000): This version of MySQL doesn't yet support
           'LIMIT & IN/ALL/ANY/SOME subquery'

   * The optimizer is more mature for joins than for subqueries, so in
     many cases a statement that uses a subquery can be executed more
     efficiently if you rewrite it as a join.

     An exception occurs for the case where an 'IN' subquery can be
     rewritten as a *note 'SELECT DISTINCT': select. join.  Example:

          SELECT col FROM t1 WHERE id_col IN (SELECT id_col2 FROM t2 WHERE CONDITION);

     That statement can be rewritten as follows:

          SELECT DISTINCT col FROM t1, t2 WHERE t1.id_col = t2.id_col AND CONDITION;

     But in this case, the join requires an extra 'DISTINCT' operation
     and is not more efficient than the subquery.

   * MySQL permits a subquery to refer to a stored function that has
     data-modifying side effects such as inserting rows into a table.
     For example, if 'f()' inserts rows, the following query can modify
     data:

          SELECT ... WHERE x IN (SELECT f() ...);

     This behavior is an extension to the SQL standard.  In MySQL, it
     can produce nondeterministic results because 'f()' might be
     executed a different number of times for different executions of a
     given query depending on how the optimizer chooses to handle it.

     For statement-based or mixed-format replication, one implication of
     this indeterminism is that such a query can produce different
     results on the master and its slaves.


File: manual.info.tmp,  Node: update,  Prev: subqueries,  Up: sql-data-manipulation-statements

13.2.11 UPDATE Statement
------------------------

*note 'UPDATE': update. is a DML statement that modifies rows in a
table.

Single-table syntax:

     UPDATE [LOW_PRIORITY] [IGNORE] TABLE_REFERENCE
         SET ASSIGNMENT_LIST
         [WHERE WHERE_CONDITION]
         [ORDER BY ...]
         [LIMIT ROW_COUNT]

     VALUE:
         {EXPR | DEFAULT}

     ASSIGNMENT:
         COL_NAME = VALUE

     ASSIGNMENT_LIST:
         ASSIGNMENT [, ASSIGNMENT] ...

Multiple-table syntax:

     UPDATE [LOW_PRIORITY] [IGNORE] TABLE_REFERENCES
         SET ASSIGNMENT_LIST
         [WHERE WHERE_CONDITION]

For the single-table syntax, the *note 'UPDATE': update. statement
updates columns of existing rows in the named table with new values.
The 'SET' clause indicates which columns to modify and the values they
should be given.  Each value can be given as an expression, or the
keyword 'DEFAULT' to set a column explicitly to its default value.  The
'WHERE' clause, if given, specifies the conditions that identify which
rows to update.  With no 'WHERE' clause, all rows are updated.  If the
'ORDER BY' clause is specified, the rows are updated in the order that
is specified.  The 'LIMIT' clause places a limit on the number of rows
that can be updated.

For the multiple-table syntax, *note 'UPDATE': update. updates rows in
each table named in TABLE_REFERENCES that satisfy the conditions.  Each
matching row is updated once, even if it matches the conditions multiple
times.  For multiple-table syntax, 'ORDER BY' and 'LIMIT' cannot be
used.

WHERE_CONDITION is an expression that evaluates to true for each row to
be updated.  For expression syntax, see *note expressions::.

TABLE_REFERENCES and WHERE_CONDITION are specified as described in *note
select::.

You need the 'UPDATE' privilege only for columns referenced in an *note
'UPDATE': update. that are actually updated.  You need only the 'SELECT'
privilege for any columns that are read but not modified.

The *note 'UPDATE': update. statement supports the following modifiers:

   * With the 'LOW_PRIORITY' modifier, execution of the *note 'UPDATE':
     update. is delayed until no other clients are reading from the
     table.  This affects only storage engines that use only table-level
     locking (such as 'MyISAM', 'MEMORY', and 'MERGE').

   * With the 'IGNORE' modifier, the update statement does not abort
     even if errors occur during the update.  Rows for which
     duplicate-key conflicts occur on a unique key value are not
     updated.  Rows updated to values that would cause data conversion
     errors are updated to the closest valid values instead.

In MySQL 5.5.18 and later, *note 'UPDATE IGNORE': update. statements,
including those having an 'ORDER BY' clause, are flagged as unsafe for
statement-based replication.  (This is because the order in which the
rows are updated determines which rows are ignored.)  Such statements
produce a warning in the error log when using statement-based mode and
are written to the binary log using the row-based format when using
'MIXED' mode.  (Bug #11758262, Bug #50439) See *note
replication-rbr-safe-unsafe::, for more information.

If you access a column from the table to be updated in an expression,
*note 'UPDATE': update. uses the current value of the column.  For
example, the following statement sets 'col1' to one more than its
current value:

     UPDATE t1 SET col1 = col1 + 1;

The second assignment in the following statement sets 'col2' to the
current (updated) 'col1' value, not the original 'col1' value.  The
result is that 'col1' and 'col2' have the same value.  This behavior
differs from standard SQL.

     UPDATE t1 SET col1 = col1 + 1, col2 = col1;

Single-table *note 'UPDATE': update. assignments are generally evaluated
from left to right.  For multiple-table updates, there is no guarantee
that assignments are carried out in any particular order.

If you set a column to the value it currently has, MySQL notices this
and does not update it.

If you update a column that has been declared 'NOT NULL' by setting to
'NULL', an error occurs if strict SQL mode is enabled; otherwise, the
column is set to the implicit default value for the column data type and
the warning count is incremented.  The implicit default value is '0' for
numeric types, the empty string ('''') for string types, and the 'zero'
value for date and time types.  See *note data-type-defaults::.

*note 'UPDATE': update. returns the number of rows that were actually
changed.  The *note 'mysql_info()': mysql-info. C API function returns
the number of rows that were matched and updated and the number of
warnings that occurred during the *note 'UPDATE': update.

You can use 'LIMIT ROW_COUNT' to restrict the scope of the *note
'UPDATE': update.  A 'LIMIT' clause is a rows-matched restriction.  The
statement stops as soon as it has found ROW_COUNT rows that satisfy the
'WHERE' clause, whether or not they actually were changed.

If an *note 'UPDATE': update. statement includes an 'ORDER BY' clause,
the rows are updated in the order specified by the clause.  This can be
useful in certain situations that might otherwise result in an error.
Suppose that a table 't' contains a column 'id' that has a unique index.
The following statement could fail with a duplicate-key error, depending
on the order in which rows are updated:

     UPDATE t SET id = id + 1;

For example, if the table contains 1 and 2 in the 'id' column and 1 is
updated to 2 before 2 is updated to 3, an error occurs.  To avoid this
problem, add an 'ORDER BY' clause to cause the rows with larger 'id'
values to be updated before those with smaller values:

     UPDATE t SET id = id + 1 ORDER BY id DESC;

You can also perform *note 'UPDATE': update. operations covering
multiple tables.  However, you cannot use 'ORDER BY' or 'LIMIT' with a
multiple-table *note 'UPDATE': update.  The TABLE_REFERENCES clause
lists the tables involved in the join.  Its syntax is described in *note
join::.  Here is an example:

     UPDATE items,month SET items.price=month.price
     WHERE items.id=month.id;

The preceding example shows an inner join that uses the comma operator,
but multiple-table *note 'UPDATE': update. statements can use any type
of join permitted in *note 'SELECT': select. statements, such as 'LEFT
JOIN'.

If you use a multiple-table *note 'UPDATE': update. statement involving
'InnoDB' tables for which there are foreign key constraints, the MySQL
optimizer might process tables in an order that differs from that of
their parent/child relationship.  In this case, the statement fails and
rolls back.  Instead, update a single table and rely on the 'ON UPDATE'
capabilities that 'InnoDB' provides to cause the other tables to be
modified accordingly.  See *note create-table-foreign-keys::.

You cannot update a table and select from the same table in a subquery.

An 'UPDATE' on a partitioned table using a storage engine such as *note
'MyISAM': myisam-storage-engine. that employs table-level locks locks
all partitions of the table.  This does not occur with tables using
storage engines such as *note 'InnoDB': innodb-storage-engine. that
employ row-level locking.  This issue is resolved in MySQL 5.6.  For
more information, see *note partitioning-limitations-locking::.


File: manual.info.tmp,  Node: sql-transactional-statements,  Next: sql-replication-statements,  Prev: sql-data-manipulation-statements,  Up: sql-statements

13.3 Transactional and Locking Statements
=========================================

* Menu:

* commit::                       START TRANSACTION, COMMIT, and ROLLBACK Statements
* cannot-roll-back::             Statements That Cannot Be Rolled Back
* implicit-commit::              Statements That Cause an Implicit Commit
* savepoint::                    SAVEPOINT, ROLLBACK TO SAVEPOINT, and RELEASE SAVEPOINT Statements
* lock-tables::                  LOCK TABLES and UNLOCK TABLES Statements
* set-transaction::              SET TRANSACTION Statement
* xa::                           XA Transactions

MySQL supports local transactions (within a given client session)
through statements such as *note 'SET autocommit': commit, *note 'START
TRANSACTION': commit, *note 'COMMIT': commit, and *note 'ROLLBACK':
commit.  See *note commit::.  XA transaction support enables MySQL to
participate in distributed transactions as well.  See *note xa::.


File: manual.info.tmp,  Node: commit,  Next: cannot-roll-back,  Prev: sql-transactional-statements,  Up: sql-transactional-statements

13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Statements
---------------------------------------------------------

     START TRANSACTION [WITH CONSISTENT SNAPSHOT]
     BEGIN [WORK]
     COMMIT [WORK] [AND [NO] CHAIN] [[NO] RELEASE]
     ROLLBACK [WORK] [AND [NO] CHAIN] [[NO] RELEASE]
     SET autocommit = {0 | 1}

These statements provide control over use of transactions:

   * 'START TRANSACTION' or 'BEGIN' start a new transaction.

   * 'COMMIT' commits the current transaction, making its changes
     permanent.

   * 'ROLLBACK' rolls back the current transaction, canceling its
     changes.

   * 'SET autocommit' disables or enables the default autocommit mode
     for the current session.

By default, MySQL runs with autocommit mode enabled.  This means that,
when not otherwise inside a transaction, each statement is atomic, as if
it were surrounded by 'START TRANSACTION' and 'COMMIT'.  You cannot use
'ROLLBACK' to undo the effect; however, if an error occurs during
statement execution, the statement is rolled back.

To disable autocommit mode implicitly for a single series of statements,
use the 'START TRANSACTION' statement:

     START TRANSACTION;
     SELECT @A:=SUM(salary) FROM table1 WHERE type=1;
     UPDATE table2 SET summary=@A WHERE type=1;
     COMMIT;

With 'START TRANSACTION', autocommit remains disabled until you end the
transaction with 'COMMIT' or 'ROLLBACK'.  The autocommit mode then
reverts to its previous state.

You can also begin a transaction like this:

     START TRANSACTION WITH CONSISTENT SNAPSHOT;

The 'WITH CONSISTENT SNAPSHOT' option starts a consistent read for
storage engines that are capable of it.  This applies only to 'InnoDB'.
The effect is the same as issuing a 'START TRANSACTION' followed by a
*note 'SELECT': select. from any 'InnoDB' table.  See *note
innodb-consistent-read::.  The 'WITH CONSISTENT SNAPSHOT' option does
not change the current transaction isolation level, so it provides a
consistent snapshot only if the current isolation level is one that
permits a consistent read.  The only isolation level that permits a
consistent read is 'REPEATABLE READ'.  For all other isolation levels,
the 'WITH CONSISTENT SNAPSHOT' clause is ignored.  As of MySQL 5.5.34, a
warning is generated when the 'WITH CONSISTENT SNAPSHOT' is ignored.

*Important*:

Many APIs used for writing MySQL client applications (such as JDBC)
provide their own methods for starting transactions that can (and
sometimes should) be used instead of sending a 'START TRANSACTION'
statement from the client.  See *note connectors-apis::, or the
documentation for your API, for more information.

To disable autocommit mode explicitly, use the following statement:

     SET autocommit=0;

After disabling autocommit mode by setting the 'autocommit' variable to
zero, changes to transaction-safe tables (such as those for *note
'InnoDB': innodb-storage-engine. or *note 'NDBCLUSTER': mysql-cluster.)
are not made permanent immediately.  You must use 'COMMIT' to store your
changes to disk or 'ROLLBACK' to ignore the changes.

'autocommit' is a session variable and must be set for each session.  To
disable autocommit mode for each new connection, see the description of
the 'autocommit' system variable at *note server-system-variables::.

'BEGIN' and 'BEGIN WORK' are supported as aliases of 'START TRANSACTION'
for initiating a transaction.  'START TRANSACTION' is standard SQL
syntax and is the recommended way to start an ad-hoc transaction.

The 'BEGIN' statement differs from the use of the 'BEGIN' keyword that
starts a *note 'BEGIN ... END': begin-end. compound statement.  The
latter does not begin a transaction.  See *note begin-end::.

*Note*:

Within all stored programs (stored procedures and functions, triggers,
and events), the parser treats 'BEGIN [WORK]' as the beginning of a
*note 'BEGIN ... END': begin-end. block.  Begin a transaction in this
context with 'START TRANSACTION' instead.

The optional 'WORK' keyword is supported for 'COMMIT' and 'ROLLBACK', as
are the 'CHAIN' and 'RELEASE' clauses.  'CHAIN' and 'RELEASE' can be
used for additional control over transaction completion.  The value of
the 'completion_type' system variable determines the default completion
behavior.  See *note server-system-variables::.

The 'AND CHAIN' clause causes a new transaction to begin as soon as the
current one ends, and the new transaction has the same isolation level
as the just-terminated transaction.  The new transaction also uses the
same access mode ('READ WRITE' or 'READ ONLY') as the just-terminated
transaction.  The 'RELEASE' clause causes the server to disconnect the
current client session after terminating the current transaction.
Including the 'NO' keyword suppresses 'CHAIN' or 'RELEASE' completion,
which can be useful if the 'completion_type' system variable is set to
cause chaining or release completion by default.

Beginning a transaction causes any pending transaction to be committed.
See *note implicit-commit::, for more information.

Beginning a transaction also causes table locks acquired with *note
'LOCK TABLES': lock-tables. to be released, as though you had executed
*note 'UNLOCK TABLES': lock-tables.  Beginning a transaction does not
release a global read lock acquired with 'FLUSH TABLES WITH READ LOCK'.

For best results, transactions should be performed using only tables
managed by a single transaction-safe storage engine.  Otherwise, the
following problems can occur:

   * If you use tables from more than one transaction-safe storage
     engine (such as 'InnoDB'), and the transaction isolation level is
     not 'SERIALIZABLE', it is possible that when one transaction
     commits, another ongoing transaction that uses the same tables will
     see only some of the changes made by the first transaction.  That
     is, the atomicity of transactions is not guaranteed with mixed
     engines and inconsistencies can result.  (If mixed-engine
     transactions are infrequent, you can use *note 'SET TRANSACTION
     ISOLATION LEVEL': set-transaction. to set the isolation level to
     'SERIALIZABLE' on a per-transaction basis as necessary.)

   * If you use tables that are not transaction-safe within a
     transaction, changes to those tables are stored at once, regardless
     of the status of autocommit mode.

   * If you issue a *note 'ROLLBACK': commit. statement after updating a
     nontransactional table within a transaction, an
     'ER_WARNING_NOT_COMPLETE_ROLLBACK' warning occurs.  Changes to
     transaction-safe tables are rolled back, but not changes to
     nontransaction-safe tables.

Each transaction is stored in the binary log in one chunk, upon *note
'COMMIT': commit.  Transactions that are rolled back are not logged.
(*Exception*: Modifications to nontransactional tables cannot be rolled
back.  If a transaction that is rolled back includes modifications to
nontransactional tables, the entire transaction is logged with a *note
'ROLLBACK': commit. statement at the end to ensure that modifications to
the nontransactional tables are replicated.)  See *note binary-log::.

You can change the isolation level for transactions with the *note 'SET
TRANSACTION': set-transaction. statement.  See *note set-transaction::.

Rolling back can be a slow operation that may occur implicitly without
the user having explicitly asked for it (for example, when an error
occurs).  Because of this, *note 'SHOW PROCESSLIST': show-processlist.
displays 'Rolling back' in the 'State' column for the session, not only
for explicit rollbacks performed with the *note 'ROLLBACK': commit.
statement but also for implicit rollbacks.

*Note*:

In MySQL 5.5, 'BEGIN', 'COMMIT', and 'ROLLBACK' are not affected by
'--replicate-do-db' or '--replicate-ignore-db' rules.


File: manual.info.tmp,  Node: cannot-roll-back,  Next: implicit-commit,  Prev: commit,  Up: sql-transactional-statements

13.3.2 Statements That Cannot Be Rolled Back
--------------------------------------------

Some statements cannot be rolled back.  In general, these include data
definition language (DDL) statements, such as those that create or drop
databases, those that create, drop, or alter tables or stored routines.

You should design your transactions not to include such statements.  If
you issue a statement early in a transaction that cannot be rolled back,
and then another statement later fails, the full effect of the
transaction cannot be rolled back in such cases by issuing a *note
'ROLLBACK': commit. statement.


File: manual.info.tmp,  Node: implicit-commit,  Next: savepoint,  Prev: cannot-roll-back,  Up: sql-transactional-statements

13.3.3 Statements That Cause an Implicit Commit
-----------------------------------------------

The statements listed in this section (and any synonyms for them)
implicitly end any transaction active in the current session, as if you
had done a *note 'COMMIT': commit. before executing the statement.

Most of these statements also cause an implicit commit after executing.
The intent is to handle each such statement in its own special
transaction because it cannot be rolled back anyway.
Transaction-control and locking statements are exceptions: If an
implicit commit occurs before execution, another does not occur after.

   * *Data definition language (DDL) statements that define or modify
     database objects.*  'ALTER DATABASE ... UPGRADE DATA DIRECTORY
     NAME', *note 'ALTER EVENT': alter-event, *note 'ALTER PROCEDURE':
     alter-procedure, *note 'ALTER SERVER': alter-server, *note 'ALTER
     TABLE': alter-table, *note 'ALTER VIEW': alter-view, *note 'CREATE
     DATABASE': create-database, *note 'CREATE EVENT': create-event,
     *note 'CREATE INDEX': create-index, *note 'CREATE PROCEDURE':
     create-procedure, *note 'CREATE SERVER': create-server, *note
     'CREATE TABLE': create-table, *note 'CREATE TRIGGER':
     create-trigger, *note 'CREATE VIEW': create-view, *note 'DROP
     DATABASE': drop-database, *note 'DROP EVENT': drop-event, *note
     'DROP INDEX': drop-index, *note 'DROP PROCEDURE': drop-procedure,
     *note 'DROP SERVER': drop-server, *note 'DROP TABLE': drop-table,
     *note 'DROP TRIGGER': drop-trigger, *note 'DROP VIEW': drop-view,
     *note 'RENAME TABLE': rename-table, *note 'TRUNCATE TABLE':
     truncate-table.

     *note 'ALTER FUNCTION': alter-function, *note 'CREATE FUNCTION':
     create-function. and *note 'DROP FUNCTION': drop-function. also
     cause an implicit commit when used with stored functions, but not
     with user-defined functions.  (*note 'ALTER FUNCTION':
     alter-function. can only be used with stored functions.)

     *note 'CREATE TABLE': create-table. and *note 'DROP TABLE':
     drop-table. statements do not commit a transaction if the
     'TEMPORARY' keyword is used.  (This does not apply to other
     operations on temporary tables such as *note 'ALTER TABLE':
     alter-table. and *note 'CREATE INDEX': create-index, which do cause
     a commit.)  However, although no implicit commit occurs, neither
     can the statement be rolled back, which means that the use of such
     statements causes transactional atomicity to be violated.  For
     example, if you use *note 'CREATE TEMPORARY TABLE': create-table.
     and then roll back the transaction, the table remains in existence.

     The *note 'CREATE TABLE': create-table. statement in 'InnoDB' is
     processed as a single transaction.  This means that a *note
     'ROLLBACK': commit. from the user does not undo *note 'CREATE
     TABLE': create-table. statements the user made during that
     transaction.

     *note 'CREATE TABLE ... SELECT': create-table. causes an implicit
     commit before and after the statement is executed when you are
     creating nontemporary tables.  (No commit occurs for 'CREATE
     TEMPORARY TABLE ... SELECT'.)

   * *Statements that implicitly use or modify tables in the 'mysql'
     database.*  *note 'CREATE USER': create-user, *note 'DROP USER':
     drop-user, *note 'GRANT': grant, *note 'RENAME USER': rename-user,
     *note 'REVOKE': revoke, *note 'SET PASSWORD': set-password.

   * *Transaction-control and locking statements.*  *note 'BEGIN':
     commit, *note 'LOCK TABLES': lock-tables, 'SET autocommit = 1' (if
     the value is not already 1), *note 'START TRANSACTION': commit,
     *note 'UNLOCK TABLES': lock-tables.

     *note 'UNLOCK TABLES': lock-tables. commits a transaction only if
     any tables currently have been locked with *note 'LOCK TABLES':
     lock-tables. to acquire nontransactional table locks.  A commit
     does not occur for *note 'UNLOCK TABLES': lock-tables. following
     'FLUSH TABLES WITH READ LOCK' because the latter statement does not
     acquire table-level locks.

     Transactions cannot be nested.  This is a consequence of the
     implicit commit performed for any current transaction when you
     issue a *note 'START TRANSACTION': commit. statement or one of its
     synonyms.

     Statements that cause an implicit commit cannot be used in an XA
     transaction while the transaction is in an 'ACTIVE' state.

     The *note 'BEGIN': commit. statement differs from the use of the
     'BEGIN' keyword that starts a *note 'BEGIN ... END': begin-end.
     compound statement.  The latter does not cause an implicit commit.
     See *note begin-end::.

   * *Data loading statements.*  *note 'LOAD DATA': load-data.  *note
     'LOAD DATA': load-data. causes an implicit commit only for tables
     using the *note 'NDB': mysql-cluster. storage engine.

   * *Administrative statements.*  *note 'ANALYZE TABLE': analyze-table,
     *note 'CACHE INDEX': cache-index, *note 'CHECK TABLE': check-table,
     *note 'LOAD INDEX INTO CACHE': load-index, *note 'OPTIMIZE TABLE':
     optimize-table, *note 'REPAIR TABLE': repair-table.


File: manual.info.tmp,  Node: savepoint,  Next: lock-tables,  Prev: implicit-commit,  Up: sql-transactional-statements

13.3.4 SAVEPOINT, ROLLBACK TO SAVEPOINT, and RELEASE SAVEPOINT Statements
-------------------------------------------------------------------------

     SAVEPOINT IDENTIFIER
     ROLLBACK [WORK] TO [SAVEPOINT] IDENTIFIER
     RELEASE SAVEPOINT IDENTIFIER

'InnoDB' supports the SQL statements *note 'SAVEPOINT': savepoint, *note
'ROLLBACK TO SAVEPOINT': savepoint, *note 'RELEASE SAVEPOINT':
savepoint. and the optional 'WORK' keyword for *note 'ROLLBACK': commit.

The *note 'SAVEPOINT': savepoint. statement sets a named transaction
savepoint with a name of IDENTIFIER.  If the current transaction has a
savepoint with the same name, the old savepoint is deleted and a new one
is set.

The *note 'ROLLBACK TO SAVEPOINT': savepoint. statement rolls back a
transaction to the named savepoint without terminating the transaction.
Modifications that the current transaction made to rows after the
savepoint was set are undone in the rollback, but 'InnoDB' does _not_
release the row locks that were stored in memory after the savepoint.
(For a new inserted row, the lock information is carried by the
transaction ID stored in the row; the lock is not separately stored in
memory.  In this case, the row lock is released in the undo.)
Savepoints that were set at a later time than the named savepoint are
deleted.

If the *note 'ROLLBACK TO SAVEPOINT': savepoint. statement returns the
following error, it means that no savepoint with the specified name
exists:

     ERROR 1305 (42000): SAVEPOINT IDENTIFIER does not exist

The *note 'RELEASE SAVEPOINT': savepoint. statement removes the named
savepoint from the set of savepoints of the current transaction.  No
commit or rollback occurs.  It is an error if the savepoint does not
exist.

All savepoints of the current transaction are deleted if you execute a
*note 'COMMIT': commit, or a *note 'ROLLBACK': commit. that does not
name a savepoint.

A new savepoint level is created when a stored function is invoked or a
trigger is activated.  The savepoints on previous levels become
unavailable and thus do not conflict with savepoints on the new level.
When the function or trigger terminates, any savepoints it created are
released and the previous savepoint level is restored.


File: manual.info.tmp,  Node: lock-tables,  Next: set-transaction,  Prev: savepoint,  Up: sql-transactional-statements

13.3.5 LOCK TABLES and UNLOCK TABLES Statements
-----------------------------------------------

     LOCK TABLES
         TBL_NAME [[AS] ALIAS] LOCK_TYPE
         [, TBL_NAME [[AS] ALIAS] LOCK_TYPE] ...

     LOCK_TYPE: {
         READ [LOCAL]
       | [LOW_PRIORITY] WRITE
     }

     UNLOCK TABLES

MySQL enables client sessions to acquire table locks explicitly for the
purpose of cooperating with other sessions for access to tables, or to
prevent other sessions from modifying tables during periods when a
session requires exclusive access to them.  A session can acquire or
release locks only for itself.  One session cannot acquire locks for
another session or release locks held by another session.

Locks may be used to emulate transactions or to get more speed when
updating tables.  This is explained in more detail in *note
lock-tables-restrictions::.

*note 'LOCK TABLES': lock-tables. explicitly acquires table locks for
the current client session.  Table locks can be acquired for base tables
or views.  You must have the 'LOCK TABLES' privilege, and the 'SELECT'
privilege for each object to be locked.

For view locking, *note 'LOCK TABLES': lock-tables. adds all base tables
used in the view to the set of tables to be locked and locks them
automatically.  If you lock a table explicitly with *note 'LOCK TABLES':
lock-tables, any tables used in triggers are also locked implicitly, as
described in *note lock-tables-and-triggers::.

*note 'UNLOCK TABLES': lock-tables. explicitly releases any table locks
held by the current session.  *note 'LOCK TABLES': lock-tables.
implicitly releases any table locks held by the current session before
acquiring new locks.

Another use for *note 'UNLOCK TABLES': lock-tables. is to release the
global read lock acquired with the 'FLUSH TABLES WITH READ LOCK'
statement, which enables you to lock all tables in all databases.  See
*note flush::.  (This is a very convenient way to get backups if you
have a file system such as Veritas that can take snapshots in time.)

A table lock protects only against inappropriate reads or writes by
other sessions.  A session holding a 'WRITE' lock can perform
table-level operations such as *note 'DROP TABLE': drop-table. or *note
'TRUNCATE TABLE': truncate-table.  For sessions holding a 'READ' lock,
*note 'DROP TABLE': drop-table. and *note 'TRUNCATE TABLE':
truncate-table. operations are not permitted.

The following discussion applies only to non-'TEMPORARY' tables.  *note
'LOCK TABLES': lock-tables. is permitted (but ignored) for a 'TEMPORARY'
table.  The table can be accessed freely by the session within which it
was created, regardless of what other locking may be in effect.  No lock
is necessary because no other session can see the table.

   * *note table-lock-acquisition::

   * *note table-lock-release::

   * *note lock-tables-and-transactions::

   * *note lock-tables-and-triggers::

   * *note lock-tables-restrictions::

*Table Lock Acquisition*

To acquire table locks within the current session, use the *note 'LOCK
TABLES': lock-tables. statement, which acquires metadata locks (see
*note metadata-locking::).

The following lock types are available:

'READ [LOCAL]' lock:

   * The session that holds the lock can read the table (but not write
     it).

   * Multiple sessions can acquire a 'READ' lock for the table at the
     same time.

   * Other sessions can read the table without explicitly acquiring a
     'READ' lock.

   * The 'LOCAL' modifier enables nonconflicting *note 'INSERT': insert.
     statements (concurrent inserts) by other sessions to execute while
     the lock is held.  (See *note concurrent-inserts::.)  However,
     'READ LOCAL' cannot be used if you are going to manipulate the
     database using processes external to the server while you hold the
     lock.  For 'InnoDB' tables, 'READ LOCAL' is the same as 'READ'.

'[LOW_PRIORITY] WRITE' lock:

   * The session that holds the lock can read and write the table.

   * Only the session that holds the lock can access the table.  No
     other session can access it until the lock is released.

   * Lock requests for the table by other sessions block while the
     'WRITE' lock is held.

   * The 'LOW_PRIORITY' modifier has no effect.  In previous versions of
     MySQL, it affected locking behavior, but this is no longer true.
     It is now deprecated and its use produces a warning.  Use 'WRITE'
     without 'LOW_PRIORITY' instead.

'WRITE' locks normally have higher priority than 'READ' locks to ensure
that updates are processed as soon as possible.  This means that if one
session obtains a 'READ' lock and then another session requests a
'WRITE' lock, subsequent 'READ' lock requests wait until the session
that requested the 'WRITE' lock has obtained the lock and released it.
(An exception to this policy can occur for small values of the
'max_write_lock_count' system variable; see *note metadata-locking::.)

If the *note 'LOCK TABLES': lock-tables. statement must wait due to
locks held by other sessions on any of the tables, it blocks until all
locks can be acquired.

A session that requires locks must acquire all the locks that it needs
in a single *note 'LOCK TABLES': lock-tables. statement.  While the
locks thus obtained are held, the session can access only the locked
tables.  For example, in the following sequence of statements, an error
occurs for the attempt to access 't2' because it was not locked in the
*note 'LOCK TABLES': lock-tables. statement:

     mysql> LOCK TABLES t1 READ;
     mysql> SELECT COUNT(*) FROM t1;
     +----------+
     | COUNT(*) |
     +----------+
     |        3 |
     +----------+
     mysql> SELECT COUNT(*) FROM t2;
     ERROR 1100 (HY000): Table 't2' was not locked with LOCK TABLES

Tables in the 'INFORMATION_SCHEMA' database are an exception.  They can
be accessed without being locked explicitly even while a session holds
table locks obtained with *note 'LOCK TABLES': lock-tables.

You cannot refer to a locked table multiple times in a single query
using the same name.  Use aliases instead, and obtain a separate lock
for the table and each alias:

     mysql> LOCK TABLE t WRITE, t AS t1 READ;
     mysql> INSERT INTO t SELECT * FROM t;
     ERROR 1100: Table 't' was not locked with LOCK TABLES
     mysql> INSERT INTO t SELECT * FROM t AS t1;

The error occurs for the first *note 'INSERT': insert. because there are
two references to the same name for a locked table.  The second *note
'INSERT': insert. succeeds because the references to the table use
different names.

If your statements refer to a table by means of an alias, you must lock
the table using that same alias.  It does not work to lock the table
without specifying the alias:

     mysql> LOCK TABLE t READ;
     mysql> SELECT * FROM t AS myalias;
     ERROR 1100: Table 'myalias' was not locked with LOCK TABLES

Conversely, if you lock a table using an alias, you must refer to it in
your statements using that alias:

     mysql> LOCK TABLE t AS myalias READ;
     mysql> SELECT * FROM t;
     ERROR 1100: Table 't' was not locked with LOCK TABLES
     mysql> SELECT * FROM t AS myalias;

*Note*:

'LOCK TABLES' or 'UNLOCK TABLES', when applied to a partitioned table,
always locks or unlocks the entire table.  See *note
partitioning-limitations-locking::.

*Table Lock Release*

When the table locks held by a session are released, they are all
released at the same time.  A session can release its locks explicitly,
or locks may be released implicitly under certain conditions.

   * A session can release its locks explicitly with *note 'UNLOCK
     TABLES': lock-tables.

   * If a session issues a *note 'LOCK TABLES': lock-tables. statement
     to acquire a lock while already holding locks, its existing locks
     are released implicitly before the new locks are granted.

   * If a session begins a transaction (for example, with *note 'START
     TRANSACTION': commit.), an implicit *note 'UNLOCK TABLES':
     lock-tables. is performed, which causes existing locks to be
     released.  (For additional information about the interaction
     between table locking and transactions, see *note
     lock-tables-and-transactions::.)

If the connection for a client session terminates, whether normally or
abnormally, the server implicitly releases all table locks held by the
session (transactional and nontransactional).  If the client reconnects,
the locks will no longer be in effect.  In addition, if the client had
an active transaction, the server rolls back the transaction upon
disconnect, and if reconnect occurs, the new session begins with
autocommit enabled.  For this reason, clients may wish to disable
auto-reconnect.  With auto-reconnect in effect, the client is not
notified if reconnect occurs but any table locks or current transaction
will have been lost.  With auto-reconnect disabled, if the connection
drops, an error occurs for the next statement issued.  The client can
detect the error and take appropriate action such as reacquiring the
locks or redoing the transaction.  See *note c-api-auto-reconnect::.

*Note*:

If you use *note 'ALTER TABLE': alter-table. on a locked table, it may
become unlocked.  For example, if you attempt a second *note 'ALTER
TABLE': alter-table. operation, the result may be an error 'Table
'TBL_NAME' was not locked with LOCK TABLES'.  To handle this, lock the
table again prior to the second alteration.  See also *note
alter-table-problems::.

*Interaction of Table Locking and Transactions*

*note 'LOCK TABLES': lock-tables. and *note 'UNLOCK TABLES':
lock-tables. interact with the use of transactions as follows:

   * *note 'LOCK TABLES': lock-tables. is not transaction-safe and
     implicitly commits any active transaction before attempting to lock
     the tables.

   * *note 'UNLOCK TABLES': lock-tables. implicitly commits any active
     transaction, but only if *note 'LOCK TABLES': lock-tables. has been
     used to acquire table locks.  For example, in the following set of
     statements, *note 'UNLOCK TABLES': lock-tables. releases the global
     read lock but does not commit the transaction because no table
     locks are in effect:

          FLUSH TABLES WITH READ LOCK;
          START TRANSACTION;
          SELECT ... ;
          UNLOCK TABLES;

   * Beginning a transaction (for example, with *note 'START
     TRANSACTION': commit.) implicitly commits any current transaction
     and releases existing table locks.

   * 'FLUSH TABLES WITH READ LOCK' acquires a global read lock and not
     table locks, so it is not subject to the same behavior as *note
     'LOCK TABLES': lock-tables. and *note 'UNLOCK TABLES': lock-tables.
     with respect to table locking and implicit commits.  For example,
     *note 'START TRANSACTION': commit. does not release the global read
     lock.  See *note flush::.

   * Other statements that implicitly cause transactions to be committed
     do not release existing table locks.  For a list of such
     statements, see *note implicit-commit::.

   * The correct way to use *note 'LOCK TABLES': lock-tables. and *note
     'UNLOCK TABLES': lock-tables. with transactional tables, such as
     'InnoDB' tables, is to begin a transaction with 'SET autocommit =
     0' (not *note 'START TRANSACTION': commit.) followed by *note 'LOCK
     TABLES': lock-tables, and to not call *note 'UNLOCK TABLES':
     lock-tables. until you commit the transaction explicitly.  For
     example, if you need to write to table 't1' and read from table
     't2', you can do this:

          SET autocommit=0;
          LOCK TABLES t1 WRITE, t2 READ, ...;... DO SOMETHING WITH TABLES T1 AND T2 HERE ...
          COMMIT;
          UNLOCK TABLES;

     When you call *note 'LOCK TABLES': lock-tables, 'InnoDB' internally
     takes its own table lock, and MySQL takes its own table lock.
     'InnoDB' releases its internal table lock at the next commit, but
     for MySQL to release its table lock, you have to call *note 'UNLOCK
     TABLES': lock-tables.  You should not have 'autocommit = 1',
     because then 'InnoDB' releases its internal table lock immediately
     after the call of *note 'LOCK TABLES': lock-tables, and deadlocks
     can very easily happen.  'InnoDB' does not acquire the internal
     table lock at all if 'autocommit = 1', to help old applications
     avoid unnecessary deadlocks.

   * *note 'ROLLBACK': commit. does not release table locks.

*LOCK TABLES and Triggers*

If you lock a table explicitly with *note 'LOCK TABLES': lock-tables,
any tables used in triggers are also locked implicitly:

   * The locks are taken as the same time as those acquired explicitly
     with the *note 'LOCK TABLES': lock-tables. statement.

   * The lock on a table used in a trigger depends on whether the table
     is used only for reading.  If so, a read lock suffices.  Otherwise,
     a write lock is used.

   * If a table is locked explicitly for reading with *note 'LOCK
     TABLES': lock-tables, but needs to be locked for writing because it
     might be modified within a trigger, a write lock is taken rather
     than a read lock.  (That is, an implicit write lock needed due to
     the table's appearance within a trigger causes an explicit read
     lock request for the table to be converted to a write lock
     request.)

Suppose that you lock two tables, 't1' and 't2', using this statement:

     LOCK TABLES t1 WRITE, t2 READ;

If 't1' or 't2' have any triggers, tables used within the triggers will
also be locked.  Suppose that 't1' has a trigger defined like this:

     CREATE TRIGGER t1_a_ins AFTER INSERT ON t1 FOR EACH ROW
     BEGIN
       UPDATE t4 SET count = count+1
           WHERE id = NEW.id AND EXISTS (SELECT a FROM t3);
       INSERT INTO t2 VALUES(1, 2);
     END;

The result of the *note 'LOCK TABLES': lock-tables. statement is that
't1' and 't2' are locked because they appear in the statement, and 't3'
and 't4' are locked because they are used within the trigger:

   * 't1' is locked for writing per the 'WRITE' lock request.

   * 't2' is locked for writing, even though the request is for a 'READ'
     lock.  This occurs because 't2' is inserted into within the
     trigger, so the 'READ' request is converted to a 'WRITE' request.

   * 't3' is locked for reading because it is only read from within the
     trigger.

   * 't4' is locked for writing because it might be updated within the
     trigger.

*Table-Locking Restrictions and Conditions*

You can safely use *note 'KILL': kill. to terminate a session that is
waiting for a table lock.  See *note kill::.

Do _not_ lock any tables that you are using with *note 'INSERT DELAYED':
insert-delayed.  An *note 'INSERT DELAYED': insert-delayed. in this case
results in an error because the insert must be handled by a separate
thread, not by the session which holds the lock.

*note 'LOCK TABLES': lock-tables. and *note 'UNLOCK TABLES':
lock-tables. cannot be used within stored programs.

Tables in the 'performance_schema' database cannot be locked with *note
'LOCK TABLES': lock-tables, except the 'setup_XXX' tables.

The following statements are prohibited while a *note 'LOCK TABLES':
lock-tables. statement is in effect: *note 'CREATE TABLE': create-table,
*note 'CREATE TABLE ... LIKE': create-table, *note 'CREATE VIEW':
create-view, *note 'DROP VIEW': drop-view, and DDL statements on stored
functions and procedures and events.

For some operations, system tables in the 'mysql' database must be
accessed.  For example, the *note 'HELP': help. statement requires the
contents of the server-side help tables, and 'CONVERT_TZ()' might need
to read the time zone tables.  The server implicitly locks the system
tables for reading as necessary so that you need not lock them
explicitly.  These tables are treated as just described:

     mysql.help_category
     mysql.help_keyword
     mysql.help_relation
     mysql.help_topic
     mysql.proc
     mysql.time_zone
     mysql.time_zone_leap_second
     mysql.time_zone_name
     mysql.time_zone_transition
     mysql.time_zone_transition_type

If you want to explicitly place a 'WRITE' lock on any of those tables
with a *note 'LOCK TABLES': lock-tables. statement, the table must be
the only one locked; no other table can be locked with the same
statement.

Normally, you do not need to lock tables, because all single *note
'UPDATE': update. statements are atomic; no other session can interfere
with any other currently executing SQL statement.  However, there are a
few cases when locking tables may provide an advantage:

   * If you are going to run many operations on a set of 'MyISAM'
     tables, it is much faster to lock the tables you are going to use.
     Locking 'MyISAM' tables speeds up inserting, updating, or deleting
     on them because MySQL does not flush the key cache for the locked
     tables until *note 'UNLOCK TABLES': lock-tables. is called.
     Normally, the key cache is flushed after each SQL statement.

     The downside to locking the tables is that no session can update a
     'READ'-locked table (including the one holding the lock) and no
     session can access a 'WRITE'-locked table other than the one
     holding the lock.

   * If you are using tables for a nontransactional storage engine, you
     must use *note 'LOCK TABLES': lock-tables. if you want to ensure
     that no other session modifies the tables between a *note 'SELECT':
     select. and an *note 'UPDATE': update.  The example shown here
     requires *note 'LOCK TABLES': lock-tables. to execute safely:

          LOCK TABLES trans READ, customer WRITE;
          SELECT SUM(value) FROM trans WHERE customer_id=SOME_ID;
          UPDATE customer
            SET total_value=SUM_FROM_PREVIOUS_STATEMENT
            WHERE customer_id=SOME_ID;
          UNLOCK TABLES;

     Without *note 'LOCK TABLES': lock-tables, it is possible that
     another session might insert a new row in the 'trans' table between
     execution of the *note 'SELECT': select. and *note 'UPDATE':
     update. statements.

You can avoid using *note 'LOCK TABLES': lock-tables. in many cases by
using relative updates ('UPDATE customer SET VALUE=VALUE+NEW_VALUE') or
the 'LAST_INSERT_ID()' function.

You can also avoid locking tables in some cases by using the user-level
advisory lock functions 'GET_LOCK()' and 'RELEASE_LOCK()'.  These locks
are saved in a hash table in the server and implemented with
'pthread_mutex_lock()' and 'pthread_mutex_unlock()' for high speed.  See
*note locking-functions::.

See *note internal-locking::, for more information on locking policy.


File: manual.info.tmp,  Node: set-transaction,  Next: xa,  Prev: lock-tables,  Up: sql-transactional-statements

13.3.6 SET TRANSACTION Statement
--------------------------------

     SET [GLOBAL | SESSION] TRANSACTION ISOLATION LEVEL LEVEL

     LEVEL: {
          REPEATABLE READ
        | READ COMMITTED
        | READ UNCOMMITTED
        | SERIALIZABLE
     }

This statement sets the transaction isolation level, used for operations
on *note 'InnoDB': innodb-storage-engine. tables.

   * *note set-transaction-isolation-level::

   * *note set-transaction-scope::

*Transaction Isolation Levels*

To set the transaction isolation level, use an 'ISOLATION LEVEL LEVEL'
clause.

The default isolation level is 'REPEATABLE READ'.  Other permitted
values are 'READ COMMITTED', 'READ UNCOMMITTED', and 'SERIALIZABLE'.
For information about these isolation levels, see *note
innodb-transaction-isolation-levels::.

*Transaction Isolation Level Scope*

You can set the isolation level globally, for the current session, or
for the next transaction only:

   * With the 'GLOBAL' keyword:

        * The statement applies globally for all subsequent sessions.

        * Existing sessions are unaffected.

   * With the 'SESSION' keyword:

        * The statement applies to all subsequent transactions performed
          within the current session.

        * The statement is permitted within transactions, but does not
          affect the current ongoing transaction.

        * If executed between transactions, the statement overrides any
          preceding statement that sets the next-transaction isolation
          level.

   * Without any 'SESSION' or 'GLOBAL' keyword:

        * The statement applies only to the next single transaction
          performed within the session.

        * Subsequent transactions revert to using the session isolation
          level.

        * The statement is not permitted within transactions:

               mysql> START TRANSACTION;
               Query OK, 0 rows affected (0.02 sec)

               mysql> SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
               ERROR 1568 (25001): Transaction isolation level can't be changed
               while a transaction is in progress

A change to the global isolation level requires the 'SUPER' privilege.
Any session is free to change its session isolation level (even in the
middle of a transaction), or the isolation level for its next
transaction (prior to the start of that transaction).

To set the global isolation level at server startup, use the
'--transaction-isolation=LEVEL' option on the command line or in an
option file.  Values of LEVEL for this option use dashes rather than
spaces, so the permissible values are 'READ-UNCOMMITTED',
'READ-COMMITTED', 'REPEATABLE-READ', or 'SERIALIZABLE'.  For example, to
set the isolation level to 'REPEATABLE READ', use these lines in the
'[mysqld]' section of an option file:

     [mysqld]
     transaction-isolation = REPEATABLE-READ

It is possible to set or check the global and session transaction
isolation levels at runtime by using the 'tx_isolation' system variable:

     SET GLOBAL tx_isolation='REPEATABLE-READ';
     SET SESSION tx_isolation='SERIALIZABLE';
     SELECT @@GLOBAL.tx_isolation, @@SESSION.tx_isolation;


File: manual.info.tmp,  Node: xa,  Prev: set-transaction,  Up: sql-transactional-statements

13.3.7 XA Transactions
----------------------

* Menu:

* xa-statements::                XA Transaction SQL Statements
* xa-states::                    XA Transaction States
* xa-restrictions::              Restrictions on XA Transactions

Support for XA transactions is available for the 'InnoDB' storage
engine.  The MySQL XA implementation is based on the X/Open CAE document
'Distributed Transaction Processing: The XA Specification'.  This
document is published by The Open Group and available at
<http://www.opengroup.org/public/pubs/catalog/c193.htm>.  Limitations of
the current XA implementation are described in *note xa-restrictions::.

On the client side, there are no special requirements.  The XA interface
to a MySQL server consists of SQL statements that begin with the 'XA'
keyword.  MySQL client programs must be able to send SQL statements and
to understand the semantics of the XA statement interface.  They do not
need be linked against a recent client library.  Older client libraries
also will work.

Among the MySQL Connectors, MySQL Connector/J 5.0.0 supports XA directly
(by means of a class interface that handles the XA SQL statement
interface for you).

XA supports distributed transactions, that is, the ability to permit
multiple separate transactional resources to participate in a global
transaction.  Transactional resources often are RDBMSs but may be other
kinds of resources.

A global transaction involves several actions that are transactional in
themselves, but that all must either complete successfully as a group,
or all be rolled back as a group.  In essence, this extends ACID
properties 'up a level' so that multiple ACID transactions can be
executed in concert as components of a global operation that also has
ACID properties.  (As with nondistributed transactions, 'SERIALIZABLE'
may be preferred if your applications are sensitive to read phenomena.
'REPEATABLE READ' may not be sufficient for distributed transactions.)

Some examples of distributed transactions:

   * An application may act as an integration tool that combines a
     messaging service with an RDBMS. The application makes sure that
     transactions dealing with message sending, retrieval, and
     processing that also involve a transactional database all happen in
     a global transaction.  You can think of this as 'transactional
     email.'

   * An application performs actions that involve different database
     servers, such as a MySQL server and an Oracle server (or multiple
     MySQL servers), where actions that involve multiple servers must
     happen as part of a global transaction, rather than as separate
     transactions local to each server.

   * A bank keeps account information in an RDBMS and distributes and
     receives money through automated teller machines (ATMs).  It is
     necessary to ensure that ATM actions are correctly reflected in the
     accounts, but this cannot be done with the RDBMS alone.  A global
     transaction manager integrates the ATM and database resources to
     ensure overall consistency of financial transactions.

Applications that use global transactions involve one or more Resource
Managers and a Transaction Manager:

   * A Resource Manager (RM) provides access to transactional resources.
     A database server is one kind of resource manager.  It must be
     possible to either commit or roll back transactions managed by the
     RM.

   * A Transaction Manager (TM) coordinates the transactions that are
     part of a global transaction.  It communicates with the RMs that
     handle each of these transactions.  The individual transactions
     within a global transaction are 'branches' of the global
     transaction.  Global transactions and their branches are identified
     by a naming scheme described later.

The MySQL implementation of XA enables a MySQL server to act as a
Resource Manager that handles XA transactions within a global
transaction.  A client program that connects to the MySQL server acts as
the Transaction Manager.

To carry out a global transaction, it is necessary to know which
components are involved, and bring each component to a point when it can
be committed or rolled back.  Depending on what each component reports
about its ability to succeed, they must all commit or roll back as an
atomic group.  That is, either all components must commit, or all
components must roll back.  To manage a global transaction, it is
necessary to take into account that any component or the connecting
network might fail.

The process for executing a global transaction uses two-phase commit
(2PC). This takes place after the actions performed by the branches of
the global transaction have been executed.

  1. In the first phase, all branches are prepared.  That is, they are
     told by the TM to get ready to commit.  Typically, this means each
     RM that manages a branch records the actions for the branch in
     stable storage.  The branches indicate whether they are able to do
     this, and these results are used for the second phase.

  2. In the second phase, the TM tells the RMs whether to commit or roll
     back.  If all branches indicated when they were prepared that they
     will be able to commit, all branches are told to commit.  If any
     branch indicated when it was prepared that it will not be able to
     commit, all branches are told to roll back.

In some cases, a global transaction might use one-phase commit (1PC).
For example, when a Transaction Manager finds that a global transaction
consists of only one transactional resource (that is, a single branch),
that resource can be told to prepare and commit at the same time.


File: manual.info.tmp,  Node: xa-statements,  Next: xa-states,  Prev: xa,  Up: xa

13.3.7.1 XA Transaction SQL Statements
......................................

To perform XA transactions in MySQL, use the following statements:

     XA {START|BEGIN} XID [JOIN|RESUME]

     XA END XID [SUSPEND [FOR MIGRATE]]

     XA PREPARE XID

     XA COMMIT XID [ONE PHASE]

     XA ROLLBACK XID

     XA RECOVER

For *note 'XA START': xa-statements, the 'JOIN' and 'RESUME' clauses are
recognized but have no effect.

For *note 'XA END': xa-statements. the 'SUSPEND [FOR MIGRATE]' clause is
recognized but has no effect.

Each XA statement begins with the 'XA' keyword, and most of them require
an XID value.  An XID is an XA transaction identifier.  It indicates
which transaction the statement applies to.  XID values are supplied by
the client, or generated by the MySQL server.  An XID value has from one
to three parts:

     XID: GTRID [, BQUAL [, FORMATID ]]

GTRID is a global transaction identifier, BQUAL is a branch qualifier,
and FORMATID is a number that identifies the format used by the GTRID
and BQUAL values.  As indicated by the syntax, BQUAL and FORMATID are
optional.  The default BQUAL value is '''' if not given.  The default
FORMATID value is 1 if not given.

GTRID and BQUAL must be string literals, each up to 64 bytes (not
characters) long.  GTRID and BQUAL can be specified in several ways.
You can use a quoted string (''ab''), hex string ('X'6162'', '0x6162'),
or bit value ('b'NNNN'').

FORMATID is an unsigned integer.

The GTRID and BQUAL values are interpreted in bytes by the MySQL
server's underlying XA support routines.  However, while an SQL
statement containing an XA statement is being parsed, the server works
with some specific character set.  To be safe, write GTRID and BQUAL as
hex strings.

XID values typically are generated by the Transaction Manager.  Values
generated by one TM must be different from values generated by other
TMs.  A given TM must be able to recognize its own XID values in a list
of values returned by the *note 'XA RECOVER': xa-statements. statement.

*note 'XA START XID': xa-statements. starts an XA transaction with the
given XID value.  Each XA transaction must have a unique XID value, so
the value must not currently be used by another XA transaction.
Uniqueness is assessed using the GTRID and BQUAL values.  All following
XA statements for the XA transaction must be specified using the same
XID value as that given in the *note 'XA START': xa-statements.
statement.  If you use any of those statements but specify an XID value
that does not correspond to some existing XA transaction, an error
occurs.

One or more XA transactions can be part of the same global transaction.
All XA transactions within a given global transaction must use the same
GTRID value in the XID value.  For this reason, GTRID values must be
globally unique so that there is no ambiguity about which global
transaction a given XA transaction is part of.  The BQUAL part of the
XID value must be different for each XA transaction within a global
transaction.  (The requirement that BQUAL values be different is a
limitation of the current MySQL XA implementation.  It is not part of
the XA specification.)

The *note 'XA RECOVER': xa-statements. statement returns information for
those XA transactions on the MySQL server that are in the 'PREPARED'
state.  (See *note xa-states::.)  The output includes a row for each
such XA transaction on the server, regardless of which client started
it.

*note 'XA RECOVER': xa-statements. output rows look like this (for an
example XID value consisting of the parts ''abc'', ''def'', and '7'):

     mysql> XA RECOVER;
     +----------+--------------+--------------+--------+
     | formatID | gtrid_length | bqual_length | data   |
     +----------+--------------+--------------+--------+
     |        7 |            3 |            3 | abcdef |
     +----------+--------------+--------------+--------+

The output columns have the following meanings:

   * 'formatID' is the FORMATID part of the transaction XID

   * 'gtrid_length' is the length in bytes of the GTRID part of the XID

   * 'bqual_length' is the length in bytes of the BQUAL part of the XID

   * 'data' is the concatenation of the GTRID and BQUAL parts of the XID


File: manual.info.tmp,  Node: xa-states,  Next: xa-restrictions,  Prev: xa-statements,  Up: xa

13.3.7.2 XA Transaction States
..............................

An XA transaction progresses through the following states:

  1. Use *note 'XA START': xa-statements. to start an XA transaction and
     put it in the 'ACTIVE' state.

  2. For an 'ACTIVE' XA transaction, issue the SQL statements that make
     up the transaction, and then issue an *note 'XA END':
     xa-statements. statement.  *note 'XA END': xa-statements. puts the
     transaction in the 'IDLE' state.

  3. For an 'IDLE' XA transaction, you can issue either an *note 'XA
     PREPARE': xa-statements. statement or an 'XA COMMIT ... ONE PHASE'
     statement:

        * *note 'XA PREPARE': xa-statements. puts the transaction in the
          'PREPARED' state.  An *note 'XA RECOVER': xa-statements.
          statement at this point will include the transaction's XID
          value in its output, because *note 'XA RECOVER':
          xa-statements. lists all XA transactions that are in the
          'PREPARED' state.

        * 'XA COMMIT ... ONE PHASE' prepares and commits the
          transaction.  The XID value will not be listed by *note 'XA
          RECOVER': xa-statements. because the transaction terminates.

  4. For a 'PREPARED' XA transaction, you can issue an *note 'XA
     COMMIT': xa-statements. statement to commit and terminate the
     transaction, or *note 'XA ROLLBACK': xa-statements. to roll back
     and terminate the transaction.

Here is a simple XA transaction that inserts a row into a table as part
of a global transaction:

     mysql> XA START 'xatest';
     Query OK, 0 rows affected (0.00 sec)

     mysql> INSERT INTO mytable (i) VALUES(10);
     Query OK, 1 row affected (0.04 sec)

     mysql> XA END 'xatest';
     Query OK, 0 rows affected (0.00 sec)

     mysql> XA PREPARE 'xatest';
     Query OK, 0 rows affected (0.00 sec)

     mysql> XA COMMIT 'xatest';
     Query OK, 0 rows affected (0.00 sec)

Within the context of a given client connection, XA transactions and
local (non-XA) transactions are mutually exclusive.  For example, if
*note 'XA START': xa-statements. has been issued to begin an XA
transaction, a local transaction cannot be started until the XA
transaction has been committed or rolled back.  Conversely, if a local
transaction has been started with *note 'START TRANSACTION': commit, no
XA statements can be used until the transaction has been committed or
rolled back.

If an XA transaction is in the 'ACTIVE' state, you cannot issue any
statements that cause an implicit commit.  That would violate the XA
contract because you could not roll back the XA transaction.  You will
receive the following error if you try to execute such a statement:

     ERROR 1399 (XAE07): XAER_RMFAIL: The command cannot be executed
     when global transaction is in the ACTIVE state

Statements to which the preceding remark applies are listed at *note
implicit-commit::.


File: manual.info.tmp,  Node: xa-restrictions,  Prev: xa-states,  Up: xa

13.3.7.3 Restrictions on XA Transactions
........................................

XA transaction support is limited to the 'InnoDB' storage engine.

For 'external XA,' a MySQL server acts as a Resource Manager and client
programs act as Transaction Managers.  For 'Internal XA', storage
engines within a MySQL server act as RMs, and the server itself acts as
a TM. Internal XA support is limited by the capabilities of individual
storage engines.  Internal XA is required for handling XA transactions
that involve more than one storage engine.  The implementation of
internal XA requires that a storage engine support two-phase commit at
the table handler level, and currently this is true only for 'InnoDB'.

For *note 'XA START': xa-statements, the 'JOIN' and 'RESUME' clauses are
recognized but have no effect.

For *note 'XA END': xa-statements. the 'SUSPEND [FOR MIGRATE]' clause is
recognized but has no effect.

The requirement that the BQUAL part of the XID value be different for
each XA transaction within a global transaction is a limitation of the
current MySQL XA implementation.  It is not part of the XA
specification.

If an XA transaction has reached the 'PREPARED' state and the MySQL
server is killed (for example, with *note 'kill -9': kill. on Unix) or
shuts down abnormally, the transaction can be continued after the server
restarts.  However, if the client reconnects and commits the
transaction, the transaction will be absent from the binary log even
though it has been committed.  This means the data and the binary log
have gone out of synchrony.  An implication is that XA cannot be used
safely together with replication.

It is possible that the server will roll back a pending XA transaction,
even one that has reached the 'PREPARED' state.  This happens if a
client connection terminates and the server continues to run, or if
clients are connected and the server shuts down gracefully.  (In the
latter case, the server marks each connection to be terminated, and then
rolls back the 'PREPARED' XA transaction associated with it.)  It should
be possible to commit or roll back a 'PREPARED' XA transaction, but this
cannot be done without changes to the binary logging mechanism.

'FLUSH TABLES WITH READ LOCK' is not compatible with XA transactions.


File: manual.info.tmp,  Node: sql-replication-statements,  Next: sql-prepared-statements,  Prev: sql-transactional-statements,  Up: sql-statements

13.4 Replication Statements
===========================

* Menu:

* replication-statements-master::  SQL Statements for Controlling Master Servers
* replication-statements-slave::  SQL Statements for Controlling Slave Servers

Replication can be controlled through the SQL interface using the
statements described in this section.  One group of statements controls
master servers, the other controls slave servers.


File: manual.info.tmp,  Node: replication-statements-master,  Next: replication-statements-slave,  Prev: sql-replication-statements,  Up: sql-replication-statements

13.4.1 SQL Statements for Controlling Master Servers
----------------------------------------------------

* Menu:

* purge-binary-logs::            PURGE BINARY LOGS Statement
* reset-master::                 RESET MASTER Statement
* set-sql-log-bin::              SET sql_log_bin Statement

This section discusses statements for managing master replication
servers.  *note replication-statements-slave::, discusses statements for
managing slave servers.

In addition to the statements described here, the following *note
'SHOW': show. statements are used with master servers in replication.
For information about these statements, see *note show::.

   * *note 'SHOW BINARY LOGS': show-binary-logs.

   * *note 'SHOW BINLOG EVENTS': show-binlog-events.

   * *note 'SHOW MASTER STATUS': show-master-status.

   * *note 'SHOW SLAVE HOSTS': show-slave-hosts.


File: manual.info.tmp,  Node: purge-binary-logs,  Next: reset-master,  Prev: replication-statements-master,  Up: replication-statements-master

13.4.1.1 PURGE BINARY LOGS Statement
....................................

     PURGE { BINARY | MASTER } LOGS {
         TO 'LOG_NAME'
       | BEFORE DATETIME_EXPR
     }

The binary log is a set of files that contain information about data
modifications made by the MySQL server.  The log consists of a set of
binary log files, plus an index file (see *note binary-log::).

The *note 'PURGE BINARY LOGS': purge-binary-logs. statement deletes all
the binary log files listed in the log index file prior to the specified
log file name or date.  'BINARY' and 'MASTER' are synonyms.  Deleted log
files also are removed from the list recorded in the index file, so that
the given log file becomes the first in the list.

This statement has no effect if the server was not started with the
'--log-bin' option to enable binary logging.

Examples:

     PURGE BINARY LOGS TO 'mysql-bin.010';
     PURGE BINARY LOGS BEFORE '2019-04-02 22:46:26';

The 'BEFORE' variant's DATETIME_EXPR argument should evaluate to a *note
'DATETIME': datetime. value (a value in ''YYYY-MM-DD HH:MM:SS'' format).

This statement is safe to run while slaves are replicating.  You need
not stop them.  If you have an active slave that currently is reading
one of the log files you are trying to delete, this statement does
nothing and fails with an error.  However, if a slave is not connected
and you happen to purge one of the log files it has yet to read, the
slave will be unable to replicate after it reconnects.

To safely purge binary log files, follow this procedure:

  1. On each slave server, use *note 'SHOW SLAVE STATUS':
     show-slave-status. to check which log file it is reading.

  2. Obtain a listing of the binary log files on the master server with
     *note 'SHOW BINARY LOGS': show-binary-logs.

  3. Determine the earliest log file among all the slaves.  This is the
     target file.  If all the slaves are up to date, this is the last
     log file on the list.

  4. Make a backup of all the log files you are about to delete.  (This
     step is optional, but always advisable.)

  5. Purge all log files up to but not including the target file.

You can also set the 'expire_logs_days' system variable to expire binary
log files automatically after a given number of days (see *note
server-system-variables::).  If you are using replication, you should
set the variable no lower than the maximum number of days your slaves
might lag behind the master.

'PURGE BINARY LOGS TO' and 'PURGE BINARY LOGS BEFORE' both fail with an
error when binary log files listed in the '.index' file had been removed
from the system by some other means (such as using 'rm' on Linux).  (Bug
#18199, Bug #18453) To handle such errors, edit the '.index' file (which
is a simple text file) manually to ensure that it lists only the binary
log files that are actually present, then run again the *note 'PURGE
BINARY LOGS': purge-binary-logs. statement that failed.


File: manual.info.tmp,  Node: reset-master,  Next: set-sql-log-bin,  Prev: purge-binary-logs,  Up: replication-statements-master

13.4.1.2 RESET MASTER Statement
...............................

     RESET MASTER

Deletes all binary log files listed in the index file, resets the binary
log index file to be empty, and creates a new binary log file.  This
statement is intended to be used only when the master is started for the
first time.

*Important*:

The effects of *note 'RESET MASTER': reset-master. differ from those of
*note 'PURGE BINARY LOGS': purge-binary-logs. in 2 key ways:

  1. *note 'RESET MASTER': reset-master. removes _all_ binary log files
     that are listed in the index file, leaving only a single, empty
     binary log file with a numeric suffix of '.000001', whereas the
     numbering is not reset by *note 'PURGE BINARY LOGS':
     purge-binary-logs.

  2. *note 'RESET MASTER': reset-master. is _not_ intended to be used
     while any replication slaves are running.  The behavior of *note
     'RESET MASTER': reset-master. when used while slaves are running is
     undefined (and thus unsupported), whereas *note 'PURGE BINARY
     LOGS': purge-binary-logs. may be safely used while replication
     slaves are running.

See also *note purge-binary-logs::.

*note 'RESET MASTER': reset-master. can prove useful when you first set
up the master and the slave, so that you can verify the setup as
follows:

  1. Start the master and slave, and start replication (see *note
     replication-howto::).

  2. Execute a few test queries on the master.

  3. Check that the queries were replicated to the slave.

  4. When replication is running correctly, issue *note 'STOP SLAVE':
     stop-slave. followed by *note 'RESET SLAVE': reset-slave. on the
     slave, then verify that any unwanted data no longer exists on the
     slave.

  5. Issue *note 'RESET MASTER': reset-master. on the master to clean up
     the test queries.

After verifying the setup and getting rid of any unwanted and log files
generated by testing, you can start the slave and begin replicating.


File: manual.info.tmp,  Node: set-sql-log-bin,  Prev: reset-master,  Up: replication-statements-master

13.4.1.3 SET sql_log_bin Statement
..................................

     SET sql_log_bin = {OFF|ON}

The 'sql_log_bin' variable controls whether logging to the binary log is
enabled for the current session (assuming that the binary log itself is
enabled).  The default value is 'ON'.  To disable or enable binary
logging for the current session, set the session 'sql_log_bin' variable
to 'OFF' or 'ON'.

Set this variable to 'OFF' for a session to temporarily disable binary
logging while making changes to the master you do not want replicated to
the slave.

Setting the session value of this system variable is a restricted
operation.  The session user must have privileges sufficient to set
restricted session variables.  See *note system-variable-privileges::.

It is not possible to set the session value of 'sql_log_bin' within a
transaction or subquery.

As of MySQL 5.5.41, the global 'sql_log_bin' variable is read only and
cannot be modified.  The global scope is deprecated and will be removed
in a future MySQL release.  Prior to 5.5.41, 'sql_log_bin' can be set as
a global or session variable.  Setting 'sql_log_bin' globally is only
detected when a new session is started.  Any sessions previously running
are not impacted when setting 'sql_log_bin' globally.

*Warning*:

Incorrect use of 'sql_log_bin' with a global scope means any changes
made in an already running session are _still_ being recorded to the
binary log and therefore replicated.  Exercise extreme caution using
'sql_log_bin' with a global scope as the above situation could cause
unexpected results including replication failure.


File: manual.info.tmp,  Node: replication-statements-slave,  Prev: replication-statements-master,  Up: sql-replication-statements

13.4.2 SQL Statements for Controlling Slave Servers
---------------------------------------------------

* Menu:

* change-master-to::             CHANGE MASTER TO Statement
* master-pos-wait::              MASTER_POS_WAIT() Statement
* reset-slave::                  RESET SLAVE Statement
* set-global-sql-slave-skip-counter::  SET GLOBAL sql_slave_skip_counter Statement
* start-slave::                  START SLAVE Statement
* stop-slave::                   STOP SLAVE Statement

This section discusses statements for managing slave replication
servers.  *note replication-statements-master::, discusses statements
for managing master servers.

In addition to the statements described here, *note 'SHOW SLAVE STATUS':
show-slave-status. and *note 'SHOW RELAYLOG EVENTS':
show-relaylog-events. are also used with replication slaves.  For
information about these statements, see *note show-slave-status::, and
*note show-relaylog-events::.


File: manual.info.tmp,  Node: change-master-to,  Next: master-pos-wait,  Prev: replication-statements-slave,  Up: replication-statements-slave

13.4.2.1 CHANGE MASTER TO Statement
...................................

     CHANGE MASTER TO OPTION [, OPTION] ...

     OPTION:
         MASTER_BIND = 'INTERFACE_NAME'
       | MASTER_HOST = 'HOST_NAME'
       | MASTER_USER = 'USER_NAME'
       | MASTER_PASSWORD = 'PASSWORD'
       | MASTER_PORT = PORT_NUM
       | MASTER_CONNECT_RETRY = INTERVAL
       | MASTER_HEARTBEAT_PERIOD = INTERVAL
       | MASTER_LOG_FILE = 'MASTER_LOG_NAME'
       | MASTER_LOG_POS = MASTER_LOG_POS
       | RELAY_LOG_FILE = 'RELAY_LOG_NAME'
       | RELAY_LOG_POS = RELAY_LOG_POS
       | MASTER_SSL = {0|1}
       | MASTER_SSL_CA = 'CA_FILE_NAME'
       | MASTER_SSL_CAPATH = 'CA_DIRECTORY_NAME'
       | MASTER_SSL_CERT = 'CERT_FILE_NAME'
       | MASTER_SSL_KEY = 'KEY_FILE_NAME'
       | MASTER_SSL_CIPHER = 'CIPHER_LIST'
       | MASTER_SSL_VERIFY_SERVER_CERT = {0|1}
       | IGNORE_SERVER_IDS = (SERVER_ID_LIST)

     SERVER_ID_LIST:
         [SERVER_ID [, SERVER_ID] ... ]

*note 'CHANGE MASTER TO': change-master-to. changes the parameters that
the slave server uses for connecting to the master server, for reading
the master binary log, and reading the slave relay log.  It also updates
the contents of the 'master.info' and 'relay-log.info' files.  *note
'CHANGE MASTER TO': change-master-to. requires the 'SUPER' privilege.

To use *note 'CHANGE MASTER TO': change-master-to, the slave replication
threads must be stopped (use *note 'STOP SLAVE': stop-slave. if
necessary).

Options not specified retain their value, except as indicated in the
following discussion.  Thus, in most cases, there is no need to specify
options that do not change.  For example, if the password to connect to
your MySQL master has changed, you just need to issue these statements
to tell the slave about the new password:

     STOP SLAVE; -- if replication was running
     CHANGE MASTER TO MASTER_PASSWORD='new3cret';
     START SLAVE; -- if you want to restart replication

'MASTER_HOST', 'MASTER_USER', 'MASTER_PASSWORD', and 'MASTER_PORT'
provide information to the slave about how to connect to its master:

   * 'MASTER_HOST' and 'MASTER_PORT' are the host name (or IP address)
     of the master host and its TCP/IP port.

     *Note*:

     Replication cannot use Unix socket files.  You must be able to
     connect to the master MySQL server using TCP/IP.

     If you specify the 'MASTER_HOST' or 'MASTER_PORT' option, the slave
     assumes that the master server is different from before (even if
     the option value is the same as its current value.)  In this case,
     the old values for the master binary log file name and position are
     considered no longer applicable, so if you do not specify
     'MASTER_LOG_FILE' and 'MASTER_LOG_POS' in the statement,
     'MASTER_LOG_FILE=''' and 'MASTER_LOG_POS=4' are silently appended
     to it.

     Setting 'MASTER_HOST=''' (that is, setting its value explicitly to
     an empty string) is _not_ the same as not setting 'MASTER_HOST' at
     all.  Beginning with MySQL 5.5, trying to set 'MASTER_HOST' to an
     empty string fails with an error.  Previously, setting
     'MASTER_HOST' to an empty string caused *note 'START SLAVE':
     start-slave. subsequently to fail.  (Bug #28796)

   * 'MASTER_USER' and 'MASTER_PASSWORD' are the user name and password
     of the account to use for connecting to the master.

     In MySQL 5.5.20 and later, 'MASTER_USER' cannot be made empty;
     setting 'MASTER_USER = ''' or leaving it unset when setting a value
     for 'MASTER_PASSWORD' causes an error (Bug #13427949).

     The password used for a MySQL Replication slave account in a
     'CHANGE MASTER TO' statement is limited to 32 characters in length;
     if the password is longer, the statement succeeds, but any excess
     characters are silently truncated.  This is an issue specific to
     MySQL Replication, which is fixed in MySQL 5.7.  (Bug #11752299,
     Bug #43439)

     The text of a running *note 'CHANGE MASTER TO': change-master-to.
     statement, including values for 'MASTER_USER' and
     'MASTER_PASSWORD', can be seen in the output of a concurrent *note
     'SHOW PROCESSLIST': show-processlist. statement.

The 'MASTER_SSL_XXX' options provide information about using SSL for the
connection.  They correspond to the '--ssl-XXX' options described in
*note encrypted-connection-options::, and *note
replication-solutions-encrypted-connections::.  These options can be
changed even on slaves that are compiled without SSL support.  They are
saved to the 'master.info' file, but are ignored if the slave does not
have SSL support enabled.

'MASTER_CONNECT_RETRY' specifies how many seconds to wait between
connect retries.  The default is 60.  The _number_ of reconnection
attempts is limited by the '--master-retry-count' server option; for
more information, see *note replication-options::.

The 'MASTER_BIND' option is available in MySQL NDB Cluster 7.2 and
later, but is not supported in mainline MySQL 5.5.

'MASTER_BIND' is for use on replication slaves having multiple network
interfaces, and determines which of the slave's network interfaces is
chosen for connecting to the master.

'MASTER_HEARTBEAT_PERIOD' sets the interval in seconds between
replication heartbeats.  Whenever the master's binary log is updated
with an event, the waiting period for the next heartbeat is reset.
INTERVAL is a decimal value having the range 0 to 4294967 seconds and a
resolution in milliseconds; the smallest nonzero value is 0.001.
Heartbeats are sent by the master only if there are no unsent events in
the binary log file for a period longer than INTERVAL.

Setting INTERVAL to 0 disables heartbeats altogether.  The default value
for INTERVAL is equal to the value of 'slave_net_timeout' divided by 2.

Setting '@@GLOBAL.slave_net_timeout' to a value less than that of the
current heartbeat interval results in a warning being issued.  The
effect of issuing *note 'RESET SLAVE': reset-slave. on the heartbeat
interval is to reset it to the default value.

'MASTER_LOG_FILE' and 'MASTER_LOG_POS' are the coordinates at which the
slave I/O thread should begin reading from the master the next time the
thread starts.  'RELAY_LOG_FILE' and 'RELAY_LOG_POS' are the coordinates
at which the slave SQL thread should begin reading from the relay log
the next time the thread starts.  If you specify either of
'MASTER_LOG_FILE' or 'MASTER_LOG_POS', you cannot specify
'RELAY_LOG_FILE' or 'RELAY_LOG_POS'.  If neither of 'MASTER_LOG_FILE' or
'MASTER_LOG_POS' is specified, the slave uses the last coordinates of
the _slave SQL thread_ before *note 'CHANGE MASTER TO':
change-master-to. was issued.  This ensures that there is no
discontinuity in replication, even if the slave SQL thread was late
compared to the slave I/O thread, when you merely want to change, say,
the password to use.

*note 'CHANGE MASTER TO': change-master-to. _deletes all relay log
files_ and starts a new one, unless you specify 'RELAY_LOG_FILE' or
'RELAY_LOG_POS'.  In that case, relay log files are kept; the
'relay_log_purge' global variable is set silently to 0.

Prior to MySQL 5.5, 'RELAY_LOG_FILE' required an absolute path.  In
MySQL 5.5, the path can be relative, in which case the path is assumed
to be relative to the slave's data directory.  (Bug #12190)

'IGNORE_SERVER_IDS' was added in MySQL 5.5.  This option takes a
comma-separated list of 0 or more server IDs.  Events originating from
the corresponding servers are ignored, with the exception of log
rotation and deletion events, which are still recorded in the relay log.

In circular replication, the originating server normally acts as the
terminator of its own events, so that they are not applied more than
once.  Thus, this option is useful in circular replication when one of
the servers in the circle is removed.  Suppose that you have a circular
replication setup with 4 servers, having server IDs 1, 2, 3, and 4, and
server 3 fails.  When bridging the gap by starting replication from
server 2 to server 4, you can include 'IGNORE_SERVER_IDS = (3)' in the
'CHANGE MASTER TO' statement that you issue on server 4 to tell it to
use server 2 as its master instead of server 3.  Doing so causes it to
ignore and not to propagate any statements that originated with the
server that is no longer in use.

When a 'CHANGE MASTER TO' statement is issued without any
'IGNORE_SERVER_IDS' option, any existing list is preserved.  To clear
the list of ignored servers, it is necessary to use the option with an
empty list:

     CHANGE MASTER TO IGNORE_SERVER_IDS = ();

*note 'RESET SLAVE ALL': reset-slave. has no effect on the server ID
list.  This issue is fixed in MySQL 5.7.  (Bug #18816897)

If 'IGNORE_SERVER_IDS' contains the server's own ID and the server was
started with the '--replicate-same-server-id' option enabled, an error
results.

Also beginning with MySQL 5.5, the 'master.info' file and the output of
*note 'SHOW SLAVE STATUS': show-slave-status. are extended to provide
the list of servers that are currently ignored.  For more information,
see *note slave-logs-status::, and *note show-slave-status::.

Beginning with MySQL 5.5.5, invoking *note 'CHANGE MASTER TO':
change-master-to. causes the previous values for 'MASTER_HOST',
'MASTER_PORT', 'MASTER_LOG_FILE', and 'MASTER_LOG_POS' to be written to
the error log, along with other information about the slave's state
prior to execution.

*note 'CHANGE MASTER TO': change-master-to. is useful for setting up a
slave when you have the snapshot of the master and have recorded the
master binary log coordinates corresponding to the time of the snapshot.
After loading the snapshot into the slave to synchronize it with the
master, you can run 'CHANGE MASTER TO MASTER_LOG_FILE='LOG_NAME',
MASTER_LOG_POS=LOG_POS' on the slave to specify the coordinates at which
the slave should begin reading the master binary log.

The following example changes the master server the slave uses and
establishes the master binary log coordinates from which the slave
begins reading.  This is used when you want to set up the slave to
replicate the master:

     CHANGE MASTER TO
       MASTER_HOST='master2.example.com',
       MASTER_USER='replication',
       MASTER_PASSWORD='bigs3cret',
       MASTER_PORT=3306,
       MASTER_LOG_FILE='master2-bin.001',
       MASTER_LOG_POS=4,
       MASTER_CONNECT_RETRY=10;

The next example shows an operation that is less frequently employed.
It is used when the slave has relay log files that you want it to
execute again for some reason.  To do this, the master need not be
reachable.  You need only use *note 'CHANGE MASTER TO':
change-master-to. and start the SQL thread ('START SLAVE SQL_THREAD'):

     CHANGE MASTER TO
       RELAY_LOG_FILE='slave-relay-bin.006',
       RELAY_LOG_POS=4025;

The following table shows the maximum permissible length for the
string-valued options.

Option                               Maximum Length
                                     
'MASTER_HOST'                        60
                                     
'MASTER_USER'                        16
                                     
'MASTER_PASSWORD'                    32
                                     
'MASTER_LOG_FILE'                    255
                                     
'RELAY_LOG_FILE'                     255
                                     
'MASTER_SSL_CA'                      255
                                     
'MASTER_SSL_CAPATH'                  255
                                     
'MASTER_SSL_CERT'                    255
                                     
'MASTER_SSL_KEY'                     255
                                     
'MASTER_SSL_CIPHER'                  511


File: manual.info.tmp,  Node: master-pos-wait,  Next: reset-slave,  Prev: change-master-to,  Up: replication-statements-slave

13.4.2.2 MASTER_POS_WAIT() Statement
....................................

     SELECT MASTER_POS_WAIT('MASTER_LOG_FILE', MASTER_LOG_POS [, TIMEOUT])

This is actually a function, not a statement.  It is used to ensure that
the slave has read and executed events up to a given position in the
master's binary log.  See *note miscellaneous-functions::, for a full
description.


File: manual.info.tmp,  Node: reset-slave,  Next: set-global-sql-slave-skip-counter,  Prev: master-pos-wait,  Up: replication-statements-slave

13.4.2.3 RESET SLAVE Statement
..............................

     RESET SLAVE [ALL]

*note 'RESET SLAVE': reset-slave. makes the slave forget its replication
position in the master's binary log.  This statement is meant to be used
for a clean start: It deletes the 'master.info' and 'relay-log.info'
files, all the relay log files, and starts a new relay log file.  To use
*note 'RESET SLAVE': reset-slave, the slave replication threads must be
stopped (use *note 'STOP SLAVE': stop-slave. if necessary).

*Note*:

All relay log files are deleted, even if they have not been completely
executed by the slave SQL thread.  (This is a condition likely to exist
on a replication slave if you have issued a *note 'STOP SLAVE':
stop-slave. statement or if the slave is highly loaded.)

In MySQL 5.5 (unlike the case in MySQL 5.1 and earlier), *note 'RESET
SLAVE': reset-slave. does not change any replication connection
parameters such as master host, master port, master user, or master
password, which are retained in memory.  This means that *note 'START
SLAVE': start-slave. can be issued without requiring a *note 'CHANGE
MASTER TO': change-master-to. statement following *note 'RESET SLAVE':
reset-slave.

Connection parameters are reset if the slave *note 'mysqld': mysqld. is
shut down following 'RESET SLAVE'.  In MySQL 5.5.16 and later, you can
instead use 'RESET SLAVE ALL' to reset these connection parameters (Bug
#11809016).

'RESET SLAVE ALL' does not clear the 'IGNORE_SERVER_IDS' list set by
*note 'CHANGE MASTER TO': change-master-to.  This issue is fixed in
MySQL 5.7.  (Bug #18816897)

If the slave SQL thread was in the middle of replicating temporary
tables when it was stopped, and *note 'RESET SLAVE': reset-slave. is
issued, these replicated temporary tables are deleted on the slave.

*Note*:

When used on an NDB Cluster replication slave SQL node, 'RESET SLAVE'
clears the 'mysql.ndb_apply_status table'.  You should keep in mind when
using this statement that 'ndb_apply_status' uses the *note 'NDB':
mysql-cluster. storage engine and so is shared by all SQL nodes attached
to the slave cluster.


File: manual.info.tmp,  Node: set-global-sql-slave-skip-counter,  Next: start-slave,  Prev: reset-slave,  Up: replication-statements-slave

13.4.2.4 SET GLOBAL sql_slave_skip_counter Statement
....................................................

     SET GLOBAL sql_slave_skip_counter = N

This statement skips the next N events from the master.  This is useful
for recovering from replication stops caused by a statement.

This statement is valid only when the slave threads are not running.
Otherwise, it produces an error.

When using this statement, it is important to understand that the binary
log is actually organized as a sequence of groups known as _event
groups_.  Each event group consists of a sequence of events.

   * For transactional tables, an event group corresponds to a
     transaction.

   * For nontransactional tables, an event group corresponds to a single
     SQL statement.

*Note*:

A single transaction can contain changes to both transactional and
nontransactional tables.

When you use *note 'SET GLOBAL sql_slave_skip_counter':
set-global-sql-slave-skip-counter. to skip events and the result is in
the middle of a group, the slave continues to skip events until it
reaches the end of the group.  Execution then starts with the next event
group.


File: manual.info.tmp,  Node: start-slave,  Next: stop-slave,  Prev: set-global-sql-slave-skip-counter,  Up: replication-statements-slave

13.4.2.5 START SLAVE Statement
..............................

     START SLAVE [THREAD_TYPES]

     START SLAVE [SQL_THREAD] UNTIL
         MASTER_LOG_FILE = 'LOG_NAME', MASTER_LOG_POS = LOG_POS

     START SLAVE [SQL_THREAD] UNTIL
         RELAY_LOG_FILE = 'LOG_NAME', RELAY_LOG_POS = LOG_POS

     THREAD_TYPES:
         [THREAD_TYPE [, THREAD_TYPE] ... ]

     THREAD_TYPE: IO_THREAD | SQL_THREAD

*note 'START SLAVE': start-slave. with no THREAD_TYPE options starts
both of the slave threads.  The I/O thread reads events from the master
server and stores them in the relay log.  The SQL thread reads events
from the relay log and executes them.  *note 'START SLAVE': start-slave.
requires the 'SUPER' privilege.

If *note 'START SLAVE': start-slave. succeeds in starting the slave
threads, it returns without any error.  However, even in that case, it
might be that the slave threads start and then later stop (for example,
because they do not manage to connect to the master or read its binary
log, or some other problem).  *note 'START SLAVE': start-slave. does not
warn you about this.  You must check the slave's error log for error
messages generated by the slave threads, or check that they are running
satisfactorily with *note 'SHOW SLAVE STATUS': show-slave-status.

*note 'START SLAVE': start-slave. sends an acknowledgment to the user
after both the I/O thread and the SQL thread have started.  However, the
I/O thread may not yet have connected.  For this reason, a successful
*note 'START SLAVE': start-slave. causes *note 'SHOW SLAVE STATUS':
show-slave-status. to show 'Slave_SQL_Running=Yes', but this does not
guarantee that 'Slave_IO_Running=Yes' (because 'Slave_IO_Running=Yes'
only if the I/O thread is running _and connected_).  For more
information, see *note show-slave-status::, and *note
replication-administration-status::.

You can add 'IO_THREAD' and 'SQL_THREAD' options to the statement to
name which of the threads to start.

An 'UNTIL' clause may be added to specify that the slave should start
and run until the SQL thread reaches a given point in the master binary
log or in the slave relay log.  When the SQL thread reaches that point,
it stops.  If the 'SQL_THREAD' option is specified in the statement, it
starts only the SQL thread.  Otherwise, it starts both slave threads.
If the SQL thread is running, the 'UNTIL' clause is ignored and a
warning is issued.

For an 'UNTIL' clause, you must specify both a log file name and
position.  Do not mix master and relay log options.

Any 'UNTIL' condition is reset by a subsequent *note 'STOP SLAVE':
stop-slave. statement, a *note 'START SLAVE': start-slave. statement
that includes no 'UNTIL' clause, or a server restart.

The 'UNTIL' clause can be useful for debugging replication, or to cause
replication to proceed until just before the point where you want to
avoid having the slave replicate an event.  For example, if an unwise
*note 'DROP TABLE': drop-table. statement was executed on the master,
you can use 'UNTIL' to tell the slave to execute up to that point but no
farther.  To find what the event is, use *note 'mysqlbinlog':
mysqlbinlog. with the master binary log or slave relay log, or by using
a *note 'SHOW BINLOG EVENTS': show-binlog-events. statement.

If you are using 'UNTIL' to have the slave process replicated queries in
sections, it is recommended that you start the slave with the
'--skip-slave-start' option to prevent the SQL thread from running when
the slave server starts.  It is probably best to use this option in an
option file rather than on the command line, so that an unexpected
server restart does not cause it to be forgotten.

The *note 'SHOW SLAVE STATUS': show-slave-status. statement includes
output fields that display the current values of the 'UNTIL' condition.

In old versions of MySQL (before 4.0.5), this statement was called
'SLAVE START'.  This usage is still accepted in MySQL 5.5 for backward
compatibility, but is deprecated and is removed in MySQL 5.6.


File: manual.info.tmp,  Node: stop-slave,  Prev: start-slave,  Up: replication-statements-slave

13.4.2.6 STOP SLAVE Statement
.............................

     STOP SLAVE [THREAD_TYPES]

     THREAD_TYPES:
         [THREAD_TYPE [, THREAD_TYPE] ... ]

     THREAD_TYPE: IO_THREAD | SQL_THREAD

Stops the slave threads.  *note 'STOP SLAVE': stop-slave. requires the
'SUPER' privilege.  Recommended best practice is to execute 'STOP SLAVE'
on the slave before stopping the slave server (see *note
server-shutdown::, for more information).

_When using the row-based logging format_: You should execute 'STOP
SLAVE' on the slave prior to shutting down the slave server if you are
replicating any tables that use a nontransactional storage engine (see
the 'Note' later in this section).  In MySQL 5.5.9 and later, you can
also use 'STOP SLAVE SQL_THREAD' for this purpose.

Like *note 'START SLAVE': start-slave, this statement may be used with
the 'IO_THREAD' and 'SQL_THREAD' options to name the thread or threads
to be stopped.

If the current replication event group has modified one or more
nontransactional tables, STOP SLAVE waits for up to 60 seconds for the
event group to complete, unless you issue a *note 'KILL QUERY': kill. or
*note 'KILL CONNECTION': kill. statement for the slave SQL thread.  If
the event group remains incomplete after the timeout, an error message
is logged.  (Bug #319, Bug #38205)

In old versions of MySQL (before 4.0.5), this statement was called
'SLAVE STOP'.  This usage is still accepted in MySQL 5.5 for backward
compatibility, but is deprecated and is removed in MySQL 5.6.


File: manual.info.tmp,  Node: sql-prepared-statements,  Next: sql-compound-statements,  Prev: sql-replication-statements,  Up: sql-statements

13.5 Prepared Statements
========================

* Menu:

* prepare::                      PREPARE Statement
* execute::                      EXECUTE Statement
* deallocate-prepare::           DEALLOCATE PREPARE Statement
* statement-repreparation::      Automatic Prepared Statement Repreparation

MySQL 5.5 provides support for server-side prepared statements.  This
support takes advantage of the efficient client/server binary protocol,
provided that you use an appropriate client programming interface.
Candidate interfaces include the MySQL C API client library (for C
programs), MySQL Connector/J (for Java programs), and MySQL
Connector/NET. For example, the C API provides a set of function calls
that make up its prepared statement API. See *note
c-api-prepared-statements::.  Other language interfaces can provide
support for prepared statements that use the binary protocol by linking
in the C client library, one example being the 'mysqli' extension
(http://php.net/mysqli), available in PHP 5.0 and later.

An alternative SQL interface to prepared statements is available.  This
interface is not as efficient as using the binary protocol through a
prepared statement API, but requires no programming because it is
available directly at the SQL level:

   * You can use it when no programming interface is available to you.

   * You can use it from any program that enables you to send SQL
     statements to the server to be executed, such as the *note 'mysql':
     mysql. client program.

   * You can use it even if the client is using an old version of the
     client library.  The only requirement is that you be able to
     connect to a server that is recent enough to support SQL syntax for
     prepared statements.

SQL syntax for prepared statements is intended to be used for situations
such as these:

   * You want to test how prepared statements work in your application
     before coding it.

   * An application has problems executing prepared statements and you
     want to determine interactively what the problem is.

   * You want to create a test case that describes a problem you are
     having with prepared statements, so that you can file a bug report.

   * You need to use prepared statements but do not have access to a
     programming API that supports them.

SQL syntax for prepared statements is based on three SQL statements:

   * *note 'PREPARE': prepare. prepares a statement for execution (see
     *note prepare::).

   * *note 'EXECUTE': execute. executes a prepared statement (see *note
     execute::).

   * *note 'DEALLOCATE PREPARE': deallocate-prepare. releases a prepared
     statement (see *note deallocate-prepare::).

The following examples show two equivalent ways of preparing a statement
that computes the hypotenuse of a triangle given the lengths of the two
sides.

The first example shows how to create a prepared statement by using a
string literal to supply the text of the statement:

     mysql> PREPARE stmt1 FROM 'SELECT SQRT(POW(?,2) + POW(?,2)) AS hypotenuse';
     mysql> SET @a = 3;
     mysql> SET @b = 4;
     mysql> EXECUTE stmt1 USING @a, @b;
     +------------+
     | hypotenuse |
     +------------+
     |          5 |
     +------------+
     mysql> DEALLOCATE PREPARE stmt1;

The second example is similar, but supplies the text of the statement as
a user variable:

     mysql> SET @s = 'SELECT SQRT(POW(?,2) + POW(?,2)) AS hypotenuse';
     mysql> PREPARE stmt2 FROM @s;
     mysql> SET @a = 6;
     mysql> SET @b = 8;
     mysql> EXECUTE stmt2 USING @a, @b;
     +------------+
     | hypotenuse |
     +------------+
     |         10 |
     +------------+
     mysql> DEALLOCATE PREPARE stmt2;

Here is an additional example that demonstrates how to choose the table
on which to perform a query at runtime, by storing the name of the table
as a user variable:

     mysql> USE test;
     mysql> CREATE TABLE t1 (a INT NOT NULL);
     mysql> INSERT INTO t1 VALUES (4), (8), (11), (32), (80);

     mysql> SET @table = 't1';
     mysql> SET @s = CONCAT('SELECT * FROM ', @table);

     mysql> PREPARE stmt3 FROM @s;
     mysql> EXECUTE stmt3;
     +----+
     | a  |
     +----+
     |  4 |
     |  8 |
     | 11 |
     | 32 |
     | 80 |
     +----+

     mysql> DEALLOCATE PREPARE stmt3;

A prepared statement is specific to the session in which it was created.
If you terminate a session without deallocating a previously prepared
statement, the server deallocates it automatically.

A prepared statement is also global to the session.  If you create a
prepared statement within a stored routine, it is not deallocated when
the stored routine ends.

To guard against too many prepared statements being created
simultaneously, set the 'max_prepared_stmt_count' system variable.  To
prevent the use of prepared statements, set the value to 0.

The following SQL statements can be used as prepared statements:

     ALTER TABLE
     ANALYZE TABLE
     CACHE INDEX
     CALL
     CHANGE MASTER
     CHECKSUM {TABLE | TABLES}
     COMMIT
     {CREATE | RENAME | DROP} DATABASE
     {CREATE | DROP} INDEX
     {CREATE | RENAME | DROP} TABLE
     {CREATE | RENAME | DROP} USER
     {CREATE | DROP} VIEW
     DELETE
     DO
     FLUSH {TABLE | TABLES | TABLES WITH READ LOCK | HOSTS | PRIVILEGES
       | LOGS | STATUS | MASTER | SLAVE | DES_KEY_FILE | USER_RESOURCES}
     GRANT
     INSERT
     INSTALL PLUGIN
     KILL
     LOAD INDEX INTO CACHE
     OPTIMIZE TABLE
     REPAIR TABLE
     REPLACE
     RESET {MASTER | SLAVE | QUERY CACHE}
     REVOKE
     SELECT
     SET
     SHOW {AUTHORS | CONTRIBUTORS | WARNINGS | ERRORS}
     SHOW BINLOG EVENTS
     SHOW CREATE {PROCEDURE | FUNCTION | EVENT | TABLE | VIEW}
     SHOW {MASTER | BINARY} LOGS
     SHOW {MASTER | SLAVE} STATUS
     SLAVE {START | STOP}
     TRUNCATE TABLE
     UNINSTALL PLUGIN
     UPDATE

Other statements are not supported in MySQL 5.5.

Generally, statements not permitted in SQL prepared statements are also
not permitted in stored programs.  Exceptions are noted in *note
stored-program-restrictions::.

Metadata changes to tables or views referred to by prepared statements
are detected and cause automatic repreparation of the statement when it
is next executed.  For more information, see *note
statement-repreparation::.

Placeholders can be used for the arguments of the 'LIMIT' clause when
using prepared statements.  See *note select::.

In prepared *note 'CALL': call. statements used with *note 'PREPARE':
prepare. and *note 'EXECUTE': execute, placeholder support for 'OUT' and
'INOUT' parameters is available beginning with MySQL 5.5.  See *note
call::, for an example and a workaround for earlier versions.
Placeholders can be used for 'IN' parameters regardless of version.

SQL syntax for prepared statements cannot be used in nested fashion.
That is, a statement passed to *note 'PREPARE': prepare. cannot itself
be a *note 'PREPARE': prepare, *note 'EXECUTE': execute, or *note
'DEALLOCATE PREPARE': deallocate-prepare. statement.

SQL syntax for prepared statements is distinct from using prepared
statement API calls.  For example, you cannot use the *note
'mysql_stmt_prepare()': mysql-stmt-prepare. C API function to prepare a
*note 'PREPARE': prepare, *note 'EXECUTE': execute, or *note 'DEALLOCATE
PREPARE': deallocate-prepare. statement.

SQL syntax for prepared statements can be used within stored procedures,
but not in stored functions or triggers.  However, a cursor cannot be
used for a dynamic statement that is prepared and executed with *note
'PREPARE': prepare. and *note 'EXECUTE': execute.  The statement for a
cursor is checked at cursor creation time, so the statement cannot be
dynamic.

SQL syntax for prepared statements does not support multi-statements
(that is, multiple statements within a single string separated by ';'
characters).

Prepared statements use the query cache under the conditions described
in *note query-cache-operation::.

To write C programs that use the *note 'CALL': call. SQL statement to
execute stored procedures that contain prepared statements, the
'CLIENT_MULTI_RESULTS' flag must be enabled.  This is because each *note
'CALL': call. returns a result to indicate the call status, in addition
to any result sets that might be returned by statements executed within
the procedure.

'CLIENT_MULTI_RESULTS' can be enabled when you call *note
'mysql_real_connect()': mysql-real-connect, either explicitly by passing
the 'CLIENT_MULTI_RESULTS' flag itself, or implicitly by passing
'CLIENT_MULTI_STATEMENTS' (which also enables 'CLIENT_MULTI_RESULTS').
For additional information, see *note call::.


File: manual.info.tmp,  Node: prepare,  Next: execute,  Prev: sql-prepared-statements,  Up: sql-prepared-statements

13.5.1 PREPARE Statement
------------------------

     PREPARE STMT_NAME FROM PREPARABLE_STMT

The *note 'PREPARE': prepare. statement prepares a SQL statement and
assigns it a name, STMT_NAME, by which to refer to the statement later.
The prepared statement is executed with *note 'EXECUTE': execute. and
released with *note 'DEALLOCATE PREPARE': deallocate-prepare.  For
examples, see *note sql-prepared-statements::.

Statement names are not case-sensitive.  PREPARABLE_STMT is either a
string literal or a user variable that contains the text of the SQL
statement.  The text must represent a single statement, not multiple
statements.  Within the statement, '?' characters can be used as
parameter markers to indicate where data values are to be bound to the
query later when you execute it.  The '?' characters should not be
enclosed within quotation marks, even if you intend to bind them to
string values.  Parameter markers can be used only where data values
should appear, not for SQL keywords, identifiers, and so forth.

If a prepared statement with the given name already exists, it is
deallocated implicitly before the new statement is prepared.  This means
that if the new statement contains an error and cannot be prepared, an
error is returned and no statement with the given name exists.

The scope of a prepared statement is the session within which it is
created, which as several implications:

   * A prepared statement created in one session is not available to
     other sessions.

   * When a session ends, whether normally or abnormally, its prepared
     statements no longer exist.  If auto-reconnect is enabled, the
     client is not notified that the connection was lost.  For this
     reason, clients may wish to disable auto-reconnect.  See *note
     c-api-auto-reconnect::.

   * A prepared statement created within a stored program continues to
     exist after the program finishes executing and can be executed
     outside the program later.

   * A statement prepared in stored program context cannot refer to
     stored procedure or function parameters or local variables because
     they go out of scope when the program ends and would be unavailable
     were the statement to be executed later outside the program.  As a
     workaround, refer instead to user-defined variables, which also
     have session scope; see *note user-variables::.


File: manual.info.tmp,  Node: execute,  Next: deallocate-prepare,  Prev: prepare,  Up: sql-prepared-statements

13.5.2 EXECUTE Statement
------------------------

     EXECUTE STMT_NAME
         [USING @VAR_NAME [, @VAR_NAME] ...]

After preparing a statement with *note 'PREPARE': prepare, you execute
it with an *note 'EXECUTE': execute. statement that refers to the
prepared statement name.  If the prepared statement contains any
parameter markers, you must supply a 'USING' clause that lists user
variables containing the values to be bound to the parameters.
Parameter values can be supplied only by user variables, and the 'USING'
clause must name exactly as many variables as the number of parameter
markers in the statement.

You can execute a given prepared statement multiple times, passing
different variables to it or setting the variables to different values
before each execution.

For examples, see *note sql-prepared-statements::.


File: manual.info.tmp,  Node: deallocate-prepare,  Next: statement-repreparation,  Prev: execute,  Up: sql-prepared-statements

13.5.3 DEALLOCATE PREPARE Statement
-----------------------------------

     {DEALLOCATE | DROP} PREPARE STMT_NAME

To deallocate a prepared statement produced with *note 'PREPARE':
prepare, use a *note 'DEALLOCATE PREPARE': deallocate-prepare. statement
that refers to the prepared statement name.  Attempting to execute a
prepared statement after deallocating it results in an error.

For examples, see *note sql-prepared-statements::.


File: manual.info.tmp,  Node: statement-repreparation,  Prev: deallocate-prepare,  Up: sql-prepared-statements

13.5.4 Automatic Prepared Statement Repreparation
-------------------------------------------------

Metadata changes to tables or views referred to by prepared statements
are detected and cause automatic repreparation of the statement when it
is next executed.  This applies to prepared statements processed at the
SQL level (using the *note 'PREPARE': prepare. statement) and those
processed using the binary client/server protocol (using the *note
'mysql_stmt_prepare()': mysql-stmt-prepare. C API function).

The server attempts repreparation up to three times.  An error occurs if
all attempts fail.

Metadata changes occur for DDL statements such as those that create,
drop, alter, rename, or truncate tables, or that analyze, optimize, or
repair tables.  Repreparation also occurs after referenced tables or
views are flushed from the table definition cache, either implicitly to
make room for new entries in the cache, or explicitly due to 'FLUSH
TABLES'.

Table content changes (for example, with *note 'INSERT': insert. or
*note 'UPDATE': update.) do not cause repreparation, nor do *note
'SELECT': select. statements.

Repreparation is automatic, but to the extent that it occurs, diminishes
prepared statement performance.

Repreparation uses the default database and SQL mode that were in effect
for the original preparation.

The 'Com_stmt_reprepare' status variable tracks the number of
repreparations.


File: manual.info.tmp,  Node: sql-compound-statements,  Next: sql-server-administration-statements,  Prev: sql-prepared-statements,  Up: sql-statements

13.6 Compound-Statements
========================

* Menu:

* begin-end::                    BEGIN ... END Compound Statement
* statement-labels::             Statement Labels
* declare::                      DECLARE Statements
* stored-program-variables::     Variables in Stored Programs
* flow-control-statements::      Flow Control Statements
* cursors::                      Cursors
* condition-handling::           Condition Handling

This section describes the syntax for the *note 'BEGIN ... END':
begin-end. compound statement and other statements that can be used in
the body of stored programs: Stored procedures and functions, triggers,
and events.  These objects are defined in terms of SQL code that is
stored on the server for later invocation (see *note stored-objects::).

A compound statement is a block that can contain other blocks;
declarations for variables, condition handlers, and cursors; and flow
control constructs such as loops and conditional tests.


File: manual.info.tmp,  Node: begin-end,  Next: statement-labels,  Prev: sql-compound-statements,  Up: sql-compound-statements

13.6.1 BEGIN ... END Compound Statement
---------------------------------------

     [BEGIN_LABEL:] BEGIN
         [STATEMENT_LIST]
     END [END_LABEL]

*note 'BEGIN ... END': begin-end. syntax is used for writing compound
statements, which can appear within stored programs (stored procedures
and functions, triggers, and events).  A compound statement can contain
multiple statements, enclosed by the 'BEGIN' and 'END' keywords.
STATEMENT_LIST represents a list of one or more statements, each
terminated by a semicolon (';') statement delimiter.  The STATEMENT_LIST
itself is optional, so the empty compound statement ('BEGIN END') is
legal.

*note 'BEGIN ... END': begin-end. blocks can be nested.

Use of multiple statements requires that a client is able to send
statement strings containing the ';' statement delimiter.  In the *note
'mysql': mysql. command-line client, this is handled with the
'delimiter' command.  Changing the ';' end-of-statement delimiter (for
example, to '//') permit ';' to be used in a program body.  For an
example, see *note stored-programs-defining::.

A *note 'BEGIN ... END': begin-end. block can be labeled.  See *note
statement-labels::.

The optional '[NOT] ATOMIC' clause is not supported.  This means that no
transactional savepoint is set at the start of the instruction block and
the 'BEGIN' clause used in this context has no effect on the current
transaction.

*Note*:

Within all stored programs, the parser treats *note 'BEGIN [WORK]':
commit. as the beginning of a *note 'BEGIN ... END': begin-end. block.
To begin a transaction in this context, use *note 'START TRANSACTION':
commit. instead.


File: manual.info.tmp,  Node: statement-labels,  Next: declare,  Prev: begin-end,  Up: sql-compound-statements

13.6.2 Statement Labels
-----------------------

     [BEGIN_LABEL:] BEGIN
         [STATEMENT_LIST]
     END [END_LABEL]

     [BEGIN_LABEL:] LOOP
         STATEMENT_LIST
     END LOOP [END_LABEL]

     [BEGIN_LABEL:] REPEAT
         STATEMENT_LIST
     UNTIL SEARCH_CONDITION
     END REPEAT [END_LABEL]

     [BEGIN_LABEL:] WHILE SEARCH_CONDITION DO
         STATEMENT_LIST
     END WHILE [END_LABEL]

Labels are permitted for *note 'BEGIN ... END': begin-end. blocks and
for the *note 'LOOP': loop, *note 'REPEAT': repeat, and *note 'WHILE':
while. statements.  Label use for those statements follows these rules:

   * BEGIN_LABEL must be followed by a colon.

   * BEGIN_LABEL can be given without END_LABEL.  If END_LABEL is
     present, it must be the same as BEGIN_LABEL.

   * END_LABEL cannot be given without BEGIN_LABEL.

   * Labels at the same nesting level must be distinct.

   * Labels can be up to 16 characters long.

To refer to a label within the labeled construct, use an *note
'ITERATE': iterate. or *note 'LEAVE': leave. statement.  The following
example uses those statements to continue iterating or terminate the
loop:

     CREATE PROCEDURE doiterate(p1 INT)
     BEGIN
       label1: LOOP
         SET p1 = p1 + 1;
         IF p1 < 10 THEN ITERATE label1; END IF;
         LEAVE label1;
       END LOOP label1;
     END;

The scope of a block label does not include the code for handlers
declared within the block.  For details, see *note declare-handler::.


File: manual.info.tmp,  Node: declare,  Next: stored-program-variables,  Prev: statement-labels,  Up: sql-compound-statements

13.6.3 DECLARE Statements
-------------------------

The *note 'DECLARE': declare. statement is used to define various items
local to a program:

   * Local variables.  See *note stored-program-variables::.

   * Conditions and handlers.  See *note condition-handling::.

   * Cursors.  See *note cursors::.

*note 'DECLARE': declare. is permitted only inside a *note 'BEGIN ...
END': begin-end. compound statement and must be at its start, before any
other statements.

Declarations must follow a certain order.  Cursor declarations must
appear before handler declarations.  Variable and condition declarations
must appear before cursor or handler declarations.


File: manual.info.tmp,  Node: stored-program-variables,  Next: flow-control-statements,  Prev: declare,  Up: sql-compound-statements

13.6.4 Variables in Stored Programs
-----------------------------------

* Menu:

* declare-local-variable::       Local Variable DECLARE Statement
* local-variable-scope::         Local Variable Scope and Resolution

System variables and user-defined variables can be used in stored
programs, just as they can be used outside stored-program context.  In
addition, stored programs can use 'DECLARE' to define local variables,
and stored routines (procedures and functions) can be declared to take
parameters that communicate values between the routine and its caller.

   * To declare local variables, use the *note 'DECLARE':
     declare-local-variable. statement, as described in *note
     declare-local-variable::.

   * Variables can be set directly with the *note 'SET': set-variable.
     statement.  See *note set-variable::.

   * Results from queries can be retrieved into local variables using
     *note 'SELECT ... INTO VAR_LIST': select-into. or by opening a
     cursor and using *note 'FETCH ... INTO VAR_LIST': fetch.  See *note
     select-into::, and *note cursors::.

For information about the scope of local variables and how MySQL
resolves ambiguous names, see *note local-variable-scope::.


File: manual.info.tmp,  Node: declare-local-variable,  Next: local-variable-scope,  Prev: stored-program-variables,  Up: stored-program-variables

13.6.4.1 Local Variable DECLARE Statement
.........................................

     DECLARE VAR_NAME [, VAR_NAME] ... TYPE [DEFAULT VALUE]

This statement declares local variables within stored programs.  To
provide a default value for a variable, include a 'DEFAULT' clause.  The
value can be specified as an expression; it need not be a constant.  If
the 'DEFAULT' clause is missing, the initial value is 'NULL'.

Local variables are treated like stored routine parameters with respect
to data type and overflow checking.  See *note create-procedure::.

Variable declarations must appear before cursor or handler declarations.

Local variable names are not case-sensitive.  Permissible characters and
quoting rules are the same as for other identifiers, as described in
*note identifiers::.

The scope of a local variable is the *note 'BEGIN ... END': begin-end.
block within which it is declared.  The variable can be referred to in
blocks nested within the declaring block, except those blocks that
declare a variable with the same name.

For examples of variable declarations, see *note local-variable-scope::.


File: manual.info.tmp,  Node: local-variable-scope,  Prev: declare-local-variable,  Up: stored-program-variables

13.6.4.2 Local Variable Scope and Resolution
............................................

The scope of a local variable is the *note 'BEGIN ... END': begin-end.
block within which it is declared.  The variable can be referred to in
blocks nested within the declaring block, except those blocks that
declare a variable with the same name.

Because local variables are in scope only during stored program
execution, references to them are not permitted in prepared statements
created within a stored program.  Prepared statement scope is the
current session, not the stored program, so the statement could be
executed after the program ends, at which point the variables would no
longer be in scope.  For example, 'SELECT ... INTO LOCAL_VAR' cannot be
used as a prepared statement.  This restriction also applies to stored
procedure and function parameters.  See *note prepare::.

A local variable should not have the same name as a table column.  If an
SQL statement, such as a *note 'SELECT ... INTO': select. statement,
contains a reference to a column and a declared local variable with the
same name, MySQL currently interprets the reference as the name of a
variable.  Consider the following procedure definition:

     CREATE PROCEDURE sp1 (x VARCHAR(5))
     BEGIN
       DECLARE xname VARCHAR(5) DEFAULT 'bob';
       DECLARE newname VARCHAR(5);
       DECLARE xid INT;

       SELECT xname, id INTO newname, xid
         FROM table1 WHERE xname = xname;
       SELECT newname;
     END;

MySQL interprets 'xname' in the *note 'SELECT': select. statement as a
reference to the 'xname' _variable_ rather than the 'xname' _column_.
Consequently, when the procedure 'sp1()'is called, the 'newname'
variable returns the value ''bob'' regardless of the value of the
'table1.xname' column.

Similarly, the cursor definition in the following procedure contains a
*note 'SELECT': select. statement that refers to 'xname'.  MySQL
interprets this as a reference to the variable of that name rather than
a column reference.

     CREATE PROCEDURE sp2 (x VARCHAR(5))
     BEGIN
       DECLARE xname VARCHAR(5) DEFAULT 'bob';
       DECLARE newname VARCHAR(5);
       DECLARE xid INT;
       DECLARE done TINYINT DEFAULT 0;
       DECLARE cur1 CURSOR FOR SELECT xname, id FROM table1;
       DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

       OPEN cur1;
       read_loop: LOOP
         FETCH FROM cur1 INTO newname, xid;
         IF done THEN LEAVE read_loop; END IF;
         SELECT newname;
       END LOOP;
       CLOSE cur1;
     END;

See also *note stored-program-restrictions::.


File: manual.info.tmp,  Node: flow-control-statements,  Next: cursors,  Prev: stored-program-variables,  Up: sql-compound-statements

13.6.5 Flow Control Statements
------------------------------

* Menu:

* case::                         CASE Statement
* if::                           IF Statement
* iterate::                      ITERATE Statement
* leave::                        LEAVE Statement
* loop::                         LOOP Statement
* repeat::                       REPEAT Statement
* return::                       RETURN Statement
* while::                        WHILE Statement

MySQL supports the *note 'IF': if, *note 'CASE': case, *note 'ITERATE':
iterate, *note 'LEAVE': leave. *note 'LOOP': loop, *note 'WHILE': while,
and *note 'REPEAT': repeat. constructs for flow control within stored
programs.  It also supports *note 'RETURN': return. within stored
functions.

Many of these constructs contain other statements, as indicated by the
grammar specifications in the following sections.  Such constructs may
be nested.  For example, an *note 'IF': if. statement might contain a
*note 'WHILE': while. loop, which itself contains a *note 'CASE': case.
statement.

MySQL does not support 'FOR' loops.


File: manual.info.tmp,  Node: case,  Next: if,  Prev: flow-control-statements,  Up: flow-control-statements

13.6.5.1 CASE Statement
.......................

     CASE CASE_VALUE
         WHEN WHEN_VALUE THEN STATEMENT_LIST
         [WHEN WHEN_VALUE THEN STATEMENT_LIST] ...
         [ELSE STATEMENT_LIST]
     END CASE

Or:

     CASE
         WHEN SEARCH_CONDITION THEN STATEMENT_LIST
         [WHEN SEARCH_CONDITION THEN STATEMENT_LIST] ...
         [ELSE STATEMENT_LIST]
     END CASE

The *note 'CASE': case. statement for stored programs implements a
complex conditional construct.

*Note*:

There is also a 'CASE' _expr_, which differs from the *note 'CASE':
case. _statement_ described here.  See *note control-flow-functions::.
The *note 'CASE': case. statement cannot have an 'ELSE NULL' clause, and
it is terminated with 'END CASE' instead of 'END'.

For the first syntax, CASE_VALUE is an expression.  This value is
compared to the WHEN_VALUE expression in each 'WHEN' clause until one of
them is equal.  When an equal WHEN_VALUE is found, the corresponding
'THEN' clause STATEMENT_LIST executes.  If no WHEN_VALUE is equal, the
'ELSE' clause STATEMENT_LIST executes, if there is one.

This syntax cannot be used to test for equality with 'NULL' because
'NULL = NULL' is false.  See *note working-with-null::.

For the second syntax, each 'WHEN' clause SEARCH_CONDITION expression is
evaluated until one is true, at which point its corresponding 'THEN'
clause STATEMENT_LIST executes.  If no SEARCH_CONDITION is equal, the
'ELSE' clause STATEMENT_LIST executes, if there is one.

If no WHEN_VALUE or SEARCH_CONDITION matches the value tested and the
*note 'CASE': case. statement contains no 'ELSE' clause, a 'Case not
found for CASE statement' error results.

Each STATEMENT_LIST consists of one or more SQL statements; an empty
STATEMENT_LIST is not permitted.

To handle situations where no value is matched by any 'WHEN' clause, use
an 'ELSE' containing an empty *note 'BEGIN ... END': begin-end. block,
as shown in this example.  (The indentation used here in the 'ELSE'
clause is for purposes of clarity only, and is not otherwise
significant.)

     DELIMITER |

     CREATE PROCEDURE p()
       BEGIN
         DECLARE v INT DEFAULT 1;

         CASE v
           WHEN 2 THEN SELECT v;
           WHEN 3 THEN SELECT 0;
           ELSE
             BEGIN
             END;
         END CASE;
       END;
       |


File: manual.info.tmp,  Node: if,  Next: iterate,  Prev: case,  Up: flow-control-statements

13.6.5.2 IF Statement
.....................

     IF SEARCH_CONDITION THEN STATEMENT_LIST
         [ELSEIF SEARCH_CONDITION THEN STATEMENT_LIST] ...
         [ELSE STATEMENT_LIST]
     END IF

The *note 'IF': if. statement for stored programs implements a basic
conditional construct.

*Note*:

There is also an 'IF()' _function_, which differs from the *note 'IF':
if. _statement_ described here.  See *note control-flow-functions::.
The *note 'IF': if. statement can have 'THEN', 'ELSE', and 'ELSEIF'
clauses, and it is terminated with 'END IF'.

If a given SEARCH_CONDITION evaluates to true, the corresponding 'THEN'
or 'ELSEIF' clause STATEMENT_LIST executes.  If no SEARCH_CONDITION
matches, the 'ELSE' clause STATEMENT_LIST executes.

Each STATEMENT_LIST consists of one or more SQL statements; an empty
STATEMENT_LIST is not permitted.

An 'IF ... END IF' block, like all other flow-control blocks used within
stored programs, must be terminated with a semicolon, as shown in this
example:

     DELIMITER //

     CREATE FUNCTION SimpleCompare(n INT, m INT)
       RETURNS VARCHAR(20)

       BEGIN
         DECLARE s VARCHAR(20);

         IF n > m THEN SET s = '>';
         ELSEIF n = m THEN SET s = '=';
         ELSE SET s = '<';
         END IF;

         SET s = CONCAT(n, ' ', s, ' ', m);

         RETURN s;
       END //

     DELIMITER ;

As with other flow-control constructs, 'IF ... END IF' blocks may be
nested within other flow-control constructs, including other *note 'IF':
if. statements.  Each *note 'IF': if. must be terminated by its own 'END
IF' followed by a semicolon.  You can use indentation to make nested
flow-control blocks more easily readable by humans (although this is not
required by MySQL), as shown here:

     DELIMITER //

     CREATE FUNCTION VerboseCompare (n INT, m INT)
       RETURNS VARCHAR(50)

       BEGIN
         DECLARE s VARCHAR(50);

         IF n = m THEN SET s = 'equals';
         ELSE
           IF n > m THEN SET s = 'greater';
           ELSE SET s = 'less';
           END IF;

           SET s = CONCAT('is ', s, ' than');
         END IF;

         SET s = CONCAT(n, ' ', s, ' ', m, '.');

         RETURN s;
       END //

     DELIMITER ;

In this example, the inner *note 'IF': if. is evaluated only if 'n' is
not equal to 'm'.


File: manual.info.tmp,  Node: iterate,  Next: leave,  Prev: if,  Up: flow-control-statements

13.6.5.3 ITERATE Statement
..........................

     ITERATE LABEL

*note 'ITERATE': iterate. can appear only within *note 'LOOP': loop,
*note 'REPEAT': repeat, and *note 'WHILE': while. statements.  *note
'ITERATE': iterate. means 'start the loop again.'

For an example, see *note loop::.


File: manual.info.tmp,  Node: leave,  Next: loop,  Prev: iterate,  Up: flow-control-statements

13.6.5.4 LEAVE Statement
........................

     LEAVE LABEL

This statement is used to exit the flow control construct that has the
given label.  If the label is for the outermost stored program block,
*note 'LEAVE': leave. exits the program.

*note 'LEAVE': leave. can be used within *note 'BEGIN ... END':
begin-end. or loop constructs (*note 'LOOP': loop, *note 'REPEAT':
repeat, *note 'WHILE': while.).

For an example, see *note loop::.


File: manual.info.tmp,  Node: loop,  Next: repeat,  Prev: leave,  Up: flow-control-statements

13.6.5.5 LOOP Statement
.......................

     [BEGIN_LABEL:] LOOP
         STATEMENT_LIST
     END LOOP [END_LABEL]

*note 'LOOP': loop. implements a simple loop construct, enabling
repeated execution of the statement list, which consists of one or more
statements, each terminated by a semicolon (';') statement delimiter.
The statements within the loop are repeated until the loop is
terminated.  Usually, this is accomplished with a *note 'LEAVE': leave.
statement.  Within a stored function, *note 'RETURN': return. can also
be used, which exits the function entirely.

Neglecting to include a loop-termination statement results in an
infinite loop.

A *note 'LOOP': loop. statement can be labeled.  For the rules regarding
label use, see *note statement-labels::.

Example:

     CREATE PROCEDURE doiterate(p1 INT)
     BEGIN
       label1: LOOP
         SET p1 = p1 + 1;
         IF p1 < 10 THEN
           ITERATE label1;
         END IF;
         LEAVE label1;
       END LOOP label1;
       SET @x = p1;
     END;


File: manual.info.tmp,  Node: repeat,  Next: return,  Prev: loop,  Up: flow-control-statements

13.6.5.6 REPEAT Statement
.........................

     [BEGIN_LABEL:] REPEAT
         STATEMENT_LIST
     UNTIL SEARCH_CONDITION
     END REPEAT [END_LABEL]

The statement list within a *note 'REPEAT': repeat. statement is
repeated until the SEARCH_CONDITION expression is true.  Thus, a *note
'REPEAT': repeat. always enters the loop at least once.  STATEMENT_LIST
consists of one or more statements, each terminated by a semicolon (';')
statement delimiter.

A *note 'REPEAT': repeat. statement can be labeled.  For the rules
regarding label use, see *note statement-labels::.

Example:

     mysql> delimiter //

     mysql> CREATE PROCEDURE dorepeat(p1 INT)
            BEGIN
              SET @x = 0;
              REPEAT
                SET @x = @x + 1;
              UNTIL @x > p1 END REPEAT;
            END
            //
     Query OK, 0 rows affected (0.00 sec)

     mysql> CALL dorepeat(1000)//
     Query OK, 0 rows affected (0.00 sec)

     mysql> SELECT @x//
     +------+
     | @x   |
     +------+
     | 1001 |
     +------+
     1 row in set (0.00 sec)


File: manual.info.tmp,  Node: return,  Next: while,  Prev: repeat,  Up: flow-control-statements

13.6.5.7 RETURN Statement
.........................

     RETURN EXPR

The *note 'RETURN': return. statement terminates execution of a stored
function and returns the value EXPR to the function caller.  There must
be at least one *note 'RETURN': return. statement in a stored function.
There may be more than one if the function has multiple exit points.

This statement is not used in stored procedures, triggers, or events.
The *note 'LEAVE': leave. statement can be used to exit a stored program
of those types.


File: manual.info.tmp,  Node: while,  Prev: return,  Up: flow-control-statements

13.6.5.8 WHILE Statement
........................

     [BEGIN_LABEL:] WHILE SEARCH_CONDITION DO
         STATEMENT_LIST
     END WHILE [END_LABEL]

The statement list within a *note 'WHILE': while. statement is repeated
as long as the SEARCH_CONDITION expression is true.  STATEMENT_LIST
consists of one or more SQL statements, each terminated by a semicolon
(';') statement delimiter.

A *note 'WHILE': while. statement can be labeled.  For the rules
regarding label use, see *note statement-labels::.

Example:

     CREATE PROCEDURE dowhile()
     BEGIN
       DECLARE v1 INT DEFAULT 5;

       WHILE v1 > 0 DO
         ...
         SET v1 = v1 - 1;
       END WHILE;
     END;


File: manual.info.tmp,  Node: cursors,  Next: condition-handling,  Prev: flow-control-statements,  Up: sql-compound-statements

13.6.6 Cursors
--------------

* Menu:

* close::                        Cursor CLOSE Statement
* declare-cursor::               Cursor DECLARE Statement
* fetch::                        Cursor FETCH Statement
* open::                         Cursor OPEN Statement
* cursor-restrictions::          Restrictions on Server-Side Cursors

MySQL supports cursors inside stored programs.  The syntax is as in
embedded SQL. Cursors have these properties:

   * Asensitive: The server may or may not make a copy of its result
     table

   * Read only: Not updatable

   * Nonscrollable: Can be traversed only in one direction and cannot
     skip rows

Cursor declarations must appear before handler declarations and after
variable and condition declarations.

Example:

     CREATE PROCEDURE curdemo()
     BEGIN
       DECLARE done INT DEFAULT FALSE;
       DECLARE a CHAR(16);
       DECLARE b, c INT;
       DECLARE cur1 CURSOR FOR SELECT id,data FROM test.t1;
       DECLARE cur2 CURSOR FOR SELECT i FROM test.t2;
       DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;

       OPEN cur1;
       OPEN cur2;

       read_loop: LOOP
         FETCH cur1 INTO a, b;
         FETCH cur2 INTO c;
         IF done THEN
           LEAVE read_loop;
         END IF;
         IF b < c THEN
           INSERT INTO test.t3 VALUES (a,b);
         ELSE
           INSERT INTO test.t3 VALUES (a,c);
         END IF;
       END LOOP;

       CLOSE cur1;
       CLOSE cur2;
     END;


File: manual.info.tmp,  Node: close,  Next: declare-cursor,  Prev: cursors,  Up: cursors

13.6.6.1 Cursor CLOSE Statement
...............................

     CLOSE CURSOR_NAME

This statement closes a previously opened cursor.  For an example, see
*note cursors::.

An error occurs if the cursor is not open.

If not closed explicitly, a cursor is closed at the end of the *note
'BEGIN ... END': begin-end. block in which it was declared.


File: manual.info.tmp,  Node: declare-cursor,  Next: fetch,  Prev: close,  Up: cursors

13.6.6.2 Cursor DECLARE Statement
.................................

     DECLARE CURSOR_NAME CURSOR FOR SELECT_STATEMENT

This statement declares a cursor and associates it with a *note
'SELECT': select. statement that retrieves the rows to be traversed by
the cursor.  To fetch the rows later, use a *note 'FETCH': fetch.
statement.  The number of columns retrieved by the *note 'SELECT':
select. statement must match the number of output variables specified in
the *note 'FETCH': fetch. statement.

The *note 'SELECT': select. statement cannot have an 'INTO' clause.

Cursor declarations must appear before handler declarations and after
variable and condition declarations.

A stored program may contain multiple cursor declarations, but each
cursor declared in a given block must have a unique name.  For an
example, see *note cursors::.

For information available through *note 'SHOW': show. statements, it is
possible in many cases to obtain equivalent information by using a
cursor with an 'INFORMATION_SCHEMA' table.


File: manual.info.tmp,  Node: fetch,  Next: open,  Prev: declare-cursor,  Up: cursors

13.6.6.3 Cursor FETCH Statement
...............................

     FETCH [[NEXT] FROM] CURSOR_NAME INTO VAR_NAME [, VAR_NAME] ...

This statement fetches the next row for the *note 'SELECT': select.
statement associated with the specified cursor (which must be open), and
advances the cursor pointer.  If a row exists, the fetched columns are
stored in the named variables.  The number of columns retrieved by the
*note 'SELECT': select. statement must match the number of output
variables specified in the *note 'FETCH': fetch. statement.

If no more rows are available, a No Data condition occurs with SQLSTATE
value ''02000''.  To detect this condition, you can set up a handler for
it (or for a 'NOT FOUND' condition).  For an example, see *note
cursors::.

Be aware that another operation, such as a 'SELECT' or another 'FETCH',
may also cause the handler to execute by raising the same condition.  If
it is necessary to distinguish which operation raised the condition,
place the operation within its own *note 'BEGIN ... END': begin-end.
block so that it can be associated with its own handler.


File: manual.info.tmp,  Node: open,  Next: cursor-restrictions,  Prev: fetch,  Up: cursors

13.6.6.4 Cursor OPEN Statement
..............................

     OPEN CURSOR_NAME

This statement opens a previously declared cursor.  For an example, see
*note cursors::.


File: manual.info.tmp,  Node: cursor-restrictions,  Prev: open,  Up: cursors

13.6.6.5 Restrictions on Server-Side Cursors
............................................

Server-side cursors are implemented in the C API using the *note
'mysql_stmt_attr_set()': mysql-stmt-attr-set. function.  The same
implementation is used for cursors in stored routines.  A server-side
cursor enables a result set to be generated on the server side, but not
transferred to the client except for those rows that the client
requests.  For example, if a client executes a query but is only
interested in the first row, the remaining rows are not transferred.

In MySQL, a server-side cursor is materialized into an internal
temporary table.  Initially, this is a 'MEMORY' table, but is converted
to a 'MyISAM' table when its size exceeds the minimum value of the
'max_heap_table_size' and 'tmp_table_size' system variables.  The same
restrictions apply to internal temporary tables created to hold the
result set for a cursor as for other uses of internal temporary tables.
See *note internal-temporary-tables::.  One limitation of the
implementation is that for a large result set, retrieving its rows
through a cursor might be slow.

Cursors are read only; you cannot use a cursor to update rows.

'UPDATE WHERE CURRENT OF' and 'DELETE WHERE CURRENT OF' are not
implemented, because updatable cursors are not supported.

Cursors are nonholdable (not held open after a commit).

Cursors are asensitive.

Cursors are nonscrollable.

Cursors are not named.  The statement handler acts as the cursor ID.

You can have open only a single cursor per prepared statement.  If you
need several cursors, you must prepare several statements.

You cannot use a cursor for a statement that generates a result set if
the statement is not supported in prepared mode.  This includes
statements such as *note 'CHECK TABLE': check-table, 'HANDLER READ', and
*note 'SHOW BINLOG EVENTS': show-binlog-events.


File: manual.info.tmp,  Node: condition-handling,  Prev: cursors,  Up: sql-compound-statements

13.6.7 Condition Handling
-------------------------

* Menu:

* declare-condition::            DECLARE ... CONDITION Statement
* declare-handler::              DECLARE ... HANDLER Statement
* resignal::                     RESIGNAL Statement
* signal::                       SIGNAL Statement
* conditions-and-parameters::    Condition Handling and OUT or INOUT Parameters
* condition-handling-restrictions::  Restrictions on Condition Handling

Conditions may arise during stored program execution that require
special handling, such as exiting the current program block or
continuing execution.  Handlers can be defined for general conditions
such as warnings or exceptions, or for specific conditions such as a
particular error code.  Specific conditions can be assigned names and
referred to that way in handlers.

To name a condition, use the *note 'DECLARE ... CONDITION':
declare-condition. statement.  To declare a handler, use the *note
'DECLARE ... HANDLER': declare-handler. statement.  See *note
declare-condition::, and *note declare-handler::.

To raise a condition, use the *note 'SIGNAL': signal. statement.  To
modify condition information within a condition handler, use *note
'RESIGNAL': resignal.  See *note declare-condition::, and *note
declare-handler::.

Another statement related to conditions is 'GET DIAGNOSTICS'.  The 'GET
DIAGNOSTICS' statement is not supported until MySQL 5.6.

Before MySQL 5.6.3, if a statement that generates a warning or error
causes a condition handler to be invoked, the handler may not clear the
diagnostic area.  This might lead to the appearance that the handler was
not invoked.  The following discussion demonstrates the issue and
provides a workaround.

Suppose that a table 't1' is empty.  The following procedure selects
from it, raising a No Data condition:

     CREATE PROCEDURE p1()
     BEGIN
       DECLARE a INT;
       DECLARE CONTINUE HANDLER FOR NOT FOUND
         BEGIN
           SET @handler_invoked = 1;
         END;
       SELECT c1 INTO a FROM t1;
     END;

As can be seen from the following sequence of statements, the condition
is not cleared by handler invocation (otherwise, the *note 'SHOW
WARNINGS': show-warnings. output would be empty).  But as can be seen by
the value of '@handler_invoked', the handler was indeed invoked
(otherwise its value would be 0).

     mysql> SET @handler_invoked = 0;
     Query OK, 0 rows affected (0.00 sec)

     mysql> CALL p1();
     Query OK, 0 rows affected, 1 warning (0.00 sec)

     mysql> SHOW WARNINGS;
     +---------+------+-----------------------------------------------------+
     | Level   | Code | Message                                             |
     +---------+------+-----------------------------------------------------+
     | Warning | 1329 | No data - zero rows fetched, selected, or processed |
     +---------+------+-----------------------------------------------------+
     1 row in set (0.00 sec)

     mysql> SELECT @handler_invoked;
     +------------------+
     | @handler_invoked |
     +------------------+
     |                1 |
     +------------------+
     1 row in set (0.00 sec)

To work around this issue, use a condition handler containing a
statement that clears warnings:

     CREATE PROCEDURE p1()
     BEGIN
       DECLARE a INT;
       DECLARE CONTINUE HANDLER FOR NOT FOUND
         BEGIN
           SELECT 1 INTO @handler_invoked FROM (SELECT 1) AS t;
         END;
       SELECT c1 INTO a FROM t1;
     END;

This works for 'CONTINUE' and 'EXIT' handlers.

This issue is resolved as of MySQL 5.6.3 and no workaround is needed.


File: manual.info.tmp,  Node: declare-condition,  Next: declare-handler,  Prev: condition-handling,  Up: condition-handling

13.6.7.1 DECLARE ... CONDITION Statement
........................................

     DECLARE CONDITION_NAME CONDITION FOR CONDITION_VALUE

     CONDITION_VALUE: {
         MYSQL_ERROR_CODE
       | SQLSTATE [VALUE] SQLSTATE_VALUE
     }

The *note 'DECLARE ... CONDITION': declare-condition. statement declares
a named error condition, associating a name with a condition that needs
specific handling.  The name can be referred to in a subsequent *note
'DECLARE ... HANDLER': declare-handler. statement (see *note
declare-handler::).

Condition declarations must appear before cursor or handler
declarations.

The CONDITION_VALUE for *note 'DECLARE ... CONDITION':
declare-condition. indicates the specific condition or class of
conditions to associate with the condition name.  It can take the
following forms:

   * MYSQL_ERROR_CODE: An integer literal indicating a MySQL error code.

     Do not use MySQL error code 0 because that indicates success rather
     than an error condition.  For a list of MySQL error codes, see
     *note server-error-reference::.

   * SQLSTATE [VALUE] SQLSTATE_VALUE: A 5-character string literal
     indicating an SQLSTATE value.

     Do not use SQLSTATE values that begin with ''00'' because those
     indicate success rather than an error condition.  For a list of
     SQLSTATE values, see *note server-error-reference::.

Condition names referred to in *note 'SIGNAL': signal. or use *note
'RESIGNAL': resignal. statements must be associated with SQLSTATE
values, not MySQL error codes.

Using names for conditions can help make stored program code clearer.
For example, this handler applies to attempts to drop a nonexistent
table, but that is apparent only if you know that 1051 is the MySQL
error code for 'unknown table':

     DECLARE CONTINUE HANDLER FOR 1051
       BEGIN
         -- body of handler
       END;

By declaring a name for the condition, the purpose of the handler is
more readily seen:

     DECLARE no_such_table CONDITION FOR 1051;
     DECLARE CONTINUE HANDLER FOR no_such_table
       BEGIN
         -- body of handler
       END;

Here is a named condition for the same condition, but based on the
corresponding SQLSTATE value rather than the MySQL error code:

     DECLARE no_such_table CONDITION FOR SQLSTATE '42S02';
     DECLARE CONTINUE HANDLER FOR no_such_table
       BEGIN
         -- body of handler
       END;


File: manual.info.tmp,  Node: declare-handler,  Next: resignal,  Prev: declare-condition,  Up: condition-handling

13.6.7.2 DECLARE ... HANDLER Statement
......................................

     DECLARE HANDLER_ACTION HANDLER
         FOR CONDITION_VALUE [, CONDITION_VALUE] ...
         STATEMENT

     HANDLER_ACTION: {
         CONTINUE
       | EXIT
       | UNDO
     }

     CONDITION_VALUE: {
         MYSQL_ERROR_CODE
       | SQLSTATE [VALUE] SQLSTATE_VALUE
       | CONDITION_NAME
       | SQLWARNING
       | NOT FOUND
       | SQLEXCEPTION
     }

The *note 'DECLARE ... HANDLER': declare-handler. statement specifies a
handler that deals with one or more conditions.  If one of these
conditions occurs, the specified STATEMENT executes.  STATEMENT can be a
simple statement such as 'SET VAR_NAME = VALUE', or a compound statement
written using 'BEGIN' and 'END' (see *note begin-end::).

Handler declarations must appear after variable or condition
declarations.

The HANDLER_ACTION value indicates what action the handler takes after
execution of the handler statement:

   * 'CONTINUE': Execution of the current program continues.

   * 'EXIT': Execution terminates for the *note 'BEGIN ... END':
     begin-end. compound statement in which the handler is declared.
     This is true even if the condition occurs in an inner block.

   * 'UNDO': Not supported.

The CONDITION_VALUE for *note 'DECLARE ... HANDLER': declare-handler.
indicates the specific condition or class of conditions that activates
the handler.  It can take the following forms:

   * MYSQL_ERROR_CODE: An integer literal indicating a MySQL error code,
     such as 1051 to specify 'unknown table':

          DECLARE CONTINUE HANDLER FOR 1051
            BEGIN
              -- body of handler
            END;

     Do not use MySQL error code 0 because that indicates success rather
     than an error condition.  For a list of MySQL error codes, see
     *note server-error-reference::.

   * SQLSTATE [VALUE] SQLSTATE_VALUE: A 5-character string literal
     indicating an SQLSTATE value, such as ''42S01'' to specify 'unknown
     table':

          DECLARE CONTINUE HANDLER FOR SQLSTATE '42S02'
            BEGIN
              -- body of handler
            END;

     Do not use SQLSTATE values that begin with ''00'' because those
     indicate success rather than an error condition.  For a list of
     SQLSTATE values, see *note server-error-reference::.

   * CONDITION_NAME: A condition name previously specified with *note
     'DECLARE ... CONDITION': declare-condition.  A condition name can
     be associated with a MySQL error code or SQLSTATE value.  See *note
     declare-condition::.

   * 'SQLWARNING': Shorthand for the class of SQLSTATE values that begin
     with ''01''.

          DECLARE CONTINUE HANDLER FOR SQLWARNING
            BEGIN
              -- body of handler
            END;

   * 'NOT FOUND': Shorthand for the class of SQLSTATE values that begin
     with ''02''.  This is relevant within the context of cursors and is
     used to control what happens when a cursor reaches the end of a
     data set.  If no more rows are available, a No Data condition
     occurs with SQLSTATE value ''02000''.  To detect this condition,
     you can set up a handler for it or for a 'NOT FOUND' condition.

          DECLARE CONTINUE HANDLER FOR NOT FOUND
            BEGIN
              -- body of handler
            END;

     For another example, see *note cursors::.  The 'NOT FOUND'
     condition also occurs for 'SELECT ... INTO VAR_LIST' statements
     that retrieve no rows.

   * 'SQLEXCEPTION': Shorthand for the class of SQLSTATE values that do
     not begin with ''00'', ''01'', or ''02''.

          DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
            BEGIN
              -- body of handler
            END;

If a condition occurs for which no handler has been declared, the action
taken depends on the condition class:

   * For 'SQLEXCEPTION' conditions, the stored program terminates at the
     statement that raised the condition, as if there were an 'EXIT'
     handler.  If the program was called by another stored program, the
     calling program handles the condition using the handler selection
     rules applied to its own handlers.

   * For 'SQLWARNING' conditions, the program continues executing, as if
     there were a 'CONTINUE' handler.

   * For 'NOT FOUND' conditions, if the condition was raised normally,
     the action is 'CONTINUE'.  If it was raised by *note 'SIGNAL':
     signal. or *note 'RESIGNAL': resignal, the action is 'EXIT'.

The following example uses a handler for 'SQLSTATE '23000'', which
occurs for a duplicate-key error:

     mysql> CREATE TABLE test.t (s1 INT, PRIMARY KEY (s1));
     Query OK, 0 rows affected (0.00 sec)

     mysql> delimiter //

     mysql> CREATE PROCEDURE handlerdemo ()
            BEGIN
              DECLARE CONTINUE HANDLER FOR SQLSTATE '23000' SET @x2 = 1;
              SET @x = 1;
              INSERT INTO test.t VALUES (1);
              SET @x = 2;
              INSERT INTO test.t VALUES (1);
              SET @x = 3;
            END;
            //
     Query OK, 0 rows affected (0.00 sec)

     mysql> CALL handlerdemo()//
     Query OK, 0 rows affected, 1 warning (0.01 sec)

     mysql> SHOW WARNINGS//
     +-------+------+---------------------------------------+
     | Level | Code | Message                               |
     +-------+------+---------------------------------------+
     | Error | 1062 | Duplicate entry '1' for key 'PRIMARY' |
     +-------+------+---------------------------------------+
     1 row in set (0.00 sec)

     mysql> SELECT @x//
         +------+
         | @x   |
         +------+
         | 3    |
         +------+
         1 row in set (0.00 sec)

Notice that '@x' is '3' after the procedure executes, which shows that
execution continued to the end of the procedure after the error
occurred.  If the *note 'DECLARE ... HANDLER': declare-handler.
statement had not been present, MySQL would have taken the default
action ('EXIT') after the second *note 'INSERT': insert. failed due to
the 'PRIMARY KEY' constraint, and 'SELECT @x' would have returned '2'.

To ignore a condition, declare a 'CONTINUE' handler for it and associate
it with an empty block.  For example:

     DECLARE CONTINUE HANDLER FOR SQLWARNING BEGIN END;

The scope of a block label does not include the code for handlers
declared within the block.  Therefore, the statement associated with a
handler cannot use *note 'ITERATE': iterate. or *note 'LEAVE': leave. to
refer to labels for blocks that enclose the handler declaration.
Consider the following example, where the *note 'REPEAT': repeat. block
has a label of 'retry':

     CREATE PROCEDURE p ()
     BEGIN
       DECLARE i INT DEFAULT 3;
       retry:
         REPEAT
           BEGIN
             DECLARE CONTINUE HANDLER FOR SQLWARNING
               BEGIN
                 ITERATE retry;    # illegal
               END;
             IF i < 0 THEN
               LEAVE retry;        # legal
             END IF;
             SET i = i - 1;
           END;
         UNTIL FALSE END REPEAT;
     END;

The 'retry' label is in scope for the *note 'IF': if. statement within
the block.  It is not in scope for the 'CONTINUE' handler, so the
reference there is invalid and results in an error:

     ERROR 1308 (42000): LEAVE with no matching label: retry

To avoid references to outer labels in handlers, use one of these
strategies:

   * To leave the block, use an 'EXIT' handler.  If no block cleanup is
     required, the *note 'BEGIN ... END': begin-end. handler body can be
     empty:

          DECLARE EXIT HANDLER FOR SQLWARNING BEGIN END;

     Otherwise, put the cleanup statements in the handler body:

          DECLARE EXIT HANDLER FOR SQLWARNING
            BEGIN
              BLOCK CLEANUP STATEMENTS
            END;

   * To continue execution, set a status variable in a 'CONTINUE'
     handler that can be checked in the enclosing block to determine
     whether the handler was invoked.  The following example uses the
     variable 'done' for this purpose:

          CREATE PROCEDURE p ()
          BEGIN
            DECLARE i INT DEFAULT 3;
            DECLARE done INT DEFAULT FALSE;
            retry:
              REPEAT
                BEGIN
                  DECLARE CONTINUE HANDLER FOR SQLWARNING
                    BEGIN
                      SET done = TRUE;
                    END;
                  IF done OR i < 0 THEN
                    LEAVE retry;
                  END IF;
                  SET i = i - 1;
                END;
              UNTIL FALSE END REPEAT;
          END;


File: manual.info.tmp,  Node: resignal,  Next: signal,  Prev: declare-handler,  Up: condition-handling

13.6.7.3 RESIGNAL Statement
...........................

     RESIGNAL [CONDITION_VALUE]
         [SET SIGNAL_INFORMATION_ITEM
         [, SIGNAL_INFORMATION_ITEM] ...]

     CONDITION_VALUE: {
         SQLSTATE [VALUE] SQLSTATE_VALUE
       | CONDITION_NAME
     }

     SIGNAL_INFORMATION_ITEM:
         CONDITION_INFORMATION_ITEM_NAME = SIMPLE_VALUE_SPECIFICATION

     CONDITION_INFORMATION_ITEM_NAME: {
         CLASS_ORIGIN
       | SUBCLASS_ORIGIN
       | MESSAGE_TEXT
       | MYSQL_ERRNO
       | CONSTRAINT_CATALOG
       | CONSTRAINT_SCHEMA
       | CONSTRAINT_NAME
       | CATALOG_NAME
       | SCHEMA_NAME
       | TABLE_NAME
       | COLUMN_NAME
       | CURSOR_NAME
     }

     CONDITION_NAME, SIMPLE_VALUE_SPECIFICATION:
         (see following discussion)

*note 'RESIGNAL': resignal. passes on the error condition information
that is available during execution of a condition handler within a
compound statement inside a stored procedure or function, trigger, or
event.  *note 'RESIGNAL': resignal. may change some or all information
before passing it on.  *note 'RESIGNAL': resignal. is related to *note
'SIGNAL': signal, but instead of originating a condition as *note
'SIGNAL': signal. does, *note 'RESIGNAL': resignal. relays existing
condition information, possibly after modifying it.

*note 'RESIGNAL': resignal. makes it possible to both handle an error
and return the error information.  Otherwise, by executing an SQL
statement within the handler, information that caused the handler's
activation is destroyed.  *note 'RESIGNAL': resignal. also can make some
procedures shorter if a given handler can handle part of a situation,
then pass the condition 'up the line' to another handler.

No privileges are required to execute the *note 'RESIGNAL': resignal.
statement.

All forms of *note 'RESIGNAL': resignal. require that the current
context be a condition handler.  Otherwise, *note 'RESIGNAL': resignal.
is illegal and a 'RESIGNAL when handler not active' error occurs.

   * *note resignal-overview::

   * *note resignal-alone::

   * *note resignal-with-new-signal::

   * *note resignal-with-condition::

   * *note resignal-handler::

*RESIGNAL Overview*

For CONDITION_VALUE and SIGNAL_INFORMATION_ITEM, the definitions and
rules are the same for *note 'RESIGNAL': resignal. as for *note
'SIGNAL': signal.  For example, the CONDITION_VALUE can be an 'SQLSTATE'
value, and the value can indicate errors, warnings, or 'not found.' For
additional information, see *note signal::.

The *note 'RESIGNAL': resignal. statement takes CONDITION_VALUE and
'SET' clauses, both of which are optional.  This leads to several
possible uses:

   * *note 'RESIGNAL': resignal. alone:

          RESIGNAL;

   * *note 'RESIGNAL': resignal. with new signal information:

          RESIGNAL SET SIGNAL_INFORMATION_ITEM [, SIGNAL_INFORMATION_ITEM] ...;

   * *note 'RESIGNAL': resignal. with a condition value and possibly new
     signal information:

          RESIGNAL CONDITION_VALUE
              [SET SIGNAL_INFORMATION_ITEM [, SIGNAL_INFORMATION_ITEM] ...];

These use cases all cause changes to the diagnostics and condition
areas:

   * A diagnostics area contains one or more condition areas.

   * A condition area contains condition information items, such as the
     'SQLSTATE' value, 'MYSQL_ERRNO', or 'MESSAGE_TEXT'.

The maximum number of condition areas in a diagnostics area is
determined by the value of the 'max_error_count' system variable.

*RESIGNAL Alone*

A simple *note 'RESIGNAL': resignal. alone means 'pass on the error with
no change.' It restores the last diagnostics area and makes it the
current diagnostics area.  That is, it 'pops' the diagnostics area
stack.

Within a condition handler that catches a condition, one use for *note
'RESIGNAL': resignal. alone is to perform some other actions, and then
pass on without change the original condition information (the
information that existed before entry into the handler).

Example:

     DROP TABLE IF EXISTS xx;
     delimiter //
     CREATE PROCEDURE p ()
     BEGIN
       DECLARE EXIT HANDLER FOR SQLEXCEPTION
       BEGIN
         SET @error_count = @error_count + 1;
         IF @a = 0 THEN RESIGNAL; END IF;
       END;
       DROP TABLE xx;
     END//
     delimiter ;
     SET @error_count = 0;
     SET @a = 0;
     CALL p();

Suppose that the 'DROP TABLE xx' statement fails.  The diagnostics area
stack looks like this:

     DA 1. ERROR 1051 (42S02): Unknown table 'xx'

Then execution enters the 'EXIT' handler.  It starts by pushing a
diagnostics area to the top of the stack, which now looks like this:

     DA 1. ERROR 1051 (42S02): Unknown table 'xx'
     DA 2. ERROR 1051 (42S02): Unknown table 'xx'

Usually a procedure statement clears the first diagnostics area (also
called the 'current' diagnostics area).  'BEGIN' is an exception, it
does not clear, it does nothing.  'SET' is not an exception, it clears,
performs the operation, and produces a result of 'success.' The
diagnostics area stack now looks like this:

     DA 1. ERROR 0000 (00000): Successful operation
     DA 2. ERROR 1051 (42S02): Unknown table 'xx'

At this point, if '@a = 0', *note 'RESIGNAL': resignal. pops the
diagnostics area stack, which now looks like this:

     DA 1. ERROR 1051 (42S02): Unknown table 'xx'

And that is what the caller sees.

If '@a' is not 0, the handler simply ends, which means that there is no
more use for the current diagnostics area (it has been 'handled'), so it
can be thrown away, causing the stacked diagnostics area to become the
current diagnostics area again.  The diagnostics area stack looks like
this:

     DA 1. ERROR 0000 (00000): Successful operation

The details make it look complex, but the end result is quite useful:
Handlers can execute without destroying information about the condition
that caused activation of the handler.

*RESIGNAL with New Signal Information*

*note 'RESIGNAL': resignal. with a 'SET' clause provides new signal
information, so the statement means 'pass on the error with changes':

     RESIGNAL SET SIGNAL_INFORMATION_ITEM [, SIGNAL_INFORMATION_ITEM] ...;

As with *note 'RESIGNAL': resignal. alone, the idea is to pop the
diagnostics area stack so that the original information will go out.
Unlike *note 'RESIGNAL': resignal. alone, anything specified in the
'SET' clause changes.

Example:

     DROP TABLE IF EXISTS xx;
     delimiter //
     CREATE PROCEDURE p ()
     BEGIN
       DECLARE EXIT HANDLER FOR SQLEXCEPTION
       BEGIN
         SET @error_count = @error_count + 1;
         IF @a = 0 THEN RESIGNAL SET MYSQL_ERRNO = 5; END IF;
       END;
       DROP TABLE xx;
     END//
     delimiter ;
     SET @error_count = 0;
     SET @a = 0;
     CALL p();

Remember from the previous discussion that *note 'RESIGNAL': resignal.
alone results in a diagnostics area stack like this:

     DA 1. ERROR 1051 (42S02): Unknown table 'xx'

The 'RESIGNAL SET MYSQL_ERRNO = 5' statement results in this stack
instead, which is what the caller sees:

     DA 1. ERROR 5 (42S02): Unknown table 'xx'

In other words, it changes the error number, and nothing else.

The *note 'RESIGNAL': resignal. statement can change any or all of the
signal information items, making the first condition area of the
diagnostics area look quite different.

*RESIGNAL with a Condition Value and Optional New Signal Information*

*note 'RESIGNAL': resignal. with a condition value means 'push a
condition into the current diagnostics area.' If the 'SET' clause is
present, it also changes the error information.

     RESIGNAL CONDITION_VALUE
         [SET SIGNAL_INFORMATION_ITEM [, SIGNAL_INFORMATION_ITEM] ...];

This form of *note 'RESIGNAL': resignal. restores the last diagnostics
area and makes it the current diagnostics area.  That is, it 'pops' the
diagnostics area stack, which is the same as what a simple *note
'RESIGNAL': resignal. alone would do.  However, it also changes the
diagnostics area depending on the condition value or signal information.

Example:

     DROP TABLE IF EXISTS xx;
     delimiter //
     CREATE PROCEDURE p ()
     BEGIN
       DECLARE EXIT HANDLER FOR SQLEXCEPTION
       BEGIN
         SET @error_count = @error_count + 1;
         IF @a = 0 THEN RESIGNAL SQLSTATE '45000' SET MYSQL_ERRNO=5; END IF;
       END;
       DROP TABLE xx;
     END//
     delimiter ;
     SET @error_count = 0;
     SET @a = 0;
     SET @@max_error_count = 2;
     CALL p();
     SHOW ERRORS;

This is similar to the previous example, and the effects are the same,
except that if *note 'RESIGNAL': resignal. happens, the current
condition area looks different at the end.  (The reason the condition
adds to rather than replaces the existing condition is the use of a
condition value.)

The *note 'RESIGNAL': resignal. statement includes a condition value
('SQLSTATE '45000''), so it adds a new condition area, resulting in a
diagnostics area stack that looks like this:

     DA 1. (condition 2) ERROR 1051 (42S02): Unknown table 'xx'
           (condition 1) ERROR 5 (45000) Unknown table 'xx'

The result of *note 'CALL p()': call. and *note 'SHOW ERRORS':
show-errors. for this example is:

     mysql> CALL p();
     ERROR 5 (45000): Unknown table 'xx'
     mysql> SHOW ERRORS;
     +-------+------+----------------------------------+
     | Level | Code | Message                          |
     +-------+------+----------------------------------+
     | Error | 1051 | Unknown table 'xx'               |
     | Error |    5 | Unknown table 'xx'               |
     +-------+------+----------------------------------+

*RESIGNAL Requires Condition Handler Context*

All forms of *note 'RESIGNAL': resignal. require that the current
context be a condition handler.  Otherwise, *note 'RESIGNAL': resignal.
is illegal and a 'RESIGNAL when handler not active' error occurs.  For
example:

     mysql> CREATE PROCEDURE p () RESIGNAL;
     Query OK, 0 rows affected (0.00 sec)

     mysql> CALL p();
     ERROR 1645 (0K000): RESIGNAL when handler not active

Here is a more difficult example:

     delimiter //
     CREATE FUNCTION f () RETURNS INT
     BEGIN
       RESIGNAL;
       RETURN 5;
     END//
     CREATE PROCEDURE p ()
     BEGIN
       DECLARE EXIT HANDLER FOR SQLEXCEPTION SET @a=f();
       SIGNAL SQLSTATE '55555';
     END//
     delimiter ;
     CALL p();

*note 'RESIGNAL': resignal. occurs within the stored function 'f()',
which is invoked from within the 'EXIT' handler.  Thus, a handler is
active at the time *note 'RESIGNAL': resignal. executes, even though
*note 'RESIGNAL': resignal. is not defined inside the handler.

*Note*:

In MySQL 5.6 and higher, handler scope rules are more well developed.
Although 'f()' itself is invoked within the context of the 'EXIT'
handler, execution within 'f()' has its own context, which is not
handler context.  Thus, 'RESIGNAL' within 'f()' results in a 'handler
not active' error.


File: manual.info.tmp,  Node: signal,  Next: conditions-and-parameters,  Prev: resignal,  Up: condition-handling

13.6.7.4 SIGNAL Statement
.........................

     SIGNAL CONDITION_VALUE
         [SET SIGNAL_INFORMATION_ITEM
         [, SIGNAL_INFORMATION_ITEM] ...]

     CONDITION_VALUE: {
         SQLSTATE [VALUE] SQLSTATE_VALUE
       | CONDITION_NAME
     }

     SIGNAL_INFORMATION_ITEM:
         CONDITION_INFORMATION_ITEM_NAME = SIMPLE_VALUE_SPECIFICATION

     CONDITION_INFORMATION_ITEM_NAME: {
         CLASS_ORIGIN
       | SUBCLASS_ORIGIN
       | MESSAGE_TEXT
       | MYSQL_ERRNO
       | CONSTRAINT_CATALOG
       | CONSTRAINT_SCHEMA
       | CONSTRAINT_NAME
       | CATALOG_NAME
       | SCHEMA_NAME
       | TABLE_NAME
       | COLUMN_NAME
       | CURSOR_NAME
     }

     CONDITION_NAME, SIMPLE_VALUE_SPECIFICATION:
         (see following discussion)

*note 'SIGNAL': signal. is the way to 'return' an error.  *note
'SIGNAL': signal. provides error information to a handler, to an outer
portion of the application, or to the client.  Also, it provides control
over the error's characteristics (error number, 'SQLSTATE' value,
message).  Without *note 'SIGNAL': signal, it is necessary to resort to
workarounds such as deliberately referring to a nonexistent table to
cause a routine to return an error.

No privileges are required to execute the *note 'SIGNAL': signal.
statement.

   * *note signal-overview::

   * *note signal-condition-information-items::

   * *note signal-effects::

*SIGNAL Overview*

The CONDITION_VALUE in a *note 'SIGNAL': signal. statement indicates the
error value to be returned.  It can be an 'SQLSTATE' value (a
5-character string literal) or a CONDITION_NAME that refers to a named
condition previously defined with *note 'DECLARE ... CONDITION':
declare-condition. (see *note declare-condition::).

An 'SQLSTATE' value can indicate errors, warnings, or 'not found.' The
first two characters of the value indicate its error class, as discussed
in *note signal-condition-information-items::.  Some signal values cause
statement termination; see *note signal-effects::.

The 'SQLSTATE' value for a *note 'SIGNAL': signal. statement should not
start with ''00'' because such values indicate success and are not valid
for signaling an error.  This is true whether the 'SQLSTATE' value is
specified directly in the *note 'SIGNAL': signal. statement or in a
named condition referred to in the statement.  If the value is invalid,
a 'Bad SQLSTATE' error occurs.

To signal a generic 'SQLSTATE' value, use ''45000'', which means
'unhandled user-defined exception.'

The *note 'SIGNAL': signal. statement optionally includes a 'SET' clause
that contains multiple signal items, in a list of
CONDITION_INFORMATION_ITEM_NAME = SIMPLE_VALUE_SPECIFICATION
assignments, separated by commas.

Each CONDITION_INFORMATION_ITEM_NAME may be specified only once in the
'SET' clause.  Otherwise, a 'Duplicate condition information item' error
occurs.

Valid SIMPLE_VALUE_SPECIFICATION designators can be specified using
stored procedure or function parameters, stored program local variables
declared with *note 'DECLARE': declare, user-defined variables, system
variables, or literals.  A character literal may include a _CHARSET
introducer.

For information about permissible CONDITION_INFORMATION_ITEM_NAME
values, see *note signal-condition-information-items::.

The following procedure signals an error or warning depending on the
value of 'pval', its input parameter:

     CREATE PROCEDURE p (pval INT)
     BEGIN
       DECLARE specialty CONDITION FOR SQLSTATE '45000';
       IF pval = 0 THEN
         SIGNAL SQLSTATE '01000';
       ELSEIF pval = 1 THEN
         SIGNAL SQLSTATE '45000'
           SET MESSAGE_TEXT = 'An error occurred';
       ELSEIF pval = 2 THEN
         SIGNAL specialty
           SET MESSAGE_TEXT = 'An error occurred';
       ELSE
         SIGNAL SQLSTATE '01000'
           SET MESSAGE_TEXT = 'A warning occurred', MYSQL_ERRNO = 1000;
         SIGNAL SQLSTATE '45000'
           SET MESSAGE_TEXT = 'An error occurred', MYSQL_ERRNO = 1001;
       END IF;
     END;

If 'pval' is 0, 'p()' signals a warning because 'SQLSTATE' values that
begin with ''01'' are signals in the warning class.  The warning does
not terminate the procedure, and can be seen with *note 'SHOW WARNINGS':
show-warnings. after the procedure returns.

If 'pval' is 1, 'p()' signals an error and sets the 'MESSAGE_TEXT'
condition information item.  The error terminates the procedure, and the
text is returned with the error information.

If 'pval' is 2, the same error is signaled, although the 'SQLSTATE'
value is specified using a named condition in this case.

If 'pval' is anything else, 'p()' first signals a warning and sets the
message text and error number condition information items.  This warning
does not terminate the procedure, so execution continues and 'p()' then
signals an error.  The error does terminate the procedure.  The message
text and error number set by the warning are replaced by the values set
by the error, which are returned with the error information.

*note 'SIGNAL': signal. is typically used within stored programs, but it
is a MySQL extension that it is permitted outside handler context.  For
example, if you invoke the *note 'mysql': mysql. client program, you can
enter any of these statements at the prompt:

     SIGNAL SQLSTATE '77777';

     CREATE TRIGGER t_bi BEFORE INSERT ON t
       FOR EACH ROW SIGNAL SQLSTATE '77777';

     CREATE EVENT e ON SCHEDULE EVERY 1 SECOND
       DO SIGNAL SQLSTATE '77777';

*note 'SIGNAL': signal. executes according to the following rules:

If the *note 'SIGNAL': signal. statement indicates a particular
'SQLSTATE' value, that value is used to signal the condition specified.
Example:

     CREATE PROCEDURE p (divisor INT)
     BEGIN
       IF divisor = 0 THEN
         SIGNAL SQLSTATE '22012';
       END IF;
     END;

If the *note 'SIGNAL': signal. statement uses a named condition, the
condition must be declared in some scope that applies to the *note
'SIGNAL': signal. statement, and must be defined using an 'SQLSTATE'
value, not a MySQL error number.  Example:

     CREATE PROCEDURE p (divisor INT)
     BEGIN
       DECLARE divide_by_zero CONDITION FOR SQLSTATE '22012';
       IF divisor = 0 THEN
         SIGNAL divide_by_zero;
       END IF;
     END;

If the named condition does not exist in the scope of the *note
'SIGNAL': signal. statement, an 'Undefined CONDITION' error occurs.

If *note 'SIGNAL': signal. refers to a named condition that is defined
with a MySQL error number rather than an 'SQLSTATE' value, a
'SIGNAL/RESIGNAL can only use a CONDITION defined with SQLSTATE' error
occurs.  The following statements cause that error because the named
condition is associated with a MySQL error number:

     DECLARE no_such_table CONDITION FOR 1051;
     SIGNAL no_such_table;

If a condition with a given name is declared multiple times in different
scopes, the declaration with the most local scope applies.  Consider the
following procedure:

     CREATE PROCEDURE p (divisor INT)
     BEGIN
       DECLARE my_error CONDITION FOR SQLSTATE '45000';
       IF divisor = 0 THEN
         BEGIN
           DECLARE my_error CONDITION FOR SQLSTATE '22012';
           SIGNAL my_error;
         END;
       END IF;
       SIGNAL my_error;
     END;

If 'divisor' is 0, the first *note 'SIGNAL': signal. statement executes.
The innermost 'my_error' condition declaration applies, raising
'SQLSTATE' ''22012''.

If 'divisor' is not 0, the second *note 'SIGNAL': signal. statement
executes.  The outermost 'my_error' condition declaration applies,
raising 'SQLSTATE' ''45000''.

Signals can be raised within exception handlers:

     CREATE PROCEDURE p ()
     BEGIN
       DECLARE EXIT HANDLER FOR SQLEXCEPTION
       BEGIN
         SIGNAL SQLSTATE VALUE '99999'
           SET MESSAGE_TEXT = 'An error occurred';
       END;
       DROP TABLE no_such_table;
     END;

'CALL p()' reaches the *note 'DROP TABLE': drop-table. statement.  There
is no table named 'no_such_table', so the error handler is activated.
The error handler destroys the original error ('no such table') and
makes a new error with 'SQLSTATE' ''99999'' and message 'An error
occurred'.

*Signal Condition Information Items*

The following table lists the names of diagnostics area condition
information items that can be set in a *note 'SIGNAL': signal. (or *note
'RESIGNAL': resignal.) statement.  All items are standard SQL except
'MYSQL_ERRNO', which is a MySQL extension.

     Item Name             Definition
     ---------             ----------
     CLASS_ORIGIN          VARCHAR(64)
     SUBCLASS_ORIGIN       VARCHAR(64)
     CONSTRAINT_CATALOG    VARCHAR(64)
     CONSTRAINT_SCHEMA     VARCHAR(64)
     CONSTRAINT_NAME       VARCHAR(64)
     CATALOG_NAME          VARCHAR(64)
     SCHEMA_NAME           VARCHAR(64)
     TABLE_NAME            VARCHAR(64)
     COLUMN_NAME           VARCHAR(64)
     CURSOR_NAME           VARCHAR(64)
     MESSAGE_TEXT          VARCHAR(128)
     MYSQL_ERRNO           SMALLINT UNSIGNED

The character set for character items is UTF-8.

It is illegal to assign 'NULL' to a condition information item in a
*note 'SIGNAL': signal. statement.

A *note 'SIGNAL': signal. statement always specifies an 'SQLSTATE'
value, either directly, or indirectly by referring to a named condition
defined with an 'SQLSTATE' value.  The first two characters of an
'SQLSTATE' value are its class, and the class determines the default
value for the condition information items:

   * Class = ''00'' (success)

     Illegal.  'SQLSTATE' values that begin with ''00'' indicate success
     and are not valid for *note 'SIGNAL': signal.

   * Class = ''01'' (warning)

          MESSAGE_TEXT = 'Unhandled user-defined warning condition';
          MYSQL_ERRNO = ER_SIGNAL_WARN

   * Class = ''02'' (not found)

          MESSAGE_TEXT = 'Unhandled user-defined not found condition';
          MYSQL_ERRNO = ER_SIGNAL_NOT_FOUND

   * Class > ''02'' (exception)

          MESSAGE_TEXT = 'Unhandled user-defined exception condition';
          MYSQL_ERRNO = ER_SIGNAL_EXCEPTION

For legal classes, the other condition information items are set as
follows:

     CLASS_ORIGIN = SUBCLASS_ORIGIN = '';
     CONSTRAINT_CATALOG = CONSTRAINT_SCHEMA = CONSTRAINT_NAME = '';
     CATALOG_NAME = SCHEMA_NAME = TABLE_NAME = COLUMN_NAME = '';
     CURSOR_NAME = '';

The error values that are accessible after *note 'SIGNAL': signal.
executes are the 'SQLSTATE' value raised by the *note 'SIGNAL': signal.
statement and the 'MESSAGE_TEXT' and 'MYSQL_ERRNO' items.  These values
are available from the C API:

   * *note 'mysql_sqlstate()': mysql-sqlstate. returns the 'SQLSTATE'
     value.

   * *note 'mysql_errno()': mysql-errno. returns the 'MYSQL_ERRNO'
     value.

   * *note 'mysql_error()': mysql-error. returns the 'MESSAGE_TEXT'
     value.

At the SQL level, the output from *note 'SHOW WARNINGS': show-warnings.
and *note 'SHOW ERRORS': show-errors. indicates the 'MYSQL_ERRNO' and
'MESSAGE_TEXT' values in the 'Code' and 'Message' columns.

Other condition information items can be set, but currently have no
effect, in the sense that they are not accessible from error returns.
For example, you can set 'CLASS_ORIGIN' in a *note 'SIGNAL': signal.
statement, but cannot see it after *note 'SIGNAL': signal. executes.  In
MySQL 5.6, condition information can be inspected with the 'GET
DIAGNOSTICS' statement.

*Effect of Signals on Handlers, Cursors, and Statements*

Signals have different effects on statement execution depending on the
signal class.  The class determines how severe an error is.  MySQL
ignores the value of the 'sql_mode' system variable; in particular,
strict SQL mode does not matter.  MySQL also ignores 'IGNORE': The
intent of *note 'SIGNAL': signal. is to raise a user-generated error
explicitly, so a signal is never ignored.

In the following descriptions, 'unhandled' means that no handler for the
signaled 'SQLSTATE' value has been defined with *note 'DECLARE ...
HANDLER': declare-handler.

   * Class = ''00'' (success)

     Illegal.  'SQLSTATE' values that begin with ''00'' indicate success
     and are not valid for *note 'SIGNAL': signal.

   * Class = ''01'' (warning)

     The value of the 'warning_count' system variable goes up.  *note
     'SHOW WARNINGS': show-warnings. shows the signal.  'SQLWARNING'
     handlers catch the signal.  If the signal is unhandled in a stored
     function, statements do not end.

   * Class = ''02'' (not found)

     'NOT FOUND' handlers catch the signal.  There is no effect on
     cursors.  If the signal is unhandled in a stored function,
     statements end.

   * Class > ''02'' (exception)

     'SQLEXCEPTION' handlers catch the signal.  If the signal is
     unhandled in a stored function, statements end.

   * Class = ''40''

     Treated as an ordinary exception.

Example:

     delimiter //
     CREATE FUNCTION f () RETURNS INT
     BEGIN
       SIGNAL SQLSTATE '01234';  -- signal a warning
       RETURN 5;
     END//
     delimiter ;
     CREATE TABLE t (s1 INT);
     INSERT INTO t VALUES (f());

The result is that a row containing 5 is inserted into table 't'.  The
warning that is signaled can be viewed with *note 'SHOW WARNINGS':
show-warnings.

*Note*:

The preceding example works as described in MySQL 5.5 because *note
'RETURN': return. does not clear diagnostics as prescribed by standard
SQL. In MySQL 5.6 and higher, no warning is returned: *note 'RETURN':
return. clears the diagnostics area, so there is no way to return an SQL
warning from a stored function.  This change is not backward compatible,
but the resulting behavior is more like standard SQL.


File: manual.info.tmp,  Node: conditions-and-parameters,  Next: condition-handling-restrictions,  Prev: signal,  Up: condition-handling

13.6.7.5 Condition Handling and OUT or INOUT Parameters
.......................................................

If a stored procedure exits with an unhandled exception, modified values
of 'OUT' and 'INOUT' parameters are not propogated back to the caller.

If an exception is handled by a 'CONTINUE' or 'EXIT' handler that
contains a *note 'RESIGNAL': resignal. statement, execution of *note
'RESIGNAL': resignal. signals the exception (that is, the information
that existed before entry into the handler).  If the exception is an
error, the values of 'OUT' and 'INOUT' parameters are not propogated
back to the caller.


File: manual.info.tmp,  Node: condition-handling-restrictions,  Prev: conditions-and-parameters,  Up: condition-handling

13.6.7.6 Restrictions on Condition Handling
...........................................

*note 'SIGNAL': signal. and *note 'RESIGNAL': resignal. are not
permissible as prepared statements.  For example, this statement is
invalid:

     PREPARE stmt1 FROM 'SIGNAL SQLSTATE "02000"';

'SQLSTATE' values in class ''04'' are not treated specially.  They are
handled the same as other exceptions.


File: manual.info.tmp,  Node: sql-server-administration-statements,  Next: sql-utility-statements,  Prev: sql-compound-statements,  Up: sql-statements

13.7 Database Administration Statements
=======================================

* Menu:

* account-management-statements::  Account Management Statements
* table-maintenance-statements::  Table Maintenance Statements
* component-statements::         Plugin and User-Defined Function Statements
* set-statement::                SET Statements
* show::                         SHOW Statements
* other-administrative-statements::  Other Administrative Statements


File: manual.info.tmp,  Node: account-management-statements,  Next: table-maintenance-statements,  Prev: sql-server-administration-statements,  Up: sql-server-administration-statements

13.7.1 Account Management Statements
------------------------------------

* Menu:

* create-user::                  CREATE USER Statement
* drop-user::                    DROP USER Statement
* grant::                        GRANT Statement
* rename-user::                  RENAME USER Statement
* revoke::                       REVOKE Statement
* set-password::                 SET PASSWORD Statement

MySQL account information is stored in the tables of the 'mysql' system
database.  This database and the access control system are discussed
extensively in *note server-administration::, which you should consult
for additional details.

*Important*:

Some MySQL releases introduce changes to the grant tables to add new
privileges or features.  To make sure that you can take advantage of any
new capabilities, update your grant tables to the current structure
whenever you upgrade MySQL. See *note upgrading::.

When the 'read_only' system variable is enabled, account-management
statements require the 'SUPER' privilege, in addition to any other
required privileges.  This is because they modify tables in the 'mysql'
system database.


File: manual.info.tmp,  Node: create-user,  Next: drop-user,  Prev: account-management-statements,  Up: account-management-statements

13.7.1.1 CREATE USER Statement
..............................

     CREATE USER
         USER [AUTH_OPTION] [, USER [AUTH_OPTION]] ...

     USER:
         (see *note account-names::)

     AUTH_OPTION: {
         IDENTIFIED BY [PASSWORD] 'AUTH_STRING'
       | IDENTIFIED WITH AUTH_PLUGIN [AS 'AUTH_STRING']
     }

The *note 'CREATE USER': create-user. statement creates new MySQL
accounts.  An error occurs if you try to create an account that already
exists.

To use *note 'CREATE USER': create-user, you must have the global
'CREATE USER' privilege, or the 'INSERT' privilege for the 'mysql'
system database.  When the 'read_only' system variable is enabled, *note
'CREATE USER': create-user. additionally requires the 'SUPER' privilege.

*Important*:

*note 'CREATE USER': create-user. may be recorded in server logs or on
the client side in a history file such as '~/.mysql_history', which
means that cleartext passwords may be read by anyone having read access
to that information.  For information about password logging in the
server logs, see *note password-logging::.  For similar information
about client-side logging, see *note mysql-logging::.

For each account, *note 'CREATE USER': create-user. creates a new row in
the 'mysql.user' system table with no privileges and assigns the account
an authentication plugin.  Depending on the syntax used, *note 'CREATE
USER': create-user. may also assign the account a password.

An account when first created has no privileges.  To assign privileges,
use the *note 'GRANT': grant. statement.

Each USER value naming an account may be followed by an optional
AUTH_OPTION value that specifies how authentication occurs for clients
that use the account.  This part of *note 'CREATE USER': create-user.
syntax is shared with *note 'GRANT': grant, so the description here
applies to *note 'GRANT': grant. as well.

Each account name uses the format described in *note account-names::.
For example:

     CREATE USER 'jeffrey'@'localhost' IDENTIFIED BY 'PASSWORD';

The host name part of the account name, if omitted, defaults to ''%''.

The server assigns an authentication plugin and password to each account
as follows, depending on whether the user specification clause includes
'IDENTIFIED BY' or 'IDENTIFIED WITH' to specify authentication
information:

   * With 'IDENTIFIED BY', the server assigns no plugin.  The
     ''AUTH_STRING'' value is cleartext, which is hashed before being
     stored as the password.  If the optional 'PASSWORD' keyword is
     given, the behavior is the same except that if the plugin requires
     a hashed string, the string is assumed to be already hashed in the
     format the plugin requires, and is stored as is as the password.

   * With 'IDENTIFIED WITH', the server assigns the specified plugin and
     the account has no password.  If the optional 'AS 'AUTH_STRING''
     clause is given, the string is stored as is as the password.  If
     the plugin requires a hashed string, the string is assumed to be
     already hashed in the format the plugin requires.

   * With neither 'IDENTIFIED BY' nor 'IDENTIFIED WITH', the server
     assigns no plugin and the account has no password.

If the account has no password, the password information in the account
row in the 'mysql.user' table remains empty, which is insecure.  To set
the password, use *note 'SET PASSWORD': set-password.  See *note
set-password::.

If the server assigns no plugin to the account, the 'plugin' column in
the account's 'mysql.user' table row remains empty.

For client connections that use a given account, the server invokes the
authentication plugin assigned to the account and the client must
provide credentials as required by the authentication method that the
plugin implements.  If the server cannot find the plugin, either at
account-creation time or connect time, an error occurs.

If an account's 'mysql.user' table row has a nonempty 'plugin' column:

   * The server authenticates client connection attempts using the named
     plugin.

   * Changes to the account password using *note 'SET PASSWORD':
     set-password. with 'PASSWORD()' must be made with the
     'old_passwords' system variable set to the value required by the
     authentication plugin, so that 'PASSWORD()' uses the appropriate
     password hashing method.  If the plugin is 'mysql_old_password',
     the password can also be changed using *note 'SET PASSWORD':
     set-password. with 'OLD_PASSWORD()', which uses pre-4.1 password
     hashing regardless of the value of 'old_passwords'.

If an account's 'mysql.user' table row has an empty 'plugin' column:

   * The server authenticates client connection attempts using the
     'mysql_native_password' or 'mysql_old_password' authentication
     plugin, depending on the hash format of the password stored in the
     'Password' column.

   * Changes to the account password using *note 'SET PASSWORD':
     set-password. can be made with 'PASSWORD()', with 'old_passwords'
     set to 0 or 1 for 4.1 or pre-4.1 password hashing, respectively, or
     with 'OLD_PASSWORD()', which uses pre-4.1 password hashing
     regardless of the value of 'old_passwords'.

*note 'CREATE USER': create-user. examples:

   * To specify an authentication plugin for an account, use 'IDENTIFIED
     WITH AUTH_PLUGIN'.  The plugin name can be a quoted string literal
     or an unquoted name.  ''AUTH_STRING'' is an optional quoted string
     literal to pass to the plugin.  The plugin interprets the meaning
     of the string, so its format is plugin specific and it is stored in
     the 'authentication_string' column as given.  (This value is
     meaningful only for plugins that use that column.)  Consult the
     documentation for a given plugin for information about the
     authentication string values it accepts, if any.

          CREATE USER 'jeffrey'@'localhost' IDENTIFIED WITH mysql_native_password;

     The server assigns the given authentication plugin to the account
     but no password.  Clients must provide no password when they
     connect.  However, an account with no password is insecure.  To
     ensure that an account uses a specific authentication plugin and
     has a password with the corresponding hash format, specify the
     plugin explicitly with 'IDENTIFIED WITH', then use *note 'SET
     PASSWORD': set-password. to set the password:

          CREATE USER 'jeffrey'@'localhost' IDENTIFIED WITH mysql_native_password;
          SET old_passwords = 0;
          SET PASSWORD FOR 'jeffrey'@'localhost' = PASSWORD('PASSWORD');

     Changes to the account password using *note 'SET PASSWORD':
     set-password. with 'PASSWORD()' must be made with the
     'old_passwords' system variable set to the value required by the
     account's authentication plugin, so that 'PASSWORD()' uses the
     appropriate password hashing method.  Therefore, to use the
     'mysql_old_password' plugin instead, name that plugin in the *note
     'CREATE USER': create-user. statement and set 'old_passwords' to 1
     before using *note 'SET PASSWORD': set-password.

   * To specify a password for an account at account-creation time, use
     'IDENTIFIED BY' with the literal cleartext password value:

          CREATE USER 'jeffrey'@'localhost' IDENTIFIED BY 'PASSWORD';

     The server assigns the given password to the account but no
     authentication plugin.  Clients must provide the password when they
     connect.

   * To avoid specifying the cleartext password if you know its hash
     value (the value that 'PASSWORD()' would return for the password),
     specify the hash value preceded by the keyword 'PASSWORD':

          CREATE USER 'jeffrey'@'localhost'
          IDENTIFIED BY PASSWORD '*90E462C37378CED12064BB3388827D2BA3A9B689';

     The server assigns the given password to the account but no
     authentication plugin.  Clients must provide the password when they
     connect.

   * To enable the user to connect with no password, include no
     'IDENTIFIED BY' clause:

          CREATE USER 'jeffrey'@'localhost';

     The server assigns no authentication plugin or password to the
     account.  Clients must provide no password when they connect.
     However, an account with no password is insecure.  To avoid this,
     use *note 'SET PASSWORD': set-password. to set the account
     password.

For additional information about setting passwords and authentication
plugins, see *note assigning-passwords::, and *note
pluggable-authentication::.


File: manual.info.tmp,  Node: drop-user,  Next: grant,  Prev: create-user,  Up: account-management-statements

13.7.1.2 DROP USER Statement
............................

     DROP USER USER [, USER] ...

The *note 'DROP USER': drop-user. statement removes one or more MySQL
accounts and their privileges.  It removes privilege rows for the
account from all grant tables.  An error occurs for accounts that do not
exist.

To use *note 'DROP USER': drop-user, you must have the global 'CREATE
USER' privilege, or the 'DELETE' privilege for the 'mysql' system
database.  When the 'read_only' system variable is enabled, *note 'DROP
USER': drop-user. additionally requires the 'SUPER' privilege.

Each account name uses the format described in *note account-names::.
For example:

     DROP USER 'jeffrey'@'localhost';

The host name part of the account name, if omitted, defaults to ''%''.

*Important*:

*note 'DROP USER': drop-user. does not automatically close any open user
sessions.  Rather, in the event that a user with an open session is
dropped, the statement does not take effect until that user's session is
closed.  Once the session is closed, the user is dropped, and that
user's next attempt to log in will fail.  _This is by design_.

*note 'DROP USER': drop-user. does not automatically drop or invalidate
databases or objects within them that the old user created.  This
includes stored programs or views for which the 'DEFINER' attribute
names the dropped user.  Attempts to access such objects may produce an
error if they execute in definer security context.  (For information
about security context, see *note stored-objects-security::.)


File: manual.info.tmp,  Node: grant,  Next: rename-user,  Prev: drop-user,  Up: account-management-statements

13.7.1.3 GRANT Statement
........................

     GRANT
         PRIV_TYPE [(COLUMN_LIST)]
           [, PRIV_TYPE [(COLUMN_LIST)]] ...
         ON [OBJECT_TYPE] PRIV_LEVEL
         TO USER [AUTH_OPTION] [, USER [AUTH_OPTION]] ...
         [REQUIRE {NONE | TLS_OPTION [[AND] TLS_OPTION] ...}]
         [WITH {GRANT OPTION | RESOURCE_OPTION} ...]

     GRANT PROXY ON USER
         TO USER [, USER] ...
         [WITH GRANT OPTION]

     OBJECT_TYPE: {
         TABLE
       | FUNCTION
       | PROCEDURE
     }

     PRIV_LEVEL: {
         *
       | *.*
       | DB_NAME.*
       | DB_NAME.TBL_NAME
       | TBL_NAME
       | DB_NAME.ROUTINE_NAME
     }

     USER:
         (see *note account-names::)

     AUTH_OPTION: {
         IDENTIFIED BY [PASSWORD] 'AUTH_STRING'
       | IDENTIFIED WITH AUTH_PLUGIN
       | IDENTIFIED WITH AUTH_PLUGIN AS 'AUTH_STRING'
     }

     TLS_OPTION: {
         SSL
       | X509
       | CIPHER 'CIPHER'
       | ISSUER 'ISSUER'
       | SUBJECT 'SUBJECT'
     }

     RESOURCE_OPTION: {
       | MAX_QUERIES_PER_HOUR COUNT
       | MAX_UPDATES_PER_HOUR COUNT
       | MAX_CONNECTIONS_PER_HOUR COUNT
       | MAX_USER_CONNECTIONS COUNT
     }

The *note 'GRANT': grant. statement grants privileges to MySQL user
accounts.  There are several aspects to the *note 'GRANT': grant.
statement, described under the following topics:

   * *note grant-overview::

   * *note grant-quoting::

   * *note grant-accounts-passwords::

   * *note grant-privileges::

   * *note grant-global-privileges::

   * *note grant-database-privileges::

   * *note grant-table-privileges::

   * *note grant-column-privileges::

   * *note grant-routine-privileges::

   * *note grant-proxy-privileges::

   * *note grant-account-creation::

   * *note grant-other-characteristics::

   * *note grant-mysql-vs-standard-sql::

*GRANT General Overview*

The *note 'GRANT': grant. statement grants privileges to MySQL user
accounts.  *note 'GRANT': grant. also serves to specify other account
characteristics such as use of secure connections and limits on access
to server resources.

To use *note 'GRANT': grant, you must have the 'GRANT OPTION' privilege,
and you must have the privileges that you are granting.  When the
'read_only' system variable is enabled, *note 'GRANT': grant.
additionally requires the 'SUPER' privilege.

The *note 'REVOKE': revoke. statement is related to *note 'GRANT':
grant. and enables administrators to remove account privileges.  See
*note revoke::.

Each account name uses the format described in *note account-names::.
For example:

     GRANT ALL ON db1.* TO 'jeffrey'@'localhost';

The host name part of the account, if omitted, defaults to ''%''.

Normally, a database administrator first uses *note 'CREATE USER':
create-user. to create an account, then *note 'GRANT': grant. to define
its privileges and characteristics.  For example:

     CREATE USER 'jeffrey'@'localhost' IDENTIFIED BY 'PASSWORD';
     GRANT ALL ON db1.* TO 'jeffrey'@'localhost';
     GRANT SELECT ON db2.invoice TO 'jeffrey'@'localhost';
     GRANT USAGE ON *.* TO 'jeffrey'@'localhost' WITH MAX_QUERIES_PER_HOUR 90;

*Note*:

Examples shown here include no 'IDENTIFIED' clause.  It is assumed that
you establish passwords with *note 'CREATE USER': create-user. at
account-creation time to avoid creating insecure accounts.

If an account named in a *note 'GRANT': grant. statement does not
already exist, *note 'GRANT': grant. may create it under the conditions
described later in the discussion of the 'NO_AUTO_CREATE_USER' SQL mode.

From the *note 'mysql': mysql. program, *note 'GRANT': grant. responds
with 'Query OK, 0 rows affected' when executed successfully.  To
determine what privileges result from the operation, use *note 'SHOW
GRANTS': show-grants.  See *note show-grants::.

*Important*:

*note 'GRANT': grant. may be recorded in server logs or on the client
side in a history file such as '~/.mysql_history', which means that
cleartext passwords may be read by anyone having read access to that
information.  For information about password logging in the server logs,
see *note password-logging::.  For similar information about client-side
logging, see *note mysql-logging::.

*note 'GRANT': grant. supports host names up to 60 characters long.
User names can be up to 16 characters.  Database, table, column, and
routine names can be up to 64 characters.

*Warning*:

_Do not attempt to change the permissible length for user names by
altering the 'mysql.user' system table.  Doing so results in
unpredictable behavior which may even make it impossible for users to
log in to the MySQL server_.  Never alter the structure of tables in the
'mysql' system database in any manner except by means of the procedure
described in *note upgrading::.

*Object Quoting Guidelines*

Several objects within *note 'GRANT': grant. statements are subject to
quoting, although quoting is optional in many cases: Account, database,
table, column, and routine names.  For example, if a USER_NAME or
HOST_NAME value in an account name is legal as an unquoted identifier,
you need not quote it.  However, quotation marks are necessary to
specify a USER_NAME string containing special characters (such as '-'),
or a HOST_NAME string containing special characters or wildcard
characters such as '%' (for example, ''test-user'@'%.com'').  Quote the
user name and host name separately.

To specify quoted values:

   * Quote database, table, column, and routine names as identifiers.

   * Quote user names and host names as identifiers or as strings.

   * Quote passwords as strings.

For string-quoting and identifier-quoting guidelines, see *note
string-literals::, and *note identifiers::.

The '_' and '%' wildcards are permitted when specifying database names
in *note 'GRANT': grant. statements that grant privileges at the
database level ('GRANT ... ON DB_NAME.*').  This means, for example,
that to use a '_' character as part of a database name, specify it as
'\_' in the *note 'GRANT': grant. statement, to prevent the user from
being able to access additional databases matching the wildcard pattern
(for example, 'GRANT ... ON `foo\_bar`.* TO ...').

When a database name not is used to grant privileges at the database
level, but as a qualifier for granting privileges to some other object
such as a table or routine (for example, 'GRANT ... ON
DB_NAME.TBL_NAME'), wildcard characters are treated as normal
characters.

*Account Names and Passwords*

A USER value in a *note 'GRANT': grant. statement indicates a MySQL
account to which the statement applies.  To accommodate granting rights
to users from arbitrary hosts, MySQL supports specifying the USER value
in the form ''USER_NAME'@'HOST_NAME''.

You can specify wildcards in the host name.  For example,
''USER_NAME'@'%.example.com'' applies to USER_NAME for any host in the
'example.com' domain, and ''USER_NAME'@'198.51.100.%'' applies to
USER_NAME for any host in the '198.51.100' class C subnet.

The simple form ''USER_NAME'' is a synonym for ''USER_NAME'@'%''.

_MySQL does not support wildcards in user names_.  To refer to an
anonymous user, specify an account with an empty user name with the
*note 'GRANT': grant. statement:

     GRANT ALL ON test.* TO ''@'localhost' ...;

In this case, any user who connects from the local host with the correct
password for the anonymous user will be permitted access, with the
privileges associated with the anonymous-user account.

For additional information about user name and host name values in
account names, see *note account-names::.

*Warning*:

If you permit local anonymous users to connect to the MySQL server, you
should also grant privileges to all local users as
''USER_NAME'@'localhost''.  Otherwise, the anonymous user account for
'localhost' in the 'mysql.user' system table (created during MySQL
installation) is used when named users try to log in to the MySQL server
from the local machine.  For details, see *note connection-access::.

To determine whether this issue applies to you, execute the following
query, which lists any anonymous users:

     SELECT Host, User FROM mysql.user WHERE User='';

To avoid the problem just described, delete the local anonymous user
account using this statement:

     DROP USER ''@'localhost';

For *note 'GRANT': grant. syntax that permits an AUTH_OPTION value to
follow a USER value, AUTH_OPTION begins with 'IDENTIFIED' and indicates
how the account authenticates by specifying an account authentication
plugin, credentials (for example, a password), or both.  Syntax of the
AUTH_OPTION clause is the same as for the *note 'CREATE USER':
create-user. statement.  For details, see *note create-user::.

When 'IDENTIFIED' is present and you have the global grant privilege
('GRANT OPTION'), any password specified becomes the new password for
the account, even if the account exists and already has a password.
Without 'IDENTIFIED', the account password remains unchanged.

*Privileges Supported by MySQL*

The following table summarizes the permissible PRIV_TYPE privilege types
that can be specified for the *note 'GRANT': grant. and *note 'REVOKE':
revoke. statements, and the levels at which each privilege can be
granted.  For additional information about each privilege, see *note
privileges-provided::.

*Permissible Privileges for GRANT and REVOKE*

Privilege              Meaning and Grantable Levels
                       
'ALL [PRIVILEGES]'     Grant all privileges at specified access level
                       except 'GRANT OPTION' and 'PROXY'.
                       
'ALTER'                Enable use of *note 'ALTER TABLE': alter-table.
                       Levels: Global, database, table.
                       
'ALTER ROUTINE'        Enable stored routines to be altered or dropped.
                       Levels: Global, database, routine.
                       
'CREATE'               Enable database and table creation.  Levels:
                       Global, database, table.
                       
'CREATE ROUTINE'       Enable stored routine creation.  Levels: Global,
                       database.
                       
'CREATE TABLESPACE'    Enable tablespaces and log file groups to be
                       created, altered, or dropped.  Level: Global.
                       
'CREATE TEMPORARY      Enable use of
TABLES'                *note 'CREATE TEMPORARY TABLE': create-table.
                       Levels: Global, database.
                       
'CREATE USER'          Enable use of *note 'CREATE USER': create-user,
                       *note 'DROP USER': drop-user,
                       *note 'RENAME USER': rename-user, and
                       *note 'REVOKE ALL PRIVILEGES': revoke.  Level:
                       Global.
                       
'CREATE VIEW'          Enable views to be created or altered.  Levels:
                       Global, database, table.
                       
'DELETE'               Enable use of *note 'DELETE': delete.  Level:
                       Global, database, table.
                       
'DROP'                 Enable databases, tables, and views to be
                       dropped.  Levels: Global, database, table.
                       
'EVENT'                Enable use of events for the Event Scheduler.
                       Levels: Global, database.
                       
'EXECUTE'              Enable the user to execute stored routines.
                       Levels: Global, database, routine.
                       
'FILE'                 Enable the user to cause the server to read or
                       write files.  Level: Global.
                       
'GRANT OPTION'         Enable privileges to be granted to or removed
                       from other accounts.  Levels: Global, database,
                       table, routine, proxy.
                       
'INDEX'                Enable indexes to be created or dropped.
                       Levels: Global, database, table.
                       
'INSERT'               Enable use of *note 'INSERT': insert.  Levels:
                       Global, database, table, column.
                       
'LOCK TABLES'          Enable use of *note 'LOCK TABLES': lock-tables.
                       on tables for which you have the
                       *note 'SELECT': select. privilege.  Levels:
                       Global, database.
                       
'PROCESS'              Enable the user to see all processes with
                       *note 'SHOW PROCESSLIST': show-processlist.
                       Level: Global.
                       
'PROXY'                Enable user proxying.  Level: From user to user.
                       
'REFERENCES'           Enable foreign key creation.  Levels: Global,
                       database, table, column.
                       
'RELOAD'               Enable use of *note 'FLUSH': flush. operations.
                       Level: Global.
                       
'REPLICATION CLIENT'   Enable the user to ask where master or slave
                       servers are.  Level: Global.
                       
'REPLICATION SLAVE'    Enable replication slaves to read binary log
                       events from the master.  Level: Global.
                       
'SELECT'               Enable use of *note 'SELECT': select.  Levels:
                       Global, database, table, column.
                       
'SHOW DATABASES'       Enable *note 'SHOW DATABASES': show-databases.
                       to show all databases.  Level: Global.
                       
'SHOW VIEW'            Enable use of
                       *note 'SHOW CREATE VIEW': show-create-view.
                       Levels: Global, database, table.
                       
'SHUTDOWN'             Enable use of
                       *note 'mysqladmin shutdown': mysqladmin.  Level:
                       Global.
                       
'SUPER'                Enable use of other administrative operations
                       such as
                       *note 'CHANGE MASTER TO': change-master-to,
                       *note 'KILL': kill,
                       *note 'PURGE BINARY LOGS': purge-binary-logs,
                       *note 'SET GLOBAL': set-variable, and
                       *note 'mysqladmin debug': mysqladmin. command.
                       Level: Global.
                       
'TRIGGER'              Enable trigger operations.  Levels: Global,
                       database, table.
                       
'UPDATE'               Enable use of *note 'UPDATE': update.  Levels:
                       Global, database, table, column.
                       
'USAGE'                Synonym for 'no privileges'

A trigger is associated with a table.  To create or drop a trigger, you
must have the 'TRIGGER' privilege for the table, not the trigger.

In *note 'GRANT': grant. statements, the 'ALL [PRIVILEGES]' or 'PROXY'
privilege must be named by itself and cannot be specified along with
other privileges.  'ALL [PRIVILEGES]' stands for all privileges
available for the level at which privileges are to be granted except for
the 'GRANT OPTION' and 'PROXY' privileges.

'USAGE' can be specified to create a user that has no privileges, or to
specify the 'REQUIRE' or 'WITH' clauses for an account without changing
its existing privileges.

MySQL account information is stored in the tables of the 'mysql' system
database.  For additional details, consult *note access-control::, which
discusses the 'mysql' system database and the access control system
extensively.

If the grant tables hold privilege rows that contain mixed-case database
or table names and the 'lower_case_table_names' system variable is set
to a nonzero value, *note 'REVOKE': revoke. cannot be used to revoke
these privileges.  It will be necessary to manipulate the grant tables
directly.  (*note 'GRANT': grant. will not create such rows when
'lower_case_table_names' is set, but such rows might have been created
prior to setting that variable.)

Privileges can be granted at several levels, depending on the syntax
used for the 'ON' clause.  For *note 'REVOKE': revoke, the same 'ON'
syntax specifies which privileges to remove.

For the global, database, table, and routine levels, *note 'GRANT ALL':
grant. assigns only the privileges that exist at the level you are
granting.  For example, 'GRANT ALL ON DB_NAME.*' is a database-level
statement, so it does not grant any global-only privileges such as
'FILE'.  Granting 'ALL' does not assign the 'GRANT OPTION' or 'PROXY'
privilege.

The OBJECT_TYPE clause, if present, should be specified as 'TABLE',
'FUNCTION', or 'PROCEDURE' when the following object is a table, a
stored function, or a stored procedure.

The privileges that a user holds for a database, table, column, or
routine are formed additively as the logical 'OR' of the account
privileges at each of the privilege levels, including the global level.
It is not possible to deny a privilege granted at a higher level by
absence of that privilege at a lower level.  For example, this statement
grants the 'SELECT' and 'INSERT' privileges globally:

     GRANT SELECT, INSERT ON *.* TO u1;

The globally granted privileges apply to all databases, tables, and
columns, even though not granted at a