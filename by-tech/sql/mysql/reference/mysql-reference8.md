------------+
     | CHARACTER_SETS                        |
     | COLLATIONS                            |
     | COLLATION_CHARACTER_SET_APPLICABILITY |
     | COLUMNS                               |
     | COLUMN_PRIVILEGES                     |
     | ENGINES                               |
     | EVENTS                                |
     | FILES                                 |
     | GLOBAL_STATUS                         |
     | GLOBAL_VARIABLES                      |
     | KEY_COLUMN_USAGE                      |
     | PARTITIONS                            |
     | PLUGINS                               |
     | PROCESSLIST                           |
     | REFERENTIAL_CONSTRAINTS               |
     | ROUTINES                              |
     | SCHEMATA                              |
     | SCHEMA_PRIVILEGES                     |
     | SESSION_STATUS                        |
     | SESSION_VARIABLES                     |
     | STATISTICS                            |
     | TABLES                                |
     | TABLE_CONSTRAINTS                     |
     | TABLE_PRIVILEGES                      |
     | TRIGGERS                              |
     | USER_PRIVILEGES                       |
     | VIEWS                                 |
     +---------------------------------------+

*note 'SHOW COLUMNS': show-columns. and *note 'DESCRIBE': describe. can
display information about the columns in individual 'INFORMATION_SCHEMA'
tables.

*note 'SHOW': show. statements that accept a 'LIKE' clause to limit the
rows displayed also permit a 'WHERE' clause that specifies more general
conditions that selected rows must satisfy:

     SHOW CHARACTER SET
     SHOW COLLATION
     SHOW COLUMNS
     SHOW DATABASES
     SHOW FUNCTION STATUS
     SHOW INDEX
     SHOW OPEN TABLES
     SHOW PROCEDURE STATUS
     SHOW STATUS
     SHOW TABLE STATUS
     SHOW TABLES
     SHOW TRIGGERS
     SHOW VARIABLES

The 'WHERE' clause, if present, is evaluated against the column names
displayed by the *note 'SHOW': show. statement.  For example, the *note
'SHOW CHARACTER SET': show-character-set. statement produces these
output columns:

     mysql> SHOW CHARACTER SET;
     +----------+-----------------------------+---------------------+--------+
     | Charset  | Description                 | Default collation   | Maxlen |
     +----------+-----------------------------+---------------------+--------+
     | big5     | Big5 Traditional Chinese    | big5_chinese_ci     |      2 |
     | dec8     | DEC West European           | dec8_swedish_ci     |      1 |
     | cp850    | DOS West European           | cp850_general_ci    |      1 |
     | hp8      | HP West European            | hp8_english_ci      |      1 |
     | koi8r    | KOI8-R Relcom Russian       | koi8r_general_ci    |      1 |
     | latin1   | cp1252 West European        | latin1_swedish_ci   |      1 |
     | latin2   | ISO 8859-2 Central European | latin2_general_ci   |      1 |
     ...

To use a 'WHERE' clause with *note 'SHOW CHARACTER SET':
show-character-set, you would refer to those column names.  As an
example, the following statement displays information about character
sets for which the default collation contains the string ''japanese'':

     mysql> SHOW CHARACTER SET WHERE `Default collation` LIKE '%japanese%';
     +---------+---------------------------+---------------------+--------+
     | Charset | Description               | Default collation   | Maxlen |
     +---------+---------------------------+---------------------+--------+
     | ujis    | EUC-JP Japanese           | ujis_japanese_ci    |      3 |
     | sjis    | Shift-JIS Japanese        | sjis_japanese_ci    |      2 |
     | cp932   | SJIS for Windows Japanese | cp932_japanese_ci   |      2 |
     | eucjpms | UJIS for Windows Japanese | eucjpms_japanese_ci |      3 |
     +---------+---------------------------+---------------------+--------+

This statement displays the multibyte character sets:

     mysql> SHOW CHARACTER SET WHERE Maxlen > 1;
     +---------+---------------------------+---------------------+--------+
     | Charset | Description               | Default collation   | Maxlen |
     +---------+---------------------------+---------------------+--------+
     | big5    | Big5 Traditional Chinese  | big5_chinese_ci     |      2 |
     | ujis    | EUC-JP Japanese           | ujis_japanese_ci    |      3 |
     | sjis    | Shift-JIS Japanese        | sjis_japanese_ci    |      2 |
     | euckr   | EUC-KR Korean             | euckr_korean_ci     |      2 |
     | gb2312  | GB2312 Simplified Chinese | gb2312_chinese_ci   |      2 |
     | gbk     | GBK Simplified Chinese    | gbk_chinese_ci      |      2 |
     | utf8    | UTF-8 Unicode             | utf8_general_ci     |      3 |
     | ucs2    | UCS-2 Unicode             | ucs2_general_ci     |      2 |
     | cp932   | SJIS for Windows Japanese | cp932_japanese_ci   |      2 |
     | eucjpms | UJIS for Windows Japanese | eucjpms_japanese_ci |      3 |
     +---------+---------------------------+---------------------+--------+


File: manual.info.tmp,  Node: performance-schema,  Next: connectors-apis,  Prev: information-schema,  Up: Top

22 MySQL Performance Schema
***************************

* Menu:

* performance-schema-quick-start::  Performance Schema Quick Start
* performance-schema-build-configuration::  Performance Schema Build Configuration
* performance-schema-startup-configuration::  Performance Schema Startup Configuration
* performance-schema-runtime-configuration::  Performance Schema Runtime Configuration
* performance-schema-queries::   Performance Schema Queries
* performance-schema-instrument-naming::  Performance Schema Instrument Naming Conventions
* performance-schema-status-monitoring::  Performance Schema Status Monitoring
* performance-schema-event-tables::  Performance Schema Tables for Current and Historical Events
* performance-schema-table-characteristics::  Performance Schema General Table Characteristics
* performance-schema-table-descriptions::  Performance Schema Table Descriptions
* performance-schema-option-variable-reference::  Performance Schema Option and Variable Reference
* performance-schema-system-variables::  Performance Schema System Variables
* performance-schema-status-variables::  Performance Schema Status Variables
* performance-schema-and-plugins::  Performance Schema and Plugins
* performance-schema-examples::  Using the Performance Schema to Diagnose Problems
* performance-schema-restrictions::  Restrictions on Performance Schema

The MySQL Performance Schema is a feature for monitoring MySQL Server
execution at a low level.  The Performance Schema has these
characteristics:

   * The Performance Schema provides a way to inspect internal execution
     of the server at runtime.  It is implemented using the *note
     'PERFORMANCE_SCHEMA': performance-schema. storage engine and the
     'performance_schema' database.  The Performance Schema focuses
     primarily on performance data.  This differs from
     'INFORMATION_SCHEMA', which serves for inspection of metadata.

   * The Performance Schema monitors server events.  An 'event' is
     anything the server does that takes time and has been instrumented
     so that timing information can be collected.  In general, an event
     could be a function call, a wait for the operating system, a stage
     of an SQL statement execution such as parsing or sorting, or an
     entire statement or group of statements.  Event collection provides
     access to information about synchronization calls (such as for
     mutexes) and file I/O calls for the server and for several storage
     engines.

   * Performance Schema events are distinct from events written to the
     server's binary log (which describe data modifications) and Event
     Scheduler events (which are a type of stored program).

   * Current events are available, as well as event histories and
     summaries.  This enables you to determine how many times
     instrumented activities were performed and how much time they took.
     Event information is available to show the activities of specific
     threads, or activity associated with particular objects such as a
     mutex or file.

   * The *note 'PERFORMANCE_SCHEMA': performance-schema. storage engine
     collects event data using 'instrumentation points' in server source
     code.

   * Collected events are stored in tables in the 'performance_schema'
     database.  These tables can be queried using *note 'SELECT':
     select. statements like other tables.

   * Performance Schema configuration can be modified dynamically by
     updating tables in the 'performance_schema' database through SQL
     statements.  Configuration changes affect data collection
     immediately.

   * Tables in the Performance Schema are in-memory tables that use no
     persistent on-disk storage.  The contents are repopulated beginning
     at server startup and discarded at server shutdown.

   * Monitoring is available on all platforms supported by MySQL.

     Some limitations might apply: The types of timers might vary per
     platform.  Instruments that apply to storage engines might not be
     implemented for all storage engines.  Instrumentation of each
     third-party engine is the responsibility of the engine maintainer.
     See also *note performance-schema-restrictions::.

   * Data collection is implemented by modifying the server source code
     to add instrumentation.  There are no separate threads associated
     with the Performance Schema, unlike other features such as
     replication or the Event Scheduler.

The Performance Schema is intended to provide access to useful
information about server execution while having minimal impact on server
performance.  The implementation follows these design goals:

   * Activating the Performance Schema causes no changes in server
     behavior.  For example, it does not cause thread scheduling to
     change, and it does not cause query execution plans (as shown by
     *note 'EXPLAIN': explain.) to change.

   * No memory allocation is done beyond that which occurs during server
     startup.  By using early allocation of structures with a fixed
     size, it is never necessary to resize or reallocate them, which is
     critical for achieving good runtime performance.

   * Server monitoring occurs continuously and unobtrusively with very
     little overhead.  Activating the Performance Schema does not make
     the server unusable.

   * The parser is unchanged.  There are no new keywords or statements.

   * Execution of server code proceeds normally even if the Performance
     Schema fails internally.

   * When there is a choice between performing processing during event
     collection initially or during event retrieval later, priority is
     given to making collection faster.  This is because collection is
     ongoing whereas retrieval is on demand and might never happen at
     all.

   * It is easy to add new instrumentation points.

   * Instrumentation is versioned.  If the instrumentation
     implementation changes, previously instrumented code will continue
     to work.  This benefits developers of third-party plugins because
     it is not necessary to upgrade each plugin to stay synchronized
     with the latest Performance Schema changes.


File: manual.info.tmp,  Node: performance-schema-quick-start,  Next: performance-schema-build-configuration,  Prev: performance-schema,  Up: performance-schema

22.1 Performance Schema Quick Start
===================================

This section briefly introduces the Performance Schema with examples
that show how to use it.  For additional examples, see *note
performance-schema-examples::.

For the Performance Schema to be available, support for it must have
been configured when MySQL was built.  You can verify whether this is
the case by checking the server's help output.  If the Performance
Schema is available, the output will mention several variables with
names that begin with 'performance_schema':

     shell> mysqld --verbose --help
     ...
       --performance_schema
                           Enable the performance schema.
       --performance_schema_events_waits_history_long_size=#
                           Number of rows in events_waits_history_long.
     ...

If such variables do not appear in the output, your server has not been
built to support the Performance Schema.  In this case, see *note
performance-schema-build-configuration::.

Assuming that the Performance Schema is available, it is disabled by
default.  To enable it, start the server with the 'performance_schema'
variable enabled.  For example, use these lines in the server 'my.cnf'
file:

     [mysqld]
     performance_schema

When the server starts, it sees 'performance_schema' and attempts to
initialize the Performance Schema.  To verify successful initialization,
use this statement:

     mysql> SHOW VARIABLES LIKE 'performance_schema';
     +--------------------+-------+
     | Variable_name      | Value |
     +--------------------+-------+
     | performance_schema | ON    |
     +--------------------+-------+

A value of 'ON' means that the Performance Schema initialized
successfully and is ready for use.  A value of 'OFF' means that some
error occurred.  Check the server error log for information about what
went wrong.

The Performance Schema is implemented as a storage engine.  If this
engine is available (which you should already have checked earlier), you
should see it listed with a 'SUPPORT' value of 'YES' in the output from
the *note 'INFORMATION_SCHEMA.ENGINES': engines-table. table or the
*note 'SHOW ENGINES': show-engines. statement:

     mysql> SELECT * FROM INFORMATION_SCHEMA.ENGINES
            WHERE ENGINE='PERFORMANCE_SCHEMA'\G
     *************************** 1. row ***************************
           ENGINE: PERFORMANCE_SCHEMA
          SUPPORT: YES
          COMMENT: Performance Schema
     TRANSACTIONS: NO
               XA: NO
       SAVEPOINTS: NO

     mysql> SHOW ENGINES\G
     ...
           Engine: PERFORMANCE_SCHEMA
          Support: YES
          Comment: Performance Schema
     Transactions: NO
               XA: NO
       Savepoints: NO
     ...

The *note 'PERFORMANCE_SCHEMA': performance-schema. storage engine
operates on tables in the 'performance_schema' database.  You can make
'performance_schema' the default database so that references to its
tables need not be qualified with the database name:

     mysql> USE performance_schema;

Performance Schema tables are stored in the 'performance_schema'
database.  Information about the structure of this database and its
tables can be obtained, as for any other database, by selecting from the
'INFORMATION_SCHEMA' database or by using *note 'SHOW': show.
statements.  For example, use either of these statements to see what
Performance Schema tables exist:

     mysql> SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
            WHERE TABLE_SCHEMA = 'performance_schema';
     +----------------------------------------------+
     | TABLE_NAME                                   |
     +----------------------------------------------+
     | cond_instances                               |
     | events_waits_current                         |
     | events_waits_history                         |
     | events_waits_history_long                    |
     | events_waits_summary_by_instance             |
     | events_waits_summary_by_thread_by_event_name |
     | events_waits_summary_global_by_event_name    |
     | file_instances                               |
     | file_summary_by_event_name                   |
     | file_summary_by_instance                     |
     | mutex_instances                              |
     | performance_timers                           |
     | rwlock_instances                             |
     | setup_consumers                              |
     | setup_instruments                            |
     | setup_timers                                 |
     | threads                                      |
     +----------------------------------------------+

     mysql> SHOW TABLES FROM performance_schema;
     +----------------------------------------------+
     | Tables_in_performance_schema                 |
     +----------------------------------------------+
     | cond_instances                               |
     | events_waits_current                         |
     | events_waits_history                         |
     ...

The number of Performance Schema tables increases over time as
implementation of additional instrumentation proceeds.

The name of the 'performance_schema' database is lowercase, as are the
names of tables within it.  Queries should specify the names in
lowercase.

To see the structure of individual tables, use *note 'SHOW CREATE
TABLE': show-create-table.:

     mysql> SHOW CREATE TABLE performance_schema.setup_consumers\G
     *************************** 1. row ***************************
            Table: setup_consumers
     Create Table: CREATE TABLE `setup_consumers` (
       `NAME` varchar(64) NOT NULL,
       `ENABLED` enum('YES','NO') NOT NULL
     ) ENGINE=PERFORMANCE_SCHEMA DEFAULT CHARSET=utf8

Table structure is also available by selecting from tables such as *note
'INFORMATION_SCHEMA.COLUMNS': columns-table. or by using statements such
as *note 'SHOW COLUMNS': show-columns.

Tables in the 'performance_schema' database can be grouped according to
the type of information in them: Current events, event histories and
summaries, object instances, and setup (configuration) information.  The
following examples illustrate a few uses for these tables.  For detailed
information about the tables in each group, see *note
performance-schema-table-descriptions::.

To see what the server is doing at the moment, examine the *note
'events_waits_current': events-waits-current-table. table.  It contains
one row per thread showing each thread's most recent monitored event:

     mysql> SELECT *
            FROM performance_schema.events_waits_current\G
     *************************** 1. row ***************************
                 THREAD_ID: 0
                  EVENT_ID: 5523
                EVENT_NAME: wait/synch/mutex/mysys/THR_LOCK::mutex
                    SOURCE: thr_lock.c:525
               TIMER_START: 201660494489586
                 TIMER_END: 201660494576112
                TIMER_WAIT: 86526
                     SPINS: NULL
             OBJECT_SCHEMA: NULL
               OBJECT_NAME: NULL
               OBJECT_TYPE: NULL
     OBJECT_INSTANCE_BEGIN: 142270668
          NESTING_EVENT_ID: NULL
                 OPERATION: lock
           NUMBER_OF_BYTES: NULL
                     FLAGS: 0
     ...

This event indicates that thread 0 was waiting for 86,526 picoseconds to
acquire a lock on 'THR_LOCK::mutex', a mutex in the 'mysys' subsystem.
The first few columns provide the following information:

   * The ID columns indicate which thread the event comes from and the
     event number.

   * 'EVENT_NAME' indicates what was instrumented and 'SOURCE' indicates
     which source file contains the instrumented code.

   * The timer columns show when the event started and stopped and how
     long it took.  If an event is still in progress, the 'TIMER_END'
     and 'TIMER_WAIT' values are 'NULL'.  Timer values are approximate
     and expressed in picoseconds.  For information about timers and
     event time collection, see *note performance-schema-timing::.

The history tables contain the same kind of rows as the current-events
table but have more rows and show what the server has been doing
'recently' rather than 'currently.' The *note 'events_waits_history':
events-waits-history-table. and *note 'events_waits_history_long':
events-waits-history-long-table. tables contain the most recent 10
events per thread and most recent 10,000 events, respectively.  For
example, to see information for recent events produced by thread 13, do
this:

     mysql> SELECT EVENT_ID, EVENT_NAME, TIMER_WAIT
            FROM performance_schema.events_waits_history
            WHERE THREAD_ID = 13
            ORDER BY EVENT_ID;
     +----------+-----------------------------------------+------------+
     | EVENT_ID | EVENT_NAME                              | TIMER_WAIT |
     +----------+-----------------------------------------+------------+
     |       86 | wait/synch/mutex/mysys/THR_LOCK::mutex  |     686322 |
     |       87 | wait/synch/mutex/mysys/THR_LOCK_malloc  |     320535 |
     |       88 | wait/synch/mutex/mysys/THR_LOCK_malloc  |     339390 |
     |       89 | wait/synch/mutex/mysys/THR_LOCK_malloc  |     377100 |
     |       90 | wait/synch/mutex/sql/LOCK_plugin        |     614673 |
     |       91 | wait/synch/mutex/sql/LOCK_open          |     659925 |
     |       92 | wait/synch/mutex/sql/THD::LOCK_thd_data |     494001 |
     |       93 | wait/synch/mutex/mysys/THR_LOCK_malloc  |     222489 |
     |       94 | wait/synch/mutex/mysys/THR_LOCK_malloc  |     214947 |
     |       95 | wait/synch/mutex/mysys/LOCK_alarm       |     312993 |
     +----------+-----------------------------------------+------------+

As new events are added to a history table, older events are discarded
if the table is full.

Summary tables provide aggregated information for all events over time.
The tables in this group summarize event data in different ways.  To see
which instruments have been executed the most times or have taken the
most wait time, sort the *note
'events_waits_summary_global_by_event_name': wait-summary-tables. table
on the 'COUNT_STAR' or 'SUM_TIMER_WAIT' column, which correspond to a
'COUNT(*)' or 'SUM(TIMER_WAIT)' value, respectively, calculated over all
events:

     mysql> SELECT EVENT_NAME, COUNT_STAR
            FROM performance_schema.events_waits_summary_global_by_event_name
            ORDER BY COUNT_STAR DESC LIMIT 10;
     +---------------------------------------------------+------------+
     | EVENT_NAME                                        | COUNT_STAR |
     +---------------------------------------------------+------------+
     | wait/synch/mutex/mysys/THR_LOCK_malloc            |       6419 |
     | wait/io/file/sql/FRM                              |        452 |
     | wait/synch/mutex/sql/LOCK_plugin                  |        337 |
     | wait/synch/mutex/mysys/THR_LOCK_open              |        187 |
     | wait/synch/mutex/mysys/LOCK_alarm                 |        147 |
     | wait/synch/mutex/sql/THD::LOCK_thd_data           |        115 |
     | wait/io/file/myisam/kfile                         |        102 |
     | wait/synch/mutex/sql/LOCK_global_system_variables |         89 |
     | wait/synch/mutex/mysys/THR_LOCK::mutex            |         89 |
     | wait/synch/mutex/sql/LOCK_open                    |         88 |
     +---------------------------------------------------+------------+

     mysql> SELECT EVENT_NAME, SUM_TIMER_WAIT
            FROM performance_schema.events_waits_summary_global_by_event_name
            ORDER BY SUM_TIMER_WAIT DESC LIMIT 10;
     +----------------------------------------+----------------+
     | EVENT_NAME                             | SUM_TIMER_WAIT |
     +----------------------------------------+----------------+
     | wait/io/file/sql/MYSQL_LOG             |     1599816582 |
     | wait/synch/mutex/mysys/THR_LOCK_malloc |     1530083250 |
     | wait/io/file/sql/binlog_index          |     1385291934 |
     | wait/io/file/sql/FRM                   |     1292823243 |
     | wait/io/file/myisam/kfile              |      411193611 |
     | wait/io/file/myisam/dfile              |      322401645 |
     | wait/synch/mutex/mysys/LOCK_alarm      |      145126935 |
     | wait/io/file/sql/casetest              |      104324715 |
     | wait/synch/mutex/sql/LOCK_plugin       |       86027823 |
     | wait/io/file/sql/pid                   |       72591750 |
     +----------------------------------------+----------------+

These results show that the 'THR_LOCK_malloc' mutex is 'hot,' both in
terms of how often it is used and amount of time that threads wait
attempting to acquire it.

*Note*:

The 'THR_LOCK_malloc' mutex is used only in debug builds.  In production
builds it is not hot because it is nonexistent.

Instance tables document what types of objects are instrumented.  An
instrumented object, when used by the server, produces an event.  These
tables provide event names and explanatory notes or status information.
For example, the *note 'file_instances': file-instances-table. table
lists instances of instruments for file I/O operations and their
associated files:

     mysql> SELECT *
            FROM performance_schema.file_instances\G
     *************************** 1. row ***************************
      FILE_NAME: /opt/mysql-log/60500/binlog.000007
     EVENT_NAME: wait/io/file/sql/binlog
     OPEN_COUNT: 0
     *************************** 2. row ***************************
      FILE_NAME: /opt/mysql/60500/data/mysql/tables_priv.MYI
     EVENT_NAME: wait/io/file/myisam/kfile
     OPEN_COUNT: 1
     *************************** 3. row ***************************
      FILE_NAME: /opt/mysql/60500/data/mysql/columns_priv.MYI
     EVENT_NAME: wait/io/file/myisam/kfile
     OPEN_COUNT: 1
     ...

Setup tables are used to configure and display monitoring
characteristics.  For example, *note 'setup_instruments':
setup-instruments-table. lists the set of instruments for which events
can be collected and shows which of them are enabled:

     mysql> SELECT * FROM performance_schema.setup_instruments;
     +---------------------------------------------------+---------+-------+
     | NAME                                              | ENABLED | TIMED |
     +---------------------------------------------------+---------+-------+
     ...
     | wait/synch/mutex/sql/LOCK_global_read_lock        | YES     | YES   |
     | wait/synch/mutex/sql/LOCK_global_system_variables | YES     | YES   |
     | wait/synch/mutex/sql/LOCK_lock_db                 | YES     | YES   |
     | wait/synch/mutex/sql/LOCK_manager                 | YES     | YES   |
     ...
     | wait/synch/rwlock/sql/LOCK_grant                  | YES     | YES   |
     | wait/synch/rwlock/sql/LOGGER::LOCK_logger         | YES     | YES   |
     | wait/synch/rwlock/sql/LOCK_sys_init_connect       | YES     | YES   |
     | wait/synch/rwlock/sql/LOCK_sys_init_slave         | YES     | YES   |
     ...
     | wait/io/file/sql/binlog                           | YES     | YES   |
     | wait/io/file/sql/binlog_index                     | YES     | YES   |
     | wait/io/file/sql/casetest                         | YES     | YES   |
     | wait/io/file/sql/dbopt                            | YES     | YES   |
     ...

To understand how to interpret instrument names, see *note
performance-schema-instrument-naming::.

To control whether events are collected for an instrument, set its
'ENABLED' value to 'YES' or 'NO'.  For example:

     mysql> UPDATE performance_schema.setup_instruments
            SET ENABLED = 'NO'
            WHERE NAME = 'wait/synch/mutex/sql/LOCK_mysql_create_db';

The Performance Schema uses collected events to update tables in the
'performance_schema' database, which act as 'consumers' of event
information.  The *note 'setup_consumers': setup-consumers-table. table
lists the available consumers and shows which of them are enabled:

     mysql> SELECT * FROM performance_schema.setup_consumers;
     +----------------------------------------------+---------+
     | NAME                                         | ENABLED |
     +----------------------------------------------+---------+
     | events_waits_current                         | YES     |
     | events_waits_history                         | YES     |
     | events_waits_history_long                    | YES     |
     | events_waits_summary_by_thread_by_event_name | YES     |
     | events_waits_summary_by_event_name           | YES     |
     | events_waits_summary_by_instance             | YES     |
     | file_summary_by_event_name                   | YES     |
     | file_summary_by_instance                     | YES     |
     +----------------------------------------------+---------+

To control whether the Performance Schema maintains a consumer as a
destination for event information, set its 'ENABLED' value.

For more information about the setup tables and how to use them to
control event collection, see *note performance-schema-filtering::.

There are some miscellaneous tables that do not fall into any of the
previous groups.  For example, *note 'performance_timers':
performance-timers-table. lists the available event timers and their
characteristics.  For information about timers, see *note
performance-schema-timing::.


File: manual.info.tmp,  Node: performance-schema-build-configuration,  Next: performance-schema-startup-configuration,  Prev: performance-schema-quick-start,  Up: performance-schema

22.2 Performance Schema Build Configuration
===========================================

For the Performance Schema to be available, it must be configured into
the MySQL server at build time.  Binary MySQL distributions provided by
Oracle Corporation are configured to support the Performance Schema.  If
you use a binary MySQL distribution from another provider, check with
the provider whether the distribution has been appropriately configured.

If you build MySQL from a source distribution, enable the Performance
Schema by running 'CMake' with the 'WITH_PERFSCHEMA_STORAGE_ENGINE'
option enabled:

     shell> cmake . -DWITH_PERFSCHEMA_STORAGE_ENGINE=1

Configuring MySQL with the '-DWITHOUT_PERFSCHEMA_STORAGE_ENGINE=1'
option prevents inclusion of the Performance Schema, so if you want it
included, do not use this option.  See *note
source-configuration-options::.

If you install MySQL over a previous installation that was configured
without the Performance Schema (or with an older version of the
Performance Schema that has missing or out-of-date tables).  One
indication of this issue is the presence of messages such as the
following in the error log:

     [ERROR] Native table 'performance_schema'.'events_waits_history'
     has the wrong structure
     [ERROR] Native table 'performance_schema'.'events_waits_history_long'
     has the wrong structure
     ...

To correct that problem, perform the MySQL upgrade procedure.  See *note
upgrading::.

To verify whether a server was built with Performance Schema support,
check its help output.  If the Performance Schema is available, the
output will mention several variables with names that begin with
'performance_schema':

     shell> mysqld --verbose --help
     ...
       --performance_schema
                           Enable the performance schema.
       --performance_schema_events_waits_history_long_size=#
                           Number of rows in events_waits_history_long.
     ...

You can also connect to the server and look for a line that names the
*note 'PERFORMANCE_SCHEMA': performance-schema. storage engine in the
output from *note 'SHOW ENGINES': show-engines.:

     mysql> SHOW ENGINES\G
     ...
           Engine: PERFORMANCE_SCHEMA
          Support: YES
          Comment: Performance Schema
     Transactions: NO
               XA: NO
       Savepoints: NO
     ...

If the Performance Schema was not configured into the server at build
time, no row for *note 'PERFORMANCE_SCHEMA': performance-schema. will
appear in the output from *note 'SHOW ENGINES': show-engines.  You might
see 'performance_schema' listed in the output from *note 'SHOW
DATABASES': show-databases, but it will have no tables and you will not
be able to use it.

A line for *note 'PERFORMANCE_SCHEMA': performance-schema. in the *note
'SHOW ENGINES': show-engines. output means that the Performance Schema
is available, not that it is enabled.  To enable it, you must do so at
server startup, as described in the next section.


File: manual.info.tmp,  Node: performance-schema-startup-configuration,  Next: performance-schema-runtime-configuration,  Prev: performance-schema-build-configuration,  Up: performance-schema

22.3 Performance Schema Startup Configuration
=============================================

To use the MySQL Performance Schema, it must be enabled at server
startup to enable event collection to occur.

The Performance Schema is disabled by default.  To enable it, start the
server with the 'performance_schema' variable enabled.  For example, use
these lines in the server 'my.cnf' file:

     [mysqld]
     performance_schema

If the server is unable to allocate any internal buffer during
Performance Schema initialization, the Performance Schema disables
itself and sets 'performance_schema' to 'OFF', and the server runs
without instrumentation.

The Performance Schema includes several system variables that provide
configuration information:

     mysql> SHOW VARIABLES LIKE 'perf%';
     +---------------------------------------------------+---------+
     | Variable_name                                     | Value   |
     +---------------------------------------------------+---------+
     | performance_schema                                | ON      |
     | performance_schema_events_waits_history_long_size | 10000   |
     | performance_schema_events_waits_history_size      | 10      |
     | performance_schema_max_cond_classes               | 80      |
     | performance_schema_max_cond_instances             | 1000    |
     | performance_schema_max_file_classes               | 50      |
     | performance_schema_max_file_handles               | 32768   |
     | performance_schema_max_file_instances             | 10000   |
     | performance_schema_max_mutex_classes              | 200     |
     | performance_schema_max_mutex_instances            | 1000000 |
     | performance_schema_max_rwlock_classes             | 30      |
     | performance_schema_max_rwlock_instances           | 1000000 |
     | performance_schema_max_table_handles              | 100000  |
     | performance_schema_max_table_instances            | 50000   |
     | performance_schema_max_thread_classes             | 50      |
     | performance_schema_max_thread_instances           | 1000    |
     +---------------------------------------------------+---------+

The 'performance_schema' variable is 'ON' or 'OFF' to indicate whether
the Performance Schema is enabled or disabled.  The other variables
indicate table sizes (number of rows) or memory allocation values.

*Note*:

With the Performance Schema enabled, the number of Performance Schema
instances affects the server memory footprint, perhaps to a large
extent.  It may be necessary to tune the values of Performance Schema
system variables to find the number of instances that balances
insufficient instrumentation against excessive memory consumption.

To change the value of Performance Schema system variables, set them at
server startup.  For example, put the following lines in a 'my.cnf' file
to change the sizes of the history tables for wait events:

     [mysqld]
     performance_schema
     performance_schema_events_waits_history_size=20
     performance_schema_events_waits_history_long_size=15000


File: manual.info.tmp,  Node: performance-schema-runtime-configuration,  Next: performance-schema-queries,  Prev: performance-schema-startup-configuration,  Up: performance-schema

22.4 Performance Schema Runtime Configuration
=============================================

* Menu:

* performance-schema-timing::    Performance Schema Event Timing
* performance-schema-filtering::  Performance Schema Event Filtering
* performance-schema-pre-filtering::  Event Pre-Filtering
* performance-schema-filtering-names::  Naming Instruments or Consumers for Filtering Operations
* performance-schema-instrumentation-checking::  Determining What Is Instrumented

Specific Performance Schema features can be enabled at runtime to
control which types of event collection occur.

Performance Schema setup tables contain information about monitoring
configuration:

     mysql> SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
            WHERE TABLE_SCHEMA = 'performance_schema'
            AND TABLE_NAME LIKE 'setup%';
     +-------------------+
     | TABLE_NAME        |
     +-------------------+
     | setup_consumers   |
     | setup_instruments |
     | setup_timers      |
     +-------------------+

You can examine the contents of these tables to obtain information about
Performance Schema monitoring characteristics.  If you have the 'UPDATE'
privilege, you can change Performance Schema operation by modifying
setup tables to affect how monitoring occurs.  For additional details
about these tables, see *note performance-schema-setup-tables::.

To see which event timer is selected, query the *note 'setup_timers':
setup-timers-table. tables:

     mysql> SELECT * FROM performance_schema.setup_timers;
     +------+------------+
     | NAME | TIMER_NAME |
     +------+------------+
     | wait | CYCLE      |
     +------+------------+

The 'NAME' value indicates the type of instrument to which the timer
applies, and 'TIMER_NAME' indicates which timer applies to those
instruments.  The timer applies to instruments where their name begins
with a component matching the 'NAME' value.  There are only 'wait'
instruments, so this table has only one row and the timer applies to all
instruments.

To change the timer, update the 'NAME' value.  For example, to use the
'NANOSECOND' timer:

     mysql> UPDATE performance_schema.setup_timers
            SET TIMER_NAME = 'NANOSECOND'
            WHERE NAME = 'wait';

     mysql> SELECT * FROM performance_schema.setup_timers;
     +------+------------+
     | NAME | TIMER_NAME |
     +------+------------+
     | wait | NANOSECOND |
     +------+------------+

For discussion of timers, see *note performance-schema-timing::.

The *note 'setup_instruments': setup-instruments-table. and *note
'setup_consumers': setup-consumers-table. tables list the instruments
for which events can be collected and the types of consumers for which
event information actually is collected, respectively.  *note
performance-schema-filtering::, discusses how you can modify these
tables to affect event collection.

If there are Performance Schema configuration changes that must be made
at runtime using SQL statements and you would like these changes to take
effect each time the server starts, put the statements in a file and
start the server with the 'init_file' system variable set to name the
file.  This strategy can also be useful if you have multiple monitoring
configurations, each tailored to produce a different kind of monitoring,
such as casual server health monitoring, incident investigation,
application behavior troubleshooting, and so forth.  Put the statements
for each monitoring configuration into their own file and specify the
appropriate file as the 'init_file' value when you start the server.


File: manual.info.tmp,  Node: performance-schema-timing,  Next: performance-schema-filtering,  Prev: performance-schema-runtime-configuration,  Up: performance-schema-runtime-configuration

22.4.1 Performance Schema Event Timing
--------------------------------------

Events are collected by means of instrumentation added to the server
source code.  Instruments time events, which is how the Performance
Schema provides an idea of how long events take.  It is also possible to
configure instruments not to collect timing information.  This section
discusses the available timers and their characteristics, and how timing
values are represented in events.

*Performance Schema Timers*

Two Performance Schema tables provide timer information:

   * *note 'performance_timers': performance-timers-table. lists the
     available timers and their characteristics.

   * *note 'setup_timers': setup-timers-table. indicates which timers
     are used for which instruments.

Each timer row in *note 'setup_timers': setup-timers-table. must refer
to one of the timers listed in *note 'performance_timers':
performance-timers-table.

Timers vary in precision and amount of overhead.  To see what timers are
available and their characteristics, check the *note
'performance_timers': performance-timers-table. table:

     mysql> SELECT * FROM performance_schema.performance_timers;
     +-------------+-----------------+------------------+----------------+
     | TIMER_NAME  | TIMER_FREQUENCY | TIMER_RESOLUTION | TIMER_OVERHEAD |
     +-------------+-----------------+------------------+----------------+
     | CYCLE       |      2389029850 |                1 |             72 |
     | NANOSECOND  |      1000000000 |                1 |            112 |
     | MICROSECOND |         1000000 |                1 |            136 |
     | MILLISECOND |            1036 |                1 |            168 |
     | TICK        |             105 |                1 |           2416 |
     +-------------+-----------------+------------------+----------------+

If the values associated with a given timer name are 'NULL', that timer
is not supported on your platform.  The rows that do not contain 'NULL'
indicate which timers you can use in *note 'setup_timers':
setup-timers-table.

The columns have these meanings:

   * The 'TIMER_NAME' column shows the names of the available timers.
     'CYCLE' refers to the timer that is based on the CPU (processor)
     cycle counter.  The timers in *note 'setup_timers':
     setup-timers-table. that you can use are those that do not have
     'NULL' in the other columns.  If the values associated with a given
     timer name are 'NULL', that timer is not supported on your
     platform.

   * 'TIMER_FREQUENCY' indicates the number of timer units per second.
     For a cycle timer, the frequency is generally related to the CPU
     speed.  The value shown was obtained on a system with a 2.4GHz
     processor.  The other timers are based on fixed fractions of
     seconds.  For 'TICK', the frequency may vary by platform (for
     example, some use 100 ticks/second, others 1000 ticks/second).

   * 'TIMER_RESOLUTION' indicates the number of timer units by which
     timer values increase at a time.  If a timer has a resolution of
     10, its value increases by 10 each time.

   * 'TIMER_OVERHEAD' is the minimal number of cycles of overhead to
     obtain one timing with the given timer.  The overhead per event is
     twice the value displayed because the timer is invoked at the
     beginning and end of the event.

To see which timer is in effect or to change the timer, access the *note
'setup_timers': setup-timers-table. table:

     mysql> SELECT * FROM performance_schema.setup_timers;
     +------+------------+
     | NAME | TIMER_NAME |
     +------+------------+
     | wait | CYCLE      |
     +------+------------+

     mysql> UPDATE performance_schema.setup_timers
            SET TIMER_NAME = 'MICROSECOND'
            WHERE NAME = 'wait';

     mysql> SELECT * FROM performance_schema.setup_timers;
     +------+-------------+
     | NAME | TIMER_NAME  |
     +------+-------------+
     | wait | MICROSECOND |
     +------+-------------+

By default, the Performance Schema uses the best timer available for
each instrument type, but you can select a different one.  Generally the
best timer is 'CYCLE', which uses the CPU cycle counter whenever
possible to provide high precision and low overhead.

The precision offered by the cycle counter depends on processor speed.
If the processor runs at 1 GHz (one billion cycles/second) or higher,
the cycle counter delivers sub-nanosecond precision.  Using the cycle
counter is much cheaper than getting the actual time of day.  For
example, the standard 'gettimeofday()' function can take hundreds of
cycles, which is an unacceptable overhead for data gathering that may
occur thousands or millions of times per second.

Cycle counters also have disadvantages:

   * End users expect to see timings in wall-clock units, such as
     fractions of a second.  Converting from cycles to fractions of
     seconds can be expensive.  For this reason, the conversion is a
     quick and fairly rough multiplication operation.

   * Processor cycle rate might change, such as when a laptop goes into
     power-saving mode or when a CPU slows down to reduce heat
     generation.  If a processor's cycle rate fluctuates, conversion
     from cycles to real-time units is subject to error.

   * Cycle counters might be unreliable or unavailable depending on the
     processor or the operating system.  For example, on Pentiums, the
     instruction is 'RDTSC' (an assembly-language rather than a C
     instruction) and it is theoretically possible for the operating
     system to prevent user-mode programs from using it.

   * Some processor details related to out-of-order execution or
     multiprocessor synchronization might cause the counter to seem fast
     or slow by up to 1000 cycles.

MySQL works with cycle counters on x386 (Windows, macOS, Linux, Solaris,
and other Unix flavors), PowerPC, and IA-64.

*Performance Schema Timer Representation in Events*

Rows in Performance Schema tables that store current events and
historical events have three columns to represent timing information:
'TIMER_START' and 'TIMER_END' indicate when the event started and
finished, and 'TIMER_WAIT' indicates the event duration.

The *note 'setup_instruments': setup-instruments-table. table has an
'ENABLED' column to indicate the instruments for which to collect
events.  The table also has a 'TIMED' column to indicate which
instruments are timed.  If an instrument is not enabled, it produces no
events.  If an enabled instrument is not timed, events produced by the
instrument have 'NULL' for the 'TIMER_START', 'TIMER_END', and
'TIMER_WAIT' timer values.  This in turn causes those values to be
ignored when calculating aggregate time values in summary tables (sum,
minimum, maximum, and average).

Within events, times are stored in picoseconds (trillionths of a second)
to normalize them to a standard unit, regardless of which timer is
selected.  The timer used for an event is the one in effect when event
timing begins.  This timer is used to convert start and end values to
picoseconds for storage in the event.

Modifications to the *note 'setup_timers': setup-timers-table. table
affect monitoring immediately.  Events already measured are stored using
the original timer unit, and events in progress may use the original
timer for the begin time and the new timer for the end time.  To avoid
unpredictable results if you make timer changes, use *note 'TRUNCATE
TABLE': truncate-table. to reset Performance Schema statistics.

The timer baseline ('time zero') occurs at Performance Schema
initialization during server startup.  'TIMER_START' and 'TIMER_END'
values in events represent picoseconds since the baseline.  'TIMER_WAIT'
values are durations in picoseconds.

Picosecond values in events are approximate.  Their accuracy is subject
to the usual forms of error associated with conversion from one unit to
another.  If the 'CYCLE' timer is used and the processor rate varies,
there might be drift.  For these reasons, it is not reasonable to look
at the 'TIMER_START' value for an event as an accurate measure of time
elapsed since server startup.  On the other hand, it is reasonable to
use 'TIMER_START' or 'TIMER_WAIT' values in 'ORDER BY' clauses to order
events by start time or duration.

The choice of picoseconds in events rather than a value such as
microseconds has a performance basis.  One implementation goal was to
show results in a uniform time unit, regardless of the timer.  In an
ideal world this time unit would look like a wall-clock unit and be
reasonably precise; in other words, microseconds.  But to convert cycles
or nanoseconds to microseconds, it would be necessary to perform a
division for every instrumentation.  Division is expensive on many
platforms.  Multiplication is not expensive, so that is what is used.
Therefore, the time unit is an integer multiple of the highest possible
'TIMER_FREQUENCY' value, using a multiplier large enough to ensure that
there is no major precision loss.  The result is that the time unit is
'picoseconds.' This precision is spurious, but the decision enables
overhead to be minimized.


File: manual.info.tmp,  Node: performance-schema-filtering,  Next: performance-schema-pre-filtering,  Prev: performance-schema-timing,  Up: performance-schema-runtime-configuration

22.4.2 Performance Schema Event Filtering
-----------------------------------------

Events are processed in a producer/consumer fashion:

   * Instrumented code is the source for events and produces events to
     be collected.  The *note 'setup_instruments':
     setup-instruments-table. table lists the instruments for which
     events can be collected, whether they are enabled, and (for enabled
     instruments) whether to collect timing information:

          mysql> SELECT * FROM performance_schema.setup_instruments;
          +---------------------------------------------------+---------+-------+
          | NAME                                              | ENABLED | TIMED |
          +---------------------------------------------------+---------+-------+
          ...
          | wait/synch/mutex/sql/LOCK_global_read_lock        | YES     | YES   |
          | wait/synch/mutex/sql/LOCK_global_system_variables | YES     | YES   |
          | wait/synch/mutex/sql/LOCK_lock_db                 | YES     | YES   |
          | wait/synch/mutex/sql/LOCK_manager                 | YES     | YES   |
          ...
          | wait/synch/rwlock/sql/LOCK_grant                  | YES     | YES   |
          | wait/synch/rwlock/sql/LOGGER::LOCK_logger         | YES     | YES   |
          | wait/synch/rwlock/sql/LOCK_sys_init_connect       | YES     | YES   |
          | wait/synch/rwlock/sql/LOCK_sys_init_slave         | YES     | YES   |
          ...
          | wait/io/file/sql/binlog                           | YES     | YES   |
          | wait/io/file/sql/binlog_index                     | YES     | YES   |
          | wait/io/file/sql/casetest                         | YES     | YES   |
          | wait/io/file/sql/dbopt                            | YES     | YES   |
          ...

   * Performance Schema tables are the destinations for events and
     consume events.  The *note 'setup_consumers':
     setup-consumers-table. table lists the types of consumers to which
     event information can be sent:

          mysql> SELECT * FROM performance_schema.setup_consumers;
          +----------------------------------------------+---------+
          | NAME                                         | ENABLED |
          +----------------------------------------------+---------+
          | events_waits_current                         | YES     |
          | events_waits_history                         | YES     |
          | events_waits_history_long                    | YES     |
          | events_waits_summary_by_thread_by_event_name | YES     |
          | events_waits_summary_by_event_name           | YES     |
          | events_waits_summary_by_instance             | YES     |
          | file_summary_by_event_name                   | YES     |
          | file_summary_by_instance                     | YES     |
          +----------------------------------------------+---------+

Filtering can be done at different stages of performance monitoring:

   * Pre-filtering

     This is done by modifying Performance Schema configuration so that
     only certain types of events are collected from producers, and
     collected events update only certain consumers.  To do this, enable
     or disable instruments or consumers.  Pre-filtering is done by the
     Performance Schema and has a global effect that applies to all
     users.

     Reasons to use pre-filtering:

        * To reduce overhead.  Performance Schema overhead should be
          minimal even with all instruments enabled, but perhaps you
          want to reduce it further.  Or you do not care about timing
          events and want to disable the timing code to eliminate timing
          overhead.

        * To avoid filling the current-events or history tables with
          events in which you have no interest.  Pre-filtering leaves
          more 'room' in these tables for instances of rows for enabled
          instrument types.  If you enable only file instruments with
          pre-filtering, no rows are collected for nonfile instruments.
          With post-filtering, nonfile events are collected, leaving
          fewer rows for file events.

        * To avoid maintaining some kinds of event tables.  If you
          disable a consumer, the server does not spend time maintaining
          destinations for that consumer.  For example, if you do not
          care about event histories, you can disable the history table
          consumers to improve performance.

   * Post-filtering

     This involves the use of 'WHERE' clauses in queries that select
     information from Performance Schema tables, to specify which of the
     available events you want to see.  Post-filtering is performed on a
     per-user basis because individual users select which of the
     available events are of interest.

     Reasons to use post-filtering:

        * To avoid making decisions for individual users about which
          event information is of interest.

        * To use the Performance Schema to investigate a performance
          issue when the restrictions to impose using pre-filtering are
          not known in advance.

The following sections provide more detail about pre-filtering and
provide guidelines for naming instruments or consumers in filtering
operations.  For information about writing queries to retrieve
information (post-filtering), see *note performance-schema-queries::.


File: manual.info.tmp,  Node: performance-schema-pre-filtering,  Next: performance-schema-filtering-names,  Prev: performance-schema-filtering,  Up: performance-schema-runtime-configuration

22.4.3 Event Pre-Filtering
--------------------------

Pre-filtering is done by modifying Performance Schema configuration so
that only certain types of events are collected from producers, and
collected events update only certain consumers.  This type of filtering
is done by the Performance Schema and has a global effect that applies
to all users.

Pre-filtering can be applied to either the producer or consumer stage of
event processing:

   * To affect pre-filtering at the producer stage, modify the *note
     'setup_instruments': setup-instruments-table. table.  An instrument
     can be enabled or disabled by setting its 'ENABLED' value to 'YES'
     or 'NO'.  An instrument can be configured whether to collect timing
     information by setting its 'TIMED' value to 'YES' or 'NO'.

   * To affect pre-filtering at the consumer stage, modify the *note
     'setup_consumers': setup-consumers-table. table.  A consumer can be
     enabled or disabled by setting its 'ENABLED' value to 'YES' or
     'NO'.

Here are some examples that show the types of pre-filtering operations
available:

   * Disable all instruments:

          UPDATE performance_schema.setup_instruments
          SET ENABLED = 'NO';

     Now no events will be collected.  This change, like other
     pre-filtering operations, affects other users as well, even if they
     want to see event information.

   * Disable all file instruments, adding them to the current set of
     disabled instruments:

          UPDATE performance_schema.setup_instruments
          SET ENABLED = 'NO'
          WHERE NAME LIKE 'wait/io/file/%';

   * Disable only file instruments, enable all other instruments:

          UPDATE performance_schema.setup_instruments
          SET ENABLED = IF(NAME LIKE 'wait/io/file/%', 'NO', 'YES');

     The preceding queries use the 'LIKE' operator and the pattern
     ''wait/io/file/%'' to match all instrument names that begin with
     ''wait/io/file/'.  For additional information about specifying
     patterns to select instruments, see *note
     performance-schema-filtering-names::.

   * Enable all but those instruments in the 'mysys' library:

          UPDATE performance_schema.setup_instruments
          SET ENABLED = CASE WHEN NAME LIKE '%/mysys/%' THEN 'YES' ELSE 'NO' END;

   * Disable a specific instrument:

          UPDATE performance_schema.setup_instruments
          SET ENABLED = 'NO'
          WHERE NAME = 'wait/synch/mutex/mysys/TMPDIR_mutex';

   * To toggle the state of an instrument, 'flip' its 'ENABLED' value:

          UPDATE performance_schema.setup_instruments
          SET ENABLED = IF(ENABLED = 'YES', 'NO', 'YES')
          WHERE NAME = 'wait/synch/mutex/mysys/TMPDIR_mutex';

   * Disable timing for all events:

          UPDATE performance_schema.setup_instruments
          SET TIMED = 'NO';

Setting the 'TIMED' column for instruments affects Performance Schema
table contents as described in *note performance-schema-timing::.

When you change the monitoring configuration, the Performance Schema
does not flush the history tables.  Events already collected remain in
the current-events and history tables until displaced by newer events.
If you disable instruments, you might need to wait a while before events
for them are displaced by newer events of interest.  Alternatively, use
*note 'TRUNCATE TABLE': truncate-table. to empty the history tables.

After making instrumentation changes, you might want to truncate the
summary tables to clear aggregate information for previously collected
events.  The effect of *note 'TRUNCATE TABLE': truncate-table. for
summary tables is to reset the summary columns to 0 or 'NULL', not to
remove rows.

If you disable a consumer, the server does not spend time maintaining
destinations for that consumer.  For example, if you do not care about
historical event information, disable the history consumers:

     UPDATE performance_schema.setup_consumers
     SET ENABLED = 'NO'
     WHERE NAME LIKE '%history%';


File: manual.info.tmp,  Node: performance-schema-filtering-names,  Next: performance-schema-instrumentation-checking,  Prev: performance-schema-pre-filtering,  Up: performance-schema-runtime-configuration

22.4.4 Naming Instruments or Consumers for Filtering Operations
---------------------------------------------------------------

Names given for filtering operations can be as specific or general as
required.  To indicate a single instrument or consumer, specify its name
in full:

     UPDATE performance_schema.setup_instruments
     SET ENABLED = 'NO'
     WHERE NAME = 'wait/synch/mutex/myisammrg/MYRG_INFO::mutex';

     UPDATE performance_schema.setup_consumers
     SET ENABLED = 'NO'
     WHERE NAME = 'file_summary_by_instance';

To specify a group of instruments or consumers, use a pattern that
matches the group members:

     UPDATE performance_schema.setup_instruments
     SET ENABLED = 'NO'
     WHERE NAME LIKE 'wait/synch/mutex/%';

     UPDATE performance_schema.setup_consumers
     SET ENABLED = 'NO'
     WHERE NAME LIKE '%history%';

If you use a pattern, it should be chosen so that it matches all the
items of interest and no others.  For example, to select all file I/O
instruments, it is better to use a pattern that includes the entire
instrument name prefix:

     ... WHERE NAME LIKE 'wait/io/file/%';

A pattern of ''%/file/%'' will match other instruments that have a
component of ''/file/'' anywhere in the name.  Even less suitable is the
pattern ''%file%'' because it will match instruments with ''file''
anywhere in the name, such as 'wait/synch/mutex/sql/LOCK_des_key_file'.

To check which instrument or consumer names a pattern matches, perform a
simple test:

     SELECT NAME FROM performance_schema.setup_instruments
     WHERE NAME LIKE 'PATTERN';

     SELECT NAME FROM performance_schema.setup_consumers
     WHERE NAME LIKE 'PATTERN';

For information about the types of names that are supported, see *note
performance-schema-instrument-naming::.


File: manual.info.tmp,  Node: performance-schema-instrumentation-checking,  Prev: performance-schema-filtering-names,  Up: performance-schema-runtime-configuration

22.4.5 Determining What Is Instrumented
---------------------------------------

It is always possible to determine what instruments the Performance
Schema includes by checking the *note 'setup_instruments':
setup-instruments-table. table.  For example, to see what file-related
events are instrumented for the 'InnoDB' storage engine, use this query:

     mysql> SELECT * FROM performance_schema.setup_instruments
            WHERE NAME LIKE 'wait/io/file/innodb/%';
     +--------------------------------------+---------+-------+
     | NAME                                 | ENABLED | TIMED |
     +--------------------------------------+---------+-------+
     | wait/io/file/innodb/innodb_data_file | YES     | YES   |
     | wait/io/file/innodb/innodb_log_file  | YES     | YES   |
     | wait/io/file/innodb/innodb_temp_file | YES     | YES   |
     +--------------------------------------+---------+-------+

An exhaustive description of precisely what is instrumented is not given
in this documentation, for several reasons:

   * What is instrumented is the server code.  Changes to this code
     occur often, which also affects the set of instruments.

   * It is not practical to list all the instruments because there are
     hundreds of them.

   * As described earlier, it is possible to find out by querying the
     *note 'setup_instruments': setup-instruments-table. table.  This
     information is always up to date for your version of MySQL, also
     includes instrumentation for instrumented plugins you might have
     installed that are not part of the core server, and can be used by
     automated tools.


File: manual.info.tmp,  Node: performance-schema-queries,  Next: performance-schema-instrument-naming,  Prev: performance-schema-runtime-configuration,  Up: performance-schema

22.5 Performance Schema Queries
===============================

Pre-filtering limits which event information is collected and is
independent of any particular user.  By contrast, post-filtering is
performed by individual users through the use of queries with
appropriate 'WHERE' clauses that restrict what event information to
select from the events available after pre-filtering has been applied.

In *note performance-schema-pre-filtering::, an example showed how to
pre-filter for file instruments.  If the event tables contain both file
and nonfile information, post-filtering is another way to see
information only for file events.  Add a 'WHERE' clause to queries to
restrict event selection appropriately:

     mysql> SELECT THREAD_ID, NUMBER_OF_BYTES
            FROM performance_schema.events_waits_history
            WHERE EVENT_NAME LIKE 'wait/io/file/%'
            AND NUMBER_OF_BYTES IS NOT NULL;
     +-----------+-----------------+
     | THREAD_ID | NUMBER_OF_BYTES |
     +-----------+-----------------+
     |        11 |              66 |
     |        11 |              47 |
     |        11 |             139 |
     |         5 |              24 |
     |         5 |             834 |
     +-----------+-----------------+


File: manual.info.tmp,  Node: performance-schema-instrument-naming,  Next: performance-schema-status-monitoring,  Prev: performance-schema-queries,  Up: performance-schema

22.6 Performance Schema Instrument Naming Conventions
=====================================================

An instrument name consists of a sequence of components separated by
''/'' characters.  Example names:

     wait/io/file/myisam/log
     wait/io/file/mysys/charset
     wait/synch/cond/mysys/COND_alarm
     wait/synch/cond/sql/BINLOG::update_cond
     wait/synch/mutex/mysys/BITMAP_mutex
     wait/synch/mutex/sql/LOCK_delete
     wait/synch/rwlock/innodb/trx_sys_lock
     wait/synch/rwlock/sql/Query_cache_query::lock

The instrument name space has a tree-like structure.  The components of
an instrument name from left to right provide a progression from more
general to more specific.  The number of components a name has depends
on the type of instrument.

The interpretation of a given component in a name depends on the
components to the left of it.  For example, 'myisam' appears in both of
the following names, but 'myisam' in the first name is related to file
I/O, whereas in the second it is related to a synchronization
instrument:

     wait/io/file/myisam/log
     wait/synch/cond/myisam/MI_SORT_INFO::cond

Instrument names consist of a prefix with a structure defined by the
Performance Schema implementation and a suffix defined by the developer
implementing the instrument code.  The top-level component of an
instrument prefix indicates the type of instrument.  This component also
determines which event timer in the 'setup_timers' table applies to the
instrument.  For the prefix part of instrument names, the top level
indicates the type of instrument.

The suffix part of instrument names comes from the code for the
instruments themselves.  Suffixes may include levels such as these:

   * A name for the major component (a server module such as 'myisam',
     'innodb', 'mysys', or 'sql') or a plugin name.

   * The name of a variable in the code, in the form XXX (a global
     variable) or 'CCC::MMM' (a member MMM in class CCC).  Examples:
     'COND_thread_cache', 'THR_LOCK_myisam', 'BINLOG::LOCK_index'.

In MySQL 5.5, there is a single top-level component, 'wait', indicating
a wait instrument.  The naming tree for wait instruments has this
structure:

   * 'wait/io'

     An instrumented I/O operation.

        * 'wait/io/file'

          An instrumented file I/O operation.  For files, the wait is
          the time waiting for the file operation to complete (for
          example, a call to 'fwrite()').  Due to caching, the physical
          file I/O on the disk might not happen within this call.

   * 'wait/synch'

     An instrumented synchronization object.  For synchronization
     objects, the 'TIMER_WAIT' time includes the amount of time blocked
     while attempting to acquire a lock on the object, if any.

        * 'wait/synch/cond'

          A condition is used by one thread to signal to other threads
          that something they were waiting for has happened.  If a
          single thread was waiting for a condition, it can wake up and
          proceed with its execution.  If several threads were waiting,
          they can all wake up and compete for the resource for which
          they were waiting.

        * 'wait/synch/mutex'

          A mutual exclusion object used to permit access to a resource
          (such as a section of executable code) while preventing other
          threads from accessing the resource.

        * 'wait/synch/rwlock'

          A read/write lock object used to lock a specific variable for
          access while preventing its use by other threads.  A shared
          read lock can be acquired simultaneously by multiple threads.
          An exclusive write lock can be acquired by only one thread at
          a time.


File: manual.info.tmp,  Node: performance-schema-status-monitoring,  Next: performance-schema-event-tables,  Prev: performance-schema-instrument-naming,  Up: performance-schema

22.7 Performance Schema Status Monitoring
=========================================

There are several status variables associated with the Performance
Schema:

     mysql> SHOW STATUS LIKE 'perf%';
     +------------------------------------------+-------+
     | Variable_name                            | Value |
     +------------------------------------------+-------+
     | Performance_schema_cond_classes_lost     | 0     |
     | Performance_schema_cond_instances_lost   | 0     |
     | Performance_schema_file_classes_lost     | 0     |
     | Performance_schema_file_handles_lost     | 0     |
     | Performance_schema_file_instances_lost   | 0     |
     | Performance_schema_locker_lost           | 0     |
     | Performance_schema_mutex_classes_lost    | 0     |
     | Performance_schema_mutex_instances_lost  | 0     |
     | Performance_schema_rwlock_classes_lost   | 0     |
     | Performance_schema_rwlock_instances_lost | 0     |
     | Performance_schema_table_handles_lost    | 0     |
     | Performance_schema_table_instances_lost  | 0     |
     | Performance_schema_thread_classes_lost   | 0     |
     | Performance_schema_thread_instances_lost | 0     |
     +------------------------------------------+-------+

The Performance Schema status variables provide information about
instrumentation that could not be loaded or created due to memory
constraints.  Names for these variables have several forms:

   * 'Performance_schema_XXX_classes_lost' indicates how many
     instruments of type XXX could not be loaded.

   * 'Performance_schema_XXX_instances_lost' indicates how many
     instances of object type XXX could not be created.

   * 'Performance_schema_XXX_handles_lost' indicates how many instances
     of object type XXX could not be opened.

   * 'Performance_schema_locker_lost' indicates how many events are
     'lost' or not recorded.

For example, if a mutex is instrumented in the server source but the
server cannot allocate memory for the instrumentation at runtime, it
increments 'Performance_schema_mutex_classes_lost'.  The mutex still
functions as a synchronization object (that is, the server continues to
function normally), but performance data for it will not be collected.
If the instrument can be allocated, it can be used for initializing
instrumented mutex instances.  For a singleton mutex such as a global
mutex, there will be only one instance.  Other mutexes have an instance
per connection, or per page in various caches and data buffers, so the
number of instances varies over time.  Increasing the maximum number of
connections or the maximum size of some buffers will increase the
maximum number of instances that might be allocated at once.  If the
server cannot create a given instrumented mutex instance, it increments
'Performance_schema_mutex_instances_lost'.

Suppose that the following conditions hold:

   * The server was started with the
     '--performance_schema_max_mutex_classes=200' option and thus has
     room for 200 mutex instruments.

   * 150 mutex instruments have been loaded already.

   * The plugin named 'plugin_a' contains 40 mutex instruments.

   * The plugin named 'plugin_b' contains 20 mutex instruments.

The server allocates mutex instruments for the plugins depending on how
many they need and how many are available, as illustrated by the
following sequence of statements:

     INSTALL PLUGIN plugin_a

The server now has 150+40 = 190 mutex instruments.

     UNINSTALL PLUGIN plugin_a;

The server still has 190 instruments.  All the historical data generated
by the plugin code is still available, but new events for the
instruments are not collected.

     INSTALL PLUGIN plugin_a;

The server detects that the 40 instruments are already defined, so no
new instruments are created, and previously assigned internal memory
buffers are reused.  The server still has 190 instruments.

     INSTALL PLUGIN plugin_b;

The server has room for 200-190 = 10 instruments (in this case, mutex
classes), and sees that the plugin contains 20 new instruments.  10
instruments are loaded, and 10 are discarded or 'lost.' The
'Performance_schema_mutex_classes_lost' indicates the number of
instruments (mutex classes) lost:

     mysql> SHOW STATUS LIKE "perf%mutex_classes_lost";
     +---------------------------------------+-------+
     | Variable_name                         | Value |
     +---------------------------------------+-------+
     | Performance_schema_mutex_classes_lost | 10    |
     +---------------------------------------+-------+
     1 row in set (0.10 sec)

The instrumentation still works and collects (partial) data for
'plugin_b'.

When the server cannot create a mutex instrument, these results occur:

   * No row for the instrument is inserted into the *note
     'setup_instruments': setup-instruments-table. table.

   * 'Performance_schema_mutex_classes_lost' increases by 1.

   * 'Performance_schema_mutex_instances_lost' does not change.  (When
     the mutex instrument is not created, it cannot be used to create
     instrumented mutex instances later.)

The pattern just described applies to all types of instruments, not just
mutexes.

A value of 'Performance_schema_mutex_classes_lost' greater than 0 can
happen in two cases:

   * To save a few bytes of memory, you start the server with
     '--performance_schema_max_mutex_classes=N', where N is less than
     the default value.  The default value is chosen to be sufficient to
     load all the plugins provided in the MySQL distribution, but this
     can be reduced if some plugins are never loaded.  For example, you
     might choose not to load some of the storage engines in the
     distribution.

   * You load a third-party plugin that is instrumented for the
     Performance Schema but do not allow for the plugin's
     instrumentation memory requirements when you start the server.
     Because it comes from a third party, the instrument memory
     consumption of this engine is not accounted for in the default
     value chosen for 'performance_schema_max_mutex_classes'.

     If the server has insufficient resources for the plugin's
     instruments and you do not explicitly allocate more using
     '--performance_schema_max_mutex_classes=N', loading the plugin
     leads to starvation of instruments.

If the value chosen for 'performance_schema_max_mutex_classes' is too
small, no error is reported in the error log and there is no failure at
runtime.  However, the content of the tables in the 'performance_schema'
database will miss events.  The 'Performance_schema_mutex_classes_lost'
status variable is the only visible sign to indicate that some events
were dropped internally due to failure to create instruments.

If an instrument is not lost, it is known to the Performance Schema, and
is used when instrumenting instances.  For example,
'wait/synch/mutex/sql/LOCK_delete' is the name of a mutex instrument in
the *note 'setup_instruments': setup-instruments-table. table.  This
single instrument is used when creating a mutex in the code (in
'THD::LOCK_delete') however many instances of the mutex are needed as
the server runs.  In this case, 'LOCK_delete' is a mutex that is per
connection ('THD'), so if a server has 1000 connections, there are 1000
threads, and 1000 instrumented 'LOCK_delete' mutex instances
('THD::LOCK_delete').

If the server does not have room for all these 1000 instrumented mutexes
(instances), some mutexes are created with instrumentation, and some are
created without instrumentation.  If the server can create only 800
instances, 200 instances are lost.  The server continues to run, but
increments 'Performance_schema_mutex_instances_lost' by 200 to indicate
that instances could not be created.

A value of 'Performance_schema_mutex_instances_lost' greater than 0 can
happen when the code initializes more mutexes at runtime than were
allocated for '--performance_schema_max_mutex_instances=N'.

The bottom line is that if *note 'SHOW STATUS LIKE 'perf%'':
show-status. says that nothing was lost (all values are zero), the
Performance Schema data is accurate and can be relied upon.  If
something was lost, the data is incomplete, and the Performance Schema
could not record everything given the insufficient amount of memory it
was given to use.  In this case, the specific
'Performance_schema_XXX_lost' variable indicates the problem area.

It might be appropriate in some cases to cause deliberate instrument
starvation.  For example, if you do not care about performance data for
file I/O, you can start the server with all Performance Schema
parameters related to file I/O set to 0.  No memory will be allocated
for file-related classes, instances, or handles, and all file events
will be lost.

Use *note 'SHOW ENGINE PERFORMANCE_SCHEMA STATUS': show-engine. to
inspect the internal operation of the Performance Schema code:

     mysql> SHOW ENGINE PERFORMANCE_SCHEMA STATUS\G
     ...
     *************************** 3. row ***************************
       Type: performance_schema
       Name: events_waits_history.row_size
     Status: 76
     *************************** 4. row ***************************
       Type: performance_schema
       Name: events_waits_history.row_count
     Status: 10000
     *************************** 5. row ***************************
       Type: performance_schema
       Name: events_waits_history.memory
     Status: 760000
     ...
     *************************** 57. row ***************************
       Type: performance_schema
       Name: performance_schema.memory
     Status: 26459600
     ...

This statement is intended to help the DBA understand the effects that
different Performance Schema options have on memory requirements.  For a
description of the field meanings, see *note show-engine::.


File: manual.info.tmp,  Node: performance-schema-event-tables,  Next: performance-schema-table-characteristics,  Prev: performance-schema-status-monitoring,  Up: performance-schema

22.8 Performance Schema Tables for Current and Historical Events
================================================================

The Performance Schema can monitor and store current wait events.  In
addition, when events end, the Performance Schema can store them in
history tables.  The Performance Schema uses three tables for storing
current and historical events:

   * *note 'events_waits_current': events-waits-current-table.: The
     'current events' table stores the current monitored event for each
     thread (one row per thread).

   * *note 'events_waits_history': events-waits-history-table.: The
     'recent history' table stores the most recent events that have
     ended per thread (up to a maximum number of rows per thread).

   * *note 'events_waits_history_long':
     events-waits-history-long-table.: The 'long history' table stores
     the most recent events that have ended globally (across all
     threads, up to a maximum number of rows per table).

The 'event_waits_current' table contains one row per thread, so there is
no system variable for configuring its maximum size.  The history tables
by default store 10 rows per thread for 'event_waits_history', and
10,000 rows total for 'event_waits_history_long'.  These sizes can be
configured explicitly at server startup using table-specific system
variables, as indicated in the sections that describe the individual
history tables.

The three tables have the same columns.

The 'event_waits_current' table shows what is currently happening within
the server.  When a current event ends, it is removed from the table.

The 'event_waits_history' and 'event_waits_history_long' tables show
what has happened in the recent past.  When the history tables become
full, old events are discarded as new events are added.  Rows expire
from the 'event_waits_history' and 'event_waits_history_long' tables in
different ways because the tables serve different purposes:

   * 'event_waits_history' is meant to investigate individual threads,
     independently of the global server load.

   * 'event_waits_history_long' is meant to investigate the server
     globally, not each thread.

The difference between the two types of history tables relates to the
data retention policy.  Both tables contains the same data when an event
is first seen.  However, data within each table expires differently over
time, so that data might be preserved for a longer or shorter time in
each table:

   * For 'event_waits_history', when the table contains the maximum
     number of rows for a given thread, the oldest thread row is
     discarded when a new row for that thread is added.

   * For 'event_waits_history_long', when the table becomes full, the
     oldest row is discarded when a new row is added, regardless of
     which thread generated either row.

When a thread ends, all its rows are discarded from the '_history' table
but not from the '_history_long' table.

The following example illustrates the differences in how events are
added to and discarded from the two types of history tables.  The
example is based on these assumptions:

   * The Performance Schema is configured to retain 10 rows per thread
     in the 'event_waits_history' table and 10,000 rows total in the
     'event_waits_history_long' table.

   * Thread A generates 1 event per second.

     Thread B generates 100 events per second.

   * No other threads are running.

After 5 seconds of execution:

   * A and B have generated 5 and 500 events, respectively.

   * 'event_waits_history' contains 5 rows for A and 10 rows for B.
     Because storage per thread is limited to 10 rows, no rows have been
     discarded for A, whereas 490 rows have been discarded for B.

   * 'event_waits_history_long' contains 5 rows for A and 500 rows for
     B. Because the table has a maximum size of 10,000 rows, no rows
     have been discarded for either thread.

After 5 minutes (300 seconds) of execution:

   * A and B have generated 300 and 30,000 events, respectively.

   * 'event_waits_history' contains 10 rows for A and 10 rows for B.
     Because storage per thread is limited to 10 rows, 290 rows have
     been discarded for A, whereas 29,990 rows have been discarded for
     B. Rows for A include data up to 10 seconds old, whereas rows for B
     include data up to only .1 seconds old.

   * 'event_waits_history_long' contains 10,000 rows.  Because A and B
     together generate 101 events per second, the table contains data up
     to approximately 10,000/101 = 99 seconds old, with a mix of rows
     approximately 100 to 1 from B as opposed to A.


File: manual.info.tmp,  Node: performance-schema-table-characteristics,  Next: performance-schema-table-descriptions,  Prev: performance-schema-event-tables,  Up: performance-schema

22.9 Performance Schema General Table Characteristics
=====================================================

The name of the 'performance_schema' database is lowercase, as are the
names of tables within it.  Queries should specify the names in
lowercase.

Many tables in the 'performance_schema' database are read only and
cannot be modified:

     mysql> TRUNCATE TABLE performance_schema.setup_instruments;
     ERROR 1683 (HY000): Invalid performance_schema usage.

Some of the setup tables have columns that can be modified to affect
Performance Schema operation.  Truncation is permitted to clear
collected events, so *note 'TRUNCATE TABLE': truncate-table. can be used
on tables containing those kinds of information, such as tables named
with a prefix of 'events_waits_'.

Summary tables can be truncated with *note 'TRUNCATE TABLE':
truncate-table.  The effect is to reset the summary columns to 0 or
'NULL', not to remove rows.  This enables you to clear collected values
and restart aggregation.  That might be useful, for example, after you
have made a runtime configuration change.

Privileges are as for other databases and tables:

   * To retrieve from 'performance_schema' tables, you must have the
     'SELECT' privilege.

   * To change those columns that can be modified, you must have the
     'UPDATE' privilege.

   * To truncate tables that can be truncated, you must have the 'DROP'
     privilege.

Because only a limited set of privileges apply to Performance Schema
tables, attempts to use 'GRANT ALL' as shorthand for granting privileges
at the database or table leval fail with an error:

     mysql> GRANT ALL ON performance_schema.*
            TO 'u1'@'localhost';
     ERROR 1044 (42000): Access denied for user 'root'@'localhost'
     to database 'performance_schema'
     mysql> GRANT ALL ON performance_schema.setup_instruments
            TO 'u2'@'localhost';
     ERROR 1044 (42000): Access denied for user 'root'@'localhost'
     to database 'performance_schema'

Instead, grant exactly the desired privileges:

     mysql> GRANT SELECT ON performance_schema.*
            TO 'u1'@'localhost';
     Query OK, 0 rows affected (0.03 sec)

     mysql> GRANT SELECT, UPDATE ON performance_schema.setup_instruments
            TO 'u2'@'localhost';
     Query OK, 0 rows affected (0.02 sec)


File: manual.info.tmp,  Node: performance-schema-table-descriptions,  Next: performance-schema-option-variable-reference,  Prev: performance-schema-table-characteristics,  Up: performance-schema

22.10 Performance Schema Table Descriptions
===========================================

* Menu:

* performance-schema-table-index::  Performance Schema Table Index
* performance-schema-setup-tables::  Performance Schema Setup Tables
* performance-schema-instance-tables::  Performance Schema Instance Tables
* performance-schema-wait-tables::  Performance Schema Wait Event Tables
* performance-schema-summary-tables::  Performance Schema Summary Tables
* performance-schema-miscellaneous-tables::  Performance Schema Miscellaneous Tables

Tables in the 'performance_schema' database can be grouped as follows:

   * Setup tables.  These tables are used to configure and display
     monitoring characteristics.

   * Current events table.  The *note 'events_waits_current':
     events-waits-current-table. table contains the most recent event
     for each thread.

   * History tables.  These tables have the same structure as *note
     'events_waits_current': events-waits-current-table. but contain
     more rows.  The *note 'events_waits_history':
     events-waits-history-table. table contains the most recent 10
     events per thread.  *note 'events_waits_history_long':
     events-waits-history-long-table. contains the most recent 10,000
     events.

     To change the sizes of these tables, set the
     'performance_schema_events_waits_history_size' and
     'performance_schema_events_waits_history_long_size' system
     variables at server startup.

   * Summary tables.  These tables contain information aggregated over
     groups of events, including those that have been discarded from the
     history tables.

   * Instance tables.  These tables document what types of objects are
     instrumented.  An instrumented object, when used by the server,
     produces an event.  These tables provide event names and
     explanatory notes or status information.

   * Miscellaneous tables.  These do not fall into any of the other
     table groups.


File: manual.info.tmp,  Node: performance-schema-table-index,  Next: performance-schema-setup-tables,  Prev: performance-schema-table-descriptions,  Up: performance-schema-table-descriptions

22.10.1 Performance Schema Table Index
--------------------------------------

The following table lists each Performance Schema table and provides a
short description of each one.

*Performance Schema Tables*

Table Name                               Description
                                         
*note 'cond_instances': cond-instances-table.synchronization object
                                         instances
                                         
*note 'events_waits_current': events-waits-current-table.Current wait events
                                         
*note 'events_waits_history': events-waits-history-table.Most recent wait events per
                                         thread
                                         
*note 'events_waits_history_long': events-waits-history-long-table.Most recent wait events
                                         overall
                                         
*note 'events_waits_summary_by_instance': wait-summary-tables.Wait events per instance
                                         
*note 'events_waits_summary_by_thread_by_event_name': wait-summary-tables.Wait events per thread and
                                         event name
                                         
*note 'events_waits_summary_global_by_event_name': wait-summary-tables.Wait events per event name
                                         
*note 'file_instances': file-instances-table.File instances
                                         
*note 'file_summary_by_event_name': file-summary-tables.File events per event name
                                         
*note 'file_summary_by_instance': file-summary-tables.File events per file instance
                                         
*note 'mutex_instances': mutex-instances-table.Mutex synchronization object
                                         instances
                                         
*note 'performance_timers': performance-timers-table.Which event timers are
                                         available
                                         
*note 'rwlock_instances': rwlock-instances-table.Lock synchronization object
                                         instances
                                         
*note 'setup_consumers': setup-consumers-table.Consumers for which event
                                         information can be stored
                                         
*note 'setup_instruments': setup-instruments-table.Classes of instrumented
                                         objects for which events can
                                         be collected
                                         
*note 'setup_timers': setup-timers-table.Current event timer
                                         
*note 'threads': threads-table.          Information about server
                                         threads


File: manual.info.tmp,  Node: performance-schema-setup-tables,  Next: performance-schema-instance-tables,  Prev: performance-schema-table-index,  Up: performance-schema-table-descriptions

22.10.2 Performance Schema Setup Tables
---------------------------------------

* Menu:

* setup-consumers-table::        The setup_consumers Table
* setup-instruments-table::      The setup_instruments Table
* setup-timers-table::           The setup_timers Table

The setup tables provide information about the current instrumentation
and enable the monitoring configuration to be changed.  For this reason,
some columns in these tables can be changed if you have the 'UPDATE'
privilege.

The use of tables rather than individual variables for setup information
provides a high degree of flexibility in modifying Performance Schema
configuration.  For example, you can use a single statement with
standard SQL syntax to make multiple simultaneous configuration changes.

These setup tables are available:

   * *note 'setup_consumers': setup-consumers-table.: The types of
     consumers for which event information can be stored

   * *note 'setup_instruments': setup-instruments-table.: The classes of
     instrumented objects for which events can be collected

   * *note 'setup_timers': setup-timers-table.: The current event timer


File: manual.info.tmp,  Node: setup-consumers-table,  Next: setup-instruments-table,  Prev: performance-schema-setup-tables,  Up: performance-schema-setup-tables

22.10.2.1 The setup_consumers Table
...................................

The *note 'setup_consumers': setup-consumers-table. table lists the
types of consumers for which event information can be stored:

     mysql> SELECT * FROM performance_schema.setup_consumers;
     +----------------------------------------------+---------+
     | NAME                                         | ENABLED |
     +----------------------------------------------+---------+
     | events_waits_current                         | YES     |
     | events_waits_history                         | YES     |
     | events_waits_history_long                    | YES     |
     | events_waits_summary_by_thread_by_event_name | YES     |
     | events_waits_summary_by_event_name           | YES     |
     | events_waits_summary_by_instance             | YES     |
     | file_summary_by_event_name                   | YES     |
     | file_summary_by_instance                     | YES     |
     +----------------------------------------------+---------+

The *note 'setup_consumers': setup-consumers-table. table has these
columns:

   * 'NAME'

     The consumer name.

   * 'ENABLED'

     Whether the consumer is enabled.  The value is 'YES' or 'NO'.  This
     column can be modified.  If you disable a consumer, the server does
     not spend time adding event information to it.

*note 'TRUNCATE TABLE': truncate-table. is not permitted for the *note
'setup_consumers': setup-consumers-table. table.

Disabling the 'events_waits_current' consumer disables everything else
that depends on waits, such as the *note 'events_waits_history':
events-waits-history-table. and *note 'events_waits_history_long':
events-waits-history-long-table. tables, and all summary tables.


File: manual.info.tmp,  Node: setup-instruments-table,  Next: setup-timers-table,  Prev: setup-consumers-table,  Up: performance-schema-setup-tables

22.10.2.2 The setup_instruments Table
.....................................

The *note 'setup_instruments': setup-instruments-table. table lists
classes of instrumented objects for which events can be collected:

     mysql> SELECT * FROM performance_schema.setup_instruments;
     +---------------------------------------------------+---------+-------+
     | NAME                                              | ENABLED | TIMED |
     +---------------------------------------------------+---------+-------+
     ...
     | wait/synch/mutex/sql/LOCK_global_read_lock        | YES     | YES   |
     | wait/synch/mutex/sql/LOCK_global_system_variables | YES     | YES   |
     | wait/synch/mutex/sql/LOCK_lock_db                 | YES     | YES   |
     | wait/synch/mutex/sql/LOCK_manager                 | YES     | YES   |
     ...
     | wait/synch/rwlock/sql/LOCK_grant                  | YES     | YES   |
     | wait/synch/rwlock/sql/LOGGER::LOCK_logger         | YES     | YES   |
     | wait/synch/rwlock/sql/LOCK_sys_init_connect       | YES     | YES   |
     | wait/synch/rwlock/sql/LOCK_sys_init_slave         | YES     | YES   |
     ...
     | wait/io/file/sql/binlog                           | YES     | YES   |
     | wait/io/file/sql/binlog_index                     | YES     | YES   |
     | wait/io/file/sql/casetest                         | YES     | YES   |
     | wait/io/file/sql/dbopt                            | YES     | YES   |
     ...

Each instrument added to the source code provides a row for the *note
'setup_instruments': setup-instruments-table. table, even when the
instrumented code is not executed.  When an instrument is enabled and
executed, instrumented instances are created, which are visible in the
'XXX_instances' tables, such as *note 'file_instances':
file-instances-table. or *note 'rwlock_instances':
rwlock-instances-table.

The *note 'setup_instruments': setup-instruments-table. table has these
columns:

   * 'NAME'

     The instrument name.  Instrument names may have multiple parts and
     form a hierarchy, as discussed in *note
     performance-schema-instrument-naming::.  Events produced from
     execution of an instrument have an 'EVENT_NAME' value that is taken
     from the instrument 'NAME' value.  (Events do not really have a
     'name,' but this provides a way to associate events with
     instruments.)

   * 'ENABLED'

     Whether the instrument is enabled.  The value is 'YES' or 'NO'.  A
     disabled instrument produces no events.  This column can be
     modified, although setting 'ENABLED' has no effect for instruments
     that have already been created.

   * 'TIMED'

     Whether the instrument is timed.  The value is 'YES' or 'NO'.  This
     column can be modified, although setting 'TIMED' has no effect for
     instruments that have already been created.

     If an enabled instrument is not timed, the instrument code is
     enabled, but the timer is not.  Events produced by the instrument
     have 'NULL' for the 'TIMER_START', 'TIMER_END', and 'TIMER_WAIT'
     timer values.  This in turn causes those values to be ignored when
     calculating the sum, minimum, maximum, and average time values in
     summary tables.

*note 'TRUNCATE TABLE': truncate-table. is not permitted for the *note
'setup_instruments': setup-instruments-table. table.


File: manual.info.tmp,  Node: setup-timers-table,  Prev: setup-instruments-table,  Up: performance-schema-setup-tables

22.10.2.3 The setup_timers Table
................................

The *note 'setup_timers': setup-timers-table. table shows the currently
selected event timer:

     mysql> SELECT * FROM performance_schema.setup_timers;
     +------+------------+
     | NAME | TIMER_NAME |
     +------+------------+
     | wait | CYCLE      |
     +------+------------+

The 'setup_timers.TIMER_NAME' value can be changed to select a different
timer.  The value can be any of the values in the
'performance_timers.TIMER_NAME' column.  For an explanation of how event
timing occurs, see *note performance-schema-timing::.

Modifications to the *note 'setup_timers': setup-timers-table. table
affect monitoring immediately.  Events already in progress use the
original timer for the begin time and the new timer for the end time,
which leads to unpredictable results.  If you make timer changes, you
may want to use *note 'TRUNCATE TABLE': truncate-table. to reset
Performance Schema statistics.

The *note 'setup_timers': setup-timers-table. table has these columns:

   * 'NAME'

     The type of instrument the timer is used for.

   * 'TIMER_NAME'

     The timer that applies to the instrument type.  This column can be
     modified.

*note 'TRUNCATE TABLE': truncate-table. is not permitted for the *note
'setup_timers': setup-timers-table. table.


File: manual.info.tmp,  Node: performance-schema-instance-tables,  Next: performance-schema-wait-tables,  Prev: performance-schema-setup-tables,  Up: performance-schema-table-descriptions

22.10.3 Performance Schema Instance Tables
------------------------------------------

* Menu:

* cond-instances-table::         The cond_instances Table
* file-instances-table::         The file_instances Table
* mutex-instances-table::        The mutex_instances Table
* rwlock-instances-table::       The rwlock_instances Table

Instance tables document what types of objects are instrumented.  They
provide event names and explanatory notes or status information:

   * *note 'cond_instances': cond-instances-table.: Condition
     synchronization object instances

   * *note 'file_instances': file-instances-table.: File instances

   * *note 'mutex_instances': mutex-instances-table.: Mutex
     synchronization object instances

   * *note 'rwlock_instances': rwlock-instances-table.: Lock
     synchronization object instances

These tables list instrumented synchronization objects and files.  There
are three types of synchronization objects: 'cond', 'mutex', and
'rwlock'.  Each instance table has an 'EVENT_NAME' or 'NAME' column to
indicate the instrument associated with each row.  Instrument names may
have multiple parts and form a hierarchy, as discussed in *note
performance-schema-instrument-naming::.

The 'mutex_instances.LOCKED_BY_THREAD_ID' and
'rwlock_instances.WRITE_LOCKED_BY_THREAD_ID' columns are extremely
important for investigating performance bottlenecks or deadlocks.  For
examples of how to use them for this purpose, see *note
performance-schema-examples::


File: manual.info.tmp,  Node: cond-instances-table,  Next: file-instances-table,  Prev: performance-schema-instance-tables,  Up: performance-schema-instance-tables

22.10.3.1 The cond_instances Table
..................................

The *note 'cond_instances': cond-instances-table. table lists all the
conditions seen by the Performance Schema while the server executes.  A
condition is a synchronization mechanism used in the code to signal that
a specific event has happened, so that a thread waiting for this
condition can resume work.

When a thread is waiting for something to happen, the condition name is
an indication of what the thread is waiting for, but there is no
immediate way to tell which other thread, or threads, will cause the
condition to happen.

The *note 'cond_instances': cond-instances-table. table has these
columns:

   * 'NAME'

     The instrument name associated with the condition.

   * 'OBJECT_INSTANCE_BEGIN'

     The address in memory of the instrumented condition.

*note 'TRUNCATE TABLE': truncate-table. is not permitted for the *note
'cond_instances': cond-instances-table. table.


File: manual.info.tmp,  Node: file-instances-table,  Next: mutex-instances-table,  Prev: cond-instances-table,  Up: performance-schema-instance-tables

22.10.3.2 The file_instances Table
..................................

The *note 'file_instances': file-instances-table. table lists all the
files seen by the Performance Schema when executing file I/O
instrumentation.  If a file on disk has never been opened, it will not
be in *note 'file_instances': file-instances-table.  When a file is
deleted from the disk, it is also removed from the *note
'file_instances': file-instances-table. table.

The *note 'file_instances': file-instances-table. table has these
columns:

   * 'FILE_NAME'

     The file name.

   * 'EVENT_NAME'

     The instrument name associated with the file.

   * 'OPEN_COUNT'

     The count of open handles on the file.  If a file was opened and
     then closed, it was opened 1 time, but 'OPEN_COUNT' will be 0.  To
     list all the files currently opened by the server, use 'WHERE
     OPEN_COUNT > 0'.

*note 'TRUNCATE TABLE': truncate-table. is not permitted for the *note
'file_instances': file-instances-table. table.


File: manual.info.tmp,  Node: mutex-instances-table,  Next: rwlock-instances-table,  Prev: file-instances-table,  Up: performance-schema-instance-tables

22.10.3.3 The mutex_instances Table
...................................

The *note 'mutex_instances': mutex-instances-table. table lists all the
mutexes seen by the Performance Schema while the server executes.  A
mutex is a synchronization mechanism used in the code to enforce that
only one thread at a given time can have access to some common resource.
The resource is said to be 'protected' by the mutex.

When two threads executing in the server (for example, two user sessions
executing a query simultaneously) do need to access the same resource (a
file, a buffer, or some piece of data), these two threads will compete
against each other, so that the first query to obtain a lock on the
mutex will cause the other query to wait until the first is done and
unlocks the mutex.

The work performed while holding a mutex is said to be in a 'critical
section,' and multiple queries do execute this critical section in a
serialized way (one at a time), which is a potential bottleneck.

The *note 'mutex_instances': mutex-instances-table. table has these
columns:

   * 'NAME'

     The instrument name associated with the mutex.

   * 'OBJECT_INSTANCE_BEGIN'

     The address in memory of the instrumented mutex.

   * 'LOCKED_BY_THREAD_ID'

     When a thread currently has a mutex locked, 'LOCKED_BY_THREAD_ID'
     is the 'THREAD_ID' of the locking thread, otherwise it is 'NULL'.

*note 'TRUNCATE TABLE': truncate-table. is not permitted for the *note
'mutex_instances': mutex-instances-table. table.

For every mutex instrumented in the code, the Performance Schema
provides the following information.

   * The *note 'setup_instruments': setup-instruments-table. table lists
     the name of the instrumentation point, with the prefix
     'wait/synch/mutex/'.

   * When some code creates a mutex, a row is added to the *note
     'mutex_instances': mutex-instances-table. table.  The
     'OBJECT_INSTANCE_BEGIN' column is a property that uniquely
     identifies the mutex.

   * When a thread attempts to lock a mutex, the *note
     'events_waits_current': events-waits-current-table. table shows a
     row for that thread, indicating that it is waiting on a mutex (in
     the 'EVENT_NAME' column), and indicating which mutex is waited on
     (in the 'OBJECT_INSTANCE_BEGIN' column).

   * When a thread succeeds in locking a mutex:

        * *note 'events_waits_current': events-waits-current-table.
          shows that the wait on the mutex is completed (in the
          'TIMER_END' and 'TIMER_WAIT' columns)

        * The completed wait event is added to the *note
          'events_waits_history': events-waits-history-table. and *note
          'events_waits_history_long': events-waits-history-long-table.
          tables

        * *note 'mutex_instances': mutex-instances-table. shows that the
          mutex is now owned by the thread (in the 'THREAD_ID' column).

   * When a thread unlocks a mutex, *note 'mutex_instances':
     mutex-instances-table. shows that the mutex now has no owner (the
     'THREAD_ID' column is 'NULL').

   * When a mutex object is destroyed, the corresponding row is removed
     from *note 'mutex_instances': mutex-instances-table.

By performing queries on both of the following tables, a monitoring
application or a DBA can detect bottlenecks or deadlocks between threads
that involve mutexes:

   * *note 'events_waits_current': events-waits-current-table, to see
     what mutex a thread is waiting for

   * *note 'mutex_instances': mutex-instances-table, to see which other
     thread currently owns a mutex


File: manual.info.tmp,  Node: rwlock-instances-table,  Prev: mutex-instances-table,  Up: performance-schema-instance-tables

22.10.3.4 The rwlock_instances Table
....................................

The *note 'rwlock_instances': rwlock-instances-table. table lists all
the 'rwlock' instances (read write locks) seen by the Performance Schema
while the server executes.  An 'rwlock' is a synchronization mechanism
used in the code to enforce that threads at a given time can have access
to some common resource following certain rules.  The resource is said
to be 'protected' by the 'rwlock'.  The access is either shared (many
threads can have a read lock at the same time) or exclusive (only one
thread can have a write lock at a given time).

Depending on how many threads are requesting a lock, and the nature of
the locks requested, access can be either granted in shared mode,
granted in exclusive mode, or not granted at all, waiting for other
threads to finish first.

The *note 'rwlock_instances': rwlock-instances-table. table has these
columns:

   * 'NAME'

     The instrument name associated with the lock.

   * 'OBJECT_INSTANCE_BEGIN'

     The address in memory of the instrumented lock.

   * 'WRITE_LOCKED_BY_THREAD_ID'

     When a thread currently has an 'rwlock' locked in exclusive (write)
     mode, 'WRITE_LOCKED_BY_THREAD_ID' is the 'THREAD_ID' of the locking
     thread, otherwise it is 'NULL'.

   * 'READ_LOCKED_BY_COUNT'

     When a thread currently has an 'rwlock' locked in shared (read)
     mode, 'READ_LOCKED_BY_COUNT' is incremented by 1.  This is a
     counter only, so it cannot be used directly to find which thread
     holds a read lock, but it can be used to see whether there is a
     read contention on an 'rwlock', and see how many readers are
     currently active.

*note 'TRUNCATE TABLE': truncate-table. is not permitted for the *note
'rwlock_instances': rwlock-instances-table. table.

By performing queries on both of the following tables, a monitoring
application or a DBA may detect some bottlenecks or deadlocks between
threads that involve locks:

   * *note 'events_waits_current': events-waits-current-table, to see
     what 'rwlock' a thread is waiting for

   * *note 'rwlock_instances': rwlock-instances-table, to see which
     other thread currently owns an 'rwlock'

There is a limitation: The *note 'rwlock_instances':
rwlock-instances-table. can be used only to identify the thread holding
a write lock, but not the threads holding a read lock.


File: manual.info.tmp,  Node: performance-schema-wait-tables,  Next: performance-schema-summary-tables,  Prev: performance-schema-instance-tables,  Up: performance-schema-table-descriptions

22.10.4 Performance Schema Wait Event Tables
--------------------------------------------

* Menu:

* events-waits-current-table::   The events_waits_current Table
* events-waits-history-table::   The events_waits_history Table
* events-waits-history-long-table::  The events_waits_history_long Table

The Performance Schema instruments waits, which are events that take
time.

These tables store wait events:

   * *note 'events_waits_current': events-waits-current-table.: The
     current wait event for each thread.

   * *note 'events_waits_history': events-waits-history-table.: The most
     recent wait events that have ended per thread.

   * *note 'events_waits_history_long':
     events-waits-history-long-table.: The most recent wait events that
     have ended globally (across all threads).

The following sections describe the wait event tables.  There are also
summary tables that aggregate information about wait events; see *note
wait-summary-tables::.

For more information about the relationship between the three wait event
tables, see *note performance-schema-event-tables::.

*Configuring Wait Event Collection*

To control whether to collect wait events, set the state of the relevant
instruments and consumers:

   * The *note 'setup_instruments': setup-instruments-table. table
     contains instruments with names that begin with 'wait'.  Use these
     instruments to enable or disable collection of individual wait
     event classes.

   * The *note 'setup_consumers': setup-consumers-table. table contains
     consumer values with names corresponding to the current and
     historical wait event table names.  Use these consumers to filter
     collection of wait events.

The wait instruments are enabled by default.  For example:

     mysql> SELECT * FROM performance_schema.setup_instruments
            WHERE NAME LIKE 'wait/io/file/innodb%';
     +--------------------------------------+---------+-------+
     | NAME                                 | ENABLED | TIMED |
     +--------------------------------------+---------+-------+
     | wait/io/file/innodb/innodb_data_file | YES     | YES   |
     | wait/io/file/innodb/innodb_log_file  | YES     | YES   |
     | wait/io/file/innodb/innodb_temp_file | YES     | YES   |
     +--------------------------------------+---------+-------+

The wait consumers are enabled by default:

     mysql> SELECT *
            FROM performance_schema.setup_consumers
            WHERE NAME LIKE 'events_waits%';
     +---------------------------+---------+
     | NAME                      | ENABLED |
     +---------------------------+---------+
     | events_waits_current      | YES     |
     | events_waits_history      | YES     |
     | events_waits_history_long | YES     |
     +---------------------------+---------+

To control wait event collection, update the *note 'setup_instruments':
setup-instruments-table. and *note 'setup_consumers':
setup-consumers-table. tables:

   * Enable:

          UPDATE performance_schema.setup_instruments
          SET ENABLED = 'YES', TIMED = 'YES'
          WHERE NAME = 'wait/%';

          UPDATE performance_schema.setup_consumers
          SET ENABLED = 'YES'
          WHERE NAME LIKE 'events_waits%';

   * Disable:

          UPDATE performance_schema.setup_instruments
          SET ENABLED = 'NO', TIMED = 'NO'
          WHERE NAME = 'wait/%';

          UPDATE performance_schema.setup_consumers
          SET ENABLED = 'NO'
          WHERE NAME LIKE 'events_waits%';

To collect only specific wait events, enable only the corresponding wait
instruments.  To collect wait events only for specific wait event
tables, enable the wait instruments but only the wait consumers
corresponding to the desired tables.

The *note 'setup_timers': setup-timers-table. table contains a row with
a 'NAME' value of 'wait' that indicates the unit for wait event timing.
The default unit is 'CYCLE':

     mysql> SELECT *
            FROM performance_schema.setup_timers
            WHERE NAME = 'wait';
     +------+------------+
     | NAME | TIMER_NAME |
     +------+------------+
     | wait | CYCLE      |
     +------+------------+

To change the timing unit, modify the 'TIMER_NAME' value:

     UPDATE performance_schema.setup_timers
     SET TIMER_NAME = 'NANOSECOND'
     WHERE NAME = 'wait';

For additional information about configuring event collection, see *note
performance-schema-runtime-configuration::.


File: manual.info.tmp,  Node: events-waits-current-table,  Next: events-waits-history-table,  Prev: performance-schema-wait-tables,  Up: performance-schema-wait-tables

22.10.4.1 The events_waits_current Table
........................................

The *note 'events_waits_current': events-waits-current-table. table
contains current wait events.  The table stores one row per thread
showing the current status of the thread's most recent monitored wait
event, so there is no system variable for configuring the table size.

Of the tables that contain wait event rows, *note
'events_waits_current': events-waits-current-table. is the most
fundamental.  Other tables that contain wait event rows are logically
derived from the current events.  For example, the *note
'events_waits_history': events-waits-history-table. and *note
'events_waits_history_long': events-waits-history-long-table. tables are
collections of the most recent wait events that have ended, up to a
maximum number of rows per thread and globally across all threads,
respectively.

For more information about the relationship between the three wait event
tables, see *note performance-schema-event-tables::.

For information about configuring whether to collect wait events, see
*note performance-schema-wait-tables::.

The *note 'events_waits_current': events-waits-current-table. table has
these columns:

   * 'THREAD_ID', 'EVENT_ID'

     The thread associated with the event and the thread current event
     number when the event starts.  The 'THREAD_ID' and 'EVENT_ID'
     values taken together uniquely identify the row.  No two rows have
     the same pair of values.

   * 'EVENT_NAME'

     The name of the instrument that produced the event.  This is a
     'NAME' value from the *note 'setup_instruments':
     setup-instruments-table. table.  Instrument names may have multiple
     parts and form a hierarchy, as discussed in *note
     performance-schema-instrument-naming::.

   * 'SOURCE'

     The name of the source file containing the instrumented code that
     produced the event and the line number in the file at which the
     instrumentation occurs.  This enables you to check the source to
     determine exactly what code is involved.  For example, if a mutex
     or lock is being blocked, you can check the context in which this
     occurs.

   * 'TIMER_START', 'TIMER_END', 'TIMER_WAIT'

     Timing information for the event.  The unit for these values is
     picoseconds (trillionths of a second).  The 'TIMER_START' and
     'TIMER_END' values indicate when event timing started and ended.
     'TIMER_WAIT' is the event elapsed time (duration).

     If an event has not finished, 'TIMER_END' and 'TIMER_WAIT' are
     'NULL'.

     If an event is produced from an instrument that has 'TIMED = NO',
     timing information is not collected, and 'TIMER_START',
     'TIMER_END', and 'TIMER_WAIT' are all 'NULL'.

     For discussion of picoseconds as the unit for event times and
     factors that affect time values, see *note
     performance-schema-timing::.

   * 'SPINS'

     For a mutex, the number of spin rounds.  If the value is 'NULL',
     the code does not use spin rounds or spinning is not instrumented.

   * 'OBJECT_SCHEMA', 'OBJECT_NAME', 'OBJECT_TYPE',
     'OBJECT_INSTANCE_BEGIN'

     These columns identify the object 'being acted on.' What that means
     depends on the object type.

     For a synchronization object ('cond', 'mutex', 'rwlock'):

        * 'OBJECT_SCHEMA', 'OBJECT_NAME', and 'OBJECT_TYPE' are 'NULL'.

        * 'OBJECT_INSTANCE_BEGIN' is the address of the synchronization
          object in memory.

     For a file I/O object:

        * 'OBJECT_SCHEMA' is 'NULL'.

        * 'OBJECT_NAME' is the file name.

        * 'OBJECT_TYPE' is 'FILE'.

        * 'OBJECT_INSTANCE_BEGIN' is an address in memory.

     An 'OBJECT_INSTANCE_BEGIN' value itself has no meaning, except that
     different values indicate different objects.
     'OBJECT_INSTANCE_BEGIN' can be used for debugging.  For example, it
     can be used with 'GROUP BY OBJECT_INSTANCE_BEGIN' to see whether
     the load on 1,000 mutexes (that protect, say, 1,000 pages or blocks
     of data) is spread evenly or just hitting a few bottlenecks.  This
     can help you correlate with other sources of information if you see
     the same object address in a log file or another debugging or
     performance tool.

   * 'NESTING_EVENT_ID'

     Always 'NULL'.

   * 'OPERATION'

     The type of operation performed, such as 'lock', 'read', or
     'write'.

   * 'NUMBER_OF_BYTES'

     The number of bytes read or written by the operation.

   * 'FLAGS'

     Reserved for future use.

*note 'TRUNCATE TABLE': truncate-table. is permitted for the *note
'events_waits_current': events-waits-current-table. table.  It removes
the rows.


File: manual.info.tmp,  Node: events-waits-history-table,  Next: events-waits-history-long-table,  Prev: events-waits-current-table,  Up: performance-schema-wait-tables

22.10.4.2 The events_waits_history Table
........................................

The *note 'events_waits_history': events-waits-history-table. table
contains the most recent 10 wait events that have ended per thread.
Wait events are not added to the table until they have ended.  When the
table contains the maximum number of rows for a given thread, the oldest
thread row is discarded when a new row for that thread is added.  When a
thread ends, all its rows are discarded.

To change the number of rows per thread, modify the
'performance_schema_events_waits_history_size' system variable at server
startup.

The *note 'events_waits_history': events-waits-history-table. table has
the same columns as *note 'events_waits_current':
events-waits-current-table.  See *note events-waits-current-table::.

*note 'TRUNCATE TABLE': truncate-table. is permitted for the *note
'events_waits_history': events-waits-history-table. table.  It removes
the rows.

For more information about the relationship between the three wait event
tables, see *note performance-schema-event-tables::.

For information about configuring whether to collect wait events, see
*note performance-schema-wait-tables::.


File: manual.info.tmp,  Node: events-waits-history-long-table,  Prev: events-waits-history-table,  Up: performance-schema-wait-tables

22.10.4.3 The events_waits_history_long Table
.............................................

The *note 'events_waits_history_long': events-waits-history-long-table.
table contains the most recent 10,000 wait events that have ended
globally, across all threads.  Wait events are not added to the table
until they have ended.  When the table becomes full, the oldest row is
discarded when a new row is added, regardless of which thread generated
either row.

To change the table size, modify the
'performance_schema_events_waits_history_long_size' system variable at
server startup.

The *note 'events_waits_history_long': events-waits-history-long-table.
table has the same columns as *note 'events_waits_current':
events-waits-current-table.  See *note events-waits-current-table::.

*note 'TRUNCATE TABLE': truncate-table. is permitted for the *note
'events_waits_history_long': events-waits-history-long-table. table.  It
removes the rows.

For more information about the relationship between the three wait event
tables, see *note performance-schema-event-tables::.

For information about configuring whether to collect wait events, see
*note performance-schema-wait-tables::.


File: manual.info.tmp,  Node: performance-schema-summary-tables,  Next: performance-schema-miscellaneous-tables,  Prev: performance-schema-wait-tables,  Up: performance-schema-table-descriptions

22.10.5 Performance Schema Summary Tables
-----------------------------------------

* Menu:

* wait-summary-tables::          Wait Event Summary Tables
* file-summary-tables::          File I/O Summary Tables

Summary tables provide aggregated information for terminated events over
time.  The tables in this group summarize event data in different ways.

*Wait Event Summaries*

   * *note 'events_waits_summary_by_instance': wait-summary-tables.:
     Wait events per instance

   * *note 'events_waits_summary_by_thread_by_event_name':
     wait-summary-tables.: Wait events per thread and event name

   * *note 'events_waits_summary_global_by_event_name':
     wait-summary-tables.: Wait events per event name

*File I/O Summaries*

   * *note 'file_summary_by_event_name': file-summary-tables.: File
     events per event name

   * *note 'file_summary_by_instance': file-summary-tables.: File events
     per file instance

Each summary table has grouping columns that determine how to group the
data to be aggregated, and summary columns that contain the aggregated
values.  Tables that summarize events in similar ways often have similar
sets of summary columns and differ only in the grouping columns used to
determine how events are aggregated.

Summary tables can be truncated with *note 'TRUNCATE TABLE':
truncate-table.  The effect is to reset the summary columns to 0 or
'NULL', not to remove rows.  This enables you to clear collected values
and restart aggregation.  That might be useful, for example, after you
have made a runtime configuration change.


File: manual.info.tmp,  Node: wait-summary-tables,  Next: file-summary-tables,  Prev: performance-schema-summary-tables,  Up: performance-schema-summary-tables

22.10.5.1 Wait Event Summary Tables
...................................

The Performance Schema maintains tables for collecting current and
recent wait events, and aggregates that information in summary tables.
*note performance-schema-wait-tables:: describes the events on which
wait summaries are based.  See that discussion for information about the
content of wait events, the current and recent wait event tables, and
how to control wait event collection.

Example wait event summary information:

     mysql> SELECT * FROM performance_schema.events_waits_summary_global_by_event_name\G
     ...
     *************************** 6. row ***************************
         EVENT_NAME: wait/synch/mutex/sql/BINARY_LOG::LOCK_index
         COUNT_STAR: 8
     SUM_TIMER_WAIT: 2119302
     MIN_TIMER_WAIT: 196092
     AVG_TIMER_WAIT: 264912
     MAX_TIMER_WAIT: 569421
     ...
     *************************** 9. row ***************************
         EVENT_NAME: wait/synch/mutex/sql/hash_filo::lock
         COUNT_STAR: 69
     SUM_TIMER_WAIT: 16848828
     MIN_TIMER_WAIT: 0
     AVG_TIMER_WAIT: 244185
     MAX_TIMER_WAIT: 735345
     ...

Each wait event summary table has one or more grouping columns to
indicate how the table aggregates events.  Event names refer to names of
event instruments in the *note 'setup_instruments':
setup-instruments-table. table:

   * *note 'events_waits_summary_by_instance': wait-summary-tables. has
     'EVENT_NAME' and 'OBJECT_INSTANCE_BEGIN' columns.  Each row
     summarizes events for a given event name and object.  If an
     instrument is used to create multiple instances, each instance has
     a unique 'OBJECT_INSTANCE_BEGIN' value, so these instances are
     summarized separately in this table.

   * *note 'events_waits_summary_by_thread_by_event_name':
     wait-summary-tables. has 'THREAD_ID' and 'EVENT_NAME' columns.
     Each row summarizes events for a given thread and event name.

   * *note 'events_waits_summary_global_by_event_name':
     wait-summary-tables. has an 'EVENT_NAME' column.  Each row
     summarizes events for a given event name.  An instrument might be
     used to create multiple instances of the instrumented object.  For
     example, if there is an instrument for a mutex that is created for
     each connection, there are as many instances as there are
     connections.  The summary row for the instrument summarizes over
     all these instances.

Each wait event summary table has these summary columns containing
aggregated values:

   * 'COUNT_STAR'

     The number of summarized events.  This value includes all events,
     whether timed or nontimed.

   * 'SUM_TIMER_WAIT'

     The total wait time of the summarized timed events.  This value is
     calculated only for timed events because nontimed events have a
     wait time of 'NULL'.  The same is true for the other
     'XXX_TIMER_WAIT' values.

   * 'MIN_TIMER_WAIT'

     The minimum wait time of the summarized timed events.

   * 'AVG_TIMER_WAIT'

     The average wait time of the summarized timed events.

   * 'MAX_TIMER_WAIT'

     The maximum wait time of the summarized timed events.

*note 'TRUNCATE TABLE': truncate-table. is permitted for wait summary
tables.  It resets the summary columns to zero rather than removing
rows.


File: manual.info.tmp,  Node: file-summary-tables,  Prev: wait-summary-tables,  Up: performance-schema-summary-tables

22.10.5.2 File I/O Summary Tables
.................................

The Performance Schema maintains file I/O summary tables that aggregate
information about I/O operations.

Example file I/O event summary information:

     mysql> SELECT * FROM performance_schema.file_summary_by_instance\G
     ...
     *************************** 2. row ***************************
                     FILE_NAME: /var/mysql/share/english/errmsg.sys
                    EVENT_NAME: wait/io/file/sql/ERRMSG
                    COUNT_READ: 3
                   COUNT_WRITE: 0
      SUM_NUMBER_OF_BYTES_READ: 42211
     SUM_NUMBER_OF_BYTES_WRITE: 0
     ...
     *************************** 6. row ***************************
                     FILE_NAME: /var/mysql/data/binlog.000001
                    EVENT_NAME: wait/io/file/sql/binlog
                    COUNT_READ: 0
                   COUNT_WRITE: 0
      SUM_NUMBER_OF_BYTES_READ: 0
     SUM_NUMBER_OF_BYTES_WRITE: 0
     ...

Each file I/O summary table has one or more grouping columns to indicate
how the table aggregates events.  Event names refer to names of event
instruments in the *note 'setup_instruments': setup-instruments-table.
table:

   * *note 'file_summary_by_event_name': file-summary-tables. has an
     'EVENT_NAME' column.  Each row summarizes events for a given event
     name.

   * *note 'file_summary_by_instance': file-summary-tables. has
     'FILE_NAME' and 'EVENT_NAME' columns.  Each row summarizes events
     for a given file instrument instance.

Each file I/O summary table has these summary columns containing
aggregated values:

   * 'COUNT_READ'

     The number of read operations in the summarized events.

   * 'COUNT_WRITE'

     The number of write operations in the summarized events.

   * 'SUM_NUMBER_OF_BYTES_READ'

     The number of bytes read in the summarized events.

   * 'SUM_NUMBER_OF_BYTES_WRITE'

     The number of bytes written in the summarized events.

*note 'TRUNCATE TABLE': truncate-table. is permitted for file I/O
summary tables.  It resets the summary columns to zero rather than
removing rows.

The MySQL server uses several techniques to avoid I/O operations by
caching information read from files, so it is possible that statements
you might expect to result in I/O events will not.  You may be able to
ensure that I/O does occur by flushing caches or restarting the server
to reset its state.


File: manual.info.tmp,  Node: performance-schema-miscellaneous-tables,  Prev: performance-schema-summary-tables,  Up: performance-schema-table-descriptions

22.10.6 Performance Schema Miscellaneous Tables
-----------------------------------------------

* Menu:

* performance-timers-table::     The performance_timers Table
* threads-table::                The threads Table

The following sections describe tables that do not fall into the table
categories discussed in the preceding sections:

   * *note 'performance_timers': performance-timers-table.: Which event
     timers are available

   * *note 'threads': threads-table.: Information about server threads


File: manual.info.tmp,  Node: performance-timers-table,  Next: threads-table,  Prev: performance-schema-miscellaneous-tables,  Up: performance-schema-miscellaneous-tables

22.10.6.1 The performance_timers Table
......................................

The *note 'performance_timers': performance-timers-table. table shows
which event timers are available:

     mysql> SELECT * FROM performance_schema.performance_timers;
     +-------------+-----------------+------------------+----------------+
     | TIMER_NAME  | TIMER_FREQUENCY | TIMER_RESOLUTION | TIMER_OVERHEAD |
     +-------------+-----------------+------------------+----------------+
     | CYCLE       |      2389029850 |                1 |             72 |
     | NANOSECOND  |            NULL |             NULL |           NULL |
     | MICROSECOND |         1000000 |                1 |            585 |
     | MILLISECOND |            1035 |                1 |            738 |
     | TICK        |             101 |                1 |            630 |
     +-------------+-----------------+------------------+----------------+

If the values associated with a given timer name are 'NULL', that timer
is not supported on your platform.  The rows that do not contain 'NULL'
indicate which timers you can use in *note 'setup_timers':
setup-timers-table.  For an explanation of how event timing occurs, see
*note performance-schema-timing::.

The *note 'performance_timers': performance-timers-table. table has
these columns:

   * 'TIMER_NAME'

     The name by which to refer to the timer when configuring the *note
     'setup_timers': setup-timers-table. table.

   * 'TIMER_FREQUENCY'

     The number of timer units per second.  For a cycle timer, the
     frequency is generally related to the CPU speed.  For example, on a
     system with a 2.4GHz processor, the 'CYCLE' may be close to
     2400000000.

   * 'TIMER_RESOLUTION'

     Indicates the number of timer units by which timer values increase.
     If a timer has a resolution of 10, its value increases by 10 each
     time.

   * 'TIMER_OVERHEAD'

     The minimal number of cycles of overhead to obtain one timing with
     the given timer.  The Performance Schema determines this value by
     invoking the timer 20 times during initialization and picking the
     smallest value.  The total overhead really is twice this amount
     because the instrumentation invokes the timer at the start and end
     of each event.  The timer code is called only for timed events, so
     this overhead does not apply for nontimed events.

*note 'TRUNCATE TABLE': truncate-table. is not permitted for the *note
'performance_timers': performance-timers-table. table.


File: manual.info.tmp,  Node: threads-table,  Prev: performance-timers-table,  Up: performance-schema-miscellaneous-tables

22.10.6.2 The threads Table
...........................

The *note 'threads': threads-table. table contains a row for each server
thread:

     mysql> SELECT * FROM performance_schema.threads;
     +-----------+----------------+----------------------------------------+
     | THREAD_ID | PROCESSLIST_ID | NAME                                   |
     +-----------+----------------+----------------------------------------+
     |         0 |              0 | thread/sql/main                        |
     |         1 |              0 | thread/innodb/io_handler_thread        |
     |        16 |              0 | thread/sql/signal_handler              |
     |        23 |              7 | thread/sql/one_connection              |
     |         5 |              0 | thread/innodb/io_handler_thread        |
     |        12 |              0 | thread/innodb/srv_lock_timeout_thread  |
     |        22 |              6 | thread/sql/one_connection              |
     ...

*Note*:

For *note 'INFORMATION_SCHEMA.PROCESSLIST': processlist-table. and *note
'SHOW PROCESSLIST': show-processlist, information about threads for
other users is shown only if the current user has the 'PROCESS'
privilege.  That is not true of the *note 'threads': threads-table.
table; all rows are shown to any user who has the 'SELECT' privilege for
the table.  Users who should not be able to see threads for other users
should not be given that privilege.

The *note 'threads': threads-table. table has these columns:

   * 'THREAD_ID'

     This is the unique identifier of an instrumented thread.

   * 'PROCESSLIST_ID'

     For threads that are displayed in the *note
     'INFORMATION_SCHEMA.PROCESSLIST': processlist-table. table, this is
     the same value displayed in the 'ID' column of that table.  It is
     also the value displayed in the 'Id' column of *note 'SHOW
     PROCESSLIST': show-processlist. output, and the value that
     'CONNECTION_ID()' would return within that thread.

     For background threads (threads not associated with a user
     connection), 'PROCESSLIST_ID' is 0, so the values are not unique.

   * 'NAME'

     'NAME' is the name associated with the instrumentation of the code
     in the server.  For example, 'thread/sql/one_connection'
     corresponds to the thread function in the code responsible for
     handling a user connection, and 'thread/sql/main' stands for the
     'main()' function of the server.

*note 'TRUNCATE TABLE': truncate-table. is not permitted for the *note
'threads': threads-table. table.


File: manual.info.tmp,  Node: performance-schema-option-variable-reference,  Next: performance-schema-system-variables,  Prev: performance-schema-table-descriptions,  Up: performance-schema

22.11 Performance Schema Option and Variable Reference
======================================================

*Performance Schema Variable Reference*

Name           Cmd-Line    Option      System      Status      Var Scope   Dynamic
                           File        Var         Var                     
                                                   
performance_schemaYes      Yes         Yes                     Global      No
                                                                           
Performance_schema_cond_classes_lost               Yes         Global      No
                                                                           
Performance_schema_cond_instances_lost             Yes         Global      No
                                                                           
performance_schema_events_waits_history_long_sizeYesYesYes     Global      No
                                                                           
performance_schema_events_waits_history_sizeYesYesYes          Global      No
                                                                           
Performance_schema_file_classes_lost               Yes         Global      No
                                                                           
Performance_schema_file_handles_lost               Yes         Global      No
                                                                           
Performance_schema_file_instances_lost             Yes         Global      No
                                                                           
Performance_schema_locker_lost                     Yes         Global      No
                                                                           
performance_schema_max_cond_classesYesYesYes                   Global      No
                                                                           
performance_schema_max_cond_instancesYesYesYes                 Global      No
                                                                           
performance_schema_max_file_classesYesYesYes                   Global      No
                                                                           
performance_schema_max_file_handlesYesYesYes                   Global      No
                                                                           
performance_schema_max_file_instancesYesYesYes                 Global      No
                                                                           
performance_schema_max_mutex_classesYesYesYes                  Global      No
                                                                           
performance_schema_max_mutex_instancesYesYesYes                Global      No
                                                                           
performance_schema_max_rwlock_classesYesYesYes                 Global      No
                                                                           
performance_schema_max_rwlock_instancesYesYesYes               Global      No
                                                                           
performance_schema_max_table_handlesYesYesYes                  Global      No
                                                                           
performance_schema_max_table_instancesYesYesYes                Global      No
                                                                           
performance_schema_max_thread_classesYesYesYes                 Global      No
                                                                           
performance_schema_max_thread_instancesYesYesYes               Global      No
                                                                           
Performance_schema_mutex_classes_lost              Yes         Global      No
                                                                           
Performance_schema_mutex_instances_lost            Yes         Global      No
                                                                           
Performance_schema_rwlock_classes_lost             Yes         Global      No
                                                                           
Performance_schema_rwlock_instances_lost           Yes         Global      No
                                                                           
Performance_schema_table_handles_lost              Yes         Global      No
                                                                           
Performance_schema_table_instances_lost            Yes         Global      No
                                                                           
Performance_schema_thread_classes_lost             Yes         Global      No
                                                                           
Performance_schema_thread_instances_lost           Yes         Global      No
                                                               


File: manual.info.tmp,  Node: performance-schema-system-variables,  Next: performance-schema-status-variables,  Prev: performance-schema-option-variable-reference,  Up: performance-schema

22.12 Performance Schema System Variables
=========================================

The Performance Schema implements several system variables that provide
configuration information:

     mysql> SHOW VARIABLES LIKE 'perf%';
     +---------------------------------------------------+---------+
     | Variable_name                                     | Value   |
     +---------------------------------------------------+---------+
     | performance_schema                                | ON      |
     | performance_schema_events_waits_history_long_size | 10000   |
     | performance_schema_events_waits_history_size      | 10      |
     | performance_schema_max_cond_classes               | 80      |
     | performance_schema_max_cond_instances             | 1000    |
     | performance_schema_max_file_classes               | 50      |
     | performance_schema_max_file_handles               | 32768   |
     | performance_schema_max_file_instances             | 10000   |
     | performance_schema_max_mutex_classes              | 200     |
     | performance_schema_max_mutex_instances            | 1000000 |
     | performance_schema_max_rwlock_classes             | 30      |
     | performance_schema_max_rwlock_instances           | 1000000 |
     | performance_schema_max_table_handles              | 100000  |
     | performance_schema_max_table_instances            | 50000   |
     | performance_schema_max_thread_classes             | 50      |
     | performance_schema_max_thread_instances           | 1000    |
     +---------------------------------------------------+---------+

Performance Schema system variables can be set at server startup on the
command line or in option files, and many can be set at runtime.  See
*note performance-schema-option-variable-reference::.

Performance Schema system variables have the following meanings:

   * 
     'performance_schema'

     Property               Value
                            
     *Command-Line          '--performance-schema[={OFF|ON}]'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Boolean
                            
     *Default Value*        'OFF'

     The value of this variable is 'ON' or 'OFF' to indicate whether the
     Performance Schema is enabled.  By default, the value is 'OFF'.  At
     server startup, you can specify this variable with no value or a
     value of 1 to enable it, or with a value of 0 to disable it.

   * 
     'performance_schema_events_waits_history_long_size'

     Property               Value
                            
     *Command-Line          '--performance-schema-events-waits-history-long-size=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_events_waits_history_long_size'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '10000'

     The number of rows in the *note 'events_waits_history_long':
     events-waits-history-long-table. table.

   * 
     'performance_schema_events_waits_history_size'

     Property               Value
                            
     *Command-Line          '--performance-schema-events-waits-history-size=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_events_waits_history_size'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '10'

     The number of rows per thread in the *note 'events_waits_history':
     events-waits-history-table. table.

   * 
     'performance_schema_max_cond_classes'

     Property               Value
                            
     *Command-Line          '--performance-schema-max-cond-classes=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_max_cond_classes'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '80'
                            
     *Minimum Value*        '0'
                            
     *Maximum Value*        '256'

     The maximum number of condition instruments.  For information about
     how to set and use this variable, see *note
     performance-schema-status-monitoring::.

   * 
     'performance_schema_max_cond_instances'

     Property               Value
                            
     *Command-Line          '--performance-schema-max-cond-instances=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_max_cond_instances'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '1000'

     The maximum number of instrumented condition objects.  For
     information about how to set and use this variable, see *note
     performance-schema-status-monitoring::.

   * 
     'performance_schema_max_file_classes'

     Property               Value
                            
     *Command-Line          '--performance-schema-max-file-classes=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_max_file_classes'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '50'
                            
     *Minimum Value*        '0'
                            
     *Maximum Value*        '256'

     The maximum number of file instruments.  For information about how
     to set and use this variable, see *note
     performance-schema-status-monitoring::.

   * 
     'performance_schema_max_file_handles'

     Property               Value
                            
     *Command-Line          '--performance-schema-max-file-handles=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_max_file_handles'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '32768'

     The maximum number of opened file objects.  For information about
     how to set and use this variable, see *note
     performance-schema-status-monitoring::.

     The value of 'performance_schema_max_file_handles' should be
     greater than the value of 'open_files_limit': 'open_files_limit'
     affects the maximum number of open file handles the server can
     support and 'performance_schema_max_file_handles' affects how many
     of these file handles can be instrumented.

   * 
     'performance_schema_max_file_instances'

     Property               Value
                            
     *Command-Line          '--performance-schema-max-file-instances=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_max_file_instances'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '10000'

     The maximum number of instrumented file objects.  For information
     about how to set and use this variable, see *note
     performance-schema-status-monitoring::.

   * 
     'performance_schema_max_mutex_classes'

     Property               Value
                            
     *Command-Line          '--performance-schema-max-mutex-classes=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_max_mutex_classes'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '200'
                            
     *Minimum Value*        '0'
                            
     *Maximum Value*        '256'

     The maximum number of mutex instruments.  For information about how
     to set and use this variable, see *note
     performance-schema-status-monitoring::.

   * 
     'performance_schema_max_mutex_instances'

     Property               Value
                            
     *Command-Line          '--performance-schema-max-mutex-instances=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_max_mutex_instances'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '1000'

     The maximum number of instrumented mutex objects.  For information
     about how to set and use this variable, see *note
     performance-schema-status-monitoring::.

   * 
     'performance_schema_max_rwlock_classes'

     Property               Value
                            
     *Command-Line          '--performance-schema-max-rwlock-classes=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_max_rwlock_classes'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value* (>=    '30'
     5.5.7)                 

     *Default Value* (<=    '20'
     5.5.6)                 

     *Minimum Value*        '0'
                            
     *Maximum Value*        '256'

     The maximum number of rwlock instruments.  For information about
     how to set and use this variable, see *note
     performance-schema-status-monitoring::.

   * 
     'performance_schema_max_rwlock_instances'

     Property               Value
                            
     *Command-Line          '--performance-schema-max-rwlock-instances=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_max_rwlock_instances'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '1000'

     The maximum number of instrumented rwlock objects.  For information
     about how to set and use this variable, see *note
     performance-schema-status-monitoring::.

   * 
     'performance_schema_max_table_handles'

     Property               Value
                            
     *Command-Line          '--performance-schema-max-table-handles=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_max_table_handles'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '100000'

     The maximum number of opened table objects.  For information about
     how to set and use this variable, see *note
     performance-schema-status-monitoring::.

   * 
     'performance_schema_max_table_instances'

     Property               Value
                            
     *Command-Line          '--performance-schema-max-table-instances=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_max_table_instances'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '50000'

     The maximum number of instrumented table objects.  For information
     about how to set and use this variable, see *note
     performance-schema-status-monitoring::.

   * 
     'performance_schema_max_thread_classes'

     Property               Value
                            
     *Command-Line          '--performance-schema-max-thread-classes=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_max_thread_classes'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '50'
                            
     *Minimum Value*        '0'
                            
     *Maximum Value*        '256'

     The maximum number of thread instruments.  For information about
     how to set and use this variable, see *note
     performance-schema-status-monitoring::.

   * 
     'performance_schema_max_thread_instances'

     Property               Value
                            
     *Command-Line          '--performance-schema-max-thread-instances=#'
     Format*                

     *Introduced*           5.5.3
                            
     *System Variable*      'performance_schema_max_thread_instances'
                            
     *Scope*                Global
                            
     *Dynamic*              No
                            
     *Type*                 Integer
                            
     *Default Value*        '1000'

     The maximum number of instrumented thread objects.  The value
     controls the size of the *note 'threads': threads-table. table.  If
     this maximum is exceeded such that a thread cannot be instrumented,
     the Performance Schema increments the
     'Performance_schema_thread_instances_lost' status variable.  For
     information about how to set and use this variable, see *note
     performance-schema-status-monitoring::.

     The 'max_connections' and 'max_delayed_threads' system variables
     affect how many threads are run in the server.
     'performance_schema_max_thread_instances' affects how many of these
     running threads can be instrumented.  If you increase
     'max_connections' or 'max_delayed_threads', you should consider
     increasing 'performance_schema_max_thread_instances' so that
     'performance_schema_max_thread_instances' is greater than the sum
     of 'max_connections' and 'max_delayed_threads'.


File: manual.info.tmp,  Node: performance-schema-status-variables,  Next: performance-schema-and-plugins,  Prev: performance-schema-system-variables,  Up: performance-schema

22.13 Performance Schema Status Variables
=========================================

The Performance Schema implements several status variables that provide
information about instrumentation that could not be loaded or created
due to memory constraints:

     mysql> SHOW STATUS LIKE 'perf%';
     +------------------------------------------+-------+
     | Variable_name                            | Value |
     +------------------------------------------+-------+
     | Performance_schema_cond_classes_lost     | 0     |
     | Performance_schema_cond_instances_lost   | 0     |
     | Performance_schema_file_classes_lost     | 0     |
     | Performance_schema_file_handles_lost     | 0     |
     | Performance_schema_file_instances_lost   | 0     |
     | Performance_schema_locker_lost           | 0     |
     | Performance_schema_mutex_classes_lost    | 0     |
     | Performance_schema_mutex_instances_lost  | 0     |
     | Performance_schema_rwlock_classes_lost   | 0     |
     | Performance_schema_rwlock_instances_lost | 0     |
     | Performance_schema_table_handles_lost    | 0     |
     | Performance_schema_table_instances_lost  | 0     |
     | Performance_schema_thread_classes_lost   | 0     |
     | Performance_schema_thread_instances_lost | 0     |
     +------------------------------------------+-------+

For information on using these variables to check Performance Schema
status, see *note performance-schema-status-monitoring::.

Performance Schema status variables have the following meanings:

   * 
     'Performance_schema_cond_classes_lost'

     How many condition instruments could not be loaded.

   * 
     'Performance_schema_cond_instances_lost'

     How many condition instrument instances could not be created.

   * 
     'Performance_schema_file_classes_lost'

     How many file instruments could not be loaded.

   * 
     'Performance_schema_file_handles_lost'

     How many file instrument instances could not be opened.

   * 
     'Performance_schema_file_instances_lost'

     How many file instrument instances could not be created.

   * 
     'Performance_schema_locker_lost'

     How many events are 'lost' or not recorded, due to the following
     conditions:

        * Events are recursive (for example, waiting for A caused a wait
          on B, which caused a wait on C).

        * The depth of the nested events stack is greater than the limit
          imposed by the implementation.

     Events recorded by the Performance Schema are not recursive, so
     this variable should always be 0.

   * 
     'Performance_schema_mutex_classes_lost'

     How many mutex instruments could not be loaded.

   * 
     'Performance_schema_mutex_instances_lost'

     How many mutex instrument instances could not be created.

   * 
     'Performance_schema_rwlock_classes_lost'

     How many rwlock instruments could not be loaded.

   * 
     'Performance_schema_rwlock_instances_lost'

     How many rwlock instrument instances could not be created.

   * 
     'Performance_schema_table_handles_lost'

     How many table instrument instances could not be opened.

   * 
     'Performance_schema_table_instances_lost'

     How many table instrument instances could not be created.

   * 
     'Performance_schema_thread_classes_lost'

     How many thread instruments could not be loaded.

   * 
     'Performance_schema_thread_instances_lost'

     The number of thread instances that could not be instrumented in
     the *note 'threads': threads-table. table.  This can be nonzero if
     the value of 'performance_schema_max_thread_instances' is too
     small.


File: manual.info.tmp,  Node: performance-schema-and-plugins,  Next: performance-schema-examples,  Prev: performance-schema-status-variables,  Up: performance-schema

22.14 Performance Schema and Plugins
====================================

Removing a plugin with *note 'UNINSTALL PLUGIN': uninstall-plugin. does
not affect information already collected for code in that plugin.  Time
spent executing the code while the plugin was loaded was still spent
even if the plugin is unloaded later.  The associated event information,
including aggregate information, remains readable in
'performance_schema' database tables.  For additional information about
the effect of plugin installation and removal, see *note
performance-schema-status-monitoring::.

A plugin implementor who instruments plugin code should document its
instrumentation characteristics to enable those who load the plugin to
account for its requirements.  For example, a third-party storage engine
should include in its documentation how much memory the engine needs for
mutex and other instruments.


File: manual.info.tmp,  Node: performance-schema-examples,  Next: performance-schema-restrictions,  Prev: performance-schema-and-plugins,  Up: performance-schema

22.15 Using the Performance Schema to Diagnose Problems
=======================================================

The Performance Schema is a tool to help a DBA do performance tuning by
taking real measurements instead of 'wild guesses.' This section
demonstrates some ways to use the Performance Schema for this purpose.
The discussion here relies on the use of event filtering, which is
described in *note performance-schema-filtering::.

The following example provides one methodology that you can use to
analyze a repeatable problem, such as investigating a performance
bottleneck.  To begin, you should have a repeatable use case where
performance is deemed 'too slow' and needs optimization, and you should
enable all instrumentation (no pre-filtering at all).

  1. Run the use case.

  2. Using the Performance Schema tables, analyze the root cause of the
     performance problem.  This analysis will rely heavily on
     post-filtering.

  3. For problem areas that are ruled out, disable the corresponding
     instruments.  For example, if analysis shows that the issue is not
     related to file I/O in a particular storage engine, disable the
     file I/O instruments for that engine.  Then truncate the history
     and summary tables to remove previously collected events.

  4. Repeat the process at step 1.

     At each iteration, the Performance Schema output, particularly the
     *note 'events_waits_history_long': events-waits-history-long-table.
     table, will contain less and less 'noise' caused by nonsignificant
     instruments, and given that this table has a fixed size, will
     contain more and more data relevant to the analysis of the problem
     at hand.

     At each iteration, investigation should lead closer and closer to
     the root cause of the problem, as the 'signal/noise' ratio will
     improve, making analysis easier.

  5. Once a root cause of performance bottleneck is identified, take the
     appropriate corrective action, such as:

        * Tune the server parameters (cache sizes, memory, and so
          forth).

        * Tune a query by writing it differently,

        * Tune the database schema (tables, indexes, and so forth).

        * Tune the code (this applies to storage engine or server
          developers only).

  6. Start again at step 1, to see the effects of the changes on
     performance.

The 'mutex_instances.LOCKED_BY_THREAD_ID' and
'rwlock_instances.WRITE_LOCKED_BY_THREAD_ID' columns are extremely
important for investigating performance bottlenecks or deadlocks.  This
is made possible by Performance Schema instrumentation as follows:

  1. Suppose that thread 1 is stuck waiting for a mutex.

  2. You can determine what the thread is waiting for:

          SELECT * FROM performance_schema.events_waits_current
          WHERE THREAD_ID = THREAD_1;

     Say the query result identifies that the thread is waiting for
     mutex A, found in 'events_waits_current.OBJECT_INSTANCE_BEGIN'.

  3. You can determine which thread is holding mutex A:

          SELECT * FROM performance_schema.mutex_instances
          WHERE OBJECT_INSTANCE_BEGIN = MUTEX_A;

     Say the query result identifies that it is thread 2 holding mutex
     A, as found in 'mutex_instances.LOCKED_BY_THREAD_ID'.

  4. You can see what thread 2 is doing:

          SELECT * FROM performance_schema.events_waits_current
          WHERE THREAD_ID = THREAD_2;


File: manual.info.tmp,  Node: performance-schema-restrictions,  Prev: performance-schema-examples,  Up: performance-schema

22.16 Restrictions on Performance Schema
========================================

The Performance Schema avoids using mutexes to collect or produce data,
so there are no guarantees of consistency and results can sometimes be
incorrect.  Event values in 'performance_schema' tables are
nondeterministic and nonrepeatable.

If you save event information in another table, you should not assume
that the original events will still be available later.  For example, if
you select events from a 'performance_schema' table into a temporary
table, intending to join that table with the original table later, there
might be no matches.

*note 'mysqldump': mysqldump. and 'BACKUP DATABASE' ignore tables in the
'performance_schema' database.

Tables in the 'performance_schema' database cannot be locked with 'LOCK
TABLES', except the 'setup_XXX' tables.

Tables in the 'performance_schema' database cannot be indexed.

Results for queries that refer to tables in the 'performance_schema'
database are not saved in the query cache.

Tables in the 'performance_schema' database are not replicated.

The Performance Schema is not available in 'libmysqld', the embedded
server.

The types of timers might vary per platform.  The *note
'performance_timers': performance-timers-table. table shows which event
timers are available.  If the values in this table for a given timer
name are 'NULL', that timer is not supported on your platform.

Instruments that apply to storage engines might not be implemented for
all storage engines.  Instrumentation of each third-party engine is the
responsibility of the engine maintainer.


File: manual.info.tmp,  Node: connectors-apis,  Next: extending-mysql,  Prev: performance-schema,  Up: Top

23 Connectors and APIs
**********************

* Menu:

* connector-cpp-info::           MySQL Connector/C++
* connector-j-info::             MySQL Connector/J
* connector-net-info::           MySQL Connector/NET
* connector-odbc-info::          MySQL Connector/ODBC
* connector-python-info::        MySQL Connector/Python
* libmysqld::                    libmysqld, the Embedded MySQL Server Library
* c-api::                        MySQL C API
* apis-php-info::                MySQL PHP API
* apis-perl::                    MySQL Perl API
* apis-python::                  MySQL Python API
* apis-ruby::                    MySQL Ruby APIs
* apis-tcl::                     MySQL Tcl API
* apis-eiffel::                  MySQL Eiffel Wrapper

MySQL Connectors provide connectivity to the MySQL server for client
programs.  APIs provide low-level access to the MySQL protocol and MySQL
resources.  Both Connectors and the APIs enable you to connect and
execute MySQL statements from another language or environment, including
ODBC, Java (JDBC), Perl, Python, PHP, Ruby, and native C and embedded
MySQL instances.

*MySQL Connectors*

Oracle develops a number of connectors:

   * Connector/C++ (https://dev.mysql.com/doc/connector-cpp/8.0/en/)
     enables C++ applications to connect to MySQL.

   * Connector/J (https://dev.mysql.com/doc/connector-j/5.1/en/)
     provides driver support for connecting to MySQL from Java
     applications using the standard Java Database Connectivity (JDBC)
     API.

   * Connector/NET (https://dev.mysql.com/doc/connector-net/en/) enables
     developers to create .NET applications that connect to MySQL.
     Connector/NET implements a fully functional ADO.NET interface and
     provides support for use with ADO.NET aware tools.  Applications
     that use Connector/NET can be written in any supported .NET
     language.

     MySQL for Visual Studio
     (https://dev.mysql.com/doc/visual-studio/en/) works with
     Connector/NET and Microsoft Visual Studio 2012, 2013, 2015, and
     2017.  MySQL for Visual Studio provides access to MySQL objects and
     data from Visual Studio.  As a Visual Studio package, it integrates
     directly into Server Explorer providing the ability to create new
     connections and work with MySQL database objects.

   * Connector/ODBC (https://dev.mysql.com/doc/connector-odbc/en/)
     provides driver support for connecting to MySQL using the Open
     Database Connectivity (ODBC) API. Support is available for ODBC
     connectivity from Windows, Unix, and macOS platforms.

   * Connector/Python (https://dev.mysql.com/doc/connector-python/en/)
     provides driver support for connecting to MySQL from Python
     applications using an API that is compliant with the Python DB API
     version 2.0 (http://www.python.org/dev/peps/pep-0249/).  No
     additional Python modules or MySQL client libraries are required.

*The MySQL C API*

For direct access to using MySQL natively within a C application, there
are two methods:

   * The *note C API: c-api. provides low-level access to the MySQL
     client/server protocol through the 'libmysqlclient' client library.
     This is the primary method used to connect to an instance of the
     MySQL server, and is used both by MySQL command-line clients and
     many of the MySQL Connectors and third-party APIs detailed here.

     'libmysqlclient' is included in MySQL distributions.

   * 'libmysqld' is an embedded MySQL server library that enables you to
     embed an instance of the MySQL server into your C applications.

     'libmysqld' is included in MySQL distributions.

See also *note c-api-implementations::.

To access MySQL from a C application, or to build an interface to MySQL
for a language not supported by the Connectors or APIs in this chapter,
the *note C API: c-api. is where to start.  A number of programmer's
utilities are available to help with the process; see *note
programs-development::.

*Third-Party MySQL APIs*

The remaining APIs described in this chapter provide an interface to
MySQL from specific application languages.  These third-party solutions
are not developed or supported by Oracle.  Basic information on their
usage and abilities is provided here for reference purposes only.

All the third-party language APIs are developed using one of two
methods, using 'libmysqlclient' or by implementing a _native driver_.
The two solutions offer different benefits:

   * Using _'libmysqlclient'_ offers complete compatibility with MySQL
     because it uses the same libraries as the MySQL client
     applications.  However, the feature set is limited to the
     implementation and interfaces exposed through 'libmysqlclient' and
     the performance may be lower as data is copied between the native
     language, and the MySQL API components.

   * _Native drivers_ are an implementation of the MySQL network
     protocol entirely within the host language or environment.  Native
     drivers are fast, as there is less copying of data between
     components, and they can offer advanced functionality not available
     through the standard MySQL API. Native drivers are also easier for
     end users to build and deploy because no copy of the MySQL client
     libraries is needed to build the native driver components.

*note connectors-apis-summary:: lists many of the libraries and
interfaces available for MySQL.

*MySQL APIs and Interfaces*

EnvironmentAPI                    Type        Notes
                                              
Ada     GNU Ada MySQL Bindings    'libmysqlclient'See MySQL Bindings for GNU
                                              Ada
                                              (http://gnade.sourceforge.net/)
                                              
C       C API                     'libmysqlclient'See *note c-api::.
                                              
C++     Connector/C++             'libmysqlclient'See MySQL Connector/C++ 8.0
                                              Developer Guide
                                              (https://dev.mysql.com/doc/connector-cpp/8.0/en/).
                                              
        MySQL++                   'libmysqlclient'See MySQL++ website
                                              (http://tangentsoft.net/mysql++/doc/).
                                              
        MySQL wrapped             'libmysqlclient'See MySQL wrapped
                                              (http://www.alhem.net/project/mysql/).
                                              
Cocoa   MySQL-Cocoa               'libmysqlclient'Compatible with the
                                              Objective-C Cocoa
                                              environment.  See
                                              <http://mysql-cocoa.sourceforge.net/>
                                              
D       MySQL for D               'libmysqlclient'See MySQL for D
                                              (http://www.steinmole.de/d/).
                                              
Eiffel  Eiffel MySQL              'libmysqlclient'See *note apis-eiffel::.
                                              
Erlang  'erlang-mysql-driver'     'libmysqlclient'See 'erlang-mysql-driver'.
                                              (http://code.google.com/p/erlang-mysql-driver/)
                                              
Haskell Haskell MySQL Bindings    Native      See Brian O'Sullivan's pure
                                  Driver      Haskell MySQL bindings
                                              (http://www.serpentine.com/blog/software/mysql/).
                                              
        'hsql-mysql'              'libmysqlclient'See MySQL driver for
                                              Haskell
                                              (http://hackage.haskell.org/cgi-bin/hackage-scripts/package/hsql-mysql-1.7).
                                              
Java/JDBCConnector/J              Native      See MySQL Connector/J 5.1
                                  Driver      Developer Guide
                                              (https://dev.mysql.com/doc/connector-j/5.1/en/).
                                              
Kaya    MyDB                      'libmysqlclient'See MyDB
                                              (http://kayalang.org/library/latest/MyDB).
                                              
Lua     LuaSQL                    'libmysqlclient'See LuaSQL
                                              (http://keplerproject.github.io/luasql/doc/us/).
                                              
.NET/MonoConnector/NET            Native      See MySQL Connector/NET
                                  Driver      Developer Guide
                                              (https://dev.mysql.com/doc/connector-net/en/).
                                              
ObjectiveOBjective Caml MySQL     'libmysqlclient'See MySQL Bindings for
Caml    Bindings                              Objective Caml
                                              (http://raevnos.pennmush.org/code/ocaml-mysql/).
                                              
Octave  Database bindings for     'libmysqlclient'See Database bindings for
        GNU Octave                            GNU Octave
                                              (http://octave.sourceforge.net/database/index.html).
                                              
ODBC    Connector/ODBC            'libmysqlclient'See MySQL Connector/ODBC
                                              Developer Guide
                                              (https://dev.mysql.com/doc/connector-odbc/en/).
                                              
Perl    'DBI'/'DBD::mysql'        'libmysqlclient'See *note apis-perl::.
                                              
        'Net::MySQL'              Native      See 'Net::MySQL'
                                  Driver      (http://search.cpan.org/dist/Net-MySQL/MySQL.pm)
                                              at CPAN
                                              
PHP     'mysql', 'ext/mysql'      'libmysqlclient'See Original MySQL API
        interface (deprecated)                (https://dev.mysql.com/doc/apis-php/en/apis-php-mysql.html).
                                              
        'mysqli', 'ext/mysqli'    'libmysqlclient'See MySQL Improved
        interface                             Extension
                                              (https://dev.mysql.com/doc/apis-php/en/apis-php-mysqli.html).
                                              
        'PDO_MYSQL'               'libmysqlclient'See MySQL Functions
                                              (PDO_MYSQL)
                                              (https://dev.mysql.com/doc/apis-php/en/apis-php-pdo-mysql.html).
                                              
        PDO mysqlnd               Native      
                                  Driver
                                  
Python  Connector/Python          Native      See MySQL Connector/Python
                                  Driver      Developer Guide
                                              (https://dev.mysql.com/doc/connector-python/en/).
                                              
Python  Connector/Python C        'libmysqlclient'See MySQL Connector/Python
        Extension                             Developer Guide
                                              (https://dev.mysql.com/doc/connector-python/en/).
                                              
        MySQLdb                   'libmysqlclient'See *note apis-python::.
                                              
Ruby    MySQL/Ruby                'libmysqlclient'Uses 'libmysqlclient'.  See
                                              *note apis-ruby-mysqlruby::.
                                              
        Ruby/MySQL                Native      See
                                  Driver      *note apis-ruby-rubymysql::.
                                              
Scheme  'Myscsh'                  'libmysqlclient'See 'Myscsh'
                                              (https://github.com/aehrisch/myscsh).
                                              
SPL     'sql_mysql'               'libmysqlclient'See 'sql_mysql' for SPL
                                              (http://www.clifford.at/spl/spldoc/sql_mysql.html).
                                              
Tcl     MySQLtcl                  'libmysqlclient'See *note apis-tcl::.
                                  


File: manual.info.tmp,  Node: connector-cpp-info,  Next: connector-j-info,  Prev: connectors-apis,  Up: connectors-apis

23.1 MySQL Connector/C++
========================

The MySQL Connector/C++ manual is published in standalone form, not as
part of the MySQL Reference Manual.  For information, see these
documents:

   * Main manual: MySQL Connector/C++ 8.0 Developer Guide
     (https://dev.mysql.com/doc/connector-cpp/8.0/en/)

   * Release notes: MySQL Connector/C++ Release Notes
     (https://dev.mysql.com/doc/relnotes/connector-cpp/en/)


File: manual.info.tmp,  Node: connector-j-info,  Next: connector-net-info,  Prev: connector-cpp-info,  Up: connectors-apis

23.2 MySQL Connector/J
======================

The MySQL Connector/J manual is published in standalone form, not as
part of the MySQL Reference Manual.  For information, see these
documents:

   * Main manual: MySQL Connector/J Developer Guide
     (https://dev.mysql.com/doc/connector-j/en/)

   * Release notes: MySQL Connector/J Release Notes
     (https://dev.mysql.com/doc/relnotes/connector-j/en/)


File: manual.info.tmp,  Node: connector-net-info,  Next: connector-odbc-info,  Prev: connector-j-info,  Up: connectors-apis

23.3 MySQL Connector/NET
========================

The MySQL Connector/NET manual is published in standalone form, not as
part of the MySQL Reference Manual.  For information, see these
documents:

   * Main manual: MySQL Connector/NET Developer Guide
     (https://dev.mysql.com/doc/connector-net/en/)

   * Release notes: MySQL Connector/NET Release Notes
     (https://dev.mysql.com/doc/relnotes/connector-net/en/)


File: manual.info.tmp,  Node: connector-odbc-info,  Next: connector-python-info,  Prev: connector-net-info,  Up: connectors-apis

23.4 MySQL Connector/ODBC
=========================

The MySQL Connector/ODBC manual is published in standalone form, not as
part of the MySQL Reference Manual.  For information, see these
documents:

   * Main manual: MySQL Connector/ODBC Developer Guide
     (https://dev.mysql.com/doc/connector-odbc/en/)

   * Release notes: MySQL Connector/ODBC Release Notes
     (https://dev.mysql.com/doc/relnotes/connector-odbc/en/)


File: manual.info.tmp,  Node: connector-python-info,  Next: libmysqld,  Prev: connector-odbc-info,  Up: connectors-apis

23.5 MySQL Connector/Python
===========================

The MySQL Connector/Python manual is published in standalone form, not
as part of the MySQL Reference Manual.  For information, see these
documents:

   * Main manual: MySQL Connector/Python Developer Guide
     (https://dev.mysql.com/doc/connector-python/en/)

   * Release notes: MySQL Connector/Python Release Notes
     (https://dev.mysql.com/doc/relnotes/connector-python/en/)


File: manual.info.tmp,  Node: libmysqld,  Next: c-api,  Prev: connector-python-info,  Up: connectors-apis

23.6 libmysqld, the Embedded MySQL Server Library
=================================================

* Menu:

* libmysqld-compiling::          Compiling Programs with libmysqld
* libmysqld-restrictions::       Restrictions When Using the Embedded MySQL Server
* libmysqld-options::            Options with the Embedded Server
* libmysqld-example::            Embedded Server Examples

The embedded MySQL server library makes it possible to run a
full-featured MySQL server inside a client application.  The main
benefits are increased speed and more simple management for embedded
applications.

The embedded server library is based on the client/server version of
MySQL, which is written in C/C++.  Consequently, the embedded server
also is written in C/C++.  There is no embedded server available in
other languages.

The API is identical for the embedded MySQL version and the
client/server version.  To change an old threaded application to use the
embedded library, you normally only have to add calls to the following
functions.

*MySQL Embedded Server Library Functions*

Function               When to Call
                       
                       
*note 'mysql_library_init()': mysql-library-init.Call it before any other MySQL function is
                       called, preferably early in the 'main()'
                       function.
                       
                       
*note 'mysql_library_end()': mysql-library-end.Call it before your program exits.
                       
                       
*note 'mysql_thread_init()': mysql-thread-init.Call it in each thread you create that accesses
                       MySQL.
                       
*note 'mysql_thread_end()': mysql-thread-end.Call it before calling 'pthread_exit()'.

Then you must link your code with 'libmysqld.a' instead of
'libmysqlclient.a'.  To ensure binary compatibility between your
application and the server library, be sure to compile your application
against headers for the same series of MySQL that was used to compile
the server library.  For example, if 'libmysqld' was compiled against
MySQL 5.1 headers, do not compile your application against MySQL 5.5
headers, or vice versa.

The 'mysql_library_XXX()' functions are also included in
'libmysqlclient.a' to enable you to change between the embedded and the
client/server version by just linking your application with the right
library.  See *note mysql-library-init::.

One difference between the embedded server and the standalone server is
that for the embedded server, authentication for connections is disabled
by default.


File: manual.info.tmp,  Node: libmysqld-compiling,  Next: libmysqld-restrictions,  Prev: libmysqld,  Up: libmysqld

23.6.1 Compiling Programs with libmysqld
----------------------------------------

In precompiled binary MySQL distributions that include 'libmysqld', the
embedded server library, MySQL builds the library using the appropriate
vendor compiler if there is one.

To get a 'libmysqld' library if you build MySQL from source yourself,
you should configure MySQL with the '-DWITH_EMBEDDED_SERVER=1' option.
See *note source-configuration-options::.

When you link your program with 'libmysqld', you must also include the
system-specific 'pthread' libraries and some libraries that the MySQL
server uses.  You can get the full list of libraries by executing *note
'mysql_config --libmysqld-libs': mysql-config.

The correct flags for compiling and linking a threaded program must be
used, even if you do not directly call any thread functions in your
code.

To compile a C program to include the necessary files to embed the MySQL
server library into an executable version of a program, the compiler
will need to know where to find various files and need instructions on
how to compile the program.  The following example shows how a program
could be compiled from the command line, assuming that you are using
'gcc', use the GNU C compiler:

     gcc mysql_test.c -o mysql_test \
     `/usr/local/mysql/bin/mysql_config --include --libmysqld-libs`

Immediately following the 'gcc' command is the name of the C program
source file.  After it, the '-o' option is given to indicate that the
file name that follows is the name that the compiler is to give to the
output file, the compiled program.  The next line of code tells the
compiler to obtain the location of the include files and libraries and
other settings for the system on which it is compiled.  The *note
'mysql_config': mysql-config. command is contained in backticks, not
single quotation marks.

On some non-'gcc' platforms, the embedded library depends on C++ runtime
libraries and linking against the embedded library might result in
missing-symbol errors.  To solve this, link using a C++ compiler or
explicitly list the required libraries on the link command line.


File: manual.info.tmp,  Node: libmysqld-restrictions,  Next: libmysqld-options,  Prev: libmysqld-compiling,  Up: libmysqld

23.6.2 Restrictions When Using the Embedded MySQL Server
--------------------------------------------------------

The embedded server has the following limitations:

   * No user-defined functions (UDFs).

   * No stack trace on core dump.

   * You cannot set this up as a master or a slave (no replication).

   * Very large result sets may be unusable on low memory systems.

   * You cannot connect to an embedded server from an outside process
     with sockets or TCP/IP. However, you can connect to an intermediate
     application, which in turn can connect to an embedded server on the
     behalf of a remote client or outside process.

   * 'libmysqld' does not support encrypted connections.  An implication
     is that if an application linked against 'libmysqld' establishes a
     connection to a remote server, the connection cannot be encrypted.

   * 'InnoDB' is not reentrant in the embedded server and cannot be used
     for multiple connections, either successively or simultaneously.

   * The Event Scheduler is not available.  Because of this, the
     'event_scheduler' system variable is disabled.

   * The Performance Schema is not available.

Some of these limitations can be changed by editing the 'mysql_embed.h'
include file and recompiling MySQL.


File: manual.info.tmp,  Node: libmysqld-options,  Next: libmysqld-example,  Prev: libmysqld-restrictions,  Up: libmysqld

23.6.3 Options with the Embedded Server
---------------------------------------

Any options that may be given with the *note 'mysqld': mysqld. server
daemon, may be used with an embedded server library.  Server options may
be given in an array as an argument to the *note 'mysql_library_init()':
mysql-library-init, which initializes the server.  They also may be
given in an option file like 'my.cnf'.  To specify an option file for a
C program, use the '--defaults-file' option as one of the elements of
the second argument of the *note 'mysql_library_init()':
mysql-library-init. function.  See *note mysql-library-init::, for more
information on the *note 'mysql_library_init()': mysql-library-init.
function.

Using option files can make it easier to switch between a client/server
application and one where MySQL is embedded.  Put common options under
the '[server]' group.  These are read by both MySQL versions.
Client/server-specific options should go under the '[mysqld]' section.
Put options specific to the embedded MySQL server library in the
'[embedded]' section.  Options specific to applications go under section
labeled '[ApplicationName_SERVER]'.  See *note option-files::.


File: manual.info.tmp,  Node: libmysqld-example,  Prev: libmysqld-options,  Up: libmysqld

23.6.4 Embedded Server Examples
-------------------------------

These two example programs should work without any changes on a Linux or
FreeBSD system.  For other operating systems, minor changes are needed,
mostly with file paths.  These examples are designed to give enough
details for you to understand the problem, without the clutter that is a
necessary part of a real application.  The first example is very
straightforward.  The second example is a little more advanced with some
error checking.  The first is followed by a command-line entry for
compiling the program.  The second is followed by a GNUmake file that
may be used for compiling instead.

*Example 1*

'test1_libmysqld.c'

     #include <stdio.h>
     #include <stdlib.h>
     #include <stdarg.h>
     #include "mysql.h"

     MYSQL *mysql;
     MYSQL_RES *results;
     MYSQL_ROW record;

     static char *server_options[] = \
            { "mysql_test", "--defaults-file=my.cnf", NULL };
     int num_elements = (sizeof(server_options) / sizeof(char *)) - 1;

     static char *server_groups[] = { "libmysqld_server",
                                      "libmysqld_client", NULL };

     int main(void)
     {
        mysql_library_init(num_elements, server_options, server_groups);
        mysql = mysql_init(NULL);
        mysql_options(mysql, MYSQL_READ_DEFAULT_GROUP, "libmysqld_client");
        mysql_options(mysql, MYSQL_OPT_USE_EMBEDDED_CONNECTION, NULL);

        mysql_real_connect(mysql, NULL,NULL,NULL, "database1", 0,NULL,0);

        mysql_query(mysql, "SELECT column1, column2 FROM table1");

        results = mysql_store_result(mysql);

        while((record = mysql_fetch_row(results))) {
           printf("%s - %s \n", record[0], record[1]);
        }

        mysql_free_result(results);
        mysql_close(mysql);
        mysql_library_end();

        return 0;
     }

Here is the command line for compiling the above program:

     gcc test1_libmysqld.c -o test1_libmysqld \
      `/usr/local/mysql/bin/mysql_config --include --libmysqld-libs`

*Example 2*

To try the example, create an 'test2_libmysqld' directory at the same
level as the MySQL source directory.  Save the 'test2_libmysqld.c'
source and the 'GNUmakefile' in the directory, and run GNU 'make' from
inside the 'test2_libmysqld' directory.

'test2_libmysqld.c'

     /*
      * A simple example client, using the embedded MySQL server library
     */

     #include <mysql.h>
     #include <stdarg.h>
     #include <stdio.h>
     #include <stdlib.h>

     MYSQL *db_connect(const char *dbname);
     void db_disconnect(MYSQL *db);
     void db_do_query(MYSQL *db, const char *query);

     const char *server_groups[] = {
       "test2_libmysqld_SERVER", "embedded", "server", NULL
     };

     int
     main(int argc, char **argv)
     {
       MYSQL *one, *two;

       /* mysql_library_init() must be called before any other mysql
        * functions.
        *
        * You can use mysql_library_init(0, NULL, NULL), and it
        * initializes the server using groups = {
        *   "server", "embedded", NULL
        *  }.
        *
        * In your $HOME/.my.cnf file, you probably want to put:

     [test2_libmysqld_SERVER]
     language = /path/to/source/of/mysql/sql/share/english

        * You could, of course, modify argc and argv before passing
        * them to this function.  Or you could create new ones in any
        * way you like.  But all of the arguments in argv (except for
        * argv[0], which is the program name) should be valid options
        * for the MySQL server.
        *
        * If you link this client against the normal mysqlclient
        * library, this function is just a stub that does nothing.
        */
       mysql_library_init(argc, argv, (char **)server_groups);

       one = db_connect("test");
       two = db_connect(NULL);

       db_do_query(one, "SHOW TABLE STATUS");
       db_do_query(two, "SHOW DATABASES");

       mysql_close(two);
       mysql_close(one);

       /* This must be called after all other mysql functions */
       mysql_library_end();

       exit(EXIT_SUCCESS);
     }

     static void
     die(MYSQL *db, char *fmt, ...)
     {
       va_list ap;
       va_start(ap, fmt);
       vfprintf(stderr, fmt, ap);
       va_end(ap);
       (void)putc('\n', stderr);
       if (db)
         db_disconnect(db);
       exit(EXIT_FAILURE);
     }

     MYSQL *
     db_connect(const char *dbname)
     {
       MYSQL *db = mysql_init(NULL);
       if (!db)
         die(db, "mysql_init failed: no memory");
       /*
        * Notice that the client and server use separate group names.
        * This is critical, because the server does not accept the
        * client's options, and vice versa.
        */
       mysql_options(db, MYSQL_READ_DEFAULT_GROUP, "test2_libmysqld_CLIENT");
       if (!mysql_real_connect(db, NULL, NULL, NULL, dbname, 0, NULL, 0))
         die(db, "mysql_real_connect failed: %s", mysql_error(db));

       return db;
     }

     void
     db_disconnect(MYSQL *db)
     {
       mysql_close(db);
     }

     void
     db_do_query(MYSQL *db, const char *query)
     {
       if (mysql_query(db, query) != 0)
         goto err;

       if (mysql_field_count(db) > 0)
       {
         MYSQL_RES   *res;
         MYSQL_ROW    row, end_row;
         int num_fields;

         if (!(res = mysql_store_result(db)))
           goto err;
         num_fields = mysql_num_fields(res);
         while ((row = mysql_fetch_row(res)))
         {
           (void)fputs(">> ", stdout);
           for (end_row = row + num_fields; row < end_row; ++row)
             (void)printf("%s\t", row ? (char*)*row : "NULL");
           (void)fputc('\n', stdout);
         }
         (void)fputc('\n', stdout);
         mysql_free_result(res);
       }
       else
         (void)printf("Affected rows: %lld\n", mysql_affected_rows(db));

       return;

     err:
       die(db, "db_do_query failed: %s [%s]", mysql_error(db), query);
     }

'GNUmakefile'

     # This assumes the MySQL software is installed in /usr/local/mysql
     inc      := /usr/local/mysql/include/mysql
     lib      := /usr/local/mysql/lib

     # If you have not installed the MySQL software yet, try this instead
     #inc      := $(HOME)/mysql-5.5/include
     #lib      := $(HOME)/mysql-5.5/libmysqld

     CC       := gcc
     CPPFLAGS := -I$(inc) -D_THREAD_SAFE -D_REENTRANT
     CFLAGS   := -g -W -Wall
     LDFLAGS  := -static
     # You can change -lmysqld to -lmysqlclient to use the
     # client/server library
     LDLIBS    = -L$(lib) -lmysqld -lm -ldl -lcrypt

     ifneq (,$(shell grep FreeBSD /COPYRIGHT 2>/dev/null))
     # FreeBSD
     LDFLAGS += -pthread
     else
     # Assume Linux
     LDLIBS += -lpthread
     endif

     # This works for simple one-file test programs
     sources := $(wildcard *.c)
     objects := $(patsubst %c,%o,$(sources))
     targets := $(basename $(sources))

     all: $(targets)

     clean:
             rm -f $(targets) $(objects) *.core


File: manual.info.tmp,  Node: c-api,  Next: apis-php-info,  Prev: libmysqld,  Up: connectors-apis

23.7 MySQL C API
================

* Menu:

* c-api-implementations::        MySQL C API Implementations
* c-api-example-programs::       Example C API Client Programs
* c-api-building-running-clients::  Building and Running C API Client Programs
* c-api-data-structures::        C API Data Structures
* c-api-function-overview::      C API Function Overview
* c-api-functions::              C API Function Descriptions
* c-api-prepared-statements::    C API Prepared Statements
* c-api-prepared-statement-data-structures::  C API Prepared Statement Data Structures
* c-api-prepared-statement-function-overview::  C API Prepared Statement Function Overview
* c-api-prepared-statement-functions::  C API Prepared Statement Function Descriptions
* c-api-thread-functions::       C API Threaded Function Descriptions
* c-api-embedded-server-functions::  C API Embedded Server Function Descriptions
* c-api-plugin-functions::       C API Client Plugin Functions
* c-api-encrypted-connections::  C API Encrypted Connection Support
* c-api-multiple-queries::       C API Multiple Statement Execution Support
* c-api-prepared-statement-date-handling::  C API Prepared Statement Handling of Date and Time Values
* c-api-prepared-call-statements::  C API Prepared CALL Statement Support
* c-api-prepared-statement-problems::  C API Prepared Statement Problems
* c-api-auto-reconnect::         C API Automatic Reconnection Control
* c-api-common-issues::          C API Common Issues

The C API provides low-level access to the MySQL client/server protocol
and enables C programs to access database contents.  The C API code is
distributed with MySQL and implemented in the 'libmysqlclient' library.
See *note c-api-implementations::.

Most other client APIs use the 'libmysqlclient' library to communicate
with the MySQL server.  (Exceptions are Connector/J and Connector/NET.)
This means that, for example, you can take advantage of many of the same
environment variables that are used by other client programs because
they are referenced from the library.  For a list of these variables,
see *note programs-overview::.

For instructions on building client programs using the C API, see *note
c-api-building-clients::.  For programming with threads, see *note
c-api-threaded-clients::.  To create a standalone application which
includes the "server" and "client" in the same program (and does not
communicate with an external MySQL server), see *note libmysqld::.

*Note*:

If, after an upgrade, you experience problems with compiled client
programs, such as 'Commands out of sync' or unexpected core dumps, the
programs were probably compiled using old header or library files.  In
this case, check the date of the 'mysql.h' file and 'libmysqlclient.a'
library used for compilation to verify that they are from the new MySQL
distribution.  If not, recompile the programs with the new headers and
libraries.  Recompilation might also be necessary for programs compiled
against the shared client library if the library major version number
has changed (for example, from 'libmysqlclient.so.17' to
'libmysqlclient.so.18').  For additional compatibility information, see
*note c-api-running-clients::.

Clients have a maximum communication buffer size.  The size of the
buffer that is allocated initially (16KB) is automatically increased up
to the maximum size (16MB by default).  Because buffer sizes are
increased only as demand warrants, simply increasing the maximum limit
does not in itself cause more resources to be used.  This size check is
mostly a precaution against erroneous statements and communication
packets.

The communication buffer must be large enough to contain a single SQL
statement (for client-to-server traffic) and one row of returned data
(for server-to-client traffic).  Each session's communication buffer is
dynamically enlarged to handle any query or row up to the maximum limit.
For example, if you have *note 'BLOB': blob. values that contain up to
16MB of data, you must have a communication buffer limit of at least
16MB (in both server and client).  The default maximum built into the
client library is 1GB, but the default maximum in the server is 1MB. You
can increase this by changing the value of the 'max_allowed_packet'
parameter at server startup.  See *note server-configuration::.

The MySQL server shrinks each communication buffer to
'net_buffer_length' bytes after each query.  For clients, the size of
the buffer associated with a connection is not decreased until the
connection is closed, at which time client memory is reclaimed.


File: manual.info.tmp,  Node: c-api-implementations,  Next: c-api-example-programs,  Prev: c-api,  Up: c-api

23.7.1 MySQL C API Implementations
----------------------------------

The MySQL C API is a C-based API that client applications written in C
can use to communicate with MySQL Server.  Client programs refer to C
API header files at compile time and link to a C API library file at
link time.  The library comes in two versions, depending on how the
application is intended to communicate with the server:

   * 'libmysqlclient': The client version of the library, used for
     applications that communicate over a network connection as a client
     of a standalone server process.

   * 'libmysqld': The embedded server version of the library, used for
     applications intended to include an embedded MySQL server within
     the application itself.  The application communicates with its own
     private server instance.

Both libraries have the same interface.  In terms of C API calls, an
application communicates with a standalone server the same way it
communicates with an embedded server.  A given client can be built to
communicate with a standalone or embedded server, depending on whether
it is linked against 'libmysqlclient' or 'libmysqld' at build time.

To obtain the C API header and library files required to build C API
client programs, install a MySQL Server distribution.  Server
distributions include both 'libmysqlclient' and 'libmysqld'.

You can install a binary distribution that contains the C API files
pre-built, or you can use a source distribution and build the C API
files yourself.

The names of the library files to use when linking C API client
applications depend on the library type and platform for which a
distribution is built:

   * On Unix (and Unix-like) systems, the static library is
     'libmysqlclient.a'.  The dynamic library is 'libmysqlclient.so' on
     most Unix systems and 'libmysqlclient.dylib' on macOS.

     For distributions that include embedded server libraries, the
     corresponding library names begin with 'libmysqld' rather than
     'libmysqlclient'.

   * On Windows, the static library is 'mysqlclient.lib' and the dynamic
     library is 'libmysql.dll'.  Windows distributions also include
     'libmysql.lib', a static import library needed for using the
     dynamic library.

     For distributions that include embedded server libraries, the
     corresponding library names are 'mysqlserver.lib', 'libmysqld.dll',
     and 'libmysqld.lib'.

     Windows distributions also include a set of debug libraries.  These
     have the same names as the nondebug libraries, but are located in
     the 'lib/debug' library.  You must use the debug libraries when
     compiling clients built using the debug C runtime.

On Unix, you may also see libraries that include '_r' in the names.
Before MySQL 5.5, these were built as thread-safe (re-entrant) libraries
separately from the non-'_r' libraries.  As of 5.5, both libraries are
the same and the '_r' names are symbolic links to the corresponding
non-'_r' names.  There is no need to use the '_r' libraries.  For
example, if you use *note 'mysql_config': mysql-config. to obtain linker
flags, you can use *note 'mysql_config --libs': mysql-config. in all
cases, even for threaded clients.  There is no need to use *note
'mysql_config --libs_r': mysql-config.


File: manual.info.tmp,  Node: c-api-example-programs,  Next: c-api-building-running-clients,  Prev: c-api-implementations,  Up: c-api

23.7.2 Example C API Client Programs
------------------------------------

Many of the clients in MySQL source distributions are written in C, such
as *note 'mysql': mysql, *note 'mysqladmin': mysqladmin, and *note
'mysqlshow': mysqlshow.  If you are looking for examples that
demonstrate how to use the C API, take a look at those clients: Obtain a
source distribution and look in its 'client' directory.  See *note
getting-mysql::.

For information about individual C API functions, the sections for most
functions include usage examples.


File: manual.info.tmp,  Node: c-api-building-running-clients,  Next: c-api-data-structures,  Prev: c-api-example-programs,  Up: c-api

23.7.3 Building and Running C API Client Programs
-------------------------------------------------

* Menu:

* c-api-building-clients::       Building C API Client Programs
* c-api-threaded-clients::       Writing C API Threaded Client Programs
* c-api-running-clients::        Running C API Client Programs
* c-api-server-client-versions::  C API Server Version and Client Library Version

The following sections provide information on building client programs
that use the C API. Topics include compiling and linking clients,
writing threaded clients, and troubleshooting runtime problems.


File: manual.info.tmp,  Node: c-api-building-clients,  Next: c-api-threaded-clients,  Prev: c-api-building-running-clients,  Up: c-api-building-running-clients

23.7.3.1 Building C API Client Programs
.......................................

This section provides guidelines for compiling C programs that use the
MySQL C API.

   * *note c-api-building-clients-compiling-mysql-clients-on-unix::

   * *note
     c-api-building-clients-compiling-mysql-clients-on-microsoft-windows::

   * *note
     c-api-building-clients-troubleshooting-problems-linking-to-the-mysql-client-library::

*Compiling MySQL Clients on Unix*

The examples here use 'gcc' as the compiler.  A different compiler might
be appropriate on some systems (for example, 'clang' on macOS or
FreeBSD, or Sun Studio on Solaris).  Adjust the examples as necessary.

You may need to specify an '-I' option when you compile client programs
that use MySQL header files, so that the compiler can find them.  For
example, if the header files are installed in
'/usr/local/mysql/include', use this option in the compile command:

     -I/usr/local/mysql/include

You can link your code with either the dynamic or static MySQL C client
library.  The static library is named 'libmysqlclient.a'.  The dynamic
library base name is 'libmysqlclient' and the suffix differs by platform
(for example, '.so' for Linux, '.dylib' for macOS).

MySQL clients must be linked using the '-lmysqlclient' option in the
link command.  You may also need to specify a '-L' option to tell the
linker where to find the library.  For example, if the library is
installed in '/usr/local/mysql/lib', use these options in the link
command:

     -L/usr/local/mysql/lib -lmysqlclient

The path names may differ on your system.  Adjust the '-I' and '-L'
options as necessary.

To make it simpler to compile MySQL programs on Unix, use the *note
'mysql_config': mysql-config. script.  See *note mysql-config::.

*note 'mysql_config': mysql-config. displays the options needed for
compiling or linking:

     mysql_config --cflags
     mysql_config --libs

You can invoke those commands at the command line to get the proper
options and add them manually to compilation or link commands.
Alternatively, include the output from *note 'mysql_config':
mysql-config. directly within command lines using backticks:

     gcc -c `mysql_config --cflags` progname.c
     gcc -o progname progname.o `mysql_config --libs`

On Unix, linking uses dynamic libraries by default.  To link to the
static client library instead, add its path name to the link command.
For example, if the library is located in '/usr/local/mysql/lib', link
like this:

     gcc -o progname progname.o /usr/local/mysql/lib/libmysqlclient.a

Or use *note 'mysql_config': mysql-config. to provide the library name:

     gcc -o progname progname.o `mysql_config --variable=pkglibdir`/libmysqlclient.a

*note 'mysql_config': mysql-config. does not currently provide a way to
list all libraries needed for static linking, so it might be necessary
to name additional libraries on the link command (for example, '-lnsl
-lsocket' on Solaris).  To get an idea which libraries to add, use *note
'mysql_config --libs': mysql-config. and 'ldd libmysqlclient.so' (or
'otool -L libmysqlclient.dylib' on macOS).

*Compiling MySQL Clients on Microsoft Windows*

To specify header and library file locations, use the facilities
provided by your development environment.

To build C API clients on Windows, you must link in the C client
library, as well as the Windows ws2_32 sockets library and Secur32
security library.

You can link your code with either the dynamic or static MySQL C client
library.  On Windows, the static library is named 'mysqlclient.lib' and
the dynamic library is named 'libmysql.dll'.  In addition, the
'libmysql.lib' static import library is needed for using the dynamic
library.  To link with the static C client library, the client
application must be compiled with the same version of Visual Studio used
to compile the C client library (which is Visual Studio 2008 for the
static C client library built by Oracle).

When using the Oracle-built MySQL C client library, follow these rules
when it comes to linking the C runtime for your client application:

   * For the MySQL C client library from a Community distribution of
     MySQL:

        * _For MySQL 5.5.55 and higher_: Always link dynamically to the
          C runtime (use the '/MD' compiler option), whether you are
          linking to the static or dynamic C client library.  Also,
          target hosts running the client application must have the
          Visual C++ Redistributable for Visual Studio 2008 installed.
          The redistributable packages are available at the Microsoft
          Download Center
          (http://www.microsoft.com/en-us/download/default.aspx).

        * _For MySQL 5.5.54 and lower_:

             * If linking to the static C client library, link
               statically to the C runtime (use the '/MT' compiler
               option).

             * If linking to the dynamic C client library, link either
               statically or dynamically to the C runtime (use either
               '/MT' or '/MD' compiler option).

   * For the MySQL C client library from a Commercial distribution of
     MySQL:

        * If linking to the static C client library, link statically to
          the C runtime (use the' /MT' compiler option).

        * If linking to the dynamic C client library, link either
          statically or dynamically to the C runtime (use either '/MT'
          or '/MD' compiler option).

In general, when linking to a static MySQL C client library, the client
library and the client application must use the same compiler options
when it comes to linking the C runtime--that is, if your C client
library is compiled with the '/MT' option, your client application
should also be compiled with the '/MT' option, and so on (see the MSDN
page describing the C library linking options
(http://msdn.microsoft.com/en-us/library/2kzt1wy3.aspx) for more
details).  Follow this rule when you build your own static MySQL C
client library from a source distribution of MySQL and link your client
application to it.

*Note*:

_Debug Mode:_ Because of the just-mentioned linking rule, you cannot
build your application in debug mode (with the '/MTd' or '/MDd' compiler
option) and link it to a static C client library built by Oracle, which
is _not_ built with the debug options.  Instead, you must build the
static client library from source with the debug options.

*Troubleshooting Problems Linking to the MySQL Client Library*

If the linker cannot find the MySQL client library, you might get
undefined-reference errors for symbols that start with 'mysql_', such as
those shown here:

     /tmp/ccFKsdPa.o: In function `main':
     /tmp/ccFKsdPa.o(.text+0xb): undefined reference to `mysql_init'
     /tmp/ccFKsdPa.o(.text+0x31): undefined reference to `mysql_real_connect'
     /tmp/ccFKsdPa.o(.text+0x69): undefined reference to `mysql_error'
     /tmp/ccFKsdPa.o(.text+0x9a): undefined reference to `mysql_close'

You should be able to solve this problem by adding '-LDIR_PATH
-lmysqlclient' at the end of your link command, where DIR_PATH
represents the path name of the directory where the client library is
located.  To determine the correct directory, try this command:

     mysql_config --libs

The output from *note 'mysql_config': mysql-config. might indicate other
libraries that should be specified on the link command as well.  You can
include *note 'mysql_config': mysql-config. output directly in your
compile or link command using backticks.  For example:

     gcc -o progname progname.o `mysql_config --libs`

If an error occurs at link time that the 'floor' symbol is undefined,
link to the math library by adding '-lm' to the end of the compile/link
line.  Similarly, if you get undefined-reference errors for other
functions that should exist on your system, such as 'connect()', check
the manual page for the function in question to determine which
libraries you should add to the link command.

If you get undefined-reference errors such as the following for
functions that do not exist on your system, it usually means that your
MySQL client library was compiled on a system that is not 100%
compatible with yours:

     mf_format.o(.text+0x201): undefined reference to `__lxstat'

In this case, you should download a source distribution for the latest
version of MySQL and compile the MySQL client library yourself.  See
*note source-installation::.


File: manual.info.tmp,  Node: c-api-threaded-clients,  Next: c-api-running-clients,  Prev: c-api-building-clients,  Up: c-api-building-running-clients

23.7.3.2 Writing C API Threaded Client Programs
...............................................

This section provides guidance for writing client programs that use the
thread-related functions in the MySQL C API. For further information
about these functions, see *note c-api-thread-functions::.  For examples
of source code that uses them, look in the 'client' directory of a MySQL
source distribution:

   * The source for *note 'mysqlimport': mysqlimport. uses threading in
     the code associated with the '--use-threads' option.

   * The source for *note 'mysqlslap': mysqlslap. uses threads to set up
     simultaneous workloads, to test server operation under high load.

If undefined-reference errors occur when linking a threaded program
against the MySQL client library, the most likely cause is that you did
not include the thread libraries on the link/compile command.

The client library is almost thread-safe.  The biggest problem is that
the subroutines in 'sql/net_serv.cc' that read from sockets are not
interrupt-safe.  This was done with the thought that you might want to
have your own alarm that can break a long read to a server.  If you
install interrupt handlers for the 'SIGPIPE' interrupt, socket handling
should be thread-safe.

To avoid aborting the program when a connection terminates, MySQL blocks
'SIGPIPE' on the first call to *note 'mysql_library_init()':
mysql-library-init, *note 'mysql_init()': mysql-init, or *note
'mysql_connect()': mysql-connect.  To use your own 'SIGPIPE' handler,
first call *note 'mysql_library_init()': mysql-library-init, then
install your handler.

The client library is thread-safe per connection.  Two threads can share
the same connection with the following caveats:

   * Multiple threads cannot send a query to the MySQL server at the
     same time on the same connection.  In particular, you must ensure
     that between calls to *note 'mysql_query()': mysql-query. and *note
     'mysql_store_result()': mysql-store-result. in one thread, no other
     thread uses the same connection.  To do this, use a mutex lock
     around your pair of *note 'mysql_query()': mysql-query. and *note
     'mysql_store_result()': mysql-store-result. calls.  After *note
     'mysql_store_result()': mysql-store-result. returns, the lock can
     be released and other threads may query the same connection.

     If you use POSIX threads, you can use 'pthread_mutex_lock()' and
     'pthread_mutex_unlock()' to establish and release a mutex lock.

   * Multiple threads can access different result sets that are
     retrieved with *note 'mysql_store_result()': mysql-store-result.

   * To use *note 'mysql_use_result()': mysql-use-result, you must
     ensure that no other thread uses the same connection until the
     result set is closed.  However, it really is best for threaded
     clients that share the same connection to use *note
     'mysql_store_result()': mysql-store-result.

If a thread does not create the connection to the MySQL database but
calls MySQL functions, take the following into account:

When you call *note 'mysql_init()': mysql-init, MySQL creates a
thread-specific variable for the thread that is used by the debug
library (among other things).  If you call a MySQL function before the
thread has called *note 'mysql_init()': mysql-init, the thread does not
have the necessary thread-specific variables in place and you are likely
to end up with a core dump sooner or later.  To avoid problems, you must
do the following:

  1. Call *note 'mysql_library_init()': mysql-library-init. before any
     other MySQL functions.  It is not thread-safe, so call it before
     threads are created, or protect the call with a mutex.

  2. Arrange for *note 'mysql_thread_init()': mysql-thread-init. to be
     called early in the thread handler before calling any MySQL
     function.  (If you call *note 'mysql_init()': mysql-init, it calls
     *note 'mysql_thread_init()': mysql-thread-init. for you.)

  3. In the thread, call *note 'mysql_thread_end()': mysql-thread-end.
     before calling 'pthread_exit()'.  This frees the memory used by
     MySQL thread-specific variables.

The preceding notes regarding *note 'mysql_init()': mysql-init. also
apply to *note 'mysql_connect()': mysql-connect, which calls *note
'mysql_init()': mysql-init.


File: manual.info.tmp,  Node: c-api-running-clients,  Next: c-api-server-client-versions,  Prev: c-api-threaded-clients,  Up: c-api-building-running-clients

23.7.3.3 Running C API Client Programs
......................................

If, after an upgrade, you experience problems with compiled client
programs, such as 'Commands out of sync' or unexpected core dumps, the
programs were probably compiled using old header or library files.  In
this case, check the date of the 'mysql.h' header file and
'libmysqlclient.a' library used for compilation to verify that they are
from the new MySQL distribution.  If not, recompile the programs with
the new headers and libraries.  Recompilation might also be necessary
for programs compiled against the shared client library if the library
major version number has changed (for example, from
'libmysqlclient.so.17' to 'libmysqlclient.so.18').

The major shared client library version determines compatibility.  (For
example, for 'libmysqlclient.so.18.1.0', the major version is 18.)
Libraries shipped with newer versions of MySQL are drop-in replacements
for older versions that have the same major number.  As long as the
major library version is the same, you can upgrade the library and old
applications should continue to work with it.

Undefined-reference errors might occur at runtime when you try to
execute a MySQL program.  If these errors specify symbols that start
with 'mysql_' or indicate that the 'libmysqlclient' library cannot be
found, it means that your system cannot find the shared
'libmysqlclient.so' library.  The solution to this problem is to tell
your system to search for shared libraries in the directory where that
library is located.  Use whichever of the following methods is
appropriate for your system:

   * Add the path of the directory where 'libmysqlclient.so' is located
     to the 'LD_LIBRARY_PATH' or 'LD_LIBRARY' environment variable.

   * On macOS, add the path of the directory where
     'libmysqlclient.dylib' is located to the 'DYLD_LIBRARY_PATH'
     environment variable.

   * Copy the shared-library files (such as 'libmysqlclient.so') to some
     directory that is searched by your system, such as '/lib', and
     update the shared library information by executing 'ldconfig'.  Be
     sure to copy all related files.  A shared library might exist under
     several names, using symlinks to provide the alternate names.

If the application is linked to the embedded server library, runtime
error messages indicate the 'libmysqld' rather than 'libmysqlclient'
library, but the solution to the problem is the same as just described.


File: manual.info.tmp,  Node: c-api-server-client-versions,  Prev: c-api-running-clients,  Up: c-api-building-running-clients

23.7.3.4 C API Server Version and Client Library Version
........................................................

The string and numeric forms of the MySQL server version are available
at compile time as the values of the 'MYSQL_SERVER_VERSION' and
'MYSQL_VERSION_ID' macros, and at runtime as the values of the *note
'mysql_get_server_info()': mysql-get-server-info. and *note
'mysql_get_server_version()': mysql-get-server-version. functions.

The client library version is the MySQL version.  The string and numeric
forms of this version are available at compile time as the values of the
'MYSQL_SERVER_VERSION' and 'MYSQL_VERSION_ID' macros, and at runtime as
the values of the *note 'mysql_get_client_info()':
mysql-get-client-info. and *note 'mysql_get_client_version()':
mysql-get-client-version. functions.


File: manual.info.tmp,  Node: c-api-data-structures,  Next: c-api-function-overview,  Prev: c-api-building-running-clients,  Up: c-api

23.7.4 C API Data Structures
----------------------------

This section describes C API data structures other than those used for
prepared statements.  For information about the latter, see *note
c-api-prepared-statement-data-structures::.

   * 
     'MYSQL'

     This structure represents handler for one database connection.  It
     is used for almost all MySQL functions.  Do not try to make a copy
     of a 'MYSQL' structure.  There is no guarantee that such a copy
     will be usable.

   * 
     'MYSQL_RES'

     This structure represents the result of a query that returns rows
     (*note 'SELECT': select, *note 'SHOW': show, *note 'DESCRIBE':
     describe, *note 'EXPLAIN': explain.).  The information returned
     from a query is called the _result set_ in the remainder of this
     section.

   * 
     'MYSQL_ROW'

     This is a type-safe representation of one row of data.  It is
     currently implemented as an array of counted byte strings.  (You
     cannot treat these as null-terminated strings if field values may
     contain binary data, because such values may contain null bytes
     internally.)  Rows are obtained by calling *note
     'mysql_fetch_row()': mysql-fetch-row.

   * 
     'MYSQL_FIELD'

     This structure contains metadata: information about a field, such
     as the field's name, type, and size.  Its members are described in
     more detail later in this section.  You may obtain the
     'MYSQL_FIELD' structures for each field by calling *note
     'mysql_fetch_field()': mysql-fetch-field. repeatedly.  Field values
     are not part of this structure; they are contained in a 'MYSQL_ROW'
     structure.

   * 
     'MYSQL_FIELD_OFFSET'

     This is a type-safe representation of an offset into a MySQL field
     list.  (Used by *note 'mysql_field_seek()': mysql-field-seek.)
     Offsets are field numbers within a row, beginning at zero.

   * 
     'my_ulonglong'

     The type used for the number of rows and for *note
     'mysql_affected_rows()': mysql-affected-rows, *note
     'mysql_num_rows()': mysql-num-rows, and *note 'mysql_insert_id()':
     mysql-insert-id.  This type provides a range of '0' to '1.84e19'.

     Some functions that return a row count using this type return -1 as
     an unsigned value to indicate an error or exceptional condition.
     You can check for -1 by comparing the return value to
     '(my_ulonglong)-1' (or to '(my_ulonglong)~0', which is equivalent).

     On some systems, attempting to print a value of type 'my_ulonglong'
     does not work.  To print such a value, convert it to 'unsigned
     long' and use a '%lu' print format.  Example:

          printf ("Number of rows: %lu\n",
                  (unsigned long) mysql_num_rows(result));

   * 
     'my_bool'

     A boolean type, for values that are true (nonzero) or false (zero).

The 'MYSQL_FIELD' structure contains the members described in the
following list.  The definitions apply primarily for columns of result
sets such as those produced by *note 'SELECT': select. statements.
'MYSQL_FIELD' structures are also used to provide metadata for 'OUT' and
'INOUT' parameters returned from stored procedures executed using
prepared *note 'CALL': call. statements.  For such parameters, some of
the structure members have a meaning different from the meaning for
column values.

   * 'char * name'

     The name of the field, as a null-terminated string.  If the field
     was given an alias with an 'AS' clause, the value of 'name' is the
     alias.  For a procedure parameter, the parameter name.

   * 'char * org_name'

     The name of the field, as a null-terminated string.  Aliases are
     ignored.  For expressions, the value is an empty string.  For a
     procedure parameter, the parameter name.

   * 'char * table'

     The name of the table containing this field, if it is not a
     calculated field.  For calculated fields, the 'table' value is an
     empty string.  If the column is selected from a view, 'table' names
     the view.  If the table or view was given an alias with an 'AS'
     clause, the value of 'table' is the alias.  For a *note 'UNION':
     union, the value is the empty string.  For a procedure parameter,
     the procedure name.

   * 'char * org_table'

     The name of the table, as a null-terminated string.  Aliases are
     ignored.  If the column is selected from a view, 'org_table' names
     the view.  For a *note 'UNION': union, the value is the empty
     string.  For a procedure parameter, the procedure name.

   * 'char * db'

     The name of the database that the field comes from, as a
     null-terminated string.  If the field is a calculated field, 'db'
     is an empty string.  For a *note 'UNION': union, the value is the
     empty string.  For a procedure parameter, the name of the database
     containing the procedure.

   * 'char * catalog'

     The catalog name.  This value is always '"def"'.

   * 'char * def'

     The default value of this field, as a null-terminated string.  This
     is set only if you use *note 'mysql_list_fields()':
     mysql-list-fields.

   * 'unsigned long length'

     The width of the field.  This corresponds to the display length, in
     bytes.

     The server determines the 'length' value before it generates the
     result set, so this is the minimum length required for a data type
     capable of holding the largest possible value from the result
     column, without knowing in advance the actual values that will be
     produced by the query for the result set.

   * 'unsigned long max_length'

     The maximum width of the field for the result set (the length in
     bytes of the longest field value for the rows actually in the
     result set).  If you use *note 'mysql_store_result()':
     mysql-store-result. or *note 'mysql_list_fields()':
     mysql-list-fields, this contains the maximum length for the field.
     If you use *note 'mysql_use_result()': mysql-use-result, the value
     of this variable is zero.

     The value of 'max_length' is the length of the string
     representation of the values in the result set.  For example, if
     you retrieve a *note 'FLOAT': floating-point-types. column and the
     'widest' value is '-12.345', 'max_length' is 7 (the length of
     ''-12.345'').

     If you are using prepared statements, 'max_length' is not set by
     default because for the binary protocol the lengths of the values
     depend on the types of the values in the result set.  (See *note
     c-api-prepared-statement-data-structures::.)  If you want the
     'max_length' values anyway, enable the
     'STMT_ATTR_UPDATE_MAX_LENGTH' option with *note
     'mysql_stmt_attr_set()': mysql-stmt-attr-set. and the lengths will
     be set when you call *note 'mysql_stmt_store_result()':
     mysql-stmt-store-result.  (See *note mysql-stmt-attr-set::, and
     *note mysql-stmt-store-result::.)

   * 'unsigned int name_length'

     The length of 'name'.

   * 'unsigned int org_name_length'

     The length of 'org_name'.

   * 'unsigned int table_length'

     The length of 'table'.

   * 'unsigned int org_table_length'

     The length of 'org_table'.

   * 'unsigned int db_length'

     The length of 'db'.

   * 'unsigned int catalog_length'

     The length of 'catalog'.

   * 'unsigned int def_length'

     The length of 'def'.

   * 'unsigned int flags'

     Bit-flags that describe the field.  The 'flags' value may have zero
     or more of the bits set that are shown in the following table.

     Flag Value                    Flag Description
                                   
     'NOT_NULL_FLAG'               Field cannot be 'NULL'
                                   
     'PRI_KEY_FLAG'                Field is part of a primary key
                                   
     'UNIQUE_KEY_FLAG'             Field is part of a unique key
                                   
     'MULTIPLE_KEY_FLAG'           Field is part of a nonunique key
                                   
     'UNSIGNED_FLAG'               Field has the 'UNSIGNED' attribute
                                   
     'ZEROFILL_FLAG'               Field has the 'ZEROFILL' attribute
                                   
     'BINARY_FLAG'                 Field has the 'BINARY' attribute
                                   
     'AUTO_INCREMENT_FLAG'         Field has the 'AUTO_INCREMENT' attribute
                                   
     'ENUM_FLAG'                   Field is an *note 'ENUM': enum.
                                   
     'SET_FLAG'                    Field is a *note 'SET': set.
                                   
     'BLOB_FLAG'                   Field is a *note 'BLOB': blob. or
                                   *note 'TEXT': blob. (deprecated)
                                   
     'TIMESTAMP_FLAG'              Field is a *note 'TIMESTAMP': datetime.
                                   (deprecated)
                                   
     'NUM_FLAG'                    Field is numeric; see additional notes
                                   following table
                                   
     'NO_DEFAULT_VALUE_FLAG'       Field has no default value; see
                                   additional notes following table

     Some of these flags indicate data type information and are
     superseded by or used in conjunction with the 'MYSQL_TYPE_XXX'
     value in the 'field->type' member described later:

        * To check for *note 'BLOB': blob. or *note 'TIMESTAMP':
          datetime. values, check whether 'type' is 'MYSQL_TYPE_BLOB' or
          'MYSQL_TYPE_TIMESTAMP'.  (The 'BLOB_FLAG' and 'TIMESTAMP_FLAG'
          flags are unneeded.)

        * *note 'ENUM': enum. and *note 'SET': set. values are returned
          as strings.  For these, check that the 'type' value is
          'MYSQL_TYPE_STRING' and that the 'ENUM_FLAG' or 'SET_FLAG'
          flag is set in the 'flags' value.

     'NUM_FLAG' indicates that a column is numeric.  This includes
     columns with a type of 'MYSQL_TYPE_DECIMAL',
     'MYSQL_TYPE_NEWDECIMAL', 'MYSQL_TYPE_TINY', 'MYSQL_TYPE_SHORT',
     'MYSQL_TYPE_LONG', 'MYSQL_TYPE_FLOAT', 'MYSQL_TYPE_DOUBLE',
     'MYSQL_TYPE_NULL', 'MYSQL_TYPE_LONGLONG', 'MYSQL_TYPE_INT24', and
     'MYSQL_TYPE_YEAR'.

     'NO_DEFAULT_VALUE_FLAG' indicates that a column has no 'DEFAULT'
     clause in its definition.  This does not apply to 'NULL' columns
     (because such columns have a default of 'NULL'), or to
     'AUTO_INCREMENT' columns (which have an implied default value).

     The following example illustrates a typical use of the 'flags'
     value:

          if (field->flags & NOT_NULL_FLAG)
              printf("Field cannot be null\n");

     You may use the convenience macros shown in the following table to
     determine the boolean status of the 'flags' value.

     Flag Status                   Description
                                   
     'IS_NOT_NULL(flags)'          True if this field is defined as 'NOT
                                   NULL'
                                   
     'IS_PRI_KEY(flags)'           True if this field is a primary key
                                   
     'IS_BLOB(flags)'              True if this field is a
                                   *note 'BLOB': blob. or
                                   *note 'TEXT': blob. (deprecated; test
                                   'field->type' instead)

   * 'unsigned int decimals'

     The number of decimals for numeric fields.

   * 'unsigned int charsetnr'

     An ID number that indicates the character set/collation pair for
     the field.

     Normally, character values in result sets are converted to the
     character set indicated by the 'character_set_results' system
     variable.  In this case, 'charsetnr' corresponds to the character
     set indicated by that variable.  Character set conversion can be
     suppressed by setting 'character_set_results' to 'NULL'.  In this
     case, 'charsetnr' corresponds to the character set of the original
     table column or expression.  See also *note charset-connection::.

     To distinguish between binary and nonbinary data for string data
     types, check whether the 'charsetnr' value is 63.  If so, the
     character set is 'binary', which indicates binary rather than
     nonbinary data.  This enables you to distinguish *note 'BINARY':
     binary-varbinary. from *note 'CHAR': char, *note 'VARBINARY':
     binary-varbinary. from *note 'VARCHAR': char, and the *note 'BLOB':
     blob. types from the *note 'TEXT': blob. types.

     'charsetnr' values are the same as those displayed in the 'Id'
     column of the *note 'SHOW COLLATION': show-collation. statement or
     the 'ID' column of the 'INFORMATION_SCHEMA' *note 'COLLATIONS':
     collations-table. table.  You can use those information sources to
     see which character set and collation specific 'charsetnr' values
     indicate:

          mysql> SHOW COLLATION WHERE Id = 63;
          +-----------+---------+----+---------+----------+---------+
          | Collation | Charset | Id | Default | Compiled | Sortlen |
          +-----------+---------+----+---------+----------+---------+
          | binary    | binary  | 63 | Yes     | Yes      |       1 |
          +-----------+---------+----+---------+----------+---------+

          mysql> SELECT COLLATION_NAME, CHARACTER_SET_NAME
                 FROM INFORMATION_SCHEMA.COLLATIONS WHERE ID = 33;
          +-----------------+--------------------+
          | COLLATION_NAME  | CHARACTER_SET_NAME |
          +-----------------+--------------------+
          | utf8_general_ci | utf8               |
          +-----------------+--------------------+

   * 'enum enum_field_types type'

     The type of the field.  The 'type' value may be one of the
     'MYSQL_TYPE_' symbols shown in the following table.

     Type Value                Type Description
                               
     'MYSQL_TYPE_TINY'         *note 'TINYINT': integer-types. field
                               
     'MYSQL_TYPE_SHORT'        *note 'SMALLINT': integer-types. field
                               
     'MYSQL_TYPE_LONG'         *note 'INTEGER': integer-types. field
                               
     'MYSQL_TYPE_INT24'        *note 'MEDIUMINT': integer-types. field
                               
     'MYSQL_TYPE_LONGLONG'     *note 'BIGINT': integer-types. field
                               
     'MYSQL_TYPE_DECIMAL'      *note 'DECIMAL': fixed-point-types. or
                               *note 'NUMERIC': fixed-point-types. field
                               
     'MYSQL_TYPE_NEWDECIMAL'   Precision math
                               *note 'DECIMAL': fixed-point-types. or
                               *note 'NUMERIC': fixed-point-types.
                               
     'MYSQL_TYPE_FLOAT'        *note 'FLOAT': floating-point-types. field
                               
     'MYSQL_TYPE_DOUBLE'       *note 'DOUBLE': floating-point-types. or
                               *note 'REAL': floating-point-types. field
                               
     'MYSQL_TYPE_BIT'          *note 'BIT': bit-type. field
                               
     'MYSQL_TYPE_TIMESTAMP'    *note 'TIMESTAMP': datetime. field
                               
     'MYSQL_TYPE_DATE'         *note 'DATE': datetime. field
                               
     'MYSQL_TYPE_TIME'         *note 'TIME': time. field
                               
     'MYSQL_TYPE_DATETIME'     *note 'DATETIME': datetime. field
                               
     'MYSQL_TYPE_YEAR'         *note 'YEAR': year. field
                               
     'MYSQL_TYPE_STRING'       *note 'CHAR': char. or
                               *note 'BINARY': binary-varbinary. field
                               
     'MYSQL_TYPE_VAR_STRING'   *note 'VARCHAR': char. or
                               *note 'VARBINARY': binary-varbinary. field
                               
     'MYSQL_TYPE_BLOB'         *note 'BLOB': blob. or *note 'TEXT': blob.
                               field (use 'max_length' to determine the
                               maximum length)
                               
     'MYSQL_TYPE_SET'          *note 'SET': set. field
                               
     'MYSQL_TYPE_ENUM'         *note 'ENUM': enum. field
                               
     'MYSQL_TYPE_GEOMETRY'     Spatial field
                               
     'MYSQL_TYPE_NULL'         'NULL'-type field

     You can use the 'IS_NUM()' macro to test whether a field has a
     numeric type.  Pass the 'type' value to 'IS_NUM()' and it evaluates
     to TRUE if the field is numeric:

          if (IS_NUM(field->type))
              printf("Field is numeric\n");

     *note 'ENUM': enum. and *note 'SET': set. values are returned as
     strings.  For these, check that the 'type' value is
     'MYSQL_TYPE_STRING' and that the 'ENUM_FLAG' or 'SET_FLAG' flag is
     set in the 'flags' value.


File: manual.info.tmp,  Node: c-api-function-overview,  Next: c-api-functions,  Prev: c-api-data-structures,  Up: c-api

23.7.5 C API Function Overview
------------------------------

The following list summarizes the functions available in the C API. For
greater detail, see the descriptions in *note c-api-functions::.

   * *note 'my_init()': my-init.: Initializes global variables and the
     thread handler in thread-safe programs.

   * *note 'mysql_affected_rows()': mysql-affected-rows.: Returns the
     number of rows changed/deleted/inserted by the last *note 'UPDATE':
     update, *note 'DELETE': delete, or *note 'INSERT': insert. query.

   * *note 'mysql_autocommit()': mysql-autocommit.: Toggles autocommit
     mode on/off.

   * *note 'mysql_change_user()': mysql-change-user.: Changes the user
     and database on an open connection.

   * *note 'mysql_character_set_name()': mysql-character-set-name.:
     Returns the default character set name for the current connection.

   * *note 'mysql_client_find_plugin()': mysql-client-find-plugin.:
     Returns a pointer to a plugin.

   * *note 'mysql_client_register_plugin()':
     mysql-client-register-plugin.: Registers a plugin.

   * *note 'mysql_close()': mysql-close.: Closes a server connection.

   * *note 'mysql_commit()': mysql-commit.: Commits the transaction.

   * *note 'mysql_connect()': mysql-connect.: Connects to a MySQL
     server.  This function is deprecated; use *note
     'mysql_real_connect()': mysql-real-connect. instead.

   * *note 'mysql_create_db()': mysql-create-db.: Creates a database.
     This function is deprecated; use the SQL statement *note 'CREATE
     DATABASE': create-database. instead.

   * *note 'mysql_data_seek()': mysql-data-seek.: Seeks to an arbitrary
     row number in a query result set.

   * *note 'mysql_debug()': mysql-debug.: Does a 'DBUG_PUSH' with the
     given string.

   * *note 'mysql_drop_db()': mysql-drop-db.: Drops a database.  This
     function is deprecated; use the SQL statement *note 'DROP
     DATABASE': drop-database. instead.

   * *note 'mysql_dump_debug_info()': mysql-dump-debug-info.: Causes the
     server to write debug information to the log.

   * *note 'mysql_eof()': mysql-eof.: Determines whether the last row of
     a result set has been read.  This function is deprecated; use *note
     'mysql_errno()': mysql-errno. or *note 'mysql_error()':
     mysql-error. instead.

   * *note 'mysql_errno()': mysql-errno.: Returns the error number for
     the most recently invoked MySQL function.

   * *note 'mysql_error()': mysql-error.: Returns the error message for
     the most recently invoked MySQL function.

   * *note 'mysql_escape_string()': mysql-escape-string.: Escapes
     special characters in a string for use in an SQL statement.

   * *note 'mysql_fetch_field()': mysql-fetch-field.: Returns the type
     of the next table field.

   * *note 'mysql_fetch_field_direct()': mysql-fetch-field-direct.:
     Returns the type of a table field, given a field number.

   * *note 'mysql_fetch_fields()': mysql-fetch-fields.: Returns an array
     of all field structures.

   * *note 'mysql_fetch_lengths()': mysql-fetch-lengths.: Returns the
     lengths of all columns in the current row.

   * *note 'mysql_fetch_row()': mysql-fetch-row.: Fetches the next row
     from the result set.

   * *note 'mysql_field_count()': mysql-field-count.: Returns the number
     of result columns for the most recent statement.

   * *note 'mysql_field_seek()': mysql-field-seek.: Puts the column
     cursor on a specified column.

   * *note 'mysql_field_tell()': mysql-field-tell.: Returns the position
     of the field cursor used for the last *note 'mysql_fetch_field()':
     mysql-fetch-field.

   * *note 'mysql_free_result()': mysql-free-result.: Frees memory used
     by a result set.

   * *note 'mysql_get_character_set_info()':
     mysql-get-character-set-info.: Returns information about default
     character set.

   * *note 'mysql_get_client_info()': mysql-get-client-info.: Returns
     client version information as a string.

   * *note 'mysql_get_client_version()': mysql-get-client-version.:
     Returns client version information as an integer.

   * *note 'mysql_get_host_info()': mysql-get-host-info.: Returns a
     string describing the connection.

   * *note 'mysql_get_proto_info()': mysql-get-proto-info.: Returns the
     protocol version used by the connection.

   * *note 'mysql_get_server_info()': mysql-get-server-info.: Returns
     the server version number.

   * *note 'mysql_get_server_version()': mysql-get-server-version.:
     Returns the server version number as an integer.

   * *note 'mysql_get_ssl_cipher()': mysql-get-ssl-cipher.: Returns the
     current SSL cipher.

   * *note 'mysql_hex_string()': mysql-hex-string.: Encodes a string in
     hexadecimal format.

   * *note 'mysql_info()': mysql-info.: Returns information about the
     most recently executed query.

   * *note 'mysql_init()': mysql-init.: Gets or initializes a 'MYSQL'
     structure.

   * *note 'mysql_insert_id()': mysql-insert-id.: Returns the ID
     generated for an 'AUTO_INCREMENT' column by the previous query.

   * *note 'mysql_kill()': mysql-kill.: Kills a given thread.

   * *note 'mysql_library_end()': mysql-library-end.: Finalizes the
     MySQL C API library.

   * *note 'mysql_library_init()': mysql-library-init.: Initializes the
     MySQL C API library.

   * *note 'mysql_list_dbs()': mysql-list-dbs.: Returns database names
     matching a simple regular expression.

   * *note 'mysql_list_fields()': mysql-list-fields.: Returns field
     names matching a simple regular expression.

   * *note 'mysql_list_processes()': mysql-list-processes.: Returns a
     list of the current server threads.

   * *note 'mysql_list_tables()': mysql-list-tables.: Returns table
     names matching a simple regular expression.

   * *note 'mysql_load_plugin()': mysql-load-plugin.: Loads a plugin.

   * *note 'mysql_load_plugin_v()': mysql-load-plugin-v.: Loads a
     plugin.

   * *note 'mysql_more_results()': mysql-more-results.: Checks whether
     any more results exist.

   * *note 'mysql_next_result()': mysql-next-result.: Returns/initiates
     the next result in multiple-result executions.

   * *note 'mysql_num_fields()': mysql-num-fields.: Returns the number
     of columns in a result set.

   * *note 'mysql_num_rows()': mysql-num-rows.: Returns the number of
     rows in a result set.

   * *note 'mysql_options()': mysql-options.: Sets connect options for
     *note 'mysql_real_connect()': mysql-real-connect.

   * *note 'mysql_ping()': mysql-ping.: Checks whether the connection to
     the server is working, reconnecting as necessary.

   * *note 'mysql_plugin_options()': mysql-plugin-options.: Sets a
     plugin option.

   * *note 'mysql_query()': mysql-query.: Executes an SQL query
     specified as a null-terminated string.

   * *note 'mysql_real_connect()': mysql-real-connect.: Connects to a
     MySQL server.

   * *note 'mysql_real_escape_string()': mysql-real-escape-string.:
     Escapes special characters in a string for use in an SQL statement,
     taking into account the current character set of the connection.

   * *note 'mysql_real_query()': mysql-real-query.: Executes an SQL
     query specified as a counted string.

   * *note 'mysql_refresh()': mysql-refresh.: Flushes or resets tables
     and caches.

   * *note 'mysql_reload()': mysql-reload.: Tells the server to reload
     the grant tables.

   * *note 'mysql_rollback()': mysql-rollback.: Rolls back the
     transaction.

   * *note 'mysql_row_seek()': mysql-row-seek.: Seeks to a row offset in
     a result set, using value returned from *note 'mysql_row_tell()':
     mysql-row-tell.

   * *note 'mysql_row_tell()': mysql-row-tell.: Returns the row cursor
     position.

   * *note 'mysql_select_db()': mysql-select-db.: Selects a database.

   * *note 'mysql_server_end()': mysql-server-end.: Finalizes the MySQL
     C API library.

   * *note 'mysql_server_init()': mysql-server-init.: Initializes the
     MySQL C API library.

   * *note 'mysql_set_character_set()': mysql-set-character-set.: Sets
     the default character set for the current connection.

   * *note 'mysql_set_local_infile_default()':
     mysql-set-local-infile-default.: Sets the *note 'LOAD DATA LOCAL':
     load-data. handler callbacks to their default values.

   * *note 'mysql_set_local_infile_handler()':
     mysql-set-local-infile-handler.: Installs application-specific
     *note 'LOAD DATA LOCAL': load-data. handler callbacks.

   * *note 'mysql_set_server_option()': mysql-set-server-option.: Sets
     an option for the connection (like 'multi-statements').

   * *note 'mysql_sqlstate()': mysql-sqlstate.: Returns the SQLSTATE
     error code for the last error.

   * *note 'mysql_shutdown()': mysql-shutdown.: Shuts down the database
     server.

   * *note 'mysql_ssl_set()': mysql-ssl-set.: Prepares to establish an
     SSL connection to the server.

   * *note 'mysql_stat()': mysql-stat.: Returns the server status as a
     string.

   * *note 'mysql_store_result()': mysql-store-result.: Retrieves a
     complete result set to the client.

   * *note 'mysql_thread_end()': mysql-thread-end.: Finalizes a thread
     handler.

   * *note 'mysql_thread_id()': mysql-thread-id.: Returns the current
     thread ID.

   * *note 'mysql_thread_init()': mysql-thread-init.: Initializes a
     thread handler.

   * *note 'mysql_thread_safe()': mysql-thread-safe.: Returns 1 if the
     clients are compiled as thread-safe.

   * *note 'mysql_use_result()': mysql-use-result.: Initiates a
     row-by-row result set retrieval.

   * *note 'mysql_warning_count()': mysql-warning-count.: Returns the
     warning count for the previous SQL statement.

Application programs should use this general outline for interacting
with MySQL:

  1. Initialize the MySQL client library by calling *note
     'mysql_library_init()': mysql-library-init.  This function exists
     in both the 'libmysqlclient' C client library and the 'libmysqld'
     embedded server library, so it is used whether you build a regular
     client program by linking with the '-libmysqlclient' flag, or an
     embedded server application by linking with the '-libmysqld' flag.

  2. Initialize a connection handler by calling *note 'mysql_init()':
     mysql-init. and connect to the server by calling *note
     'mysql_real_connect()': mysql-real-connect.

  3. Issue SQL statements and process their results.  (The following
     discussion provides more information about how to do this.)

  4. Close the connection to the MySQL server by calling *note
     'mysql_close()': mysql-close.

  5. End use of the MySQL client library by calling *note
     'mysql_library_end()': mysql-library-end.

The purpose of calling *note 'mysql_library_init()': mysql-library-init.
and *note 'mysql_library_end()': mysql-library-end. is to provide proper
initialization and finalization of the MySQL client library.  For
applications that are linked with the client library, they provide
improved memory management.  If you do not call *note
'mysql_library_end()': mysql-library-end, a block of memory remains
allocated.  (This does not increase the amount of memory used by the
application, but some memory leak detectors will complain about it.)
For applications that are linked with the embedded server, these calls
start and stop the server.

In a nonmultithreaded environment, the call to *note
'mysql_library_init()': mysql-library-init. may be omitted, because
*note 'mysql_init()': mysql-init. will invoke it automatically as
necessary.  However, *note 'mysql_library_init()': mysql-library-init.
is not thread-safe in a multithreaded environment, and thus neither is
*note 'mysql_init()': mysql-init, which calls *note
'mysql_library_init()': mysql-library-init.  You must either call *note
'mysql_library_init()': mysql-library-init. prior to spawning any
threads, or else use a mutex to protect the call, whether you invoke
*note 'mysql_library_init()': mysql-library-init. or indirectly through
*note 'mysql_init()': mysql-init.  This should be done prior to any
other client library call.

To connect to the server, call *note 'mysql_init()': mysql-init. to
initialize a connection handler, then call *note 'mysql_real_connect()':
mysql-real-connect. with that handler (along with other information such
as the host name, user name, and password).  Upon connection, *note
'mysql_real_connect()': mysql-real-connect. sets the 'reconnect' flag
(part of the 'MYSQL' structure) to a value of '1' in versions of the API
older than 5.0.3, or '0' in newer versions.  A value of '1' for this
flag indicates that if a statement cannot be performed because of a lost
connection, to try reconnecting to the server before giving up.  You can
use the 'MYSQL_OPT_RECONNECT' option to *note 'mysql_options()':
mysql-options. to control reconnection behavior.  When you are done with
the connection, call *note 'mysql_close()': mysql-close. to terminate
it.  Do not use the handler after it has been closed.

While a connection is active, the client may send SQL statements to the
server using *note 'mysql_query()': mysql-query. or *note
'mysql_real_query()': mysql-real-query.  The difference between the two
is that *note 'mysql_query()': mysql-query. expects the query to be
specified as a null-terminated string whereas *note
'mysql_real_query()': mysql-real-query. expects a counted string.  If
the string contains binary data (which may include null bytes), you must
use *note 'mysql_real_query()': mysql-real-query.

For each non-*note 'SELECT': select. query (for example, *note 'INSERT':
insert, *note 'UPDATE': update, *note 'DELETE': delete.), you can find
out how many rows were changed (affected) by calling *note
'mysql_affected_rows()': mysql-affected-rows.

For *note 'SELECT': select. queries, you retrieve the selected rows as a
result set.  (Note that some statements are *note 'SELECT': select.-like
in that they return rows.  These include *note 'SHOW': show, *note
'DESCRIBE': describe, and *note 'EXPLAIN': explain.  Treat these
statements the same way as *note 'SELECT': select. statements.)

There are two ways for a client to process result sets.  One way is to
retrieve the entire result set all at once by calling *note
'mysql_store_result()': mysql-store-result.  This function acquires from
the server all the rows returned by the query and stores them in the
client.  The second way is for the client to initiate a row-by-row
result set retrieval by calling *note 'mysql_use_result()':
mysql-use-result.  This function initializes the retrieval, but does not
actually get any rows from the server.

In both cases, you access rows by calling *note 'mysql_fetch_row()':
mysql-fetch-row.  With *note 'mysql_store_result()': mysql-store-result,
*note 'mysql_fetch_row()': mysql-fetch-row. accesses rows that have
previously been fetched from the server.  With *note
'mysql_use_result()': mysql-use-result, *note 'mysql_fetch_row()':
mysql-fetch-row. actually retrieves the row from the server.
Information about the size of the data in each row is available by
calling *note 'mysql_fetch_lengths()': mysql-fetch-lengths.

After you are done with a result set, call *note 'mysql_free_result()':
mysql-free-result. to free the memory used for it.

The two retrieval mechanisms are complementary.  Choose the approach
that is most appropriate for each client application.  In practice,
clients tend to use *note 'mysql_store_result()': mysql-store-result.
more commonly.

An advantage of *note 'mysql_store_result()': mysql-store-result. is
that because the rows have all been fetched to the client, you not only
can access rows sequentially, you can move back and forth in the result
set using *note 'mysql_data_seek()': mysql-data-seek. or *note
'mysql_row_seek()': mysql-row-seek. to change the current row position
within the result set.  You can also find out how many rows there are by
calling *note 'mysql_num_rows()': mysql-num-rows.  On the other hand,
the memory requirements for *note 'mysql_store_result()':
mysql-store-result. may be very high for large result sets and you are
more likely to encounter out-of-memory conditions.

An advantage of *note 'mysql_use_result()': mysql-use-result. is that
the client requires less memory for the result set because it maintains
only one row at a time (and because there is less allocation overhead,
*note 'mysql_use_result()': mysql-use-result. can be faster).
Disadvantages are that you must process each row quickly to avoid tying
up the server, you do not have random access to rows within the result
set (you can only access rows sequentially), and the number of rows in
the result set is unknown until you have retrieved them all.
Furthermore, you _must_ retrieve all the rows even if you determine in
mid-retrieval that you've found the information you were looking for.

The API makes it possible for clients to respond appropriately to
statements (retrieving rows only as necessary) without knowing whether
the statement is a *note 'SELECT': select.  You can do this by calling
*note 'mysql_store_result()': mysql-store-result. after each *note
'mysql_query()': mysql-query. (or *note 'mysql_real_query()':
mysql-real-query.).  If the result set call succeeds, the statement was
a *note 'SELECT': select. and you can read the rows.  If the result set
call fails, call *note 'mysql_field_count()': mysql-field-count. to
determine whether a result was actually to be expected.  If *note
'mysql_field_count()': mysql-field-count. returns zero, the statement
returned no data (indicating that it was an *note 'INSERT': insert,
*note 'UPDATE': update, *note 'DELETE': delete, and so forth), and was
not expected to return rows.  If *note 'mysql_field_count()':
mysql-field-count. is nonzero, the statement should have returned rows,
but did not.  This indicates that the statement was a *note 'SELECT':
select. that failed.  See the description for *note
'mysql_field_count()': mysql-field-count. for an example of how this can
be done.

Both *note 'mysql_store_result()': mysql-store-result. and *note
'mysql_use_result()': mysql-use-result. enable you to obtain information
about the fields that make up the result set (the number of fields,
their names and types, and so forth).  You can access field information
sequentially within the row by calling *note 'mysql_fetch_field()':
mysql-fetch-field. repeatedly, or by field number within the row by
calling *note 'mysql_fetch_field_direct()': mysql-fetch-field-direct.
The current field cursor position may be changed by calling *note
'mysql_field_seek()': mysql-field-seek.  Setting the field cursor
affects subsequent calls to *note 'mysql_fetch_field()':
mysql-fetch-field.  You can also get information for fields all at once
by calling *note 'mysql_fetch_fields()': mysql-fetch-fields.

For detecting and reporting errors, MySQL provides access to error
information by means of the *note 'mysql_errno()': mysql-errno. and
*note 'mysql_error()': mysql-error. functions.  These return the error
code or error message for the most recently invoked function that can
succeed or fail, enabling you to determine when an error occurred and
what it was.


File: manual.info.tmp,  Node: c-api-functions,  Next: c-api-prepared-statements,  Prev: c-api-function-overview,  Up: c-api

23.7.6 C API Function Descriptions
----------------------------------

* Menu:

* mysql-affected-rows::          mysql_affected_rows()
* mysql-autocommit::             mysql_autocommit()
* mysql-change-user::            mysql_change_user()
* mysql-character-set-name::     mysql_character_set_name()
* mysql-close::                  mysql_close()
* mysql-commit::                 mysql_commit()
* mysql-connect::                mysql_connect()
* mysql-create-db::              mysql_create_db()
* mysql-data-seek::              mysql_data_seek()
* mysql-debug::                  mysql_debug()
* mysql-drop-db::                mysql_drop_db()
* mysql-dump-debug-info::        mysql_dump_debug_info()
* mysql-eof::                    mysql_eof()
* mysql-errno::                  mysql_errno()
* mysql-error::                  mysql_error()
* mysql-escape-string::          mysql_escape_string()
* mysql-fetch-field::            mysql_fetch_field()
* mysql-fetch-field-direct::     mysql_fetch_field_direct()
* mysql-fetch-fields::           mysql_fetch_fields()
* mysql-fetch-lengths::          mysql_fetch_lengths()
* mysql-fetch-row::              mysql_fetch_row()
* mysql-field-count::            mysql_field_count()
* mysql-field-seek::             mysql_field_seek()
* mysql-field-tell::             mysql_field_tell()
* mysql-free-result::            mysql_free_result()
* mysql-get-character-set-info::  mysql_get_character_set_info()
* mysql-get-client-info::        mysql_get_client_info()
* mysql-get-client-version::     mysql_get_client_version()
* mysql-get-host-info::          mysql_get_host_info()
* mysql-get-proto-info::         mysql_get_proto_info()
* mysql-get-server-info::        mysql_get_server_info()
* mysql-get-server-version::     mysql_get_server_version()
* mysql-get-ssl-cipher::         mysql_get_ssl_cipher()
* mysql-hex-string::             mysql_hex_string()
* mysql-info::                   mysql_info()
* mysql-init::                   mysql_init()
* mysql-insert-id::              mysql_insert_id()
* mysql-kill::                   mysql_kill()
* mysql-library-end::            mysql_library_end()
* mysql-library-init::           mysql_library_init()
* mysql-list-dbs::               mysql_list_dbs()
* mysql-list-fields::            mysql_list_fields()
* mysql-list-processes::         mysql_list_processes()
* mysql-list-tables::            mysql_list_tables()
* mysql-more-results::           mysql_more_results()
* mysql-next-result::            mysql_next_result()
* mysql-num-fields::             mysql_num_fields()
* mysql-num-rows::               mysql_num_rows()
* mysql-options::                mysql_options()
* mysql-ping::                   mysql_ping()
* mysql-query::                  mysql_query()
* mysql-real-connect::           mysql_real_connect()
* mysql-real-escape-string::     mysql_real_escape_string()
* mysql-real-query::             mysql_real_query()
* mysql-refresh::                mysql_refresh()
* mysql-reload::                 mysql_reload()
* mysql-rollback::               mysql_rollback()
* mysql-row-seek::               mysql_row_seek()
* mysql-row-tell::               mysql_row_tell()
* mysql-select-db::              mysql_select_db()
* mysql-set-character-set::      mysql_set_character_set()
* mysql-set-local-infile-default::  mysql_set_local_infile_default()
* mysql-set-local-infile-handler::  mysql_set_local_infile_handler()
* mysql-set-server-option::      mysql_set_server_option()
* mysql-shutdown::               mysql_shutdown()
* mysql-sqlstate::               mysql_sqlstate()
* mysql-ssl-set::                mysql_ssl_set()
* mysql-stat::                   mysql_stat()
* mysql-store-result::           mysql_store_result()
* mysql-thread-id::              mysql_thread_id()
* mysql-use-result::             mysql_use_result()
* mysql-warning-count::          mysql_warning_count()

This section describes C API functions other than those used for
prepared statements or the replication stream interface.  For
information about those, see *note c-api-prepared-statement-functions::,
and C API Binary Log Function Descriptions
(https://dev.mysql.com/doc/refman/8.0/en/c-api-binary-log-functions.html).

In the descriptions here, a parameter or return value of 'NULL' means
'NULL' in the sense of the C programming language, not a MySQL 'NULL'
value.

Functions that return a value generally return a pointer or an integer.
Unless specified otherwise, functions returning a pointer return a
non-'NULL' value to indicate success or a 'NULL' value to indicate an
error, and functions returning an integer return zero to indicate
success or nonzero to indicate an error.  Note that 'nonzero' means just
that.  Unless the function description says otherwise, do not test
against a value other than zero:

     if (result)                   /* correct */
         ... error ...

     if (result < 0)               /* incorrect */
         ... error ...

     if (result == -1)             /* incorrect */
         ... error ...

When a function returns an error, the *Errors* subsection of the
function description lists the possible types of errors.  You can find
out which of these occurred by calling *note 'mysql_errno()':
mysql-errno.  A string representation of the error may be obtained by
calling *note 'mysql_error()': mysql-error.


File: manual.info.tmp,  Node: mysql-affected-rows,  Next: mysql-autocommit,  Prev: c-api-functions,  Up: c-api-functions

23.7.6.1 mysql_affected_rows()
..............................

'my_ulonglong mysql_affected_rows(MYSQL *mysql)'

*Description*

*note 'mysql_affected_rows()': mysql-affected-rows. may be called
immediately after executing a statement with *note 'mysql_query()':
mysql-query. or *note 'mysql_real_query()': mysql-real-query.  It
returns the number of rows changed, deleted, or inserted by the last
statement if it was an *note 'UPDATE': update, *note 'DELETE': delete,
or *note 'INSERT': insert.  For *note 'SELECT': select. statements,
*note 'mysql_affected_rows()': mysql-affected-rows. works like *note
'mysql_num_rows()': mysql-num-rows.

For *note 'UPDATE': update. statements, the affected-rows value by
default is the number of rows actually changed.  If you specify the
'CLIENT_FOUND_ROWS' flag to *note 'mysql_real_connect()':
mysql-real-connect. when connecting to *note 'mysqld': mysqld, the
affected-rows value is the number of rows 'found'; that is, matched by
the 'WHERE' clause.

For *note 'REPLACE': replace. statements, the affected-rows value is 2
if the new row replaced an old row, because in this case, one row was
inserted after the duplicate was deleted.

For *note 'INSERT ... ON DUPLICATE KEY UPDATE': insert-on-duplicate.
statements, the affected-rows value per row is 1 if the row is inserted
as a new row, 2 if an existing row is updated, and 0 if an existing row
is set to its current values.  If you specify the 'CLIENT_FOUND_ROWS'
flag, the affected-rows value is 1 (not 0) if an existing row is set to
its current values.

Following a *note 'CALL': call. statement for a stored procedure, *note
'mysql_affected_rows()': mysql-affected-rows. returns the value that it
would return for the last statement executed within the procedure, or
'0' if that statement would return '-1'.  Within the procedure, you can
use 'ROW_COUNT()' at the SQL level to obtain the affected-rows value for
individual statements.

*note 'mysql_affected_rows()': mysql-affected-rows. returns a meaningful
value for a wider range of statements.  For details, see the description
for 'ROW_COUNT()' in *note information-functions::.

*Return Values*

An integer greater than zero indicates the number of rows affected or
retrieved.  Zero indicates that no records were updated for an *note
'UPDATE': update. statement, no rows matched the 'WHERE' clause in the
query or that no query has yet been executed.  -1 indicates that the
query returned an error or that, for a *note 'SELECT': select. query,
*note 'mysql_affected_rows()': mysql-affected-rows. was called prior to
calling *note 'mysql_store_result()': mysql-store-result.

Because *note 'mysql_affected_rows()': mysql-affected-rows. returns an
unsigned value, you can check for -1 by comparing the return value to
'(my_ulonglong)-1' (or to '(my_ulonglong)~0', which is equivalent).

*Errors*

None.

*Example*

     char *stmt = "UPDATE products SET cost=cost*1.25
                   WHERE group=10";
     mysql_query(&mysql,stmt);
     printf("%ld products updated",
            (long) mysql_affected_rows(&mysql));


File: manual.info.tmp,  Node: mysql-autocommit,  Next: mysql-change-user,  Prev: mysql-affected-rows,  Up: c-api-functions

23.7.6.2 mysql_autocommit()
...........................

'my_bool mysql_autocommit(MYSQL *mysql, my_bool mode)'

*Description*

Sets autocommit mode on if 'mode' is 1, off if 'mode' is 0.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-change-user,  Next: mysql-character-set-name,  Prev: mysql-autocommit,  Up: c-api-functions

23.7.6.3 mysql_change_user()
............................

'my_bool mysql_change_user(MYSQL *mysql, const char *user, const char
*password, const char *db)'

*Description*

Changes the user and causes the database specified by 'db' to become the
default (current) database on the connection specified by 'mysql'.  In
subsequent queries, this database is the default for table references
that include no explicit database specifier.

*note 'mysql_change_user()': mysql-change-user. fails if the connected
user cannot be authenticated or does not have permission to use the
database.  In this case, the user and database are not changed.

Pass a 'db' parameter of 'NULL' if you do not want to have a default
database.

This function resets the session state as if one had done a new connect
and reauthenticated.  (See *note c-api-auto-reconnect::.)  It always
performs a *note 'ROLLBACK': commit. of any active transactions, closes
and drops all temporary tables, and unlocks all locked tables.  Session
system variables are reset to the values of the corresponding global
system variables.  Prepared statements are released and *note 'HANDLER':
handler. variables are closed.  Locks acquired with 'GET_LOCK()' are
released.  These effects occur even if the user did not change.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

The same that you can get from *note 'mysql_real_connect()':
mysql-real-connect, plus:

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.

   * 'ER_UNKNOWN_COM_ERROR'

     The MySQL server does not implement this command (probably an old
     server).

   * 'ER_ACCESS_DENIED_ERROR'

     The user or password was wrong.

   * 'ER_BAD_DB_ERROR'

     The database did not exist.

   * 'ER_DBACCESS_DENIED_ERROR'

     The user did not have access rights to the database.

   * 'ER_WRONG_DB_NAME'

     The database name was too long.

*Example*

     if (mysql_change_user(&mysql, "user", "PASSWORD", "new_database"))
     {
        fprintf(stderr, "Failed to change user.  Error: %s\n",
                mysql_error(&mysql));
     }


File: manual.info.tmp,  Node: mysql-character-set-name,  Next: mysql-close,  Prev: mysql-change-user,  Up: c-api-functions

23.7.6.4 mysql_character_set_name()
...................................

'const char *mysql_character_set_name(MYSQL *mysql)'

*Description*

Returns the default character set name for the current connection.

*Return Values*

The default character set name

*Errors*

None.


File: manual.info.tmp,  Node: mysql-close,  Next: mysql-commit,  Prev: mysql-character-set-name,  Up: c-api-functions

23.7.6.5 mysql_close()
......................

'void mysql_close(MYSQL *mysql)'

*Description*

Closes a previously opened connection.  *note 'mysql_close()':
mysql-close. also deallocates the connection handler pointed to by
'mysql' if the handler was allocated automatically by *note
'mysql_init()': mysql-init. or *note 'mysql_connect()': mysql-connect.
Do not use the handler after it has been closed.

*Return Values*

None.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-commit,  Next: mysql-connect,  Prev: mysql-close,  Up: c-api-functions

23.7.6.6 mysql_commit()
.......................

'my_bool mysql_commit(MYSQL *mysql)'

*Description*

Commits the current transaction.

The action of this function is subject to the value of the
'completion_type' system variable.  In particular, if the value of
'completion_type' is 'RELEASE' (or 2), the server performs a release
after terminating a transaction and closes the client connection.  Call
*note 'mysql_close()': mysql-close. from the client program to close the
connection from the client side.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-connect,  Next: mysql-create-db,  Prev: mysql-commit,  Up: c-api-functions

23.7.6.7 mysql_connect()
........................

'MYSQL *mysql_connect(MYSQL *mysql, const char *host, const char *user,
const char *passwd)'

*Description*

This function is deprecated.  Use *note 'mysql_real_connect()':
mysql-real-connect. instead.

*note 'mysql_connect()': mysql-connect. attempts to establish a
connection to a MySQL database engine running on 'host'.  *note
'mysql_connect()': mysql-connect. must complete successfully before you
can execute any of the other API functions, with the exception of *note
'mysql_get_client_info()': mysql-get-client-info.

The meanings of the parameters are the same as for the corresponding
parameters for *note 'mysql_real_connect()': mysql-real-connect. with
the difference that the connection parameter may be 'NULL'.  In this
case, the C API allocates memory for the connection structure
automatically and frees it when you call *note 'mysql_close()':
mysql-close.  The disadvantage of this approach is that you cannot
retrieve an error message if the connection fails.  (To get error
information from *note 'mysql_errno()': mysql-errno. or *note
'mysql_error()': mysql-error, you must provide a valid 'MYSQL' pointer.)

*Return Values*

Same as for *note 'mysql_real_connect()': mysql-real-connect.

*Errors*

Same as for *note 'mysql_real_connect()': mysql-real-connect.


File: manual.info.tmp,  Node: mysql-create-db,  Next: mysql-data-seek,  Prev: mysql-connect,  Up: c-api-functions

23.7.6.8 mysql_create_db()
..........................

'int mysql_create_db(MYSQL *mysql, const char *db)'

*Description*

Creates the database named by the 'db' parameter.

This function is deprecated.  Use *note 'mysql_query()': mysql-query. to
issue an SQL *note 'CREATE DATABASE': create-database. statement
instead.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.

*Example*

     if(mysql_create_db(&mysql, "my_database"))
     {
        fprintf(stderr, "Failed to create new database.  Error: %s\n",
                mysql_error(&mysql));
     }


File: manual.info.tmp,  Node: mysql-data-seek,  Next: mysql-debug,  Prev: mysql-create-db,  Up: c-api-functions

23.7.6.9 mysql_data_seek()
..........................

'void mysql_data_seek(MYSQL_RES *result, my_ulonglong offset)'

*Description*

Seeks to an arbitrary row in a query result set.  The 'offset' value is
a row number.  Specify a value in the range from '0' to *note
'mysql_num_rows(result)-1': mysql-num-rows.

This function requires that the result set structure contains the entire
result of the query, so *note 'mysql_data_seek()': mysql-data-seek. may
be used only in conjunction with *note 'mysql_store_result()':
mysql-store-result, not with *note 'mysql_use_result()':
mysql-use-result.

*Return Values*

None.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-debug,  Next: mysql-drop-db,  Prev: mysql-data-seek,  Up: c-api-functions

23.7.6.10 mysql_debug()
.......................

'void mysql_debug(const char *debug)'

*Description*

Does a 'DBUG_PUSH' with the given string.  *note 'mysql_debug()':
mysql-debug. uses the Fred Fish debug library.  To use this function,
you must compile the client library to support debugging.  See *note
dbug-package::.

*Return Values*

None.

*Errors*

None.

*Example*

The call shown here causes the client library to generate a trace file
in '/tmp/client.trace' on the client machine:

     mysql_debug("d:t:O,/tmp/client.trace");


File: manual.info.tmp,  Node: mysql-drop-db,  Next: mysql-dump-debug-info,  Prev: mysql-debug,  Up: c-api-functions

23.7.6.11 mysql_drop_db()
.........................

'int mysql_drop_db(MYSQL *mysql, const char *db)'

*Description*

Drops the database named by the 'db' parameter.

This function is deprecated.  Use *note 'mysql_query()': mysql-query. to
issue an SQL *note 'DROP DATABASE': drop-database. statement instead.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.

*Example*

     if(mysql_drop_db(&mysql, "my_database"))
       fprintf(stderr, "Failed to drop the database: Error: %s\n",
               mysql_error(&mysql));


File: manual.info.tmp,  Node: mysql-dump-debug-info,  Next: mysql-eof,  Prev: mysql-drop-db,  Up: c-api-functions

23.7.6.12 mysql_dump_debug_info()
.................................

'int mysql_dump_debug_info(MYSQL *mysql)'

*Description*

Instructs the server to write debugging information to the error log.
The connected user must have the 'SUPER' privilege.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-eof,  Next: mysql-errno,  Prev: mysql-dump-debug-info,  Up: c-api-functions

23.7.6.13 mysql_eof()
.....................

'my_bool mysql_eof(MYSQL_RES *result)'

*Description*

This function is deprecated.  *note 'mysql_errno()': mysql-errno. or
*note 'mysql_error()': mysql-error. may be used instead.

*note 'mysql_eof()': mysql-eof. determines whether the last row of a
result set has been read.

If you acquire a result set from a successful call to *note
'mysql_store_result()': mysql-store-result, the client receives the
entire set in one operation.  In this case, a 'NULL' return from *note
'mysql_fetch_row()': mysql-fetch-row. always means the end of the result
set has been reached and it is unnecessary to call *note 'mysql_eof()':
mysql-eof.  When used with *note 'mysql_store_result()':
mysql-store-result, *note 'mysql_eof()': mysql-eof. always returns true.

On the other hand, if you use *note 'mysql_use_result()':
mysql-use-result. to initiate a result set retrieval, the rows of the
set are obtained from the server one by one as you call *note
'mysql_fetch_row()': mysql-fetch-row. repeatedly.  Because an error may
occur on the connection during this process, a 'NULL' return value from
*note 'mysql_fetch_row()': mysql-fetch-row. does not necessarily mean
the end of the result set was reached normally.  In this case, you can
use *note 'mysql_eof()': mysql-eof. to determine what happened.  *note
'mysql_eof()': mysql-eof. returns a nonzero value if the end of the
result set was reached and zero if an error occurred.

Historically, *note 'mysql_eof()': mysql-eof. predates the standard
MySQL error functions *note 'mysql_errno()': mysql-errno. and *note
'mysql_error()': mysql-error.  Because those error functions provide the
same information, their use is preferred over *note 'mysql_eof()':
mysql-eof, which is deprecated.  (In fact, they provide more
information, because *note 'mysql_eof()': mysql-eof. returns only a
boolean value whereas the error functions indicate a reason for the
error when one occurs.)

*Return Values*

Zero for success.  Nonzero if the end of the result set has been
reached.

*Errors*

None.

*Example*

The following example shows how you might use *note 'mysql_eof()':
mysql-eof.:

     mysql_query(&mysql,"SELECT * FROM some_table");
     result = mysql_use_result(&mysql);
     while((row = mysql_fetch_row(result)))
     {
         // do something with data
     }
     if(!mysql_eof(result))  // mysql_fetch_row() failed due to an error
     {
         fprintf(stderr, "Error: %s\n", mysql_error(&mysql));
     }

However, you can achieve the same effect with the standard MySQL error
functions:

     mysql_query(&mysql,"SELECT * FROM some_table");
     result = mysql_use_result(&mysql);
     while((row = mysql_fetch_row(result)))
     {
         // do something with data
     }
     if(mysql_errno(&mysql))  // mysql_fetch_row() failed due to an error
     {
         fprintf(stderr, "Error: %s\n", mysql_error(&mysql));
     }


File: manual.info.tmp,  Node: mysql-errno,  Next: mysql-error,  Prev: mysql-eof,  Up: c-api-functions

23.7.6.14 mysql_errno()
.......................

'unsigned int mysql_errno(MYSQL *mysql)'

*Description*

For the connection specified by 'mysql', *note 'mysql_errno()':
mysql-errno. returns the error code for the most recently invoked API
function that can succeed or fail.  A return value of zero means that no
error occurred.  Client error message numbers are listed in the MySQL
'errmsg.h' header file.  Server error message numbers are listed in
'mysqld_error.h'.  Errors also are listed at *note error-handling::.

*Note*:

Some functions such as *note 'mysql_fetch_row()': mysql-fetch-row. do
not set *note 'mysql_errno()': mysql-errno. if they succeed.  A rule of
thumb is that all functions that have to ask the server for information
reset *note 'mysql_errno()': mysql-errno. if they succeed.

MySQL-specific error numbers returned by *note 'mysql_errno()':
mysql-errno. differ from SQLSTATE values returned by *note
'mysql_sqlstate()': mysql-sqlstate.  For example, the *note 'mysql':
mysql. client program displays errors using the following format, where
'1146' is the *note 'mysql_errno()': mysql-errno. value and ''42S02'' is
the corresponding *note 'mysql_sqlstate()': mysql-sqlstate. value:

     shell> SELECT * FROM no_such_table;
     ERROR 1146 (42S02): Table 'test.no_such_table' doesn't exist

*Return Values*

An error code value for the last 'mysql_XXX()' call, if it failed.  zero
means no error occurred.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-error,  Next: mysql-escape-string,  Prev: mysql-errno,  Up: c-api-functions

23.7.6.15 mysql_error()
.......................

'const char *mysql_error(MYSQL *mysql)'

*Description*

For the connection specified by 'mysql', *note 'mysql_error()':
mysql-error. returns a null-terminated string containing the error
message for the most recently invoked API function that failed.  If a
function did not fail, the return value of *note 'mysql_error()':
mysql-error. may be the previous error or an empty string to indicate no
error.

A rule of thumb is that all functions that have to ask the server for
information reset *note 'mysql_error()': mysql-error. if they succeed.

For functions that reset *note 'mysql_error()': mysql-error, either of
these two tests can be used to check for an error:

     if(*mysql_error(&mysql))
     {
       // an error occurred
     }

     if(mysql_error(&mysql)[0])
     {
       // an error occurred
     }

The language of the client error messages may be changed by recompiling
the MySQL client library.  You can choose error messages in several
different languages.  See *note error-message-language::.

*Return Values*

A null-terminated character string that describes the error.  An empty
string if no error occurred.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-escape-string,  Next: mysql-fetch-field,  Prev: mysql-error,  Up: c-api-functions

23.7.6.16 mysql_escape_string()
...............................

*Note*:

This function should not be used.  Use *note
'mysql_real_escape_string()': mysql-real-escape-string. instead.

*note 'mysql_escape_string()': mysql-escape-string. is identical to
*note 'mysql_real_escape_string()': mysql-real-escape-string. except
that *note 'mysql_real_escape_string()': mysql-real-escape-string. takes
a connection handler as its first argument and escapes the string
according to the current character set.  *note 'mysql_escape_string()':
mysql-escape-string. does not take a connection argument and does not
respect the current character set.


File: manual.info.tmp,  Node: mysql-fetch-field,  Next: mysql-fetch-field-direct,  Prev: mysql-escape-string,  Up: c-api-functions

23.7.6.17 mysql_fetch_field()
.............................

'MYSQL_FIELD *mysql_fetch_field(MYSQL_RES *result)'

*Description*

Returns the definition of one column of a result set as a 'MYSQL_FIELD'
structure.  Call this function repeatedly to retrieve information about
all columns in the result set.  *note 'mysql_fetch_field()':
mysql-fetch-field. returns 'NULL' when no more fields are left.

*note 'mysql_fetch_field()': mysql-fetch-field. is reset to return
information about the first field each time you execute a new *note
'SELECT': select. query.  The field returned by *note
'mysql_fetch_field()': mysql-fetch-field. is also affected by calls to
*note 'mysql_field_seek()': mysql-field-seek.

If you've called *note 'mysql_query()': mysql-query. to perform a *note
'SELECT': select. on a table but have not called *note
'mysql_store_result()': mysql-store-result, MySQL returns the default
blob length (8KB) if you call *note 'mysql_fetch_field()':
mysql-fetch-field. to ask for the length of a *note 'BLOB': blob. field.
(The 8KB size is chosen because MySQL does not know the maximum length
for the *note 'BLOB': blob.  This should be made configurable sometime.)
Once you've retrieved the result set, 'field->max_length' contains the
length of the largest value for this column in the specific query.

*Return Values*

The 'MYSQL_FIELD' structure for the current column.  'NULL' if no
columns are left.

*Errors*

None.

*Example*

     MYSQL_FIELD *field;

     while((field = mysql_fetch_field(result)))
     {
         printf("field name %s\n", field->name);
     }


File: manual.info.tmp,  Node: mysql-fetch-field-direct,  Next: mysql-fetch-fields,  Prev: mysql-fetch-field,  Up: c-api-functions

23.7.6.18 mysql_fetch_field_direct()
....................................

'MYSQL_FIELD *mysql_fetch_field_direct(MYSQL_RES *result, unsigned int
fieldnr)'

*Description*

Given a field number 'fieldnr' for a column within a result set, returns
that column's field definition as a 'MYSQL_FIELD' structure.  Use this
function to retrieve the definition for an arbitrary column.  Specify a
value for 'fieldnr' in the range from 0 to *note
'mysql_num_fields(result)-1': mysql-num-fields.

*Return Values*

The 'MYSQL_FIELD' structure for the specified column.

*Errors*

None.

*Example*

     unsigned int num_fields;
     unsigned int i;
     MYSQL_FIELD *field;

     num_fields = mysql_num_fields(result);
     for(i = 0; i < num_fields; i++)
     {
         field = mysql_fetch_field_direct(result, i);
         printf("Field %u is %s\n", i, field->name);
     }


File: manual.info.tmp,  Node: mysql-fetch-fields,  Next: mysql-fetch-lengths,  Prev: mysql-fetch-field-direct,  Up: c-api-functions

23.7.6.19 mysql_fetch_fields()
..............................

'MYSQL_FIELD *mysql_fetch_fields(MYSQL_RES *result)'

*Description*

Returns an array of all 'MYSQL_FIELD' structures for a result set.  Each
structure provides the field definition for one column of the result
set.

*Return Values*

An array of 'MYSQL_FIELD' structures for all columns of a result set.

*Errors*

None.

*Example*

     unsigned int num_fields;
     unsigned int i;
     MYSQL_FIELD *fields;

     num_fields = mysql_num_fields(result);
     fields = mysql_fetch_fields(result);
     for(i = 0; i < num_fields; i++)
     {
        printf("Field %u is %s\n", i, fields[i].name);
     }


File: manual.info.tmp,  Node: mysql-fetch-lengths,  Next: mysql-fetch-row,  Prev: mysql-fetch-fields,  Up: c-api-functions

23.7.6.20 mysql_fetch_lengths()
...............................

'unsigned long *mysql_fetch_lengths(MYSQL_RES *result)'

*Description*

Returns the lengths of the columns of the current row within a result
set.  If you plan to copy field values, this length information is also
useful for optimization, because you can avoid calling 'strlen()'.  In
addition, if the result set contains binary data, you *must* use this
function to determine the size of the data, because 'strlen()' returns
incorrect results for any field containing null characters.

The length for empty columns and for columns containing 'NULL' values is
zero.  To see how to distinguish these two cases, see the description
for *note 'mysql_fetch_row()': mysql-fetch-row.

*Return Values*

An array of unsigned long integers representing the size of each column
(not including any terminating null bytes).  'NULL' if an error
occurred.

*Errors*

*note 'mysql_fetch_lengths()': mysql-fetch-lengths. is valid only for
the current row of the result set.  It returns 'NULL' if you call it
before calling *note 'mysql_fetch_row()': mysql-fetch-row. or after
retrieving all rows in the result.

*Example*

     MYSQL_ROW row;
     unsigned long *lengths;
     unsigned int num_fields;
     unsigned int i;

     row = mysql_fetch_row(result);
     if (row)
     {
         num_fields = mysql_num_fields(result);
         lengths = mysql_fetch_lengths(result);
         for(i = 0; i < num_fields; i++)
         {
              printf("Column %u is %lu bytes in length.\n",
                     i, lengths[i]);
         }
     }


File: manual.info.tmp,  Node: mysql-fetch-row,  Next: mysql-field-count,  Prev: mysql-fetch-lengths,  Up: c-api-functions

23.7.6.21 mysql_fetch_row()
...........................

'MYSQL_ROW mysql_fetch_row(MYSQL_RES *result)'

*Description*

*note 'mysql_fetch_row()': mysql-fetch-row. retrieves the next row of a
result set:

   * When used after *note 'mysql_store_result()': mysql-store-result,
     *note 'mysql_fetch_row()': mysql-fetch-row. returns 'NULL' if there
     are no more rows to retrieve.

   * When used after *note 'mysql_use_result()': mysql-use-result, *note
     'mysql_fetch_row()': mysql-fetch-row. returns 'NULL' if there are
     no more rows to retrieve or an error occurred.

The number of values in the row is given by *note
'mysql_num_fields(result)': mysql-num-fields.  If 'row' holds the return
value from a call to *note 'mysql_fetch_row()': mysql-fetch-row,
pointers to the values are accessed as 'row[0]' to
'row[mysql_num_fields(result)-1]'.  'NULL' values in the row are
indicated by 'NULL' pointers.

The lengths of the field values in the row may be obtained by calling
*note 'mysql_fetch_lengths()': mysql-fetch-lengths.  Empty fields and
fields containing 'NULL' both have length 0; you can distinguish these
by checking the pointer for the field value.  If the pointer is 'NULL',
the field is 'NULL'; otherwise, the field is empty.

*Return Values*

A 'MYSQL_ROW' structure for the next row, or 'NULL'.  The meaning of a
'NULL' return depends on which function was called preceding *note
'mysql_fetch_row()': mysql-fetch-row.:

   * When used after *note 'mysql_store_result()': mysql-store-result,
     *note 'mysql_fetch_row()': mysql-fetch-row. returns 'NULL' if there
     are no more rows to retrieve.

   * When used after *note 'mysql_use_result()': mysql-use-result, *note
     'mysql_fetch_row()': mysql-fetch-row. returns 'NULL' if there are
     no more rows to retrieve or an error occurred.  To determine
     whether an error occurred, check whether *note 'mysql_error()':
     mysql-error. returns a nonempty string or *note 'mysql_errno()':
     mysql-errno. returns nonzero.

*Errors*

Errors are not reset between calls to *note 'mysql_fetch_row()':
mysql-fetch-row.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.

*Example*

     MYSQL_ROW row;
     unsigned int num_fields;
     unsigned int i;

     num_fields = mysql_num_fields(result);
     while ((row = mysql_fetch_row(result)))
     {
        unsigned long *lengths;
        lengths = mysql_fetch_lengths(result);
        for(i = 0; i < num_fields; i++)
        {
            printf("[%.*s] ", (int) lengths[i],
                   row[i] ? row[i] : "NULL");
        }
        printf("\n");
     }


File: manual.info.tmp,  Node: mysql-field-count,  Next: mysql-field-seek,  Prev: mysql-fetch-row,  Up: c-api-functions

23.7.6.22 mysql_field_count()
.............................

'unsigned int mysql_field_count(MYSQL *mysql)'

*Description*

Returns the number of columns for the most recent query on the
connection.

The normal use of this function is when *note 'mysql_store_result()':
mysql-store-result. returned 'NULL' (and thus you have no result set
pointer).  In this case, you can call *note 'mysql_field_count()':
mysql-field-count. to determine whether *note 'mysql_store_result()':
mysql-store-result. should have produced a nonempty result.  This
enables the client program to take proper action without knowing whether
the query was a *note 'SELECT': select. (or *note 'SELECT':
select.-like) statement.  The example shown here illustrates how this
may be done.

See *note null-mysql-store-result::.

*Return Values*

An unsigned integer representing the number of columns in a result set.

*Errors*

None.

*Example*

     MYSQL_RES *result;
     unsigned int num_fields;
     unsigned int num_rows;

     if (mysql_query(&mysql,query_string))
     {
         // error
     }
     else // query succeeded, process any data returned by it
     {
         result = mysql_store_result(&mysql);
         if (result)  // there are rows
         {
             num_fields = mysql_num_fields(result);
             // retrieve rows, then call mysql_free_result(result)
         }
         else  // mysql_store_result() returned nothing; should it have?
         {
             if(mysql_field_count(&mysql) == 0)
             {
                 // query does not return data
                 // (it was not a SELECT)
                 num_rows = mysql_affected_rows(&mysql);
             }
             else // mysql_store_result() should have returned data
             {
                 fprintf(stderr, "Error: %s\n", mysql_error(&mysql));
             }
         }
     }

An alternative is to replace the *note 'mysql_field_count(&mysql)':
mysql-field-count. call with *note 'mysql_errno(&mysql)': mysql-errno.
In this case, you are checking directly for an error from *note
'mysql_store_result()': mysql-store-result. rather than inferring from
the value of *note 'mysql_field_count()': mysql-field-count. whether the
statement was a *note 'SELECT': select.


File: manual.info.tmp,  Node: mysql-field-seek,  Next: mysql-field-tell,  Prev: mysql-field-count,  Up: c-api-functions

23.7.6.23 mysql_field_seek()
............................

'MYSQL_FIELD_OFFSET mysql_field_seek(MYSQL_RES *result,
MYSQL_FIELD_OFFSET offset)'

*Description*

Sets the field cursor to the given offset.  The next call to *note
'mysql_fetch_field()': mysql-fetch-field. retrieves the field definition
of the column associated with that offset.

To seek to the beginning of a row, pass an 'offset' value of zero.

*Return Values*

The previous value of the field cursor.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-field-tell,  Next: mysql-free-result,  Prev: mysql-field-seek,  Up: c-api-functions

23.7.6.24 mysql_field_tell()
............................

'MYSQL_FIELD_OFFSET mysql_field_tell(MYSQL_RES *result)'

*Description*

Returns the position of the field cursor used for the last *note
'mysql_fetch_field()': mysql-fetch-field.  This value can be used as an
argument to *note 'mysql_field_seek()': mysql-field-seek.

*Return Values*

The current offset of the field cursor.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-free-result,  Next: mysql-get-character-set-info,  Prev: mysql-field-tell,  Up: c-api-functions

23.7.6.25 mysql_free_result()
.............................

'void mysql_free_result(MYSQL_RES *result)'

*Description*

*note 'mysql_free_result()': mysql-free-result. frees the memory
allocated for a result set by *note 'mysql_store_result()':
mysql-store-result, *note 'mysql_use_result()': mysql-use-result, *note
'mysql_list_dbs()': mysql-list-dbs, and so forth.  When you are done
with a result set, you must free the memory it uses by calling *note
'mysql_free_result()': mysql-free-result.

Do not attempt to access a result set after freeing it.

*Return Values*

None.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-get-character-set-info,  Next: mysql-get-client-info,  Prev: mysql-free-result,  Up: c-api-functions

23.7.6.26 mysql_get_character_set_info()
........................................

'void mysql_get_character_set_info(MYSQL *mysql, MY_CHARSET_INFO *cs)'

*Description*

This function provides information about the default client character
set.  The default character set may be changed with the *note
'mysql_set_character_set()': mysql-set-character-set. function.

*Example*

This example shows the fields that are available in the
'MY_CHARSET_INFO' structure:

     if (!mysql_set_character_set(&mysql, "utf8"))
     {
         MY_CHARSET_INFO cs;
         mysql_get_character_set_info(&mysql, &cs);
         printf("character set information:\n");
         printf("character set+collation number: %d\n", cs.number);
         printf("character set name: %s\n", cs.name);
         printf("collation name: %s\n", cs.csname);
         printf("comment: %s\n", cs.comment);
         printf("directory: %s\n", cs.dir);
         printf("multi byte character min. length: %d\n", cs.mbminlen);
         printf("multi byte character max. length: %d\n", cs.mbmaxlen);
     }


File: manual.info.tmp,  Node: mysql-get-client-info,  Next: mysql-get-client-version,  Prev: mysql-get-character-set-info,  Up: c-api-functions

23.7.6.27 mysql_get_client_info()
.................................

'const char *mysql_get_client_info(void)'

*Description*

Returns a string that represents the MySQL client library version (for
example, '"5.5.62"').

The function value is the MySQL version.  For more information, see
*note c-api-server-client-versions::.

*Return Values*

A character string that represents the MySQL client library version.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-get-client-version,  Next: mysql-get-host-info,  Prev: mysql-get-client-info,  Up: c-api-functions

23.7.6.28 mysql_get_client_version()
....................................

'unsigned long mysql_get_client_version(void)'

*Description*

Returns an integer that represents the MySQL client library version.
The value has the format XYYZZ where X is the major version, YY is the
release level (or minor version), and ZZ is the sub-version within the
release level:

     major_version*10000 + release_level*100 + sub_version

For example, '"5.5.62"' is returned as '50562'.

The function value is the MySQL version.  For more information, see
*note c-api-server-client-versions::.

*Return Values*

An integer that represents the MySQL client library version.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-get-host-info,  Next: mysql-get-proto-info,  Prev: mysql-get-client-version,  Up: c-api-functions

23.7.6.29 mysql_get_host_info()
...............................

'const char *mysql_get_host_info(MYSQL *mysql)'

*Description*

Returns a string describing the type of connection in use, including the
server host name.

*Return Values*

A character string representing the server host name and the connection
type.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-get-proto-info,  Next: mysql-get-server-info,  Prev: mysql-get-host-info,  Up: c-api-functions

23.7.6.30 mysql_get_proto_info()
................................

'unsigned int mysql_get_proto_info(MYSQL *mysql)'

*Description*

Returns the protocol version used by current connection.

*Return Values*

An unsigned integer representing the protocol version used by the
current connection.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-get-server-info,  Next: mysql-get-server-version,  Prev: mysql-get-proto-info,  Up: c-api-functions

23.7.6.31 mysql_get_server_info()
.................................

'const char *mysql_get_server_info(MYSQL *mysql)'

*Description*

Returns a string that represents the MySQL server version (for example,
'"5.5.62"').

*Return Values*

A character string that represents the MySQL server version.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-get-server-version,  Next: mysql-get-ssl-cipher,  Prev: mysql-get-server-info,  Up: c-api-functions

23.7.6.32 mysql_get_server_version()
....................................

'unsigned long mysql_get_server_version(MYSQL *mysql)'

*Description*

Returns an integer that represents the MySQL server version.  The value
has the format XYYZZ where X is the major version, YY is the release
level (or minor version), and ZZ is the sub-version within the release
level:

     major_version*10000 + release_level*100 + sub_version

For example, '"5.5.62"' is returned as '50562'.

This function is useful in client programs for determining whether some
version-specific server capability exists.

*Return Values*

An integer that represents the MySQL server version.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-get-ssl-cipher,  Next: mysql-hex-string,  Prev: mysql-get-server-version,  Up: c-api-functions

23.7.6.33 mysql_get_ssl_cipher()
................................

'const char *mysql_get_ssl_cipher(MYSQL *mysql)'

*Description*

*note 'mysql_get_ssl_cipher()': mysql-get-ssl-cipher. returns the
encryption cipher used for the given connection to the server.  'mysql'
is the connection handler returned from *note 'mysql_init()':
mysql-init.

*Return Values*

A string naming the encryption cipher used for the connection, or 'NULL'
if the connection is not encrypted.


File: manual.info.tmp,  Node: mysql-hex-string,  Next: mysql-info,  Prev: mysql-get-ssl-cipher,  Up: c-api-functions

23.7.6.34 mysql_hex_string()
............................

'unsigned long mysql_hex_string(char *to, const char *from, unsigned
long length)'

*Description*

This function creates a legal SQL string for use in an SQL statement.
See *note string-literals::.

The string in the 'from' argument is encoded in hexadecimal format, with
each character encoded as two hexadecimal digits.  The result is placed
in the 'to' argument, followed by a terminating null byte.

The string pointed to by 'from' must be 'length' bytes long.  You must
allocate the 'to' buffer to be at least 'length*2+1' bytes long.  When
*note 'mysql_hex_string()': mysql-hex-string. returns, the contents of
'to' is a null-terminated string.  The return value is the length of the
encoded string, not including the terminating null byte.

The return value can be placed into an SQL statement using either
'X'VALUE'' or '0xVALUE' format.  However, the return value does not
include the 'X'...'' or '0x'.  The caller must supply whichever of those
is desired.

*Example*

     char query[1000],*end;

     end = strmov(query,"INSERT INTO test_table values(");
     end = strmov(end,"X'");
     end += mysql_hex_string(end,"What is this",12);
     end = strmov(end,"',X'");
     end += mysql_hex_string(end,"binary data: \0\r\n",16);
     end = strmov(end,"')");

     if (mysql_real_query(&mysql,query,(unsigned int) (end - query)))
     {
        fprintf(stderr, "Failed to insert row, Error: %s\n",
                mysql_error(&mysql));
     }

The 'strmov()' function used in the example is included in the
'libmysqlclient' library and works like 'strcpy()' but returns a pointer
to the terminating null of the first parameter.

*Return Values*

The length of the encoded string that is placed into 'to', not including
the terminating null character.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-info,  Next: mysql-init,  Prev: mysql-hex-string,  Up: c-api-functions

23.7.6.35 mysql_info()
......................

'const char *mysql_info(MYSQL *mysql)'

*Description*

Retrieves a string providing information about the most recently
executed statement, but only for the statements listed here.  For other
statements, *note 'mysql_info()': mysql-info. returns 'NULL'.  The
format of the string varies depending on the type of statement, as
described here.  The numbers are illustrative only; the string contains
values appropriate for the statement.

   * *note 'INSERT INTO ... SELECT ...': insert-select.

     String format: 'Records: 100 Duplicates: 0 Warnings: 0'

   * 'INSERT INTO ... VALUES (...),(...),(...)...'

     String format: 'Records: 3 Duplicates: 0 Warnings: 0'

   * *note 'LOAD DATA': load-data.

     String format: 'Records: 1 Deleted: 0 Skipped: 0 Warnings: 0'

   * *note 'ALTER TABLE': alter-table.

     String format: 'Records: 3 Duplicates: 0 Warnings: 0'

   * *note 'UPDATE': update.

     String format: 'Rows matched: 40 Changed: 40 Warnings: 0'

*note 'mysql_info()': mysql-info. returns a non-'NULL' value for *note
'INSERT ... VALUES': insert. only for the multiple-row form of the
statement (that is, only if multiple value lists are specified).

*Return Values*

A character string representing additional information about the most
recently executed statement.  'NULL' if no information is available for
the statement.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-init,  Next: mysql-insert-id,  Prev: mysql-info,  Up: c-api-functions

23.7.6.36 mysql_init()
......................

'MYSQL *mysql_init(MYSQL *mysql)'

*Description*

Allocates or initializes a 'MYSQL' object suitable for *note
'mysql_real_connect()': mysql-real-connect.  If 'mysql' is a 'NULL'
pointer, the function allocates, initializes, and returns a new object.
Otherwise, the object is initialized and the address of the object is
returned.  If *note 'mysql_init()': mysql-init. allocates a new object,
it is freed when *note 'mysql_close()': mysql-close. is called to close
the connection.

In a nonmultithreaded environment, *note 'mysql_init()': mysql-init.
invokes *note 'mysql_library_init()': mysql-library-init. automatically
as necessary.  However, *note 'mysql_library_init()':
mysql-library-init. is not thread-safe in a multithreaded environment,
and thus neither is *note 'mysql_init()': mysql-init.  Before calling
*note 'mysql_init()': mysql-init, either call *note
'mysql_library_init()': mysql-library-init. prior to spawning any
threads, or use a mutex to protect the *note 'mysql_library_init()':
mysql-library-init. call.  This should be done prior to any other client
library call.

*Return Values*

An initialized 'MYSQL*' handler.  'NULL' if there was insufficient
memory to allocate a new object.

*Errors*

In case of insufficient memory, 'NULL' is returned.


File: manual.info.tmp,  Node: mysql-insert-id,  Next: mysql-kill,  Prev: mysql-init,  Up: c-api-functions

23.7.6.37 mysql_insert_id()
...........................

'my_ulonglong mysql_insert_id(MYSQL *mysql)'

*Description*

Returns the value generated for an 'AUTO_INCREMENT' column by the
previous *note 'INSERT': insert. or *note 'UPDATE': update. statement.
Use this function after you have performed an *note 'INSERT': insert.
statement into a table that contains an 'AUTO_INCREMENT' field, or have
used *note 'INSERT': insert. or *note 'UPDATE': update. to set a column
value with 'LAST_INSERT_ID(EXPR)'.

The return value of *note 'mysql_insert_id()': mysql-insert-id. is
always zero unless explicitly updated under one of the following
conditions:

   * *note 'INSERT': insert. statements that store a value into an
     'AUTO_INCREMENT' column.  This is true whether the value is
     automatically generated by storing the special values 'NULL' or '0'
     into the column, or is an explicit nonspecial value.

   * In the case of a multiple-row *note 'INSERT': insert. statement,
     *note 'mysql_insert_id()': mysql-insert-id. returns the first
     automatically generated 'AUTO_INCREMENT' value that was
     successfully inserted.

     If no rows are successfully inserted, *note 'mysql_insert_id()':
     mysql-insert-id. returns 0.

   * If an *note 'INSERT ... SELECT': insert-select. statement is
     executed, and no automatically generated value is successfully
     inserted, *note 'mysql_insert_id()': mysql-insert-id. returns the
     ID of the last inserted row.

   * If an *note 'INSERT ... SELECT': insert-select. statement uses
     'LAST_INSERT_ID(EXPR)', *note 'mysql_insert_id()': mysql-insert-id.
     returns EXPR.

   * *note 'INSERT': insert. statements that generate an
     'AUTO_INCREMENT' value by inserting 'LAST_INSERT_ID(EXPR)' into any
     column or by updating any column to 'LAST_INSERT_ID(EXPR)'.

   * If the previous statement returned an error, the value of *note
     'mysql_insert_id()': mysql-insert-id. is undefined.

The return value of *note 'mysql_insert_id()': mysql-insert-id. can be
simplified to the following sequence:

  1. If there is an 'AUTO_INCREMENT' column, and an automatically
     generated value was successfully inserted, return the first such
     value.

  2. If 'LAST_INSERT_ID(EXPR)' occurred in the statement, return EXPR,
     even if there was an 'AUTO_INCREMENT' column in the affected table.

  3. The return value varies depending on the statement used.  When
     called after an *note 'INSERT': insert. statement:

        * If there is an 'AUTO_INCREMENT' column in the table, and there
          were some explicit values for this column that were
          successfully inserted into the table, return the last of the
          explicit values.

     When called after an *note 'INSERT ... ON DUPLICATE KEY UPDATE':
     insert-on-duplicate. statement:

        * If there is an 'AUTO_INCREMENT' column in the table and there
          were some explicit successfully inserted values or some
          updated values, return the last of the inserted or updated
          values.

*note 'mysql_insert_id()': mysql-insert-id. returns '0' if the previous
statement does not use an 'AUTO_INCREMENT' value.  If you must save the
value for later, be sure to call *note 'mysql_insert_id()':
mysql-insert-id. immediately after the statement that generates the
value.

The value of *note 'mysql_insert_id()': mysql-insert-id. is affected
only by statements issued within the current client connection.  It is
not affected by statements issued by other clients.

The 'LAST_INSERT_ID()' SQL function will contain the value of the first
automatically generated value that was successfully inserted.
'LAST_INSERT_ID()' is not reset between statements because the value of
that function is maintained in the server.  Another difference from
*note 'mysql_insert_id()': mysql-insert-id. is that 'LAST_INSERT_ID()'
is not updated if you set an 'AUTO_INCREMENT' column to a specific
nonspecial value.  See *note information-functions::.

*note 'mysql_insert_id()': mysql-insert-id. returns '0' following a
*note 'CALL': call. statement for a stored procedure that generates an
'AUTO_INCREMENT' value because in this case *note 'mysql_insert_id()':
mysql-insert-id. applies to *note 'CALL': call. and not the statement
within the procedure.  Within the procedure, you can use
'LAST_INSERT_ID()' at the SQL level to obtain the 'AUTO_INCREMENT'
value.

The reason for the differences between 'LAST_INSERT_ID()' and *note
'mysql_insert_id()': mysql-insert-id. is that 'LAST_INSERT_ID()' is made
easy to use in scripts while *note 'mysql_insert_id()': mysql-insert-id.
tries to provide more exact information about what happens to the
'AUTO_INCREMENT' column.

*Return Values*

Described in the preceding discussion.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-kill,  Next: mysql-library-end,  Prev: mysql-insert-id,  Up: c-api-functions

23.7.6.38 mysql_kill()
......................

'int mysql_kill(MYSQL *mysql, unsigned long pid)'

*Description*

Asks the server to kill the thread specified by 'pid'.

This function is deprecated.  Use *note 'mysql_query()': mysql-query. to
issue an SQL *note 'KILL': kill. statement instead.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-library-end,  Next: mysql-library-init,  Prev: mysql-kill,  Up: c-api-functions

23.7.6.39 mysql_library_end()
.............................

'void mysql_library_end(void)'

*Description*

This function finalizes the MySQL library.  Call it when you are done
using the library (for example, after disconnecting from the server).
The action taken by the call depends on whether your application is
linked to the MySQL client library or the MySQL embedded server library.
For a client program linked against the 'libmysqlclient' library by
using the '-lmysqlclient' flag, *note 'mysql_library_end()':
mysql-library-end. performs some memory management to clean up.  For an
embedded server application linked against the 'libmysqld' library by
using the '-lmysqld' flag, *note 'mysql_library_end()':
mysql-library-end. shuts down the embedded server and then cleans up.

*Note*:

To avoid memory leaks after the application is done using the library
(for example, after closing the connection to the server), be sure to
call *note 'mysql_library_end()': mysql-library-end. explicitly.  This
enables memory managment to be performed to clean up and free resources
used by the library.

For usage information, see *note c-api-function-overview::, and *note
mysql-library-init::.


File: manual.info.tmp,  Node: mysql-library-init,  Next: mysql-list-dbs,  Prev: mysql-library-end,  Up: c-api-functions

23.7.6.40 mysql_library_init()
..............................

'int mysql_library_init(int argc, char **argv, char **groups)'

*Description*

Call this function to initialize the MySQL client library before you
call any other MySQL function, whether your application is a regular
client program or uses the embedded server.  If the application uses the
embedded server, this call starts the server and initializes any
subsystems ('mysys', 'InnoDB', and so forth) that the server uses.

*Note*:

To avoid memory leaks after the application is done using the library
(for example, after closing the connection to the server), be sure to
call *note 'mysql_library_end()': mysql-library-end. explicitly.  This
enables memory managment to be performed to clean up and free resources
used by the library.  See *note mysql-library-end::.

The choice of whether the application operates as a regular client or
uses the embedded server depends on whether you use the 'libmysqlclient'
or 'libmysqld' library at link time to produce the final executable.
For additional information, see *note c-api-function-overview::.

In a nonmultithreaded environment, the call to *note
'mysql_library_init()': mysql-library-init. may be omitted, because
*note 'mysql_init()': mysql-init. will invoke it automatically as
necessary.  However, *note 'mysql_library_init()': mysql-library-init.
is not thread-safe in a multithreaded environment, and thus neither is
*note 'mysql_init()': mysql-init, which calls *note
'mysql_library_init()': mysql-library-init.  You must either call *note
'mysql_library_init()': mysql-library-init. prior to spawning any
threads, or else use a mutex to protect the call, whether you invoke
*note 'mysql_library_init()': mysql-library-init. or indirectly through
*note 'mysql_init()': mysql-init.  Do this prior to any other client
library call.

The 'argc' and 'argv' arguments are analogous to the arguments to
'main()', and enable passing of options to the embedded server.  For
convenience, 'argc' may be '0' (zero) if there are no command-line
arguments for the server.  This is the usual case for applications
intended for use only as regular (nonembedded) clients, and the call
typically is written as *note 'mysql_library_init(0, NULL, NULL)':
mysql-library-init.

     #include <mysql.h>
     #include <stdlib.h>

     int main(void) {
       if (mysql_library_init(0, NULL, NULL)) {
         fprintf(stderr, "could not initialize MySQL client library\n");
         exit(1);
       }

       /* Use any MySQL API functions here */

       mysql_library_end();

       return EXIT_SUCCESS;
     }

When arguments are to be passed ('argc' is greater than '0'), the first
element of 'argv' is ignored (it typically contains the program name).
*note 'mysql_library_init()': mysql-library-init. makes a copy of the
arguments so it is safe to destroy 'argv' or 'groups' after the call.

For embedded applications, if you want to connect to an external server
without starting the embedded server, you have to specify a negative
value for 'argc'.

The 'groups' argument is an array of strings that indicate the groups in
option files from which to read options.  See *note option-files::.
Make the final entry in the array 'NULL'.  For convenience, if the
'groups' argument itself is 'NULL', the '[server]' and '[embedded]'
groups are used by default.

     #include <mysql.h>
     #include <stdlib.h>

     static char *server_args[] = {
       "this_program",       /* this string is not used */
       "--datadir=.",
       "--key_buffer_size=32M"
     };
     static char *server_groups[] = {
       "embedded",
       "server",
       "this_program_SERVER",
       (char *)NULL
     };

     int main(void) {
       if (mysql_library_init(sizeof(server_args) / sizeof(char *),
                             server_args, server_groups)) {
         fprintf(stderr, "could not initialize MySQL client library\n");
         exit(1);
       }

       /* Use any MySQL API functions here */

       mysql_library_end();

       return EXIT_SUCCESS;
     }

*Return Values*

Zero for success.  Nonzero if an error occurred.


File: manual.info.tmp,  Node: mysql-list-dbs,  Next: mysql-list-fields,  Prev: mysql-library-init,  Up: c-api-functions

23.7.6.41 mysql_list_dbs()
..........................

'MYSQL_RES *mysql_list_dbs(MYSQL *mysql, const char *wild)'

*Description*

Returns a result set consisting of database names on the server that
match the simple regular expression specified by the 'wild' parameter.
'wild' may contain the wildcard characters '%' or '_', or may be a
'NULL' pointer to match all databases.  Calling *note
'mysql_list_dbs()': mysql-list-dbs. is similar to executing the query
'SHOW DATABASES [LIKE WILD]'.

You must free the result set with *note 'mysql_free_result()':
mysql-free-result.

*Return Values*

A 'MYSQL_RES' result set for success.  'NULL' if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_OUT_OF_MEMORY'

     Out of memory.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-list-fields,  Next: mysql-list-processes,  Prev: mysql-list-dbs,  Up: c-api-functions

23.7.6.42 mysql_list_fields()
.............................

'MYSQL_RES *mysql_list_fields(MYSQL *mysql, const char *table, const
char *wild)'

*Description*

Returns an empty result set for which the metadata provides information
about the columns in the given table that match the simple regular
expression specified by the 'wild' parameter.  'wild' may contain the
wildcard characters '%' or '_', or may be a 'NULL' pointer to match all
fields.  Calling *note 'mysql_list_fields()': mysql-list-fields. is
similar to executing the query 'SHOW COLUMNS FROM TBL_NAME [LIKE WILD]'.

It is preferable to use 'SHOW COLUMNS FROM TBL_NAME' instead of *note
'mysql_list_fields()': mysql-list-fields.

You must free the result set with *note 'mysql_free_result()':
mysql-free-result.

*Return Values*

A 'MYSQL_RES' result set for success.  'NULL' if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.

*Example*

     int i;
     MYSQL_RES *tbl_cols = mysql_list_fields(mysql, "mytbl", "f%");

     unsigned int field_cnt = mysql_num_fields(tbl_cols);
     printf("Number of columns: %d\n", field_cnt);

     for (i=0; i < field_cnt; ++i)
     {
       /* col describes i-th column of the table */
       MYSQL_FIELD *col = mysql_fetch_field_direct(tbl_cols, i);
       printf ("Column %d: %s\n", i, col->name);
     }
     mysql_free_result(tbl_cols);


File: manual.info.tmp,  Node: mysql-list-processes,  Next: mysql-list-tables,  Prev: mysql-list-fields,  Up: c-api-functions

23.7.6.43 mysql_list_processes()
................................

'MYSQL_RES *mysql_list_processes(MYSQL *mysql)'

*Description*

Returns a result set describing the current server threads.  This is the
same kind of information as that reported by *note 'mysqladmin
processlist': mysqladmin. or a *note 'SHOW PROCESSLIST':
show-processlist. query.

You must free the result set with *note 'mysql_free_result()':
mysql-free-result.

*Return Values*

A 'MYSQL_RES' result set for success.  'NULL' if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-list-tables,  Next: mysql-more-results,  Prev: mysql-list-processes,  Up: c-api-functions

23.7.6.44 mysql_list_tables()
.............................

'MYSQL_RES *mysql_list_tables(MYSQL *mysql, const char *wild)'

*Description*

Returns a result set consisting of table names in the current database
that match the simple regular expression specified by the 'wild'
parameter.  'wild' may contain the wildcard characters '%' or '_', or
may be a 'NULL' pointer to match all tables.  Calling *note
'mysql_list_tables()': mysql-list-tables. is similar to executing the
query 'SHOW TABLES [LIKE WILD]'.

You must free the result set with *note 'mysql_free_result()':
mysql-free-result.

*Return Values*

A 'MYSQL_RES' result set for success.  'NULL' if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-more-results,  Next: mysql-next-result,  Prev: mysql-list-tables,  Up: c-api-functions

23.7.6.45 mysql_more_results()
..............................

'my_bool mysql_more_results(MYSQL *mysql)'

*Description*

This function is used when you execute multiple statements specified as
a single statement string, or when you execute *note 'CALL': call.
statements, which can return multiple result sets.

*note 'mysql_more_results()': mysql-more-results. true if more results
exist from the currently executed statement, in which case the
application must call *note 'mysql_next_result()': mysql-next-result. to
fetch the results.

*Return Values*

'TRUE' (1) if more results exist.  'FALSE' (0) if no more results exist.

In most cases, you can call *note 'mysql_next_result()':
mysql-next-result. instead to test whether more results exist and
initiate retrieval if so.

See *note c-api-multiple-queries::, and *note mysql-next-result::.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-next-result,  Next: mysql-num-fields,  Prev: mysql-more-results,  Up: c-api-functions

23.7.6.46 mysql_next_result()
.............................

'int mysql_next_result(MYSQL *mysql)'

*Description*

*note 'mysql_next_result()': mysql-next-result. is used when you execute
multiple statements specified as a single statement string, or when you
use *note 'CALL': call. statements to execute stored procedures, which
can return multiple result sets.

*note 'mysql_next_result()': mysql-next-result. reads the next statement
result and returns a status to indicate whether more results exist.  If
*note 'mysql_next_result()': mysql-next-result. returns an error, there
are no more results.

Before each call to *note 'mysql_next_result()': mysql-next-result, you
must call *note 'mysql_free_result()': mysql-free-result. for the
current statement if it is a statement that returned a result set
(rather than just a result status).

After calling *note 'mysql_next_result()': mysql-next-result. the state
of the connection is as if you had called *note 'mysql_real_query()':
mysql-real-query. or *note 'mysql_query()': mysql-query. for the next
statement.  This means that you can call *note 'mysql_store_result()':
mysql-store-result, *note 'mysql_warning_count()': mysql-warning-count,
*note 'mysql_affected_rows()': mysql-affected-rows, and so forth.

If your program uses *note 'CALL': call. statements to execute stored
procedures, the 'CLIENT_MULTI_RESULTS' flag must be enabled.  This is
because each *note 'CALL': call. returns a result to indicate the call
status, in addition to any result sets that might be returned by
statements executed within the procedure.  Because *note 'CALL': call.
can return multiple results, process them using a loop that calls *note
'mysql_next_result()': mysql-next-result. to determine whether there are
more results.

'CLIENT_MULTI_RESULTS' can be enabled when you call *note
'mysql_real_connect()': mysql-real-connect, either explicitly by passing
the 'CLIENT_MULTI_RESULTS' flag itself, or implicitly by passing
'CLIENT_MULTI_STATEMENTS' (which also enables 'CLIENT_MULTI_RESULTS').
'CLIENT_MULTI_RESULTS' is enabled by default.

It is also possible to test whether there are more results by calling
*note 'mysql_more_results()': mysql-more-results.  However, this
function does not change the connection state, so if it returns true,
you must still call *note 'mysql_next_result()': mysql-next-result. to
advance to the next result.

For an example that shows how to use *note 'mysql_next_result()':
mysql-next-result, see *note c-api-multiple-queries::.

*Return Values*

Return Value              Description
                          
0                         Successful and there are more results
                          
-1                        Successful and there are no more results
                          
>0                        An error occurred

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.  For example, if you
     did not call *note 'mysql_use_result()': mysql-use-result. for a
     previous result set.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-num-fields,  Next: mysql-num-rows,  Prev: mysql-next-result,  Up: c-api-functions

23.7.6.47 mysql_num_fields()
............................

'unsigned int mysql_num_fields(MYSQL_RES *result)'

To pass a 'MYSQL*' argument instead, use 'unsigned int
mysql_field_count(MYSQL *mysql)'.

*Description*

Returns the number of columns in a result set.

You can get the number of columns either from a pointer to a result set
or to a connection handler.  You would use the connection handler if
*note 'mysql_store_result()': mysql-store-result. or *note
'mysql_use_result()': mysql-use-result. returned 'NULL' (and thus you
have no result set pointer).  In this case, you can call *note
'mysql_field_count()': mysql-field-count. to determine whether *note
'mysql_store_result()': mysql-store-result. should have produced a
nonempty result.  This enables the client program to take proper action
without knowing whether the query was a *note 'SELECT': select. (or
*note 'SELECT': select.-like) statement.  The example shown here
illustrates how this may be done.

See *note null-mysql-store-result::.

*Return Values*

An unsigned integer representing the number of columns in a result set.

*Errors*

None.

*Example*

     MYSQL_RES *result;
     unsigned int num_fields;
     unsigned int num_rows;

     if (mysql_query(&mysql,query_string))
     {
         // error
     }
     else // query succeeded, process any data returned by it
     {
         result = mysql_store_result(&mysql);
         if (result)  // there are rows
         {
             num_fields = mysql_num_fields(result);
             // retrieve rows, then call mysql_free_result(result)
         }
         else  // mysql_store_result() returned nothing; should it have?
         {
             if (mysql_errno(&mysql))
             {
                fprintf(stderr, "Error: %s\n", mysql_error(&mysql));
             }
             else if (mysql_field_count(&mysql) == 0)
             {
                 // query does not return data
                 // (it was not a SELECT)
                 num_rows = mysql_affected_rows(&mysql);
             }
         }
     }

An alternative (if you know that your query should have returned a
result set) is to replace the *note 'mysql_errno(&mysql)': mysql-errno.
call with a check whether *note 'mysql_field_count(&mysql)':
mysql-field-count. returns 0.  This happens only if something went
wrong.


File: manual.info.tmp,  Node: mysql-num-rows,  Next: mysql-options,  Prev: mysql-num-fields,  Up: c-api-functions

23.7.6.48 mysql_num_rows()
..........................

'my_ulonglong mysql_num_rows(MYSQL_RES *result)'

*Description*

Returns the number of rows in the result set.

The use of *note 'mysql_num_rows()': mysql-num-rows. depends on whether
you use *note 'mysql_store_result()': mysql-store-result. or *note
'mysql_use_result()': mysql-use-result. to return the result set.  If
you use *note 'mysql_store_result()': mysql-store-result, *note
'mysql_num_rows()': mysql-num-rows. may be called immediately.  If you
use *note 'mysql_use_result()': mysql-use-result, *note
'mysql_num_rows()': mysql-num-rows. does not return the correct value
until all the rows in the result set have been retrieved.

*note 'mysql_num_rows()': mysql-num-rows. is intended for use with
statements that return a result set, such as *note 'SELECT': select.
For statements such as *note 'INSERT': insert, *note 'UPDATE': update,
or *note 'DELETE': delete, the number of affected rows can be obtained
with *note 'mysql_affected_rows()': mysql-affected-rows.

*Return Values*

The number of rows in the result set.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-options,  Next: mysql-ping,  Prev: mysql-num-rows,  Up: c-api-functions

23.7.6.49 mysql_options()
.........................

'int mysql_options(MYSQL *mysql, enum mysql_option option, const void
*arg)'

*Description*

Can be used to set extra connect options and affect behavior for a
connection.  This function may be called multiple times to set several
options.

Call *note 'mysql_options()': mysql-options. after *note 'mysql_init()':
mysql-init. and before *note 'mysql_connect()': mysql-connect. or *note
'mysql_real_connect()': mysql-real-connect.

The 'option' argument is the option that you want to set; the 'arg'
argument is the value for the option.  If the option is an integer,
specify a pointer to the value of the integer as the 'arg' argument.

Options for information such as SSL certificate and key files are used
to establish an encrypted connection if such connections are available,
but do not enforce any requirement that the connection obtained be
encrypted.  To require an encrypted connection, use the technique
described in *note c-api-encrypted-connections::.

The following list describes the possible options, their effect, and how
'arg' is used for each option.  For option descriptions that indicate
'arg' is unused, its value is irrelevant; it is conventional to pass 0.
Several of the options apply only when the application is linked against
the 'libmysqld' embedded server library and are unused for applications
linked against the 'libmysqlclient' client library.

   * 'MYSQL_DEFAULT_AUTH' (argument type: 'char *')

     The name of the authentication plugin to use.

   * 'MYSQL_ENABLE_CLEARTEXT_PLUGIN' (argument type: 'my_bool *')

     Enable the 'mysql_clear_password' cleartext authentication plugin.
     See *note cleartext-pluggable-authentication::.

   * 'MYSQL_INIT_COMMAND' (argument type: 'char *')

     SQL statement to execute when connecting to the MySQL server.
     Automatically re-executed if reconnection occurs.

   * 'MYSQL_OPT_COMPRESS' (argument: not used)

     Compress all information sent between the client and the server if
     possible.  See *note connection-compression-control::.

   * 'MYSQL_OPT_CONNECT_TIMEOUT' (argument type: 'unsigned int *')

     The connect timeout in seconds.

   * 'MYSQL_OPT_GUESS_CONNECTION' (argument: not used)

     For an application linked against the 'libmysqld' embedded server
     library, this option enables the library to guess whether to use
     the embedded server or a remote server.  'Guess' means that if the
     host name is set and is not 'localhost', it uses a remote server.
     This behavior is the default.  'MYSQL_OPT_USE_EMBEDDED_CONNECTION'
     and 'MYSQL_OPT_USE_REMOTE_CONNECTION' can be used to override it.
     This option is ignored for applications linked against the
     'libmysqlclient' client library.

   * 'MYSQL_OPT_LOCAL_INFILE' (argument type: optional pointer to
     'unsigned int')

     This option affects client-side 'LOCAL' capability for *note 'LOAD
     DATA': load-data. operations.  By default, 'LOCAL' capability is
     determined by the default compiled into the MySQL client library
     (see *note load-data::).  To control this capability explicitly,
     invoke *note 'mysql_options()': mysql-options. to set the
     'MYSQL_OPT_LOCAL_INFILE' option:

        * 'LOCAL' is disabled if the pointer points to an 'unsigned int'
          that has a zero value.

        * 'LOCAL' is enabled if no pointer is given or if the pointer
          points to an 'unsigned int' that has a nonzero value.

     Successful use of a 'LOCAL' load operation by a client also
     requires that the server permits it.

   * 'MYSQL_OPT_NAMED_PIPE' (argument: not used)

     Use a named pipe to connect to the MySQL server on Windows, if the
     server permits named-pipe connections.

   * 'MYSQL_OPT_PROTOCOL' (argument type: 'unsigned int *')

     Type of protocol to use.  Specify one of the enum values of
     'mysql_protocol_type' defined in 'mysql.h'.

   * 'MYSQL_OPT_READ_TIMEOUT' (argument type: 'unsigned int *')

     The timeout in seconds for each attempt to read from the server.
     There are retries if necessary, so the total effective timeout
     value is three times the option value.  You can set the value so
     that a lost connection can be detected earlier than the TCP/IP
     'Close_Wait_Timeout' value of 10 minutes.

     Implementation of this timeout uses mechanisms that may not be
     available on all platforms.  On such a platform, a client that
     issues a read call might under certain circumstances wait without
     timing out.  For example, a client might not time out if the server
     is not responding because it is waiting for a 'disk full' condition
     to clear.

   * 'MYSQL_OPT_RECONNECT' (argument type: 'my_bool *')

     Enable or disable automatic reconnection to the server if the
     connection is found to have been lost.  Reconnect is off by
     default; this option provides a way to set reconnection behavior
     explicitly.  See *note c-api-auto-reconnect::.

   * 'MYSQL_OPT_SSL_MODE' (argument type: 'unsigned int *')

     The security state to use for the connection to the server.  The
     only permitted arument value is 'SSL_MODE_REQUIRED' (require an
     encrypted connection).  If set, this option causes *note
     'mysql_real_connect()': mysql-real-connect. to fail if an encrypted
     connection cannot be obtained, without falling back to an
     unencrypted connection.  Thus, *note 'mysql_real_connect()':
     mysql-real-connect. returns an error if the server does not support
     SSL or the client is not configured to use SSL. For more
     information about the security states, see the description of
     '--ssl-mode' in *note encrypted-connection-options::.

     To require an encrypted connection in MySQL 5.5, the standard MySQL
     client programs call *note 'mysql_options()': mysql-options. to set
     'MYSQL_OPT_SSL_MODE' if the '--ssl-mode=REQUIRED' command-line
     option was specified.  Third-party applications that must be able
     to require encrypted connections can use the technique described in
     *note c-api-encrypted-connections::.

     This option was added in MySQL 5.5.55.

   * 'MYSQL_OPT_SSL_VERIFY_SERVER_CERT' (argument type: 'my_bool *')

     Enable or disable verification of the server's Common Name identity
     in its certificate against the host name used when connecting to
     the server.  The connection is rejected if there is a mismatch.
     For encrypted connections, this feature can be used to prevent
     man-in-the-middle attacks.  Identity verification is disabled by
     default.

   * 'MYSQL_OPT_USE_EMBEDDED_CONNECTION' (argument: not used)

     For an application linked against the 'libmysqld' embedded server
     library, this option forces the use of the embedded server for the
     connection.  It is ignored for applications linked against the
     'libmysqlclient' client library.

   * 'MYSQL_OPT_USE_REMOTE_CONNECTION' (argument: not used)

     For an application linked against the 'libmysqld' embedded server
     library, this option forces the use of a remote server for the
     connection.  It is ignored for applications linked against the
     'libmysqlclient' client library.

   * 'MYSQL_OPT_USE_RESULT' (argument: not used)

     This option is unused.

   * 'MYSQL_OPT_WRITE_TIMEOUT' (argument type: 'unsigned int *')

     The timeout in seconds for each attempt to write to the server.
     There is a retry if necessary, so the total effective timeout value
     is two times the option value.

   * 'MYSQL_PLUGIN_DIR' (argument type: 'char *')

     The directory in which to look for client plugins.

   * 'MYSQL_READ_DEFAULT_FILE' (argument type: 'char *')

     Read options from the named option file instead of from 'my.cnf'.

   * 'MYSQL_READ_DEFAULT_GROUP' (argument type: 'char *')

     Read options from the named group from 'my.cnf' or the file
     specified with 'MYSQL_READ_DEFAULT_FILE'.

   * 'MYSQL_REPORT_DATA_TRUNCATION' (argument type: 'my_bool *')

     Enable or disable reporting of data truncation errors for prepared
     statements using the 'error' member of 'MYSQL_BIND' structures.
     (Default: enabled.)

   * 'MYSQL_SECURE_AUTH' (argument type: 'my_bool *')

     Whether to connect to a server that does not support the password
     hashing used in MySQL 4.1.1 and later.

   * 'MYSQL_SET_CHARSET_DIR' (argument type: 'char *')

     The path name of the directory that contains character set
     definition files.

   * 'MYSQL_SET_CHARSET_NAME' (argument type: 'char *')

     The name of the character set to use as the default character set.
     The argument can be 'MYSQL_AUTODETECT_CHARSET_NAME' to cause the
     character set to be autodetected based on the operating system
     setting (see *note charset-connection::).

   * 'MYSQL_SET_CLIENT_IP' (argument type: 'char *')

     For an application linked against the 'libmysqld' embedded server
     library (when 'libmysqld' is compiled with authentication support),
     this option means that the user is considered to have connected
     from the specified IP address (specified as a string) for
     authentication purposes.  It is ignored for applications linked
     against the 'libmysqlclient' client library.

   * 'MYSQL_SHARED_MEMORY_BASE_NAME' (argument type: 'char *')

     The name of the shared-memory object for communication to the
     server on Windows, if the server supports shared-memory
     connections.  Specify the same value as used for the
     'shared_memory_base_name' system variable.  of the *note 'mysqld':
     mysqld. server you want to connect to.

The 'client' group is always read if you use 'MYSQL_READ_DEFAULT_FILE'
or 'MYSQL_READ_DEFAULT_GROUP'.

The specified group in the option file may contain the following
options.

Option                    Description
                          
'character-sets-dir=DIR_NAME'The directory where character sets are
                          installed.
                          
'compress'                Use the compressed client/server protocol.
                          
'connect-timeout=SECONDS' The connect timeout in seconds.  On Linux
                          this timeout is also used for waiting for the
                          first answer from the server.
                          
'database=DB_NAME'        Connect to this database if no database was
                          specified in the connect command.
                          
'debug'                   Debug options.
                          
'default-character-set=CHARSET_NAME'The default character set to use.
                          
'disable-local-infile'    Disable use of
                          *note 'LOAD DATA LOCAL': load-data.
                          
'enable-cleartext-plugin' Enable the 'mysql_clear_password' cleartext
                          authentication plugin.  Added in MySQL
                          5.5.27.
                          
'host=HOST_NAME'          Default host name.
                          
'init-command=STMT'       Statement to execute when connecting to MySQL
                          server.  Automatically re-executed if
                          reconnection occurs.
                          
'interactive-timeout=SECONDS'Same as specifying 'CLIENT_INTERACTIVE' to
                          *note 'mysql_real_connect()': mysql-real-connect.
                          See *note mysql-real-connect::.
                          
'local-infile[={0|1}]'    If no argument or nonzero argument, enable
                          use of *note 'LOAD DATA LOCAL': load-data.;
                          otherwise disable.
                          
'max_allowed_packet=BYTES'Maximum size of packet that client can read
                          from server.
                          
'multi-queries',          Enable multiple result sets from
'multi-results'           multiple-statement executions or stored
                          procedures.
                          
'multi-statements'        Enable the client to send multiple statements
                          in a single string (separated by ';'
                          characters).
                          
'password=PASSWORD'       Default password.
                          
'pipe'                    Use named pipes to connect to a MySQL server
                          on Windows.
                          
'port=PORT_NUM'           Default port number.
                          
'protocol={TCP|SOCKET|PIPE|MEMORY}'The protocol to use when connecting to the
                          server.
                          
'return-found-rows'       Tell *note 'mysql_info()': mysql-info. to
                          return found rows instead of updated rows
                          when using *note 'UPDATE': update.
                          
'shared-memory-base-name=NAME'Shared-memory name to use to connect to
                          server.
                          
'socket={FILE_NAME|PIPE_NAME}'Default socket file.
                          
'ssl-ca=FILE_NAME'        Certificate Authority file.
                          
'ssl-capath=DIR_NAME'     Certificate Authority directory.
                          
'ssl-cert=FILE_NAME'      Certificate file.
                          
'ssl-cipher=CIPHER_LIST'  Permissible SSL ciphers.
                          
'ssl-key=FILE_NAME'       Key file.
                          
'timeout=SECONDS'         Like 'connect-timeout'.
                          
'user'                    Default user.

'timeout' has been replaced by 'connect-timeout', but 'timeout' is still
supported for backward compatibility.

For more information about option files used by MySQL programs, see
*note option-files::.

*Return Values*

Zero for success.  Nonzero if you specify an unknown option.

*Example*

The following *note 'mysql_options()': mysql-options. calls request the
use of compression in the client/server protocol, cause options to be
read from the '[odbc]' group in option files, and disable transaction
autocommit mode:

     MYSQL mysql;

     mysql_init(&mysql);
     mysql_options(&mysql,MYSQL_OPT_COMPRESS,0);
     mysql_options(&mysql,MYSQL_READ_DEFAULT_GROUP,"odbc");
     mysql_options(&mysql,MYSQL_INIT_COMMAND,"SET autocommit=0");
     if (!mysql_real_connect(&mysql,"host","user","passwd","database",0,NULL,0))
     {
         fprintf(stderr, "Failed to connect to database: Error: %s\n",
               mysql_error(&mysql));
     }


File: manual.info.tmp,  Node: mysql-ping,  Next: mysql-query,  Prev: mysql-options,  Up: c-api-functions

23.7.6.50 mysql_ping()
......................

'int mysql_ping(MYSQL *mysql)'

*Description*

Checks whether the connection to the server is working.  If the
connection has gone down and auto-reconnect is enabled an attempt to
reconnect is made.  If the connection is down and auto-reconnect is
disabled, *note 'mysql_ping()': mysql-ping. returns an error.

Auto-reconnect is disabled by default.  To enable it, call *note
'mysql_options()': mysql-options. with the 'MYSQL_OPT_RECONNECT' option.
For details, see *note mysql-options::.

*note 'mysql_ping()': mysql-ping. can be used by clients that remain
idle for a long while, to check whether the server has closed the
connection and reconnect if necessary.

If *note 'mysql_ping()': mysql-ping.) does cause a reconnect, there is
no explicit indication of it.  To determine whether a reconnect occurs,
call *note 'mysql_thread_id()': mysql-thread-id. to get the original
connection identifier before calling *note 'mysql_ping()': mysql-ping,
then call *note 'mysql_thread_id()': mysql-thread-id. again to see
whether the identifier has changed.

If reconnect occurs, some characteristics of the connection will have
been reset.  For details about these characteristics, see *note
c-api-auto-reconnect::.

*Return Values*

Zero if the connection to the server is active.  Nonzero if an error
occurred.  A nonzero return does not indicate whether the MySQL server
itself is down; the connection might be broken for other reasons such as
network problems.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-query,  Next: mysql-real-connect,  Prev: mysql-ping,  Up: c-api-functions

23.7.6.51 mysql_query()
.......................

'int mysql_query(MYSQL *mysql, const char *stmt_str)'

*Description*

Executes the SQL statement pointed to by the null-terminated string
'stmt_str'.  Normally, the string must consist of a single SQL statement
without a terminating semicolon (';') or '\g'.  If multiple-statement
execution has been enabled, the string can contain several statements
separated by semicolons.  See *note c-api-multiple-queries::.

*note 'mysql_query()': mysql-query. cannot be used for statements that
contain binary data; you must use *note 'mysql_real_query()':
mysql-real-query. instead.  (Binary data may contain the '\0' character,
which *note 'mysql_query()': mysql-query. interprets as the end of the
statement string.)

If you want to know whether the statement should return a result set,
you can use *note 'mysql_field_count()': mysql-field-count. to check for
this.  See *note mysql-field-count::.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-real-connect,  Next: mysql-real-escape-string,  Prev: mysql-query,  Up: c-api-functions

23.7.6.52 mysql_real_connect()
..............................

'MYSQL *mysql_real_connect(MYSQL *mysql, const char *host, const char
*user, const char *passwd, const char *db, unsigned int port, const char
*unix_socket, unsigned long client_flag)'

*Description*

*note 'mysql_real_connect()': mysql-real-connect. attempts to establish
a connection to a MySQL database engine running on 'host'.  *note
'mysql_real_connect()': mysql-real-connect. must complete successfully
before you can execute any other API functions that require a valid
'MYSQL' connection handler structure.

The parameters are specified as follows:

   * For the first parameter, specify the address of an existing 'MYSQL'
     structure.  Before calling *note 'mysql_real_connect()':
     mysql-real-connect, call *note 'mysql_init()': mysql-init. to
     initialize the 'MYSQL' structure.  You can change a lot of connect
     options with the *note 'mysql_options()': mysql-options. call.  See
     *note mysql-options::.

   * The value of 'host' may be either a host name or an IP address.
     The client attempts to connect as follows:

        * If 'host' is 'NULL' or the string '"localhost"', a connection
          to the local host is assumed:

             * On Windows, the client connects using a shared-memory
               connection, if the server has shared-memory connections
               enabled.

             * On Unix, the client connects using a Unix socket file.
               The 'unix_socket' parameter or the 'MYSQL_UNIX_PORT'
               environment variable may be used to specify the socket
               name.

        * On Windows, if 'host' is '"."', or TCP/IP is not enabled and
          no 'unix_socket' is specified or the host is empty, the client
          connects using a named pipe, if the server has named-pipe
          connections enabled.  If named-pipe connections are not
          enabled, an error occurs.

        * Otherwise, TCP/IP is used.

     You can also influence the type of connection to use with the
     'MYSQL_OPT_PROTOCOL' or 'MYSQL_OPT_NAMED_PIPE' options to *note
     'mysql_options()': mysql-options.  The type of connection must be
     supported by the server.

   * The 'user' parameter contains the user's MySQL login ID. If 'user'
     is 'NULL' or the empty string '""', the current user is assumed.
     Under Unix, this is the current login name.  Under Windows ODBC,
     the current user name must be specified explicitly.  See the
     Connector/ODBC section of *note connectors-apis::.

   * The 'passwd' parameter contains the password for 'user'.  If
     'passwd' is 'NULL', only entries in the 'user' table for the user
     that have a blank (empty) password field are checked for a match.
     This enables the database administrator to set up the MySQL
     privilege system in such a way that users get different privileges
     depending on whether they have specified a password.

     *Note*:

     Do not attempt to encrypt the password before calling *note
     'mysql_real_connect()': mysql-real-connect.; password encryption is
     handled automatically by the client API.

   * The 'user' and 'passwd' parameters use whatever character set has
     been configured for the 'MYSQL' object.  By default, this is
     'latin1', but can be changed by calling *note 'mysql_options(mysql,
     MYSQL_SET_CHARSET_NAME, "CHARSET_NAME")': mysql-options. prior to
     connecting.

   * 'db' is the database name.  If 'db' is not 'NULL', the connection
     sets the default database to this value.

   * If 'port' is not 0, the value is used as the port number for the
     TCP/IP connection.  Note that the 'host' parameter determines the
     type of the connection.

   * If 'unix_socket' is not 'NULL', the string specifies the socket or
     named pipe to use.  Note that the 'host' parameter determines the
     type of the connection.

   * The value of 'client_flag' is usually 0, but can be set to a
     combination of the following flags to enable certain features:

        * 'CLIENT_COMPRESS': Use compression in the client/server
          protocol.

        * 'CLIENT_FOUND_ROWS': Return the number of found (matched)
          rows, not the number of changed rows.

        * 'CLIENT_IGNORE_SIGPIPE': Prevents the client library from
          installing a 'SIGPIPE' signal handler.  This can be used to
          avoid conflicts with a handler that the application has
          already installed.

        * 'CLIENT_IGNORE_SPACE': Permit spaces after function names.
          Makes all functions names reserved words.

        * 'CLIENT_INTERACTIVE': Permit 'interactive_timeout' seconds of
          inactivity (rather than 'wait_timeout' seconds) before closing
          the connection.  The client's session 'wait_timeout' variable
          is set to the value of the session 'interactive_timeout'
          variable.

        * 'CLIENT_LOCAL_FILES': Enable *note 'LOAD DATA LOCAL':
          load-data. handling.

        * 'CLIENT_MULTI_RESULTS': Tell the server that the client can
          handle multiple result sets from multiple-statement executions
          or stored procedures.  This flag is automatically enabled if
          'CLIENT_MULTI_STATEMENTS' is enabled.  See the note following
          this table for more information about this flag.

        * 'CLIENT_MULTI_STATEMENTS': Tell the server that the client may
          send multiple statements in a single string (separated by ';'
          characters).  If this flag is not set, multiple-statement
          execution is disabled.  See the note following this table for
          more information about this flag.

        * 'CLIENT_NO_SCHEMA' Do not permit DB_NAME.TBL_NAME.COL_NAME
          syntax.  This is for ODBC. It causes the parser to generate an
          error if you use that syntax, which is useful for trapping
          bugs in some ODBC programs.

        * 'CLIENT_ODBC': Unused.

        * 'CLIENT_SSL': Use SSL (encrypted protocol).  Do not set this
          option within an application program; it is set internally in
          the client library.  Instead, use *note 'mysql_options()':
          mysql-options. or *note 'mysql_ssl_set()': mysql-ssl-set.
          before calling *note 'mysql_real_connect()':
          mysql-real-connect.

        * 'CLIENT_REMEMBER_OPTIONS' Remember options specified by calls
          to *note 'mysql_options()': mysql-options.  Without this
          option, if *note 'mysql_real_connect()': mysql-real-connect.
          fails, you must repeat the *note 'mysql_options()':
          mysql-options. calls before trying to connect again.  With
          this option, the *note 'mysql_options()': mysql-options. calls
          need not be repeated.

If your program uses *note 'CALL': call. statements to execute stored
procedures, the 'CLIENT_MULTI_RESULTS' flag must be enabled.  This is
because each *note 'CALL': call. returns a result to indicate the call
status, in addition to any result sets that might be returned by
statements executed within the procedure.  Because *note 'CALL': call.
can return multiple results, process them using a loop that calls *note
'mysql_next_result()': mysql-next-result. to determine whether there are
more results.

'CLIENT_MULTI_RESULTS' can be enabled when you call *note
'mysql_real_connect()': mysql-real-connect, either explicitly by passing
the 'CLIENT_MULTI_RESULTS' flag itself, or implicitly by passing
'CLIENT_MULTI_STATEMENTS' (which also enables 'CLIENT_MULTI_RESULTS').
'CLIENT_MULTI_RESULTS' is enabled by default.

If you enable 'CLIENT_MULTI_STATEMENTS' or 'CLIENT_MULTI_RESULTS', you
should process the result for every call to *note 'mysql_query()':
mysql-query. or *note 'mysql_real_query()': mysql-real-query. by using a
loop that calls *note 'mysql_next_result()': mysql-next-result. to
determine whether there are more results.  For an example, see *note
c-api-multiple-queries::.

For some parameters, it is possible to have the value taken from an
option file rather than from an explicit value in the *note
'mysql_real_connect()': mysql-real-connect. call.  To do this, call
*note 'mysql_options()': mysql-options. with the
'MYSQL_READ_DEFAULT_FILE' or 'MYSQL_READ_DEFAULT_GROUP' option before
calling *note 'mysql_real_connect()': mysql-real-connect.  Then, in the
*note 'mysql_real_connect()': mysql-real-connect. call, specify the
'no-value' value for each parameter to be read from an option file:

   * For 'host', specify a value of 'NULL' or the empty string ('""').

   * For 'user', specify a value of 'NULL' or the empty string.

   * For 'passwd', specify a value of 'NULL'.  (For the password, a
     value of the empty string in the *note 'mysql_real_connect()':
     mysql-real-connect. call cannot be overridden in an option file,
     because the empty string indicates explicitly that the MySQL
     account must have an empty password.)

   * For 'db', specify a value of 'NULL' or the empty string.

   * For 'port', specify a value of 0.

   * For 'unix_socket', specify a value of 'NULL'.

If no value is found in an option file for a parameter, its default
value is used as indicated in the descriptions given earlier in this
section.

*Return Values*

A 'MYSQL*' connection handler if the connection was successful, 'NULL'
if the connection was unsuccessful.  For a successful connection, the
return value is the same as the value of the first parameter.

*Errors*

   * 'CR_CONN_HOST_ERROR'

     Failed to connect to the MySQL server.

   * 'CR_CONNECTION_ERROR'

     Failed to connect to the local MySQL server.

   * 'CR_IPSOCK_ERROR'

     Failed to create an IP socket.

   * 'CR_OUT_OF_MEMORY'

     Out of memory.

   * 'CR_SOCKET_CREATE_ERROR'

     Failed to create a Unix socket.

   * 'CR_UNKNOWN_HOST'

     Failed to find the IP address for the host name.

   * 'CR_VERSION_ERROR'

     A protocol mismatch resulted from attempting to connect to a server
     with a client library that uses a different protocol version.

   * 'CR_NAMEDPIPEOPEN_ERROR'

     Failed to create a named pipe on Windows.

   * 'CR_NAMEDPIPEWAIT_ERROR'

     Failed to wait for a named pipe on Windows.

   * 'CR_NAMEDPIPESETSTATE_ERROR'

     Failed to get a pipe handler on Windows.

   * 'CR_SERVER_LOST'

     If 'connect_timeout' > 0 and it took longer than 'connect_timeout'
     seconds to connect to the server or if the server died while
     executing the 'init-command'.

   * 'CR_ALREADY_CONNECTED'

     The 'MYSQL' connection handler is already connected.

*Example*

     MYSQL mysql;

     mysql_init(&mysql);
     mysql_options(&mysql,MYSQL_READ_DEFAULT_GROUP,"your_prog_name");
     if (!mysql_real_connect(&mysql,"host","user","passwd","database",0,NULL,0))
     {
         fprintf(stderr, "Failed to connect to database: Error: %s\n",
               mysql_error(&mysql));
     }

By using *note 'mysql_options()': mysql-options. the MySQL client
library reads the '[client]' and '[your_prog_name]' sections in the
'my.cnf' file which ensures that your program works, even if someone has
set up MySQL in some nonstandard way.

Upon connection, *note 'mysql_real_connect()': mysql-real-connect. sets
the 'reconnect' flag (part of the 'MYSQL' structure) to a value of '1'
in versions of the API older than 5.0.3, or '0' in newer versions.  A
value of '1' for this flag indicates that if a statement cannot be
performed because of a lost connection, to try reconnecting to the
server before giving up.  You can use the 'MYSQL_OPT_RECONNECT' option
to *note 'mysql_options()': mysql-options. to control reconnection
behavior.


File: manual.info.tmp,  Node: mysql-real-escape-string,  Next: mysql-real-query,  Prev: mysql-real-connect,  Up: c-api-functions

23.7.6.53 mysql_real_escape_string()
....................................

'unsigned long mysql_real_escape_string(MYSQL *mysql, char *to, const
char *from, unsigned long length)'

*Description*

This function creates a legal SQL string for use in an SQL statement.
See *note string-literals::.

The 'mysql' argument must be a valid, open connection because character
escaping depends on the character set in use by the server.

The string in the 'from' argument is encoded to produce an escaped SQL
string, taking into account the current character set of the connection.
The result is placed in the 'to' argument, followed by a terminating
null byte.

Characters encoded are '\', ''', '"', 'NUL' (ASCII 0), '\n', '\r', and
Control+Z. Strictly speaking, MySQL requires only that backslash and the
quote character used to quote the string in the query be escaped.  *note
'mysql_real_escape_string()': mysql-real-escape-string. quotes the other
characters to make them easier to read in log files.  For comparison,
see the quoting rules for literal strings and the 'QUOTE()' SQL function
in *note string-literals::, and *note string-functions::.

The string pointed to by 'from' must be 'length' bytes long.  You must
allocate the 'to' buffer to be at least 'length*2+1' bytes long.  (In
the worst case, each character may need to be encoded as using two
bytes, and there must be room for the terminating null byte.)  When
*note 'mysql_real_escape_string()': mysql-real-escape-string. returns,
the contents of 'to' is a null-terminated string.  The return value is
the length of the encoded string, not including the terminating null
byte.

If you must change the character set of the connection, use the *note
'mysql_set_character_set()': mysql-set-character-set. function rather
than executing a *note 'SET NAMES': set-names. (or *note 'SET CHARACTER
SET': set-character-set.) statement.  *note 'mysql_set_character_set()':
mysql-set-character-set. works like *note 'SET NAMES': set-names. but
also affects the character set used by *note
'mysql_real_escape_string()': mysql-real-escape-string, which *note 'SET
NAMES': set-names. does not.

*Example*

The following example inserts two escaped strings into an 'INSERT'
statement, each within single quote characters:

     char query[1000],*end;

     end = strmov(query,"INSERT INTO test_table VALUES(");
     *end++ = '\'';
     end += mysql_real_escape_string(&mysql,end,"What is this",12);
     *end++ = '\'';
     *end++ = ',';
     *end++ = '\'';
     end += mysql_real_escape_string(&mysql,end,"binary data: \0\r\n",16);
     *end++ = '\'';
     *end++ = ')';

     if (mysql_real_query(&mysql,query,(unsigned int) (end - query)))
     {
        fprintf(stderr, "Failed to insert row, Error: %s\n",
                mysql_error(&mysql));
     }

The 'strmov()' function used in the example is included in the
'libmysqlclient' library and works like 'strcpy()' but returns a pointer
to the terminating null of the first parameter.

*Return Values*

The length of the encoded string that is placed into the 'to' argument,
not including the terminating null character.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-real-query,  Next: mysql-refresh,  Prev: mysql-real-escape-string,  Up: c-api-functions

23.7.6.54 mysql_real_query()
............................

'int mysql_real_query(MYSQL *mysql, const char *stmt_str, unsigned long
length)'

*Description*

*note 'mysql_real_query()': mysql-real-query. executes the SQL statement
pointed to by 'stmt_str', a string 'length' bytes long.  Normally, the
string must consist of a single SQL statement without a terminating
semicolon (';') or '\g'.  If multiple-statement execution has been
enabled, the string can contain several statements separated by
semicolons.  See *note c-api-multiple-queries::.

*note 'mysql_query()': mysql-query. cannot be used for statements that
contain binary data; you must use *note 'mysql_real_query()':
mysql-real-query. instead.  (Binary data may contain the '\0' character,
which *note 'mysql_query()': mysql-query. interprets as the end of the
statement string.)  In addition, *note 'mysql_real_query()':
mysql-real-query. is faster than *note 'mysql_query()': mysql-query.
because it does not call 'strlen()' on the statement string.

If you want to know whether the statement should return a result set,
you can use *note 'mysql_field_count()': mysql-field-count. to check for
this.  See *note mysql-field-count::.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-refresh,  Next: mysql-reload,  Prev: mysql-real-query,  Up: c-api-functions

23.7.6.55 mysql_refresh()
.........................

'int mysql_refresh(MYSQL *mysql, unsigned int options)'

*Description*

This function flushes tables or caches, or resets replication server
information.  The connected user must have the 'RELOAD' privilege.

The 'options' argument is a bitmask composed from any combination of the
following values.  Multiple values can be OR'ed together to perform
multiple operations with a single call.

   * 'REFRESH_GRANT'

     Refresh the grant tables, like 'FLUSH PRIVILEGES'.

   * 'REFRESH_LOG'

     Flush the logs, like 'FLUSH LOGS'.

   * 'REFRESH_TABLES'

     Flush the table cache, like 'FLUSH TABLES'.

   * 'REFRESH_HOSTS'

     Flush the host cache, like 'FLUSH HOSTS'.

   * 'REFRESH_STATUS'

     Reset status variables, like 'FLUSH STATUS'.

   * 'REFRESH_THREADS'

     Flush the thread cache.

   * 'REFRESH_SLAVE'

     On a slave replication server, reset the master server information
     and restart the slave, like *note 'RESET SLAVE': reset-slave.

   * 'REFRESH_MASTER'

     On a master replication server, remove the binary log files listed
     in the binary log index and truncate the index file, like *note
     'RESET MASTER': reset-master.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-reload,  Next: mysql-rollback,  Prev: mysql-refresh,  Up: c-api-functions

23.7.6.56 mysql_reload()
........................

'int mysql_reload(MYSQL *mysql)'

*Description*

Asks the MySQL server to reload the grant tables.  The connected user
must have the 'RELOAD' privilege.

This function is deprecated.  Use *note 'mysql_query()': mysql-query. to
issue an SQL 'FLUSH PRIVILEGES' statement instead.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-rollback,  Next: mysql-row-seek,  Prev: mysql-reload,  Up: c-api-functions

23.7.6.57 mysql_rollback()
..........................

'my_bool mysql_rollback(MYSQL *mysql)'

*Description*

Rolls back the current transaction.

The action of this function is subject to the value of the
'completion_type' system variable.  In particular, if the value of
'completion_type' is 'RELEASE' (or 2), the server performs a release
after terminating a transaction and closes the client connection.  Call
*note 'mysql_close()': mysql-close. from the client program to close the
connection from the client side.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-row-seek,  Next: mysql-row-tell,  Prev: mysql-rollback,  Up: c-api-functions

23.7.6.58 mysql_row_seek()
..........................

'MYSQL_ROW_OFFSET mysql_row_seek(MYSQL_RES *result, MYSQL_ROW_OFFSET
offset)'

*Description*

Sets the row cursor to an arbitrary row in a query result set.  The
'offset' value is a row offset, typically a value returned from *note
'mysql_row_tell()': mysql-row-tell. or from *note 'mysql_row_seek()':
mysql-row-seek.  This value is not a row number; to seek to a row within
a result set by number, use *note 'mysql_data_seek()': mysql-data-seek.
instead.

This function requires that the result set structure contains the entire
result of the query, so *note 'mysql_row_seek()': mysql-row-seek. may be
used only in conjunction with *note 'mysql_store_result()':
mysql-store-result, not with *note 'mysql_use_result()':
mysql-use-result.

*Return Values*

The previous value of the row cursor.  This value may be passed to a
subsequent call to *note 'mysql_row_seek()': mysql-row-seek.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-row-tell,  Next: mysql-select-db,  Prev: mysql-row-seek,  Up: c-api-functions

23.7.6.59 mysql_row_tell()
..........................

'MYSQL_ROW_OFFSET mysql_row_tell(MYSQL_RES *result)'

*Description*

Returns the current position of the row cursor for the last *note
'mysql_fetch_row()': mysql-fetch-row.  This value can be used as an
argument to *note 'mysql_row_seek()': mysql-row-seek.

Use *note 'mysql_row_tell()': mysql-row-tell. only after *note
'mysql_store_result()': mysql-store-result, not after *note
'mysql_use_result()': mysql-use-result.

*Return Values*

The current offset of the row cursor.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-select-db,  Next: mysql-set-character-set,  Prev: mysql-row-tell,  Up: c-api-functions

23.7.6.60 mysql_select_db()
...........................

'int mysql_select_db(MYSQL *mysql, const char *db)'

*Description*

Causes the database specified by 'db' to become the default (current)
database on the connection specified by 'mysql'.  In subsequent queries,
this database is the default for table references that include no
explicit database specifier.

*note 'mysql_select_db()': mysql-select-db. fails unless the connected
user can be authenticated as having permission to use the database or
some object within it.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-set-character-set,  Next: mysql-set-local-infile-default,  Prev: mysql-select-db,  Up: c-api-functions

23.7.6.61 mysql_set_character_set()
...................................

'int mysql_set_character_set(MYSQL *mysql, const char *csname)'

*Description*

This function is used to set the default character set for the current
connection.  The string 'csname' specifies a valid character set name.
The connection collation becomes the default collation of the character
set.  This function works like the *note 'SET NAMES': set-names.
statement, but also sets the value of 'mysql->charset', and thus affects
the character set used by *note 'mysql_real_escape_string()':
mysql-real-escape-string.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Example*

     MYSQL mysql;

     mysql_init(&mysql);
     if (!mysql_real_connect(&mysql,"host","user","passwd","database",0,NULL,0))
     {
         fprintf(stderr, "Failed to connect to database: Error: %s\n",
               mysql_error(&mysql));
     }

     if (!mysql_set_character_set(&mysql, "utf8"))
     {
         printf("New client character set: %s\n",
                mysql_character_set_name(&mysql));
     }


File: manual.info.tmp,  Node: mysql-set-local-infile-default,  Next: mysql-set-local-infile-handler,  Prev: mysql-set-character-set,  Up: c-api-functions

23.7.6.62 mysql_set_local_infile_default()
..........................................

'void mysql_set_local_infile_default(MYSQL *mysql);'

*Description*

Sets the *note 'LOAD DATA LOCAL': load-data. callback functions to the
defaults used internally by the C client library.  The library calls
this function automatically if *note 'mysql_set_local_infile_handler()':
mysql-set-local-infile-handler. has not been called or does not supply
valid functions for each of its callbacks.

*Return Values*

None.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-set-local-infile-handler,  Next: mysql-set-server-option,  Prev: mysql-set-local-infile-default,  Up: c-api-functions

23.7.6.63 mysql_set_local_infile_handler()
..........................................

'void mysql_set_local_infile_handler(MYSQL *mysql, int
(*local_infile_init)(void **, const char *, void *), int
(*local_infile_read)(void *, char *, unsigned int), void
(*local_infile_end)(void *), int (*local_infile_error)(void *, char*,
unsigned int), void *userdata);'

*Description*

This function installs callbacks to be used during the execution of
*note 'LOAD DATA LOCAL': load-data. statements.  It enables application
programs to exert control over local (client-side) data file reading.
The arguments are the connection handler, a set of pointers to callback
functions, and a pointer to a data area that the callbacks can use to
share information.

To use *note 'mysql_set_local_infile_handler()':
mysql-set-local-infile-handler, you must write the following callback
functions:

     int
     local_infile_init(void **ptr, const char *filename, void *userdata);

The initialization function.  This is called once to do any setup
necessary, open the data file, allocate data structures, and so forth.
The first 'void**' argument is a pointer to a pointer.  You can set the
pointer (that is, '*ptr') to a value that will be passed to each of the
other callbacks (as a 'void*').  The callbacks can use this pointed-to
value to maintain state information.  The 'userdata' argument is the
same value that is passed to *note 'mysql_set_local_infile_handler()':
mysql-set-local-infile-handler.

The initialization function should return zero for success, nonzero for
an error.

     int
     local_infile_read(void *ptr, char *buf, unsigned int buf_len);

The data-reading function.  This is called repeatedly to read the data
file.  'buf' points to the buffer where the read data is stored, and
'buf_len' is the maximum number of bytes that the callback can read and
store in the buffer.  (It can read fewer bytes, but should not read
more.)

The return value is the number of bytes read, or zero when no more data
could be read (this indicates EOF). Return a value less than zero if an
error occurs.

     void
     local_infile_end(void *ptr)

The termination function.  This is called once after
'local_infile_read()' has returned zero (EOF) or an error.  Within this
function, deallocate any memory allocated by 'local_infile_init()' and
perform any other cleanup necessary.  It is invoked even if the
initialization function returns an error.

     int
     local_infile_error(void *ptr,
                        char *error_msg,
                        unsigned int error_msg_len);

The error-handling function.  This is called to get a textual error
message to return to the user in case any of your other functions
returns an error.  'error_msg' points to the buffer into which the
message is written, and 'error_msg_len' is the length of the buffer.
Write the message as a null-terminated string, at most
'error_msg_len'1 bytes long.

The return value is the error number.

Typically, the other callbacks store the error message in the data
structure pointed to by 'ptr', so that 'local_infile_error()' can copy
the message from there into 'error_msg'.

After calling *note 'mysql_set_local_infile_handler()':
mysql-set-local-infile-handler. in your C code and passing pointers to
your callback functions, you can then issue a *note 'LOAD DATA LOCAL':
load-data. statement (for example, by using *note 'mysql_query()':
mysql-query.).  The client library automatically invokes your callbacks.
The file name specified in *note 'LOAD DATA LOCAL': load-data. will be
passed as the second parameter to the 'local_infile_init()' callback.

*Return Values*

None.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-set-server-option,  Next: mysql-shutdown,  Prev: mysql-set-local-infile-handler,  Up: c-api-functions

23.7.6.64 mysql_set_server_option()
...................................

'int mysql_set_server_option(MYSQL *mysql, enum enum_mysql_set_option
option)'

*Description*

Enables or disables an option for the connection.  'option' can have one
of the following values.

Option                               Description
                                     
'MYSQL_OPTION_MULTI_STATEMENTS_ON'   Enable multiple-statement support
                                     
'MYSQL_OPTION_MULTI_STATEMENTS_OFF'  Disable multiple-statement support

If you enable multiple-statement support, you should retrieve results
from calls to *note 'mysql_query()': mysql-query. or *note
'mysql_real_query()': mysql-real-query. by using a loop that calls *note
'mysql_next_result()': mysql-next-result. to determine whether there are
more results.  For an example, see *note c-api-multiple-queries::.

Enabling multiple-statement support with
'MYSQL_OPTION_MULTI_STATEMENTS_ON' does not have quite the same effect
as enabling it by passing the 'CLIENT_MULTI_STATEMENTS' flag to *note
'mysql_real_connect()': mysql-real-connect.: 'CLIENT_MULTI_STATEMENTS'
also enables 'CLIENT_MULTI_RESULTS'.  If you are using the *note 'CALL':
call. SQL statement in your programs, multiple-result support must be
enabled; this means that 'MYSQL_OPTION_MULTI_STATEMENTS_ON' by itself is
insufficient to permit the use of *note 'CALL': call.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'ER_UNKNOWN_COM_ERROR'

     The server did not support *note 'mysql_set_server_option()':
     mysql-set-server-option. (which is the case that the server is
     older than 4.1.1) or the server did not support the option one
     tried to set.


File: manual.info.tmp,  Node: mysql-shutdown,  Next: mysql-sqlstate,  Prev: mysql-set-server-option,  Up: c-api-functions

23.7.6.65 mysql_shutdown()
..........................

'int mysql_shutdown(MYSQL *mysql, enum mysql_enum_shutdown_level
shutdown_level)'

*Description*

Asks the database server to shut down.  The connected user must have the
'SHUTDOWN' privilege.  MySQL servers support only one type of shutdown;
'shutdown_level' must be equal to 'SHUTDOWN_DEFAULT'.  Dynamically
linked executables that have been compiled with older versions of the
'libmysqlclient' headers and call *note 'mysql_shutdown()':
mysql-shutdown. must be used with the old 'libmysqlclient' dynamic
library.

The shutdown process is described in *note server-shutdown::.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-sqlstate,  Next: mysql-ssl-set,  Prev: mysql-shutdown,  Up: c-api-functions

23.7.6.66 mysql_sqlstate()
..........................

'const char *mysql_sqlstate(MYSQL *mysql)'

*Description*

Returns a null-terminated string containing the SQLSTATE error code for
the most recently executed SQL statement.  The error code consists of
five characters.  ''00000'' means 'no error.' The values are specified
by ANSI SQL and ODBC. For a list of possible values, see *note
error-handling::.

SQLSTATE values returned by *note 'mysql_sqlstate()': mysql-sqlstate.
differ from MySQL-specific error numbers returned by *note
'mysql_errno()': mysql-errno.  For example, the *note 'mysql': mysql.
client program displays errors using the following format, where '1146'
is the *note 'mysql_errno()': mysql-errno. value and ''42S02'' is the
corresponding *note 'mysql_sqlstate()': mysql-sqlstate. value:

     shell> SELECT * FROM no_such_table;
     ERROR 1146 (42S02): Table 'test.no_such_table' doesn't exist

Not all MySQL error numbers are mapped to SQLSTATE error codes.  The
value ''HY000'' (general error) is used for unmapped error numbers.

If you call *note 'mysql_sqlstate()': mysql-sqlstate. after *note
'mysql_real_connect()': mysql-real-connect. fails, *note
'mysql_sqlstate()': mysql-sqlstate. might not return a useful value.
For example, this happens if a host is blocked by the server and the
connection is closed without any SQLSTATE value being sent to the
client.

*Return Values*

A null-terminated character string containing the SQLSTATE error code.

*See Also*

See *note mysql-errno::, *note mysql-error::, and *note
mysql-stmt-sqlstate::.


File: manual.info.tmp,  Node: mysql-ssl-set,  Next: mysql-stat,  Prev: mysql-sqlstate,  Up: c-api-functions

23.7.6.67 mysql_ssl_set()
.........................

'my_bool mysql_ssl_set(MYSQL *mysql, const char *key, const char *cert,
const char *ca, const char *capath, const char *cipher)'

*Description*

*note 'mysql_ssl_set()': mysql-ssl-set. is used for establishing
encrypted connections using SSL. The 'mysql' argument must be a valid
connection handler.  Any unused SSL arguments may be given as 'NULL'.

If used, *note 'mysql_ssl_set()': mysql-ssl-set. must be called before
*note 'mysql_real_connect()': mysql-real-connect.  *note
'mysql_ssl_set()': mysql-ssl-set. does nothing unless SSL support is
enabled in the client library.

*note 'mysql_ssl_set()': mysql-ssl-set. specifies SSL information such
as certificate and key files for establishing an encrypted connection if
such connections are available, but does not enforce any requirement
that the connection obtained be encrypted.  To require an encrypted
connection, use the technique described in *note
c-api-encrypted-connections::.

For additional security relative to that provided by the default
encryption, clients can supply a CA certificate matching the one used by
the server and enable host name identity verification.  In this way, the
server and client place their trust in the same CA certificate and the
client verifies that the host to which it connected is the one intended.
For details, see *note c-api-encrypted-connections::.

Arguments:

   * 'mysql': The connection handler returned from *note 'mysql_init()':
     mysql-init.

   * 'key': The path name of the client private key file.

   * 'cert': The path name of the client public key certificate file.

   * 'ca': The path name of the Certificate Authority (CA) certificate
     file.  This option, if used, must specify the same certificate used
     by the server.

   * 'capath': The path name of the directory that contains trusted SSL
     CA certificate files.

   * 'cipher': The list of permissible ciphers for SSL encryption.

*Return Values*

This function always returns '0'.  If SSL setup is incorrect, a
subsequent *note 'mysql_real_connect()': mysql-real-connect. call
returns an error when you attempt to connect.


File: manual.info.tmp,  Node: mysql-stat,  Next: mysql-store-result,  Prev: mysql-ssl-set,  Up: c-api-functions

23.7.6.68 mysql_stat()
......................

'const char *mysql_stat(MYSQL *mysql)'

*Description*

Returns a character string containing information similar to that
provided by the *note 'mysqladmin status': mysqladmin. command.  This
includes uptime in seconds and the number of running threads, questions,
reloads, and open tables.

*Return Values*

A character string describing the server status.  'NULL' if an error
occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-store-result,  Next: mysql-thread-id,  Prev: mysql-stat,  Up: c-api-functions

23.7.6.69 mysql_store_result()
..............................

'MYSQL_RES *mysql_store_result(MYSQL *mysql)'

*Description*

After invoking *note 'mysql_query()': mysql-query. or *note
'mysql_real_query()': mysql-real-query, you must call *note
'mysql_store_result()': mysql-store-result. or *note
'mysql_use_result()': mysql-use-result. for every statement that
successfully produces a result set (*note 'SELECT': select, *note
'SHOW': show, *note 'DESCRIBE': describe, *note 'EXPLAIN': explain,
*note 'CHECK TABLE': check-table, and so forth).  You must also call
*note 'mysql_free_result()': mysql-free-result. after you are done with
the result set.

You need not call *note 'mysql_store_result()': mysql-store-result. or
*note 'mysql_use_result()': mysql-use-result. for other statements, but
it does not do any harm or cause any notable performance degradation if
you call *note 'mysql_store_result()': mysql-store-result. in all cases.
You can detect whether the statement has a result set by checking
whether *note 'mysql_store_result()': mysql-store-result. returns a
nonzero value (more about this later).

If you enable multiple-statement support, you should retrieve results
from calls to *note 'mysql_query()': mysql-query. or *note
'mysql_real_query()': mysql-real-query. by using a loop that calls *note
'mysql_next_result()': mysql-next-result. to determine whether there are
more results.  For an example, see *note c-api-multiple-queries::.

If you want to know whether a statement should return a result set, you
can use *note 'mysql_field_count()': mysql-field-count. to check for
this.  See *note mysql-field-count::.

*note 'mysql_store_result()': mysql-store-result. reads the entire
result of a query to the client, allocates a 'MYSQL_RES' structure, and
places the result into this structure.

*note 'mysql_store_result()': mysql-store-result. returns 'NULL' if the
statement did not return a result set (for example, if it was an *note
'INSERT': insert. statement), or an error occurred and reading of the
result set failed.

An empty result set is returned if there are no rows returned.  (An
empty result set differs from a null pointer as a return value.)

After you have called *note 'mysql_store_result()': mysql-store-result.
and gotten back a result that is not a null pointer, you can call *note
'mysql_num_rows()': mysql-num-rows. to find out how many rows are in the
result set.

You can call *note 'mysql_fetch_row()': mysql-fetch-row. to fetch rows
from the result set, or *note 'mysql_row_seek()': mysql-row-seek. and
*note 'mysql_row_tell()': mysql-row-tell. to obtain or set the current
row position within the result set.

See *note null-mysql-store-result::.

*Return Values*

A pointer to a 'MYSQL_RES' result structure with the results.  'NULL' if
the statement did not return a result set or an error occurred.  To
determine whether an error occurred, check whether *note
'mysql_error()': mysql-error. returns a nonempty string, *note
'mysql_errno()': mysql-errno. returns nonzero, or *note
'mysql_field_count()': mysql-field-count. returns zero.

*Errors*

*note 'mysql_store_result()': mysql-store-result. resets *note
'mysql_error()': mysql-error. and *note 'mysql_errno()': mysql-errno. if
it succeeds.

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_OUT_OF_MEMORY'

     Out of memory.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-thread-id,  Next: mysql-use-result,  Prev: mysql-store-result,  Up: c-api-functions

23.7.6.70 mysql_thread_id()
...........................

'unsigned long mysql_thread_id(MYSQL *mysql)'

*Description*

Returns the thread ID of the current connection.  This value can be used
as an argument to *note 'mysql_kill()': mysql-kill. to kill the thread.

If the connection is lost and you reconnect with *note 'mysql_ping()':
mysql-ping, the thread ID changes.  This means you should not get the
thread ID and store it for later.  You should get it when you need it.

*Note*:

This function does not work correctly if thread IDs become larger than
32 bits, which can occur on some systems.  To avoid problems with *note
'mysql_thread_id()': mysql-thread-id, do not use it.  To get the
connection ID, execute a 'SELECT CONNECTION_ID()' query and retrieve the
result.

*Return Values*

The thread ID of the current connection.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-use-result,  Next: mysql-warning-count,  Prev: mysql-thread-id,  Up: c-api-functions

23.7.6.71 mysql_use_result()
............................

'MYSQL_RES *mysql_use_result(MYSQL *mysql)'

*Description*

After invoking *note 'mysql_query()': mysql-query. or *note
'mysql_real_query()': mysql-real-query, you must call *note
'mysql_store_result()': mysql-store-result. or *note
'mysql_use_result()': mysql-use-result. for every statement that
successfully produces a result set (*note 'SELECT': select, *note
'SHOW': show, *note 'DESCRIBE': describe, *note 'EXPLAIN': explain,
*note 'CHECK TABLE': check-table, and so forth).  You must also call
*note 'mysql_free_result()': mysql-free-result. after you are done with
the result set.

*note 'mysql_use_result()': mysql-use-result. initiates a result set
retrieval but does not actually read the result set into the client like
*note 'mysql_store_result()': mysql-store-result. does.  Instead, each
row must be retrieved individually by making calls to *note
'mysql_fetch_row()': mysql-fetch-row.  This reads the result of a query
directly from the server without storing it in a temporary table or
local buffer, which is somewhat faster and uses much less memory than
*note 'mysql_store_result()': mysql-store-result.  The client allocates
memory only for the current row and a communication buffer that may grow
up to 'max_allowed_packet' bytes.

On the other hand, you should not use *note 'mysql_use_result()':
mysql-use-result. for locking reads if you are doing a lot of processing
for each row on the client side, or if the output is sent to a screen on
which the user may type a '^S' (stop scroll).  This ties up the server
and prevent other threads from updating any tables from which the data
is being fetched.

When using *note 'mysql_use_result()': mysql-use-result, you must
execute *note 'mysql_fetch_row()': mysql-fetch-row. until a 'NULL' value
is returned, otherwise, the unfetched rows are returned as part of the
result set for your next query.  The C API gives the error 'Commands out
of sync; you can't run this command now' if you forget to do this!

You may not use *note 'mysql_data_seek()': mysql-data-seek, *note
'mysql_row_seek()': mysql-row-seek, *note 'mysql_row_tell()':
mysql-row-tell, *note 'mysql_num_rows()': mysql-num-rows, or *note
'mysql_affected_rows()': mysql-affected-rows. with a result returned
from *note 'mysql_use_result()': mysql-use-result, nor may you issue
other queries until *note 'mysql_use_result()': mysql-use-result. has
finished.  (However, after you have fetched all the rows, *note
'mysql_num_rows()': mysql-num-rows. accurately returns the number of
rows fetched.)

You must call *note 'mysql_free_result()': mysql-free-result. once you
are done with the result set.

When using the 'libmysqld' embedded server, the memory benefits are
essentially lost because memory usage incrementally increases with each
row retrieved until *note 'mysql_free_result()': mysql-free-result. is
called.

*Return Values*

A 'MYSQL_RES' result structure.  'NULL' if an error occurred.

*Errors*

*note 'mysql_use_result()': mysql-use-result. resets *note
'mysql_error()': mysql-error. and *note 'mysql_errno()': mysql-errno. if
it succeeds.

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_OUT_OF_MEMORY'

     Out of memory.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-warning-count,  Prev: mysql-use-result,  Up: c-api-functions

23.7.6.72 mysql_warning_count()
...............................

'unsigned int mysql_warning_count(MYSQL *mysql)'

*Description*

Returns the number of errors, warnings, and notes generated during
execution of the previous SQL statement.

*Return Values*

The warning count.

*Errors*

None.


File: manual.info.tmp,  Node: c-api-prepared-statements,  Next: c-api-prepared-statement-data-structures,  Prev: c-api-functions,  Up: c-api

23.7.7 C API Prepared Statements
--------------------------------

The MySQL client/server protocol provides for the use of prepared
statements.  This capability uses the 'MYSQL_STMT' statement handler
data structure returned by the *note 'mysql_stmt_init()':
mysql-stmt-init. initialization function.  Prepared execution is an
efficient way to execute a statement more than once.  The statement is
first parsed to prepare it for execution.  Then it is executed one or
more times at a later time, using the statement handler returned by the
initialization function.

Prepared execution is faster than direct execution for statements
executed more than once, primarily because the query is parsed only
once.  In the case of direct execution, the query is parsed every time
it is executed.  Prepared execution also can provide a reduction of
network traffic because for each execution of the prepared statement, it
is necessary only to send the data for the parameters.

Prepared statements might not provide a performance increase in some
situations.  For best results, test your application both with prepared
and nonprepared statements and choose whichever yields best performance.

Another advantage of prepared statements is that it uses a binary
protocol that makes data transfer between client and server more
efficient.

For a list of SQL statements that can be used as prepared statements,
see *note sql-prepared-statements::.

Metadata changes to tables or views referred to by prepared statements
are detected and cause automatic repreparation of the statement when it
is next executed.  For more information, see *note
statement-repreparation::.


File: manual.info.tmp,  Node: c-api-prepared-statement-data-structures,  Next: c-api-prepared-statement-function-overview,  Prev: c-api-prepared-statements,  Up: c-api

23.7.8 C API Prepared Statement Data Structures
-----------------------------------------------

* Menu:

* c-api-prepared-statement-type-codes::  C API Prepared Statement Type Codes
* c-api-prepared-statement-type-conversions::  C API Prepared Statement Type Conversions

Prepared statements use several data structures:

   * To obtain a statement handler, pass a 'MYSQL' connection handler to
     *note 'mysql_stmt_init()': mysql-stmt-init, which returns a pointer
     to a 'MYSQL_STMT' data structure.  This structure is used for
     further operations with the statement.  To specify the statement to
     prepare, pass the 'MYSQL_STMT' pointer and the statement string to
     *note 'mysql_stmt_prepare()': mysql-stmt-prepare.

   * To provide input parameters for a prepared statement, set up
     'MYSQL_BIND' structures and pass them to *note
     'mysql_stmt_bind_param()': mysql-stmt-bind-param.  To receive
     output column values, set up 'MYSQL_BIND' structures and pass them
     to *note 'mysql_stmt_bind_result()': mysql-stmt-bind-result.

   * The 'MYSQL_TIME' structure is used to transfer temporal data in
     both directions.

The following discussion describes the prepared statement data types in
detail.  For examples that show how to use them, see *note
mysql-stmt-execute::, and *note mysql-stmt-fetch::.

   * 
     'MYSQL_STMT'

     This structure is a handler for a prepared statement.  A handler is
     created by calling *note 'mysql_stmt_init()': mysql-stmt-init,
     which returns a pointer to a 'MYSQL_STMT'.  The handler is used for
     all subsequent operations with the statement until you close it
     with *note 'mysql_stmt_close()': mysql-stmt-close, at which point
     the handler becomes invalid and should no longer be used.

     The 'MYSQL_STMT' structure has no members intended for application
     use.  Applications should not try to copy a 'MYSQL_STMT' structure.
     There is no guarantee that such a copy will be usable.

     Multiple statement handlers can be associated with a single
     connection.  The limit on the number of handlers depends on the
     available system resources.

   * 
     'MYSQL_BIND'

     This structure is used both for statement input (data values sent
     to the server) and output (result values returned from the server):

        * For input, use 'MYSQL_BIND' structures with *note
          'mysql_stmt_bind_param()': mysql-stmt-bind-param. to bind
          parameter data values to buffers for use by *note
          'mysql_stmt_execute()': mysql-stmt-execute.

        * For output, use 'MYSQL_BIND' structures with *note
          'mysql_stmt_bind_result()': mysql-stmt-bind-result. to bind
          buffers to result set columns, for use in fetching rows with
          *note 'mysql_stmt_fetch()': mysql-stmt-fetch.

     To use a 'MYSQL_BIND' structure, zero its contents to initialize
     it, then set its members appropriately.  For example, to declare
     and initialize an array of three 'MYSQL_BIND' structures, use this
     code:

          MYSQL_BIND bind[3];
          memset(bind, 0, sizeof(bind));

     The 'MYSQL_BIND' structure contains the following members for use
     by application programs.  For several of the members, the manner of
     use depends on whether the structure is used for input or output.

        * 'enum enum_field_types buffer_type'

          The type of the buffer.  This member indicates the data type
          of the C language variable bound to a statement parameter or
          result set column.  For input, 'buffer_type' indicates the
          type of the variable containing the value to be sent to the
          server.  For output, it indicates the type of the variable
          into which a value received from the server should be stored.
          For permissible 'buffer_type' values, see *note
          c-api-prepared-statement-type-codes::.

        * 'void *buffer'

          A pointer to the buffer to be used for data transfer.  This is
          the address of a C language variable.

          For input, 'buffer' is a pointer to the variable in which you
          store the data value for a statement parameter.  When you call
          *note 'mysql_stmt_execute()': mysql-stmt-execute, MySQL use
          the value stored in the variable in place of the corresponding
          parameter marker in the statement (specified with '?' in the
          statement string).

          For output, 'buffer' is a pointer to the variable in which to
          return a result set column value.  When you call *note
          'mysql_stmt_fetch()': mysql-stmt-fetch, MySQL stores a column
          value from the current row of the result set in this variable.
          You can access the value when the call returns.

          To minimize the need for MySQL to perform type conversions
          between C language values on the client side and SQL values on
          the server side, use C variables that have types similar to
          those of the corresponding SQL values:

             * For numeric data types, 'buffer' should point to a
               variable of the proper numeric C type.  For integer
               variables (which can be 'char' for single-byte values or
               an integer type for larger values), you should also
               indicate whether the variable has the 'unsigned'
               attribute by setting the 'is_unsigned' member, described
               later.

             * For character (nonbinary) and binary string data types,
               'buffer' should point to a character buffer.

             * For date and time data types, 'buffer' should point to a
               'MYSQL_TIME' structure.

          For guidelines about mapping between C types and SQL types and
          notes about type conversions, see *note
          c-api-prepared-statement-type-codes::, and *note
          c-api-prepared-statement-type-conversions::.

        * 'unsigned long buffer_length'

          The actual size of '*buffer' in bytes.  This indicates the
          maximum amount of data that can be stored in the buffer.  For
          character and binary C data, the 'buffer_length' value
          specifies the length of '*buffer' when used with *note
          'mysql_stmt_bind_param()': mysql-stmt-bind-param. to specify
          input values, or the maximum number of output data bytes that
          can be fetched into the buffer when used with *note
          'mysql_stmt_bind_result()': mysql-stmt-bind-result.

        * 'unsigned long *length'

          A pointer to an 'unsigned long' variable that indicates the
          actual number of bytes of data stored in '*buffer'.  'length'
          is used for character or binary C data.

          For input parameter data binding, set '*length' to indicate
          the actual length of the parameter value stored in '*buffer'.
          This is used by *note 'mysql_stmt_execute()':
          mysql-stmt-execute.

          For output value binding, MySQL sets '*length' when you call
          *note 'mysql_stmt_fetch()': mysql-stmt-fetch.  The *note
          'mysql_stmt_fetch()': mysql-stmt-fetch. return value
          determines how to interpret the length:

             * If the return value is 0, '*length' indicates the actual
               length of the parameter value.

             * If the return value is 'MYSQL_DATA_TRUNCATED', '*length'
               indicates the nontruncated length of the parameter value.
               In this case, the minimum of '*length' and
               'buffer_length' indicates the actual length of the value.

          'length' is ignored for numeric and temporal data types
          because the 'buffer_type' value determines the length of the
          data value.

          If you must determine the length of a returned value before
          fetching it, see *note mysql-stmt-fetch::, for some
          strategies.

        * 'my_bool *is_null'

          This member points to a 'my_bool' variable that is true if a
          value is 'NULL', false if it is not 'NULL'.  For input, set
          '*is_null' to true to indicate that you are passing a 'NULL'
          value as a statement parameter.

          'is_null' is a _pointer_ to a boolean scalar, not a boolean
          scalar, to provide flexibility in how you specify 'NULL'
          values:

             * If your data values are always 'NULL', use
               'MYSQL_TYPE_NULL' as the 'buffer_type' value when you
               bind the column.  The other 'MYSQL_BIND' members,
               including 'is_null', do not matter.

             * If your data values are always 'NOT NULL', set 'is_null =
               (my_bool*) 0', and set the other members appropriately
               for the variable you are binding.

             * In all other cases, set the other members appropriately
               and set 'is_null' to the address of a 'my_bool' variable.
               Set that variable's value to true or false appropriately
               between executions to indicate whether the corresponding
               data value is 'NULL' or 'NOT NULL', respectively.

          For output, when you fetch a row, MySQL sets the value pointed
          to by 'is_null' to true or false according to whether the
          result set column value returned from the statement is or is
          not 'NULL'.

        * 'my_bool is_unsigned'

          This member applies for C variables with data types that can
          be 'unsigned' ('char', 'short int', 'int', 'long long int').
          Set 'is_unsigned' to true if the variable pointed to by
          'buffer' is 'unsigned' and false otherwise.  For example, if
          you bind a 'signed char' variable to 'buffer', specify a type
          code of 'MYSQL_TYPE_TINY' and set 'is_unsigned' to false.  If
          you bind an 'unsigned char' instead, the type code is the same
          but 'is_unsigned' should be true.  (For 'char', it is not
          defined whether it is signed or unsigned, so it is best to be
          explicit about signedness by using 'signed char' or 'unsigned
          char'.)

          'is_unsigned' applies only to the C language variable on the
          client side.  It indicates nothing about the signedness of the
          corresponding SQL value on the server side.  For example, if
          you use an 'int' variable to supply a value for a 'BIGINT
          UNSIGNED' column, 'is_unsigned' should be false because 'int'
          is a signed type.  If you use an 'unsigned int' variable to
          supply a value for a *note 'BIGINT': integer-types. column,
          'is_unsigned' should be true because 'unsigned int' is an
          unsigned type.  MySQL performs the proper conversion between
          signed and unsigned values in both directions, although a
          warning occurs if truncation results.

        * 'my_bool *error'

          For output, set this member to point to a 'my_bool' variable
          to have truncation information for the parameter stored there
          after a row fetching operation.  When truncation reporting is
          enabled, *note 'mysql_stmt_fetch()': mysql-stmt-fetch. returns
          'MYSQL_DATA_TRUNCATED' and '*error' is true in the
          'MYSQL_BIND' structures for parameters in which truncation
          occurred.  Truncation indicates loss of sign or significant
          digits, or that a string was too long to fit in a column.
          Truncation reporting is enabled by default, but can be
          controlled by calling *note 'mysql_options()': mysql-options.
          with the 'MYSQL_REPORT_DATA_TRUNCATION' option.

   * 
     'MYSQL_TIME'

     This structure is used to send and receive *note 'DATE': datetime,
     *note 'TIME': time, *note 'DATETIME': datetime, and *note
     'TIMESTAMP': datetime. data directly to and from the server.  Set
     the 'buffer' member to point to a 'MYSQL_TIME' structure, and set
     the 'buffer_type' member of a 'MYSQL_BIND' structure to one of the
     temporal types ('MYSQL_TYPE_TIME', 'MYSQL_TYPE_DATE',
     'MYSQL_TYPE_DATETIME', 'MYSQL_TYPE_TIMESTAMP').

     The 'MYSQL_TIME' structure contains the members listed in the
     following table.

     Member                        Description
                                   
     'unsigned int year'           The year
                                   
     'unsigned int month'          The month of the year
                                   
     'unsigned int day'            The day of the month
                                   
     'unsigned int hour'           The hour of the day
                                   
     'unsigned int minute'         The minute of the hour
                                   
     'unsigned int second'         The second of the minute
                                   
     'my_bool neg'                 A boolean flag indicating whether the
                                   time is negative
                                   
     'unsigned long second_part'   The fractional part of the second in
                                   microseconds; currently unused

     Only those parts of a 'MYSQL_TIME' structure that apply to a given
     type of temporal value are used.  The 'year', 'month', and 'day'
     elements are used for *note 'DATE': datetime, *note 'DATETIME':
     datetime, and *note 'TIMESTAMP': datetime. values.  The 'hour',
     'minute', and 'second' elements are used for *note 'TIME': time,
     *note 'DATETIME': datetime, and *note 'TIMESTAMP': datetime.
     values.  See *note c-api-prepared-statement-date-handling::.


File: manual.info.tmp,  Node: c-api-prepared-statement-type-codes,  Next: c-api-prepared-statement-type-conversions,  Prev: c-api-prepared-statement-data-structures,  Up: c-api-prepared-statement-data-structures

23.7.8.1 C API Prepared Statement Type Codes
............................................

The 'buffer_type' member of 'MYSQL_BIND' structures indicates the data
type of the C language variable bound to a statement parameter or result
set column.  For input, 'buffer_type' indicates the type of the variable
containing the value to be sent to the server.  For output, it indicates
the type of the variable into which a value received from the server
should be stored.

The following table shows the permissible values for the 'buffer_type'
member of 'MYSQL_BIND' structures for input values sent to the server.
The table shows the C variable types that you can use, the corresponding
type codes, and the SQL data types for which the supplied value can be
used without conversion.  Choose the 'buffer_type' value according to
the data type of the C language variable that you are binding.  For the
integer types, you should also set the 'is_unsigned' member to indicate
whether the variable is signed or unsigned.

Input Variable C       'buffer_type' Value       SQL Type of Destination
Type                                             Value
                                                 
'signed char'          'MYSQL_TYPE_TINY'         *note 'TINYINT': integer-types.
                                                 
'short int'            'MYSQL_TYPE_SHORT'        *note 'SMALLINT': integer-types.
                                                 
'int'                  'MYSQL_TYPE_LONG'         *note 'INT': integer-types.
                                                 
'long long int'        'MYSQL_TYPE_LONGLONG'     *note 'BIGINT': integer-types.
                                                 
'float'                'MYSQL_TYPE_FLOAT'        *note 'FLOAT': floating-point-types.
                                                 
'double'               'MYSQL_TYPE_DOUBLE'       *note 'DOUBLE': floating-point-types.
                                                 
'MYSQL_TIME'           'MYSQL_TYPE_TIME'         *note 'TIME': time.
                                                 
'MYSQL_TIME'           'MYSQL_TYPE_DATE'         *note 'DATE': datetime.
                                                 
'MYSQL_TIME'           'MYSQL_TYPE_DATETIME'     *note 'DATETIME': datetime.
                                                 
'MYSQL_TIME'           'MYSQL_TYPE_TIMESTAMP'    *note 'TIMESTAMP': datetime.
                                                 
'char[]'               'MYSQL_TYPE_STRING'       *note 'TEXT': blob,
                                                 *note 'CHAR': char,
                                                 *note 'VARCHAR': char.
                                                 
'char[]'               'MYSQL_TYPE_BLOB'         *note 'BLOB': blob,
                                                 *note 'BINARY': binary-varbinary,
                                                 *note 'VARBINARY': binary-varbinary.
                                                 
                       'MYSQL_TYPE_NULL'         'NULL'
                       

Use 'MYSQL_TYPE_NULL' as indicated in the description for the 'is_null'
member in *note c-api-prepared-statement-data-structures::.

For input string data, use 'MYSQL_TYPE_STRING' or 'MYSQL_TYPE_BLOB'
depending on whether the value is a character (nonbinary) or binary
string:

   * 'MYSQL_TYPE_STRING' indicates character input string data.  The
     value is assumed to be in the character set indicated by the
     'character_set_client' system variable.  If the server stores the
     value into a column with a different character set, it converts the
     value to that character set.

   * 'MYSQL_TYPE_BLOB' indicates binary input string data.  The value is
     treated as having the 'binary' character set.  That is, it is
     treated as a byte string and no conversion occurs.

The following table shows the permissible values for the 'buffer_type'
member of 'MYSQL_BIND' structures for output values received from the
server.  The table shows the SQL types of received values, the
corresponding type codes that such values have in result set metadata,
and the recommended C language data types to bind to the 'MYSQL_BIND'
structure to receive the SQL values without conversion.  Choose the
'buffer_type' value according to the data type of the C language
variable that you are binding.  For the integer types, you should also
set the 'is_unsigned' member to indicate whether the variable is signed
or unsigned.

SQL Type of Received   'buffer_type' Value       Output Variable C Type
Value                                            

*note 'TINYINT': integer-types.'MYSQL_TYPE_TINY' 'signed char'
                                                 
*note 'SMALLINT': integer-types.'MYSQL_TYPE_SHORT''short int'
                                                 
*note 'MEDIUMINT': integer-types.'MYSQL_TYPE_INT24''int'
                                                 
*note 'INT': integer-types.'MYSQL_TYPE_LONG'     'int'
                                                 
*note 'BIGINT': integer-types.'MYSQL_TYPE_LONGLONG''long long int'
                                                 
*note 'FLOAT': floating-point-types.'MYSQL_TYPE_FLOAT''float'
                                                 
*note 'DOUBLE': floating-point-types.'MYSQL_TYPE_DOUBLE''double'
                                                 
*note 'DECIMAL': fixed-point-types.'MYSQL_TYPE_NEWDECIMAL''char[]'
                                                 
*note 'YEAR': year.    'MYSQL_TYPE_SHORT'        'short int'
                                                 
*note 'TIME': time.    'MYSQL_TYPE_TIME'         'MYSQL_TIME'
                                                 
*note 'DATE': datetime.'MYSQL_TYPE_DATE'         'MYSQL_TIME'
                                                 
*note 'DATETIME': datetime.'MYSQL_TYPE_DATETIME' 'MYSQL_TIME'
                                                 
*note 'TIMESTAMP': datetime.'MYSQL_TYPE_TIMESTAMP''MYSQL_TIME'
                                                 
*note 'CHAR': char,    'MYSQL_TYPE_STRING'       'char[]'
*note 'BINARY': binary-varbinary.                

*note 'VARCHAR': char, 'MYSQL_TYPE_VAR_STRING'   'char[]'
*note 'VARBINARY': binary-varbinary.             

*note 'TINYBLOB': blob,'MYSQL_TYPE_TINY_BLOB'    'char[]'
*note 'TINYTEXT': blob.                          

*note 'BLOB': blob,    'MYSQL_TYPE_BLOB'         'char[]'
*note 'TEXT': blob.                              

*note 'MEDIUMBLOB': blob,'MYSQL_TYPE_MEDIUM_BLOB''char[]'
*note 'MEDIUMTEXT': blob.                        

*note 'LONGBLOB': blob,'MYSQL_TYPE_LONG_BLOB'    'char[]'
*note 'LONGTEXT': blob.                          

*note 'BIT': bit-type. 'MYSQL_TYPE_BIT'          'char[]'
                       


File: manual.info.tmp,  Node: c-api-prepared-statement-type-conversions,  Prev: c-api-prepared-statement-type-codes,  Up: c-api-prepared-statement-data-structures

23.7.8.2 C API Prepared Statement Type Conversions
..................................................

Prepared statements transmit data between the client and server using C
language variables on the client side that correspond to SQL values on
the server side.  If there is a mismatch between the C variable type on
the client side and the corresponding SQL value type on the server side,
MySQL performs implicit type conversions in both directions.

MySQL knows the type code for the SQL value on the server side.  The
'buffer_type' value in the 'MYSQL_BIND' structure indicates the type
code of the C variable that holds the value on the client side.  The two
codes together tell MySQL what conversion must be performed, if any.
Here are some examples:

   * If you use 'MYSQL_TYPE_LONG' with an 'int' variable to pass an
     integer value to the server that is to be stored into a *note
     'FLOAT': floating-point-types. column, MySQL converts the value to
     floating-point format before storing it.

   * If you fetch an SQL *note 'MEDIUMINT': integer-types. column value,
     but specify a 'buffer_type' value of 'MYSQL_TYPE_LONGLONG' and use
     a C variable of type 'long long int' as the destination buffer,
     MySQL converts the *note 'MEDIUMINT': integer-types. value (which
     requires less than 8 bytes) for storage into the 'long long int'
     (an 8-byte variable).

   * If you fetch a numeric column with a value of 255 into a 'char[4]'
     character array and specify a 'buffer_type' value of
     'MYSQL_TYPE_STRING', the resulting value in the array is a 4-byte
     string ''255\0''.

   * MySQL returns *note 'DECIMAL': fixed-point-types. values as the
     string representation of the original server-side value, which is
     why the corresponding C type is 'char[]'.  For example, '12.345' is
     returned to the client as ''12.345''.  If you specify
     'MYSQL_TYPE_NEWDECIMAL' and bind a string buffer to the
     'MYSQL_BIND' structure, *note 'mysql_stmt_fetch()':
     mysql-stmt-fetch. stores the value in the buffer as a string
     without conversion.  If instead you specify a numeric variable and
     type code, *note 'mysql_stmt_fetch()': mysql-stmt-fetch. converts
     the string-format *note 'DECIMAL': fixed-point-types. value to
     numeric form.

   * For the 'MYSQL_TYPE_BIT' type code, *note 'BIT': bit-type. values
     are returned into a string buffer, which is why the corresponding C
     type is 'char[]'.  The value represents a bit string that requires
     interpretation on the client side.  To return the value as a type
     that is easier to deal with, you can cause the value to be cast to
     integer using either of the following types of expressions:

          SELECT bit_col + 0 FROM t
          SELECT CAST(bit_col AS UNSIGNED) FROM t

     To retrieve the value, bind an integer variable large enough to
     hold the value and specify the appropriate corresponding integer
     type code.

Before binding variables to the 'MYSQL_BIND' structures that are to be
used for fetching column values, you can check the type codes for each
column of the result set.  This might be desirable if you want to
determine which variable types would be best to use to avoid type
conversions.  To get the type codes, call *note
'mysql_stmt_result_metadata()': mysql-stmt-result-metadata. after
executing the prepared statement with *note 'mysql_stmt_execute()':
mysql-stmt-execute.  The metadata provides access to the type codes for
the result set as described in *note mysql-stmt-result-metadata::, and
*note c-api-data-structures::.

To determine whether output string values in a result set returned from
the server contain binary or nonbinary data, check whether the
'charsetnr' value of the result set metadata is 63 (see *note
c-api-data-structures::).  If so, the character set is 'binary', which
indicates binary rather than nonbinary data.  This enables you to
distinguish *note 'BINARY': binary-varbinary. from *note 'CHAR': char,
*note 'VARBINARY': binary-varbinary. from *note 'VARCHAR': char, and the
*note 'BLOB': blob. types from the *note 'TEXT': blob. types.

If you cause the 'max_length' member of the 'MYSQL_FIELD' column
metadata structures to be set (by calling *note 'mysql_stmt_attr_set()':
mysql-stmt-attr-set.), be aware that the 'max_length' values for the
result set indicate the lengths of the longest string representation of
the result values, not the lengths of the binary representation.  That
is, 'max_length' does not necessarily correspond to the size of the
buffers needed to fetch the values with the binary protocol used for
prepared statements.  Choose the size of the buffers according to the
types of the variables into which you fetch the values.  For example, a
'TINYINT' column containing the value -128 might have a 'max_length'
value of 4.  But the binary representation of any 'TINYINT' value
requires only 1 byte for storage, so you can supply a 'signed char'
variable in which to store the value and set 'is_unsigned' to indicate
that values are signed.

Metadata changes to tables or views referred to by prepared statements
are detected and cause automatic repreparation of the statement when it
is next executed.  For more information, see *note
statement-repreparation::.


File: manual.info.tmp,  Node: c-api-prepared-statement-function-overview,  Next: c-api-prepared-statement-functions,  Prev: c-api-prepared-statement-data-structures,  Up: c-api

23.7.9 C API Prepared Statement Function Overview
-------------------------------------------------

The following list summarizes the functions available for prepared
statement processing.  For greater detail, see the descriptions in *note
c-api-prepared-statement-functions::.

   * *note 'mysql_stmt_affected_rows()': mysql-stmt-affected-rows.:
     Returns the number of rows changed, deleted, or inserted by
     prepared *note 'UPDATE': update, *note 'DELETE': delete, or *note
     'INSERT': insert. statement.

   * *note 'mysql_stmt_attr_get()': mysql-stmt-attr-get.: Gets the value
     of an attribute for a prepared statement.

   * *note 'mysql_stmt_attr_set()': mysql-stmt-attr-set.: Sets an
     attribute for a prepared statement.

   * *note 'mysql_stmt_bind_param()': mysql-stmt-bind-param.: Associates
     application data buffers with the parameter markers in a prepared
     SQL statement.

   * *note 'mysql_stmt_bind_result()': mysql-stmt-bind-result.:
     Associates application data buffers with columns in a result set.

   * *note 'mysql_stmt_close()': mysql-stmt-close.: Frees memory used by
     a prepared statement.

   * *note 'mysql_stmt_data_seek()': mysql-stmt-data-seek.: Seeks to an
     arbitrary row number in a statement result set.

   * *note 'mysql_stmt_errno()': mysql-stmt-errno.: Returns the error
     number for the last statement execution.

   * *note 'mysql_stmt_error()': mysql-stmt-error.: Returns the error
     message for the last statement execution.

   * *note 'mysql_stmt_execute()': mysql-stmt-execute.: Executes a
     prepared statement.

   * *note 'mysql_stmt_fetch()': mysql-stmt-fetch.: Fetches the next row
     of data from a result set and returns data for all bound columns.

   * *note 'mysql_stmt_fetch_column()': mysql-stmt-fetch-column.:
     Fetches data for one column of the current row of a result set.

   * *note 'mysql_stmt_field_count()': mysql-stmt-field-count.: Returns
     the number of result columns for the most recent statement.

   * *note 'mysql_stmt_free_result()': mysql-stmt-free-result.: Frees
     the resources allocated to a statement handler.

   * *note 'mysql_stmt_init()': mysql-stmt-init.: Allocates memory for a
     'MYSQL_STMT' structure and initializes it.

   * *note 'mysql_stmt_insert_id()': mysql-stmt-insert-id.: Returns the
     ID generated for an 'AUTO_INCREMENT' column by a prepared
     statement.

   * *note 'mysql_stmt_next_result()': mysql-stmt-next-result.:
     Returns/initiates the next result in a multiple-result execution.

   * *note 'mysql_stmt_num_rows()': mysql-stmt-num-rows.: Returns the
     row count from a buffered statement result set.

   * *note 'mysql_stmt_param_count()': mysql-stmt-param-count.: Returns
     the number of parameters in a prepared statement.

   * *note 'mysql_stmt_param_metadata()': mysql-stmt-param-metadata.:
     Returns parameter metadata in the form of a result set.  (This
     function actually does nothing.)

   * *note 'mysql_stmt_prepare()': mysql-stmt-prepare.: Prepares an SQL
     statement string for execution.

   * *note 'mysql_stmt_reset()': mysql-stmt-reset.: Resets the statement
     buffers in the server.

   * *note 'mysql_stmt_result_metadata()': mysql-stmt-result-metadata.:
     Returns prepared statement metadata in the form of a result set.

   * *note 'mysql_stmt_row_seek()': mysql-stmt-row-seek.: Seeks to a row
     offset in a statement result set, using value returned from *note
     'mysql_stmt_row_tell()': mysql-stmt-row-tell.

   * *note 'mysql_stmt_row_tell()': mysql-stmt-row-tell.: Returns the
     statement row cursor position.

   * *note 'mysql_stmt_send_long_data()': mysql-stmt-send-long-data.:
     Sends long data in chunks to server.

   * *note 'mysql_stmt_sqlstate()': mysql-stmt-sqlstate.: Returns the
     SQLSTATE error code for the last statement execution.

   * *note 'mysql_stmt_store_result()': mysql-stmt-store-result.:
     Retrieves a complete result set to the client.

Call *note 'mysql_stmt_init()': mysql-stmt-init. to create a statement
handler, then *note 'mysql_stmt_prepare()': mysql-stmt-prepare. to
prepare the statement string, *note 'mysql_stmt_bind_param()':
mysql-stmt-bind-param. to supply the parameter data, and *note
'mysql_stmt_execute()': mysql-stmt-execute. to execute the statement.
You can repeat the *note 'mysql_stmt_execute()': mysql-stmt-execute. by
changing parameter values in the respective buffers supplied through
*note 'mysql_stmt_bind_param()': mysql-stmt-bind-param.

You can send text or binary data in chunks to server using *note
'mysql_stmt_send_long_data()': mysql-stmt-send-long-data.  See *note
mysql-stmt-send-long-data::.

If the statement is a *note 'SELECT': select. or any other statement
that produces a result set, *note 'mysql_stmt_prepare()':
mysql-stmt-prepare. also returns the result set metadata information in
the form of a 'MYSQL_RES' result set through *note
'mysql_stmt_result_metadata()': mysql-stmt-result-metadata.

You can supply the result buffers using *note
'mysql_stmt_bind_result()': mysql-stmt-bind-result, so that the *note
'mysql_stmt_fetch()': mysql-stmt-fetch. automatically returns data to
these buffers.  This is row-by-row fetching.

When statement execution has been completed, close the statement handler
using *note 'mysql_stmt_close()': mysql-stmt-close. so that all
resources associated with it can be freed.  At that point the handler
becomes invalid and should no longer be used.

If you obtained a *note 'SELECT': select. statement's result set
metadata by calling *note 'mysql_stmt_result_metadata()':
mysql-stmt-result-metadata, you should also free the metadata using
*note 'mysql_free_result()': mysql-free-result.

*Execution Steps*

To prepare and execute a statement, an application follows these steps:

  1. Create a prepared statement handler with *note 'mysql_stmt_init()':
     mysql-stmt-init.  To prepare the statement on the server, call
     *note 'mysql_stmt_prepare()': mysql-stmt-prepare. and pass it a
     string containing the SQL statement.

  2. If the statement will produce a result set, call *note
     'mysql_stmt_result_metadata()': mysql-stmt-result-metadata. to
     obtain the result set metadata.  This metadata is itself in the
     form of result set, albeit a separate one from the one that
     contains the rows returned by the query.  The metadata result set
     indicates how many columns are in the result and contains
     information about each column.

  3. Set the values of any parameters using *note
     'mysql_stmt_bind_param()': mysql-stmt-bind-param.  All parameters
     must be set.  Otherwise, statement execution returns an error or
     produces unexpected results.

  4. Call *note 'mysql_stmt_execute()': mysql-stmt-execute. to execute
     the statement.

  5. If the statement produces a result set, bind the data buffers to
     use for retrieving the row values by calling *note
     'mysql_stmt_bind_result()': mysql-stmt-bind-result.

  6. Fetch the data into the buffers row by row by calling *note
     'mysql_stmt_fetch()': mysql-stmt-fetch. repeatedly until no more
     rows are found.

  7. Repeat steps 3 through 6 as necessary, by changing the parameter
     values and re-executing the statement.

When *note 'mysql_stmt_prepare()': mysql-stmt-prepare. is called, the
MySQL client/server protocol performs these actions:

   * The server parses the statement and sends the okay status back to
     the client by assigning a statement ID. It also sends total number
     of parameters, a column count, and its metadata if it is a result
     set oriented statement.  All syntax and semantics of the statement
     are checked by the server during this call.

   * The client uses this statement ID for the further operations, so
     that the server can identify the statement from among its pool of
     statements.

When *note 'mysql_stmt_execute()': mysql-stmt-execute. is called, the
MySQL client/server protocol performs these actions:

   * The client uses the statement handler and sends the parameter data
     to the server.

   * The server identifies the statement using the ID provided by the
     client, replaces the parameter markers with the newly supplied
     data, and executes the statement.  If the statement produces a
     result set, the server sends the data back to the client.
     Otherwise, it sends an okay status and the number of rows changed,
     deleted, or inserted.

When *note 'mysql_stmt_fetch()': mysql-stmt-fetch. is called, the MySQL
client/server protocol performs these actions:

   * The client reads the data from the current row of the result set
     and places it into the application data buffers by doing the
     necessary conversions.  If the application buffer type is same as
     that of the field type returned from the server, the conversions
     are straightforward.

If an error occurs, you can get the statement error number, error
message, and SQLSTATE code using *note 'mysql_stmt_errno()':
mysql-stmt-errno, *note 'mysql_stmt_error()': mysql-stmt-error, and
*note 'mysql_stmt_sqlstate()': mysql-stmt-sqlstate, respectively.

*Prepared Statement Logging*

For prepared statements that are executed with the *note
'mysql_stmt_prepare()': mysql-stmt-prepare. and *note
'mysql_stmt_execute()': mysql-stmt-execute. C API functions, the server
writes 'Prepare' and 'Execute' lines to the general query log so that
you can tell when statements are prepared and executed.

Suppose that you prepare and execute a statement as follows:

  1. Call *note 'mysql_stmt_prepare()': mysql-stmt-prepare. to prepare
     the statement string '"SELECT ?"'.

  2. Call *note 'mysql_stmt_bind_param()': mysql-stmt-bind-param. to
     bind the value '3' to the parameter in the prepared statement.

  3. Call *note 'mysql_stmt_execute()': mysql-stmt-execute. to execute
     the prepared statement.

As a result of the preceding calls, the server writes the following
lines to the general query log:

     Prepare  [1] SELECT ?
     Execute  [1] SELECT 3

Each 'Prepare' and 'Execute' line in the log is tagged with a '[N]'
statement identifier so that you can keep track of which prepared
statement is being logged.  N is a positive integer.  If there are
multiple prepared statements active simultaneously for the client, N may
be greater than 1.  Each 'Execute' lines shows a prepared statement
after substitution of data values for '?' parameters.


File: manual.info.tmp,  Node: c-api-prepared-statement-functions,  Next: c-api-thread-functions,  Prev: c-api-prepared-statement-function-overview,  Up: c-api

23.7.10 C API Prepared Statement Function Descriptions
------------------------------------------------------

* Menu:

* mysql-stmt-affected-rows::     mysql_stmt_affected_rows()
* mysql-stmt-attr-get::          mysql_stmt_attr_get()
* mysql-stmt-attr-set::          mysql_stmt_attr_set()
* mysql-stmt-bind-param::        mysql_stmt_bind_param()
* mysql-stmt-bind-result::       mysql_stmt_bind_result()
* mysql-stmt-close::             mysql_stmt_close()
* mysql-stmt-data-seek::         mysql_stmt_data_seek()
* mysql-stmt-errno::             mysql_stmt_errno()
* mysql-stmt-error::             mysql_stmt_error()
* mysql-stmt-execute::           mysql_stmt_execute()
* mysql-stmt-fetch::             mysql_stmt_fetch()
* mysql-stmt-fetch-column::      mysql_stmt_fetch_column()
* mysql-stmt-field-count::       mysql_stmt_field_count()
* mysql-stmt-free-result::       mysql_stmt_free_result()
* mysql-stmt-init::              mysql_stmt_init()
* mysql-stmt-insert-id::         mysql_stmt_insert_id()
* mysql-stmt-next-result::       mysql_stmt_next_result()
* mysql-stmt-num-rows::          mysql_stmt_num_rows()
* mysql-stmt-param-count::       mysql_stmt_param_count()
* mysql-stmt-param-metadata::    mysql_stmt_param_metadata()
* mysql-stmt-prepare::           mysql_stmt_prepare()
* mysql-stmt-reset::             mysql_stmt_reset()
* mysql-stmt-result-metadata::   mysql_stmt_result_metadata()
* mysql-stmt-row-seek::          mysql_stmt_row_seek()
* mysql-stmt-row-tell::          mysql_stmt_row_tell()
* mysql-stmt-send-long-data::    mysql_stmt_send_long_data()
* mysql-stmt-sqlstate::          mysql_stmt_sqlstate()
* mysql-stmt-store-result::      mysql_stmt_store_result()

To prepare and execute queries, use the functions described in detail in
the following sections.

All functions that operate with a 'MYSQL_STMT' structure begin with the
prefix 'mysql_stmt_'.

To create a 'MYSQL_STMT' handler, use the *note 'mysql_stmt_init()':
mysql-stmt-init. function.


File: manual.info.tmp,  Node: mysql-stmt-affected-rows,  Next: mysql-stmt-attr-get,  Prev: c-api-prepared-statement-functions,  Up: c-api-prepared-statement-functions

23.7.10.1 mysql_stmt_affected_rows()
....................................

'my_ulonglong mysql_stmt_affected_rows(MYSQL_STMT *stmt)'

*Description*

*note 'mysql_stmt_affected_rows()': mysql-stmt-affected-rows. may be
called immediately after executing a statement with *note
'mysql_stmt_execute()': mysql-stmt-execute.  It is like *note
'mysql_affected_rows()': mysql-affected-rows. but for prepared
statements.  For a description of what the affected-rows value returned
by this function means, See *note mysql-affected-rows::.

*Errors*

None.

*Example*

See the Example in *note mysql-stmt-execute::.


File: manual.info.tmp,  Node: mysql-stmt-attr-get,  Next: mysql-stmt-attr-set,  Prev: mysql-stmt-affected-rows,  Up: c-api-prepared-statement-functions

23.7.10.2 mysql_stmt_attr_get()
...............................

'my_bool mysql_stmt_attr_get(MYSQL_STMT *stmt, enum enum_stmt_attr_type
option, void *arg)'

*Description*

Can be used to get the current value for a statement attribute.

The 'option' argument is the option that you want to get; the 'arg'
should point to a variable that should contain the option value.  If the
option is an integer, 'arg' should point to the value of the integer.

See *note mysql-stmt-attr-set::, for a list of options and option types.

*Return Values*

Zero for success.  Nonzero if 'option' is unknown.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-stmt-attr-set,  Next: mysql-stmt-bind-param,  Prev: mysql-stmt-attr-get,  Up: c-api-prepared-statement-functions

23.7.10.3 mysql_stmt_attr_set()
...............................

'my_bool mysql_stmt_attr_set(MYSQL_STMT *stmt, enum enum_stmt_attr_type
option, const void *arg)'

*Description*

Can be used to affect behavior for a prepared statement.  This function
may be called multiple times to set several options.

The 'option' argument is the option that you want to set.  The 'arg'
argument is the value for the option.  'arg' should point to a variable
that is set to the desired attribute value.  The variable type is as
indicated in the following table.

The following table shows the possible 'option' values.

Option                         Argument       Function
                               Type           
                               
'STMT_ATTR_UPDATE_MAX_LENGTH'  'my_bool *'    If set to 1, causes
                                              *note 'mysql_stmt_store_result()': mysql-stmt-store-result.
                                              to update the metadata
                                              'MYSQL_FIELD->max_length'
                                              value.
                                              
'STMT_ATTR_CURSOR_TYPE'        'unsigned      Type of cursor to open
                               long *'        for statement when
                                              *note 'mysql_stmt_execute()': mysql-stmt-execute.
                                              is invoked.  '*arg' can
                                              be
                                              'CURSOR_TYPE_NO_CURSOR'
                                              (the default) or
                                              'CURSOR_TYPE_READ_ONLY'.
                                              
'STMT_ATTR_PREFETCH_ROWS'      'unsigned      Number of rows to fetch
                               long *'        from server at a time
                                              when using a cursor.
                                              '*arg' can be in the
                                              range from 1 to the
                                              maximum value of
                                              'unsigned long'.  The
                                              default is 1.

If you use the 'STMT_ATTR_CURSOR_TYPE' option with
'CURSOR_TYPE_READ_ONLY', a cursor is opened for the statement when you
invoke *note 'mysql_stmt_execute()': mysql-stmt-execute.  If there is
already an open cursor from a previous *note 'mysql_stmt_execute()':
mysql-stmt-execute. call, it closes the cursor before opening a new one.
*note 'mysql_stmt_reset()': mysql-stmt-reset. also closes any open
cursor before preparing the statement for re-execution.  *note
'mysql_stmt_free_result()': mysql-stmt-free-result. closes any open
cursor.

If you open a cursor for a prepared statement, *note
'mysql_stmt_store_result()': mysql-stmt-store-result. is unnecessary,
because that function causes the result set to be buffered on the client
side.

*Return Values*

Zero for success.  Nonzero if 'option' is unknown.

*Errors*

None.

*Example*

The following example opens a cursor for a prepared statement and sets
the number of rows to fetch at a time to 5:

     MYSQL_STMT *stmt;
     int rc;
     unsigned long type;
     unsigned long prefetch_rows = 5;

     stmt = mysql_stmt_init(mysql);
     type = (unsigned long) CURSOR_TYPE_READ_ONLY;
     rc = mysql_stmt_attr_set(stmt, STMT_ATTR_CURSOR_TYPE, (void*) &type);
     /* ... check return value ... */
     rc = mysql_stmt_attr_set(stmt, STMT_ATTR_PREFETCH_ROWS,
                              (void*) &prefetch_rows);
     /* ... check return value ... */


File: manual.info.tmp,  Node: mysql-stmt-bind-param,  Next: mysql-stmt-bind-result,  Prev: mysql-stmt-attr-set,  Up: c-api-prepared-statement-functions

23.7.10.4 mysql_stmt_bind_param()
.................................

'my_bool mysql_stmt_bind_param(MYSQL_STMT *stmt, MYSQL_BIND *bind)'

*Description*

*note 'mysql_stmt_bind_param()': mysql-stmt-bind-param. is used to bind
input data for the parameter markers in the SQL statement that was
passed to *note 'mysql_stmt_prepare()': mysql-stmt-prepare.  It uses
'MYSQL_BIND' structures to supply the data.  'bind' is the address of an
array of 'MYSQL_BIND' structures.  The client library expects the array
to contain one element for each '?' parameter marker that is present in
the query.

Suppose that you prepare the following statement:

     INSERT INTO mytbl VALUES(?,?,?)

When you bind the parameters, the array of 'MYSQL_BIND' structures must
contain three elements, and can be declared like this:

     MYSQL_BIND bind[3];

*note c-api-prepared-statement-data-structures::, describes the members
of each 'MYSQL_BIND' element and how they should be set to provide input
values.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_UNSUPPORTED_PARAM_TYPE'

     The conversion is not supported.  Possibly the 'buffer_type' value
     is invalid or is not one of the supported types.

   * 'CR_OUT_OF_MEMORY'

     Out of memory.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.

*Example*

See the Example in *note mysql-stmt-execute::.


File: manual.info.tmp,  Node: mysql-stmt-bind-result,  Next: mysql-stmt-close,  Prev: mysql-stmt-bind-param,  Up: c-api-prepared-statement-functions

23.7.10.5 mysql_stmt_bind_result()
..................................

'my_bool mysql_stmt_bind_result(MYSQL_STMT *stmt, MYSQL_BIND *bind)'

*Description*

*note 'mysql_stmt_bind_result()': mysql-stmt-bind-result. is used to
associate (that is, bind) output columns in the result set to data
buffers and length buffers.  When *note 'mysql_stmt_fetch()':
mysql-stmt-fetch. is called to fetch data, the MySQL client/server
protocol places the data for the bound columns into the specified
buffers.

All columns must be bound to buffers prior to calling *note
'mysql_stmt_fetch()': mysql-stmt-fetch.  'bind' is the address of an
array of 'MYSQL_BIND' structures.  The client library expects the array
to contain one element for each column of the result set.  If you do not
bind columns to 'MYSQL_BIND' structures, *note 'mysql_stmt_fetch()':
mysql-stmt-fetch. simply ignores the data fetch.  The buffers should be
large enough to hold the data values, because the protocol does not
return data values in chunks.

A column can be bound or rebound at any time, even after a result set
has been partially retrieved.  The new binding takes effect the next
time *note 'mysql_stmt_fetch()': mysql-stmt-fetch. is called.  Suppose
that an application binds the columns in a result set and calls *note
'mysql_stmt_fetch()': mysql-stmt-fetch.  The client/server protocol
returns data in the bound buffers.  Then suppose that the application
binds the columns to a different set of buffers.  The protocol places
data into the newly bound buffers when the next call to *note
'mysql_stmt_fetch()': mysql-stmt-fetch. occurs.

To bind a column, an application calls *note 'mysql_stmt_bind_result()':
mysql-stmt-bind-result. and passes the type, address, and length of the
output buffer into which the value should be stored.  *note
c-api-prepared-statement-data-structures::, describes the members of
each 'MYSQL_BIND' element and how they should be set to receive output
values.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_UNSUPPORTED_PARAM_TYPE'

     The conversion is not supported.  Possibly the 'buffer_type' value
     is invalid or is not one of the supported types.

   * 'CR_OUT_OF_MEMORY'

     Out of memory.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.

*Example*

See the Example in *note mysql-stmt-fetch::.


File: manual.info.tmp,  Node: mysql-stmt-close,  Next: mysql-stmt-data-seek,  Prev: mysql-stmt-bind-result,  Up: c-api-prepared-statement-functions

23.7.10.6 mysql_stmt_close()
............................

'my_bool mysql_stmt_close(MYSQL_STMT *stmt)'

*Description*

Closes the prepared statement.  *note 'mysql_stmt_close()':
mysql-stmt-close. also deallocates the statement handler pointed to by
'stmt', which at that point becomes invalid and should no longer be
used.  For a failed *note 'mysql_stmt_close()': mysql-stmt-close. call,
do not call *note 'mysql_stmt_error()': mysql-stmt-error, or *note
'mysql_stmt_errno()': mysql-stmt-errno, or *note
'mysql_stmt_sqlstate()': mysql-stmt-sqlstate. to obtain error
information because *note 'mysql_stmt_close()': mysql-stmt-close. makes
the statement handler invalid.  Call *note 'mysql_error()': mysql-error,
*note 'mysql_errno()': mysql-errno, or *note 'mysql_sqlstate()':
mysql-sqlstate. instead.

If the current statement has pending or unread results, this function
cancels them so that the next query can be executed.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.

*Example*

See the Example in *note mysql-stmt-execute::.


File: manual.info.tmp,  Node: mysql-stmt-data-seek,  Next: mysql-stmt-errno,  Prev: mysql-stmt-close,  Up: c-api-prepared-statement-functions

23.7.10.7 mysql_stmt_data_seek()
................................

'void mysql_stmt_data_seek(MYSQL_STMT *stmt, my_ulonglong offset)'

*Description*

Seeks to an arbitrary row in a statement result set.  The 'offset' value
is a row number and should be in the range from '0' to *note
'mysql_stmt_num_rows(stmt)-1': mysql-stmt-num-rows.

This function requires that the statement result set structure contains
the entire result of the last executed query, so *note
'mysql_stmt_data_seek()': mysql-stmt-data-seek. may be used only in
conjunction with *note 'mysql_stmt_store_result()':
mysql-stmt-store-result.

*Return Values*

None.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-stmt-errno,  Next: mysql-stmt-error,  Prev: mysql-stmt-data-seek,  Up: c-api-prepared-statement-functions

23.7.10.8 mysql_stmt_errno()
............................

'unsigned int mysql_stmt_errno(MYSQL_STMT *stmt)'

*Description*

For the statement specified by 'stmt', *note 'mysql_stmt_errno()':
mysql-stmt-errno. returns the error code for the most recently invoked
statement API function that can succeed or fail.  A return value of zero
means that no error occurred.  Client error message numbers are listed
in the MySQL 'errmsg.h' header file.  Server error message numbers are
listed in 'mysqld_error.h'.  Errors also are listed at *note
error-handling::.

If the failed statement API function was *note 'mysql_stmt_close()':
mysql-stmt-close, do not call or *note 'mysql_stmt_errno()':
mysql-stmt-errno. to obtain error information because *note
'mysql_stmt_close()': mysql-stmt-close. makes the statement handler
invalid.  Call *note 'mysql_errno()': mysql-errno. instead.

*Return Values*

An error code value.  Zero if no error occurred.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-stmt-error,  Next: mysql-stmt-execute,  Prev: mysql-stmt-errno,  Up: c-api-prepared-statement-functions

23.7.10.9 mysql_stmt_error()
............................

'const char *mysql_stmt_error(MYSQL_STMT *stmt)'

*Description*

For the statement specified by 'stmt', *note 'mysql_stmt_error()':
mysql-stmt-error. returns a null-terminated string containing the error
message for the most recently invoked statement API function that can
succeed or fail.  An empty string ('""') is returned if no error
occurred.  Either of these two tests can be used to check for an error:

     if(*mysql_stmt_errno(stmt))
     {
       // an error occurred
     }

     if (mysql_stmt_error(stmt)[0])
     {
       // an error occurred
     }

If the failed statement API function was *note 'mysql_stmt_close()':
mysql-stmt-close, do not call *note 'mysql_stmt_error()':
mysql-stmt-error. to obtain error information because *note
'mysql_stmt_close()': mysql-stmt-close. makes the statement handler
invalid.  Call *note 'mysql_error()': mysql-error. instead.

The language of the client error messages may be changed by recompiling
the MySQL client library.  You can choose error messages in several
different languages.

*Return Values*

A character string that describes the error.  An empty string if no
error occurred.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-stmt-execute,  Next: mysql-stmt-fetch,  Prev: mysql-stmt-error,  Up: c-api-prepared-statement-functions

23.7.10.10 mysql_stmt_execute()
...............................

'int mysql_stmt_execute(MYSQL_STMT *stmt)'

*Description*

*note 'mysql_stmt_execute()': mysql-stmt-execute. executes the prepared
query associated with the statement handler.  The currently bound
parameter marker values are sent to server during this call, and the
server replaces the markers with this newly supplied data.

Statement processing following *note 'mysql_stmt_execute()':
mysql-stmt-execute. depends on the type of statement:

   * For an *note 'UPDATE': update, *note 'DELETE': delete, or *note
     'INSERT': insert, the number of changed, deleted, or inserted rows
     can be found by calling *note 'mysql_stmt_affected_rows()':
     mysql-stmt-affected-rows.

   * For a statement such as *note 'SELECT': select. that generates a
     result set, you must call *note 'mysql_stmt_fetch()':
     mysql-stmt-fetch. to fetch the data prior to calling any other
     functions that result in query processing.  For more information on
     how to fetch the results, refer to *note mysql-stmt-fetch::.

     Do not following invocation of *note 'mysql_stmt_execute()':
     mysql-stmt-execute. with a call to *note 'mysql_store_result()':
     mysql-store-result. or *note 'mysql_use_result()':
     mysql-use-result.  Those functions are not intended for processing
     results from prepared statements.

For statements that generate a result set, you can request that *note
'mysql_stmt_execute()': mysql-stmt-execute. open a cursor for the
statement by calling *note 'mysql_stmt_attr_set()': mysql-stmt-attr-set.
before executing the statement.  If you execute a statement multiple
times, *note 'mysql_stmt_execute()': mysql-stmt-execute. closes any open
cursor before opening a new one.

Metadata changes to tables or views referred to by prepared statements
are detected and cause automatic repreparation of the statement when it
is next executed.  For more information, see *note
statement-repreparation::.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_OUT_OF_MEMORY'

     Out of memory.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.

*Example*

The following example demonstrates how to create and populate a table
using *note 'mysql_stmt_init()': mysql-stmt-init, *note
'mysql_stmt_prepare()': mysql-stmt-prepare, *note
'mysql_stmt_param_count()': mysql-stmt-param-count, *note
'mysql_stmt_bind_param()': mysql-stmt-bind-param, *note
'mysql_stmt_execute()': mysql-stmt-execute, and *note
'mysql_stmt_affected_rows()': mysql-stmt-affected-rows.  The 'mysql'
variable is assumed to be a valid connection handler.  For an example
that shows how to retrieve data, see *note mysql-stmt-fetch::.

     #define STRING_SIZE 50

     #define DROP_SAMPLE_TABLE "DROP TABLE IF EXISTS test_table"
     #define CREATE_SAMPLE_TABLE "CREATE TABLE test_table(col1 INT,\
                                                      col2 VARCHAR(40),\
                                                      col3 SMALLINT,\
                                                      col4 TIMESTAMP)"
     #define INSERT_SAMPLE "INSERT INTO \
                            test_table(col1,col2,col3) \
                            VALUES(?,?,?)"

     MYSQL_STMT    *stmt;
     MYSQL_BIND    bind[3];
     my_ulonglong  affected_rows;
     int           param_count;
     short         small_data;
     int           int_data;
     char          str_data[STRING_SIZE];
     unsigned long str_length;
     my_bool       is_null;

     if (mysql_query(mysql, DROP_SAMPLE_TABLE))
     {
       fprintf(stderr, " DROP TABLE failed\n");
       fprintf(stderr, " %s\n", mysql_error(mysql));
       exit(0);
     }

     if (mysql_query(mysql, CREATE_SAMPLE_TABLE))
     {
       fprintf(stderr, " CREATE TABLE failed\n");
       fprintf(stderr, " %s\n", mysql_error(mysql));
       exit(0);
     }

     /* Prepare an INSERT query with 3 parameters */
     /* (the TIMESTAMP column is not named; the server */
     /*  sets it to the current date and time) */
     stmt = mysql_stmt_init(mysql);
     if (!stmt)
     {
       fprintf(stderr, " mysql_stmt_init(), out of memory\n");
       exit(0);
     }
     if (mysql_stmt_prepare(stmt, INSERT_SAMPLE, strlen(INSERT_SAMPLE)))
     {
       fprintf(stderr, " mysql_stmt_prepare(), INSERT failed\n");
       fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
       exit(0);
     }
     fprintf(stdout, " prepare, INSERT successful\n");

     /* Get the parameter count from the statement */
     param_count= mysql_stmt_param_count(stmt);
     fprintf(stdout, " total parameters in INSERT: %d\n", param_count);

     if (param_count != 3) /* validate parameter count */
     {
       fprintf(stderr, " invalid parameter count returned by MySQL\n");
       exit(0);
     }

     /* Bind the data for all 3 parameters */

     memset(bind, 0, sizeof(bind));

     /* INTEGER PARAM */
     /* This is a number type, so there is no need
        to specify buffer_length */
     bind[0].buffer_type= MYSQL_TYPE_LONG;
     bind[0].buffer= (char *)&int_data;
     bind[0].is_null= 0;
     bind[0].length= 0;

     /* STRING PARAM */
     bind[1].buffer_type= MYSQL_TYPE_STRING;
     bind[1].buffer= (char *)str_data;
     bind[1].buffer_length= STRING_SIZE;
     bind[1].is_null= 0;
     bind[1].length= &str_length;

     /* SMALLINT PARAM */
     bind[2].buffer_type= MYSQL_TYPE_SHORT;
     bind[2].buffer= (char *)&small_data;
     bind[2].is_null= &is_null;
     bind[2].length= 0;

     /* Bind the buffers */
     if (mysql_stmt_bind_param(stmt, bind))
     {
       fprintf(stderr, " mysql_stmt_bind_param() failed\n");
       fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
       exit(0);
     }

     /* Specify the data values for the first row */
     int_data= 10;             /* integer */
     strncpy(str_data, "MySQL", STRING_SIZE); /* string  */
     str_length= strlen(str_data);

     /* INSERT SMALLINT data as NULL */
     is_null= 1;

     /* Execute the INSERT statement - 1*/
     if (mysql_stmt_execute(stmt))
     {
       fprintf(stderr, " mysql_stmt_execute(), 1 failed\n");
       fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
       exit(0);
     }

     /* Get the number of affected rows */
     affected_rows= mysql_stmt_affected_rows(stmt);
     fprintf(stdout, " total affected rows(insert 1): %lu\n",
                     (unsigned long) affected_rows);

     if (affected_rows != 1) /* validate affected rows */
     {
       fprintf(stderr, " invalid affected rows by MySQL\n");
       exit(0);
     }

     /* Specify data values for second row,
        then re-execute the statement */
     int_data= 1000;
     strncpy(str_data, "
             The most popular Open Source database",
             STRING_SIZE);
     str_length= strlen(str_data);
     small_data= 1000;         /* smallint */
     is_null= 0;               /* reset */

     /* Execute the INSERT statement - 2*/
     if (mysql_stmt_execute(stmt))
     {
       fprintf(stderr, " mysql_stmt_execute, 2 failed\n");
       fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
       exit(0);
     }

     /* Get the total rows affected */
     affected_rows= mysql_stmt_affected_rows(stmt);
     fprintf(stdout, " total affected rows(insert 2): %lu\n",
                     (unsigned long) affected_rows);

     if (affected_rows != 1) /* validate affected rows */
     {
       fprintf(stderr, " invalid affected rows by MySQL\n");
       exit(0);
     }

     /* Close the statement */
     if (mysql_stmt_close(stmt))
     {
       /* mysql_stmt_close() invalidates stmt, so call          */
       /* mysql_error(mysql) rather than mysql_stmt_error(stmt) */
       fprintf(stderr, " failed while closing the statement\n");
       fprintf(stderr, " %s\n", mysql_error(mysql));
       exit(0);
     }

*Note*:

For complete examples on the use of prepared statement functions, refer
to the file 'tests/mysql_client_test.c'.  This file can be obtained from
a MySQL source distribution or from the source repository (see *note
source-installation::).


File: manual.info.tmp,  Node: mysql-stmt-fetch,  Next: mysql-stmt-fetch-column,  Prev: mysql-stmt-execute,  Up: c-api-prepared-statement-functions

23.7.10.11 mysql_stmt_fetch()
.............................

'int mysql_stmt_fetch(MYSQL_STMT *stmt)'

*Description*

*note 'mysql_stmt_fetch()': mysql-stmt-fetch. returns the next row in
the result set.  It can be called only while the result set exists; that
is, after a call to *note 'mysql_stmt_execute()': mysql-stmt-execute.
for a statement such as *note 'SELECT': select. that produces a result
set.

*note 'mysql_stmt_fetch()': mysql-stmt-fetch. returns row data using the
buffers bound by *note 'mysql_stmt_bind_result()':
mysql-stmt-bind-result.  It returns the data in those buffers for all
the columns in the current row set and the lengths are returned to the
'length' pointer.  All columns must be bound by the application before
it calls *note 'mysql_stmt_fetch()': mysql-stmt-fetch.

*note 'mysql_stmt_fetch()': mysql-stmt-fetch. typically occurs within a
loop, to ensure that all result set rows are fetched.  For example:

     int status;

     while (1)
     {
       status = mysql_stmt_fetch(stmt);

       if (status == 1 || status == MYSQL_NO_DATA)
         break;

       /* handle current row here */
     }

     /* if desired, handle status == 1 case and display error here */

By default, result sets are fetched unbuffered a row at a time from the
server.  To buffer the entire result set on the client, call *note
'mysql_stmt_store_result()': mysql-stmt-store-result. after binding the
data buffers and before calling *note 'mysql_stmt_fetch()':
mysql-stmt-fetch.

If a fetched data value is a 'NULL' value, the '*is_null' value of the
corresponding 'MYSQL_BIND' structure contains TRUE (1).  Otherwise, the
data and its length are returned in the '*buffer' and '*length' elements
based on the buffer type specified by the application.  Each numeric and
temporal type has a fixed length, as listed in the following table.  The
length of the string types depends on the length of the actual data
value, as indicated by 'data_length'.

Type                                 Length
                                     
'MYSQL_TYPE_TINY'                    1
                                     
'MYSQL_TYPE_SHORT'                   2
                                     
'MYSQL_TYPE_LONG'                    4
                                     
'MYSQL_TYPE_LONGLONG'                8
                                     
'MYSQL_TYPE_FLOAT'                   4
                                     
'MYSQL_TYPE_DOUBLE'                  8
                                     
'MYSQL_TYPE_TIME'                    'sizeof(MYSQL_TIME)'
                                     
'MYSQL_TYPE_DATE'                    'sizeof(MYSQL_TIME)'
                                     
'MYSQL_TYPE_DATETIME'                'sizeof(MYSQL_TIME)'
                                     
'MYSQL_TYPE_STRING'                  'data length'
                                     
'MYSQL_TYPE_BLOB'                    'data_length'

In some cases, you might want to determine the length of a column value
before fetching it with *note 'mysql_stmt_fetch()': mysql-stmt-fetch.
For example, the value might be a long string or *note 'BLOB': blob.
value for which you want to know how much space must be allocated.  To
accomplish this, use one of these strategies:

   * Before invoking *note 'mysql_stmt_fetch()': mysql-stmt-fetch. to
     retrieve individual rows, pass 'STMT_ATTR_UPDATE_MAX_LENGTH' to
     *note 'mysql_stmt_attr_set()': mysql-stmt-attr-set, then invoke
     *note 'mysql_stmt_store_result()': mysql-stmt-store-result. to
     buffer the entire result on the client side.  Setting the
     'STMT_ATTR_UPDATE_MAX_LENGTH' attribute causes the maximal length
     of column values to be indicated by the 'max_length' member of the
     result set metadata returned by *note
     'mysql_stmt_result_metadata()': mysql-stmt-result-metadata.

   * Invoke *note 'mysql_stmt_fetch()': mysql-stmt-fetch. with a
     zero-length buffer for the column in question and a pointer in
     which the real length can be stored.  Then use the real length with
     *note 'mysql_stmt_fetch_column()': mysql-stmt-fetch-column.

          real_length= 0;

          bind[0].buffer= 0;
          bind[0].buffer_length= 0;
          bind[0].length= &real_length
          mysql_stmt_bind_result(stmt, bind);

          mysql_stmt_fetch(stmt);
          if (real_length > 0)
          {
            data= malloc(real_length);
            bind[0].buffer= data;
            bind[0].buffer_length= real_length;
            mysql_stmt_fetch_column(stmt, bind, 0, 0);
          }

*Return Values*

Return Value              Description
                          
0                         Success, the data has been fetched to
                          application data buffers.
                          
1                         Error occurred.  Error code and message can
                          be obtained by calling
                          *note 'mysql_stmt_errno()': mysql-stmt-errno.
                          and
                          *note 'mysql_stmt_error()': mysql-stmt-error.
                          
'MYSQL_NO_DATA'           Success, no more data exists
                          
'MYSQL_DATA_TRUNCATED'    Data truncation occurred

'MYSQL_DATA_TRUNCATED' is returned when truncation reporting is enabled.
To determine which column values were truncated when this value is
returned, check the 'error' members of the 'MYSQL_BIND' structures used
for fetching values.  Truncation reporting is enabled by default, but
can be controlled by calling *note 'mysql_options()': mysql-options.
with the 'MYSQL_REPORT_DATA_TRUNCATION' option.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

     Although *note 'mysql_stmt_fetch()': mysql-stmt-fetch. can produce
     this error, it is more likely to occur for the _following_ C API
     call if *note 'mysql_stmt_fetch()': mysql-stmt-fetch. is not called
     enough times to read the entire result set (that is, enough times
     to return 'MYSQL_NO_DATA').

   * 'CR_OUT_OF_MEMORY'

     Out of memory.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.

   * 'CR_UNSUPPORTED_PARAM_TYPE'

     The buffer type is 'MYSQL_TYPE_DATE', 'MYSQL_TYPE_TIME',
     'MYSQL_TYPE_DATETIME', or 'MYSQL_TYPE_TIMESTAMP', but the data type
     is not *note 'DATE': datetime, *note 'TIME': time, *note
     'DATETIME': datetime, or *note 'TIMESTAMP': datetime.

   * All other unsupported conversion errors are returned from *note
     'mysql_stmt_bind_result()': mysql-stmt-bind-result.

*Example*

The following example demonstrates how to fetch data from a table using
*note 'mysql_stmt_result_metadata()': mysql-stmt-result-metadata, *note
'mysql_stmt_bind_result()': mysql-stmt-bind-result, and *note
'mysql_stmt_fetch()': mysql-stmt-fetch.  (This example expects to
retrieve the two rows inserted by the example shown in *note
mysql-stmt-execute::.)  The 'mysql' variable is assumed to be a valid
connection handler.

     #define STRING_SIZE 50

     #define SELECT_SAMPLE "SELECT col1, col2, col3, col4 \
                            FROM test_table"

     MYSQL_STMT    *stmt;
     MYSQL_BIND    bind[4];
     MYSQL_RES     *prepare_meta_result;
     MYSQL_TIME    ts;
     unsigned long length[4];
     int           param_count, column_count, row_count;
     short         small_data;
     int           int_data;
     char          str_data[STRING_SIZE];
     my_bool       is_null[4];
     my_bool       error[4];

     /* Prepare a SELECT query to fetch data from test_table */
     stmt = mysql_stmt_init(mysql);
     if (!stmt)
     {
       fprintf(stderr, " mysql_stmt_init(), out of memory\n");
       exit(0);
     }
     if (mysql_stmt_prepare(stmt, SELECT_SAMPLE, strlen(SELECT_SAMPLE)))
     {
       fprintf(stderr, " mysql_stmt_prepare(), SELECT failed\n");
       fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
       exit(0);
     }
     fprintf(stdout, " prepare, SELECT successful\n");

     /* Get the parameter count from the statement */
     param_count= mysql_stmt_param_count(stmt);
     fprintf(stdout, " total parameters in SELECT: %d\n", param_count);

     if (param_count != 0) /* validate parameter count */
     {
       fprintf(stderr, " invalid parameter count returned by MySQL\n");
       exit(0);
     }

     /* Fetch result set meta information */
     prepare_meta_result = mysql_stmt_result_metadata(stmt);
     if (!prepare_meta_result)
     {
       fprintf(stderr,
              " mysql_stmt_result_metadata(), \
                returned no meta information\n");
       fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
       exit(0);
     }

     /* Get total columns in the query */
     column_count= mysql_num_fields(prepare_meta_result);
     fprintf(stdout,
             " total columns in SELECT statement: %d\n",
             column_count);

     if (column_count != 4) /* validate column count */
     {
       fprintf(stderr, " invalid column count returned by MySQL\n");
       exit(0);
     }

     /* Execute the SELECT query */
     if (mysql_stmt_execute(stmt))
     {
       fprintf(stderr, " mysql_stmt_execute(), failed\n");
       fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
       exit(0);
     }

     /* Bind the result buffers for all 4 columns before fetching them */

     memset(bind, 0, sizeof(bind));

     /* INTEGER COLUMN */
     bind[0].buffer_type= MYSQL_TYPE_LONG;
     bind[0].buffer= (char *)&int_data;
     bind[0].is_null= &is_null[0];
     bind[0].length= &length[0];
     bind[0].error= &error[0];

     /* STRING COLUMN */
     bind[1].buffer_type= MYSQL_TYPE_STRING;
     bind[1].buffer= (char *)str_data;
     bind[1].buffer_length= STRING_SIZE;
     bind[1].is_null= &is_null[1];
     bind[1].length= &length[1];
     bind[1].error= &error[1];

     /* SMALLINT COLUMN */
     bind[2].buffer_type= MYSQL_TYPE_SHORT;
     bind[2].buffer= (char *)&small_data;
     bind[2].is_null= &is_null[2];
     bind[2].length= &length[2];
     bind[2].error= &error[2];

     /* TIMESTAMP COLUMN */
     bind[3].buffer_type= MYSQL_TYPE_TIMESTAMP;
     bind[3].buffer= (char *)&ts;
     bind[3].is_null= &is_null[3];
     bind[3].length= &length[3];
     bind[3].error= &error[3];

     /* Bind the result buffers */
     if (mysql_stmt_bind_result(stmt, bind))
     {
       fprintf(stderr, " mysql_stmt_bind_result() failed\n");
       fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
       exit(0);
     }

     /* Now buffer all results to client (optional step) */
     if (mysql_stmt_store_result(stmt))
     {
       fprintf(stderr, " mysql_stmt_store_result() failed\n");
       fprintf(stderr, " %s\n", mysql_stmt_error(stmt));
       exit(0);
     }

     /* Fetch all rows */
     row_count= 0;
     fprintf(stdout, "Fetching results ...\n");
     while (!mysql_stmt_fetch(stmt))
     {
       row_count++;
       fprintf(stdout, "  row %d\n", row_count);

       /* column 1 */
       fprintf(stdout, "   column1 (integer)  : ");
       if (is_null[0])
         fprintf(stdout, " NULL\n");
       else
         fprintf(stdout, " %d(%ld)\n", int_data, length[0]);

       /* column 2 */
       fprintf(stdout, "   column2 (string)   : ");
       if (is_null[1])
         fprintf(stdout, " NULL\n");
       else
         fprintf(stdout, " %s(%ld)\n", str_data, length[1]);

       /* column 3 */
       fprintf(stdout, "   column3 (smallint) : ");
       if (is_null[2])
         fprintf(stdout, " NULL\n");
       else
         fprintf(stdout, " %d(%ld)\n", small_data, length[2]);

       /* column 4 */
       fprintf(stdout, "   column4 (timestamp): ");
       if (is_null[3])
         fprintf(stdout, " NULL\n");
       else
         fprintf(stdout, " %04d-%02d-%02d %02d:%02d:%02d (%ld)\n",
                          ts.year, ts.month, ts.day,
                          ts.hour, ts.minute, ts.second,
                          length[3]);
       fprintf(stdout, "\n");
     }

     /* Validate rows fetched */
     fprintf(stdout, " total rows fetched: %d\n", row_count);
     if (row_count != 2)
     {
       fprintf(stderr, " MySQL failed to return all rows\n");
       exit(0);
     }

     /* Free the prepared result metadata */
     mysql_free_result(prepare_meta_result);

     /* Close the statement */
     if (mysql_stmt_close(stmt))
     {
       /* mysql_stmt_close() invalidates stmt, so call          */
       /* mysql_error(mysql) rather than mysql_stmt_error(stmt) */
       fprintf(stderr, " failed while closing the statement\n");
       fprintf(stderr, " %s\n", mysql_error(mysql));
       exit(0);
     }


File: manual.info.tmp,  Node: mysql-stmt-fetch-column,  Next: mysql-stmt-field-count,  Prev: mysql-stmt-fetch,  Up: c-api-prepared-statement-functions

23.7.10.12 mysql_stmt_fetch_column()
....................................

'int mysql_stmt_fetch_column(MYSQL_STMT *stmt, MYSQL_BIND *bind,
unsigned int column, unsigned long offset)'

*Description*

Fetches one column from the current result set row.  'bind' provides the
buffer where data should be placed.  It should be set up the same way as
for *note 'mysql_stmt_bind_result()': mysql-stmt-bind-result.  'column'
indicates which column to fetch.  The first column is numbered 0.
'offset' is the offset within the data value at which to begin
retrieving data.  This can be used for fetching the data value in
pieces.  The beginning of the value is offset 0.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_INVALID_PARAMETER_NO'

     Invalid column number.

   * 'CR_NO_DATA'

     The end of the result set has already been reached.


File: manual.info.tmp,  Node: mysql-stmt-field-count,  Next: mysql-stmt-free-result,  Prev: mysql-stmt-fetch-column,  Up: c-api-prepared-statement-functions

23.7.10.13 mysql_stmt_field_count()
...................................

'unsigned int mysql_stmt_field_count(MYSQL_STMT *stmt)'

*Description*

Returns the number of columns for the most recent statement for the
statement handler.  This value is zero for statements such as *note
'INSERT': insert. or *note 'DELETE': delete. that do not produce result
sets.

*note 'mysql_stmt_field_count()': mysql-stmt-field-count. can be called
after you have prepared a statement by invoking *note
'mysql_stmt_prepare()': mysql-stmt-prepare.

*Return Values*

An unsigned integer representing the number of columns in a result set.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-stmt-free-result,  Next: mysql-stmt-init,  Prev: mysql-stmt-field-count,  Up: c-api-prepared-statement-functions

23.7.10.14 mysql_stmt_free_result()
...................................

'my_bool mysql_stmt_free_result(MYSQL_STMT *stmt)'

*Description*

Releases memory associated with the result set produced by execution of
the prepared statement.  If there is a cursor open for the statement,
*note 'mysql_stmt_free_result()': mysql-stmt-free-result. closes it.

*Return Values*

Zero for success.  Nonzero if an error occurred.


File: manual.info.tmp,  Node: mysql-stmt-init,  Next: mysql-stmt-insert-id,  Prev: mysql-stmt-free-result,  Up: c-api-prepared-statement-functions

23.7.10.15 mysql_stmt_init()
............................

'MYSQL_STMT *mysql_stmt_init(MYSQL *mysql)'

*Description*

Creates and returns a 'MYSQL_STMT' handler.  The handler should be freed
with *note 'mysql_stmt_close()': mysql-stmt-close, at which point the
handler becomes invalid and should no longer be used.

See also *note c-api-prepared-statement-data-structures::, for more
information.

*Return Values*

A pointer to a 'MYSQL_STMT' structure in case of success.  'NULL' if out
of memory.

*Errors*

   * 'CR_OUT_OF_MEMORY'

     Out of memory.


File: manual.info.tmp,  Node: mysql-stmt-insert-id,  Next: mysql-stmt-next-result,  Prev: mysql-stmt-init,  Up: c-api-prepared-statement-functions

23.7.10.16 mysql_stmt_insert_id()
.................................

'my_ulonglong mysql_stmt_insert_id(MYSQL_STMT *stmt)'

*Description*

Returns the value generated for an 'AUTO_INCREMENT' column by the
prepared *note 'INSERT': insert. or *note 'UPDATE': update. statement.
Use this function after you have executed a prepared *note 'INSERT':
insert. statement on a table which contains an 'AUTO_INCREMENT' field.

See *note mysql-insert-id::, for more information.

*Return Values*

Value for 'AUTO_INCREMENT' column which was automatically generated or
explicitly set during execution of prepared statement, or value
generated by 'LAST_INSERT_ID(EXPR)' function.  Return value is undefined
if statement does not set 'AUTO_INCREMENT' value.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-stmt-next-result,  Next: mysql-stmt-num-rows,  Prev: mysql-stmt-insert-id,  Up: c-api-prepared-statement-functions

23.7.10.17 mysql_stmt_next_result()
...................................

'int mysql_stmt_next_result(MYSQL_STMT *mysql)'

*Description*

This function is used when you use prepared *note 'CALL': call.
statements to execute stored procedures, which can return multiple
result sets.  Use a loop that calls *note 'mysql_stmt_next_result()':
mysql-stmt-next-result. to determine whether there are more results.  If
a procedure has 'OUT' or 'INOUT' parameters, their values will be
returned as a single-row result set following any other result sets.
The values will appear in the order in which they are declared in the
procedure parameter list.

For information about the effect of unhandled conditions on procedure
parameters, see *note conditions-and-parameters::.

*note 'mysql_stmt_next_result()': mysql-stmt-next-result. returns a
status to indicate whether more results exist.  If *note
'mysql_stmt_next_result()': mysql-stmt-next-result. returns an error,
there are no more results.

Before each call to *note 'mysql_stmt_next_result()':
mysql-stmt-next-result, you must call *note 'mysql_stmt_free_result()':
mysql-stmt-free-result. for the current result if it produced a result
set (rather than just a result status).

After calling *note 'mysql_stmt_next_result()': mysql-stmt-next-result.
the state of the connection is as if you had called *note
'mysql_stmt_execute()': mysql-stmt-execute.  This means that you can
call *note 'mysql_stmt_bind_result()': mysql-stmt-bind-result, *note
'mysql_stmt_affected_rows()': mysql-stmt-affected-rows, and so forth.

It is also possible to test whether there are more results by calling
*note 'mysql_more_results()': mysql-more-results.  However, this
function does not change the connection state, so if it returns true,
you must still call *note 'mysql_stmt_next_result()':
mysql-stmt-next-result. to advance to the next result.

For an example that shows how to use *note 'mysql_stmt_next_result()':
mysql-stmt-next-result, see *note c-api-prepared-call-statements::.

*Return Values*

Return Value              Description
                          
0                         Successful and there are more results
                          
-1                        Successful and there are no more results
                          
>0                        An error occurred

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-stmt-num-rows,  Next: mysql-stmt-param-count,  Prev: mysql-stmt-next-result,  Up: c-api-prepared-statement-functions

23.7.10.18 mysql_stmt_num_rows()
................................

'my_ulonglong mysql_stmt_num_rows(MYSQL_STMT *stmt)'

*Description*

Returns the number of rows in the result set.

The use of *note 'mysql_stmt_num_rows()': mysql-stmt-num-rows. depends
on whether you used *note 'mysql_stmt_store_result()':
mysql-stmt-store-result. to buffer the entire result set in the
statement handler.  If you use *note 'mysql_stmt_store_result()':
mysql-stmt-store-result, *note 'mysql_stmt_num_rows()':
mysql-stmt-num-rows. may be called immediately.  Otherwise, the row
count is unavailable unless you count the rows as you fetch them.

*note 'mysql_stmt_num_rows()': mysql-stmt-num-rows. is intended for use
with statements that return a result set, such as *note 'SELECT':
select.  For statements such as *note 'INSERT': insert, *note 'UPDATE':
update, or *note 'DELETE': delete, the number of affected rows can be
obtained with *note 'mysql_stmt_affected_rows()':
mysql-stmt-affected-rows.

*Return Values*

The number of rows in the result set.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-stmt-param-count,  Next: mysql-stmt-param-metadata,  Prev: mysql-stmt-num-rows,  Up: c-api-prepared-statement-functions

23.7.10.19 mysql_stmt_param_count()
...................................

'unsigned long mysql_stmt_param_count(MYSQL_STMT *stmt)'

*Description*

Returns the number of parameter markers present in the prepared
statement.

*Return Values*

An unsigned long integer representing the number of parameters in a
statement.

*Errors*

None.

*Example*

See the Example in *note mysql-stmt-execute::.


File: manual.info.tmp,  Node: mysql-stmt-param-metadata,  Next: mysql-stmt-prepare,  Prev: mysql-stmt-param-count,  Up: c-api-prepared-statement-functions

23.7.10.20 mysql_stmt_param_metadata()
......................................

'MYSQL_RES *mysql_stmt_param_metadata(MYSQL_STMT *stmt)'

This function currently does nothing.


File: manual.info.tmp,  Node: mysql-stmt-prepare,  Next: mysql-stmt-reset,  Prev: mysql-stmt-param-metadata,  Up: c-api-prepared-statement-functions

23.7.10.21 mysql_stmt_prepare()
...............................

'int mysql_stmt_prepare(MYSQL_STMT *stmt, const char *stmt_str, unsigned
long length)'

*Description*

Given the statement handler returned by *note 'mysql_stmt_init()':
mysql-stmt-init, prepares the SQL statement pointed to by the string
'stmt_str' and returns a status value.  The string length should be
given by the 'length' argument.  The string must consist of a single SQL
statement.  You should not add a terminating semicolon (';') or '\g' to
the statement.

The application can include one or more parameter markers in the SQL
statement by embedding question mark ('?') characters into the SQL
string at the appropriate positions.

The markers are legal only in certain places in SQL statements.  For
example, they are permitted in the 'VALUES()' list of an *note 'INSERT':
insert. statement (to specify column values for a row), or in a
comparison with a column in a 'WHERE' clause to specify a comparison
value.  However, they are not permitted for identifiers (such as table
or column names), or to specify both operands of a binary operator such
as the '=' equal sign.  The latter restriction is necessary because it
would be impossible to determine the parameter type.  In general,
parameters are legal only in Data Manipulation Language (DML)
statements, and not in Data Definition Language (DDL) statements.

The parameter markers must be bound to application variables using *note
'mysql_stmt_bind_param()': mysql-stmt-bind-param. before executing the
statement.

Metadata changes to tables or views referred to by prepared statements
are detected and cause automatic repreparation of the statement when it
is next executed.  For more information, see *note
statement-repreparation::.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_OUT_OF_MEMORY'

     Out of memory.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.

If the prepare operation was unsuccessful (that is, *note
'mysql_stmt_prepare()': mysql-stmt-prepare. returns nonzero), the error
message can be obtained by calling *note 'mysql_stmt_error()':
mysql-stmt-error.

*Example*

See the Example in *note mysql-stmt-execute::.


File: manual.info.tmp,  Node: mysql-stmt-reset,  Next: mysql-stmt-result-metadata,  Prev: mysql-stmt-prepare,  Up: c-api-prepared-statement-functions

23.7.10.22 mysql_stmt_reset()
.............................

'my_bool mysql_stmt_reset(MYSQL_STMT *stmt)'

*Description*

Resets a prepared statement on client and server to state after prepare.
It resets the statement on the server, data sent using *note
'mysql_stmt_send_long_data()': mysql-stmt-send-long-data, unbuffered
result sets and current errors.  It does not clear bindings or stored
result sets.  Stored result sets will be cleared when executing the
prepared statement (or closing it).

To re-prepare the statement with another query, use *note
'mysql_stmt_prepare()': mysql-stmt-prepare.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: mysql-stmt-result-metadata,  Next: mysql-stmt-row-seek,  Prev: mysql-stmt-reset,  Up: c-api-prepared-statement-functions

23.7.10.23 mysql_stmt_result_metadata()
.......................................

'MYSQL_RES *mysql_stmt_result_metadata(MYSQL_STMT *stmt)'

*Description*

If a statement passed to *note 'mysql_stmt_prepare()':
mysql-stmt-prepare. is one that produces a result set, *note
'mysql_stmt_result_metadata()': mysql-stmt-result-metadata. returns the
result set metadata in the form of a pointer to a 'MYSQL_RES' structure
that can be used to process the meta information such as number of
fields and individual field information.  This result set pointer can be
passed as an argument to any of the field-based API functions that
process result set metadata, such as:

   * *note 'mysql_num_fields()': mysql-num-fields.

   * *note 'mysql_fetch_field()': mysql-fetch-field.

   * *note 'mysql_fetch_field_direct()': mysql-fetch-field-direct.

   * *note 'mysql_fetch_fields()': mysql-fetch-fields.

   * *note 'mysql_field_count()': mysql-field-count.

   * *note 'mysql_field_seek()': mysql-field-seek.

   * *note 'mysql_field_tell()': mysql-field-tell.

   * *note 'mysql_free_result()': mysql-free-result.

The result set structure should be freed when you are done with it,
which you can do by passing it to *note 'mysql_free_result()':
mysql-free-result.  This is similar to the way you free a result set
obtained from a call to *note 'mysql_store_result()':
mysql-store-result.

The result set returned by *note 'mysql_stmt_result_metadata()':
mysql-stmt-result-metadata. contains only metadata.  It does not contain
any row results.  The rows are obtained by using the statement handler
with *note 'mysql_stmt_fetch()': mysql-stmt-fetch.

*Return Values*

A 'MYSQL_RES' result structure.  'NULL' if no meta information exists
for the prepared query.

*Errors*

   * 'CR_OUT_OF_MEMORY'

     Out of memory.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.

*Example*

See the Example in *note mysql-stmt-fetch::.


File: manual.info.tmp,  Node: mysql-stmt-row-seek,  Next: mysql-stmt-row-tell,  Prev: mysql-stmt-result-metadata,  Up: c-api-prepared-statement-functions

23.7.10.24 mysql_stmt_row_seek()
................................

'MYSQL_ROW_OFFSET mysql_stmt_row_seek(MYSQL_STMT *stmt, MYSQL_ROW_OFFSET
offset)'

*Description*

Sets the row cursor to an arbitrary row in a statement result set.  The
'offset' value is a row offset that should be a value returned from
*note 'mysql_stmt_row_tell()': mysql-stmt-row-tell. or from *note
'mysql_stmt_row_seek()': mysql-stmt-row-seek.  This value is not a row
number; if you want to seek to a row within a result set by number, use
*note 'mysql_stmt_data_seek()': mysql-stmt-data-seek. instead.

This function requires that the result set structure contains the entire
result of the query, so *note 'mysql_stmt_row_seek()':
mysql-stmt-row-seek. may be used only in conjunction with *note
'mysql_stmt_store_result()': mysql-stmt-store-result.

*Return Values*

The previous value of the row cursor.  This value may be passed to a
subsequent call to *note 'mysql_stmt_row_seek()': mysql-stmt-row-seek.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-stmt-row-tell,  Next: mysql-stmt-send-long-data,  Prev: mysql-stmt-row-seek,  Up: c-api-prepared-statement-functions

23.7.10.25 mysql_stmt_row_tell()
................................

'MYSQL_ROW_OFFSET mysql_stmt_row_tell(MYSQL_STMT *stmt)'

*Description*

Returns the current position of the row cursor for the last *note
'mysql_stmt_fetch()': mysql-stmt-fetch.  This value can be used as an
argument to *note 'mysql_stmt_row_seek()': mysql-stmt-row-seek.

You should use *note 'mysql_stmt_row_tell()': mysql-stmt-row-tell. only
after *note 'mysql_stmt_store_result()': mysql-stmt-store-result.

*Return Values*

The current offset of the row cursor.

*Errors*

None.


File: manual.info.tmp,  Node: mysql-stmt-send-long-data,  Next: mysql-stmt-sqlstate,  Prev: mysql-stmt-row-tell,  Up: c-api-prepared-statement-functions

23.7.10.26 mysql_stmt_send_long_data()
......................................

'my_bool mysql_stmt_send_long_data(MYSQL_STMT *stmt, unsigned int
parameter_number, const char *data, unsigned long length)'

*Description*

Enables an application to send parameter data to the server in pieces
(or 'chunks').  Call this function after *note
'mysql_stmt_bind_param()': mysql-stmt-bind-param. and before *note
'mysql_stmt_execute()': mysql-stmt-execute.  It can be called multiple
times to send the parts of a character or binary data value for a
column, which must be one of the *note 'TEXT': blob. or *note 'BLOB':
blob. data types.

'parameter_number' indicates which parameter to associate the data with.
Parameters are numbered beginning with 0.  'data' is a pointer to a
buffer containing data to be sent, and 'length' indicates the number of
bytes in the buffer.

*Note*:

The next *note 'mysql_stmt_execute()': mysql-stmt-execute. call ignores
the bind buffer for all parameters that have been used with *note
'mysql_stmt_send_long_data()': mysql-stmt-send-long-data. since last
*note 'mysql_stmt_execute()': mysql-stmt-execute. or *note
'mysql_stmt_reset()': mysql-stmt-reset.

If you want to reset/forget the sent data, you can do it with *note
'mysql_stmt_reset()': mysql-stmt-reset.  See *note mysql-stmt-reset::.

As of MySQL 5.5.11, the 'max_long_data_size' system variable controls
the maximum size of parameter values that can be sent with *note
'mysql_stmt_send_long_data()': mysql-stmt-send-long-data.  If this
variable not set at server startup, the default is the value of the
'max_allowed_packet' system variable.  'max_long_data_size' is
deprecated.  In MySQL 5.6, it is removed and the maximum parameter size
is controlled by 'max_allowed_packet'.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_INVALID_BUFFER_USE'

     The parameter does not have a string or binary type.

   * 'CR_INVALID_PARAMETER_NO'

     Invalid parameter number.

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_OUT_OF_MEMORY'

     Out of memory.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.

*Example*

The following example demonstrates how to send the data for a *note
'TEXT': blob. column in chunks.  It inserts the data value ''MySQL - The
most popular Open Source database'' into the 'text_column' column.  The
'mysql' variable is assumed to be a valid connection handler.

     #define INSERT_QUERY "INSERT INTO \
                           test_long_data(text_column) VALUES(?)"

     MYSQL_BIND bind[1];
     long       length;

     stmt = mysql_stmt_init(mysql);
     if (!stmt)
     {
       fprintf(stderr, " mysql_stmt_init(), out of memory\n");
       exit(0);
     }
     if (mysql_stmt_prepare(stmt, INSERT_QUERY, strlen(INSERT_QUERY)))
     {
       fprintf(stderr, "\n mysql_stmt_prepare(), INSERT failed");
       fprintf(stderr, "\n %s", mysql_stmt_error(stmt));
       exit(0);
     }
      memset(bind, 0, sizeof(bind));
      bind[0].buffer_type= MYSQL_TYPE_STRING;
      bind[0].length= &length;
      bind[0].is_null= 0;

     /* Bind the buffers */
     if (mysql_stmt_bind_param(stmt, bind))
     {
       fprintf(stderr, "\n param bind failed");
       fprintf(stderr, "\n %s", mysql_stmt_error(stmt));
       exit(0);
     }

      /* Supply data in chunks to server */
      if (mysql_stmt_send_long_data(stmt,0,"MySQL",5))
     {
       fprintf(stderr, "\n send_long_data failed");
       fprintf(stderr, "\n %s", mysql_stmt_error(stmt));
       exit(0);
     }

      /* Supply the next piece of data */
      if (mysql_stmt_send_long_data(stmt,0,
                " - The most popular Open Source database",40))
     {
       fprintf(stderr, "\n send_long_data failed");
       fprintf(stderr, "\n %s", mysql_stmt_error(stmt));
       exit(0);
     }

      /* Now, execute the query */
      if (mysql_stmt_execute(stmt))
     {
       fprintf(stderr, "\n mysql_stmt_execute failed");
       fprintf(stderr, "\n %s", mysql_stmt_error(stmt));
       exit(0);
     }


File: manual.info.tmp,  Node: mysql-stmt-sqlstate,  Next: mysql-stmt-store-result,  Prev: mysql-stmt-send-long-data,  Up: c-api-prepared-statement-functions

23.7.10.27 mysql_stmt_sqlstate()
................................

'const char *mysql_stmt_sqlstate(MYSQL_STMT *stmt)'

*Description*

For the statement specified by 'stmt', *note 'mysql_stmt_sqlstate()':
mysql-stmt-sqlstate. returns a null-terminated string containing the
SQLSTATE error code for the most recently invoked prepared statement API
function that can succeed or fail.  The error code consists of five
characters.  '"00000"' means 'no error.' The values are specified by
ANSI SQL and ODBC. For a list of possible values, see *note
error-handling::.

Not all MySQL errors are mapped to SQLSTATE codes.  The value '"HY000"'
(general error) is used for unmapped errors.

If the failed statement API function was *note 'mysql_stmt_close()':
mysql-stmt-close, do not call *note 'mysql_stmt_sqlstate()':
mysql-stmt-sqlstate. to obtain error information because *note
'mysql_stmt_close()': mysql-stmt-close. makes the statement handler
invalid.  Call *note 'mysql_sqlstate()': mysql-sqlstate. instead.

*Return Values*

A null-terminated character string containing the SQLSTATE error code.


File: manual.info.tmp,  Node: mysql-stmt-store-result,  Prev: mysql-stmt-sqlstate,  Up: c-api-prepared-statement-functions

23.7.10.28 mysql_stmt_store_result()
....................................

'int mysql_stmt_store_result(MYSQL_STMT *stmt)'

*Description*

Result sets are produced by calling *note 'mysql_stmt_execute()':
mysql-stmt-execute. to executed prepared statements for SQL statements
such as *note 'SELECT': select, *note 'SHOW': show, *note 'DESCRIBE':
describe, and *note 'EXPLAIN': explain.  By default, result sets for
successfully executed prepared statements are not buffered on the client
and *note 'mysql_stmt_fetch()': mysql-stmt-fetch. fetches them one at a
time from the server.  To cause the complete result set to be buffered
on the client, call *note 'mysql_stmt_store_result()':
mysql-stmt-store-result. after binding data buffers with *note
'mysql_stmt_bind_result()': mysql-stmt-bind-result. and before calling
*note 'mysql_stmt_fetch()': mysql-stmt-fetch. to fetch rows.  (For an
example, see *note mysql-stmt-fetch::.)

*note 'mysql_stmt_store_result()': mysql-stmt-store-result. is optional
for result set processing, unless you will call *note
'mysql_stmt_data_seek()': mysql-stmt-data-seek, *note
'mysql_stmt_row_seek()': mysql-stmt-row-seek, or *note
'mysql_stmt_row_tell()': mysql-stmt-row-tell.  Those functions require a
seekable result set.

It is unnecessary to call *note 'mysql_stmt_store_result()':
mysql-stmt-store-result. after executing an SQL statement that does not
produce a result set, but if you do, it does not harm or cause any
notable performance problem.  You can detect whether the statement
produced a result set by checking if *note
'mysql_stmt_result_metadata()': mysql-stmt-result-metadata. returns
'NULL'.  For more information, refer to *note
mysql-stmt-result-metadata::.

*Note*:

MySQL does not by default calculate 'MYSQL_FIELD->max_length' for all
columns in *note 'mysql_stmt_store_result()': mysql-stmt-store-result.
because calculating this would slow down *note
'mysql_stmt_store_result()': mysql-stmt-store-result. considerably and
most applications do not need 'max_length'.  If you want 'max_length' to
be updated, you can call *note 'mysql_stmt_attr_set(MYSQL_STMT,
STMT_ATTR_UPDATE_MAX_LENGTH, &flag)': mysql-stmt-attr-set. to enable
this.  See *note mysql-stmt-attr-set::.

*Return Values*

Zero for success.  Nonzero if an error occurred.

*Errors*

   * 'CR_COMMANDS_OUT_OF_SYNC'

     Commands were executed in an improper order.

   * 'CR_OUT_OF_MEMORY'

     Out of memory.

   * 'CR_SERVER_GONE_ERROR'

     The MySQL server has gone away.

   * 'CR_SERVER_LOST'

     The connection to the server was lost during the query.

   * 'CR_UNKNOWN_ERROR'

     An unknown error occurred.


File: manual.info.tmp,  Node: c-api-thread-functions,  Next: c-api-embedded-server-functions,  Prev: c-api-prepared-statement-functions,  Up: c-api

23.7.11 C API Threaded Function Descriptions
--------------------------------------------

* Menu:

* my-init::                      my_init()
* mysql-thread-end::             mysql_thread_end()
* mysql-thread-init::            mysql_thread_init()
* mysql-thread-safe::            mysql_thread_safe()

To create a threaded client, use the functions described in the
following sections.  See also *note c-api-threaded-clients::.


File: manual.info.tmp,  Node: my-init,  Next: mysql-thread-end,  Prev: c-api-thread-functions,  Up: c-api-thread-functions

23.7.11.1 my_init()
...................

'void my_init(void)'

*Description*

*note 'my_init()': my-init. initializes some global variables that MySQL
needs.  It also calls *note 'mysql_thread_init()': mysql-thread-init.
for this thread.

It is necessary for *note 'my_init()': my-init. to be called early in
the initialization phase of a program's use of the MySQL client library.
However, *note 'my_init()': my-init. is automatically called by *note
'mysql_init()': mysql-init, *note 'mysql_library_init()':
mysql-library-init, *note 'mysql_server_init()': mysql-server-init, and
*note 'mysql_connect()': mysql-connect.  If you ensure that your program
invokes one of those functions before any other MySQL calls, there is no
need to invoke *note 'my_init()': my-init. explicitly.

To access the prototype for *note 'my_init()': my-init, your program
should include these header files:

     #include <my_global.h>
     #include <my_sys.h>

*Return Values*

None.


File: manual.info.tmp,  Node: mysql-thread-end,  Next: mysql-thread-init,  Prev: my-init,  Up: c-api-thread-functions

23.7.11.2 mysql_thread_end()
............................

'void mysql_thread_end(void)'

*Description*

Call this function before calling 'pthread_exit()' to free memory
allocated by *note 'mysql_thread_init()': mysql-thread-init.

*note 'mysql_thread_end()': mysql-thread-end. _is not invoked
automatically by the client library_.  It must be called explicitly to
avoid a memory leak.

*Return Values*

None.


File: manual.info.tmp,  Node: mysql-thread-init,  Next: mysql-thread-safe,  Prev: mysql-thread-end,  Up: c-api-thread-functions

23.7.11.3 mysql_thread_init()
.............................

'my_bool mysql_thread_init(void)'

*Description*

This function must be called early within each created thread to
initialize thread-specific variables.  However, it may be unnecessarily
to invoke it explicitly.  Calling *note 'mysql_thread_init()':
mysql-thread-init. is automatically handled *note 'my_init()': my-init,
which itself is called by *note 'mysql_init()': mysql-init, *note
'mysql_library_init()': mysql-library-init, *note 'mysql_server_init()':
mysql-server-init, and *note 'mysql_connect()': mysql-connect.  If you
invoke any of those functions, *note 'mysql_thread_init()':
mysql-thread-init. is called for you.

*Return Values*

Zero for success.  Nonzero if an error occurred.


File: manual.info.tmp,  Node: mysql-thread-safe,  Prev: mysql-thread-init,  Up: c-api-thread-functions

23.7.11.4 mysql_thread_safe()
.............................

'unsigned int mysql_thread_safe(void)'

*Description*

This function indicates whether the client library is compiled as
thread-safe.

*Return Values*

1 if the client library is thread-safe, 0 otherwise.


File: manual.info.tmp,  Node: c-api-embedded-server-functions,  Next: c-api-plugin-functions,  Prev: c-api-thread-functions,  Up: c-api

23.7.12 C API Embedded Server Function Descriptions
---------------------------------------------------

* Menu:

* mysql-server-end::             mysql_server_end()
* mysql-server-init::            mysql_server_init()

MySQL applications can be written to use an embedded server.  See *note
libmysqld::.  To write such an application, you must link it against the
'libmysqld' library by using the '-lmysqld' flag rather than linking it
against the 'libmysqlclient' client library by using the '-lmysqlclient'
flag.  However, the calls to initialize and finalize the library are the
same whether you write a client application or one that uses the
embedded server: Call *note 'mysql_library_init()': mysql-library-init.
to initialize the library and *note 'mysql_library_end()':
mysql-library-end. when you are done with it.  See *note
c-api-function-overview::.


File: manual.info.tmp,  Node: mysql-server-end,  Next: mysql-server-init,  Prev: c-api-embedded-server-functions,  Up: c-api-embedded-server-functions

23.7.12.1 mysql_server_end()
............................

'void mysql_server_end(void)'

*Description*

This function finalizes the MySQL library, which should be done when you
are done using the library.  However, *note 'mysql_server_end()':
mysql-server-end. is deprecated and *note 'mysql_library_end()':
mysql-library-end. should be used instead.  See *note
mysql-library-end::.

*Note*:

To avoid memory leaks after the application is done using the library
(for example, after closing the connection to the server), be sure to
call *note 'mysql_server_end()': mysql-server-end. (or *note
'mysql_library_end()': mysql-library-end.) explicitly.  This enables
memory managment to be performed to clean up and free resources used by
the library.

*Return Values*

None.


File: manual.info.tmp,  Node: mysql-server-init,  Prev: mysql-server-end,  Up: c-api-embedded-server-functions

23.7.12.2 mysql_server_init()
.............................

'int mysql_server_init(int argc, char **argv, char **groups)'

*Description*

This function initializes the MySQL client library, which must be done
before you call any other MySQL function.  However, *note
'mysql_server_init()': mysql-server-init. is deprecated and you should
call *note 'mysql_library_init()': mysql-library-init. instead.  See
*note mysql-library-init::.

*Note*:

To avoid memory leaks after the application is done using the library
(for example, after closing the connection to the server), be sure to
call *note 'mysql_server_end()': mysql-server-end. (or *note
'mysql_library_end()': mysql-library-end.) explicitly.  This enables
memory managment to be performed to clean up and free resources used by
the library.  See *note mysql-library-end::.

*Return Values*

Zero for success.  Nonzero if an error occurred.


File: manual.info.tmp,  Node: c-api-plugin-functions,  Next: c-api-encrypted-connections,  Prev: c-api-embedded-server-functions,  Up: c-api

23.7.13 C API Client Plugin Functions
-------------------------------------

* Menu:

* mysql-client-find-plugin::     mysql_client_find_plugin()
* mysql-client-register-plugin::  mysql_client_register_plugin()
* mysql-load-plugin::            mysql_load_plugin()
* mysql-load-plugin-v::          mysql_load_plugin_v()
* mysql-plugin-options::         mysql_plugin_options()

This section describes functions used for the client-side plugin API.
They enable management of client plugins.  For a description of the
'st_mysql_client_plugin' structure used by these functions, see *note
client-plugin-descriptors::.

It is unlikely that a client program needs to call the functions in this
section.  For example, a client that supports the use of authentication
plugins normally causes a plugin to be loaded by calling *note
'mysql_options()': mysql-options. to set the 'MYSQL_DEFAULT_AUTH' and
'MYSQL_PLUGIN_DIR' options:

     char *plugin_dir = "PATH_TO_PLUGIN_DIR";
     char *default_auth = "PLUGIN_NAME";

     /* ... process command-line options ... */

     mysql_options(&mysql, MYSQL_PLUGIN_DIR, plugin_dir);
     mysql_options(&mysql, MYSQL_DEFAULT_AUTH, default_auth);

Typically, the program will also accept '--plugin-dir' and
'--default-auth' options that enable users to override the default
values.


File: manual.info.tmp,  Node: mysql-client-find-plugin,  Next: mysql-client-register-plugin,  Prev: c-api-plugin-functions,  Up: c-api-plugin-functions

23.7.13.1 mysql_client_find_plugin()
....................................

'struct st_mysql_client_plugin *mysql_client_find_plugin(MYSQL *mysql,
const char *name, int type)'

*Description*

Returns a pointer to a loaded plugin, loading the plugin first if
necessary.  An error occurs if the type is invalid or the plugin cannot
be found or loaded.

Specify the parameters as follows:

   * 'mysql': A pointer to a 'MYSQL' structure.  The plugin API does not
     require a connection to a MySQL server, but this structure must be
     properly initialized.  The structure is used to obtain
     connection-related information.

   * 'name': The plugin name.

   * 'type': The plugin type.

*Return Values*

A pointer to the plugin for success.  'NULL' if an error occurred.

*Errors*

To check for errors, call the *note 'mysql_error()': mysql-error. or
*note 'mysql_errno()': mysql-errno. function.  See *note mysql-error::,
and *note mysql-errno::.

*Example*

     MYSQL mysql;
     struct st_mysql_client_plugin *p;

     if ((p = mysql_client_find_plugin(&mysql, "myplugin",
                                       MYSQL_CLIENT_AUTHENTICATION_PLUGIN, 0)))
     {
       printf("Plugin version: %d.%d.%d\n", p->version[0], p->version[1], p->version[2]);
     }


File: manual.info.tmp,  Node: mysql-client-register-plugin,  Next: mysql-load-plugin,  Prev: mysql-client-find-plugin,  Up: c-api-plugin-functions

23.7.13.2 mysql_client_register_plugin()
........................................

'struct st_mysql_client_plugin *mysql_client_register_plugin(MYSQL
*mysql, struct st_mysql_client_plugin *plugin)'

*Description*

Adds a plugin structure to the list of loaded plugins.  An error occurs
if the plugin is already loaded.

Specify the parameters as follows:

   * 'mysql': A pointer to a 'MYSQL' structure.  The plugin API does not
     require a connection to a MySQL server, but this structure must be
     properly initialized.  The structure is used to obtain
     connection-related information.

   * 'plugin': A pointer to the plugin structure.

*Return Values*

A pointer to the plugin for success.  'NULL' if an error occurred.

*Errors*

To check for errors, call the *note 'mysql_error()': mysql-error. or
*note 'mysql_errno()': mysql-errno. function.  See *note mysql-error::,
and *note mysql-errno::.


File: manual.info.tmp,  Node: mysql-load-plugin,  Next: mysql-load-plugin-v,  Prev: mysql-client-register-plugin,  Up: c-api-plugin-functions

23.7.13.3 mysql_load_plugin()
.............................

'struct st_mysql_client_plugin *mysql_load_plugin(MYSQL *mysql, const
char *name, int type, int argc, ...)'

*Description*

Loads a MySQL client plugin, specified by name and type.  An error
occurs if the type is invalid or the plugin cannot be loaded.

It is not possible to load multiple plugins of the same type.  An error
occurs if you try to load a plugin of a type already loaded.

Specify the parameters as follows:

   * 'mysql': A pointer to a 'MYSQL' structure.  The plugin API does not
     require a connection to a MySQL server, but this structure must be
     properly initialized.  The structure is used to obtain
     connection-related information.

   * 'name': The name of the plugin to load.

   * 'type': The type of plugin to load, or 1 to disable type
     checking.  If type is not 1, only plugins matching the type are
     considered for loading.

   * 'argc': The number of following arguments (0 if there are none).
     Interpretation of any following arguments depends on the plugin
     type.

Another way to cause plugins to be loaded is to set the
'LIBMYSQL_PLUGINS' environment variable to a list of semicolon-separated
plugin names.  For example:

     export LIBMYSQL_PLUGINS="myplugin1;myplugin2"

Plugins named by 'LIBMYSQL_PLUGINS' are loaded when the client program
calls *note 'mysql_library_init()': mysql-library-init.  No error is
reported if problems occur loading these plugins.

*Return Values*

A pointer to the plugin if it was loaded successfully.  'NULL' if an
error occurred.

*Errors*

To check for errors, call the *note 'mysql_error()': mysql-error. or
*note 'mysql_errno()': mysql-errno. function.  See *note mysql-error::,
and *note mysql-errno::.

*Example*

     MYSQL mysql;

     if(!mysql_load_plugin(&mysql, "myplugin",
                           MYSQL_CLIENT_AUTHENTICATION_PLUGIN, 0))
     {
         fprintf(stderr, "Error: %s\n", mysql_error(&mysql));
         exit(-1);
     }

*See Also*

See also *note mysql-load-plugin::, *note mysql-error::, *note
mysql-errno::.


File: manual.info.tmp,  Node: mysql-load-plugin-v,  Next: mysql-plugin-options,  Prev: mysql-load-plugin,  Up: c-api-plugin-functions

23.7.13.4 mysql_load_plugin_v()
...............................

'struct st_mysql_client_plugin *mysql_load_plugin_v(MYSQL *mysql, const
char *name, int type, int argc, va_list args)'

*Description*

This function is equivalent to *note 'mysql_load_plugin()':
mysql-load-plugin, but it accepts a 'va_list' instead of a variable list
of parameters.

*See Also*

See also *note mysql-load-plugin::.


File: manual.info.tmp,  Node: mysql-plugin-options,  Prev: mysql-load-plugin-v,  Up: c-api-plugin-functions

23.7.13.5 mysql_plugin_options()
................................

'int mysql_plugin_options(struct st_mysql_client_plugin *plugin, const
char *option, const void *value)'

*Description*

Passes an option type and value to a plugin.  This function can be
called multiple times to set several options.  If the plugin does not
have an option handler, an error occurs.

Specify the parameters as follows:

   * 'plugin': A pointer to the plugin structure.

   * 'option': The option to be set.

   * 'value': A pointer to the option value.

*Return Values*

Zero for success, 1 if an error occurred.  If the plugin has an option
handler, that handler should also return zero for success and 1 if an
error occurred.


File: manual.info.tmp,  Node: c-api-encrypted-connections,  Next: c-api-multiple-queries,  Prev: c-api-plugin-functions,  Up: c-api

23.7.14 C API Encrypted Connection Support
------------------------------------------

For applications that require control over how encrypted connections are
established, the C API provides these capabilities:

   * The *note 'mysql_ssl_set()': mysql-ssl-set. and *note
     'mysql_options()': mysql-options. functions enable applications to
     set the appropriate SSL/TLS options before calling *note
     'mysql_real_connect()': mysql-real-connect.  For example, to
     require the use of an encrypted connection, see *note
     c-api-enforcing-encrypted-connection::.

   * The *note 'mysql_get_ssl_cipher()': mysql-get-ssl-cipher. function
     enables applications to determine, after a connection has been
     established, whether the connection uses encryption.  A 'NULL'
     return value indicates that encryption is not being used.  A
     non-'NULL' return value indicates an encrypted connection and names
     the encryption cipher.  See *note mysql-get-ssl-cipher::.

   * *note c-api-encrypted-connection-options::

   * *note c-api-enforcing-encrypted-connection::

   * *note c-api-secure-encrypted-connection::

*C API Options for Encrypted Connections*

*note 'mysql_ssl_set()': mysql-ssl-set. takes the following arguments
for control over use of encrypted connections.  For more information,
see *note mysql-ssl-set::.

   * 'key': The path name of the client private key file.

   * 'cert': The path name of the client public key certificate file.

   * 'ca': The path name of the Certificate Authority (CA) certificate
     file.  This option, if used, must specify the same certificate used
     by the server.

   * 'capath': The path name of the directory that contains trusted SSL
     CA certificate files.

   * 'cipher': The list of permissible ciphers for SSL encryption.

*note 'mysql_options()': mysql-options. provides the following options
for control over use of encrypted connections.  For option details, see
*note mysql-options::.

   * 'MYSQL_OPT_SSL_MODE': The connection security state.

   * 'MYSQL_OPT_SSL_VERIFY_SERVER_CERT': Whether to perform host name
     identity verification of the server certificate Common Name value.

*Enforcing an Encrypted Connection*

*note 'mysql_ssl_set()': mysql-ssl-set. options for information such as
SSL certificate and key files are used to establish an encrypted
connection if such connections are available, but do not enforce any
requirement that the connection obtained be encrypted.  To require an
encrypted connection, use the following technique:

  1. Call *note 'mysql_ssl_set()': mysql-ssl-set. and *note
     'mysql_options()': mysql-options. as necessary to supply the
     appropriate SSL parameters (certificate and key files, encryption
     ciphers, and so forth).

  2. For MySQL 5.5.55 and higher, 'MYSQL_OPT_SSL_MODE' is available, so
     call *note 'mysql_options()': mysql-options. to pass the
     'MYSQL_OPT_SSL_MODE' option with a value of 'SSL_MODE_REQUIRED'.

     *Important*:

     In MySQL 5.5, the minor C API version number was not incremented
     for the addition of 'MYSQL_OPT_SSL_MODE' in MySQL 5.5.55.
     Application programs compiled for MySQL 5.5 that require
     'MYSQL_OPT_SSL_MODE' may fail to operate properly if the dynamic
     loader provides an older client library that does not include
     'MYSQL_OPT_SSL_MODE'.  Such applications must be written to handle
     this possibility by checking whether the *note 'mysql_options()':
     mysql-options. call succeeds or fails.

  3. Call *note 'mysql_real_connect()': mysql-real-connect. to connect
     to the server.  As of MySQL 5.5.55, the call fails if an encrypted
     connection cannot be obtained; exit with an error.  Prior to 5.5.55
     (before 'MYSQL_OPT_SSL_MODE' is available), clients are required to
     check for themselves, after calling *note 'mysql_real_connect()':
     mysql-real-connect, whether the connection is encrypted.  To do
     this if *note 'mysql_real_connect()': mysql-real-connect. succeeds,
     call *note 'mysql_get_ssl_cipher()': mysql-get-ssl-cipher. to check
     whether the resulting connection is encrypted.  If not, exit with
     an error.

MySQL clients implement this technique using a wrapper function named
'mysql_connect_ssl_check()' to establish and check the connection,
rather than calling *note 'mysql_real_connect()': mysql-real-connect.
directly.  To see how this works, look in the 'client' directory of a
MySQL source distribution at the source for any of the standard MySQL
clients, as well as the 'client_priv.h' file that contains the
'mysql_connect_ssl_check()' wrapper function implementation.  A call to
'mysql_connect_ssl_check()' takes arguments like the arguments to *note
'mysql_real_connect()': mysql-real-connect, plus an extra argument
indicating whether to require an encrypted connection:

     if (!mysql_connect_ssl_check(&mysql, host, user, pass, db,
                                  port, sock, flags,
                                  opt_ssl_required))
     {
       /* failure: connection not obtained, or not encrypted if required to be */
     }
     else
     {
       /* success: connection obtained, encrypted if required to be */
     }

Version notes:

   * In MySQL 5.5.49, the '--ssl-mode=REQUIRED' command-line option was
     backported from MySQL 5.7 to MySQL 5.5.  Clients can check for this
     option and use it to determine whether to require an encrypted
     connection.  If so, clients must check for themselves, after
     calling *note 'mysql_real_connect()': mysql-real-connect, whether
     the connection is encrypted, and fail if not.  To do this, call
     *note 'mysql_get_ssl_cipher()': mysql-get-ssl-cipher. and check the
     return value.

   * In MySQL 5.5.55, the 'MYSQL_OPT_SSL_MODE' option for *note
     'mysql_options()': mysql-options. was backported from MySQL 5.7 to
     MySQL 5.5.  A call to *note 'mysql_options()': mysql-options. to
     set the 'MYSQL_OPT_SSL_MODE' option to value of 'SSL_MODE_REQUIRED'
     suffices to cause *note 'mysql_real_connect()': mysql-real-connect.
     to fail if the connection is not encrypted.  *note
     'mysql_get_ssl_cipher()': mysql-get-ssl-cipher. can still be called
     after connecting, although it is not necessary to do so.

*Improving Security of Encrypted Connections*

For additional security relative to that provided by the default
encryption, clients can supply a CA certificate matching the one used by
the server and enable host name identity verification.  In this way, the
server and client place their trust in the same CA certificate and the
client verifies that the host to which it connected is the one intended:

   * To specify the CA certificate, call *note 'mysql_ssl_set()':
     mysql-ssl-set. to pass the 'ca' (or 'capath') argument.

   * To enable host name identity verification, call *note
     'mysql_options()': mysql-options. to enable the
     'MYSQL_OPT_SSL_VERIFY_SERVER_CERT' option.

   * To require an encrypted connection, call *note 'mysql_options()':
     mysql-options. to pass the 'MYSQL_OPT_SSL_MODE' option with a value
     of 'SSL_MODE_REQUIRED'.  (For details about 'SSL_MODE_REQUIRED',
     see *note c-api-enforcing-encrypted-connection::.)


File: manual.info.tmp,  Node: c-api-multiple-queries,  Next: c-api-prepared-statement-date-handling,  Prev: c-api-encrypted-connections,  Up: c-api

23.7.15 C API Multiple Statement Execution Support
--------------------------------------------------

By default, *note 'mysql_query()': mysql-query. and *note
'mysql_real_query()': mysql-real-query. interpret their statement string
argument as a single statement to be executed, and you process the
result according to whether the statement produces a result set (a set
of rows, as for *note 'SELECT': select.) or an affected-rows count (as
for *note 'INSERT': insert, *note 'UPDATE': update, and so forth).

MySQL also supports the execution of a string containing multiple
statements separated by semicolon (';') characters.  This capability is
enabled by special options that are specified either when you connect to
the server with *note 'mysql_real_connect()': mysql-real-connect. or
after connecting by calling *note 'mysql_set_server_option()':
mysql-set-server-option.

Executing a multiple-statement string can produce multiple result sets
or row-count indicators.  Processing these results involves a different
approach than for the single-statement case: After handling the result
from the first statement, it is necessary to check whether more results
exist and process them in turn if so.  To support multiple-result
processing, the C API includes the *note 'mysql_more_results()':
mysql-more-results. and *note 'mysql_next_result()': mysql-next-result.
functions.  These functions are used at the end of a loop that iterates
as long as more results are available.  _Failure to process the result
this way may result in a dropped connection to the server._

Multiple-result processing also is required if you execute *note 'CALL':
call. statements for stored procedures.  Results from a stored procedure
have these characteristics:

   * Statements within the procedure may produce result sets (for
     example, if it executes *note 'SELECT': select. statements).  These
     result sets are returned in the order that they are produced as the
     procedure executes.

     In general, the caller cannot know how many result sets a procedure
     will return.  Procedure execution may depend on loops or
     conditional statements that cause the execution path to differ from
     one call to the next.  Therefore, you must be prepared to retrieve
     multiple results.

   * The final result from the procedure is a status result that
     includes no result set.  The status indicates whether the procedure
     succeeded or an error occurred.

The multiple statement and result capabilities can be used only with
*note 'mysql_query()': mysql-query. or *note 'mysql_real_query()':
mysql-real-query.  They cannot be used with the prepared statement
interface.  Prepared statement handlers are defined to work only with
strings that contain a single statement.  See *note
c-api-prepared-statements::.

To enable multiple-statement execution and result processing, the
following options may be used:

   * The *note 'mysql_real_connect()': mysql-real-connect. function has
     a 'flags' argument for which two option values are relevant:

        * 'CLIENT_MULTI_RESULTS' enables the client program to process
          multiple results.  This option _must_ be enabled if you
          execute *note 'CALL': call. statements for stored procedures
          that produce result sets.  Otherwise, such procedures result
          in an error 'Error 1312 (0A000): PROCEDURE PROC_NAME can't
          return a result set in the given context'.
          'CLIENT_MULTI_RESULTS' is enabled by default.

        * 'CLIENT_MULTI_STATEMENTS' enables *note 'mysql_query()':
          mysql-query. and *note 'mysql_real_query()': mysql-real-query.
          to execute statement strings containing multiple statements
          separated by semicolons.  This option also enables
          'CLIENT_MULTI_RESULTS' implicitly, so a 'flags' argument of
          'CLIENT_MULTI_STATEMENTS' to *note 'mysql_real_connect()':
          mysql-real-connect. is equivalent to an argument of
          'CLIENT_MULTI_STATEMENTS | CLIENT_MULTI_RESULTS'.  That is,
          'CLIENT_MULTI_STATEMENTS' is sufficient to enable
          multiple-statement execution and all multiple-result
          processing.

   * After the connection to the server has been established, you can
     use the *note 'mysql_set_server_option()': mysql-set-server-option.
     function to enable or disable multiple-statement execution by
     passing it an argument of 'MYSQL_OPTION_MULTI_STATEMENTS_ON' or
     'MYSQL_OPTION_MULTI_STATEMENTS_OFF'.  Enabling multiple-statement
     execution with this function also enables processing of 'simple'
     results for a multiple-statement string where each statement
     produces a single result, but is _not_ sufficient to permit
     processing of stored procedures that produce result sets.

The following procedure outlines a suggested strategy for handling
multiple statements:

  1. Pass 'CLIENT_MULTI_STATEMENTS' to *note 'mysql_real_connect()':
     mysql-real-connect, to fully enable multiple-statement execution
     and multiple-result processing.

  2. After calling *note 'mysql_query()': mysql-query. or *note
     'mysql_real_query()': mysql-real-query. and verifying that it
     succeeds, enter a loop within which you process statement results.

  3. For each iteration of the loop, handle the current statement
     result, retrieving either a result set or an affected-rows count.
     If an error occurs, exit the loop.

  4. At the end of the loop, call *note 'mysql_next_result()':
     mysql-next-result. to check whether another result exists and
     initiate retrieval for it if so.  If no more results are available,
     exit the loop.

One possible implementation of the preceding strategy is shown
following.  The final part of the loop can be reduced to a simple test
of whether *note 'mysql_next_result()': mysql-next-result. returns
nonzero.  The code as written distinguishes between no more results and
an error, which enables a message to be printed for the latter
occurrence.

     /* connect to server with the CLIENT_MULTI_STATEMENTS option */
     if (mysql_real_connect (mysql, host_name, user_name, password,
         db_name, port_num, socket_name, CLIENT_MULTI_STATEMENTS) == NULL)
     {
       printf("mysql_real_connect() failed\n");
       mysql_close(mysql);
       exit(1);
     }

     /* execute multiple statements */
     status = mysql_query(mysql,
                          "DROP TABLE IF EXISTS test_table;\
                           CREATE TABLE test_table(id INT);\
                           INSERT INTO test_table VALUES(10);\
                           UPDATE test_table SET id=20 WHERE id=10;\
                           SELECT * FROM test_table;\
                           DROP TABLE test_table");
     if (status)
     {
       printf("Could not execute statement(s)");
       mysql_close(mysql);
       exit(0);
     }

     /* process each statement result */
     do {
       /* did current statement return data? */
       result = mysql_store_result(mysql);
       if (result)
       {
         /* yes; process rows and free the result set */
         process_result_set(mysql, result);
         mysql_free_result(result);
       }
       else          /* no result set or error */
       {
         if (mysql_field_count(mysql) == 0)
         {
           printf("%lld rows affected\n",
                 mysql_affected_rows(mysql));
         }
         else  /* some error occurred */
         {
           printf("Could not retrieve result set\n");
           break;
         }
       }
       /* more results? -1 = no, >0 = error, 0 = yes (keep looping) */
       if ((status = mysql_next_result(mysql)) > 0)
         printf("Could not execute statement\n");
     } while (status == 0);

     mysql_close(mysql);


File: manual.info.tmp,  Node: c-api-prepared-statement-date-handling,  Next: c-api-prepared-call-statements,  Prev: c-api-multiple-queries,  Up: c-api

23.7.16 C API Prepared Statement Handling of Date and Time Values
-----------------------------------------------------------------

The binary (prepared statement) protocol enables you to send and receive
date and time values (*note 'DATE': datetime, *note 'TIME': time, *note
'DATETIME': datetime, and *note 'TIMESTAMP': datetime.), using the
'MYSQL_TIME' structure.  The members of this structure are described in
*note c-api-prepared-statement-data-structures::.

To send temporal data values, create a prepared statement using *note
'mysql_stmt_prepare()': mysql-stmt-prepare.  Then, before calling *note
'mysql_stmt_execute()': mysql-stmt-execute. to execute the statement,
use the following procedure to set up each temporal parameter:

  1. In the 'MYSQL_BIND' structure associated with the data value, set
     the 'buffer_type' member to the type that indicates what kind of
     temporal value you're sending.  For *note 'DATE': datetime, *note
     'TIME': time, *note 'DATETIME': datetime, or *note 'TIMESTAMP':
     datetime. values, set 'buffer_type' to 'MYSQL_TYPE_DATE',
     'MYSQL_TYPE_TIME', 'MYSQL_TYPE_DATETIME', or
     'MYSQL_TYPE_TIMESTAMP', respectively.

  2. Set the 'buffer' member of the 'MYSQL_BIND' structure to the
     address of the 'MYSQL_TIME' structure in which you pass the
     temporal value.

  3. Fill in the members of the 'MYSQL_TIME' structure that are
     appropriate for the type of temporal value to pass.

Use *note 'mysql_stmt_bind_param()': mysql-stmt-bind-param. to bind the
parameter data to the statement.  Then you can call *note
'mysql_stmt_execute()': mysql-stmt-execute.

To retrieve temporal values, the procedure is similar, except that you
set the 'buffer_type' member to the type of value you expect to receive,
and the 'buffer' member to the address of a 'MYSQL_TIME' structure into
which the returned value should be placed.  Use *note
'mysql_stmt_bind_result()': mysql-stmt-bind-result. to bind the buffers
to the statement after calling *note 'mysql_stmt_execute()':
mysql-stmt-execute. and before fetching the results.

Here is a simple example that inserts *note 'DATE': datetime, *note
'TIME': time, and *note 'TIMESTAMP': datetime. data.  The 'mysql'
variable is assumed to be a valid connection handler.


       MYSQL_TIME  ts;
       MYSQL_BIND  bind[3];
       MYSQL_STMT  *stmt;

       strmov(query, "INSERT INTO test_table(date_field, time_field, \
                                    timestamp_field) VALUES(?,?,?");

       stmt = mysql_stmt_init(mysql);
       if (!stmt)
       {
         fprintf(stderr, " mysql_stmt_init(), out of memory\n");
         exit(0);
       }
       if (mysql_stmt_prepare(mysql, query, strlen(query)))
       {
         fprintf(stderr, "\n mysql_stmt_prepare(), INSERT failed");
         fprintf(stderr, "\n %s", mysql_stmt_error(stmt));
         exit(0);
       }

       /* set up input buffers for all 3 parameters */
       bind[0].buffer_type= MYSQL_TYPE_DATE;
       bind[0].buffer= (char *)&ts;
       bind[0].is_null= 0;
       bind[0].length= 0;
       ...
       bind[1]= bind[2]= bind[0];
       ...

       mysql_stmt_bind_param(stmt, bind);

       /* supply the data to be sent in the ts structure */
       ts.year= 2002;
       ts.month= 02;
       ts.day= 03;

       ts.hour= 10;
       ts.minute= 45;
       ts.second= 20;

       mysql_stmt_execute(stmt);
       ..


File: manual.info.tmp,  Node: c-api-prepared-call-statements,  Next: c-api-prepared-statement-problems,  Prev: c-api-prepared-statement-date-handling,  Up: c-api

23.7.17 C API Prepared CALL Statement Support
---------------------------------------------

This section describes prepared-statement support in the C API for
stored procedures executed using *note 'CALL': call. statements:

Stored procedures executed using prepared *note 'CALL': call. statements
can be used in the following ways:

   * A stored procedure can produce any number of result sets.  The
     number of columns and the data types of the columns need not be the
     same for all result sets.

   * The final values of 'OUT' and 'INOUT' parameters are available to
     the calling application after the procedure returns.  These
     parameters are returned as an extra single-row result set following
     any result sets produced by the procedure itself.  The row contains
     the values of the 'OUT' and 'INOUT' parameters in the order in
     which they are declared in the procedure parameter list.

     For information about the effect of unhandled conditions on
     procedure parameters, see *note conditions-and-parameters::.

The following discussion shows how to use these capabilities through the
C API for prepared statements.  To use prepared *note 'CALL': call.
statements through the *note 'PREPARE': prepare. and *note 'EXECUTE':
execute. statements, see *note call::.

An application that executes a prepared *note 'CALL': call. statement
should use a loop that fetches a result and then invokes *note
'mysql_stmt_next_result()': mysql-stmt-next-result. to determine whether
there are more results.  The results consist of any result sets produced
by the stored procedure followed by a final status value that indicates
whether the procedure terminated successfully.

If the procedure has 'OUT' or 'INOUT' parameters, the result set
preceding the final status value contains their values.  To determine
whether a result set contains parameter values, test whether the
'SERVER_PS_OUT_PARAMS' bit is set in the 'server_status' member of the
'MYSQL' connection handler:

     mysql->server_status & SERVER_PS_OUT_PARAMS

The following example uses a prepared *note 'CALL': call. statement to
execute a stored procedure that produces multiple result sets and that
provides parameter values back to the caller by means of 'OUT' and
'INOUT' parameters.  The procedure takes parameters of all three types
('IN', 'OUT', 'INOUT'), displays their initial values, assigns new
values, displays the updated values, and returns.  The expected return
information from the procedure therefore consists of multiple result
sets and a final status:

   * One result set from a *note 'SELECT': select. that displays the
     initial parameter values: '10', 'NULL', '30'.  (The 'OUT' parameter
     is assigned a value by the caller, but this assignment is expected
     to be ineffective: 'OUT' parameters are seen as 'NULL' within a
     procedure until assigned a value within the procedure.)

   * One result set from a *note 'SELECT': select. that displays the
     modified parameter values: '100', '200', '300'.

   * One result set containing the final 'OUT' and 'INOUT' parameter
     values: '200', '300'.

   * A final status packet.

The code to execute the procedure:

     MYSQL_STMT *stmt;
     MYSQL_BIND ps_params[3];  /* input parameter buffers */
     int        int_data[3];   /* input/output values */
     my_bool    is_null[3];    /* output value nullability */
     int        status;

     /* set up stored procedure */
     status = mysql_query(mysql, "DROP PROCEDURE IF EXISTS p1");
     test_error(mysql, status);

     status = mysql_query(mysql,
       "CREATE PROCEDURE p1("
       "  IN p_in INT, "
       "  OUT p_out INT, "
       "  INOUT p_inout INT) "
       "BEGIN "
       "  SELECT p_in, p_out, p_inout; "
       "  SET p_in = 100, p_out = 200, p_inout = 300; "
       "  SELECT p_in, p_out, p_inout; "
       "END");
     test_error(mysql, status);

     /* initialize and prepare CALL statement with parameter placeholders */
     stmt = mysql_stmt_init(mysql);
     if (!stmt)
     {
       printf("Could not initialize statement\n");
       exit(1);
     }
     status = mysql_stmt_prepare(stmt, "CALL p1(?, ?, ?)", 16);
     test_stmt_error(stmt, status);

     /* initialize parameters: p_in, p_out, p_inout (all INT) */
     memset(ps_params, 0, sizeof (ps_params));

     ps_params[0].buffer_type = MYSQL_TYPE_LONG;
     ps_params[0].buffer = (char *) &int_data[0];
     ps_params[0].length = 0;
     ps_params[0].is_null = 0;

     ps_params[1].buffer_type = MYSQL_TYPE_LONG;
     ps_params[1].buffer = (char *) &int_data[1];
     ps_params[1].length = 0;
     ps_params[1].is_null = 0;

     ps_params[2].buffer_type = MYSQL_TYPE_LONG;
     ps_params[2].buffer = (char *) &int_data[2];
     ps_params[2].length = 0;
     ps_params[2].is_null = 0;

     /* bind parameters */
     status = mysql_stmt_bind_param(stmt, ps_params);
     test_stmt_error(stmt, status);

     /* assign values to parameters and execute statement */
     int_data[0]= 10;  /* p_in */
     int_data[1]= 20;  /* p_out */
     int_data[2]= 30;  /* p_inout */

     status = mysql_stmt_execute(stmt);
     test_stmt_error(stmt, status);

     /* process results until there are no more */
     do {
       int i;
       int num_fields;       /* number of columns in result */
       MYSQL_FIELD *fields;  /* for result set metadata */
       MYSQL_BIND *rs_bind;  /* for output buffers */

       /* the column count is > 0 if there is a result set */
       /* 0 if the result is only the final status packet */
       num_fields = mysql_stmt_field_count(stmt);

       if (num_fields > 0)
       {
         /* there is a result set to fetch */
         printf("Number of columns in result: %d\n", (int) num_fields);

         /* what kind of result set is this? */
         printf("Data: ");
         if(mysql->server_status & SERVER_PS_OUT_PARAMS)
           printf("this result set contains OUT/INOUT parameters\n");
         else
           printf("this result set is produced by the procedure\n");

         MYSQL_RES *rs_metadata = mysql_stmt_result_metadata(stmt);
         test_stmt_error(stmt, rs_metadata == NULL);

         fields = mysql_fetch_fields(rs_metadata);

         rs_bind = (MYSQL_BIND *) malloc(sizeof (MYSQL_BIND) * num_fields);
         if (!rs_bind)
         {
           printf("Cannot allocate output buffers\n");
           exit(1);
         }
         memset(rs_bind, 0, sizeof (MYSQL_BIND) * num_fields);

         /* set up and bind result set output buffers */
         for (i = 0; i < num_fields; ++i)
         {
           rs_bind[i].buffer_type = fields[i].type;
           rs_bind[i].is_null = &is_null[i];

           switch (fields[i].type)
           {
             case MYSQL_TYPE_LONG:
               rs_bind[i].buffer = (char *) &(int_data[i]);
               rs_bind[i].buffer_length = sizeof (int_data);
               break;

             default:
               fprintf(stderr, "ERROR: unexpected type: %d.\n", fields[i].type);
               exit(1);
           }
         }

         status = mysql_stmt_bind_result(stmt, rs_bind);
         test_stmt_error(stmt, status);

         /* fetch and display result set rows */
         while (1)
         {
           status = mysql_stmt_fetch(stmt);

           if (status == 1 || status == MYSQL_NO_DATA)
             break;

           for (i = 0; i < num_fields; ++i)
           {
             switch (rs_bind[i].buffer_type)
             {
               case MYSQL_TYPE_LONG:
                 if (*rs_bind[i].is_null)
                   printf(" val[%d] = NULL;", i);
                 else
                   printf(" val[%d] = %ld;",
                          i, (long) *((int *) rs_bind[i].buffer));
                 break;

               default:
                 printf("  unexpected type (%d)\n",
                   rs_bind[i].buffer_type);
             }
           }
           printf("\n");
         }

         mysql_free_result(rs_metadata); /* free metadata */
         free(rs_bind);                  /* free output buffers */
       }
       else
       {
         /* no columns = final status packet */
         printf("End of procedure output\n");
       }

       /* more results? -1 = no, >0 = error, 0 = yes (keep looking) */
       status = mysql_stmt_next_result(stmt);
       if (status > 0)
         test_stmt_error(stmt, status);
     } while (status == 0);

     mysql_stmt_close(stmt);

Execution of the procedure should produce the following output:

     Number of columns in result: 3
     Data: this result set is produced by the procedure
      val[0] = 10; val[1] = NULL; val[2] = 30;
     Number of columns in result: 3
     Data: this result set is produced by the procedure
      val[0] = 100; val[1] = 200; val[2] = 300;
     Number of columns in result: 2
     Data: this result set contains OUT/INOUT parameters
      val[0] = 200; val[1] = 300;
     End of procedure output

The code uses two utility routines, 'test_error()' and
'test_stmt_error()', to check for errors and terminate after printing
diagnostic information if an error occurred:

     static void test_error(MYSQL *mysql, int status)
     {
       if (status)
       {
         fprintf(stderr, "Error: %s (errno: %d)\n",
                 mysql_error(mysql), mysql_errno(mysql));
         exit(1);
       }
     }

     static void test_stmt_error(MYSQL_STMT *stmt, int status)
     {
       if (status)
       {
         fprintf(stderr, "Error: %s (errno: %d)\n",
                 mysql_stmt_error(stmt), mysql_stmt_errno(stmt));
         exit(1);
       }
     }


File: manual.info.tmp,  Node: c-api-prepared-statement-problems,  Next: c-api-auto-reconnect,  Prev: c-api-prepared-call-statements,  Up: c-api

23.7.18 C API Prepared Statement Problems
-----------------------------------------

Here follows a list of the currently known problems with prepared
statements:

   * *note 'TIME': time, *note 'TIMESTAMP': datetime, and *note
     'DATETIME': datetime. do not support parts of seconds (for example,
     from 'DATE_FORMAT()').

   * 
     When converting an integer to string, 'ZEROFILL' is honored with
     prepared statements in some cases where the MySQL server does not
     print the leading zeros.  (For example, with
     'MIN(NUMBER-WITH-ZEROFILL)').

   * When converting a floating-point number to a string in the client,
     the rightmost digits of the converted value may differ slightly
     from those of the original value.

   * Prepared statements use the query cache under the conditions
     described in *note query-cache-operation::.

   * Prepared statements do not support multi-statements (that is,
     multiple statements within a single string separated by ';'
     characters).

   * The capabilities of prepared *note 'CALL': call. statements are
     described in *note c-api-prepared-call-statements::.


File: manual.info.tmp,  Node: c-api-auto-reconnect,  Next: c-api-common-issues,  Prev: c-api-prepared-statement-problems,  Up: c-api

23.7.19 C API Automatic Reconnection Control
--------------------------------------------

The MySQL client library can perform an automatic reconnection to the
server if it finds that the connection is down when you attempt to send
a statement to the server to be executed.  If auto-reconnect is enabled,
the library tries once to reconnect to the server and send the statement
again.

Auto-reconnect is disabled by default.

If it is important for your application to know that the connection has
been dropped (so that it can exit or take action to adjust for the loss
of state information), be sure that auto-reconnect is disabled.  To
ensure this, call *note 'mysql_options()': mysql-options. with the
'MYSQL_OPT_RECONNECT' option:

     my_bool reconnect = 0;
     mysql_options(&mysql, MYSQL_OPT_RECONNECT, &reconnect);

If the connection has gone down, the effect of *note 'mysql_ping()':
mysql-ping. depends on the auto-reconnect state.  If auto-reconnect is
enabled, *note 'mysql_ping()': mysql-ping. performs a reconnect.
Otherwise, it returns an error.

Some client programs might provide the capability of controlling
automatic reconnection.  For example, *note 'mysql': mysql. reconnects
by default, but the '--skip-reconnect' option can be used to suppress
this behavior.

If an automatic reconnection does occur (for example, as a result of
calling *note 'mysql_ping()': mysql-ping.), there is no explicit
indication of it.  To check for reconnection, call *note
'mysql_thread_id()': mysql-thread-id. to get the original connection
identifier before calling *note 'mysql_ping()': mysql-ping, then call
*note 'mysql_thread_id()': mysql-thread-id. again to see whether the
identifier changed.

Automatic reconnection can be convenient because you need not implement
your own reconnect code, but if a reconnection does occur, several
aspects of the connection state are reset on the server side and your
application will not be notified.

The connection-related state is affected as follows:

   * Any active transactions are rolled back and autocommit mode is
     reset.

   * All table locks are released.

   * All 'TEMPORARY' tables are closed (and dropped).

   * Session system variables are reinitialized to the values of the
     corresponding global system variables, including system variables
     that are set implicitly by statements such as *note 'SET NAMES':
     set-names.

   * User variable settings are lost.

   * Prepared statements are released.

   * *note 'HANDLER': handler. variables are closed.

   * The value of 'LAST_INSERT_ID()' is reset to 0.

   * Locks acquired with 'GET_LOCK()' are released.

If reconnection occurs, any SQL statement specified by calling *note
'mysql_options()': mysql-options. with the 'MYSQL_INIT_COMMAND' option
is re-executed.

If the connection drops, it is possible that the session associated with
the connection on the server side will still be running if the server
has not yet detected that the client is no longer connected.  In this
case, any locks held by the original connection still belong to that
session, so you may want to kill it by calling *note 'mysql_kill()':
mysql-kill.


File: manual.info.tmp,  Node: c-api-common-issues,  Prev: c-api-auto-reconnect,  Up: c-api

23.7.20 C API Common Issues
---------------------------

* Menu:

* null-mysql-store-result::      Why mysql_store_result() Sometimes Returns NULL After mysql_query() Returns Success
* query-results::                What Results You Can Get from a Query
* getting-unique-id::            How to Get the Unique ID for the Last Inserted Row


File: manual.info.tmp,  Node: null-mysql-store-result,  Next: query-results,  Prev: c-api-common-issues,  Up: c-api-common-issues

23.7.20.1 Why mysql_store_result() Sometimes Returns NULL After mysql_query() Returns Success
.............................................................................................

It is possible for *note 'mysql_store_result()': mysql-store-result. to
return 'NULL' following a successful call to *note 'mysql_query()':
mysql-query.  When this happens, it means one of the following
conditions occurred:

   * There was a 'malloc()' failure (for example, if the result set was
     too large).

   * The data could not be read (an error occurred on the connection).

   * The query returned no data (for example, it was an *note 'INSERT':
     insert, *note 'UPDATE': update, or *note 'DELETE': delete.).

You can always check whether the statement should have produced a
nonempty result by calling *note 'mysql_field_count()':
mysql-field-count.  If *note 'mysql_field_count()': mysql-field-count.
returns zero, the result is empty and the last query was a statement
that does not return values (for example, an *note 'INSERT': insert. or
a *note 'DELETE': delete.).  If *note 'mysql_field_count()':
mysql-field-count. returns a nonzero value, the statement should have
produced a nonempty result.  See the description of the *note
'mysql_field_count()': mysql-field-count. function for an example.

You can test for an error by calling *note 'mysql_error()': mysql-error.
or *note 'mysql_errno()': mysql-errno.


File: manual.info.tmp,  Node: query-results,  Next: getting-unique-id,  Prev: null-mysql-store-result,  Up: c-api-common-issues

23.7.20.2 What Results You Can Get from a Query
...............................................

In addition to the result set returned by a query, you can also get the
following information:

   * *note 'mysql_affected_rows()': mysql-affected-rows. returns the
     number of rows affected by the last query when doing an *note
     'INSERT': insert, *note 'UPDATE': update, or *note 'DELETE':
     delete.

     For a fast re-create, use *note 'TRUNCATE TABLE': truncate-table.

   * *note 'mysql_num_rows()': mysql-num-rows. returns the number of
     rows in a result set.  With *note 'mysql_store_result()':
     mysql-store-result, *note 'mysql_num_rows()': mysql-num-rows. may
     be called as soon as *note 'mysql_store_result()':
     mysql-store-result. returns.  With *note 'mysql_use_result()':
     mysql-use-result, *note 'mysql_num_rows()': mysql-num-rows. may be
     called only after you have fetched all the rows with *note
     'mysql_fetch_row()': mysql-fetch-row.

   * *note 'mysql_insert_id()': mysql-insert-id. returns the ID
     generated by the last query that inserted a row into a table with
     an 'AUTO_INCREMENT' index.  See *note mysql-insert-id::.

   * Some queries (*note 'LOAD DATA': load-data, *note 'INSERT INTO ...
     SELECT': insert-select, *note 'UPDATE': update.) return additional
     information.  The result is returned by *note 'mysql_info()':
     mysql-info.  See the description for *note 'mysql_info()':
     mysql-info. for the format of the string that it returns.  *note
     'mysql_info()': mysql-info. returns a 'NULL' pointer if there is no
     additional information.


File: manual.info.tmp,  Node: getting-unique-id,  Prev: query-results,  Up: c-api-common-issues

23.7.20.3 How to Get the Unique ID for the Last Inserted Row
............................................................

If you insert a record into a table that contains an 'AUTO_INCREMENT'
column, you can obtain the value stored into that column by calling the
*note 'mysql_insert_id()': mysql-insert-id. function.

You can check from your C applications whether a value was stored in an
'AUTO_INCREMENT' column by executing the following code (which assumes
that you've checked that the statement succeeded).  It determines
whether the query was an *note 'INSERT': insert. with an
'AUTO_INCREMENT' index:

     if ((result = mysql_store_result(&mysql)) == 0 &&
         mysql_field_count(&mysql) == 0 &&
         mysql_insert_id(&mysql) != 0)
     {
         used_id = mysql_insert_id(&mysql);
     }

When a new 'AUTO_INCREMENT' value has been generated, you can also
obtain it by executing a 'SELECT LAST_INSERT_ID()' statement with *note
'mysql_query()': mysql-query. and retrieving the value from the result
set returned by the statement.

When inserting multiple values, the last automatically incremented value
is returned.

For 'LAST_INSERT_ID()', the most recently generated ID is maintained in
the server on a per-connection basis.  It is not changed by another
client.  It is not even changed if you update another 'AUTO_INCREMENT'
column with a nonmagic value (that is, a value that is not 'NULL' and
not '0').  Using 'LAST_INSERT_ID()' and 'AUTO_INCREMENT' columns
simultaneously from multiple clients is perfectly valid.  Each client
will receive the last inserted ID for the last statement _that_ client
executed.

If you want to use the ID that was generated for one table and insert it
into a second table, you can use SQL statements like this:

     INSERT INTO foo (auto,text)
         VALUES(NULL,'text');         # generate ID by inserting NULL
     INSERT INTO foo2 (id,text)
         VALUES(LAST_INSERT_ID(),'text');  # use ID in second table

*note 'mysql_insert_id()': mysql-insert-id. returns the value stored
into an 'AUTO_INCREMENT' column, whether that value is automatically
generated by storing 'NULL' or '0' or was specified as an explicit
value.  'LAST_INSERT_ID()' returns only automatically generated
'AUTO_INCREMENT' values.  If you store an explicit value other than
'NULL' or '0', it does not affect the value returned by
'LAST_INSERT_ID()'.

For more information on obtaining the last ID in an 'AUTO_INCREMENT'
column:

   * For information on 'LAST_INSERT_ID()', which can be used within an
     SQL statement, see *note information-functions::.

   * For information on *note 'mysql_insert_id()': mysql-insert-id, the
     function you use from within the C API, see *note
     mysql-insert-id::.

   * For information on obtaining the auto-incremented value when using
     Connector/J, see Retrieving 'AUTO_INCREMENT' Column Values through
     JDBC
     (https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-usagenotes-last-insert-id.html).

   * For information on obtaining the auto-incremented value when using
     Connector/ODBC, see Obtaining Auto-Increment Values
     (https://dev.mysql.com/doc/connector-odbc/en/connector-odbc-usagenotes-functionality-last-insert-id.html).


File: manual.info.tmp,  Node: apis-php-info,  Next: apis-perl,  Prev: c-api,  Up: connectors-apis

23.8 MySQL PHP API
==================

The MySQL PHP API manual is now published in standalone form, not as
part of the MySQL Reference Manual.  See MySQL and PHP
(https://dev.mysql.com/doc/apis-php/en/).


File: manual.info.tmp,  Node: apis-perl,  Next: apis-python,  Prev: apis-php-info,  Up: connectors-apis

23.9 MySQL Perl API
===================

The Perl 'DBI' module provides a generic interface for database access.
You can write a DBI script that works with many different database
engines without change.  To use DBI with MySQL, install the following:

  1. The 'DBI' module.

  2. The 'DBD::mysql' module.  This is the DataBase Driver (DBD) module
     for Perl.

  3. Optionally, the DBD module for any other type of database server
     you want to access.

Perl DBI is the recommended Perl interface.  It replaces an older
interface called 'mysqlperl', which should be considered obsolete.

These sections contain information about using Perl with MySQL and
writing MySQL applications in Perl:

   * For installation instructions for Perl DBI support, see *note
     perl-support::.

   * For an example of reading options from option files, see *note
     multiple-server-clients::.

   * For secure coding tips, see *note security-guidelines::.

   * For debugging tips, see *note using-gdb-on-mysqld::.

   * For some Perl-specific environment variables, see *note
     environment-variables::.

   * For considerations for running on macOS, see *note
     osx-installation::.

   * For ways to quote string literals, see *note string-literals::.

DBI information is available at the command line, online, or in printed
form:

   * Once you have the 'DBI' and 'DBD::mysql' modules installed, you can
     get information about them at the command line with the 'perldoc'
     command:

          shell> perldoc DBI
          shell> perldoc DBI::FAQ
          shell> perldoc DBD::mysql

     You can also use 'pod2man', 'pod2html', and so on to translate this
     information into other formats.

   * For online information about Perl DBI, visit the DBI website,
     <http://dbi.perl.org/>.  That site hosts a general DBI mailing
     list.

   * For printed information, the official DBI book is 'Programming the
     Perl DBI' (Alligator Descartes and Tim Bunce, O'Reilly &
     Associates, 2000).  Information about the book is available at the
     DBI website, <http://dbi.perl.org/>.


File: manual.info.tmp,  Node: apis-python,  Next: apis-ruby,  Prev: apis-perl,  Up: connectors-apis

23.10 MySQL Python API
======================

'MySQLdb' is a third-party driver that provides MySQL support for
Python, compliant with the Python DB API version 2.0.  It can be found
at <http://sourceforge.net/projects/mysql-python/>.

The new MySQL Connector/Python component provides an interface to the
same Python API, and is built into the MySQL Server and supported by
Oracle.  See MySQL Connector/Python Developer Guide
(https://dev.mysql.com/doc/connector-python/en/) for details on the
Connector, as well as coding guidelines for Python applications and
sample Python code.


File: manual.info.tmp,  Node: apis-ruby,  Next: apis-tcl,  Prev: apis-python,  Up: connectors-apis

23.11 MySQL Ruby APIs
=====================

* Menu:

* apis-ruby-mysqlruby::          The MySQL/Ruby API
* apis-ruby-rubymysql::          The Ruby/MySQL API

Two APIs are available for Ruby programmers developing MySQL
applications:

   * The MySQL/Ruby API is based on the 'libmysqlclient' API library.
     For information on installing and using the MySQL/Ruby API, see
     *note apis-ruby-mysqlruby::.

   * The Ruby/MySQL API is written to use the native MySQL network
     protocol (a native driver).  For information on installing and
     using the Ruby/MySQL API, see *note apis-ruby-rubymysql::.

For background and syntax information about the Ruby language, see Ruby
Programming Language (http://www.ruby-lang.org).


File: manual.info.tmp,  Node: apis-ruby-mysqlruby,  Next: apis-ruby-rubymysql,  Prev: apis-ruby,  Up: apis-ruby

23.11.1 The MySQL/Ruby API
--------------------------

The MySQL/Ruby module provides access to MySQL databases using Ruby
through 'libmysqlclient'.

For information on installing the module, and the functions exposed, see
MySQL/Ruby (http://tmtm.org/en/mysql/ruby/).


File: manual.info.tmp,  Node: apis-ruby-rubymysql,  Prev: apis-ruby-mysqlruby,  Up: apis-ruby

23.11.2 The Ruby/MySQL API
--------------------------

The Ruby/MySQL module provides access to MySQL databases using Ruby
through a native driver interface using the MySQL network protocol.

For information on installing the module, and the functions exposed, see
Ruby/MySQL (http://tmtm.org/en/ruby/mysql/README_en.html).


File: manual.info.tmp,  Node: apis-tcl,  Next: apis-eiffel,  Prev: apis-ruby,  Up: connectors-apis

23.12 MySQL Tcl API
===================

'MySQLtcl' is a simple API for accessing a MySQL database server from
the Tcl programming language (http://en.wikipedia.org/wiki/Tcl).  It can
be found at <http://www.xdobry.de/mysqltcl/>.


File: manual.info.tmp,  Node: apis-eiffel,  Prev: apis-tcl,  Up: connectors-apis

23.13 MySQL Eiffel Wrapper
==========================

Eiffel MySQL is an interface to the MySQL database server using the
Eiffel programming language
(http://en.wikipedia.org/wiki/Eiffel_(programming_language)), written by
Michael Ravits.  It can be found at
<http://efsa.sourceforge.net/archive/ravits/mysql.htm>.


File: manual.info.tmp,  Node: extending-mysql,  Next: mysql-enterprise,  Prev: connectors-apis,  Up: Top

24 Extending MySQL
******************

* Menu:

* mysql-internals::              MySQL Internals
* plugin-api::                   The MySQL Plugin API
* plugin-services::              MySQL Services for Plugins
* adding-functions::             Adding Functions to MySQL
* porting::                      Debugging and Porting MySQL


File: manual.info.tmp,  Node: mysql-internals,  Next: plugin-api,  Prev: extending-mysql,  Up: extending-mysql

24.1 MySQL Internals
====================

* Menu:

* mysql-threads::                MySQL Threads
* mysql-test-suite::             The MySQL Test Suite

This chapter describes what you need to know when working on the MySQL
code.  To track or contribute to MySQL development, follow the
instructions in *note installing-development-tree::.  If you are
interested in MySQL internals, you should also join the MySQL Community
Slack (https://mysqlcommunity.slack.com/).  Feel free to ask questions
about the code and to send patches that you would like to contribute to
the MySQL project!


File: manual.info.tmp,  Node: mysql-threads,  Next: mysql-test-suite,  Prev: mysql-internals,  Up: mysql-internals

24.1.1 MySQL Threads
--------------------

The MySQL server creates the following threads:

   * Connection manager threads handle client connection requests on the
     network interfaces that the server listens to.  On all platforms,
     one manager thread handles TCP/IP connection requests.  On Unix,
     this manager thread also handles Unix socket file connection
     requests.  On Windows, a manager thread handles shared-memory
     connection requests, and another handles named-pipe connection
     requests.  The server does not create threads to handle interfaces
     that it does not listen to.  For example, a Windows server that
     does not have support for named-pipe connections enabled does not
     create a thread to handle them.

   * Connection manager threads associate each client connection with a
     thread dedicated to it that handles authentication and request
     processing for that connection.  Manager threads create a new
     thread when necessary but try to avoid doing so by consulting the
     thread cache first to see whether it contains a thread that can be
     used for the connection.  When a connection ends, its thread is
     returned to the thread cache if the cache is not full.

     For information about tuning the parameters that control thread
     resources, see *note client-connections::.

   * On a master replication server, connections from slave servers are
     handled like client connections: There is one thread per connected
     slave.

   * On a slave replication server, an I/O thread is started to connect
     to the master server and read updates from it.  An SQL thread is
     started to apply updates read from the master.  These two threads
     run independently and can be started and stopped independently.

   * A signal thread handles all signals.  This thread also normally
     handles alarms and calls 'process_alarm()' to force timeouts on
     connections that have been idle too long.

   * If 'InnoDB' is used, there will be additional read and write
     threads by default.  The number of these are controlled by the
     'innodb_read_io_threads' and 'innodb_write_io_threads' parameters.
     See *note innodb-parameters::.

   * If *note 'mysqld': mysqld. is compiled with '-DUSE_ALARM_THREAD', a
     dedicated thread that handles alarms is created.  This is only used
     on some systems where there are problems with 'sigwait()' or if you
     want to use the 'thr_alarm()' code in your application without a
     dedicated signal handling thread.

   * If the server is started with the '--flush_time=VAL' option, a
     dedicated thread is created to flush all tables every VAL seconds.

   * Each table for which *note 'INSERT DELAYED': insert-delayed.
     statements are issued gets its own thread.  See *note
     insert-delayed::.

   * If the event scheduler is active, there is one thread for the
     scheduler, and a thread for each event currently running.  See
     *note events-overview::.

*note 'mysqladmin processlist': mysqladmin. only shows the connection,
*note 'INSERT DELAYED': insert-delayed, replication, and event threads.


File: manual.info.tmp,  Node: mysql-test-suite,  Prev: mysql-threads,  Up: mysql-internals

24.1.2 The MySQL Test Suite
---------------------------

The test system that is included in Unix source and binary distributions
makes it possible for users and developers to perform regression tests
on the MySQL code.  These tests can be run on Unix.

You can also write your own test cases.  For information, including
system requirements, see The MySQL Test Framework in the MySQL Server
Doxygen documentation, available at
<https://dev.mysql.com/doc/index-other.html>.

The current set of test cases does not test everything in MySQL, but it
should catch most obvious bugs in the SQL processing code, operating
system or library issues, and is quite thorough in testing replication.
Our goal is to have the tests cover 100% of the code.  We welcome
contributions to our test suite.  You may especially want to contribute
tests that examine the functionality critical to your system because
this ensures that all future MySQL releases work well with your
applications.

The test system consists of a test language interpreter ('mysqltest'), a
Perl script to run all tests ('mysql-test-run.pl'), the actual test
cases written in a special test language, and their expected results.
To run the test suite on your system after a build, type 'make test'
from the source root directory, or change location to the 'mysql-test'
directory and type './mysql-test-run.pl'.  If you have installed a
binary distribution, change location to the 'mysql-test' directory under
the installation root directory (for example,
'/usr/local/mysql/mysql-test'), and run './mysql-test-run.pl'.  All
tests should succeed.  If any do not, feel free to try to find out why
and report the problem if it indicates a bug in MySQL. See *note
bug-reports::.

If one test fails, you should run 'mysql-test-run.pl' with the '--force'
option to check whether any other tests fail.

If you have a copy of *note 'mysqld': mysqld. running on the machine
where you want to run the test suite, you do not have to stop it, as
long as it is not using ports '9306' or '9307'.  If either of those
ports is taken, you should set the 'MTR_BUILD_THREAD' environment
variable to an appropriate value, and the test suite will use a
different set of ports for master, slave, and NDB). For example:

     shell> export MTR_BUILD_THREAD=31
     shell> ./mysql-test-run.pl [OPTIONS] [TEST_NAME]

In the 'mysql-test' directory, you can run an individual test case with
'./mysql-test-run.pl TEST_NAME'.

If you have a question about the test suite, or have a test case to
contribute, join the MySQL Community Slack
(https://mysqlcommunity.slack.com/).


File: manual.info.tmp,  Node: plugin-api,  Next: plugin-services,  Prev: mysql-internals,  Up: extending-mysql

24.2 The MySQL Plugin API
=========================

* Menu:

* plugin-types::                 Types of Plugins
* plugin-api-characteristics::   Plugin API Characteristics
* plugin-api-components::        Plugin API Components
* writing-plugins::              Writing Plugins

MySQL supports a plugin API that enables creation of server components.
Plugins can be loaded at server startup, or loaded and unloaded at
runtime without restarting the server.  The API is generic and does not
specify what plugins can do.  The components supported by this interface
include, but are not limited to, storage engines, full-text parser
plugins, and server extensions.

For example, full-text parser plugins can be used to replace or augment
the built-in full-text parser.  A plugin can parse text into words using
rules that differ from those used by the built-in parser.  This can be
useful if you need to parse text with characteristics different from
those expected by the built-in parser.

The plugin interface is more general than the older user-defined
function (UDF) interface.

The plugin interface uses the 'plugin' table in the 'mysql' database to
record information about plugins that have been installed permanently
with the *note 'INSTALL PLUGIN': install-plugin. statement.  This table
is created as part of the MySQL installation process.  Plugins can also
be installed for a single server invocation with the '--plugin-load'
option.  Plugins installed this way are not recorded in the 'plugin'
table.  See *note plugin-loading::.

MySQL supports an API for client plugins in addition to that for server
plugins.  This is used, for example, by authentication plugins where a
server-side plugin and a client-side plugin cooperate to enable clients
to connect to the server through a variety of authentication methods.

*Additional Resources*

The book 'MySQL 5.1 Plugin Development' by Sergei Golubchik and Andrew
Hutchings provides a wealth of detail about the plugin API. Despite the
fact that the book's title refers to MySQL Server 5.1, most of the
information in it applies to later versions as well.


File: manual.info.tmp,  Node: plugin-types,  Next: plugin-api-characteristics,  Prev: plugin-api,  Up: plugin-api

24.2.1 Types of Plugins
-----------------------

The plugin API enables creation of plugins that implement several
capabilities:

   * Storage engines

   * Full-text parsers

   * Daemons

   * 'INFORMATION_SCHEMA' tables

   * Semisynchronous replication

   * Auditing

   * Authentication

The following sections provide an overview of these plugin types.

   * *note storage-engine-plugin-type::

   * *note full-text-plugin-type::

   * *note daemon-plugin-type::

   * *note information-schema-plugin-type::

   * *note semisynchronous-replication-plugin-type::

   * *note audit-plugin-type::

   * *note authentication-plugin-type::

*Storage Engine Plugins*

The pluggable storage engine architecture used by MySQL Server enables
storage engines to be written as plugins and loaded into and unloaded
from a running server.  For a description of this architecture, see
*note pluggable-storage-overview::.

For information on how to use the plugin API to write storage engines,
see MySQL Internals: Writing a Custom Storage Engine
(https://dev.mysql.com/doc/internals/en/custom-engine.html).

*Full-Text Parser Plugins*

MySQL has a built-in parser that it uses by default for full-text
operations (parsing text to be indexed, or parsing a query string to
determine the terms to be used for a search).  For full-text processing,
'parsing' means extracting words from text or a query string based on
rules that define which character sequences make up a word and where
word boundaries lie.

When parsing for indexing purposes, the parser passes each word to the
server, which adds it to a full-text index.  When parsing a query
string, the parser passes each word to the server, which accumulates the
words for use in a search.

The parsing properties of the built-in full-text parser are described in
*note fulltext-search::.  These properties include rules for determining
how to extract words from text.  The parser is influenced by certain
system variables such as 'ft_min_word_len' and 'ft_max_word_len' that
cause words shorter or longer to be excluded, and by the stopword list
that identifies common words to be ignored.

The plugin API enables you to provide a full-text parser of your own so
that you have control over the basic duties of a parser.  A parser
plugin can operate in either of two roles:

   * The plugin can replace the built-in parser.  In this role, the
     plugin reads the input to be parsed, splits it up into words, and
     passes the words to the server (either for indexing or for word
     accumulation).

     One reason to use a parser this way is that you need to use
     different rules from those of the built-in parser for determining
     how to split up input into words.  For example, the built-in parser
     considers the text 'case-sensitive' to consist of two words 'case'
     and 'sensitive,' whereas an application might need to treat the
     text as a single word.

   * The plugin can act in conjunction with the built-in parser by
     serving as a front end for it.  In this role, the plugin extracts
     text from the input and passes the text to the parser, which splits
     up the text into words using its normal parsing rules.  In
     particular, this parsing will be affected by the 'ft_XXX' system
     variables and the stopword list.

     One reason to use a parser this way is that you need to index
     content such as PDF documents, XML documents, or '.doc' files.  The
     built-in parser is not intended for those types of input but a
     plugin can pull out the text from these input sources and pass it
     to the built-in parser.

It is also possible for a parser plugin to operate in both roles.  That
is, it could extract text from noncleartext input (the front end role),
and also parse the text into words (thus replacing the built-in parser).

A full-text plugin is associated with full-text indexes on a per-index
basis.  That is, when you install a parser plugin initially, that does
not cause it to be used for any full-text operations.  It simply becomes
available.  For example, a full-text parser plugin becomes available to
be named in a 'WITH PARSER' clause when creating individual 'FULLTEXT'
indexes.  To create such an index at table-creation time, do this:

     CREATE TABLE t
     (
       doc CHAR(255),
       FULLTEXT INDEX (doc) WITH PARSER my_parser
     ) ENGINE=MyISAM;

Or you can add the index after the table has been created:

     ALTER TABLE t ADD FULLTEXT INDEX (doc) WITH PARSER my_parser;

The only SQL change for associating the parser with the index is the
'WITH PARSER' clause.  Searches are specified as before, with no changes
needed for queries.

When you associate a parser plugin with a 'FULLTEXT' index, the plugin
is required for using the index.  If the parser plugin is dropped, any
index associated with it becomes unusable.  Any attempt to use a table
for which a plugin is not available results in an error, although *note
'DROP TABLE': drop-table. is still possible.

For more information about full-text plugins, see *note
writing-full-text-plugins::.  MySQL 5.5 only supports full-text plugins
with *note 'MyISAM': myisam-storage-engine.

*Daemon Plugins*

A daemon plugin is a simple type of plugin used for code that should be
run by the server but that does not communicate with it.  MySQL
distributions include an example daemon plugin that writes periodic
heartbeat messages to a file.

For more information about daemon plugins, see *note
writing-daemon-plugins::.

*INFORMATION_SCHEMA Plugins*

'INFORMATION_SCHEMA' plugins enable the creation of tables containing
server metadata that are exposed to users through the
'INFORMATION_SCHEMA' database.  For example, 'InnoDB' uses
'INFORMATION_SCHEMA' plugins to provide tables that contain information
about current transactions and locks.

For more information about 'INFORMATION_SCHEMA' plugins, see *note
writing-information-schema-plugins::.

*Semisynchronous Replication Plugins*

MySQL replication is asynchronous by default.  With semisynchronous
replication, a commit performed on the master side blocks before
returning to the session that performed the transaction until at least
one slave acknowledges that it has received and logged the events for
the transaction.  Semisynchronous replication is implemented through
complementary master and client plugins.  See *note
replication-semisync::.

For more information about semisynchronous replication plugins, see
*note writing-semisynchronous-replication-plugins::.

*Audit Plugins*

The server provides a pluggable audit interface that enables information
about server operations to be reported to interested parties.  Audit
notification occurs for these operations (although the interface is
general and the server could be modified to report others):

   * Write a message to the general query log (if the log is enabled)

   * Write a message to the error log

   * Send a query result to a client

Audit plugins may register with the audit interface to receive
notification about server operations.  When an auditable event occurs
within the server, the server determines whether notification is needed.
For each registered audit plugin, the server checks the event against
those event classes in which the plugin is interested and passes the
event to the plugin if there is a match.

This interface enables audit plugins to receive notifications only about
operations in event classes they consider significant and to ignore
others.  The interface provides for categorization of operations into
event classes and further division into event subclasses within each
class.

When an audit plugin is notified of an auditable event, it receives a
pointer to the current THD structure and a pointer to a structure that
contains information about the event.  The plugin can examine the event
and perform whatever auditing actions are appropriate.  For example, the
plugin can see what statement produced a result set or was logged, the
number of rows in a result, who the current user was for an operation,
or the error code for failed operations.

For more information about audit plugins, see *note
writing-audit-plugins::.

*Authentication Plugins*

MySQL supports pluggable authentication.  Authentication plugins exist
on both the server and client sides.  Plugins on the server side
implement authentication methods for use by clients when they connect to
the server.  A plugin on the client side communicates with a server-side
plugin to provide the authentication information that it requires.  A
client-side plugin may interact with the user, performing tasks such as
soliciting a password or other authentication credentials to be sent to
the server.  See *note pluggable-authentication::.

Pluggable authentication also enables proxy user capability, in which
one user takes the identity of another user.  A server-side
authentication plugin can return to the server the name of the user
whose identity the connecting user should have.  See *note
proxy-users::.

For more information about authentication plugins, see *note
writing-authentication-plugins::.


File: manual.info.tmp,  Node: plugin-api-characteristics,  Next: plugin-api-components,  Prev: plugin-types,  Up: plugin-api

24.2.2 Plugin API Characteristics
---------------------------------

The server plugin API has these characteristics:

   * All plugins have several things in common.

     Each plugin has a name that it can be referred to in SQL
     statements, as well as other metadata such as an author and a
     description that provide other information.  This information can
     be examined in the *note 'INFORMATION_SCHEMA.PLUGINS':
     plugins-table. table or using the *note 'SHOW PLUGINS':
     show-plugins. statement.

   * The plugin framework is extendable to accommodate different kinds
     of plugins.

     Although some aspects of the plugin API are common to all types of
     plugins, the API also permits type-specific interface elements so
     that different types of plugins can be created.  A plugin with one
     purpose can have an interface most appropriate to its own
     requirements and not the requirements of some other plugin type.

     Interfaces for several types of plugins exist, such as storage
     engines, full-text parser, and 'INFORMATION_SCHEMA' tables.  Others
     can be added.

   * Plugins can expose information to users.

     A plugin can implement system and status variables that are
     available through the *note 'SHOW VARIABLES': show-variables. and
     *note 'SHOW STATUS': show-status. statements.

   * The plugin API includes versioning information.

     The version information included in the plugin API enables a plugin
     library and each plugin that it contains to be self-identifying
     with respect to the API version that was used to build the library.
     If the API changes over time, the version numbers will change, but
     a server can examine a given plugin library's version information
     to determine whether it supports the plugins in the library.

     There are two types of version numbers.  The first is the version
     for the general plugin framework itself.  Each plugin library
     includes this kind of version number.  The second type of version
     applies to individual plugins.  Each specific type of plugin has a
     version for its interface, so each plugin in a library has a
     type-specific version number.  For example, a library containing a
     full-text parser plugin has a general plugin API version number,
     and the plugin has a version number specific to the full-text
     plugin interface.

   * The plugin API implements security restrictions.

     A plugin library must be installed in a specific dedicated
     directory for which the location is controlled by the server and
     cannot be changed at runtime.  Also, the library must contain
     specific symbols that identify it as a plugin library.  The server
     will not load something as a plugin if it was not built as a
     plugin.

   * Plugins have access to server services.

     The services interface exposes server functionality that plugins
     can access using ordinary function calls.  For details, see *note
     plugin-services::.

In some respects, the server plugin API is similar to the older
user-defined function (UDF) API that it supersedes, but the plugin API
has several advantages over the older interface.  For example, UDFs had
no versioning information.  Also, the newer plugin interface eliminates
the security issues of the older UDF interface.  The older interface for
writing nonplugin UDFs permitted libraries to be loaded from any
directory searched by the system's dynamic linker, and the symbols that
identified the UDF library were relatively nonspecific.

The client plugin API has similar architectural characteristics, but
client plugins have no direct access to the server the way server
plugins do.


File: manual.info.tmp,  Node: plugin-api-components,  Next: writing-plugins,  Prev: plugin-api-characteristics,  Up: plugin-api

24.2.3 Plugin API Components
----------------------------

The server plugin implementation comprises several components.

SQL statements:

   * *note 'INSTALL PLUGIN': install-plugin. registers a plugin in the
     'mysql.plugin' table and loads the plugin code.

   * *note 'UNINSTALL PLUGIN': uninstall-plugin. unregisters a plugin
     from the 'mysql.plugin' table and unloads the plugin code.

   * The 'WITH PARSER' clause for full-text index creation associates a
     full-text parser plugin with a given 'FULLTEXT' index.

   * *note 'SHOW PLUGINS': show-plugins. displays information about
     server plugins.

Command-line options and system variables:

   * The '--plugin-load' option enables plugins to be loaded at server
     startup time.

   * The 'plugin_dir' system variable indicates the location of the
     directory where all plugins must be installed.  The value of this
     variable can be specified at server startup with a
     '--plugin_dir=DIR_NAME' option.  *note 'mysql_config --plugindir':
     mysql-config. displays the default plugin directory path name.

For additional information about plugin loading, see *note
plugin-loading::.

Plugin-related tables:

   * The *note 'INFORMATION_SCHEMA.PLUGINS': plugins-table. table
     contains plugin information.

   * The 'mysql.plugin' table lists each plugin that was installed with
     *note 'INSTALL PLUGIN': install-plugin. and is required for plugin
     use.  For new MySQL installations, this table is created during the
     installation process.

The client plugin implementation is simpler:

   * For the *note 'mysql_options()': mysql-options. C API function, the
     'MYSQL_DEFAULT_AUTH' and 'MYSQL_PLUGIN_DIR' options enable client
     programs to load authentication plugins.

   * There are C API functions that enable management of client plugins.

To examine how MySQL implements plugins, consult the following source
files in a MySQL source distribution:

   * In the 'include/mysql' directory, 'plugin.h' exposes the public
     plugin API. This file should be examined by anyone who wants to
     write a plugin library.  'plugin_XXX.h' files provide additional
     information that pertains to specific types of plugins.
     'client_plugin.h' contains information specific to client plugins.

   * In the 'sql' directory, 'sql_plugin.h' and 'sql_plugin.cc' comprise
     the internal plugin implementation.  'sql_acl.cc' is where the
     server uses authentication plugins.  These files need not be
     consulted by plugin developers.  They may be of interest for those
     who want to know more about how the server handles plugins.

   * In the 'sql-common' directory, 'client_plugin.h' implements the C
     API client plugin functions, and 'client.c' implements client
     authentication support.  These files need not be consulted by
     plugin developers.  They may be of interest for those who want to
     know more about how the server handles plugins.


File: manual.info.tmp,  Node: writing-plugins,  Prev: plugin-api-components,  Up: plugin-api

24.2.4 Writing Plugins
----------------------

* Menu:

* writing-plugins-overview::     Overview of Plugin Writing
* plugin-data-structures::       Plugin Data Structures
* compiling-plugin-libraries::   Compiling and Installing Plugin Libraries
* writing-full-text-plugins::    Writing Full-Text Parser Plugins
* writing-daemon-plugins::       Writing Daemon Plugins
* writing-information-schema-plugins::  Writing INFORMATION_SCHEMA Plugins
* writing-semisynchronous-replication-plugins::  Writing Semisynchronous Replication Plugins
* writing-audit-plugins::        Writing Audit Plugins
* writing-authentication-plugins::  Writing Authentication Plugins

To create a plugin library, you must provide the required descriptor
information that indicates what plugins the library file contains, and
write the interface functions for each plugin.

Every server plugin must have a general descriptor that provides
information to the plugin API, and a type-specific descriptor that
provides information about the plugin interface for a given type of
plugin.  The structure of the general descriptor is the same for all
plugin types.  The structure of the type-specific descriptor varies
among plugin types and is determined by the requirements of what the
plugin needs to do.  The server plugin interface also enables plugins to
expose status and system variables.  These variables become visible
through the *note 'SHOW STATUS': show-status. and *note 'SHOW
VARIABLES': show-variables. statements and the corresponding
'INFORMATION_SCHEMA' tables.

For client-side plugins, the architecture is a bit different.  Each
plugin must have a descriptor, but there is no division into separate
general and type-specific descriptors.  Instead, the descriptor begins
with a fixed set of members common to all client plugin types, and the
common members are followed by any additional members required to
implement the specific plugin type.

You can write plugins in C or C++ (or another language that can use C
calling conventions).  Plugins are loaded and unloaded dynamically, so
your operating system must support dynamic loading and you must have
compiled the calling application dynamically (not statically).  For
server plugins, this means that *note 'mysqld': mysqld. must be linked
dynamically.

A server plugin contains code that becomes part of the running server,
so when you write the plugin, you are bound by any and all constraints
that otherwise apply to writing server code.  For example, you may have
problems if you attempt to use functions from the 'libstdc++' library.
These constraints may change in future versions of the server, so it is
possible that server upgrades will require revisions to plugins
originally written for older servers.  For information about these
constraints, see *note source-configuration-options::, and *note
compilation-problems::.

Client plugin writers should avoid dependencies on what symbols the
calling application has because you cannot be sure what applications
will use the plugin.


File: manual.info.tmp,  Node: writing-plugins-overview,  Next: plugin-data-structures,  Prev: writing-plugins,  Up: writing-plugins

24.2.4.1 Overview of Plugin Writing
...................................

The following procedure provides an overview of the steps needed to
create a plugin library.  The next sections provide additional details
on setting plugin data structures and writing specific types of plugins.

  1. In the plugin source file, include the header files that the plugin
     library needs.  The 'plugin.h' file is required, and the library
     might require other files as well.  For example:

          #include <stdlib.h>
          #include <ctype.h>
          #include <mysql/plugin.h>

  2. Set up the descriptor information for the plugin library file.  For
     server plugins, write the library descriptor, which must contain
     the general plugin descriptor for each server plugin in the file.
     For more information, see *note server-plugin-descriptors::.  In
     addition, set up the type-specific descriptor for each server
     plugin in the library.  Each plugin's general descriptor points to
     its type-specific descriptor.

     For client plugins, write the client descriptor.  For more
     information, see *note client-plugin-descriptors::.

  3. Write the plugin interface functions for each plugin.  For example,
     each plugin's general plugin descriptor points to the
     initialization and deinitialization functions that the server
     should invoke when it loads and unloads the plugin.  The plugin's
     type-specific description may also point to interface functions.

  4. For server plugins, set up the status and system variables, if
     there are any.

  5. Compile the plugin library as a shared library and install it in
     the plugin directory.  For more information, see *note
     compiling-plugin-libraries::.

  6. For server plugins, register the plugin with the server.  For more
     information, see *note plugin-loading::.

  7. Test the plugin to verify that it works properly.


File: manual.info.tmp,  Node: plugin-data-structures,  Next: compiling-plugin-libraries,  Prev: writing-plugins-overview,  Up: writing-plugins

24.2.4.2 Plugin Data Structures
...............................

* Menu:

* server-plugin-descriptors::    Server Plugin Library and Plugin Descriptors
* plugin-status-system-variables::  Server Plugin Status and System Variables
* client-plugin-descriptors::    Client Plugin Descriptors

A plugin library file includes descriptor information to indicate what
plugins it contains.

If the plugin library contains any server plugins, it must include the
following descriptor information:

   * A library descriptor indicates the general server plugin API
     version number used by the library and contains a general plugin
     descriptor for each server plugin in the library.  To provide the
     framework for this descriptor, invoke two macros from the
     'plugin.h' header file:

          mysql_declare_plugin(NAME)
           ... ONE OR MORE SERVER PLUGIN DESCRIPTORS HERE ...
          mysql_declare_plugin_end;

     The macros expand to provide a declaration for the API version
     automatically.  You must provide the plugin descriptors.

   * Within the library descriptor, each general server plugin is
     described by a 'st_mysql_plugin' structure.  This plugin descriptor
     structure contains information that is common to every type of
     server plugin: A value that indicates the plugin type; the plugin
     name, author, description, and license type; pointers to the
     initialization and deinitialization functions that the server
     invokes when it loads and unloads the plugin, and pointers to any
     status or system variables the plugin implements.

   * Each general server plugin descriptor within the library descriptor
     also contains a pointer to a type-specific plugin descriptor.  The
     structure of the type-specific descriptors varies from one plugin
     type to another because each type of plugin can have its own API. A
     type-specific plugin descriptor contains a type-specific API
     version number and pointers to the functions that are needed to
     implement that plugin type.  For example, a full-text parser plugin
     has initialization and deinitialization functions, and a main
     parsing function.  The server invokes these functions when it uses
     the plugin to parse text.

The plugin library also contains the interface functions that are
referenced by the general and type-specific descriptors for each plugin
in the library.

If the plugin library contains a client plugin, it must include a
descriptor for the plugin.  The descriptor begins with a fixed set of
members common to all client plugins, followed by any members specific
to the plugin type.  To provide the descriptor framework, invoke two
macros from the 'client_plugin.h' header file:

     mysql_declare_client_plugin(PLUGIN_TYPE)
        ... MEMBERS COMMON TO ALL CLIENT PLUGINS ...
        ... TYPE-SPECIFIC EXTRA MEMBERS ...
     mysql_end_client_plugin;

The plugin library also contains any interface functions referenced by
the client descriptor.

The 'mysql_declare_plugin()' and 'mysql_declare_client_plugin()' macros
differ somewhat in how they can be invoked, which has implications for
the contents of plugin libraries.  The following guidelines summarize
the rules:

   * 'mysql_declare_plugin()' and 'mysql_declare_client_plugin()' can
     both be used in the same source file, which means that a plugin
     library can contain both server and client plugins.  However, each
     of 'mysql_declare_plugin()' and 'mysql_declare_client_plugin()' can
     be used at most once.

   * 'mysql_declare_plugin()' permits multiple server plugin
     declarations, so a plugin library can contain multiple server
     plugins.

   * 'mysql_declare_client_plugin()' permits only a single client plugin
     declaration.  To create multiple client plugins, separate plugin
     libraries must be used.

When a client program looks for a client plugin that is in a plugin
library and not built into 'libmysqlclient', it looks for a file with a
base name that is the same as the plugin name.  For example, if a
program needs to use a client authentication plugin named 'auth_xxx' on
a system that uses '.so' as the library suffix, it looks in the file
named 'auth_xxx.so'.  (On macOS, the program looks first for
'auth_xxx.dylib', then for 'auth_xxx.so'.)  For this reason, if a plugin
library contains a client plugin, the library must have the same base
name as that plugin.

The same is not true for a library that contains server plugins.  The
'--plugin-load' option and the *note 'INSTALL PLUGIN': install-plugin.
statement provide the library file name explicitly, so there need be no
explicit relationship between the library name and the name of any
server plugins it contains.


File: manual.info.tmp,  Node: server-plugin-descriptors,  Next: plugin-status-system-variables,  Prev: plugin-data-structures,  Up: plugin-data-structures

24.2.4.3 Server Plugin Library and Plugin Descriptors
.....................................................

Every plugin library that contains server plugins must include a library
descriptor that contains the general plugin descriptor for each server
plugin in the file.  This section discusses how to write the library and
general descriptors for server plugins.

The library descriptor must define two symbols:

   * '_mysql_plugin_interface_version_' specifies the version number of
     the general plugin framework.  This is given by the
     'MYSQL_PLUGIN_INTERFACE_VERSION' symbol, which is defined in the
     'plugin.h' file.

   * '_mysql_plugin_declarations_' defines an array of plugin
     declarations, terminated by a declaration with all members set to
     0.  Each declaration is an instance of the 'st_mysql_plugin'
     structure (also defined in 'plugin.h').  There must be one of these
     for each server plugin in the library.

If the server does not find those two symbols in a library, it does not
accept it as a legal plugin library and rejects it with an error.  This
prevents use of a library for plugin purposes unless it was built
specifically as a plugin library.

The conventional way to define the two required symbols is by using the
'mysql_declare_plugin()' and 'mysql_declare_plugin_end' macros from the
'plugin.h' file:

     mysql_declare_plugin(NAME)
      ... ONE OR MORE SERVER PLUGIN DESCRIPTORS HERE ...
     mysql_declare_plugin_end;

Each server plugin must have a general descriptor that provides
information to the server plugin API. The general descriptor has the
same structure for all plugin types.  The 'st_mysql_plugin' structure in
the 'plugin.h' file defines this descriptor:

     struct st_mysql_plugin
     {
       int type;             /* the plugin type (a MYSQL_XXX_PLUGIN value)   */
       void *info;           /* pointer to type-specific plugin descriptor   */
       const char *name;     /* plugin name                                  */
       const char *author;   /* plugin author (for I_S.PLUGINS)              */
       const char *descr;    /* general descriptive text (for I_S.PLUGINS)   */
       int license;          /* the plugin license (PLUGIN_LICENSE_XXX)      */
       int (*init)(void *);  /* the function to invoke when plugin is loaded */
       int (*deinit)(void *);/* the function to invoke when plugin is unloaded */
       unsigned int version; /* plugin version (for I_S.PLUGINS)             */
       struct st_mysql_show_var *status_vars;
       struct st_mysql_sys_var **system_vars;
       void * __reserved1;   /* reserved for dependency checking             */
       unsigned long flags;  /* flags for plugin */
     };

The 'st_mysql_plugin' descriptor structure members are used as follows.
'char *' members should be specified as null-terminated strings.

   * 'type': The plugin type.  This must be one of the plugin-type
     values from 'plugin.h':

          /*
            The allowable types of plugins
          */
          #define MYSQL_UDF_PLUGIN             0  /* User-defined function        */
          #define MYSQL_STORAGE_ENGINE_PLUGIN  1  /* Storage Engine               */
          #define MYSQL_FTPARSER_PLUGIN        2  /* Full-text parser plugin      */
          #define MYSQL_DAEMON_PLUGIN          3  /* The daemon/raw plugin type */
          #define MYSQL_INFORMATION_SCHEMA_PLUGIN  4  /* The I_S plugin type */
          #define MYSQL_AUDIT_PLUGIN           5  /* The Audit plugin type        */
          #define MYSQL_REPLICATION_PLUGIN     6  /* The replication plugin type */
          #define MYSQL_AUTHENTICATION_PLUGIN  7  /* The authentication plugin type */
          ...

     For example, for a full-text parser plugin, the 'type' value is
     'MYSQL_FTPARSER_PLUGIN'.

   * 'info': A pointer to the type-specific descriptor for the plugin.
     This descriptor's structure depends on the particular type of
     plugin, unlike that of the general plugin descriptor structure.
     For version-control purposes, the first member of the type-specific
     descriptor for every plugin type is expected to be the interface
     version for the type.  This enables the server to check the
     type-specific version for every plugin no matter its type.
     Following the version number, the descriptor includes any other
     members needed, such as callback functions and other information
     needed by the server to invoke the plugin properly.  Later sections
     on writing particular types of server plugins describe the
     structure of their type-specific descriptors.

   * 'name': A string that gives the plugin name.  This is the name that
     will be listed in the 'mysql.plugin' table and by which you refer
     to the plugin in SQL statements such as *note 'INSTALL PLUGIN':
     install-plugin. and *note 'UNINSTALL PLUGIN': uninstall-plugin, or
     with the '--plugin-load' option.  The name is also visible in the
     *note 'INFORMATION_SCHEMA.PLUGINS': plugins-table. table or the
     output from *note 'SHOW PLUGINS': show-plugins.

     The plugin name should not begin with the name of any server
     option.  If it does, the server will fail to initialize it.  For
     example, the server has a '--socket' option, so you should not use
     a plugin name such as 'socket', 'socket_plugin', and so forth.

   * 'author': A string naming the plugin author.  This can be whatever
     you like.

   * 'desc': A string that provides a general description of the plugin.
     This can be whatever you like.

   * 'license': The plugin license type.  The value can be one of
     'PLUGIN_LICENSE_PROPRIETARY', 'PLUGIN_LICENSE_GPL', or
     'PLUGIN_LICENSE_BSD'.

   * 'init': A once-only initialization function, or 'NULL' if there is
     no such function.  The server executes this function when it loads
     the plugin, which happens for *note 'INSTALL PLUGIN':
     install-plugin. or, for plugins listed in the 'mysql.plugin' table,
     at server startup.  The function takes one argument that points to
     the internal structure used to identify the plugin.  It returns
     zero for success and nonzero for failure.

   * 'deinit': A once-only deinitialization function, or 'NULL' if there
     is no such function.  The server executes this function when it
     unloads the plugin, which happens for *note 'UNINSTALL PLUGIN':
     uninstall-plugin. or, for plugins listed in the 'mysql.plugin'
     table, at server shutdown.  The function takes one argument that
     points to the internal structure used to identify the plugin It
     returns zero for success and nonzero for failure.

   * 'version': The plugin version number.  When the plugin is
     installed, this value can be retrieved from the *note
     'INFORMATION_SCHEMA.PLUGINS': plugins-table. table.  The value
     includes major and minor numbers.  If you write the value as a hex
     constant, the format is '0xMMNN', where MM and 'NN' are the major
     and minor numbers, respectively.  For example, '0x0302' represents
     version 3.2.

   * 'status_vars': A pointer to a structure for status variables
     associated with the plugin, or 'NULL' if there are no such
     variables.  When the plugin is installed, these variables are
     displayed in the output of the *note 'SHOW STATUS': show-status.
     statement.

     The 'status_vars' member, if not 'NULL', points to an array of
     'st_mysql_show_var' structures that describe status variables.  See
     *note plugin-status-system-variables::.

   * 'system_vars': A pointer to a structure for system variables
     associated with the plugin, or 'NULL' if there are no such
     variables.  These options and system variables can be used to help
     initialize variables within the plugin.  When the plugin is
     installed, these variables are displayed in the output of the *note
     'SHOW VARIABLES': show-variables. statement.

     The 'system_vars' member, if not 'NULL', points to an array of
     'st_mysql_sys_var' structures that describe system variables.  See
     *note plugin-status-system-variables::.

   * '__reserved1': A placeholder for the future.  It should be set to
     'NULL'.

   * 'flags': Plugin flags.  Individual bits correspond to different
     flags.  The value should be set to the OR of the applicable flags.
     These flags are available:

          #define PLUGIN_OPT_NO_INSTALL   1UL   /* Not dynamically loadable */
          #define PLUGIN_OPT_NO_UNINSTALL 2UL   /* Not dynamically unloadable */

     The flags have the following meanings when enabled:

        * 'PLUGIN_OPT_NO_INSTALL': The plugin cannot be loaded at
          runtime with the *note 'INSTALL PLUGIN': install-plugin.
          statement.  This is appropriate for plugins that must be
          loaded at server startup with the '--plugin-load' option.

        * 'PLUGIN_OPT_NO_UNINSTALL': The plugin cannot be unloaded at
          runtime with the *note 'UNINSTALL PLUGIN': uninstall-plugin.
          statement.

     This member was added in MySQL 5.5.16.

The server invokes the 'init' and 'deinit' functions in the general
plugin descriptor only when loading and unloading the plugin.  They have
nothing to do with use of the plugin such as happens when an SQL
statement causes the plugin to be invoked.

For example, the descriptor information for a library that contains a
single full-text parser plugin named 'simple_parser' looks like this:

     mysql_declare_plugin(ftexample)
     {
       MYSQL_FTPARSER_PLUGIN,      /* type                            */
       &simple_parser_descriptor,  /* descriptor                      */
       "simple_parser",            /* name                            */
       "Oracle Corporation",       /* author                          */
       "Simple Full-Text Parser",  /* description                     */
       PLUGIN_LICENSE_GPL,         /* plugin license                  */
       simple_parser_plugin_init,  /* init function (when loaded)     */
       simple_parser_plugin_deinit,/* deinit function (when unloaded) */
       0x0001,                     /* version                         */
       simple_status,              /* status variables                */
       simple_system_variables,    /* system variables                */
       NULL,
       0
     }
     mysql_declare_plugin_end;

For a full-text parser plugin, the type must be 'MYSQL_FTPARSER_PLUGIN'.
This is the value that identifies the plugin as being legal for use in a
'WITH PARSER' clause when creating a 'FULLTEXT' index.  (No other plugin
type is legal for this clause.)

'plugin.h' defines the 'mysql_declare_plugin()' and
'mysql_declare_plugin_end' macros like this:

     #ifndef MYSQL_DYNAMIC_PLUGIN
     #define __MYSQL_DECLARE_PLUGIN(NAME, VERSION, PSIZE, DECLS) \
     MYSQL_PLUGIN_EXPORT int VERSION= MYSQL_PLUGIN_INTERFACE_VERSION; \
     MYSQL_PLUGIN_EXPORT int PSIZE= sizeof(struct st_mysql_plugin); \
     MYSQL_PLUGIN_EXPORT struct st_mysql_plugin DECLS[]= {
     #else
     #define __MYSQL_DECLARE_PLUGIN(NAME, VERSION, PSIZE, DECLS) \
     MYSQL_PLUGIN_EXPORT int _mysql_plugin_interface_version_= MYSQL_PLUGIN_INTERFACE_VERSION; \
     MYSQL_PLUGIN_EXPORT int _mysql_sizeof_struct_st_plugin_= sizeof(struct st_mysql_plugin); \
     MYSQL_PLUGIN_EXPORT struct st_mysql_plugin _mysql_plugin_declarations_[]= {
     #endif

     #define mysql_declare_plugin(NAME) \
     __MYSQL_DECLARE_PLUGIN(NAME, \
                      builtin_ ## NAME ## _plugin_interface_version, \
                      builtin_ ## NAME ## _sizeof_struct_st_plugin, \
                      builtin_ ## NAME ## _plugin)

     #define mysql_declare_plugin_end ,{0,0,0,0,0,0,0,0,0,0,0,0,0}}

*Note*:

Those declarations define the '_mysql_plugin_interface_version_' symbol
only if the 'MYSQL_DYNAMIC_PLUGIN' symbol is defined.  This means that
'-DMYSQL_DYNAMIC_PLUGIN' must be provided as part of the compilation
command to build the plugin as a shared library.

When the macros are used as just shown, they expand to the following
code, which defines both of the required symbols
('_mysql_plugin_interface_version_' and '_mysql_plugin_declarations_'):

     int _mysql_plugin_interface_version_= MYSQL_PLUGIN_INTERFACE_VERSION;
     int _mysql_sizeof_struct_st_plugin_= sizeof(struct st_mysql_plugin);
     struct st_mysql_plugin _mysql_plugin_declarations_[]= {
     {
       MYSQL_FTPARSER_PLUGIN,      /* type                            */
       &simple_parser_descriptor,  /* descriptor                      */
       "simple_parser",            /* name                            */
       "Oracle Corporation",       /* author                          */
       "Simple Full-Text Parser",  /* description                     */
       PLUGIN_LICENSE_GPL,         /* plugin license                  */
       simple_parser_plugin_init,  /* init function (when loaded)     */
       simple_parser_plugin_deinit,/* deinit function (when unloaded) */
       0x0001,                     /* version                         */
       simple_status,              /* status variables                */
       simple_system_variables,    /* system variables                */
       NULL,
       0
     }
       ,{0,0,0,0,0,0,0,0,0,0,0,0}}
     };

The preceding example declares a single plugin in the general
descriptor, but it is possible to declare multiple plugins.  List the
declarations one after the other between 'mysql_declare_plugin()' and
'mysql_declare_plugin_end', separated by commas.

MySQL server plugins can be written in C or C++ (or another language
that can use C calling conventions).  If you write a C++ plugin, one C++
feature that you should not use is nonconstant variables to initialize
global structures.  Members of structures such as the 'st_mysql_plugin'
structure should be initialized only with constant variables.  The
'simple_parser' descriptor shown earlier is permissible in a C++ plugin
because it satisfies that requirement:

     mysql_declare_plugin(ftexample)
     {
       MYSQL_FTPARSER_PLUGIN,      /* type                            */
       &simple_parser_descriptor,  /* descriptor                      */
       "simple_parser",            /* name                            */
       "Oracle Corporation",       /* author                          */
       "Simple Full-Text Parser",  /* description                     */
       PLUGIN_LICENSE_GPL,         /* plugin license                  */
       simple_parser_plugin_init,  /* init function (when loaded)     */
       simple_parser_plugin_deinit,/* deinit function (when unloaded) */
       0x0001,                     /* version                         */
       simple_status,              /* status variables                */
       simple_system_variables,    /* system variables                */
       NULL,
       0
     }
     mysql_declare_plugin_end;

Here is another valid way to write the general descriptor.  It uses
constant variables to indicate the plugin name, author, and description:

     const char *simple_parser_name = "simple_parser";
     const char *simple_parser_author = "Oracle Corporation";
     const char *simple_parser_description = "Simple Full-Text Parser";

     mysql_declare_plugin(ftexample)
     {
       MYSQL_FTPARSER_PLUGIN,      /* type                            */
       &simple_parser_descriptor,  /* descriptor                      */
       simple_parser_name,         /* name                            */
       simple_parser_author,       /* author                          */
       simple_parser_description,  /* description                     */
       PLUGIN_LICENSE_GPL,         /* plugin license                  */
       simple_parser_plugin_init,  /* init function (when loaded)     */
       simple_parser_plugin_deinit,/* deinit function (when unloaded) */
       0x0001,                     /* version                         */
       simple_status,              /* status variables                */
       simple_system_variables,    /* system variables                */
       NULL,
       0
     }
     mysql_declare_plugin_end;

However, the following general descriptor is invalid.  It uses structure
members to indicate the plugin name, author, and description, but
structures are not considered constant initializers in C++:

     typedef struct
     {
       const char *name;
       const char *author;
       const char *description;
     } plugin_info;

     plugin_info parser_info = {
       "simple_parser",
       "Oracle Corporation",
       "Simple Full-Text Parser"
     };

     mysql_declare_plugin(ftexample)
     {
       MYSQL_FTPARSER_PLUGIN,      /* type                            */
       &simple_parser_descriptor,  /* descriptor                      */
       parser_info.name,           /* name                            */
       parser_info.author,         /* author                          */
       parser_info.description,    /* description                     */
       PLUGIN_LICENSE_GPL,         /* plugin license                  */
       simple_parser_plugin_init,  /* init function (when loaded)     */
       simple_parser_plugin_deinit,/* deinit function (when unloaded) */
       0x0001,                     /* version                         */
       simple_status,              /* status variables                */
       simple_system_variables,    /* system variables                */
       NULL,
       0
     }
     mysql_declare_plugin_end;


File: manual.info.tmp,  Node: plugin-status-system-variables,  Next: client-plugin-descriptors,  Prev: server-plugin-descriptors,  Up: plugin-data-structures

24.2.4.4 Server Plugin Status and System Variables
..................................................

The server plugin interface enables plugins to expose status and system
variables using the 'status_vars' and 'system_vars' members of the
general plugin descriptor.

The 'status_vars' member of the general plugin descriptor, if not 0,
points to an array of 'st_mysql_show_var' structures, each of which
describes one status variable, followed by a structure with all members
set to 0.  The 'st_mysql_show_var' structure has this definition:

     struct st_mysql_show_var {
       const char *name;
       char *value;
       enum enum_mysql_show_type type;
     };

The following table shows the permissible status variable 'type' values
and what the corresponding variable should be.

*Server Plugin Status Variable Types*

Variable Type          Meaning
                       
'SHOW_BOOL'            Pointer to a boolean variable
                       
'SHOW_INT'             Pointer to an integer variable
                       
'SHOW_LONG'            Pointer to a long integer variable
                       
'SHOW_LONGLONG'        Pointer to a longlong integer variable
                       
'SHOW_CHAR'            A string
                       
'SHOW_CHAR_PTR'        Pointer to a string
                       
'SHOW_ARRAY'           Pointer to another 'st_mysql_show_var' array
                       
'SHOW_FUNC'            Pointer to a function
                       
'SHOW_DOUBLE'          Pointer to a double

For the 'SHOW_FUNC' type, the function is called and fills in its 'out'
parameter, which then provides information about the variable to be
displayed.  The function has this signature:

     #define SHOW_VAR_FUNC_BUFF_SIZE 1024

     typedef int (*mysql_show_var_func) (void *thd,
                                         struct st_mysql_show_var *out,
                                         char *buf);

The 'system_vars' member, if not 0, points to an array of
'st_mysql_sys_var' structures, each of which describes one system
variable (which can also be set from the command-line or configuration
file), followed by a structure with all members set to 0.  The
'st_mysql_sys_var' structure is defined as follows:

     struct st_mysql_sys_var {
      int flags;
      const char *name, *comment;
      int (*check)(THD*, struct st_mysql_sys_var *, void*, st_mysql_value*);
      void (*update)(THD*, struct st_mysql_sys_var *, void*, const void*);
     };

Additional fields are append as required depending upon the flags.

For convenience, a number of macros are defined that make creating new
system variables within a plugin much simpler.

Throughout the macros, the following fields are available:

   * 'name': An unquoted identifier for the system variable.

   * 'varname': The identifier for the static variable.  Where not
     available, it is the same as the 'name' field.

   * 'opt': Additional use flags for the system variable.  The following
     table shows the permissible flags.

     *Server Plugin System Variable Flags*

     Flag Value         Description
                        
     'PLUGIN_VAR_READONLY'The system variable is read only
                        
     'PLUGIN_VAR_NOSYSVAR'The system variable is not user visible at runtime
                        
     'PLUGIN_VAR_NOCMDOPT'The system variable is not configurable from the
                        command line
                        
     'PLUGIN_VAR_NOCMDARG'No argument is required at the command line
                        (typically used for boolean variables)
                        
     'PLUGIN_VAR_RQCMDARG'An argument is required at the command line (this is
                        the default)
                        
     '                  An argument is optional at the command line
     PLUGIN_VAR_OPCMDARG'

     'PLUGIN_VAR_MEMALLOC'Used for string variables; indicates that memory is
                        to be allocated for storage of the string

   * 'comment': A descriptive comment to be displayed in the server help
     message.  'NULL' if this variable is to be hidden.

   * 'check': The check function, 'NULL' for default.

   * 'update': The update function, 'NULL' for default.

   * 'default': The variable default value.

   * 'minimum': The variable minimum value.

   * 'maximum': The variable maximum value.

   * 'blocksize': The variable block size.  When the value is set, it is
     rounded to the nearest multiple of 'blocksize'.

A system variable may be accessed either by using the static variable
directly or by using the 'SYSVAR()'accessor macro.  The 'SYSVAR()' macro
is provided for completeness.  Usually it should be used only when the
code cannot directly access the underlying variable.

For example:

     static int my_foo;
     static MYSQL_SYSVAR_INT(foo_var, my_foo,
                             PLUGIN_VAR_RQCMDARG, "foo comment",
                             NULL, NULL, 0, 0, INT_MAX, 0);
      ...
        SYSVAR(foo_var)= value;
        value= SYSVAR(foo_var);
        my_foo= value;
        value= my_foo;

Session variables may be accessed only through the 'THDVAR()' accessor
macro.  For example:

     static MYSQL_THDVAR_BOOL(some_flag,
                              PLUGIN_VAR_NOCMDARG, "flag comment",
                              NULL, NULL, FALSE);
      ...
        if (THDVAR(thd, some_flag))
        {
          do_something();
          THDVAR(thd, some_flag)= FALSE;
        }

All global and session system variables must be published to *note
'mysqld': mysqld. before use.  This is done by constructing a
'NULL'-terminated array of the variables and linking to it in the plugin
public interface.  For example:

     static struct st_mysql_sys_var *my_plugin_vars[]= {
       MYSQL_SYSVAR(foo_var),
       MYSQL_SYSVAR(some_flag),
       NULL
     };
     mysql_declare_plugin(fooplug)
     {
       MYSQL_..._PLUGIN,
       &plugin_data,
       "fooplug",
       "foo author",
       "This does foo!",
       PLUGIN_LICENSE_GPL,
       foo_init,
       foo_fini,
       0x0001,
       NULL,
       my_plugin_vars,
       NULL,
       0
     }
     mysql_declare_plugin_end;

The following convenience macros enable you to declare different types
of system variables:

   * Boolean system variables of type 'my_bool', which is a 1-byte
     boolean.  (0 = FALSE, 1 = TRUE)

          MYSQL_THDVAR_BOOL(name, opt, comment, check, update, default)
          MYSQL_SYSVAR_BOOL(name, varname, opt, comment, check, update, default)

   * String system variables of type 'char*', which is a pointer to a
     null-terminated string.

          MYSQL_THDVAR_STR(name, opt, comment, check, update, default)
          MYSQL_SYSVAR_STR(name, varname, opt, comment, check, update, default)

   * Integer system variables, of which there are several varieties.

        * An 'int' system variable, which is typically a 4-byte signed
          word.

               MYSQL_THDVAR_INT(name, opt, comment, check, update, default, min, max, blk)
               MYSQL_SYSVAR_INT(name, varname, opt, comment, check, update, default,
                              minimum, maximum, blocksize)

        * An 'unsigned int' system variable, which is typically a 4-byte
          unsigned word.

               MYSQL_THDVAR_UINT(name, opt, comment, check, update, default, min, max, blk)
               MYSQL_SYSVAR_UINT(name, varname, opt, comment, check, update, default,
                               minimum, maximum, blocksize)

        * A 'long' system variable, which is typically either a 4- or
          8-byte signed word.

               MYSQL_THDVAR_LONG(name, opt, comment, check, update, default, min, max, blk)
               MYSQL_SYSVAR_LONG(name, varname, opt, comment, check, update, default,
                               minimum, maximum, blocksize)

        * An 'unsigned long' system variable, which is typically either
          a 4- or 8-byte unsigned word.

               MYSQL_THDVAR_ULONG(name, opt, comment, check, update, default, min, max, blk)
               MYSQL_SYSVAR_ULONG(name, varname, opt, comment, check, update, default,
                                minimum, maximum, blocksize)

        * A 'long long' system variable, which is typically an 8-byte
          signed word.

               MYSQL_THDVAR_LONGLONG(name, opt, comment, check, update,
                                   default, minimum, maximum, blocksize)
               MYSQL_SYSVAR_LONGLONG(name, varname, opt, comment, check, update,
                                   default, minimum, maximum, blocksize)

        * An 'unsigned long long' system variable, which is typically an
          8-byte unsigned word.

               MYSQL_THDVAR_ULONGLONG(name, opt, comment, check, update,
                                    default, minimum, maximum, blocksize)
               MYSQL_SYSVAR_ULONGLONG(name, varname, opt, comment, check, update,
                                    default, minimum, maximum, blocksize)

        * An 'unsigned long' system variable, which is typically either
          a 4- or 8-byte unsigned word.  The range of possible values is
          an ordinal of the number of elements in the 'typelib',
          starting from 0.

               MYSQL_THDVAR_ENUM(name, opt, comment, check, update, default, typelib)
               MYSQL_SYSVAR_ENUM(name, varname, opt, comment, check, update,
                               default, typelib)

        * An 'unsigned long long' system variable, which is typically an
          8-byte unsigned word.  Each bit represents an element in the
          'typelib'.

               MYSQL_THDVAR_SET(name, opt, comment, check, update, default, typelib)
               MYSQL_SYSVAR_SET(name, varname, opt, comment, check, update,
                              default, typelib)

Internally, all mutable and plugin system variables are stored in a
'HASH' structure.

Display of the server command-line help text is handled by compiling a
'DYNAMIC_ARRAY' of all variables relevant to command-line options,
sorting them, and then iterating through them to display each option.

When a command-line option has been handled, it is then removed from the
'argv' by the 'handle_option()' function ('my_getopt.c'); in effect, it
is consumed.

The server processes command-line options during the plugin installation
process, immediately after the plugin has been successfully loaded but
before the plugin initialization function has been called

Plugins loaded at runtime do not benefit from any configuration options
and must have usable defaults.  Once they are installed, they are loaded
at *note 'mysqld': mysqld. initialization time and configuration options
can be set at the command line or within 'my.cnf'.

Plugins should consider the 'thd' parameter to be read only.


File: manual.info.tmp,  Node: client-plugin-descriptors,  Prev: plugin-status-system-variables,  Up: plugin-data-structures

24.2.4.5 Client Plugin Descriptors
..................................

Each client plugin must have a descriptor that provides information to
the client plugin API. The descriptor structure begins with a fixed set
of members common to all client plugins, followed by any members
specific to the plugin type.

The 'st_mysql_client_plugin' structure in the 'client_plugin.h' file
defines a 'generic' descriptor that contains the common members:

     struct st_mysql_client_plugin
     {
       int type;
       unsigned int interface_version;
       const char *name;
       const char *author;
       const char *desc;
       unsigned int version[3];
       const char *license;
       void *mysql_api;
       int (*init)(char *, size_t, int, va_list);
       int (*deinit)();
       int (*options)(const char *option, const void *);
     };

The common 'st_mysql_client_plugin' descriptor structure members are
used as follows.  'char *' members should be specified as
null-terminated strings.

   * 'type': The plugin type.  This must be one of the plugin-type
     values from 'client_plugin.h', such as
     'MYSQL_CLIENT_AUTHENTICATION_PLUGIN'.

   * 'interface_version': The plugin interface version.  For example,
     this is 'MYSQL_CLIENT_AUTHENTICATION_PLUGIN_INTERFACE_VERSION' for
     an authentication plugin.

   * 'name': A string that gives the plugin name.  This is the name by
     which you refer to the plugin when you call *note
     'mysql_options()': mysql-options. with the 'MYSQL_DEFAULT_AUTH'
     option or specify the '--default-auth' option to a MySQL client
     program.

   * 'author': A string naming the plugin author.  This can be whatever
     you like.

   * 'desc': A string that provides a general description of the plugin.
     This can be whatever you like.

   * 'version': The plugin version as an array of three integers
     indicating the major, minor, and teeny versions.  For example,
     '{1,2,3}' indicates version 1.2.3.

   * 'license': A string that specifies the license type.

   * 'mysql_api': For internal use.  Specify it as 'NULL' in the plugin
     descriptor.

   * 'init': A once-only initialization function, or 'NULL' if there is
     no such function.  The client library executes this function when
     it loads the plugin.  The function returns zero for success and
     nonzero for failure.

     The 'init' function uses its first two arguments to return an error
     message if an error occurs.  The first argument is a pointer to a
     'char' buffer, and the second argument indicates the buffer length.
     Any message returned by the 'init' function must be
     null-terminated, so the maximum message length is the buffer length
     minus one.  The next arguments are passed to *note
     'mysql_load_plugin()': mysql-load-plugin.  The first indicates how
     many more arguments there are (0 if none), followed by any
     remaining arguments.

   * 'deinit': A once-only deinitialization function, or 'NULL' if there
     is no such function.  The client library executes this function
     when it unloads the plugin.  The function takes no arguments.  It
     returns zero for success and nonzero for failure.

   * 'options': A function for handling options passed to the plugin, or
     'NULL' if there is no such function.  The function takes two
     arguments representing the option name and a pointer to its value.
     The function returns zero for success and nonzero for failure.

For a given client plugin type, the common descriptor members may be
followed by additional members necessary to implement plugins of that
type.  For example, the 'st_mysql_client_plugin_AUTHENTICATION'
structure for authentication plugins has a function at the end that the
client library calls to perform authentication.

To declare a plugin, use the 'mysql_declare_client_plugin()' and
'mysql_end_client_plugin' macros:

     mysql_declare_client_plugin(PLUGIN_TYPE)
        ... MEMBERS COMMON TO ALL CLIENT PLUGINS ...
        ... TYPE-SPECIFIC EXTRA MEMBERS ...
     mysql_end_client_plugin;

Do not specify the 'type' or 'interface_version' member explicitly.  The
'mysql_declare_client_plugin()' macro uses the PLUGIN_TYPE argument to
generate their values automatically.  For example, declare an
authentication client plugin like this:

     mysql_declare_client_plugin(AUTHENTICATION)
       "my_auth_plugin",
       "Author Name",
       "My Client Authentication Plugin",
       {1,0,0},
       "GPL",
       NULL,
       my_auth_init,
       my_auth_deinit,
       my_auth_options,
       my_auth_main
     mysql_end_client_plugin;

This declaration uses the 'AUTHENTICATION' argument to set the 'type'
and 'interface_version' members to 'MYSQL_CLIENT_AUTHENTICATION_PLUGIN'
and 'MYSQL_CLIENT_AUTHENTICATION_PLUGIN_INTERFACE_VERSION'.

Depending on the plugin type, the descriptor may have other members
following the common members.  For example, for an authentication
plugin, there is a function ('my_auth_main()' in the descriptor just
shown) that handles communication with the server.  See *note
writing-authentication-plugins::.

Normally, a client program that supports the use of authentication
plugins causes a plugin to be loaded by calling *note 'mysql_options()':
mysql-options. to set the 'MYSQL_DEFAULT_AUTH' and 'MYSQL_PLUGIN_DIR'
options:

     char *plugin_dir = "PATH_TO_PLUGIN_DIR";
     char *default_auth = "PLUGIN_NAME";

     /* ... process command-line options ... */

     mysql_options(&mysql, MYSQL_PLUGIN_DIR, plugin_dir);
     mysql_options(&mysql, MYSQL_DEFAULT_AUTH, default_auth);

Typically, the program will also accept '--plugin-dir' and
'--default-auth' options that enable users to override the default
values.

Should a client program require lower-level plugin management, the
client library contains functions that take an 'st_mysql_client_plugin'
argument.  See *note c-api-plugin-functions::.


File: manual.info.tmp,  Node: compiling-plugin-libraries,  Next: writing-full-text-plugins,  Prev: plugin-data-structures,  Up: writing-plugins

24.2.4.6 Compiling and Installing Plugin Libraries
..................................................

After your plugin is written, you must compile it and install it.  The
procedure for compiling shared objects varies from system to system.  If
you build your library using 'CMake', it should be able to generate the
correct compilation commands for your system.  If the library is named
'somepluglib', you should end up with a shared library file that has a
name something like 'somepluglib.so'.  (The '.so' file name suffix might
differ on your system.)

To use 'CMake', you'll need to set up the configuration files to enable
the plugin to be compiled and installed.  Use the plugin examples under
the 'plugin' directory of a MySQL source distribution as a guide.

Create 'CMakeLists.txt', which should look something like this:

     MYSQL_ADD_PLUGIN(somepluglib somepluglib.c
       MODULE_ONLY MODULE_OUTPUT_NAME "somepluglib")

When 'CMake' generates the 'Makefile', it should take care of passing to
the compilation command the '-DMYSQL_DYNAMIC_PLUGIN' flag, and passing
to the linker the '-lmysqlservices' flag, which is needed to link in any
functions from services provided through the plugin services interface.
See *note plugin-services::.

Run 'CMake', then run 'make':

     shell> cmake .
     shell> make

If you need to specify configuration options to 'CMake', see *note
source-configuration-options::, for a list.  For example, you might want
to specify 'CMAKE_INSTALL_PREFIX' to indicate the MySQL base directory
under which the plugin should be installed.  You can see what value to
use for this option with *note 'SHOW VARIABLES': show-variables.:

     mysql> SHOW VARIABLES LIKE 'basedir';
     +---------------+------------------+
     | Variable_name | Value            |
     +---------------+------------------+
     | base          | /usr/local/mysql |
     +---------------+------------------+

The location of the plugin directory where you should install the
library is given by the 'plugin_dir' system variable.  For example:

     mysql> SHOW VARIABLES LIKE 'plugin_dir';
     +---------------+-----------------------------------+
     | Variable_name | Value                             |
     +---------------+-----------------------------------+
     | plugin_dir    | /usr/local/mysql/lib/mysql/plugin |
     +---------------+-----------------------------------+

To install the plugin library, use 'make':

     shell> make install

Verify that 'make install' installed the plugin library in the proper
directory.  After installing it, make sure that the library permissions
permit it to be executed by the server.


File: manual.info.tmp,  Node: writing-full-text-plugins,  Next: writing-daemon-plugins,  Prev: compiling-plugin-libraries,  Up: writing-plugins

24.2.4.7 Writing Full-Text Parser Plugins
.........................................

MySQL supports server-side full-text parser plugins only with *note
'MyISAM': myisam-storage-engine.  For introductory information about
full-text parser plugins, see *note full-text-plugin-type::.

A full-text parser plugin can be used to replace or modify the built-in
full-text parser.  This section describes how to write a full-text
parser plugin named 'simple_parser'.  This plugin performs parsing based
on simpler rules than those used by the MySQL built-in full-text parser:
Words are nonempty runs of whitespace characters.

The instructions use the source code in the 'plugin/fulltext' directory
of MySQL source distributions, so change location into that directory.
The following procedure describes how the plugin library is created:

  1. To write a full-text parser plugin, include the following header
     file in the plugin source file.  Other MySQL or general header
     files might also be needed, depending on the plugin capabilities
     and requirements.

          #include <mysql/plugin.h>

     'plugin.h' defines the 'MYSQL_FTPARSER_PLUGIN' server plugin type
     and the data structures needed to declare the plugin.

  2. Set up the library descriptor for the plugin library file.

     This descriptor contains the general plugin descriptor for the
     server plugin.  For a full-text parser plugin, the type must be
     'MYSQL_FTPARSER_PLUGIN'.  This is the value that identifies the
     plugin as being legal for use in a 'WITH PARSER' clause when
     creating a 'FULLTEXT' index.  (No other plugin type is legal for
     this clause.)

     For example, the library descriptor for a library that contains a
     single full-text parser plugin named 'simple_parser' looks like
     this:

          mysql_declare_plugin(ftexample)
          {
            MYSQL_FTPARSER_PLUGIN,      /* type                            */
            &simple_parser_descriptor,  /* descriptor                      */
            "simple_parser",            /* name                            */
            "Oracle Corporation",       /* author                          */
            "Simple Full-Text Parser",  /* description                     */
            PLUGIN_LICENSE_GPL,         /* plugin license                  */
            simple_parser_plugin_init,  /* init function (when loaded)     */
            simple_parser_plugin_deinit,/* deinit function (when unloaded) */
            0x0001,                     /* version                         */
            simple_status,              /* status variables                */
            simple_system_variables,    /* system variables                */
            NULL,
            0
          }
          mysql_declare_plugin_end;

     The 'name' member ('simple_parser') indicates the name to use for
     references to the plugin in statements such as *note 'INSTALL
     PLUGIN': install-plugin. or *note 'UNINSTALL PLUGIN':
     uninstall-plugin.  This is also the name displayed by *note 'SHOW
     PLUGINS': show-plugins. or *note 'INFORMATION_SCHEMA.PLUGINS':
     plugins-table.

     For more information, see *note server-plugin-descriptors::.

  3. Set up the type-specific plugin descriptor.

     Each general plugin descriptor in the library descriptor points to
     a type-specific descriptor.  For a full-text parser plugin, the
     type-specific descriptor is an instance of the 'st_mysql_ftparser'
     structure in the 'plugin.h' file:

          struct st_mysql_ftparser
          {
            int interface_version;
            int (*parse)(MYSQL_FTPARSER_PARAM *param);
            int (*init)(MYSQL_FTPARSER_PARAM *param);
            int (*deinit)(MYSQL_FTPARSER_PARAM *param);
          };

     As shown by the structure definition, the descriptor has an
     interface version number and contains pointers to three functions.

     The interface version number is specified using a symbol, which is
     in the form: 'MYSQL_XXX_INTERFACE_VERSION'.  For full-text parser
     plugins, the symbol is 'MYSQL_FTPARSER_INTERFACE_VERSION'.  In the
     source code, you will find the actual interface version number for
     the full-text parser plugin defined in
     'include/mysql/plugin_ftparser.h'.

     The 'init' and 'deinit' members should point to a function or be
     set to 0 if the function is not needed.  The 'parse' member must
     point to the function that performs the parsing.

     In the 'simple_parser' declaration, that descriptor is indicated by
     '&simple_parser_descriptor'.  The descriptor specifies the version
     number for the full-text plugin interface (as given by
     'MYSQL_FTPARSER_INTERFACE_VERSION'), and the plugin's parsing,
     initialization, and deinitialization functions:

          static struct st_mysql_ftparser simple_parser_descriptor=
          {
            MYSQL_FTPARSER_INTERFACE_VERSION, /* interface version      */
            simple_parser_parse,              /* parsing function       */
            simple_parser_init,               /* parser init function   */
            simple_parser_deinit              /* parser deinit function */
          };

     A full-text parser plugin is used in two different contexts,
     indexing and searching.  In both contexts, the server calls the
     initialization and deinitialization functions at the beginning and
     end of processing each SQL statement that causes the plugin to be
     invoked.  However, during statement processing, the server calls
     the main parsing function in context-specific fashion:

        * For indexing, the server calls the parser for each column
          value to be indexed.

        * For searching, the server calls the parser to parse the search
          string.  The parser might also be called for rows processed by
          the statement.  In natural language mode, there is no need for
          the server to call the parser.  For boolean mode phrase
          searches or natural language searches with query expansion,
          the parser is used to parse column values for information that
          is not in the index.  Also, if a boolean mode search is done
          for a column that has no 'FULLTEXT' index, the built-in parser
          will be called.  (Plugins are associated with specific
          indexes.  If there is no index, no plugin is used.)

     The plugin declaration in the general plugin descriptor has 'init'
     and 'deinit' members that point initialization and deinitialization
     functions, and so does the type-specific plugin descriptor to which
     it points.  However, these pairs of functions have different
     purposes and are invoked for different reasons:

        * For the plugin declaration in the general plugin descriptor,
          the initialization and deinitialization functions are invoked
          when the plugin is loaded and unloaded.

        * For the type-specific plugin descriptor, the initialization
          and deinitialization functions are invoked per SQL statement
          for which the plugin is used.

     Each interface function named in the plugin descriptor should
     return zero for success or nonzero for failure, and each of them
     receives an argument that points to a 'MYSQL_FTPARSER_PARAM'
     structure containing the parsing context.  The structure has this
     definition:

          typedef struct st_mysql_ftparser_param
          {
            int (*mysql_parse)(struct st_mysql_ftparser_param *,
                               char *doc, int doc_len);
            int (*mysql_add_word)(struct st_mysql_ftparser_param *,
                                  char *word, int word_len,
                                  MYSQL_FTPARSER_BOOLEAN_INFO *boolean_info);
            void *ftparser_state;
            void *mysql_ftparam;
            struct charset_info_st *cs;
            char *doc;
            int length;
            int flags;
            enum enum_ftparser_mode mode;
          } MYSQL_FTPARSER_PARAM;

     The structure members are used as follows:

        * 'mysql_parse': A pointer to a callback function that invokes
          the server's built-in parser.  Use this callback when the
          plugin acts as a front end to the built-in parser.  That is,
          when the plugin parsing function is called, it should process
          the input to extract the text and pass the text to the
          'mysql_parse' callback.

          The first parameter for this callback function should be the
          'param' value itself:

               param->mysql_parse(param, ...);

          A front end plugin can extract text and pass it all at once to
          the built-in parser, or it can extract and pass text to the
          built-in parser a piece at a time.  However, in this case, the
          built-in parser treats the pieces of text as though there are
          implicit word breaks between them.

        * 'mysql_add_word': A pointer to a callback function that adds a
          word to a full-text index or to the list of search terms.  Use
          this callback when the parser plugin replaces the built-in
          parser.  That is, when the plugin parsing function is called,
          it should parse the input into words and invoke the
          'mysql_add_word' callback for each word.

          The first parameter for this callback function should be the
          'param' value itself:

               param->mysql_add_word(param, ...);

        * 'ftparser_state': This is a generic pointer.  The plugin can
          set it to point to information to be used internally for its
          own purposes.

        * 'mysql_ftparam': This is set by the server.  It is passed as
          the first argument to the 'mysql_parse' or 'mysql_add_word'
          callback.

        * 'cs': A pointer to information about the character set of the
          text, or 0 if no information is available.

        * 'doc': A pointer to the text to be parsed.

        * 'length': The length of the text to be parsed, in bytes.

        * 'flags': Parser flags.  This is zero if there are no special
          flags.  The only nonzero flag is 'MYSQL_FTFLAGS_NEED_COPY',
          which means that 'mysql_add_word()' must save a copy of the
          word (that is, it cannot use a pointer to the word because the
          word is in a buffer that will be overwritten.)

          This flag might be set or reset by MySQL before calling the
          parser plugin, by the parser plugin itself, or by the
          'mysql_parse()' function.

        * 'mode': The parsing mode.  This value will be one of the
          following constants:

             * 'MYSQL_FTPARSER_SIMPLE_MODE': Parse in fast and simple
               mode, which is used for indexing and for natural language
               queries.  The parser should pass to the server only those
               words that should be indexed.  If the parser uses length
               limits or a stopword list to determine which words to
               ignore, it should not pass such words to the server.

             * 'MYSQL_FTPARSER_WITH_STOPWORDS': Parse in stopword mode.
               This is used in boolean searches for phrase matching.
               The parser should pass all words to the server, even
               stopwords or words that are outside any normal length
               limits.

             * 'MYSQL_FTPARSER_FULL_BOOLEAN_INFO': Parse in boolean
               mode.  This is used for parsing boolean query strings.
               The parser should recognize not only words but also
               boolean-mode operators and pass them to the server as
               tokens using the 'mysql_add_word' callback.  To tell the
               server what kind of token is being passed, the plugin
               needs to fill in a 'MYSQL_FTPARSER_BOOLEAN_INFO'
               structure and pass a pointer to it.

     If the parser is called in boolean mode, the 'param->mode' value
     will be 'MYSQL_FTPARSER_FULL_BOOLEAN_INFO'.  The
     'MYSQL_FTPARSER_BOOLEAN_INFO' structure that the parser uses for
     passing token information to the server looks like this:

          typedef struct st_mysql_ftparser_boolean_info
          {
            enum enum_ft_token_type type;
            int yesno;
            int weight_adjust;
            char wasign;
            char trunc;
            /* These are parser state and must be removed. */
            char prev;
            char *quot;
          } MYSQL_FTPARSER_BOOLEAN_INFO;

     The parser should fill in the structure members as follows:

        * 'type': The token type.  The following table shows the
          permissible types.

          *Full-Text Parser Token Types*

          Token Value                   Meaning
                                        
          'FT_TOKEN_EOF'                End of data
                                        
          'FT_TOKEN_WORD'               A regular word
                                        
          'FT_TOKEN_LEFT_PAREN'         The beginning of a group or subexpression
                                        
          'FT_TOKEN_RIGHT_PAREN'        The end of a group or subexpression
                                        
          'FT_TOKEN_STOPWORD'           A stopword

        * 'yesno': Whether the word must be present for a match to
          occur.  0 means that the word is optional but increases the
          match relevance if it is present.  Values larger than 0 mean
          that the word must be present.  Values smaller than 0 mean
          that the word must not be present.

        * 'weight_adjust': A weighting factor that determines how much a
          match for the word counts.  It can be used to increase or
          decrease the word's importance in relevance calculations.  A
          value of zero indicates no weight adjustment.  Values greater
          than or less than zero mean higher or lower weight,
          respectively.  The examples at *note fulltext-boolean::, that
          use the '<' and '>' operators illustrate how weighting works.

        * 'wasign': The sign of the weighting factor.  A negative value
          acts like the '~' boolean-search operator, which causes the
          word's contribution to the relevance to be negative.

        * 'trunc': Whether matching should be done as if the
          boolean-mode '*' truncation operator had been given.

     Plugins should not use the 'prev' and 'quot' members of the
     'MYSQL_FTPARSER_BOOLEAN_INFO' structure.

     *Note*:

     The plugin parser framework does not support:

        * The '@distance' boolean operator.

        * A leading plus sign ('+') or minus sign ('-') boolean operator
          followed by a space and then a word (''+ apple'' or ''-
          apple'').  The leading plus or minus sign must be directly
          adjacent to the word, for example: ''+apple'' or ''-apple''.

     For information about boolean full-text search operators, see *note
     fulltext-boolean::.

  4. Set up the plugin interface functions.

     The general plugin descriptor in the library descriptor names the
     initialization and deinitialization functions that the server
     should invoke when it loads and unloads the plugin.  For
     'simple_parser', these functions do nothing but return zero to
     indicate that they succeeded:

          static int simple_parser_plugin_init(void *arg __attribute__((unused)))
          {
            return(0);
          }

          static int simple_parser_plugin_deinit(void *arg __attribute__((unused)))
          {
            return(0);
          }

     Because those functions do not actually do anything, you could omit
     them and specify 0 for each of them in the plugin declaration.

     The type-specific plugin descriptor for 'simple_parser' names the
     initialization, deinitialization, and parsing functions that the
     server invokes when the plugin is used.  For 'simple_parser', the
     initialization and deinitialization functions do nothing:

          static int simple_parser_init(MYSQL_FTPARSER_PARAM *param
                                        __attribute__((unused)))
          {
            return(0);
          }

          static int simple_parser_deinit(MYSQL_FTPARSER_PARAM *param
                                          __attribute__((unused)))
          {
            return(0);
          }

     Here too, because those functions do nothing, you could omit them
     and specify 0 for each of them in the plugin descriptor.

     The main parsing function, 'simple_parser_parse()', acts as a
     replacement for the built-in full-text parser, so it needs to split
     text into words and pass each word to the server.  The parsing
     function's first argument is a pointer to a structure that contains
     the parsing context.  This structure has a 'doc' member that points
     to the text to be parsed, and a 'length' member that indicates how
     long the text is.  The simple parsing done by the plugin considers
     nonempty runs of whitespace characters to be words, so it
     identifies words like this:

          static int simple_parser_parse(MYSQL_FTPARSER_PARAM *param)
          {
            char *end, *start, *docend= param->doc + param->length;

            for (end= start= param->doc;; end++)
            {
              if (end == docend)
              {
                if (end > start)
                  add_word(param, start, end - start);
                break;
              }
              else if (isspace(*end))
              {
                if (end > start)
                  add_word(param, start, end - start);
                start= end + 1;
              }
            }
            return(0);
          }

     As the parser finds each word, it invokes a function 'add_word()'
     to pass the word to the server.  'add_word()' is a helper function
     only; it is not part of the plugin interface.  The parser passes
     the parsing context pointer to 'add_word()', as well as a pointer
     to the word and a length value:

          static void add_word(MYSQL_FTPARSER_PARAM *param, char *word, size_t len)
          {
            MYSQL_FTPARSER_BOOLEAN_INFO bool_info=
              { FT_TOKEN_WORD, 0, 0, 0, 0, ' ', 0 };

            param->mysql_add_word(param, word, len, &bool_info);
          }

     For boolean-mode parsing, 'add_word()' fills in the members of the
     'bool_info' structure as described earlier in the discussion of the
     'st_mysql_ftparser_boolean_info' structure.

  5. Set up the status variables.  For the 'simple_parser' plugin, the
     following status variable array sets up one status variable with a
     value that is static text, and another with a value that is stored
     in a long integer variable:

          long number_of_calls= 0;

          struct st_mysql_show_var simple_status[]=
          {
            {"simple_parser_static", (char *)"just a static text", SHOW_CHAR},
            {"simple_parser_called", (char *)&number_of_calls,     SHOW_LONG},
            {0,0,0}
          };

     By using status variable names that begin with the plugin name, you
     can easily display the variables for a plugin with *note 'SHOW
     STATUS': show-status.:

          mysql> SHOW STATUS LIKE 'simple_parser%';
          +----------------------+--------------------+
          | Variable_name        | Value              |
          +----------------------+--------------------+
          | simple_parser_static | just a static text |
          | simple_parser_called | 0                  |
          +----------------------+--------------------+

  6. To compile and install a plugin library file, use the instructions
     in *note compiling-plugin-libraries::.  To make the library file
     available for use, install it in the plugin directory (the
     directory named by the 'plugin_dir' system variable).  For the
     'simple_parser' plugin, it is compiled and installed when you build
     MySQL from source.  It is also included in binary distributions.
     The build process produces a shared object library with a name of
     'mypluglib.so' (the '.so' suffix might differ depending on your
     platform).

  7. To use the plugin, register it with the server.  For example, to
     register the plugin at runtime, use this statement (adjust the
     '.so' suffix for your platform as necessary):

          INSTALL PLUGIN simple_parser SONAME 'mypluglib.so';

     For additional information about plugin loading, see *note
     plugin-loading::.

  8. To verify plugin installation, examine the *note
     'INFORMATION_SCHEMA.PLUGINS': plugins-table. table or use the *note
     'SHOW PLUGINS': show-plugins. statement.  See *note
     obtaining-plugin-information::.

  9. Test the plugin to verify that it works properly.

     Create a table that contains a string column and associate the
     parser plugin with a 'FULLTEXT' index on the column:

          mysql> CREATE TABLE t (c VARCHAR(255),
              ->   FULLTEXT (c) WITH PARSER simple_parser
              -> ) ENGINE=MyISAM;
          Query OK, 0 rows affected (0.01 sec)

     Insert some text into the table and try some searches.  These
     should verify that the parser plugin treats all nonwhitespace
     characters as word characters:

          mysql> INSERT INTO t VALUES
              ->   ('latin1_general_cs is a case-sensitive collation'),
              ->   ('I\'d like a case of oranges'),
              ->   ('this is sensitive information'),
              ->   ('another row'),
              ->   ('yet another row');
          Query OK, 5 rows affected (0.02 sec)
          Records: 5  Duplicates: 0  Warnings: 0

          mysql> SELECT c FROM t;
          +-------------------------------------------------+
          | c                                               |
          +-------------------------------------------------+
          | latin1_general_cs is a case-sensitive collation |
          | I'd like a case of oranges                      |
          | this is sensitive information                   |
          | another row                                     |
          | yet another row                                 |
          +-------------------------------------------------+
          5 rows in set (0.00 sec)

          mysql> SELECT MATCH(c) AGAINST('case') FROM t;
          +--------------------------+
          | MATCH(c) AGAINST('case') |
          +--------------------------+
          |                        0 |
          |          1.2968142032623 |
          |                        0 |
          |                        0 |
          |                        0 |
          +--------------------------+
          5 rows in set (0.00 sec)

          mysql> SELECT MATCH(c) AGAINST('sensitive') FROM t;
          +-------------------------------+
          | MATCH(c) AGAINST('sensitive') |
          +-------------------------------+
          |                             0 |
          |                             0 |
          |               1.3253291845322 |
          |                             0 |
          |                             0 |
          +-------------------------------+
          5 rows in set (0.01 sec)

          mysql> SELECT MATCH(c) AGAINST('case-sensitive') FROM t;
          +------------------------------------+
          | MATCH(c) AGAINST('case-sensitive') |
          +------------------------------------+
          |                    1.3109166622162 |
          |                                  0 |
          |                                  0 |
          |                                  0 |
          |                                  0 |
          +------------------------------------+
          5 rows in set (0.01 sec)

          mysql> SELECT MATCH(c) AGAINST('I\'d') FROM t;
          +--------------------------+
          | MATCH(c) AGAINST('I\'d') |
          +--------------------------+
          |                        0 |
          |          1.2968142032623 |
          |                        0 |
          |                        0 |
          |                        0 |
          +--------------------------+
          5 rows in set (0.01 sec)

     Neither 'case' nor 'insensitive' match 'case-insensitive' the way
     that they would for the built-in parser.


File: manual.info.tmp,  Node: writing-daemon-plugins,  Next: writing-information-schema-plugins,  Prev: writing-full-text-plugins,  Up: writing-plugins

24.2.4.8 Writing Daemon Plugins
...............................

A daemon plugin is a simple type of plugin used for code that should be
run by the server but that does not communicate with it.  This section
describes how to write a daemon server plugin, using the example plugin
found in the 'plugin/daemon_example' directory of MySQL source
distributions.  That directory contains the 'daemon_example.cc' source
file for a daemon plugin named 'daemon_example' that writes a heartbeat
string at regular intervals to a file named 'mysql-heartbeat.log' in the
data directory.

To write a daemon plugin, include the following header file in the
plugin source file.  Other MySQL or general header files might also be
needed, depending on the plugin capabilities and requirements.

     #include <mysql/plugin.h>

'plugin.h' defines the 'MYSQL_DAEMON_PLUGIN' server plugin type and the
data structures needed to declare the plugin.

The 'daemon_example.cc' file sets up the library descriptor as follows.
The library descriptor includes a single general server plugin
descriptor.

     mysql_declare_plugin(daemon_example)
     {
       MYSQL_DAEMON_PLUGIN,
       &daemon_example_plugin,
       "daemon_example",
       "Brian Aker",
       "Daemon example, creates a heartbeat beat file in mysql-heartbeat.log",
       PLUGIN_LICENSE_GPL,
       daemon_example_plugin_init, /* Plugin Init */
       daemon_example_plugin_deinit, /* Plugin Deinit */
       0x0100 /* 1.0 */,
       NULL,                       /* status variables                */
       NULL,                       /* system variables                */
       NULL,                       /* config options                  */
       0,                          /* flags                           */
     }
     mysql_declare_plugin_end;

The 'name' member ('daemon_example') indicates the name to use for
references to the plugin in statements such as *note 'INSTALL PLUGIN':
install-plugin. or *note 'UNINSTALL PLUGIN': uninstall-plugin.  This is
also the name displayed by *note 'SHOW PLUGINS': show-plugins. or *note
'INFORMATION_SCHEMA.PLUGINS': plugins-table.

The second member of the plugin descriptor, 'daemon_example_plugin',
points to the type-specific daemon plugin descriptor.  This structure
consists only of the type-specific API version number:

     struct st_mysql_daemon daemon_example_plugin=
     { MYSQL_DAEMON_INTERFACE_VERSION  };

The type-specific structure has no interface functions.  There is no
communication between the server and the plugin, except that the server
calls the initialization and deinitialization functions from the general
plugin descriptor to start and stop the plugin:

   * 'daemon_example_plugin_init()' opens the heartbeat file and spawns
     a thread that wakes up periodically and writes the next message to
     the file.

   * 'daemon_example_plugin_deinit()' closes the file and performs other
     cleanup.

To compile and install a plugin library file, use the instructions in
*note compiling-plugin-libraries::.  To make the library file available
for use, install it in the plugin directory (the directory named by the
'plugin_dir' system variable).  For the 'daemon_example' plugin, it is
compiled and installed when you build MySQL from source.  It is also
included in binary distributions.  The build process produces a shared
object library with a name of 'libdaemon_example.so' (the '.so' suffix
might differ depending on your platform).

To use the plugin, register it with the server.  For example, to
register the plugin at runtime, use this statement (adjust the '.so'
suffix for your platform as necessary):

     INSTALL PLUGIN daemon_example SONAME 'libdaemon_example.so';

For additional information about plugin loading, see *note
plugin-loading::.

To verify plugin installation, examine the *note
'INFORMATION_SCHEMA.PLUGINS': plugins-table. table or use the *note
'SHOW PLUGINS': show-plugins. statement.  See *note
obtaining-plugin-information::.

While the plugin is loaded, it writes a heartbeat string at regular
intervals to a file named 'mysql-heartbeat.log' in the data directory.
This file grows without limit, so after you have satistifed yourself
that the plugin operates correctly, unload it:

     UNINSTALL PLUGIN daemon_example;


File: manual.info.tmp,  Node: writing-information-schema-plugins,  Next: writing-semisynchronous-replication-plugins,  Prev: writing-daemon-plugins,  Up: writing-plugins

24.2.4.9 Writing INFORMATION_SCHEMA Plugins
...........................................

This section describes how to write a server-side 'INFORMATION_SCHEMA'
table plugin.  For example code that implements such plugins, see the
'sql/sql_show.cc' file of a MySQL source distribution.  You can also
look at the example plugins found in the 'InnoDB' source.  See the
'handler/i_s.cc' and 'handler/ha_innodb.cc' files within the 'InnoDB'
source tree (in the 'storage/innobase' directory).

To write an 'INFORMATION_SCHEMA' table plugin, include the following
header files in the plugin source file.  Other MySQL or general header
files might also be needed, depending on the plugin capabilities and
requirements.

     #include <sql_class.h>
     #include <table.h>

These header files are located in the 'sql' directory of MySQL source
distributions.  They contain C++ structures, so the source file for an
'INFORMATION_SCHEMA' plugin must be compiled as C++ (not C) code.

The source file for the example plugin developed here is named
'simple_i_s_table.cc'.  It creates a simple 'INFORMATION_SCHEMA' table
named 'SIMPLE_I_S_TABLE' that has two columns named 'NAME' and 'VALUE'.
The general descriptor for a plugin library that implements the table
looks like this:

     mysql_declare_plugin(simple_i_s_library)
     {
       MYSQL_INFORMATION_SCHEMA_PLUGIN,
       &simple_table_info,                /* type-specific descriptor */
       "SIMPLE_I_S_TABLE",                /* table name */
       "Author Name",                     /* author */
       "Simple INFORMATION_SCHEMA table", /* description */
       PLUGIN_LICENSE_GPL,                /* license type */
       simple_table_init,                 /* init function */
       NULL,
       0x0100,                            /* version = 1.0 */
       NULL,                              /* no status variables */
       NULL,                              /* no system variables */
       NULL,                              /* no reserved information */
       0                                  /* no flags */
     }
     mysql_declare_plugin_end;

The 'name' member ('SIMPLE_I_S_TABLE') indicates the name to use for
references to the plugin in statements such as *note 'INSTALL PLUGIN':
install-plugin. or *note 'UNINSTALL PLUGIN': uninstall-plugin.  This is
also the name displayed by *note 'SHOW PLUGINS': show-plugins. or *note
'INFORMATION_SCHEMA.PLUGINS': plugins-table.

The 'simple_table_info' member of the general descriptor points to the
type-specific descriptor, which consists only of the type-specific API
version number:

     static struct st_mysql_information_schema simple_table_info =
     { MYSQL_INFORMATION_SCHEMA_INTERFACE_VERSION };

The general descriptor points to the initialization and deinitialization
functions:

   * The initialization function provides information about the table
     structure and a function that populates the table.

   * The deinitialization function performs any required cleanup.  If no
     cleanup is needed, this descriptor member can be 'NULL' (as in the
     example shown).

The initialization function should return 0 for success, 1 if an error
occurs.  The function receives a generic pointer, which it should
interpret as a pointer to the table structure:

     static int table_init(void *ptr)
     {
       ST_SCHEMA_TABLE *schema_table= (ST_SCHEMA_TABLE*)ptr;

       schema_table->fields_info= simple_table_fields;
       schema_table->fill_table= simple_fill_table;
       return 0;
     }

The function should set these two members of the table structure:

   * 'fields_info': An array of 'ST_FIELD_INFO' structures that contain
     information about each column.

   * 'fill_table': A function that populates the table.

The array pointed to by 'fields_info' should contain one element per
column of the 'INFORMATION_SCHEMA' plus a terminating element.  The
following 'simple_table_fields' array for the example plugin indicates
that 'SIMPLE_I_S_TABLE' has two columns.  'NAME' is string-valued with a
length of 10 and 'VALUE' is integer-valued with a display width of 20.
The last structure marks the end of the array.

     static ST_FIELD_INFO simple_table_fields[]=
     {
       {"NAME", 10, MYSQL_TYPE_STRING, 0, 0 0, 0},
       {"VALUE", 6, MYSQL_TYPE_LONG, 0, MY_I_S_UNSIGNED, 0, 0},
       {0, 0, MYSQL_TYPE_NULL, 0, 0, 0, 0}
     };

For more information about the column information structure, see the
definition of 'ST_FIELD_INFO' in the 'table.h' header file.  The
permissible 'MYSQL_TYPE_XXX' type values are those used in the C API;
see *note c-api-data-structures::.

The 'fill_table' member should be set to a function that populates the
table and returns 0 for success, 1 if an error occurs.  For the example
plugin, the 'simple_fill_table()' function looks like this:

     static int simple_fill_table(THD *thd, TABLE_LIST *tables, COND *cond)
     {
       TABLE *table= tables->table;

       table->field[0]->store("Name 1", 6, system_charset_info);
       table->field[1]->store(1);
       if (schema_table_store_record(thd, table))
         return 1;
       table->field[0]->store("Name 2", 6, system_charset_info);
       table->field[1]->store(2);
       if (schema_table_store_record(thd, table))
         return 1;
       return 0;
     }

For each row of the 'INFORMATION_SCHEMA' table, this function
initializes each column, then calls 'schema_table_store_record()' to
install the row.  The 'store()' method arguments depend on the type of
value to be stored.  For column 0 ('NAME', a string), 'store()' takes a
pointer to a string, its length, and information about the character set
of the string:

     store(const char *to, uint length, CHARSET_INFO *cs);

For column 1 ('VALUE', an integer), 'store()' takes the value and a flag
indicating whether it is unsigned:

     store(longlong nr, bool unsigned_value);

For other examples of how to populate 'INFORMATION_SCHEMA' tables,
search for instances of 'schema_table_store_record()' in 'sql_show.cc'.

To compile and install a plugin library file, use the instructions in
*note compiling-plugin-libraries::.  To make the library file available
for use, install it in the plugin directory (the directory named by the
'plugin_dir' system variable).

To test the plugin, install it:

     mysql> INSTALL PLUGIN SIMPLE_I_S_TABLE SONAME 'simple_i_s_table.so';

Verify that the table is present:

     mysql> SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
         -> WHERE TABLE_NAME = 'SIMPLE_I_S_TABLE';
     +------------------+
     | TABLE_NAME       |
     +------------------+
     | SIMPLE_I_S_TABLE |
     +------------------+

Try to select from it:

     mysql> SELECT * FROM INFORMATION_SCHEMA.SIMPLE_I_S_TABLE;
     +--------+-------+
     | NAME   | VALUE |
     +--------+-------+
     | Name 1 |     1 |
     | Name 2 |     2 |
     +--------+-------+

Uninstall it:

     mysql> UNINSTALL PLUGIN SIMPLE_I_S_TABLE;


File: manual.info.tmp,  Node: writing-semisynchronous-replication-plugins,  Next: writing-audit-plugins,  Prev: writing-information-schema-plugins,  Up: writing-plugins

24.2.4.10 Writing Semisynchronous Replication Plugins
.....................................................

This section describes how to write server-side semisynchronous
replication plugins, using the example plugins found in the
'plugin/semisync' directory of MySQL source distributions.  That
directory contains the source files for master and slave plugins named
'rpl_semi_sync_master' and 'rpl_semi_sync_slave'.  The information here
covers only how to set up the plugin framework.  For details about how
the plugins implement replication functions, see the source.

To write a semisynchronous replication plugin, include the following
header file in the plugin source file.  Other MySQL or general header
files might also be needed, depending on the plugin capabilities and
requirements.

     #include <mysql/plugin.h>

'plugin.h' defines the 'MYSQL_REPLICATION_PLUGIN' server plugin type and
the data structures needed to declare the plugin.

For the master side, 'semisync_master_plugin.cc' contains this general
descriptor for a plugin named 'rpl_semi_sync_master':

     mysql_declare_plugin(semi_sync_master)
     {
       MYSQL_REPLICATION_PLUGIN,
       &semi_sync_master_plugin,
       "rpl_semi_sync_master",
       "He Zhenxing",
       "Semi-synchronous replication master",
       PLUGIN_LICENSE_GPL,
       semi_sync_master_plugin_init, /* Plugin Init */
       semi_sync_master_plugin_deinit, /* Plugin Deinit */
       0x0100 /* 1.0 */,
       semi_sync_master_status_vars, /* status variables */
       semi_sync_master_system_vars, /* system variables */
       NULL,                         /* config options */
       0,                            /* flags */
     }
     mysql_declare_plugin_end;

For the slave side, 'semisync_slave_plugin.cc' contains this general
descriptor for a plugin named 'rpl_semi_sync_slave':

     mysql_declare_plugin(semi_sync_slave)
     {
       MYSQL_REPLICATION_PLUGIN,
       &semi_sync_slave_plugin,
       "rpl_semi_sync_slave",
       "He Zhenxing",
       "Semi-synchronous replication slave",
       PLUGIN_LICENSE_GPL,
       semi_sync_slave_plugin_init, /* Plugin Init */
       semi_sync_slave_plugin_deinit, /* Plugin Deinit */
       0x0100 /* 1.0 */,
       semi_sync_slave_status_vars,  /* status variables */
       semi_sync_slave_system_vars,  /* system variables */
       NULL,                         /* config options */
       0,                            /* flags */
     }
     mysql_declare_plugin_end;

For both the master and slave plugins, the general descriptor has
pointers to the type-specific descriptor, the initialization and
deinitialization functions, and to the status and system variables
implemented by the plugin.  For information about variable setup, see
*note plugin-status-system-variables::.  The following remarks discuss
the type-specific descriptor and the initialization and deinitialization
functions for the master plugin but apply similarly to the slave plugin.

The 'semi_sync_master_plugin' member of the master general descriptor
points to the type-specific descriptor, which consists only of the
type-specific API version number:

     struct Mysql_replication semi_sync_master_plugin= {
       MYSQL_REPLICATION_INTERFACE_VERSION
     };

The initialization and deinitialization function declarations look like
this:

     static int semi_sync_master_plugin_init(void *p);
     static int semi_sync_master_plugin_deinit(void *p);

The initialization function uses the pointer to register transaction and
binary logging 'observers' with the server.  After successful
initialization, the server takes care of invoking the observers at the
appropriate times.  (For details on the observers, see the source
files.)  The deinitialization function cleans up by deregistering the
observers.  Each function returns 0 for success or 1 if an error occurs.

To compile and install a plugin library file, use the instructions in
*note compiling-plugin-libraries::.  To make the library file available
for use, install it in the plugin directory (the directory named by the
'plugin_dir' system variable).  For the 'rpl_semi_sync_master' and
'rpl_semi_sync_slave' plugins, they are compiled and installed when you
build MySQL from source.  They are also included in binary
distributions.  The build process produces shared object libraries with
names of 'semisync_master.so' and 'semisync_slave.so' (the '.so' suffix
might differ depending on your platform).


File: manual.info.tmp,  Node: writing-audit-plugins,  Next: writing-authentication-plugins,  Prev: writing-semisynchronous-replication-plugins,  Up: writing-plugins

24.2.4.11 Writing Audit Plugins
...............................

This section describes how to write a server-side audit plugin, using
the example plugin found in the 'plugin/audit_null' directory of MySQL
source distributions.  The 'audit_null.c' source file in that directory
implements a simple example audit plugin named 'NULL_AUDIT'.

Within the server, the pluggable audit interface is implemented in the
'sql_audit.h' and 'sql_audit.cc' files in the 'sql' directory of MySQL
source distributions.  Additionally, several places in the server call
the audit interface when an auditable event occurs, so that registered
audit plugins can be notified about the event if necessary.  To see
where such calls occur, search the server source files for invocations
of functions with names of the form 'mysql_audit_XXX()'.  Audit
notification occurs for server operations such as these:

   * Client connect and disconnect events

   * Writing a message to the general query log (if the log is enabled)

   * Writing a message to the error log

   * Sending a query result to a client

To write an audit plugin, include the following header file in the
plugin source file.  Other MySQL or general header files might also be
needed, depending on the plugin capabilities and requirements.

     #include <mysql/plugin_audit.h>

'plugin_audit.h' includes 'plugin.h', so you need not include the latter
file explicitly.  'plugin.h' defines the 'MYSQL_AUDIT_PLUGIN' server
plugin type and the data structures needed to declare the plugin.
'plugin_audit.h' defines data structures specific to audit plugins.

An audit plugin, like any MySQL server plugin, has a general plugin
descriptor (see *note server-plugin-descriptors::) and a type-specific
plugin descriptor.  In 'audit_null.c', the general descriptor for
'audit_null' looks like this:

     mysql_declare_plugin(audit_null)
     {
       MYSQL_AUDIT_PLUGIN,         /* type                            */
       &audit_null_descriptor,     /* descriptor                      */
       "NULL_AUDIT",               /* name                            */
       "Oracle Corp",              /* author                          */
       "Simple NULL Audit",        /* description                     */
       PLUGIN_LICENSE_GPL,
       audit_null_plugin_init,     /* init function (when loaded)     */
       audit_null_plugin_deinit,   /* deinit function (when unloaded) */
       0x0002,                     /* version                         */
       simple_status,              /* status variables                */
       NULL,                       /* system variables                */
       NULL,
       0,
     }
     mysql_declare_plugin_end;

The first member, 'MYSQL_AUDIT_PLUGIN', identifies this plugin as an
audit plugin.

'audit_null_descriptor' points to the type-specific plugin descriptor,
described later.

The 'name' member ('NULL_AUDIT') indicates the name to use for
references to the plugin in statements such as *note 'INSTALL PLUGIN':
install-plugin. or *note 'UNINSTALL PLUGIN': uninstall-plugin.  This is
also the name displayed by *note 'INFORMATION_SCHEMA.PLUGINS':
plugins-table. or *note 'SHOW PLUGINS': show-plugins.

The general plugin descriptor also refers to 'simple_status', a
structure that exposes several status variables to the *note 'SHOW
STATUS': show-status. statement:

     static struct st_mysql_show_var simple_status[]=
     {
       { "Audit_null_called", (char *) &number_of_calls, SHOW_INT },
       { "Audit_null_general_log", (char *) &number_of_calls_general_log,
         SHOW_INT },
       { "Audit_null_general_error", (char *) &number_of_calls_general_error,
         SHOW_INT },
       { "Audit_null_general_result", (char *) &number_of_calls_general_result,
         SHOW_INT },
       { 0, 0, 0}
     };

The 'audit_null_plugin_init' initialization function sets the status
variables to zero when the plugin is loaded.  The
'audit_null_plugin_deinit' function performs cleanup when the plugin is
unloaded.  During operation, the plugin increments the first status
variable for each notification it receives.  It also increments the
others according to the event class and subclass.  In effect, the first
variable is the aggregate of the counts for the event subclasses.

The 'audit_null_descriptor' value in the general plugin descriptor
points to the type-specific plugin descriptor.  For audit plugins, this
descriptor has the following structure:

     struct st_mysql_audit
     {
       int interface_version;
       void (*release_thd)(MYSQL_THD);
       void (*event_notify)(MYSQL_THD, unsigned int, const void *);
       unsigned long class_mask[MYSQL_AUDIT_CLASS_MASK_SIZE];
     };

The type-specific plugin descriptor for audit plugins has these members:

   * 'interface_version': By convention, type-specific plugin
     descriptors begin with the interface version for the given plugin
     type.  The server checks 'interface_version' when it loads the
     plugin to see whether the plugin is compatible with it.  For audit
     plugins, the value of the 'interface_version' member is
     'MYSQL_AUDIT_INTERFACE_VERSION' (defined in 'plugin_audit.h').

   * 'release_thd': A function that the server calls to inform the
     plugin that it is being dissociated from its thread context.  This
     should be 'NULL' if there is no such function.

   * 'event_notify': A function that the server calls to notify the
     plugin that an auditable event has occurred.  This function should
     not be 'NULL'; that would not make sense because no auditing would
     occur.

   * 'class_mask': A bitmask that indicates the event classes for which
     the plugin wants to receive notification.  If this value is 0, the
     server passes no events to the plugin.

The server uses the 'event_notify' and 'release_thd' functions together.
They are called within the context of a specific thread, and a thread
might perform an activity that produces several event notifications.
The first time the server calls 'event_notify' for a thread, it creates
a binding of the plugin to the thread.  The plugin cannot be uninstalled
while this binding exists.  When no more events for the thread will
occur, the server informs the plugin of this by calling the
'release_thd' function, and then destroys the binding.  For example,
when a client issues a statement, the thread processing the statement
might notify audit plugins about the result set produced by the
statement and about the statement being logged.  After these
notifications occur, the server releases the plugin before putting the
thread to sleep until the client issues another statement.

This design enables the plugin to allocate resources needed for a given
thread in the first call to the 'event_notify' function and release them
in the 'release_thd' function:

     event_notify function:
       if memory is needed to service the thread
         allocate memory
       ... rest of notification processing ...

     release_thd function:
       if memory was allocated
         release memory
       ... rest of release processing ...

That is more efficient than allocating and releasing memory repeatedly
in the notification function.

For the 'NULL_AUDIT' audit plugin, the type-specific plugin descriptor
looks like this:

     static struct st_mysql_audit audit_null_descriptor=
     {
       MYSQL_AUDIT_INTERFACE_VERSION,                    /* interface version    */
       NULL,                                             /* release_thd function */
       audit_null_notify,                                /* notify function      */
       { (unsigned long) MYSQL_AUDIT_GENERAL_CLASSMASK } /* class mask           */
     };

The server calls 'audit_null_notify()' to pass audit event information
to the plugin.  The plugin has no 'release_thd' function.

The event class mask indicates an interest in all events of the
'general' class.  'plugin_audit.h' defines its symbol,
'MYSQL_AUDIT_GENERAL_CLASS', and a mask with a bit for this class:

     #define MYSQL_AUDIT_GENERAL_CLASS 0
     #define MYSQL_AUDIT_GENERAL_CLASSMASK (1 << MYSQL_AUDIT_GENERAL_CLASS)

'plugin_audit.h' also has defines for a 'connection' event class,
although the 'NULL_AUDIT' plugin does nothing with such events:

     #define MYSQL_AUDIT_CONNECTION_CLASS 1
     #define MYSQL_AUDIT_CONNECTION_CLASSMASK (1 << MYSQL_AUDIT_CONNECTION_CLASS)

A plugin could be written to receive both general and connection events
by setting its type-specific descriptor class mask like this:

       { (unsigned long) MYSQL_AUDIT_GENERAL_CLASSMASK |
                      MYSQL_AUDIT_CONNECTION_CLASSMASK } /* class mask        */

In the type-specific plugin descriptor, the second and third parameters
of the 'event_notify' function prototype represent the event class and a
generic pointer to an event structure:

     void (*event_notify)(MYSQL_THD, unsigned int, const void *);

Events in different classes may have different structures, so the
notification function should use the event class value to determine how
to interpret the pointer to the event structure.

If the server calls the notification function with an event class of
'MYSQL_AUDIT_GENERAL_CLASS', it passes the event structure as a pointer
to a 'mysql_event_general' structure:

     struct mysql_event_general
     {
       unsigned int event_subclass;
       int general_error_code;
       unsigned long general_thread_id;
       const char *general_user;
       unsigned int general_user_length;
       const char *general_command;
       unsigned int general_command_length;
       const char *general_query;
       unsigned int general_query_length;
       struct charset_info_st *general_charset;
       unsigned long long general_time;
       unsigned long long general_rows;
     };

Audit plugins can interpret 'mysql_event_general' members as follows:

   * 'event_subclass': The event subclass, one of the following values:

          #define MYSQL_AUDIT_GENERAL_LOG 0
          #define MYSQL_AUDIT_GENERAL_ERROR 1
          #define MYSQL_AUDIT_GENERAL_RESULT 2
          #define MYSQL_AUDIT_GENERAL_STATUS 3

   * 'general_error_code': The error code.  This is a value like that
     returned by the *note 'mysql_errno()': mysql-errno. C API function;
     0 means 'no error.'

   * 'general_thread_id': The ID of the thread for which the event
     occurred.

   * 'general_user': The current user for the event.

   * 'general_user_length': The length of 'general_user', in bytes.

   * 'general_command': For general query log events, the type of
     operation.  Examples: 'Connect', 'Query', 'Shutdown'.  For error
     log events, the error message.  This is a value like that returned
     by the *note 'mysql_error()': mysql-error. C API function; an empty
     string means 'no error.' For result events, this is empty.

   * 'general_command_length': The length of 'general_command', in
     bytes.

   * 'general_query': The SQL statement that was logged or produced a
     result.

   * 'general_query_length': The length of 'general_query', in bytes.

   * 'general_charset': Character set information for the event.

   * 'general_time': A *note 'TIMESTAMP': datetime. value indicating the
     time just before the notification function was called.

   * 'general_rows': For general query log events, zero.  For error log
     events, the row number at which an error occurred.  For result
     events, the number of rows in the result plus one.  For statements
     that produce no result set, the value is 0.  This encoding enables
     statements that produce no result set to be distinguished from
     those that produce an empty result set.  For example, for a *note
     'DELETE': delete. statement, this value is 0.  For a *note
     'SELECT': select, the result is always 1 or more, where 1
     represents an empty result set.

   * 'general_host': For general query log events, a string representing
     the client host name.

   * 'general_sql_command': For general query log events, a string that
     indicates the type of action performed, such as 'connect' or
     'drop_table'.

   * 'general_external_user': For general query log events, a string
     representing the external user (empty if none).

   * 'general_ip': For general query log events, a string representing
     the client IP address.

The 'general_host', 'general_sql_command', 'general_external_user', and
'general_ip' members are new in MySQL 5.5.34.  These are
'MYSQL_LEX_STRING' structures that pair a string and its length.  For
example, if 'event_general' is a pointer to a general event, you can
access the members of the 'general_host' value as follows:

     event_general->general_host.length
     event_general->general_host.str

The 'NULL_AUDIT' plugin notification function is quite simple.  It
increments a global event counter, verifies that the event is of the
'general' class, then looks at the event subclass to determine which
subclass counter to increment:

     static void audit_null_notify(MYSQL_THD thd __attribute__((unused)),
                                   unsigned int event_class,
                                   const void *event)
     {
       number_of_calls++;
       if (event_class == MYSQL_AUDIT_GENERAL_CLASS)
       {
         const struct mysql_event_general *event_general=
           (const struct mysql_event_general *) event;
         switch (event_general->event_subclass)
         {
         case MYSQL_AUDIT_GENERAL_LOG:
           number_of_calls_general_log++;
           break;
         case MYSQL_AUDIT_GENERAL_ERROR:
           number_of_calls_general_error++;
           break;
         case MYSQL_AUDIT_GENERAL_RESULT:
           number_of_calls_general_result++;
           break;
         default:
           break;
         }
       }
     }

To compile and install a plugin library file, use the instructions in
*note compiling-plugin-libraries::.  To make the library file available
for use, install it in the plugin directory (the directory named by the
'plugin_dir' system variable).  For the 'NULL_AUDIT' plugin, it is
compiled and installed when you build MySQL from source.  It is also
included in binary distributions.  The build process produces a shared
object library with a name of 'adt_null.so' (the '.so' suffix might
differ depending on your platform).

To register the plugin at runtime, use this statement (adjust the '.so'
suffix for your platform as necessary):

     INSTALL PLUGIN NULL_AUDIT SONAME 'adt_null.so';

For additional information about plugin loading, see *note
plugin-loading::.

To verify plugin installation, examine the *note
'INFORMATION_SCHEMA.PLUGINS': plugins-table. table or use the *note
'SHOW PLUGINS': show-plugins. statement.  See *note
obtaining-plugin-information::.

While the audit plugin is installed, it exposes status variables that
indicate the events for which the plugin has been called:

     mysql> SHOW STATUS LIKE 'Audit_null%';
     +---------------------------+-------+
     | Variable_name             | Value |
     +---------------------------+-------+
     | Audit_null_called         | 1385  |
     | Audit_null_general_error  | 1     |
     | Audit_null_general_log    | 741   |
     | Audit_null_general_result | 643   |
     +---------------------------+-------+

'Audit_null_called' counts all events, and the other variables count
instances of event subclasses.  For example, the preceding *note 'SHOW
STATUS': show-status. statement causes the server to send a result to
the client and to write a message to the general query log if that log
is enabled.  Thus, a client that issues the statement repeatedly causes
'Audit_null_called' and 'Audit_null_general_result' to be incremented
each time, and 'Audit_null_general_log' to be incremented if the log is
enabled.

To disable the plugin after testing it, use this statement to unload it:

     UNINSTALL PLUGIN NULL_AUDIT;


File: manual.info.tmp,  Node: writing-authentication-plugins,  Prev: writing-audit-plugins,  Up: writing-plugins

24.2.4.12 Writing Authentication Plugins
........................................

* Menu:

* writing-authentication-plugins-server-side::  Writing the Server-Side Authentication Plugin
* writing-authentication-plugins-client-side::  Writing the Client-Side Authentication Plugin
* writing-authentication-plugins-setup::  Using the Authentication Plugins
* writing-authentication-plugins-proxy-users::  Implementing Proxy User Support in Authentication Plugins

MySQL supports pluggable authentication, in which plugins are invoked to
authenticate client connections.  Authentication plugins enable the use
of authentication methods other than the built-in method of passwords
stored in the 'mysql.user' system table.  For example, plugins can be
written to access external authentication methods.  Also, authentication
plugins can support the proxy user capability, such that the connecting
user is a proxy for another user and is treated, for purposes of access
control, as having the privileges of a different user.  For more
information, see *note pluggable-authentication::, and *note
proxy-users::.

An authentication plugin can be written for the server side or the
client side.  Server-side plugins use the same plugin API that is used
for the other server plugin types such as full-text parser or audit
plugins (although with a different type-specific descriptor).
Client-side plugins use the client plugin API.

Several header files contain information relevant to authentication
plugins:

   * 'plugin.h': Defines the 'MYSQL_AUTHENTICATION_PLUGIN' server plugin
     type.

   * 'client_plugin.h': Defines the API for client plugins.  This
     includes the client plugin descriptor and function prototypes for
     client plugin C API calls (see *note c-api-plugin-functions::).

   * 'plugin_auth.h': Defines the part of the server plugin API specific
     to authentication plugins.  This includes the type-specific
     descriptor for server-side authentication plugins and the
     'MYSQL_SERVER_AUTH_INFO' structure.

   * 'plugin_auth_common.h': Contains common elements of client and
     server authentication plugins.  This includes return value
     definitions and the 'MYSQL_PLUGIN_VIO' structure.

To write an authentication plugin, include the following header files in
the plugin source file.  Other MySQL or general header files might also
be needed, depending on the plugin capabilities and requirements.

   * For a source file that implements a server authentication plugin,
     include this file:

          #include <mysql/plugin_auth.h>

   * For a source file that implements a client authentication plugin,
     or both client and server plugins, include these files:

          #include <mysql/plugin_auth.h>
          #include <mysql/client_plugin.h>
          #include <mysql.h>

'plugin_auth.h' includes 'plugin.h' and 'plugin_auth_common.h', so you
need not include the latter files explicitly.

This section describes how to write a pair of simple server and client
authentication plugins that work together.

*Warning*:

These plugins accept any non-empty password and the password is sent as
cleartext.  This is insecure, so the plugins _should not be used in
production environments._

The server-side and client-side plugins developed here both are named
'auth_simple'.  As described in *note plugin-data-structures::, the
plugin library file must have the same base name as the client plugin,
so the source file name is 'auth_simple.c' and produces a library named
'auth_simple.so' (assuming that your system uses '.so' as the suffix for
library files).

In MySQL source distributions, authentication plugin source is located
in the 'plugin/auth' directory and can be examined as a guide to writing
other authentication plugins.  Also, to see how the built-in
authentication plugins are implemented, see 'sql/sql_acl.cc' for plugins
that are built in to the MySQL server and 'sql-common/client.c' for
plugins that are built in to the 'libmysqlclient' client library.  (For
the built-in client plugins, note that the 'auth_plugin_t' structures
used there differ from the structures used with the usual client plugin
declaration macros.  In particular, the first two members are provided
explicitly, not by declaration macros.)


File: manual.info.tmp,  Node: writing-authentication-plugins-server-side,  Next: writing-authentication-plugins-client-side,  Prev: writing-authentication-plugins,  Up: writing-authentication-plugins

24.2.4.13 Writing the Server-Side Authentication Plugin
.......................................................

Declare the server-side plugin with the usual general descriptor format
that is used for all server plugin types (see *note
server-plugin-descriptors::).  For the 'auth_simple' plugin, the
descriptor looks like this:

     mysql_declare_plugin(auth_simple)
     {
       MYSQL_AUTHENTICATION_PLUGIN,
       &auth_simple_handler,                 /* type-specific descriptor */
       "auth_simple",                        /* plugin name */
       "Author Name",                        /* author */
       "Any-password authentication plugin", /* description */
       PLUGIN_LICENSE_GPL,                   /* license type */
       NULL,                                 /* no init function */
       NULL,                                 /* no deinit function */
       0x0100,                               /* version = 1.0 */
       NULL,                                 /* no status variables */
       NULL,                                 /* no system variables */
       NULL,                                 /* no reserved information */
       0                                     /* no flags */
     }
     mysql_declare_plugin_end;

The 'name' member ('auth_simple') indicates the name to use for
references to the plugin in statements such as *note 'INSTALL PLUGIN':
install-plugin. or *note 'UNINSTALL PLUGIN': uninstall-plugin.  This is
also the name displayed by *note 'SHOW PLUGINS': show-plugins. or *note
'INFORMATION_SCHEMA.PLUGINS': plugins-table.

The 'auth_simple_handler' member of the general descriptor points to the
type-specific descriptor.  For an authentication plugin, the
type-specific descriptor is an instance of the 'st_mysql_auth' structure
(defined in 'plugin_auth.h'):

     struct st_mysql_auth
     {
       int interface_version;
       const char *client_auth_plugin;
       int (*authenticate_user)(MYSQL_PLUGIN_VIO *vio, MYSQL_SERVER_AUTH_INFO *info);
     };

The 'st_mysql_auth' structure has these members:

   * 'interface_version': The type-specific API version number, always
     'MYSQL_AUTHENTICATION_INTERFACE_VERSION'

   * 'client_auth_plugin': The client plugin name

   * 'authenticate_user': A pointer to the main plugin function that
     communicates with the client

The 'client_auth_plugin' member should indicate the name of the client
plugin if a specific plugin is required.  A value of 'NULL' means 'any
plugin.' In the latter case, whatever plugin the client uses will do.
This is useful if the server plugin does not care about the client
plugin or what user name or password it sends.  For example, this might
be true if the server plugin authenticates only local clients and uses
some property of the operating system rather than the information sent
by the client plugin.

For 'auth_simple', the type-specific descriptor looks like this:

     static struct st_mysql_auth auth_simple_handler =
     {
       MYSQL_AUTHENTICATION_INTERFACE_VERSION,
       "auth_simple",           /* required client-side plugin name */
       auth_simple_server       /* server-side plugin main function */
     };

The main function, 'auth_simple_server()', takes two arguments
representing an I/O structure and a 'MYSQL_SERVER_AUTH_INFO' structure.
The structure definition, found in 'plugin_auth.h', looks like this:

     typedef struct st_mysql_server_auth_info
     {
       char *user_name;
       unsigned int user_name_length;
       const char *auth_string;
       unsigned long auth_string_length;
       char authenticated_as[MYSQL_USERNAME_LENGTH+1];
       char external_user[512];
       int  password_used;
       const char *host_or_ip;
       unsigned int host_or_ip_length;
     } MYSQL_SERVER_AUTH_INFO;

The character set for string members is UTF-8.  If there is a '_length'
member associated with a string, it indicates the string length in
bytes.  Strings are also null-terminated.

When an authentication plugin is invoked by the server, it should
interpret the 'MYSQL_SERVER_AUTH_INFO' structure members as follows.
Some of these are used to set the value of SQL functions or system
variables within the client session, as indicated.

   * 'user_name': The user name sent by the client.  The value becomes
     the 'USER()' function value.

   * 'user_name_length': The length of 'user_name' in bytes.

   * 'auth_string': The value of the 'authentication_string' column of
     the row in the 'mysql.user' system table for the matching account
     name (that is, the row that matches the client user name and host
     name and that the server uses to determine how to authenticate the
     client).

     Suppose that you create an account using the following statement:

          CREATE USER 'my_user'@'localhost'
            IDENTIFIED WITH my_plugin AS 'MY_AUTH_STRING';

     When 'my_user' connects from the local host, the server invokes
     'my_plugin' and passes ''MY_AUTH_STRING'' to it as the
     'auth_string' value.

   * 'auth_string_length': The length of 'auth_string' in bytes.

   * 'authenticated_as': The server sets this to the user name (the
     value of 'user_name').  The plugin can alter it to indicate that
     the client should have the privileges of a different user.  For
     example, if the plugin supports proxy users, the initial value is
     the name of the connecting (proxy) user, and the plugin can change
     this member to the proxied user name.  The server then treats the
     proxy user as having the privileges of the proxied user (assuming
     that the other conditions for proxy user support are satisfied; see
     *note writing-authentication-plugins-proxy-users::).  The value is
     represented as a string at most 'MYSQL_USER_NAME_LENGTH' bytes
     long, plus a terminating null.  The value becomes the
     'CURRENT_USER()' function value.

   * 'external_user': The server sets this to the empty string (null
     terminated).  Its value becomes the 'external_user' system variable
     value.  If the plugin wants that system variable to have a
     different value, it should set this member accordingly (for
     example, to the connecting user name).  The value is represented as
     a string at most 511 bytes long, plus a terminating null.

   * 'password_used': This member applies when authentication fails.
     The plugin can set it or ignore it.  The value is used to construct
     the failure error message of 'Authentication fails. Password used:
     %s'.  The value of 'password_used' determines how '%s' is handled,
     as shown in the following table.

     'password_used'    '%s' Handling
                        
     0                  NO
                        
     1                  YES
                        
     2                  There will be no '%s'

   * 'host_or_ip': The name of the client host if it can be resolved, or
     the IP address otherwise.

   * 'host_or_ip_length': The length of 'host_or_ip' in bytes.

The 'auth_simple' main function, 'auth_simple_server()', reads the
password (a null-terminated string) from the client and succeeds if the
password is nonempty (first byte not null):

     static int auth_simple_server (MYSQL_PLUGIN_VIO *vio,
                                    MYSQL_SERVER_AUTH_INFO *info)
     {
       unsigned char *pkt;
       int pkt_len;

       /* read the password as null-terminated string, fail on error */
       if ((pkt_len= vio->read_packet(vio, &pkt)) < 0)
         return CR_ERROR;

       /* fail on empty password */
       if (!pkt_len || *pkt == '\0')
       {
         info->password_used= PASSWORD_USED_NO;
         return CR_ERROR;
       }

       /* accept any nonempty password */
       info->password_used= PASSWORD_USED_YES;

       return CR_OK;
     }

The main function should return one of the error codes shown in the
following table.

Error Code         Meaning
                   
'CR_OK'            Success
                   
'CR_OK_HANDSHAKE_COMPLETE'Do not send a status packet back to client
                   
'CR_ERROR'         Error

For an example of how the handshake works, see the
'plugin/auth/dialog.c' source file.

'auth_simple_server()' is so basic that it does not use the
authentication information structure except to set the member that
indicates whether a password was received.

A plugin that supports proxy users must return to the server the name of
the proxied user (the MySQL user whose privileges the client user should
get).  To do this, the plugin must set the 'info->authenticated_as'
member to the proxied user name.  For information about proxying, see
*note proxy-users::, and *note
writing-authentication-plugins-proxy-users::.


File: manual.info.tmp,  Node: writing-authentication-plugins-client-side,  Next: writing-authentication-plugins-setup,  Prev: writing-authentication-plugins-server-side,  Up: writing-authentication-plugins

24.2.4.14 Writing the Client-Side Authentication Plugin
.......................................................

Declare the client-side plugin descriptor with the
'mysql_declare_client_plugin()' and 'mysql_end_client_plugin' macros
(see *note client-plugin-descriptors::).  For the 'auth_simple' plugin,
the descriptor looks like this:

     mysql_declare_client_plugin(AUTHENTICATION)
       "auth_simple",                        /* plugin name */
       "Author Name",                        /* author */
       "Any-password authentication plugin", /* description */
       {1,0,0},                              /* version = 1.0.0 */
       "GPL",                                /* license type */
       NULL,                                 /* for internal use */
       NULL,                                 /* no init function */
       NULL,                                 /* no deinit function */
       NULL,                                 /* no option-handling function */
       auth_simple_client                    /* main function */
     mysql_end_client_plugin;

The descriptor members from the plugin name through the option-handling
function are common to all client plugin types.  (For descriptions, see
*note client-plugin-descriptors::.)  Following the common members, the
descriptor has an additional member specific to authentication plugins.
This is the 'main' function, which handles communication with the
server.  The function takes two arguments representing an I/O structure
and a connection handler.  For our simple any-password plugin, the main
function does nothing but write to the server the password provided by
the user:

     static int auth_simple_client (MYSQL_PLUGIN_VIO *vio, MYSQL *mysql)
     {
       int res;

       /* send password as null-terminated string as cleartext */
       res= vio->write_packet(vio, (const unsigned char *) mysql->passwd,
                              strlen(mysql->passwd) + 1);

       return res ? CR_ERROR : CR_OK;
     }

The main function should return one of the error codes shown in the
following table.

Error Code         Meaning
                   
'CR_OK'            Success
                   
'CR_OK_HANDSHAKE_COMPLETE'Success, client done
                   
'CR_ERROR'         Error

'CR_OK_HANDSHAKE_COMPLETE' indicates that the client has done its part
successfully and has read the last packet.  A client plugin may return
'CR_OK_HANDSHAKE_COMPLETE' if the number of round trips in the
authentication protocol is not known in advance and the plugin must read
another packet to determine whether authentication is finished.


File: manual.info.tmp,  Node: writing-authentication-plugins-setup,  Next: writing-authentication-plugins-proxy-users,  Prev: writing-authentication-plugins-client-side,  Up: writing-authentication-plugins

24.2.4.15 Using the Authentication Plugins
..........................................

To compile and install a plugin library file, use the instructions in
*note compiling-plugin-libraries::.  To make the library file available
for use, install it in the plugin directory (the directory named by the
'plugin_dir' system variable).

Register the server-side plugin with the server.  For example, to load
the plugin at server startup, use a '--plugin-load=auth_simple.so'
option (adjust the '.so' suffix for your platform as necessary).

Create a user for whom the server will use the 'auth_simple' plugin for
authentication:

     mysql> CREATE USER 'x'@'localhost'
         -> IDENTIFIED WITH auth_simple;

Use a client program to connect to the server as user 'x'.  The
server-side 'auth_simple' plugin communicates with the client program
that it should use the client-side 'auth_simple' plugin, and the latter
sends the password to the server.  The server plugin should reject
connections that send an empty password and accept connections that send
a nonempty password.  Invoke the client program each way to verify this:

     shell> mysql --user=x --skip-password
     ERROR 1045 (28000): Access denied for user 'x'@'localhost' (using password: NO)

     shell> mysql --user=x --password
     Enter password: abc
     mysql>

Because the server plugin accepts any nonempty password, it should be
considered insecure.  After testing the plugin to verify that it works,
restart the server without the '--plugin-load' option so as not to
indavertently leave the server running with an insecure authentication
plugin loaded.  Also, drop the user with *note 'DROP USER
'x'@'localhost'': drop-user.

For additional information about loading and using authentication
plugins, see *note plugin-loading::, and *note
pluggable-authentication::.

If you are writing a client program that supports the use of
authentication plugins, normally such a program causes a plugin to be
loaded by calling *note 'mysql_options()': mysql-options. to set the
'MYSQL_DEFAULT_AUTH' and 'MYSQL_PLUGIN_DIR' options:

     char *plugin_dir = "PATH_TO_PLUGIN_DIR";
     char *default_auth = "PLUGIN_NAME";

     /* ... process command-line options ... */

     mysql_options(&mysql, MYSQL_PLUGIN_DIR, plugin_dir);
     mysql_options(&mysql, MYSQL_DEFAULT_AUTH, default_auth);

Typically, the program will also accept '--plugin-dir' and
'--default-auth' options that enable users to override the default
values.

Should a client program require lower-level plugin management, the
client library contains functions that take an 'st_mysql_client_plugin'
argument.  See *note c-api-plugin-functions::.


File: manual.info.tmp,  Node: writing-authentication-plugins-proxy-users,  Prev: writing-authentication-plugins-setup,  Up: writing-authentication-plugins

24.2.4.16 Implementing Proxy User Support in Authentication Plugins
...................................................................

One of the capabilities that pluggable authentication makes possible is
proxy users (see *note proxy-users::).  For a server-side authentication
plugin to participate in proxy user support, these conditions must be
satisfied:

   * When a connecting client should be treated as a proxy user, the
     plugin must return a different name in the 'authenticated_as'
     member of the 'MYSQL_SERVER_AUTH_INFO' structure, to indicate the
     proxied user name.  It may also optionally set the 'external_user'
     member, to set the value of the 'external_user' system variable.

   * Proxy user accounts must be set up to be authenticated by the
     plugin.  Use the *note 'CREATE USER': create-user. or *note
     'GRANT': grant. statement to associate accounts with plugins.

   * Proxy user accounts must have the 'PROXY' privilege for the proxied
     accounts.  Use the *note 'GRANT': grant. statement to grant this
     privilege.

In other words, the only aspect of proxy user support required of the
plugin is that it set 'authenticated_as' to the proxied user name.  The
rest is optional (setting 'external_user') or done by the DBA using SQL
statements.

How does an authentication plugin determine which proxied user to return
when the proxy user connects?  That depends on the plugin.  Typically,
the plugin maps clients to proxied users based on the authentication
string passed to it by the server.  This string comes from the 'AS' part
of the 'IDENTIFIED WITH' clause of the *note 'CREATE USER': create-user.
statement that specifies use of the plugin for authentication.

The plugin developer determines the syntax rules for the authentication
string and implements the plugin according to those rules.  Suppose that
a plugin takes a comma-separated list of pairs that map external users
to MySQL users.  For example:

     CREATE USER ''@'%.example.com'
       IDENTIFIED WITH my_plugin AS 'extuser1=mysqlusera, extuser2=mysqluserb'
     CREATE USER ''@'%.example.org'
       IDENTIFIED WITH my_plugin AS 'extuser1=mysqluserc, extuser2=mysqluserd'

When the server invokes a plugin to authenticate a client, it passes the
appropriate authentication string to the plugin.  The plugin is
responsible to:

  1. Parse the string into its components to determine the mapping to
     use

  2. Compare the client user name to the mapping

  3. Return the proper MySQL user name

For example, if 'extuser2' connects from an 'example.com' host, the
server passes ''extuser1=mysqlusera, extuser2=mysqluserb'' to the
plugin, and the plugin should copy 'mysqluserb' into 'authenticated_as',
with a terminating null byte.  If 'extuser2' connects from an
'example.org' host, the server passes ''extuser1=mysqluserc,
extuser2=mysqluserd'', and the plugin should copy 'mysqluserd' instead.

If there is no match in the mapping, the action depends on the plugin.
If a match is required, the plugin likely will return an error.  Or the
plugin might simply return the client name; in this case, it should not
change 'authenticated_as', and the server will not treat the client as a
proxy.

The following example demonstrates how to handle proxy users using a
plugin named 'auth_simple_proxy'.  Like the 'auth_simple' plugin
described earlier, 'auth_simple_proxy' accepts any nonempty password as
valid (and thus should not be used in production environments).  In
addition, it examines the 'auth_string' authentication string member and
uses these very simple rules for interpreting it:

   * If the string is empty, the plugin returns the user name as given
     and no proxying occurs.  That is, the plugin leaves the value of
     'authenticated_as' unchanged.

   * If the string is nonempty, the plugin treats it as the name of the
     proxied user and copies it to 'authenticated_as' so that proxying
     occurs.

For testing, set up one account that is not proxied according to the
preceding rules, and one that is.  This means that one account has no
'AS' clause, and one includes an 'AS' clause that names the proxied
user:

     CREATE USER 'plugin_user1'@'localhost'
       IDENTIFIED WITH auth_simple_proxy;
     CREATE USER 'plugin_user2'@'localhost'
       IDENTIFIED WITH auth_simple_proxy AS 'proxied_user';

In addition, create an account for the proxied user and grant
'plugin_user2' the 'PROXY' privilege for it:

     CREATE USER 'proxied_user'@'localhost'
       IDENTIFIED BY 'proxied_user_pass';
     GRANT PROXY
       ON 'proxied_user'@'localhost'
       TO 'plugin_user2'@'localhost';

Before the server invokes an authentication plugin, it sets
'authenticated_as' to the client user name.  To indicate that the user
is a proxy, the plugin should set 'authenticated_as' to the proxied user
name.  For 'auth_simple_proxy', this means that it must examine the
'auth_string' value, and, if the value is nonempty, copy it to the
'authenticated_as' member to return it as the name of the proxied user.
In addition, when proxying occurs, the plugin sets the 'external_user'
member to the client user name; this becomes the value of the
'external_user' system variable.

     static int auth_simple_proxy_server (MYSQL_PLUGIN_VIO *vio,
                                          MYSQL_SERVER_AUTH_INFO *info)
     {
       unsigned char *pkt;
       int pkt_len;

       /* read the password as null-terminated string, fail on error */
       if ((pkt_len= vio->read_packet(vio, &pkt)) < 0)
         return CR_ERROR;

       /* fail on empty password */
       if (!pkt_len || *pkt == '\0')
       {
         info->password_used= PASSWORD_USED_NO;
         return CR_ERROR;
       }

       /* accept any nonempty password */
       info->password_used= PASSWORD_USED_YES;

       /* if authentication string is nonempty, use as proxied user name */
       /* and use client name as external_user value */
       if (info->auth_string_length > 0)
       {
         strcpy (info->authenticated_as, info->auth_string);
         strcpy (info->external_user, info->user_name);
       }

       return CR_OK;
     }

After a successful connection, the 'USER()' function should indicate the
connecting client user and host name, and 'CURRENT_USER()' should
indicate the account whose privileges apply during the session.  The
latter value should be the connecting user account if no proxying occurs
or the proxied account if proxying does occur.

Compile and install the plugin, then test it.  First, connect as
'plugin_user1':

     shell> mysql --user=plugin_user1 --password
     Enter password: x

In this case, there should be no proxying:

     mysql> SELECT USER(), CURRENT_USER(), @@proxy_user, @@external_user\G
     *************************** 1. row ***************************
              USER(): plugin_user1@localhost
      CURRENT_USER(): plugin_user1@localhost
        @@proxy_user: NULL
     @@external_user: NULL

Then connect as 'plugin_user2':

     shell> mysql --user=plugin_user2 --password
     Enter password: x

In this case, 'plugin_user2' should be proxied to 'proxied_user':

     mysql> SELECT USER(), CURRENT_USER(), @@proxy_user, @@external_user\G
     *************************** 1. row ***************************
              USER(): plugin_user2@localhost
      CURRENT_USER(): proxied_user@localhost
        @@proxy_user: 'plugin_user2'@'localhost'
     @@external_user: 'plugin_user2'@'localhost'


File: manual.info.tmp,  Node: plugin-services,  Next: adding-functions,  Prev: plugin-api,  Up: extending-mysql

24.3 MySQL Services for Plugins
===============================

MySQL server plugins have access to server 'plugin services.' The plugin
services interface exposes server functionality that plugins can call.
It complements the plugin API and has these characteristics:

   * Services enable plugins to access code inside the server using
     ordinary function calls.  Services are also available to
     user-defined functions (UDFs).

   * Services are portable and work on multiple platforms.

   * The interface includes a versioning mechanism so that service
     versions supported by the server can be checked at load time
     against plugin versions.  Versioning protects against
     incompatibilities between the version of a service that the server
     provides and the version of the service expected or required by a
     plugin.

The plugin services interface differs from the plugin API as follows:

   * The plugin API enables plugins to be used by the server.  The
     calling initiative lies with the server to invoke plugins.  This
     enables plugins to extend server functionality or register to
     receive notifications about server processing.

   * The plugin services interface enables plugins to call code inside
     the server.  The calling initiative lies with plugins to invoke
     service functions.  This enables functionality already implemented
     in the server to be used by many plugins; they need not
     individually implement it themselves.

To determine what services exist and what functions they provide, look
in the 'include/mysql' directory of a MySQL source distribution.  The
relevant files are:

   * 'plugin.h' includes 'services.h', which is the 'umbrella' header
     that includes all available service-specific header files.

   * Service-specific headers have names of the form 'service_XXX.h'.

Each service-specific header should contain comments that provide full
usage documentation for a given service, including what service
functions are available, their calling sequences, and return values.

For developers who wish to modify the server to add a new service, see
MySQL Internals: MySQL Services for Plugins
(https://dev.mysql.com/doc/internals/en/mysql-services-for-plugins.html).

Available services include the following:

   * 'my_snprintf': A string-formatting service that produces consistent
     results across platforms.

   * 'my_thd_scheduler': A service for plugins to select a thread
     scheduler.

   * 'thd_alloc': A memory-allocation service.

   * 'thd_wait': A service for plugins to report when they are going to
     sleep or stall.

The remainder of this section describes how a plugin uses server
functionality that is available as a service.  See also the source for
the 'daemon' example plugin, which uses the 'my_snprintf' service.
Within a MySQL source distribution, that plugin is located in the
'plugin/daemon_example' directory.

To use a service or services from within a plugin, the plugin source
file must include the 'plugin.h' header file to access service-related
information:

     #include <mysql/plugin.h>

This does not represent any additional setup cost.  A plugin must
include that file anyway because it contains definitions and structures
that every plugin needs.

To access a service, a plugin calls service functions like any other
function.  For example, to format a string into a buffer for printing,
call the 'my_snprintf()' function provided by the service of the same
name:

     char buffer[BUFFER_SIZE];

     my_snprintf(buffer, sizeof(buffer), FORMAT_STRING, ARGUMENT_TO_FORMAT, ...);

When you build your plugin, use the '-lmysqlservices' flag at link time
to link in the 'libmysqlservices' library.  For example, for 'CMake',
put this in the top-level 'CMakeLists.txt' file:

     FIND_LIBRARY(MYSQLSERVICES_LIB mysqlservices
      PATHS "${MYSQL_SRCDIR}/libservices" NO_DEFAULT_PATH)

Put this in the 'CMakeLists.txt' file in the directory containing the
plugin source:

     # the plugin needs the mysql services library for error logging
     TARGET_LINK_LIBRARIES (YOUR_PLUGIN_LIBRARY_NAME ${MYSQLSERVICES_LIB})


File: manual.info.tmp,  Node: adding-functions,  Next: porting,  Prev: plugin-services,  Up: extending-mysql

24.4 Adding Functions to MySQL
==============================

* Menu:

* udf-features::                 Features of the User-Defined Function Interface
* adding-udf::                   Adding a User-Defined Function
* adding-native-function::       Adding a Native Function

There are three ways to add functions to MySQL:

   * Through the user-defined function (UDF) interface.  User-defined
     functions are compiled as library files and then added to and
     removed from the server dynamically using the *note 'CREATE
     FUNCTION': create-function. and *note 'DROP FUNCTION':
     drop-function. statements.  See *note create-function-udf::.

   * By creating native (built-in) MySQL functions.  Native functions
     are compiled into the *note 'mysqld': mysqld. server and become
     available on a permanent basis.

   * By creating stored functions.  These are written using SQL
     statements rather than by compiling object code.  The syntax for
     writing stored functions is not covered here.  See *note
     stored-routines::.

Each method of creating compiled functions has advantages and
disadvantages:

   * If you write user-defined functions, you must install object files
     in addition to the server itself.  If you compile your function
     into the server, you need not do that.

   * Native functions require you to modify a source distribution.  UDFs
     do not.  You can add UDFs to a binary MySQL distribution.  No
     access to MySQL source is necessary.

   * If you upgrade your MySQL distribution, you can continue to use
     your previously installed UDFs, unless you upgrade to a newer
     version for which the UDF interface changes.  For native functions,
     you must repeat your modifications each time you upgrade.

Whichever method you use to add functions, they can be invoked in SQL
statements just like native functions such as 'ABS()' or 'SOUNDEX()'.

For the rules describing how the server interprets references to
different kinds of functionss see *note function-resolution::.

The following sections describe features of the UDF interface, provide
instructions for writing UDFs, discuss security precautions that MySQL
takes to prevent UDF misuse, and describe how to add native MySQL
functions.

For example source code that illustrates how to write UDFs, take a look
at the 'sql/udf_example.c' file that is provided in MySQL source
distributions.


File: manual.info.tmp,  Node: udf-features,  Next: adding-udf,  Prev: adding-functions,  Up: adding-functions

24.4.1 Features of the User-Defined Function Interface
------------------------------------------------------

The MySQL interface for user-defined functions provides the following
features and capabilities:

   * Functions can return string, integer, or real values and can accept
     arguments of those same types.

   * You can define simple functions that operate on a single row at a
     time, or aggregate functions that operate on groups of rows.

   * Information is provided to functions that enables them to check the
     number, types, and names of the arguments passed to them.

   * You can tell MySQL to coerce arguments to a given type before
     passing them to a function.

   * You can indicate that a function returns 'NULL' or that an error
     occurred.


File: manual.info.tmp,  Node: adding-udf,  Next: adding-native-function,  Prev: udf-features,  Up: adding-functions

24.4.2 Adding a User-Defined Function
-------------------------------------

For the UDF mechanism to work, functions must be written in C or C++ and
your operating system must support dynamic loading.  MySQL source
distributions include a file 'sql/udf_example.c' that defines five UDF
functions.  Consult this file to see how UDF calling conventions work.
The 'include/mysql_com.h' header file defines UDF-related symbols and
data structures, although you need not include this header file
directly; it is included by 'mysql.h'.

A UDF contains code that becomes part of the running server, so when you
write a UDF, you are bound by any and all constraints that apply to
writing server code.  For example, you may have problems if you attempt
to use functions from the 'libstdc++' library.  These constraints may
change in future versions of the server, so it is possible that server
upgrades will require revisions to UDFs that were originally written for
older servers.  For information about these constraints, see *note
source-configuration-options::, and *note compilation-problems::.

To be able to use UDFs, you must link *note 'mysqld': mysqld.
dynamically.  If you want to use a UDF that needs to access symbols from
*note 'mysqld': mysqld. (for example, the 'metaphone' function in
'sql/udf_example.c' uses 'default_charset_info'), you must link the
program with '-rdynamic' (see 'man dlopen').

For each function that you want to use in SQL statements, you should
define corresponding C (or C++) functions.  In the following discussion,
the name 'xxx' is used for an example function name.  To distinguish
between SQL and C/C++ usage, 'XXX()' (uppercase) indicates an SQL
function call, and 'xxx()' (lowercase) indicates a C/C++ function call.

*Note*:

When using C++, encapsulate your C functions within this construct:

     extern "C" { ... }

This ensures that your C++ function names remain readable in the
completed UDF.

   * *note udf-interface-functions::

   * *note udf-calling::

   * *note udf-aggr-calling::

   * *note udf-arguments::

   * *note udf-return-values::

   * *note udf-compiling::

   * *note udf-security::

*User-Defined Function Interface Functions*

The following list describes the C/C++ functions that you write to
implement the interface for a function named 'XXX()'.  The main
function, 'xxx()', is required.  In addition, a UDF requires at least
one of the other functions described here, for reasons discussed in
*note udf-security::.

   * 'xxx()'

     The main function.  This is where the function result is computed.
     The correspondence between the SQL function data type and the
     return type of your C/C++ function is shown here.

     SQL Type           C/C++ Type
                        
     'STRING'           'char *'
                        
     *note 'INTEGER': integer-types.'long long'
                        
     *note 'REAL': floating-point-types.'double'

     It is also possible to declare a *note 'DECIMAL':
     fixed-point-types. function, but the value is returned as a string,
     so you should write the UDF as though it were a 'STRING' function.
     'ROW' functions are not implemented.

   * 'xxx_init()'

     The initialization function for 'xxx()'.  If present, it can be
     used for the following purposes:

        * To check the number of arguments to 'XXX()'.

        * To verify that the arguments are of a required type or,
          alternatively, to tell MySQL to coerce arguments to the
          required types when the main function is called.

        * To allocate any memory required by the main function.

        * To specify the maximum length of the result.

        * To specify (for *note 'REAL': floating-point-types. functions)
          the maximum number of decimal places in the result.

        * To specify whether the result can be 'NULL'.

   * 'xxx_deinit()'

     The deinitialization function for 'xxx()'.  If present, it should
     deallocate any memory allocated by the initialization function.

When an SQL statement invokes 'XXX()', MySQL calls the initialization
function 'xxx_init()' to let it perform any required setup, such as
argument checking or memory allocation.  If 'xxx_init()' returns an
error, MySQL aborts the SQL statement with an error message and does not
call the main or deinitialization functions.  Otherwise, MySQL calls the
main function 'xxx()' once for each row.  After all rows have been
processed, MySQL calls the deinitialization function 'xxx_deinit()' so
that it can perform any required cleanup.

For aggregate functions that work like 'SUM()', you must also provide
the following functions:

   * 'xxx_clear()'

     Reset the current aggregate value but do not insert the argument as
     the initial aggregate value for a new group.

   * 'xxx_add()'

     Add the argument to the current aggregate value.

MySQL handles aggregate UDFs as follows:

  1. Call 'xxx_init()' to let the aggregate function allocate any memory
     it needs for storing results.

  2. Sort the table according to the 'GROUP BY' expression.

  3. Call 'xxx_clear()' for the first row in each new group.

  4. Call 'xxx_add()' for each row that belongs in the same group.

  5. Call 'xxx()' to get the result for the aggregate when the group
     changes or after the last row has been processed.

  6. Repeat steps 3 to 5 until all rows has been processed

  7. Call 'xxx_deinit()' to let the UDF free any memory it has
     allocated.

All functions must be thread-safe.  This includes not just the main
function, but the initialization and deinitialization functions as well,
and also the additional functions required by aggregate functions.  A
consequence of this requirement is that you are not permitted to
allocate any global or static variables that change!  If you need
memory, you must it in 'xxx_init()' and free it in 'xxx_deinit()'.

*UDF Calling Sequences for Simple Functions*

This section describes the different functions that you must define to
create a simple UDF. For information about the order in which MySQL
calls these functions, see *note udf-interface-functions::.

The main 'xxx()' function should be declared as shown in this section.
Note that the return type and parameters differ, depending on whether
you declare the SQL function 'XXX()' to return 'STRING', *note
'INTEGER': integer-types, or *note 'REAL': floating-point-types. in the
*note 'CREATE FUNCTION': create-function. statement:

For 'STRING' functions:

     char *xxx(UDF_INIT *initid, UDF_ARGS *args,
               char *result, unsigned long *length,
               char *is_null, char *error);

For *note 'INTEGER': integer-types. functions:

     long long xxx(UDF_INIT *initid, UDF_ARGS *args,
                   char *is_null, char *error);

For *note 'REAL': floating-point-types. functions:

     double xxx(UDF_INIT *initid, UDF_ARGS *args,
                   char *is_null, char *error);

*note 'DECIMAL': fixed-point-types. functions return string values and
are declared the same way as 'STRING' functions.  'ROW' functions are
not implemented.

Declare the initialization and deinitialization functions like this:

     my_bool xxx_init(UDF_INIT *initid, UDF_ARGS *args, char *message);

     void xxx_deinit(UDF_INIT *initid);

The 'initid' parameter is passed to all three functions.  It points to a
'UDF_INIT' structure that is used to communicate information between
functions.  The 'UDF_INIT' structure members follow.  The initialization
function should fill in any members that it wishes to change.  (To use
the default for a member, leave it unchanged.)

   * 'my_bool maybe_null'

     'xxx_init()' should set 'maybe_null' to '1' if 'xxx()' can return
     'NULL'.  The default value is '1' if any of the arguments are
     declared 'maybe_null'.

   * 'unsigned int decimals'

     The number of decimal digits to the right of the decimal point.
     The default value is the maximum number of decimal digits in the
     arguments passed to the main function.  For example, if the
     function is passed '1.34', '1.345', and '1.3', the default would be
     3, because '1.345' has 3 decimal digits.

     For arguments that have no fixed number of decimals, the 'decimals'
     value is set to 31, which is 1 more than the maximum number of
     decimals permitted for the *note 'DECIMAL': fixed-point-types,
     *note 'FLOAT': floating-point-types, and *note 'DOUBLE':
     floating-point-types. data types.  This value is available as the
     constant 'NOT_FIXED_DEC' in the 'mysql_com.h' header file.

     A 'decimals' value of 31 is used for arguments in cases such as a
     *note 'FLOAT': floating-point-types. or *note 'DOUBLE':
     floating-point-types. column declared without an explicit number of
     decimals (for example, *note 'FLOAT': floating-point-types. rather
     than 'FLOAT(10,3)') and for floating-point constants such as
     '1345E-3'.  It is also used for string and other nonnumber
     arguments that might be converted within the function to numeric
     form.

     The value to which the 'decimals' member is initialized is only a
     default.  It can be changed within the function to reflect the
     actual calculation performed.  The default is determined such that
     the largest number of decimals of the arguments is used.  If the
     number of decimals is 'NOT_FIXED_DEC' for even one of the
     arguments, that is the value used for 'decimals'.

   * 'unsigned int max_length'

     The maximum length of the result.  The default 'max_length' value
     differs depending on the result type of the function.  For string
     functions, the default is the length of the longest argument.  For
     integer functions, the default is 21 digits.  For real functions,
     the default is 13 plus the number of decimal digits indicated by
     'initid->decimals'.  (For numeric functions, the length includes
     any sign or decimal point characters.)

     If you want to return a blob value, you can set 'max_length' to
     65KB or 16MB. This memory is not allocated, but the value is used
     to decide which data type to use if there is a need to temporarily
     store the data.

   * 'char *ptr'

     A pointer that the function can use for its own purposes.  For
     example, functions can use 'initid->ptr' to communicate allocated
     memory among themselves.  'xxx_init()' should allocate the memory
     and assign it to this pointer:

          initid->ptr = allocated_memory;

     In 'xxx()' and 'xxx_deinit()', refer to 'initid->ptr' to use or
     deallocate the memory.

   * 'my_bool const_item'

     'xxx_init()' should set 'const_item' to '1' if 'xxx()' always
     returns the same value and to '0' otherwise.

*UDF Calling Sequences for Aggregate Functions*

This section describes the different functions that you need to define
when you create an aggregate UDF. For information about the order in
which MySQL calls these functions, see *note udf-interface-functions::.

   * 'xxx_reset()'

     This function is called when MySQL finds the first row in a new
     group.  It should reset any internal summary variables and then use
     the given 'UDF_ARGS' argument as the first value in your internal
     summary value for the group.  Declare 'xxx_reset()' as follows:

          void xxx_reset(UDF_INIT *initid, UDF_ARGS *args,
                         char *is_null, char *error);

     'xxx_reset()' is not needed or used in MySQL 5.5, in which the UDF
     interface uses 'xxx_clear()' instead.  However, you can define both
     'xxx_reset()' and 'xxx_clear()' if you want to have your UDF work
     with older versions of the server.  (If you do include both
     functions, the 'xxx_reset()' function in many cases can be
     implemented internally by calling 'xxx_clear()' to reset all
     variables, and then calling 'xxx_add()' to add the 'UDF_ARGS'
     argument as the first value in the group.)

   * 'xxx_clear()'

     This function is called when MySQL needs to reset the summary
     results.  It is called at the beginning for each new group but can
     also be called to reset the values for a query where there were no
     matching rows.  Declare 'xxx_clear()' as follows:

          void xxx_clear(UDF_INIT *initid, char *is_null, char *error);

     'is_null' is set to point to 'CHAR(0)' before calling
     'xxx_clear()'.

     If something went wrong, you can store a value in the variable to
     which the 'error' argument points.  'error' points to a single-byte
     variable, not to a string buffer.

     'xxx_clear()' is required by MySQL 5.5.

   * 'xxx_add()'

     This function is called for all rows that belong to the same group.
     You should use it to add the value in the 'UDF_ARGS' argument to
     your internal summary variable.

          void xxx_add(UDF_INIT *initid, UDF_ARGS *args,
                       char *is_null, char *error);

The 'xxx()' function for an aggregate UDF should be declared the same
way as for a nonaggregate UDF. See *note udf-calling::.

For an aggregate UDF, MySQL calls the 'xxx()' function after all rows in
the group have been processed.  You should normally never access its
'UDF_ARGS' argument here but instead return a value based on your
internal summary variables.

Return value handling in 'xxx()' should be done the same way as for a
nonaggregate UDF. See *note udf-return-values::.

The 'xxx_reset()' and 'xxx_add()' functions handle their 'UDF_ARGS'
argument the same way as functions for nonaggregate UDFs.  See *note
udf-arguments::.

The pointer arguments to 'is_null' and 'error' are the same for all
calls to 'xxx_reset()', 'xxx_clear()', 'xxx_add()' and 'xxx()'.  You can
use this to remember that you got an error or whether the 'xxx()'
function should return 'NULL'.  You should not store a string into
'*error'!  'error' points to a single-byte variable, not to a string
buffer.

'*is_null' is reset for each group (before calling 'xxx_clear()').
'*error' is never reset.

If '*is_null' or '*error' are set when 'xxx()' returns, MySQL returns
'NULL' as the result for the group function.

*UDF Argument Processing*

The 'args' parameter points to a 'UDF_ARGS' structure that has the
members listed here:

   * 'unsigned int arg_count'

     The number of arguments.  Check this value in the initialization
     function if you require your function to be called with a
     particular number of arguments.  For example:

          if (args->arg_count != 2)
          {
              strcpy(message,"XXX() requires two arguments");
              return 1;
          }

     For other 'UDF_ARGS' member values that are arrays, array
     references are zero-based.  That is, refer to array members using
     index values from 0 to 'args->arg_count'  1.

   * 'enum Item_result *arg_type'

     A pointer to an array containing the types for each argument.  The
     possible type values are 'STRING_RESULT', 'INT_RESULT',
     'REAL_RESULT', and 'DECIMAL_RESULT'.

     To make sure that arguments are of a given type and return an error
     if they are not, check the 'arg_type' array in the initialization
     function.  For example:

          if (args->arg_type[0] != STRING_RESULT ||
              args->arg_type[1] != INT_RESULT)
          {
              strcpy(message,"XXX() requires a string and an integer");
              return 1;
          }

     Arguments of type 'DECIMAL_RESULT' are passed as strings, so you
     handle them the same way as 'STRING_RESULT' values.

     As an alternative to requiring your function's arguments to be of
     particular types, you can use the initialization function to set
     the 'arg_type' elements to the types you want.  This causes MySQL
     to coerce arguments to those types for each call to 'xxx()'.  For
     example, to specify that the first two arguments should be coerced
     to string and integer, respectively, do this in 'xxx_init()':

          args->arg_type[0] = STRING_RESULT;
          args->arg_type[1] = INT_RESULT;

     Exact-value decimal arguments such as '1.3' or *note 'DECIMAL':
     fixed-point-types. column values are passed with a type of
     'DECIMAL_RESULT'.  However, the values are passed as strings.  To
     receive a number, use the initialization function to specify that
     the argument should be coerced to a 'REAL_RESULT' value:

          args->arg_type[2] = REAL_RESULT;

   * 'char **args'

     'args->args' communicates information to the initialization
     function about the general nature of the arguments passed to your
     function.  For a constant argument 'i', 'args->args[i]' points to
     the argument value.  (See later for instructions on how to access
     the value properly.)  For a nonconstant argument, 'args->args[i]'
     is '0'.  A constant argument is an expression that uses only
     constants, such as '3' or '4*7-2' or 'SIN(3.14)'.  A nonconstant
     argument is an expression that refers to values that may change
     from row to row, such as column names or functions that are called
     with nonconstant arguments.

     For each invocation of the main function, 'args->args' contains the
     actual arguments that are passed for the row currently being
     processed.

     If argument 'i' represents 'NULL', 'args->args[i]' is a null
     pointer (0).  If the argument is not 'NULL', functions can refer to
     it as follows:

        * An argument of type 'STRING_RESULT' is given as a string
          pointer plus a length, to enable handling of binary data or
          data of arbitrary length.  The string contents are available
          as 'args->args[i]' and the string length is
          'args->lengths[i]'.  Do not assume that the string is
          null-terminated.

        * For an argument of type 'INT_RESULT', you must cast
          'args->args[i]' to a 'long long' value:

               long long int_val;
               int_val = *((long long*) args->args[i]);

        * For an argument of type 'REAL_RESULT', you must cast
          'args->args[i]' to a 'double' value:

               double    real_val;
               real_val = *((double*) args->args[i]);

        * For an argument of type 'DECIMAL_RESULT', the value is passed
          as a string and should be handled like a 'STRING_RESULT'
          value.

        * 'ROW_RESULT' arguments are not implemented.

   * 'unsigned long *lengths'

     For the initialization function, the 'lengths' array indicates the
     maximum string length for each argument.  You should not change
     these.  For each invocation of the main function, 'lengths'
     contains the actual lengths of any string arguments that are passed
     for the row currently being processed.  For arguments of types
     'INT_RESULT' or 'REAL_RESULT', 'lengths' still contains the maximum
     length of the argument (as for the initialization function).

   * 'char *maybe_null'

     For the initialization function, the 'maybe_null' array indicates
     for each argument whether the argument value might be null (0 if
     no, 1 if yes).

   * 'char **attributes'

     'args->attributes' communicates information about the names of the
     UDF arguments.  For argument 'i', the attribute name is available
     as a string in 'args->attributes[i]' and the attribute length is
     'args->attribute_lengths[i]'.  Do not assume that the string is
     null-terminated.

     By default, the name of a UDF argument is the text of the
     expression used to specify the argument.  For UDFs, an argument may
     also have an optional '[AS] ALIAS_NAME' clause, in which case the
     argument name is ALIAS_NAME.  The 'attributes' value for each
     argument thus depends on whether an alias was given.

     Suppose that a UDF 'my_udf()' is invoked as follows:

          SELECT my_udf(expr1, expr2 AS alias1, expr3 alias2);

     In this case, the 'attributes' and 'attribute_lengths' arrays will
     have these values:

          args->attributes[0] = "expr1"
          args->attribute_lengths[0] = 5

          args->attributes[1] = "alias1"
          args->attribute_lengths[1] = 6

          args->attributes[2] = "alias2"
          args->attribute_lengths[2] = 6

   * 'unsigned long *attribute_lengths'

     The 'attribute_lengths' array indicates the length of each argument
     name.

*UDF Return Values and Error Handling*

The initialization function should return '0' if no error occurred and
'1' otherwise.  If an error occurs, 'xxx_init()' should store a
null-terminated error message in the 'message' parameter.  The message
is returned to the client.  The message buffer is 'MYSQL_ERRMSG_SIZE'
characters long.  Try to keep the message to less than 80 characters so
that it fits the width of a standard terminal screen.

The return value of the main function 'xxx()' is the function value, for
'long long' and 'double' functions.  A string function should return a
pointer to the result and set '*length' to the length (in bytes) of the
return value.  For example:

     memcpy(result, "result string", 13);
     *length = 13;

MySQL passes a buffer to the 'xxx()' function using the 'result'
parameter.  This buffer is sufficiently long to hold 255 characters,
which can be multibyte characters.  The 'xxx()' function can store the
result in this buffer if it fits, in which case the return value should
be a pointer to the buffer.  If the function stores the result in a
different buffer, it should return a pointer to that buffer.

If your string function does not use the supplied buffer (for example,
if it needs to return a string longer than 255 characters), you must
allocate the space for your own buffer with 'malloc()' in the
'xxx_init()' function or the 'xxx()' function and free it in your
'xxx_deinit()' function.  You can store the allocated memory in the
'ptr' slot in the 'UDF_INIT' structure for reuse by future 'xxx()'
calls.  See *note udf-calling::.

To indicate a return value of 'NULL' in the main function, set
'*is_null' to '1':

     *is_null = 1;

To indicate an error return in the main function, set '*error' to '1':

     *error = 1;

If 'xxx()' sets '*error' to '1' for any row, the function value is
'NULL' for the current row and for any subsequent rows processed by the
statement in which 'XXX()' was invoked.  ('xxx()' is not even called for
subsequent rows.)

*UDF Compiling and Installing*

Files implementing UDFs must be compiled and installed on the host where
the server runs.  The process is described here for the example UDF file
'sql/udf_example.c' that is included in MySQL source distributions.  For
additional information about UDF installation, see *note udf-loading::.

If a UDF will be referred to in statements that will be replicated to
slave servers, you must ensure that every slave also has the function
available.  Otherwise, replication fails on the slaves when they attempt
to invoke the function.

The 'udf_example.c' file contains the following functions:

   * 'metaphon()' returns a metaphon string of the string argument.
     This is something like a soundex string, but it is more tuned for
     English.

   * 'myfunc_double()' returns the sum of the ASCII values of the
     characters in its arguments, divided by the sum of the length of
     its arguments.

   * 'myfunc_int()' returns the sum of the length of its arguments.

   * 'sequence([const int])' returns a sequence starting from the given
     number or 1 if no number has been given.

   * 'lookup()' returns the IP address for a host name.

   * 'reverse_lookup()' returns the host name for an IP address.  The
     function may be called either with a single string argument of the
     form ''xxx.xxx.xxx.xxx'' or with four numbers.

   * 'avgcost()' returns an average cost.  This is an aggregate
     function.

On Unix and Unix-like systems, compile user-defined functions using the
following procedure:

A dynamically loadable file should be compiled as a sharable library
file, using a command something like this:

     gcc -shared -o udf_example.so udf_example.c

If you are using 'gcc' with 'CMake' (which is how MySQL itself is
configured), you should be able to create 'udf_example.so' with a
simpler command:

     make udf_example

After compiling a shared object containing UDFs, you must install it and
tell MySQL about it.  Compiling a shared object from 'udf_example.c'
using 'gcc' directly produces a file named 'udf_example.so'.  Copy the
shared object to the server's plugin directory and name it
'udf_example.so'.  This directory is given by the value of the
'plugin_dir' system variable.

On some systems, the 'ldconfig' program that configures the dynamic
linker does not recognize a shared object unless its name begins with
'lib'.  In this case you should rename a file such as 'udf_example.so'
to 'libudf_example.so'.

On Windows, compile user-defined functions using the following
procedure:

  1. Obtain a MySQL source distribution.  See *note getting-mysql::.

  2. Obtain the 'CMake' build utility, if necessary, from
     <http://www.cmake.org>.  (Version 2.6 or later is required).

  3. In the source tree, look in the 'sql' directory for files named
     'udf_example.def' and 'udf_example.c'.  Copy both files from this
     directory to your working directory.

  4. Create a 'CMake' 'makefile' ('CMakeLists.txt') with these contents:

          PROJECT(udf_example)

          # Path for MySQL include directory
          INCLUDE_DIRECTORIES("c:/mysql/include")

          ADD_DEFINITIONS("-DHAVE_DLOPEN")
          ADD_LIBRARY(udf_example MODULE udf_example.c udf_example.def)
          TARGET_LINK_LIBRARIES(udf_example wsock32)

  5. Create the VC project and solution files, substituting an
     appropriate GENERATOR value:

          cmake -G "GENERATOR"

     Invoking 'cmake --help' shows you a list of valid generators.

  6. Create 'udf_example.dll':

          devenv udf_example.sln /build Release

On all platforms, after the shared library file has been copied to the
'plugin_dir' directory, notify *note 'mysqld': mysqld. about the new
functions with the following statements.  The file name suffix differs
per platform (for example, '.so' for Unix and Unix-like systems, '.dll'
for Windows), so adjust the '.so' suffix for your platform as necessary.

     CREATE FUNCTION metaphon RETURNS STRING
       SONAME 'udf_example.so';
     CREATE FUNCTION myfunc_double RETURNS REAL
       SONAME 'udf_example.so';
     CREATE FUNCTION myfunc_int RETURNS INTEGER
       SONAME 'udf_example.so';
     CREATE FUNCTION sequence RETURNS INTEGER
       SONAME 'udf_example.so';
     CREATE FUNCTION lookup RETURNS STRING
       SONAME 'udf_example.so';
     CREATE FUNCTION reverse_lookup RETURNS STRING
       SONAME 'udf_example.so';
     CREATE AGGREGATE FUNCTION avgcost RETURNS REAL
       SONAME 'udf_example.so';

Once installed, a function remains installed until it is uninstalled.

To remove functions, use *note 'DROP FUNCTION': drop-function.:

     DROP FUNCTION metaphon;
     DROP FUNCTION myfunc_double;
     DROP FUNCTION myfunc_int;
     DROP FUNCTION sequence;
     DROP FUNCTION lookup;
     DROP FUNCTION reverse_lookup;
     DROP FUNCTION avgcost;

The *note 'CREATE FUNCTION': create-function. and *note 'DROP FUNCTION':
drop-function. statements update the 'func' table in the 'mysql' system
database that serves as a UDF registry.  The function's name, type and
shared library name are saved in the 'mysql.func' table.  To create
functions, you must have the 'INSERT' privilege for the 'mysql'
database.  To drop functions, you must have the 'DELETE' privilege for
the 'mysql' database.

You cannnot use *note 'CREATE FUNCTION': create-function. to reinstall a
function that has previously been installed.  To reinstall a function,
first remove it with *note 'DROP FUNCTION': drop-function, then install
it with *note 'CREATE FUNCTION': create-function.  You would need to do
this, for example, if you upgrade to a new version of MySQL that
provides an updated implementation of the function, or you recompile a
new version of a function that you have written.  Otherwise, the server
continues to use the old version.

An active function is one that has been loaded with *note 'CREATE
FUNCTION': create-function. and not removed with *note 'DROP FUNCTION':
drop-function.  All active functions are reloaded each time the server
starts, unless you start *note 'mysqld': mysqld. with the
'--skip-grant-tables' option.  In this case, the server does not load
UDFs during startup and UDFs are unavailable.

*UDF Security Precautions*

MySQL takes several measures to prevent misuse of user-defined
functions.

UDF library files cannot be placed in arbitrary directories.  They must
be located in the server's plugin directory.  This directory is given by
the value of the 'plugin_dir' system variable.

To use *note 'CREATE FUNCTION': create-function. or *note 'DROP
FUNCTION': drop-function, you must have the 'INSERT' or 'DELETE'
privilege, respectively, for the 'mysql' database.  This is necessary
because those statements add and delete rows from the 'mysql.func'
table.

UDFs should have at least one symbol defined in addition to the 'xxx'
symbol that corresponds to the main 'xxx()' function.  These auxiliary
symbols correspond to the 'xxx_init()', 'xxx_deinit()', 'xxx_reset()',
'xxx_clear()', and 'xxx_add()' functions.  *note 'mysqld': mysqld. also
supports an '--allow-suspicious-udfs' option that controls whether UDFs
that have only an 'xxx' symbol can be loaded.  By default, the option is
disabled, to prevent attempts at loading functions from shared library
files other than those containing legitimate UDFs.  If you have older
UDFs that contain only the 'xxx' symbol and that cannot be recompiled to
include an auxiliary symbol, it may be necessary to specify the
'--allow-suspicious-udfs' option.  Otherwise, you should avoid enabling
it.


File: manual.info.tmp,  Node: adding-native-function,  Prev: adding-udf,  Up: adding-functions

24.4.3 Adding a Native Function
-------------------------------

To add a native MySQL function, use the procedure described here, which
requires that you use a source distribution.  You cannot add native
functions to a binary distribution because it is necessary to modify
MySQL source code and compile MySQL from the modified source.  If you
migrate to another version of MySQL (for example, when a new version is
released), you must repeat the procedure with the new version.

If the native function will be referred to in statements that will be
replicated to slave servers, you must ensure that every slave server
also has the function available.  Otherwise, replication will fail on
the slaves when they attempt to invoke the function.

To add a native function, follow these steps to modify source files in
the 'sql' directory:

  1. Create a subclass for the function in 'item_create.cc':

        * If the function takes a fixed number of arguments, create a
          subclass of 'Create_func_arg0', 'Create_func_arg1',
          'Create_func_arg2', or 'Create_func_arg3', respectively,
          depending on whether the function takes zero, one, two, or
          three arguments.  For examples, see the 'Create_func_uuid',
          'Create_func_abs', 'Create_func_pow', and 'Create_func_lpad'
          classes.

        * If the function takes a variable number of arguments, create a
          subclass of 'Create_native_func'.  For an example, see
          'Create_func_concat'.

  2. To provide a name by which the function can be referred to in SQL
     statements, register the name in 'item_create.cc' by adding a line
     to this array:

          static Native_func_registry func_array[]

     You can register several names for the same function.  For example,
     see the lines for '"LCASE"' and '"LOWER"', which are aliases for
     'Create_func_lcase'.

  3. In 'item_func.h', declare a class inheriting from 'Item_num_func'
     or 'Item_str_func', depending on whether your function returns a
     number or a string.

  4. In 'item_func.cc', add one of the following declarations, depending
     on whether you are defining a numeric or string function:

          double   Item_func_newname::val()
          longlong Item_func_newname::val_int()
          String  *Item_func_newname::Str(String *str)

     If you inherit your object from any of the standard items (like
     'Item_num_func'), you probably only have to define one of these
     functions and let the parent object take care of the other
     functions.  For example, the 'Item_str_func' class defines a
     'val()' function that executes 'atof()' on the value returned by
     '::str()'.

  5. If the function is nondeterministic, include the following
     statement in the item constructor to indicate that function results
     should not be cached:

          current_thd->lex->safe_to_cache_query=0;

     A function is nondeterministic if, given fixed values for its
     arguments, it can return different results for different
     invocations.

  6. You should probably also define the following object function:

          void Item_func_newname::fix_length_and_dec()

     This function should at least calculate 'max_length' based on the
     given arguments.  'max_length' is the maximum number of characters
     the function may return.  This function should also set 'maybe_null
     = 0' if the main function cannot return a 'NULL' value.  The
     function can check whether any of the function arguments can return
     'NULL' by checking the arguments' 'maybe_null' variable.  Look at
     'Item_func_mod::fix_length_and_dec' for a typical example of how to
     do this.

All functions must be thread-safe.  In other words, do not use any
global or static variables in the functions without protecting them with
mutexes.

If you want to return 'NULL' from '::val()', '::val_int()', or
'::str()', you should set 'null_value' to 1 and return 0.

For '::str()' object functions, these additional considerations apply:

   * The 'String *str' argument provides a string buffer that may be
     used to hold the result.  (For more information about the 'String'
     type, take a look at the 'sql_string.h' file.)

   * The '::str()' function should return the string that holds the
     result, or '(char*) 0' if the result is 'NULL'.

   * All current string functions try to avoid allocating any memory
     unless absolutely necessary!


File: manual.info.tmp,  Node: porting,  Prev: adding-functions,  Up: extending-mysql

24.5 Debugging and Porting MySQL
================================

* Menu:

* debugging-server::             Debugging a MySQL Server
* debugging-client::             Debugging a MySQL Client
* dbug-package::                 The DBUG Package

This section helps you port MySQL to other operating systems.  Do check
the list of currently supported operating systems first.  See
<https://www.mysql.com/support/supportedplatforms/database.html>.  If
you have created a new port of MySQL, please let us know so that we can
list it here and on our website (<http://www.mysql.com/>), recommending
it to other users.

*Note*:

If you create a new port of MySQL, you are free to copy and distribute
it under the GPL license, but it does not make you a copyright holder of
MySQL.

A working POSIX thread library is needed for the server.

To build MySQL from source, your system must satisfy the tool
requirements listed at *note source-installation::.

*Important*:

If you are trying to build MySQL 5.5 with 'icc' on the IA64 platform,
and need support for NDB Cluster, you should first ensure that you are
using 'icc' version 9.1.043 or later.  (For details, see Bug #21875.)

If you run into problems with a new port, you may have to do some
debugging of MySQL! See *note debugging-server::.

*Note*:

Before you start debugging *note 'mysqld': mysqld, first get the test
programs 'mysys/thr_alarm' and 'mysys/thr_lock' to work.  This ensures
that your thread installation has even a remote chance to work!


File: manual.info.tmp,  Node: debugging-server,  Next: debugging-client,  Prev: porting,  Up: porting

24.5.1 Debugging a MySQL Server
-------------------------------

* Menu:

* compiling-for-debugging::      Compiling MySQL for Debugging
* making-trace-files::           Creating Trace Files
* making-windows-dumps::         Using WER with PDB to create a Windows crashdump
* using-gdb-on-mysqld::          Debugging mysqld under gdb
* using-stack-trace::            Using a Stack Trace
* using-log-files::              Using Server Logs to Find Causes of Errors in mysqld
* reproducible-test-case::       Making a Test Case If You Experience Table Corruption

If you are using some functionality that is very new in MySQL, you can
try to run *note 'mysqld': mysqld. with the '--skip-new' option (which
disables all new, potentially unsafe functionality).  See *note
crashing::.

If *note 'mysqld': mysqld. does not want to start, verify that you have
no 'my.cnf' files that interfere with your setup!  You can check your
'my.cnf' arguments with *note 'mysqld --print-defaults': mysqld. and
avoid using them by starting with *note 'mysqld --no-defaults ...':
mysqld.

If *note 'mysqld': mysqld. starts to eat up CPU or memory or if it
'hangs,' you can use *note 'mysqladmin processlist status': mysqladmin.
to find out if someone is executing a query that takes a long time.  It
may be a good idea to run *note 'mysqladmin -i10 processlist status':
mysqladmin. in some window if you are experiencing performance problems
or problems when new clients cannot connect.

The command *note 'mysqladmin debug': mysqladmin. dumps some information
about locks in use, used memory and query usage to the MySQL log file.
This may help solve some problems.  This command also provides some
useful information even if you have not compiled MySQL for debugging!

If the problem is that some tables are getting slower and slower you
should try to optimize the table with *note 'OPTIMIZE TABLE':
optimize-table. or *note 'myisamchk': myisamchk.  See *note
server-administration::.  You should also check the slow queries with
*note 'EXPLAIN': explain.

You should also read the OS-specific section in this manual for problems
that may be unique to your environment.  See *note
general-installation-issues::.


File: manual.info.tmp,  Node: compiling-for-debugging,  Next: making-trace-files,  Prev: debugging-server,  Up: debugging-server

24.5.1.1 Compiling MySQL for Debugging
......................................

If you have some very specific problem, you can always try to debug
MySQL. To do this you must configure MySQL with the '-DWITH_DEBUG=1'
option.  You can check whether MySQL was compiled with debugging by
doing: *note 'mysqld --help': mysqld.  If the '--debug' flag is listed
with the options then you have debugging enabled.  *note 'mysqladmin
ver': mysqladmin. also lists the *note 'mysqld': mysqld. version as
*note 'mysql ... --debug': mysql. in this case.

If *note 'mysqld': mysqld. stops crashing when you configure it with the
'-DWITH_DEBUG=1' CMake option, you probably have found a compiler bug or
a timing bug within MySQL. In this case, you can try to add '-g' using
the 'CMAKE_C_FLAGS' and 'CMAKE_CXX_FLAGS' CMake options and not use
'-DWITH_DEBUG=1'.  If *note 'mysqld': mysqld. dies, you can at least
attach to it with 'gdb' or use 'gdb' on the core file to find out what
happened.

When you configure MySQL for debugging you automatically enable a lot of
extra safety check functions that monitor the health of *note 'mysqld':
mysqld.  If they find something 'unexpected,' an entry is written to
'stderr', which *note 'mysqld_safe': mysqld-safe. directs to the error
log!  This also means that if you are having some unexpected problems
with MySQL and are using a source distribution, the first thing you
should do is to configure MySQL for debugging.  If you believe that you
have found a bug, please use the instructions at *note bug-reports::.

In the Windows MySQL distribution, 'mysqld.exe' is by default compiled
with support for trace files.


File: manual.info.tmp,  Node: making-trace-files,  Next: making-windows-dumps,  Prev: compiling-for-debugging,  Up: debugging-server

24.5.1.2 Creating Trace Files
.............................

If the *note 'mysqld': mysqld. server does not start or it crashes
easily, you can try to create a trace file to find the problem.

To do this, you must have a *note 'mysqld': mysqld. that has been
compiled with debugging support.  You can check this by executing
'mysqld -V'.  If the version number ends with '-debug', it is compiled
with support for trace files.  (On Windows, the debugging server is
named *note 'mysqld-debug': mysqld. rather than *note 'mysqld': mysqld.)

Start the *note 'mysqld': mysqld. server with a trace log in
'/tmp/mysqld.trace' on Unix or '\mysqld.trace' on Windows:

     shell> mysqld --debug

On Windows, you should also use the '--standalone' flag to not start
*note 'mysqld': mysqld. as a service.  In a console window, use this
command:

     C:\> mysqld-debug --debug --standalone

After this, you can use the 'mysql.exe' command-line tool in a second
console window to reproduce the problem.  You can stop the *note
'mysqld': mysqld. server with *note 'mysqladmin shutdown': mysqladmin.

The trace file can become *very large*!  To generate a smaller trace
file, you can use debugging options something like this:

*note 'mysqld
--debug=d,info,error,query,general,where:O,/tmp/mysqld.trace': mysqld.

This only prints information with the most interesting tags to the trace
file.

If you file a bug, please add only those lines from the trace file to
the bug report that indicate where something seems to go wrong.  If you
cannot locate the wrong place, open a bug report and upload the whole
trace file to the report, so that a MySQL developer can take a look at
it.  For instructions, see *note bug-reports::.

The trace file is made with the *DBUG* package by Fred Fish.  See *note
dbug-package::.


File: manual.info.tmp,  Node: making-windows-dumps,  Next: using-gdb-on-mysqld,  Prev: making-trace-files,  Up: debugging-server

24.5.1.3 Using WER with PDB to create a Windows crashdump
.........................................................

Program Database (PDB) files (with file name suffix 'pdb') are included
in ZIP Archive distributions (but not MSI distributions) of MySQL. These
files provide information for debugging your MySQL installation in the
event of a problem.

*Note*:

The PDB files are available in a separate file labeled "ZIP Archive
Debug Binaries & Test Suite".

The PDB file contains more detailed information about 'mysqld' and other
tools that enables more detailed trace and dump files to be created.
You can use these with 'WinDbg' or Visual Studio to debug *note
'mysqld': mysqld.

For more information on PDB files, see Microsoft Knowledge Base Article
121366 (http://support.microsoft.com/kb/121366/).  For more information
on the debugging options available, see Debugging Tools for Windows
(http://www.microsoft.com/whdc/devtools/debugging/default.mspx).

To use WinDbg, either install the full Windows Driver Kit (WDK) or
install the standalone version.

*Important*:

The '.exe' and '.pdb' files must be an exact match (both version number
and MySQL server edition) or WinDBG will complain while attempting to
load the symbols.

  1. To generate a minidump 'mysqld.dmp', enable the 'core-file' option
     under the [mysqld] section in 'my.ini'.  Restart the MySQL server
     after making these changes.

  2. Create a directory to store the generated files, such as
     'c:\symbols'

  3. Determine the path to your 'windbg.exe' executable using the Find
     GUI or from the command line, for example: 'dir /s /b windbg.exe' -
     a common default is _C:\Program Files\Debugging Tools for Windows
     (x64)\windbg.exe_

  4. Launch 'windbg.exe' giving it the paths to 'mysqld.exe',
     'mysqld.pdb', 'mysqld.dmp', and the source code.  Alternatively,
     pass in each path from the WinDbg GUI. For example:

          windbg.exe -i "C:\mysql-5.5.62-winx64\bin\"^
           -z "C:\mysql-5.5.62-winx64\data\mysqld.dmp"^
           -srcpath "E:\ade\mysql_archives\5.5\5.5.62\mysql-5.5.62"^
           -y "C:\mysql-5.5.62-winx64\bin;SRV*c:\symbols*http://msdl.microsoft.com/download/symbols"^
           -v -n -c "!analyze -vvvvv"

     *Note*:

     The '^' character and newline are removed by the Windows command
     line processor, so be sure the spaces remain intact.


File: manual.info.tmp,  Node: using-gdb-on-mysqld,  Next: using-stack-trace,  Prev: making-windows-dumps,  Up: debugging-server

24.5.1.4 Debugging mysqld under gdb
...................................

On most systems you can also start *note 'mysqld': mysqld. from 'gdb' to
get more information if *note 'mysqld': mysqld. crashes.

With some older 'gdb' versions on Linux you must use 'run --one-thread'
if you want to be able to debug *note 'mysqld': mysqld. threads.  In
this case, you can only have one thread active at a time.

NPTL threads (the new thread library on Linux) may cause problems while
running *note 'mysqld': mysqld. under 'gdb'.  Some symptoms are:

   * *note 'mysqld': mysqld. hangs during startup (before it writes
     'ready for connections').

   * *note 'mysqld': mysqld. crashes during a 'pthread_mutex_lock()' or
     'pthread_mutex_unlock()' call.

In this case, you should set the following environment variable in the
shell before starting 'gdb':

     LD_ASSUME_KERNEL=2.4.1
     export LD_ASSUME_KERNEL

When running *note 'mysqld': mysqld. under 'gdb', you should disable the
stack trace with '--skip-stack-trace' to be able to catch segfaults
within 'gdb'.

Use the '--gdb' option to *note 'mysqld': mysqld. to install an
interrupt handler for 'SIGINT' (needed to stop *note 'mysqld': mysqld.
with '^C' to set breakpoints) and disable stack tracing and core file
handling.

It is very hard to debug MySQL under 'gdb' if you do a lot of new
connections the whole time as 'gdb' does not free the memory for old
threads.  You can avoid this problem by starting *note 'mysqld': mysqld.
with 'thread_cache_size' set to a value equal to 'max_connections' + 1.
In most cases just using '--thread_cache_size=5'' helps a lot!

If you want to get a core dump on Linux if *note 'mysqld': mysqld. dies
with a SIGSEGV signal, you can start *note 'mysqld': mysqld. with the
'--core-file' option.  This core file can be used to make a backtrace
that may help you find out why *note 'mysqld': mysqld. died:

     shell> gdb mysqld core
     gdb>   backtrace full
     gdb>   quit

See *note crashing::.

If you are using 'gdb' on Linux, you should install a '.gdb' file, with
the following information, in your current directory:

     set print sevenbit off
     handle SIGUSR1 nostop noprint
     handle SIGUSR2 nostop noprint
     handle SIGWAITING nostop noprint
     handle SIGLWP nostop noprint
     handle SIGPIPE nostop
     handle SIGALRM nostop
     handle SIGHUP nostop
     handle SIGTERM nostop noprint

Here is an example how to debug *note 'mysqld': mysqld.:

     shell> gdb /usr/local/libexec/mysqld
     gdb> run
     ...
     backtrace full # Do this when mysqld crashes

Include the preceding output in a bug report, which you can file using
the instructions in *note bug-reports::.

If *note 'mysqld': mysqld. hangs, you can try to use some system tools
like 'strace' or '/usr/proc/bin/pstack' to examine where *note 'mysqld':
mysqld. has hung.

     strace /tmp/log libexec/mysqld

If you are using the Perl 'DBI' interface, you can turn on debugging
information by using the 'trace' method or by setting the 'DBI_TRACE'
environment variable.


File: manual.info.tmp,  Node: using-stack-trace,  Next: using-log-files,  Prev: using-gdb-on-mysqld,  Up: debugging-server

24.5.1.5 Using a Stack Trace
............................

On some operating systems, the error log contains a stack trace if *note
'mysqld': mysqld. dies unexpectedly.  You can use this to find out where
(and maybe why) *note 'mysqld': mysqld. died.  See *note error-log::.
To get a stack trace, you must not compile *note 'mysqld': mysqld. with
the '-fomit-frame-pointer' option to gcc.  See *note
compiling-for-debugging::.

A stack trace in the error log looks something like this:

     mysqld got signal 11;
     Attempting backtrace. You can use the following information
     to find out where mysqld died. If you see no messages after
     this, something went terribly wrong...

     stack_bottom = 0x41fd0110 thread_stack 0x40000
     mysqld(my_print_stacktrace+0x32)[0x9da402]
     mysqld(handle_segfault+0x28a)[0x6648e9]
     /lib/libpthread.so.0[0x7f1a5af000f0]
     /lib/libc.so.6(strcmp+0x2)[0x7f1a5a10f0f2]
     mysqld(_Z21check_change_passwordP3THDPKcS2_Pcj+0x7c)[0x7412cb]
     mysqld(_ZN16set_var_password5checkEP3THD+0xd0)[0x688354]
     mysqld(_Z17sql_set_variablesP3THDP4ListI12set_var_baseE+0x68)[0x688494]
     mysqld(_Z21mysql_execute_commandP3THD+0x41a0)[0x67a170]
     mysqld(_Z11mysql_parseP3THDPKcjPS2_+0x282)[0x67f0ad]
     mysqld(_Z16dispatch_command19enum_server_commandP3THDPcj+0xbb7[0x67fdf8]
     mysqld(_Z10do_commandP3THD+0x24d)[0x6811b6]
     mysqld(handle_one_connection+0x11c)[0x66e05e]

If resolution of function names for the trace fails, the trace contains
less information:

     mysqld got signal 11;
     Attempting backtrace. You can use the following information
     to find out where mysqld died. If you see no messages after
     this, something went terribly wrong...

     stack_bottom = 0x41fd0110 thread_stack 0x40000
     [0x9da402]
     [0x6648e9]
     [0x7f1a5af000f0]
     [0x7f1a5a10f0f2]
     [0x7412cb]
     [0x688354]
     [0x688494]
     [0x67a170]
     [0x67f0ad]
     [0x67fdf8]
     [0x6811b6]
     [0x66e05e]

In the latter case, you can use the *note 'resolve_stack_dump':
resolve-stack-dump. utility to determine where *note 'mysqld': mysqld.
died by using the following procedure:

  1. Copy the numbers from the stack trace to a file, for example
     'mysqld.stack'.  The numbers should not include the surrounding
     square brackets:

          0x9da402
          0x6648e9
          0x7f1a5af000f0
          0x7f1a5a10f0f2
          0x7412cb
          0x688354
          0x688494
          0x67a170
          0x67f0ad
          0x67fdf8
          0x6811b6
          0x66e05e

  2. Make a symbol file for the *note 'mysqld': mysqld. server:

          shell> nm -n libexec/mysqld > /tmp/mysqld.sym

     If *note 'mysqld': mysqld. is not linked statically, use the
     following command instead:

          shell> nm -D -n libexec/mysqld > /tmp/mysqld.sym

     If you want to decode C++ symbols, use the '--demangle', if
     available, to 'nm'.  If your version of 'nm' does not have this
     option, you will need to use the 'c++filt' command after the stack
     dump has been produced to demangle the C++ names.

  3. Execute the following command:

          shell> resolve_stack_dump -s /tmp/mysqld.sym -n mysqld.stack

     If you were not able to include demangled C++ names in your symbol
     file, process the *note 'resolve_stack_dump': resolve-stack-dump.
     output using 'c++filt':

          shell> resolve_stack_dump -s /tmp/mysqld.sym -n mysqld.stack | c++filt

     This prints out where *note 'mysqld': mysqld. died.  If that does
     not help you find out why *note 'mysqld': mysqld. died, you should
     create a bug report and include the output from the preceding
     command with the bug report.

     However, in most cases it does not help us to have just a stack
     trace to find the reason for the problem.  To be able to locate the
     bug or provide a workaround, in most cases we need to know the
     statement that killed *note 'mysqld': mysqld. and preferably a test
     case so that we can repeat the problem!  See *note bug-reports::.

Newer versions of 'glibc' stack trace functions also print the address
as relative to the object.  On 'glibc'-based systems (Linux), the trace
for a crash within a plugin looks something like:

     plugin/auth/auth_test_plugin.so(+0x9a6)[0x7ff4d11c29a6]

To translate the relative address ('+0x9a6') into a file name and line
number, use this command:

     shell> addr2line -fie auth_test_plugin.so 0x9a6
     auth_test_plugin
     mysql-trunk/plugin/auth/test_plugin.c:65

The 'addr2line' utility is part of the 'binutils' package on Linux.

On Solaris, the procedure is similar.  The Solaris 'printstack()'
already prints relative addresses:

     plugin/auth/auth_test_plugin.so:0x1510

To translate, use this command:

     shell> gaddr2line -fie auth_test_plugin.so 0x1510
     mysql-trunk/plugin/auth/test_plugin.c:88

Windows already prints the address, function name and line:

     000007FEF07E10A4 auth_test_plugin.dll!auth_test_plugin()[test_plugin.c:72]


File: manual.info.tmp,  Node: using-log-files,  Next: reproducible-test-case,  Prev: using-stack-trace,  Up: debugging-server

24.5.1.6 Using Server Logs to Find Causes of Errors in mysqld
.............................................................

Note that before starting *note 'mysqld': mysqld. with the general query
log enabled, you should check all your tables with *note 'myisamchk':
myisamchk.  See *note server-administration::.

If *note 'mysqld': mysqld. dies or hangs, you should start *note
'mysqld': mysqld. with the general query log enabled.  See *note
query-log::.  When *note 'mysqld': mysqld. dies again, you can examine
the end of the log file for the query that killed *note 'mysqld':
mysqld.

If you use the default general query log file, the log is stored in the
database directory as 'HOST_NAME.log' In most cases it is the last query
in the log file that killed *note 'mysqld': mysqld, but if possible you
should verify this by restarting *note 'mysqld': mysqld. and executing
the found query from the *note 'mysql': mysql. command-line tools.  If
this works, you should also test all complicated queries that did not
complete.

You can also try the command *note 'EXPLAIN': explain. on all *note
'SELECT': select. statements that takes a long time to ensure that *note
'mysqld': mysqld. is using indexes properly.  See *note explain::.

You can find the queries that take a long time to execute by starting
*note 'mysqld': mysqld. with the slow query log enabled.  See *note
slow-query-log::.

If you find the text 'mysqld restarted' in the error log (normally a
file named 'HOST_NAME.err') you probably have found a query that causes
*note 'mysqld': mysqld. to fail.  If this happens, you should check all
your tables with *note 'myisamchk': myisamchk. (see *note
server-administration::), and test the queries in the MySQL log files to
see whether one fails.  If you find such a query, try first upgrading to
the newest MySQL version.  If this does not help, report a bug, see
*note bug-reports::.

If you have started *note 'mysqld': mysqld. with the
'myisam_recover_options' system variable set, MySQL automatically checks
and tries to repair 'MyISAM' tables if they are marked as 'not closed
properly' or 'crashed'.  If this happens, MySQL writes an entry in the
'hostname.err' file ''Warning: Checking table ...'' which is followed by
'Warning: Repairing table' if the table needs to be repaired.  If you
get a lot of these errors, without *note 'mysqld': mysqld. having died
unexpectedly just before, then something is wrong and needs to be
investigated further.  See *note server-options::.

When the server detects 'MyISAM' table corruption, it writes additional
information to the error log, such as the name and line number of the
source file, and the list of threads accessing the table.  Example: 'Got
an error from thread_id=1, mi_dynrec.c:368'.  This is useful information
to include in bug reports.

It is not a good sign if *note 'mysqld': mysqld. did die unexpectedly,
but in this case, you should not investigate the 'Checking table...'
messages, but instead try to find out why *note 'mysqld': mysqld. died.


File: manual.info.tmp,  Node: reproducible-test-case,  Prev: using-log-files,  Up: debugging-server

24.5.1.7 Making a Test Case If You Experience Table Corruption
..............................................................

The following procedure applies to *note 'MyISAM':
myisam-storage-engine. tables.  For information about steps to take when
encountering 'InnoDB' table corruption, see *note bug-reports::.

If you encounter corrupted *note 'MyISAM': myisam-storage-engine. tables
or if *note 'mysqld': mysqld. always fails after some update statements,
you can test whether the issue is reproducible by doing the following:

  1. Stop the MySQL daemon with *note 'mysqladmin shutdown': mysqladmin.

  2. Make a backup of the tables to guard against the very unlikely case
     that the repair does something bad.

  3. Check all tables with *note 'myisamchk -s database/*.MYI':
     myisamchk.  Repair any corrupted tables with *note 'myisamchk -r
     database/TABLE.MYI': myisamchk.

  4. Make a second backup of the tables.

  5. Remove (or move away) any old log files from the MySQL data
     directory if you need more space.

  6. Start *note 'mysqld': mysqld. with the binary log enabled.  If you
     want to find a statement that crashes *note 'mysqld': mysqld, you
     should start the server with the general query log enabled as well.
     See *note query-log::, and *note binary-log::.

  7. When you have gotten a crashed table, stop the *note 'mysqld':
     mysqld. server.

  8. Restore the backup.

  9. Restart the *note 'mysqld': mysqld. server _without_ the binary log
     enabled.

  10. Re-execute the statements with *note 'mysqlbinlog binary-log-file
     | mysql': mysqlbinlog.  The binary log is saved in the MySQL
     database directory with the name 'hostname-bin.NNNNNN'.

  11. If the tables are corrupted again or you can get *note 'mysqld':
     mysqld. to die with the above command, you have found a
     reproducible bug.  FTP the tables and the binary log to our bugs
     database using the instructions given in *note bug-reports::.  If
     you are a support customer, you can use the MySQL Customer Support
     Center (<https://www.mysql.com/support/>) to alert the MySQL team
     about the problem and have it fixed as soon as possible.

You can also use the script *note 'mysql_find_rows': mysql-find-rows. to
just execute some of the update statements if you want to narrow down
the problem.


File: manual.info.tmp,  Node: debugging-client,  Next: dbug-package,  Prev: debugging-server,  Up: porting

24.5.2 Debugging a MySQL Client
-------------------------------

To be able to debug a MySQL client with the integrated debug package,
you should configure MySQL with '-DWITH_DEBUG=1'.  See *note
source-configuration-options::.

Before running a client, you should set the 'MYSQL_DEBUG' environment
variable:

     shell> MYSQL_DEBUG=d:t:O,/tmp/client.trace
     shell> export MYSQL_DEBUG

This causes clients to generate a trace file in '/tmp/client.trace'.

If you have problems with your own client code, you should attempt to
connect to the server and run your query using a client that is known to
work.  Do this by running *note 'mysql': mysql. in debugging mode
(assuming that you have compiled MySQL with debugging on):

     shell> mysql --debug=d:t:O,/tmp/client.trace

This provides useful information in case you mail a bug report.  See
*note bug-reports::.

If your client crashes at some 'legal' looking code, you should check
that your 'mysql.h' include file matches your MySQL library file.  A
very common mistake is to use an old 'mysql.h' file from an old MySQL
installation with new MySQL library.


File: manual.info.tmp,  Node: dbug-package,  Prev: debugging-client,  Up: porting

24.5.3 The DBUG Package
-----------------------

The MySQL server and most MySQL clients are compiled with the DBUG
package originally created by Fred Fish.  When you have configured MySQL
for debugging, this package makes it possible to get a trace file of
what the program is doing.  See *note making-trace-files::.

This section summarizes the argument values that you can specify in
debug options on the command line for MySQL programs that have been
built with debugging support.

The DBUG package can be used by invoking a program with the
'--debug[=DEBUG_OPTIONS]' or '-# [DEBUG_OPTIONS]' option.  If you
specify the '--debug' or '-#' option without a DEBUG_OPTIONS value, most
MySQL programs use a default value.  The server default is
'd:t:i:o,/tmp/mysqld.trace' on Unix and 'd:t:i:O,\mysqld.trace' on
Windows.  The effect of this default is:

   * 'd': Enable output for all debug macros

   * 't': Trace function calls and exits

   * 'i': Add PID to output lines

   * 'o,/tmp/mysqld.trace', 'O,\mysqld.trace': Set the debug output
     file.

Most client programs use a default DEBUG_OPTIONS value of
'd:t:o,/tmp/PROGRAM_NAME.trace', regardless of platform.

Here are some example debug control strings as they might be specified
on a shell command line:

     --debug=d:t
     --debug=d:f,main,subr1:F:L:t,20
     --debug=d,input,output,files:n
     --debug=d:t:i:O,\\mysqld.trace

For *note 'mysqld': mysqld, it is also possible to change DBUG settings
at runtime by setting the 'debug' system variable.  This variable has
global and session values:

     mysql> SET GLOBAL debug = 'DEBUG_OPTIONS';
     mysql> SET SESSION debug = 'DEBUG_OPTIONS';

Changing the global 'debug' value requires privileges sufficient to set
global system variables.  Changing the session 'debug' value requires
privileges sufficient to set restricted session system variables.  See
*note system-variable-privileges::.

The DEBUG_OPTIONS value is a sequence of colon-separated fields:

     field_1:field_2:...:field_N

Each field within the value consists of a mandatory flag character,
optionally preceded by a '+' or '-' character, and optionally followed
by a comma-delimited list of modifiers:

     [+|-]flag[,modifier,modifier,...,modifier]

The following table describes the permitted flag characters.
Unrecognized flag characters are silently ignored.

Flag                                                       Description
                                                           
                                                           
'd'                                                        Enable output from DBUG_XXX macros for the current state.  May
                                                           be followed by a list of keywords, which enables output only for
                                                           the DBUG macros with that keyword.  An empty list of keywords
                                                           enables output for all macros.
                                                           
                                                           In MySQL, common debug macro keywords to enable are 'enter',
                                                           'exit', 'error', 'warning', 'info', and 'loop'.
                                                           
                                                           
'D'                                                        Delay after each debugger output line.  The argument is the
                                                           delay, in tenths of seconds, subject to machine capabilities.
                                                           For example, 'D,20' specifies a delay of two seconds.
                                                           
                                                           
'f'                                                        Limit debugging, tracing, and profiling to the list of named
                                                           functions.  An empty list enables all functions.  The
                                                           appropriate 'd' or 't' flags must still be given; this flag only
                                                           limits their actions if they are enabled.
                                                           
                                                           
'F'                                                        Identify the source file name for each line of debug or trace
                                                           output.
                                                           
                                                           
'i'                                                        Identify the process with the PID or thread ID for each line of
                                                           debug or trace output.
                                                           
                                                           
'L'                                                        Identify the source file line number for each line of debug or
                                                           trace output.
                                                           
                                                           
'n'                                                        Print the current function nesting depth for each line of debug
                                                           or trace output.
                                                           
                                                           
'N'                                                        Number each line of debug output.
                                                           
                                                           
'o'                                                        Redirect the debugger output stream to the specified file.  The
                                                           default output is 'stderr'.
                                                           
                                                           
'O'                                                        Like 'o', but the file is really flushed between each write.
                                                           When needed, the file is closed and reopened between each write.
                                                           
                                                           
'p'                                                        Limit debugger actions to specified processes.  A process must
                                                           be identified with the 'DBUG_PROCESS' macro and match one in the
                                                           list for debugger actions to occur.
                                                           
                                                           
'P'                                                        Print the current process name for each line of debug or trace
                                                           output.
                                                           
                                                           
'r'                                                        When pushing a new state, do not inherit the previous state's
                                                           function nesting level.  Useful when the output is to start at
                                                           the left margin.
                                                           
                                                           
'S'                                                        Do function '_sanity(_file_,_line_)' at each debugged function
                                                           until '_sanity()' returns something that differs from 0.
                                                           
                                                           
't'                                                        Enable function call/exit trace lines.  May be followed by a
                                                           list (containing only one modifier) giving a numeric maximum
                                                           trace level, beyond which no output occurs for either debugging
                                                           or tracing macros.  The default is a compile time option.

The leading '+' or '-' character and trailing list of modifiers are used
for flag characters such as 'd' or 'f' that can enable a debug operation
for all applicable modifiers or just some of them:

   * With no leading '+' or '-', the flag value is set to exactly the
     modifier list as given.

   * With a leading '+' or '-', the modifiers in the list are added to
     or subtracted from the current modifier list.

The following examples show how this works for the 'd' flag.  An empty
'd' list enabled output for all debug macros.  A nonempty list enables
output only for the macro keywords in the list.

These statements set the 'd' value to the modifier list as given:

     mysql> SET debug = 'd';
     mysql> SELECT @@debug;
     +---------+
     | @@debug |
     +---------+
     | d       |
     +---------+
     mysql> SET debug = 'd,error,warning';
     mysql> SELECT @@debug;
     +-----------------+
     | @@debug         |
     +-----------------+
     | d,error,warning |
     +-----------------+

A leading '+' or '-' adds to or subtracts from the current 'd' value:

     mysql> SET debug = '+d,loop';
     mysql> SELECT @@debug;
     +----------------------+
     | @@debug              |
     +----------------------+
     | d,error,warning,loop |
     +----------------------+
     mysql> SET debug = '-d,error,loop';
     mysql> SELECT @@debug;
     +-----------+
     | @@debug   |
     +-----------+
     | d,warning |
     +-----------+

Adding to 'all macros enabled' results in no change:

     mysql> SET debug = 'd';
     mysql> SELECT @@debug;
     +---------+
     | @@debug |
     +---------+
     | d       |
     +---------+
     mysql> SET debug = '+d,loop';
     mysql> SELECT @@debug;
     +---------+
     | @@debug |
     +---------+
     | d       |
     +---------+

Disabling all enabled macros disables the 'd' flag entirely:

     mysql> SET debug = 'd,error,loop';
     mysql> SELECT @@debug;
     +--------------+
     | @@debug      |
     +--------------+
     | d,error,loop |
     +--------------+
     mysql> SET debug = '-d,error,loop';
     mysql> SELECT @@debug;
     +---------+
     | @@debug |
     +---------+
     |         |
     +---------+

*Note*:

The '+' and '-' modifiers are not always handled correctly and can leave
a flag value in an incorrect state.  Verify your 'debug'-setting
sequence in advance or set it without using '+' or '-'.


File: manual.info.tmp,  Node: mysql-enterprise,  Next: workbench,  Prev: extending-mysql,  Up: Top

25 MySQL Enterprise Edition
***************************

* Menu:

* mysql-enterprise-monitor::     MySQL Enterprise Monitor Overview
* mysql-enterprise-backup::      MySQL Enterprise Backup Overview
* mysql-enterprise-security::    MySQL Enterprise Security Overview
* mysql-enterprise-encryption::  MySQL Enterprise Encryption Overview
* mysql-enterprise-audit::       MySQL Enterprise Audit Overview
* mysql-enterprise-firewall::    MySQL Enterprise Firewall Overview
* mysql-enterprise-thread-pool::  MySQL Enterprise Thread Pool Overview
* mysql-enterprise-data-masking::  MySQL Enterprise Data Masking and De-Identification Overview

MySQL Enterprise Edition is a commercial product.  Like MySQL Community
Edition, MySQL Enterprise Edition includes MySQL Server, a fully
integrated transaction-safe, ACID-compliant database with full commit,
rollback, crash-recovery, and row-level locking capabilities.  In
addition, MySQL Enterprise Edition includes the following components
designed to provide monitoring and online backup, as well as improved
security and scalability:

The following sections briefly discuss each of these components and
indicate where to find more detailed information.  To learn more about
commercial products, see <https://www.mysql.com/products/>.

   * *note MySQL Enterprise Monitor: mysql-enterprise-monitor.

   * *note MySQL Enterprise Backup: mysql-enterprise-backup.

   * *note MySQL Enterprise Security: mysql-enterprise-security.

   * *note MySQL Enterprise Encryption: mysql-enterprise-encryption.

   * *note MySQL Enterprise Audit: mysql-enterprise-audit.

   * *note MySQL Enterprise Firewall: mysql-enterprise-firewall.

   * *note MySQL Enterprise Thread Pool: mysql-enterprise-thread-pool.

   * *note MySQL Enterprise Data Masking and De-Identification:
     mysql-enterprise-data-masking.


File: manual.info.tmp,  Node: mysql-enterprise-monitor,  Next: mysql-enterprise-backup,  Prev: mysql-enterprise,  Up: mysql-enterprise

25.1 MySQL Enterprise Monitor Overview
======================================

MySQL Enterprise Monitor is an enterprise monitoring system for MySQL
that keeps an eye on your MySQL servers, notifies you of potential
issues and problems, and advises you how to fix the issues.  MySQL
Enterprise Monitor can monitor all kinds of configurations, from a
single MySQL server that is important to your business, all the way up
to a huge farm of MySQL servers powering a busy website.

The following discussion briefly summarizes the basic components that
make up the MySQL Enterprise Monitor product.  For more information, see
the MySQL Enterprise Monitor manual, available at
<https://dev.mysql.com/doc/mysql-monitor/en/>.

MySQL Enterprise Monitor components can be installed in various
configurations depending on your database and network topology, to give
you the best combination of reliable and responsive monitoring data,
with minimal overhead on the database server machines.  A typical MySQL
Enterprise Monitor installation consists of:

   * One or more MySQL servers to monitor.  MySQL Enterprise Monitor can
     monitor both Community and Enterprise MySQL server releases.

   * A MySQL Enterprise Monitor Agent for each monitored host.

   * A single MySQL Enterprise Service Manager, which collates
     information from the agents and provides the user interface to the
     collected data.

MySQL Enterprise Monitor is designed to monitor one or more MySQL
servers.  The monitoring information is collected by using an agent,
_MySQL Enterprise Monitor Agent_.  The agent communicates with the hosts
and MySQL servers that it monitors, collecting variables, status and
health information, and sending this information to the MySQL Enterprise
Service Manager.

The information collected by the agent about each MySQL server and host
you are monitoring is sent to the _MySQL Enterprise Service Manager_.
This server collates all of the information from the agents.  As it
collates the information sent by the agents, the MySQL Enterprise
Service Manager continually tests the collected data, comparing the
status of the server to reasonable values.  When thresholds are reached,
the server can trigger an event (including an alarm and notification) to
highlight a potential issue, such as low memory, high CPU usage, or more
complex conditions such insufficient buffer sizes and status
information.  We call each test, with its associated threshold value, a
_rule_.

These rules, and the alarms and notifications, are each known as a
_MySQL Enterprise Advisors_.  Advisors form a critical part of the MySQL
Enterprise Service Manager, as they provide warning information and
troubleshooting advice about potential problems.

The MySQL Enterprise Service Manager includes a web server, and you
interact with it through any web browser.  This interface, the MySQL
Enterprise Monitor User Interface, displays all of the information
collected by the agents, and lets you view all of your servers and their
current status as a group or individually.  You control and configure
all aspects of the service using the MySQL Enterprise Monitor User
Interface.

The information supplied by the MySQL Enterprise Monitor Agent processes
also includes statistical and query information, which you can view in
the form of graphs.  For example, you can view aspects such as server
load, query numbers, or index usage information as a graph over time.
The graph lets you pinpoint problems or potential issues on your server,
and can help diagnose the impact from database or external problems
(such as external system or network failure) by examining the data from
a specific time interval.

The MySQL Enterprise Monitor Agent can also be configured to collect
detailed information about the queries executed on your server,
including the row counts and performance times for executing each query.
You can correlate the detailed query data with the graphical information
to identify which queries were executing when you experienced a
particularly high load, index or other issue.  The query data is
supported by a system called Query Analyzer, and the data can be
presented in different ways depending on your needs.


File: manual.info.tmp,  Node: mysql-enterprise-backup,  Next: mysql-enterprise-security,  Prev: mysql-enterprise-monitor,  Up: mysql-enterprise

25.2 MySQL Enterprise Backup Overview
=====================================

MySQL Enterprise Backup performs hot backup operations for MySQL
databases.  The product is architected for efficient and reliable
backups of tables created by the InnoDB storage engine.  For
completeness, it can also back up tables from MyISAM and other storage
engines.

The following discussion briefly summarizes MySQL Enterprise Backup.
For more information, see the MySQL Enterprise Backup manual, available
at <https://dev.mysql.com/doc/mysql-enterprise-backup/en/>.

Hot backups are performed while the database is running and applications
are reading and writing to it.  This type of backup does not block
normal database operations, and it captures even changes that occur
while the backup is happening.  For these reasons, hot backups are
desirable when your database 'grows up' - when the data is large enough
that the backup takes significant time, and when your data is important
enough to your business that you must capture every last change, without
taking your application, website, or web service offline.

MySQL Enterprise Backup does a hot backup of all tables that use the
InnoDB storage engine.  For tables using MyISAM or other non-InnoDB
storage engines, it does a 'warm' backup, where the database continues
to run, but those tables cannot be modified while being backed up.  For
efficient backup operations, you can designate InnoDB as the default
storage engine for new tables, or convert existing tables to use the
InnoDB storage engine.


File: manual.info.tmp,  Node: mysql-enterprise-security,  Next: mysql-enterprise-encryption,  Prev: mysql-enterprise-backup,  Up: mysql-enterprise

25.3 MySQL Enterprise Security Overview
=======================================

MySQL Enterprise Edition provides plugins that implement security
features using external services:

   * MySQL Enterprise Edition includes an authentication plugin that
     enables MySQL Server to use PAM (Pluggable Authentication Modules)
     to authenticate MySQL users.  PAM enables a system to use a
     standard interface to access various kinds of authentication
     methods, such as Unix passwords or an LDAP directory.  For more
     information, see *note pam-pluggable-authentication::.

   * MySQL Enterprise Edition includes an authentication plugin that
     performs external authentication on Windows, enabling MySQL Server
     to use native Windows services to authenticate client connections.
     Users who have logged in to Windows can connect from MySQL client
     programs to the server based on the information in their
     environment without specifying an additional password.  For more
     information, see *note windows-pluggable-authentication::.

   * MySQL Enterprise Edition 5.6 and higher includes a set of
     encryption functions based on the OpenSSL library that expose
     OpenSSL capabilities at the SQL level.  These functions enable
     masking existing data using several methods such as obfuscation
     (removing identifying characteristics), generation of formatted
     random data, and data replacement or substitution.  For more
     information, see *note mysql-enterprise-encryption::.

   * MySQL Enterprise Edition 5.7 and higher includes a keyring plugin
     that uses Oracle Key Vault as a back end for keyring storage.  For
     more information, see The MySQL Keyring
     (https://dev.mysql.com/doc/refman/5.7/en/keyring.html).

For other related Enterprise security features, see *note
mysql-enterprise-encryption::.


File: manual.info.tmp,  Node: mysql-enterprise-encryption,  Next: mysql-enterprise-audit,  Prev: mysql-enterprise-security,  Up: mysql-enterprise

25.4 MySQL Enterprise Encryption Overview
=========================================

MySQL Enterprise Edition 5.6 and higher includes a set of encryption
functions based on the OpenSSL library that expose OpenSSL capabilities
at the SQL level.  These functions enable Enterprise applications to
perform the following operations:

   * Implement added data protection using public-key asymmetric
     cryptography

   * Create public and private keys and digital signatures

   * Perform asymmetric encryption and decryption

   * Use cryptographic hashing for digital signing and data verification
     and validation

For more information, see MySQL Enterprise Encryption Functions
(https://dev.mysql.com/doc/refman/5.6/en/enterprise-encryption.html).

For other related Enterprise security features, see *note
mysql-enterprise-security::.


File: manual.info.tmp,  Node: mysql-enterprise-audit,  Next: mysql-enterprise-firewall,  Prev: mysql-enterprise-encryption,  Up: mysql-enterprise

25.5 MySQL Enterprise Audit Overview
====================================

MySQL Enterprise Edition includes MySQL Enterprise Audit, implemented
using a server plugin.  MySQL Enterprise Audit uses the open MySQL Audit
API to enable standard, policy-based monitoring and logging of
connection and query activity executed on specific MySQL servers.
Designed to meet the Oracle audit specification, MySQL Enterprise Audit
provides an out of box, easy to use auditing and compliance solution for
applications that are governed by both internal and external regulatory
guidelines.

When installed, the audit plugin enables MySQL Server to produce a log
file containing an audit record of server activity.  The log contents
include when clients connect and disconnect, and what actions they
perform while connected, such as which databases and tables they access.

For more information, see *note audit-log::.


File: manual.info.tmp,  Node: mysql-enterprise-firewall,  Next: mysql-enterprise-thread-pool,  Prev: mysql-enterprise-audit,  Up: mysql-enterprise

25.6 MySQL Enterprise Firewall Overview
=======================================

MySQL Enterprise Edition 5.6 and higher includes MySQL Enterprise
Firewall, an application-level firewall that enables database
administrators to permit or deny SQL statement execution based on
matching against whitelists of accepted statement patterns.  This helps
harden MySQL Server against attacks such as SQL injection or attempts to
exploit applications by using them outside of their legitimate query
workload characteristics.

Each MySQL account registered with the firewall has its own statement
whitelist, enabling protection to be tailored per account.  For a given
account, the firewall can operate in recording or protecting mode, for
training in the accepted statement patterns or protection against
unacceptable statements.

For more information, see MySQL Enterprise Firewall
(https://dev.mysql.com/doc/refman/5.6/en/firewall.html).


File: manual.info.tmp,  Node: mysql-enterprise-thread-pool,  Next: mysql-enterprise-data-masking,  Prev: mysql-enterprise-firewall,  Up: mysql-enterprise

25.7 MySQL Enterprise Thread Pool Overview
==========================================

MySQL Enterprise Edition includes MySQL Enterprise Thread Pool,
implemented using a server plugin.  The default thread-handling model in
MySQL Server executes statements using one thread per client connection.
As more clients connect to the server and execute statements, overall
performance degrades.  In MySQL Enterprise Edition, a thread pool plugin
provides an alternative thread-handling model designed to reduce
overhead and improve performance.  The plugin implements a thread pool
that increases server performance by efficiently managing statement
execution threads for large numbers of client connections.

For more information, see *note thread-pool::.


File: manual.info.tmp,  Node: mysql-enterprise-data-masking,  Prev: mysql-enterprise-thread-pool,  Up: mysql-enterprise

25.8 MySQL Enterprise Data Masking and De-Identification Overview
=================================================================

MySQL Enterprise Edition 5.7 and higher includes MySQL Enterprise Data
Masking and De-Identification, implemented as a plugin library
containing a plugin and a set of user-defined functions.  Data masking
hides sensitive information by replacing real values with substitutes.
MySQL Enterprise Data Masking and De-Identification functions enable
masking existing data using several methods such as obfuscation
(removing identifying characteristics), generation of formatted random
data, and data replacement or substitution.

For more information, see MySQL Enterprise Data Masking and
De-Identification
(https://dev.mysql.com/doc/refman/5.7/en/data-masking.html).


File: manual.info.tmp,  Node: workbench,  Next: faqs,  Prev: mysql-enterprise,  Up: Top

26 MySQL Workbench
******************

MySQL Workbench provides a graphical tool for working with MySQL servers
and databases.  MySQL Workbench fully supports MySQL versions 5.5 and
higher.

The following discussion briefly describes MySQL Workbench capabilities.
For more information, see the MySQL Workbench manual, available at
<https://dev.mysql.com/doc/workbench/en/>.

MySQL Workbench provides five main areas of functionality:

   * *SQL Development*: Enables you to create and manage connections to
     database servers.  As well as enabling you to configure connection
     parameters, MySQL Workbench provides the capability to execute SQL
     queries on the database connections using the built-in SQL Editor.
     This functionality replaces that previously provided by the Query
     Browser standalone application.

   * *Data Modeling*: Enables you to create models of your database
     schema graphically, reverse and forward engineer between a schema
     and a live database, and edit all aspects of your database using
     the comprehensive Table Editor.  The Table Editor provides
     easy-to-use facilities for editing Tables, Columns, Indexes,
     Triggers, Partitioning, Options, Inserts and Privileges, Routines
     and Views.

   * *Server Administration*: Enables you to create and administer
     server instances.

   * *Data Migration*: Allows you to migrate from Microsoft SQL Server,
     Sybase ASE, SQLite, SQL Anywhere, PostreSQL, and other RDBMS
     tables, objects and data to MySQL. Migration also supports
     migrating from earlier versions of MySQL to the latest releases.

   * *MySQL Enterprise Support*: Support for Enterprise products such as
     MySQL Enterprise Backup and MySQL Audit.

MySQL Workbench is available in two editions, the Community Edition and
the Commercial Edition.  The Community Edition is available free of
charge.  The Commercial Edition provides additional Enterprise features,
such as database documentation generation, at low cost.


File: manual.info.tmp,  Node: faqs,  Next: error-handling,  Prev: workbench,  Up: Top

Appendix A MySQL 5.5 Frequently Asked Questions
***********************************************

* Menu:

* faqs-general::                 MySQL 5.5 FAQ: General
* faqs-storage-engines::         MySQL 5.5 FAQ: Storage Engines
* faqs-sql-modes::               MySQL 5.5 FAQ: Server SQL Mode
* faqs-stored-procs::            MySQL 5.5 FAQ: Stored Procedures and Functions
* faqs-triggers::                MySQL 5.5 FAQ: Triggers
* faqs-views::                   MySQL 5.5 FAQ: Views
* faqs-information-schema::      MySQL 5.5 FAQ: INFORMATION_SCHEMA
* faqs-migration::               MySQL 5.5 FAQ: Migration
* faqs-security::                MySQL 5.5 FAQ: Security
* faqs-mysql-cluster::           MySQL FAQ: MySQL 5.5 and NDB Cluster
* faqs-cjk::                     MySQL 5.5 FAQ: MySQL Chinese, Japanese, and Korean Character Sets
* faqs-connectors-apis::         MySQL 5.5 FAQ: Connectors & APIs
* faqs-c-api::                   MySQL 5.5 FAQ: C API, libmysql
* faqs-replication::             MySQL 5.5 FAQ: Replication
* faqs-thread-pool::             MySQL 5.5 FAQ: MySQL Enterprise Thread Pool
* faqs-innodb-change-buffer::    MySQL 5.5 FAQ: InnoDB Change Buffer
* faqs-virtualization::          MySQL 5.5 FAQ: Virtualization Support


File: manual.info.tmp,  Node: faqs-general,  Next: faqs-storage-engines,  Prev: faqs,  Up: faqs

A.1 MySQL 5.5 FAQ: General
==========================

Which version of MySQL is production-ready (GA)?

MySQL 8.0, 5.7, and MySQL 5.6 are supported for production use.

MySQL 8.0 achieved General Availability (GA) status with MySQL 8.0.11,
which was released for production use on 19 April 2018.

MySQL 5.7 achieved General Availability (GA) status with MySQL 5.7.9,
which was released for production use on 21 October 2015.

MySQL 5.6 achieved General Availability (GA) status with MySQL 5.6.10,
which was released for production use on 5 February 2013.

MySQL 5.5 achieved General Availability (GA) status with MySQL 5.5.8,
which was released for production use on 3 December 2010.  The MySQL 5.5
series is no longer current, but still supported in production.

MySQL 5.1 achieved General Availability (GA) status with MySQL 5.1.30,
which was released for production use on 14 November 2008.  Active
development for MySQL 5.1 has ended.

MySQL 5.0 achieved General Availability (GA) status with MySQL 5.0.15,
which was released for production use on 19 October 2005.  Active
development for MySQL 5.0 has ended.

Can MySQL 5.5 do subqueries?

Yes.  See *note subqueries::.

Can MySQL 5.5 perform multiple-table inserts, updates, and deletes?

Yes.  For the syntax required to perform multiple-table updates, see
*note update::; for that required to perform multiple-table deletes, see
*note delete::.

A multiple-table insert can be accomplished using a trigger whose 'FOR
EACH ROW' clause contains multiple *note 'INSERT': insert. statements
within a 'BEGIN ... END' block.  See *note triggers::.

Does MySQL 5.5 have a Query Cache?  Does it work on Server, Instance or
Database?

Yes.  The query cache operates on the server level, caching complete
result sets matched with the original query string.  If an exactly
identical query is made (which often happens, particularly in web
applications), no parsing or execution is necessary; the result is sent
directly from the cache.  Various tuning options are available.  See
*note query-cache::.

Does MySQL 5.5 have Sequences?

No.  However, MySQL has an 'AUTO_INCREMENT' system, which in MySQL 5.5
can also handle inserts in a multi-master replication setup.  With the
'auto_increment_increment' and 'auto_increment_offset' system variables,
you can set each server to generate auto-increment values that don't
conflict with other servers.  The 'auto_increment_increment' value
should be greater than the number of servers, and each server should
have a unique offset.

Does MySQL 5.5 have a 'NOW()' function with fractions of seconds?

No, but support was added in 5.6.4.

Also, MySQL does parse time strings with a fractional component.  See
*note time::.

Does MySQL 5.5 work with multi-core processors?

Yes.  MySQL is fully multithreaded, and will make use of multiple CPUs,
provided that the operating system supports them.

Why do I see multiple processes for 'mysqld'?

When using LinuxThreads, you should see a minimum of three *note
'mysqld': mysqld. processes running.  These are in fact threads.  There
is one thread for the LinuxThreads manager, one thread to handle
connections, and one thread to handle alarms and signals.

Can MySQL 5.5 perform ACID transactions?

Yes.  All current MySQL versions support transactions.  The 'InnoDB'
storage engine offers full ACID transactions with row-level locking,
multi-versioning, nonlocking repeatable reads, and all four SQL standard
isolation levels.

The *note 'NDB': mysql-cluster. storage engine supports the 'READ
COMMITTED' transaction isolation level only.


File: manual.info.tmp,  Node: faqs-storage-engines,  Next: faqs-sql-modes,  Prev: faqs-general,  Up: faqs

A.2 MySQL 5.5 FAQ: Storage Engines
==================================

Where can I obtain complete documentation for MySQL storage engines?

See *note storage-engines::.  That chapter contains information about
all MySQL storage engines except for the *note 'InnoDB':
innodb-storage-engine. storage engine and the *note 'NDB':
mysql-cluster. storage engine (used for MySQL Cluster).  *note 'InnoDB':
innodb-storage-engine. is covered in *note innodb-storage-engine::.
*note 'NDB': mysql-cluster. is covered in *note mysql-cluster::.

Are there any new storage engines in MySQL 5.5?

The features from the optional 'InnoDB Plugin' from MySQL 5.1 are folded
into the built-in 'InnoDB' storage engine, so you can take advantage of
features such as the Barracuda file format, 'InnoDB' table compression,
and the new configuration options for performance.  'InnoDB' also
becomes the default storage engine for new tables.  See *note
innodb-introduction:: for details.

Have any storage engines been removed in MySQL 5.5?

No.

What are the unique benefits of the 'ARCHIVE' storage engine?

The 'ARCHIVE' storage engine stores large amounts of data without
indexes; it has a small footprint, and performs selects using table
scans.  See *note archive-storage-engine::, for details.


File: manual.info.tmp,  Node: faqs-sql-modes,  Next: faqs-stored-procs,  Prev: faqs-storage-engines,  Up: faqs

A.3 MySQL 5.5 FAQ: Server SQL Mode
==================================

What are server SQL modes?

Server SQL modes define what SQL syntax MySQL should support and what
kind of data validation checks it should perform.  This makes it easier
to use MySQL in different environments and to use MySQL together with
other database servers.  The MySQL Server apply these modes individually
to different clients.  For more information, see *note sql-mode::.

How many server SQL modes are there?

Each mode can be independently switched on and off.  See *note
sql-mode::, for a complete list of available modes.

How do you determine the server SQL mode?

You can set the default SQL mode (for *note 'mysqld': mysqld. startup)
with the '--sql-mode' option.  Using the statement *note 'SET
[GLOBAL|SESSION] sql_mode='MODES'': set-variable, you can change the
settings from within a connection, either locally to the connection, or
to take effect globally.  You can retrieve the current mode by issuing a
'SELECT @@sql_mode' statement.

Is the mode dependent on the database or connection?

A mode is not linked to a particular database.  Modes can be set locally
to the session (connection), or globally for the server.  you can change
these settings using *note 'SET [GLOBAL|SESSION] sql_mode='MODES'':
set-variable.

Can the rules for strict mode be extended?

When we refer to _strict mode_, we mean a mode where at least one of the
modes 'TRADITIONAL', 'STRICT_TRANS_TABLES', or 'STRICT_ALL_TABLES' is
enabled.  Options can be combined, so you can add restrictions to a
mode.  See *note sql-mode::, for more information.

Does strict mode impact performance?

The intensive validation of input data that some settings requires more
time than if the validation is not done.  While the performance impact
is not that great, if you do not require such validation (perhaps your
application already handles all of this), then MySQL gives you the
option of leaving strict mode disabled.  However, if you do require it,
strict mode can provide such validation.

What is the default server SQL mode when MySQL 5.5 is installed?

By default, no special modes are enabled.  For information about all
available modes and default MySQL behavior, see *note sql-mode::.


File: manual.info.tmp,  Node: faqs-stored-procs,  Next: faqs-triggers,  Prev: faqs-sql-modes,  Up: faqs

A.4 MySQL 5.5 FAQ: Stored Procedures and Functions
==================================================

Does MySQL 5.5 support stored procedures and functions?

Yes.  MySQL 5.5 supports two types of stored routines, stored procedures
and stored functions.

Where can I find documentation for MySQL stored procedures and stored
functions?

See *note stored-routines::.

Is there a discussion forum for MySQL stored procedures?

Yes.  See https://forums.mysql.com/list.php?98
(https://forums.mysql.com/list.php?98).

Where can I find the ANSI SQL 2003 specification for stored procedures?

Unfortunately, the official specifications are not freely available
(ANSI makes them available for purchase).  However, there are books,
such as 'SQL-99 Complete, Really' by Peter Gulutzan and Trudy Pelzer,
that provide a comprehensive overview of the standard, including
coverage of stored procedures.

How do you manage stored routines?

It is always good practice to use a clear naming scheme for your stored
routines.  You can manage stored procedures with 'CREATE
[FUNCTION|PROCEDURE]', 'ALTER [FUNCTION|PROCEDURE]', 'DROP
[FUNCTION|PROCEDURE]', and 'SHOW CREATE [FUNCTION|PROCEDURE]'.  You can
obtain information about existing stored procedures using the *note
'ROUTINES': routines-table. table in the 'INFORMATION_SCHEMA' database
(see *note routines-table::).

Is there a way to view all stored procedures and stored functions in a
given database?

Yes.  For a database named DBNAME, use this query on the *note
'INFORMATION_SCHEMA.ROUTINES': routines-table. table:

     SELECT ROUTINE_TYPE, ROUTINE_NAME
         FROM INFORMATION_SCHEMA.ROUTINES
         WHERE ROUTINE_SCHEMA='DBNAME';

For more information, see *note routines-table::.

The body of a stored routine can be viewed using *note 'SHOW CREATE
FUNCTION': show-create-function. (for a stored function) or *note 'SHOW
CREATE PROCEDURE': show-create-procedure. (for a stored procedure).  See
*note show-create-procedure::, for more information.

Where are stored procedures stored?

In the 'proc' table of the 'mysql' system database.  However, you should
not access the tables in the system database directly.  Instead, query
the 'INFORMATION_SCHEMA' *note 'ROUTINES': routines-table. and *note
'PARAMETERS': parameters-table. tables.  See *note routines-table::, and
*note parameters-table::.

You can also use *note 'SHOW CREATE FUNCTION': show-create-function. to
obtain information about stored functions, and *note 'SHOW CREATE
PROCEDURE': show-create-procedure. to obtain information about stored
procedures.  See *note show-create-procedure::.

Is it possible to group stored procedures or stored functions into
packages?

No.  This is not supported in MySQL 5.5.

Can a stored procedure call another stored procedure?

Yes.

Can a stored procedure call a trigger?

A stored procedure can execute an SQL statement, such as an *note
'UPDATE': update, that causes a trigger to activate.

Can a stored procedure access tables?

Yes.  A stored procedure can access one or more tables as required.

Do stored procedures have a statement for raising application errors?

Yes.  MySQL 5.5 implements the SQL standard 'SIGNAL' and 'RESIGNAL'
statements.  See *note condition-handling::.

Do stored procedures provide exception handling?

MySQL implements *note 'HANDLER': handler. definitions according to the
SQL standard.  See *note declare-handler::, for details.

Can MySQL 5.5 stored routines return result sets?

_Stored procedures_ can, but stored functions cannot.  If you perform an
ordinary *note 'SELECT': select. inside a stored procedure, the result
set is returned directly to the client.  You need to use the MySQL 4.1
(or higher) client/server protocol for this to work.  This means that,
for example, in PHP, you need to use the 'mysqli' extension rather than
the old 'mysql' extension.

Is 'WITH RECOMPILE' supported for stored procedures?

Not in MySQL 5.5.

Is there a MySQL equivalent to using 'mod_plsql' as a gateway on Apache
to talk directly to a stored procedure in the database?

There is no equivalent in MySQL 5.5.

Can I pass an array as input to a stored procedure?

Not in MySQL 5.5.

Can I pass a cursor as an 'IN' parameter to a stored procedure?

In MySQL 5.5, cursors are available inside stored procedures only.

Can I return a cursor as an 'OUT' parameter from a stored procedure?

In MySQL 5.5, cursors are available inside stored procedures only.
However, if you do not open a cursor on a *note 'SELECT': select, the
result will be sent directly to the client.  You can also 'SELECT INTO'
variables.  See *note select::.

Can I print out a variable's value within a stored routine for debugging
purposes?

Yes, you can do this in a _stored procedure_, but not in a stored
function.  If you perform an ordinary *note 'SELECT': select. inside a
stored procedure, the result set is returned directly to the client.
You will need to use the MySQL 4.1 (or above) client/server protocol for
this to work.  This means that, for example, in PHP, you need to use the
'mysqli' extension rather than the old 'mysql' extension.

Can I commit or roll back transactions inside a stored procedure?

Yes.  However, you cannot perform transactional operations within a
stored function.

Do MySQL 5.5 stored procedures and functions work with replication?

Yes, standard actions carried out in stored procedures and functions are
replicated from a master MySQL server to a slave server.  There are a
few limitations that are described in detail in *note
stored-programs-logging::.

Are stored procedures and functions created on a master server
replicated to a slave?

Yes, creation of stored procedures and functions carried out through
normal DDL statements on a master server are replicated to a slave, so
the objects will exist on both servers.  'ALTER' and 'DROP' statements
for stored procedures and functions are also replicated.

How are actions that take place inside stored procedures and functions
replicated?

MySQL records each DML event that occurs in a stored procedure and
replicates those individual actions to a slave server.  The actual calls
made to execute stored procedures are not replicated.

Stored functions that change data are logged as function invocations,
not as the DML events that occur inside each function.

Are there special security requirements for using stored procedures and
functions together with replication?

Yes.  Because a slave server has authority to execute any statement read
from a master's binary log, special security constraints exist for using
stored functions with replication.  If replication or binary logging in
general (for the purpose of point-in-time recovery) is active, then
MySQL DBAs have two security options open to them:

  1. Any user wishing to create stored functions must be granted the
     'SUPER' privilege.

  2. Alternatively, a DBA can set the 'log_bin_trust_function_creators'
     system variable to 1, which enables anyone with the standard
     'CREATE ROUTINE' privilege to create stored functions.

What limitations exist for replicating stored procedure and function
actions?

Nondeterministic (random) or time-based actions embedded in stored
procedures may not replicate properly.  By their very nature, randomly
produced results are not predictable and cannot be exactly reproduced,
and therefore, random actions replicated to a slave will not mirror
those performed on a master.  Declaring stored functions to be
'DETERMINISTIC' or setting the 'log_bin_trust_function_creators' system
variable to 0 will not allow random-valued operations to be invoked.

In addition, time-based actions cannot be reproduced on a slave because
the timing of such actions in a stored procedure is not reproducible
through the binary log used for replication.  It records only DML events
and does not factor in timing constraints.

Finally, nontransactional tables for which errors occur during large DML
actions (such as bulk inserts) may experience replication issues in that
a master may be partially updated from DML activity, but no updates are
done to the slave because of the errors that occurred.  A workaround is
for a function's DML actions to be carried out with the 'IGNORE' keyword
so that updates on the master that cause errors are ignored and updates
that do not cause errors are replicated to the slave.

Do the preceding limitations affect the ability of MySQL to do
point-in-time recovery?

The same limitations that affect replication do affect point-in-time
recovery.

What is being done to correct the aforementioned limitations?

You can choose either statement-based replication or row-based
replication.  The original replication implementation is based on
statement-based binary logging.  Row-based binary logging resolves the
limitations mentioned earlier.

_Mixed_ replication is also available (by starting the server with
'--binlog-format=mixed').  This hybrid form of replication 'knows'
whether statement-level replication can safely be used, or row-level
replication is required.

For additional information, see *note replication-formats::.


File: manual.info.tmp,  Node: faqs-triggers,  Next: faqs-views,  Prev: faqs-stored-procs,  Up: faqs

A.5 MySQL 5.5 FAQ: Triggers
===========================

Where can I find the documentation for MySQL 5.5 triggers?

See *note triggers::.

Is there a discussion forum for MySQL Triggers?

Yes.  It is available at <https://forums.mysql.com/list.php?99>.

Does MySQL 5.5 have statement-level or row-level triggers?

In MySQL 5.5, all triggers are 'FOR EACH ROW'; that is, the trigger is
activated for each row that is inserted, updated, or deleted.  MySQL 5.5
does not support triggers using 'FOR EACH STATEMENT'.

Are there any default triggers?

Not explicitly.  MySQL does have specific special behavior for some
*note 'TIMESTAMP': datetime. columns, as well as for columns which are
defined using 'AUTO_INCREMENT'.

How are triggers managed in MySQL?

In MySQL 5.5, triggers can be created using the *note 'CREATE TRIGGER':
create-trigger. statement, and dropped using *note 'DROP TRIGGER':
drop-trigger.  See *note create-trigger::, and *note drop-trigger::, for
more about these statements.

Information about triggers can be obtained by querying the *note
'INFORMATION_SCHEMA.TRIGGERS': triggers-table. table.  See *note
triggers-table::.

Is there a way to view all triggers in a given database?

Yes.  You can obtain a listing of all triggers defined on database
'dbname' using a query on the *note 'INFORMATION_SCHEMA.TRIGGERS':
triggers-table. table such as the one shown here:

     SELECT TRIGGER_NAME, EVENT_MANIPULATION, EVENT_OBJECT_TABLE, ACTION_STATEMENT
         FROM INFORMATION_SCHEMA.TRIGGERS
         WHERE TRIGGER_SCHEMA='DBNAME';

For more information about this table, see *note triggers-table::.

You can also use the *note 'SHOW TRIGGERS': show-triggers. statement,
which is specific to MySQL. See *note show-triggers::.

Where are triggers stored?

Triggers are stored in '.TRG' files, with one such file one per table.

Can a trigger call a stored procedure?

Yes.

Can triggers access tables?

A trigger can access both old and new data in its own table.  A trigger
can also affect other tables, but it is not permitted to modify a table
that is already being used (for reading or writing) by the statement
that invoked the function or trigger.

Can a table have multiple triggers with the same trigger event and
action time?

In MySQL 5.5, there cannot be multiple triggers for a given table that
have the same trigger event and action time.  For example, you cannot
have two 'BEFORE UPDATE' triggers for a table.  This limitation is
lifted in MySQL 5.7.

Can triggers call an external application through a UDF?

Yes.  For example, a trigger could invoke the 'sys_exec()' UDF.

Is it possible for a trigger to update tables on a remote server?

Yes.  A table on a remote server could be updated using the 'FEDERATED'
storage engine.  (See *note federated-storage-engine::).

Do triggers work with replication?

Yes.  However, the way in which they work depends whether you are using
MySQL's 'classic' statement-based or row-based replication format.

When using statement-based replication, triggers on the slave are
executed by statements that are executed on the master (and replicated
to the slave).

When using row-based replication, triggers are not executed on the slave
due to statements that were run on the master and then replicated to the
slave.  Instead, when using row-based replication, the changes caused by
executing the trigger on the master are applied on the slave.

For more information, see *note replication-features-triggers::.

How are actions carried out through triggers on a master replicated to a
slave?

Again, this depends on whether you are using statement-based or
row-based replication.

Statement-based replication

First, the triggers that exist on a master must be re-created on the
slave server.  Once this is done, the replication flow works as any
other standard DML statement that participates in replication.  For
example, consider a table 'EMP' that has an 'AFTER' insert trigger,
which exists on a master MySQL server.  The same 'EMP' table and 'AFTER'
insert trigger exist on the slave server as well.  The replication flow
would be:

  1. An *note 'INSERT': insert. statement is made to 'EMP'.

  2. The 'AFTER' trigger on 'EMP' activates.

  3. The *note 'INSERT': insert. statement is written to the binary log.

  4. The replication slave picks up the *note 'INSERT': insert.
     statement to 'EMP' and executes it.

  5. The 'AFTER' trigger on 'EMP' that exists on the slave activates.

Row-based replication

When you use row-based replication, the changes caused by executing the
trigger on the master are applied on the slave.  However, the triggers
themselves are not actually executed on the slave under row-based
replication.  This is because, if both the master and the slave applied
the changes from the master and, in addition, the trigger causing these
changes were applied on the slave, the changes would in effect be
applied twice on the slave, leading to different data on the master and
the slave.

In most cases, the outcome is the same for both row-based and
statement-based replication.  However, if you use different triggers on
the master and slave, you cannot use row-based replication.  (This is
because the row-based format replicates the changes made by triggers
executing on the master to the slaves, rather than the statements that
caused the triggers to execute, and the corresponding triggers on the
slave are not executed.)  Instead, any statements causing such triggers
to be executed must be replicated using statement-based replication.

For more information, see *note replication-features-triggers::.


File: manual.info.tmp,  Node: faqs-views,  Next: faqs-information-schema,  Prev: faqs-triggers,  Up: faqs

A.6 MySQL 5.5 FAQ: Views
========================

Where can I find documentation covering MySQL Views?

See *note views::.

Is there a discussion forum for MySQL Views?

Yes.  See https://forums.mysql.com/list.php?100
(https://forums.mysql.com/list.php?100)

What happens to a view if an underlying table is dropped or renamed?

After a view has been created, it is possible to drop or alter a table
or view to which the definition refers.  To check a view definition for
problems of this kind, use the *note 'CHECK TABLE': check-table.
statement.  (See *note check-table::.)

Does MySQL 5.5 have table snapshots?

No.

Does MySQL 5.5 have materialized views?

No.

Can you insert into views that are based on joins?

It is possible, provided that your *note 'INSERT': insert. statement has
a column list that makes it clear there is only one table involved.

You _cannot_ insert into multiple tables with a single insert on a view.


File: manual.info.tmp,  Node: faqs-information-schema,  Next: faqs-migration,  Prev: faqs-views,  Up: faqs

A.7 MySQL 5.5 FAQ: INFORMATION_SCHEMA
=====================================

Where can I find documentation for the MySQL 'INFORMATION_SCHEMA'
database?

See *note information-schema::

Is there a discussion forum for 'INFORMATION_SCHEMA'?

See https://forums.mysql.com/list.php?101
(https://forums.mysql.com/list.php?101).

Where can I find the ANSI SQL 2003 specification for
'INFORMATION_SCHEMA'?

Unfortunately, the official specifications are not freely available.
(ANSI makes them available for purchase.)  However, there are books
available, such as 'SQL-99 Complete, Really' by Peter Gulutzan and Trudy
Pelzer, that provide a comprehensive overview of the standard, including
'INFORMATION_SCHEMA'.

What is the difference between the Oracle Data Dictionary and MySQL
'INFORMATION_SCHEMA'?

Both Oracle and MySQL provide metadata in tables.  However, Oracle and
MySQL use different table names and column names.  The MySQL
implementation is more similar to those found in DB2 and SQL Server,
which also support 'INFORMATION_SCHEMA' as defined in the SQL standard.

Can I add to or otherwise modify the tables found in the
'INFORMATION_SCHEMA' database?

No.  Since applications may rely on a certain standard structure, this
should not be modified.  For this reason, _we cannot support bugs or
other issues which result from modifying 'INFORMATION_SCHEMA' tables or
data_.


File: manual.info.tmp,  Node: faqs-migration,  Next: faqs-security,  Prev: faqs-information-schema,  Up: faqs

A.8 MySQL 5.5 FAQ: Migration
============================

Where can I find information on how to migrate from MySQL 5.1 to MySQL
5.5?

For detailed upgrade information, see *note upgrading::.  Do not skip a
major version when upgrading, but rather complete the process in steps,
upgrading from one major version to the next in each step.  This may
seem more complicated, but it will you save time and trouble.  If you
encounter problems during the upgrade, their origin will be easier to
identify, either by you or, if you have a MySQL Enterprise subscription,
by MySQL support.

How has storage engine (table type) support changed in MySQL 5.5 from
previous versions?

Storage engine support has changed as follows:

   * Support for 'ISAM' tables was removed in MySQL 5.0 and you should
     now use the 'MyISAM' storage engine in place of 'ISAM'.  To convert
     a table TBLNAME from 'ISAM' to 'MyISAM', simply issue a statement
     such as this one:

          ALTER TABLE TBLNAME ENGINE=MYISAM;

   * Internal 'RAID' for 'MyISAM' tables was also removed in MySQL 5.0.
     This was formerly used to allow large tables in file systems that
     did not support file sizes greater than 2GB. All modern file
     systems allow for larger tables; in addition, there are now other
     solutions such as 'MERGE' tables and views.

   * The *note 'VARCHAR': char. column type now retains trailing spaces
     in all storage engines.

   * 'MEMORY' tables (formerly known as 'HEAP' tables) can also contain
     *note 'VARCHAR': char. columns.


File: manual.info.tmp,  Node: faqs-security,  Next: faqs-mysql-cluster,  Prev: faqs-migration,  Up: faqs

A.9 MySQL 5.5 FAQ: Security
===========================

Where can I find documentation that addresses security issues for MySQL?

The best place to start is *note security::.

Other portions of the MySQL Documentation which you may find useful with
regard to specific security concerns include the following:

   * *note security-guidelines::.

   * *note security-against-attack::.

   * *note resetting-permissions::.

   * *note changing-mysql-user::.

   * *note udf-security::.

   * *note security-options::.

   * *note load-data-local::.

   * *note postinstallation::.

   * *note encrypted-connections::.

What is the default authentication plugin in MySQL 5.5?

The default authentication plugin in MySQL 5.5 is
'mysql_native_password'.  For information about this plugin, see *note
native-pluggable-authentication::.  For general information about
pluggable authentication and other available authentication plugins, see
*note pluggable-authentication::, and *note authentication-plugins::.

Does MySQL 5.5 have native support for SSL?

Most 5.5 binaries have support for SSL connections between the client
and server.  See *note encrypted-connections::.

You can also tunnel a connection using SSH, if (for example) the client
application does not support SSL connections.  For an example, see *note
windows-and-ssh::.

Is SSL support built into MySQL binaries, or must I recompile the binary
myself to enable it?

Most 5.5 binaries have SSL enabled for client/server connections that
are secured, authenticated, or both.  See *note encrypted-connections::.

Does MySQL 5.5 have built-in authentication against LDAP directories?

The Enterprise edition includes a *note PAM Authentication Plugin:
pam-pluggable-authentication. that supports authentication against an
LDAP directory.

Does MySQL 5.5 include support for Roles Based Access Control (RBAC)?

Not at this time.


File: manual.info.tmp,  Node: faqs-mysql-cluster,  Next: faqs-cjk,  Prev: faqs-security,  Up: faqs

A.10 MySQL FAQ: MySQL 5.5 and NDB Cluster
=========================================

In the following section, we answer questions that are frequently asked
about NDB Cluster and the *note 'NDBCLUSTER': mysql-cluster. storage
engine.

Which versions of the MySQL software support NDB Cluster?  Do I have to
compile from source?

NDB Cluster is not supported in standard MySQL Server 5.5 releases.
Instead, MySQL NDB Cluster is provided as a separate product.  Available
NDB Cluster release series include the following:

   * NDB Cluster 7.2

     This series is a previous General Availability (GA) version of NDB
     Cluster, still supported for existing deployments, although we
     recommend that new deployments use the latest NDB Cluster 7.6
     release.  The most recent NDB Cluster 7.2 release can be obtained
     from <https://dev.mysql.com/downloads/cluster/>.

   * NDB Cluster 7.3

     This series is a previous General Availability (GA) version of NDB
     Cluster, still available for production, although we recommend that
     new deployments use the latest NDB Cluster 7.6 release.  The most
     recent NDB Cluster 7.3 release can be obtained from
     <https://dev.mysql.com/downloads/cluster/>.

   * NDB Cluster 7.4

     This series is a previous General Availability (GA) version of NDB
     Cluster, still available for production, although we recommend that
     new deployments use the latest NDB Cluster 7.6 release.  The most
     recent NDB Cluster 7.4 release can be obtained from
     <https://dev.mysql.com/downloads/cluster/>.

   * NDB Cluster 7.5

     This series is a previous General Availability (GA) version of NDB
     Cluster, still available for production, although we recommend that
     new deployments use the latest NDB Cluster 7.6 release.  The latest
     NDB Cluster 7.5 releases can be obtained from
     <https://dev.mysql.com/downloads/cluster/>.

   * NDB Cluster 7.6

     This series is the most recent General Availability (GA) version of
     NDB Cluster, based on version 7.6 of the *note 'NDB':
     mysql-cluster. storage engine and MySQL Server 5.7.  NDB Cluster
     7.6 is available for production use; new deployments intended for
     production should use the latest GA release in this series, which
     is currently NDB Cluster 7.6.13.  You can obtain the most recent
     NDB Cluster 7.6 release from
     <https://dev.mysql.com/downloads/cluster/>.  For information about
     new features and other important changes in this series, see What
     is New in NDB Cluster 7.6
     (https://dev.mysql.com/doc/refman/5.7/en/mysql-cluster-what-is-new-7-6.html).

   * NDB Cluster 8.0

     This series is now available as a Developer Preview release for
     evaluation and testing of new features in the 'NDBCLUSTER' storage
     engine; for more information, see MySQL NDB Cluster 8.0
     (https://dev.mysql.com/doc/refman/8.0/en/mysql-cluster.html).

You should use NDB Cluster 7.6 for any new deployments; if you are using
an older version of NDB Cluster, you should upgrade to this version soon
as possible.  For an overview of improvements made in NDB Cluster 7.6,
see What is New in NDB Cluster 7.6
(https://dev.mysql.com/doc/refman/5.7/en/mysql-cluster-what-is-new-7-6.html).
For an overview of improvements made in NDB Cluster 7.5, see What is New
in NDB Cluster 7.5
(https://dev.mysql.com/doc/refman/5.7/en/mysql-cluster-what-is-new-7-5.html).

You can determine whether your MySQL Server has *note 'NDB':
mysql-cluster. support using one of the statements 'SHOW VARIABLES LIKE
'have_%'', *note 'SHOW ENGINES': show-engines, or *note 'SHOW PLUGINS':
show-plugins.

What do 'NDB' and 'NDBCLUSTER' mean?

'NDB' stands for '*N*etwork *D*ata*b*ase'.  'NDB' and 'NDBCLUSTER' are
both names for the storage engine that enables clustering support with
MySQL. 'NDB' is preferred, but either name is correct.

What is the difference between using NDB Cluster versus using MySQL
Replication?

In traditional MySQL replication, a master MySQL server updates one or
more slaves.  Transactions are committed sequentially, and a slow
transaction can cause the slave to lag behind the master.  This means
that if the master fails, it is possible that the slave might not have
recorded the last few transactions.  If a transaction-safe engine such
as *note 'InnoDB': innodb-storage-engine. is being used, a transaction
will either be complete on the slave or not applied at all, but
replication does not guarantee that all data on the master and the slave
will be consistent at all times.  In NDB Cluster, all data nodes are
kept in synchrony, and a transaction committed by any one data node is
committed for all data nodes.  In the event of a data node failure, all
remaining data nodes remain in a consistent state.

In short, whereas standard MySQL replication is _asynchronous_, NDB
Cluster is _synchronous_.

Asynchronous replication is also available in NDB Cluster.  _NDB Cluster
Replication_ (also sometimes known as 'geo-replication') includes the
capability to replicate both between two NDB Clusters, and from an NDB
Cluster to a non-Cluster MySQL server.  See *note
mysql-cluster-replication::.

Do I need any special networking to run NDB Cluster?  How do computers
in a cluster communicate?

NDB Cluster is intended to be used in a high-bandwidth environment, with
computers connecting using TCP/IP. Its performance depends directly upon
the connection speed between the cluster's computers.  The minimum
connectivity requirements for NDB Cluster include a typical 100-megabit
Ethernet network or the equivalent.  We recommend you use gigabit
Ethernet whenever available.

How many computers do I need to run an NDB Cluster, and why?

A minimum of three computers is required to run a viable cluster.
However, the minimum _recommended_ number of computers in an NDB Cluster
is four: one each to run the management and SQL nodes, and two computers
to serve as data nodes.  The purpose of the two data nodes is to provide
redundancy; the management node must run on a separate machine to
guarantee continued arbitration services in the event that one of the
data nodes fails.

To provide increased throughput and high availability, you should use
multiple SQL nodes (MySQL Servers connected to the cluster).  It is also
possible (although not strictly necessary) to run multiple management
servers.

What do the different computers do in an NDB Cluster?

An NDB Cluster has both a physical and logical organization, with
computers being the physical elements.  The logical or functional
elements of a cluster are referred to as _nodes_, and a computer housing
a cluster node is sometimes referred to as a _cluster host_.  There are
three types of nodes, each corresponding to a specific role within the
cluster.  These are:

   * Management node

     This node provides management services for the cluster as a whole,
     including startup, shutdown, backups, and configuration data for
     the other nodes.  The management node server is implemented as the
     application *note 'ndb_mgmd': mysql-cluster-programs-ndb-mgmd.; the
     management client used to control NDB Cluster is *note 'ndb_mgm':
     mysql-cluster-programs-ndb-mgm.  See *note
     mysql-cluster-programs-ndb-mgmd::, and *note
     mysql-cluster-programs-ndb-mgm::, for information about these
     programs.

   * Data node

     This type of node stores and replicates data.  Data node
     functionality is handled by instances of the *note 'NDB':
     mysql-cluster. data node process *note 'ndbd':
     mysql-cluster-programs-ndbd.  For more information, see *note
     mysql-cluster-programs-ndbd::.

   * SQL node

     This is simply an instance of MySQL Server (*note 'mysqld':
     mysqld.) that is built with support for the *note 'NDBCLUSTER':
     mysql-cluster. storage engine and started with the '--ndb-cluster'
     option to enable the engine and the '--ndb-connectstring' option to
     enable it to connect to an NDB Cluster management server.  For more
     about these options, see *note
     mysql-cluster-program-options-mysqld::.

     *Note*:

     An _API node_ is any application that makes direct use of Cluster
     data nodes for data storage and retrieval.  An SQL node can thus be
     considered a type of API node that uses a MySQL Server to provide
     an SQL interface to the Cluster.  You can write such applications
     (that do not depend on a MySQL Server) using the NDB API, which
     supplies a direct, object-oriented transaction and scanning
     interface to NDB Cluster data; see NDB Cluster API Overview: The
     NDB API
     (https://dev.mysql.com/doc/ndbapi/en/overview-ndb-api.html), for
     more information.

When I run the 'SHOW' command in the NDB Cluster management client, I
see a line of output that looks like this:

     id=2    @10.100.10.32  (Version: 5.6.47-ndb-7.4.27 Nodegroup: 0, *)

What does the '*' mean?  How is this node different from the others?

The simplest answer is, 'It's not something you can control, and it's
nothing that you need to worry about in any case, unless you're a
software engineer writing or analyzing the NDB Cluster source code'.

If you don't find that answer satisfactory, here's a longer and more
technical version:

A number of mechanisms in NDB Cluster require distributed coordination
among the data nodes.  These distributed algorithms and protocols
include global checkpointing, DDL (schema) changes, and node restart
handling.  To make this coordination simpler, the data nodes 'elect' one
of their number to act as leader.  (This node was once referred to as a
'master', but this terminology was dropped to avoid confusion with
master server in MySQL Replication.)  There is no user-facing mechanism
for influencing this selection, which is completely automatic; the fact
that it _is_ automatic is a key part of NDB Cluster's internal
architecture.

When a node acts as the 'leader' for any of these mechanisms, it is
usually the point of coordination for the activity, and the other nodes
act as 'followers', carrying out their parts of the activity as directed
by the leader.  If the node acting as leader fails, then the remaining
nodes elect a new leader.  Tasks in progress that were being coordinated
by the old leader may either fail or be continued by the new leader,
depending on the actual mechanism involved.

It is possible for some of these different mechanisms and protocols to
have different leader nodes, but in general the same leader is chosen
for all of them.  The node indicated as the leader in the output of
'SHOW' in the management client is known internally as the 'DICT'
manager (see The DBDICT Block
(https://dev.mysql.com/doc/ndb-internals/en/ndb-internals-kernel-blocks-dbdict.html),
in the 'NDB Cluster API Developer Guide', for more information),
responsible for coordinating DDL and metadata activity.

NDB Cluster is designed in such a way that the choice of leader has no
discernible effect outside the cluster itself.  For example, the current
leader does not have significantly higher CPU or resource usage than the
other data nodes, and failure of the leader should not have a
significantly different impact on the cluster than the failure of any
other data node.

With which operating systems can I use NDB Cluster?

NDB Cluster is supported on most Unix-like operating systems.  NDB
Cluster is also supported in production settings on Microsoft Windows
operating systems.

For more detailed information concerning the level of support which is
offered for NDB Cluster on various operating system versions, operating
system distributions, and hardware platforms, please refer to
<https://www.mysql.com/support/supportedplatforms/cluster.html>.

What are the hardware requirements for running NDB Cluster?

NDB Cluster should run on any platform for which *note 'NDB':
mysql-cluster.-enabled binaries are available.  For data nodes and API
nodes, faster CPUs and more memory are likely to improve performance,
and 64-bit CPUs are likely to be more effective than 32-bit processors.
There must be sufficient memory on machines used for data nodes to hold
each node's share of the database (see _How much RAM do I Need?_  for
more information).  For a computer which is used only for running the
NDB Cluster management server, the requirements are minimal; a common
desktop PC (or the equivalent) is generally sufficient for this task.
Nodes can communicate through the standard TCP/IP network and hardware.
They can also use the high-speed SCI protocol; however, special
networking hardware and software are required to use SCI (see *note
mysql-cluster-interconnects::).

How much RAM do I need to use NDB Cluster?  Is it possible to use disk
memory at all?

NDB Cluster was originally implemented as in-memory only, but all
versions currently available also provide the ability to store NDB
Cluster on disk.  See *note mysql-cluster-disk-data::, for more
information.

For in-memory 'NDB' tables, you can use the following formula for
obtaining a rough estimate of how much RAM is needed for each data node
in the cluster:

     (SizeofDatabase x NumberOfReplicas x 1.1 ) / NumberOfDataNodes

To calculate the memory requirements more exactly requires determining,
for each table in the cluster database, the storage space required per
row (see *note storage-requirements::, for details), and multiplying
this by the number of rows.  You must also remember to account for any
column indexes as follows:

   * Each primary key or hash index created for an *note 'NDBCLUSTER':
     mysql-cluster. table requires 2125 bytes per record.  These
     indexes use 'IndexMemory'.

   * Each ordered index requires 10 bytes storage per record, using
     'DataMemory'.

   * Creating a primary key or unique index also creates an ordered
     index, unless this index is created with 'USING HASH'.  In other
     words:

        * A primary key or unique index on a Cluster table normally
          takes up 31 to 35 bytes per record.

        * However, if the primary key or unique index is created with
          'USING HASH', then it requires only 21 to 25 bytes per record.

Creating NDB Cluster tables with 'USING HASH' for all primary keys and
unique indexes will generally cause table updates to run more
quickly--in some cases by a much as 20 to 30 percent faster than updates
on tables where 'USING HASH' was not used in creating primary and unique
keys.  This is due to the fact that less memory is required (because no
ordered indexes are created), and that less CPU must be utilized
(because fewer indexes must be read and possibly updated).  However, it
also means that queries that could otherwise use range scans must be
satisfied by other means, which can result in slower selects.

When calculating Cluster memory requirements, you may find useful the
*note 'ndb_size.pl': mysql-cluster-programs-ndb-size-pl. utility which
is available in recent MySQL 5.5 releases.  This Perl script connects to
a current (non-Cluster) MySQL database and creates a report on how much
space that database would require if it used the *note 'NDBCLUSTER':
mysql-cluster. storage engine.  For more information, see *note
mysql-cluster-programs-ndb-size-pl::.

It is especially important to keep in mind that _every NDB Cluster table
must have a primary key_.  The *note 'NDB': mysql-cluster. storage
engine creates a primary key automatically if none is defined; this
primary key is created without 'USING HASH'.

You can determine how much memory is being used for storage of NDB
Cluster data and indexes at any given time using the 'REPORT
MEMORYUSAGE' command in the *note 'ndb_mgm':
mysql-cluster-programs-ndb-mgm. client; see *note
mysql-cluster-mgm-client-commands::, for more information.  In addition,
warnings are written to the cluster log when 80% of available
'DataMemory' or 'IndexMemory' is in use, and again when usage reaches
85%, 90%, and so on.

What file systems can I use with NDB Cluster?  What about network file
systems or network shares?

Generally, any file system that is native to the host operating system
should work well with NDB Cluster.  If you find that a given file system
works particularly well (or not so especially well) with NDB Cluster, we
invite you to discuss your findings in the NDB Cluster Forums
(https://forums.mysql.com/list.php?25).

For Windows, we recommend that you use 'NTFS' file systems for NDB
Cluster, just as we do for standard MySQL. We do not test NDB Cluster
with 'FAT' or 'VFAT' file systems.  Because of this, we do not recommend
their use with MySQL or NDB Cluster.

NDB Cluster is implemented as a shared-nothing solution; the idea behind
this is that the failure of a single piece of hardware should not cause
the failure of multiple cluster nodes, or possibly even the failure of
the cluster as a whole.  For this reason, the use of network shares or
network file systems is not supported for NDB Cluster.  This also
applies to shared storage devices such as SANs.

Can I run NDB Cluster nodes inside virtual machines (such as those
created by VMWare, Parallels, or Xen)?

NDB Cluster is supported for use in virtual machines.  We currently
support and test using Oracle VM
(http://www.oracle.com/technetwork/server-storage/vm/index.html).

Some NDB Cluster users have successfully deployed NDB Cluster using
other virtualization products; in such cases, Oracle can provide NDB
Cluster support, but issues specific to the virtual environment must be
referred to that product's vendor.

I am trying to populate an NDB Cluster database.  The loading process
terminates prematurely and I get an error message like this one:

'ERROR 1114: The table 'my_cluster_table' is full'

Why is this happening?

The cause is very likely to be that your setup does not provide
sufficient RAM for all table data and all indexes, _including the
primary key required by the *note 'NDB': mysql-cluster. storage engine
and automatically created in the event that the table definition does
not include the definition of a primary key_.

It is also worth noting that all data nodes should have the same amount
of RAM, since no data node in a cluster can use more memory than the
least amount available to any individual data node.  For example, if
there are four computers hosting Cluster data nodes, and three of these
have 3GB of RAM available to store Cluster data while the remaining data
node has only 1GB RAM, then each data node can devote at most 1GB to NDB
Cluster data and indexes.

In some cases it is possible to get 'Table is full' errors in MySQL
client applications even when *note 'ndb_mgm -e "ALL REPORT
MEMORYUSAGE"': mysql-cluster-programs-ndb-mgm. shows significant free
'DataMemory'.  You can force *note 'NDB': mysql-cluster. to create extra
partitions for NDB Cluster tables and thus have more memory available
for hash indexes by using the 'MAX_ROWS' option for *note 'CREATE
TABLE': create-table.  In general, setting 'MAX_ROWS' to twice the
number of rows that you expect to store in the table should be
sufficient.

For similar reasons, you can also sometimes encounter problems with data
node restarts on nodes that are heavily loaded with data.  The
'MinFreePct' parameter can help with this issue by reserving a portion
(5% by default) of 'DataMemory' and 'IndexMemory' for use in restarts.
This reserved memory is not available for storing *note 'NDB':
mysql-cluster. tables or data.

NDB Cluster uses TCP/IP. Does this mean that I can run it over the
Internet, with one or more nodes in remote locations?

It is _very_ unlikely that a cluster would perform reliably under such
conditions, as NDB Cluster was designed and implemented with the
assumption that it would be run under conditions guaranteeing dedicated
high-speed connectivity such as that found in a LAN setting using 100
Mbps or gigabit Ethernet--preferably the latter.  We neither test nor
warrant its performance using anything slower than this.

Also, it is extremely important to keep in mind that communications
between the nodes in an NDB Cluster are not secure; they are neither
encrypted nor safeguarded by any other protective mechanism.  The most
secure configuration for a cluster is in a private network behind a
firewall, with no direct access to any Cluster data or management nodes
from outside.  (For SQL nodes, you should take the same precautions as
you would with any other instance of the MySQL server.)  For more
information, see *note mysql-cluster-security::.

Do I have to learn a new programming or query language to use NDB
Cluster?

_No_.  Although some specialized commands are used to manage and
configure the cluster itself, only standard (My)SQL statements are
required for the following operations:

   * Creating, altering, and dropping tables

   * Inserting, updating, and deleting table data

   * Creating, changing, and dropping primary and unique indexes

Some specialized configuration parameters and files are required to set
up an NDB Cluster--see *note mysql-cluster-config-file::, for
information about these.

A few simple commands are used in the NDB Cluster management client
(*note 'ndb_mgm': mysql-cluster-programs-ndb-mgm.) for tasks such as
starting and stopping cluster nodes.  See *note
mysql-cluster-mgm-client-commands::.

What programming languages and APIs are supported by NDB Cluster?

NDB Cluster supports the same programming APIs and languages as the
standard MySQL Server, including ODBC, .Net, the MySQL C API, and
numerous drivers for popular scripting languages such as PHP, Perl, and
Python.  NDB Cluster applications written using these APIs behave
similarly to other MySQL applications; they transmit SQL statements to a
MySQL Server (in the case of NDB Cluster, an SQL node), and receive
responses containing rows of data.  For more information about these
APIs, see *note connectors-apis::.

NDB Cluster also supports application programming using the NDB API,
which provides a low-level C++ interface to NDB Cluster data without
needing to go through a MySQL Server.  See The NDB API
(https://dev.mysql.com/doc/ndbapi/en/ndbapi.html).  In addition, many
*note 'NDBCLUSTER': mysql-cluster. management functions are exposed by
the C-language MGM API; see The MGM API
(https://dev.mysql.com/doc/ndbapi/en/mgm-api.html), for more
information.

NDB Cluster also supports Java application programming using ClusterJ,
which supports a domain object model of data using sessions and
transactions.  See Java and NDB Cluster
(https://dev.mysql.com/doc/ndbapi/en/mccj-overview-java.html), for more
information.

In addition, NDB Cluster provides support for 'memcached', allowing
developers to access data stored in NDB Cluster using the 'memcached'
interface; for more information, see ndbmemcache--Memcache API for NDB
Cluster (https://dev.mysql.com/doc/ndbapi/en/ndbmemcache.html).

Does NDB Cluster include any management tools?

NDB Cluster includes a command line client for performing basic
management functions.  See *note mysql-cluster-programs-ndb-mgm::, and
*note mysql-cluster-mgm-client-commands::.

NDB Cluster is also supported by MySQL Cluster Manager, a separate
product providing an advanced command line interface that can automate
many NDB Cluster management tasks such as rolling restarts and
configuration changes.  For more information about MySQL Cluster
Manager, see MySQL(tm) Cluster Manager 1.4.7 User Manual
(https://dev.mysql.com/doc/mysql-cluster-manager/1.4/en/).

How do I find out what an error or warning message means when using NDB
Cluster?

There are two ways in which this can be done:

   * From within the *note 'mysql': mysql. client, use 'SHOW ERRORS' or
     'SHOW WARNINGS' immediately upon being notified of the error or
     warning condition.

   * From a system shell prompt, use *note 'perror --ndb ERROR_CODE':
     perror.

Is NDB Cluster transaction-safe?  What isolation levels are supported?

_Yes_.  For tables created with the *note 'NDB': mysql-cluster. storage
engine, transactions are supported.  Currently, NDB Cluster supports
only the 'READ COMMITTED' transaction isolation level.

What storage engines are supported by NDB Cluster?

Clustering with MySQL is supported only by the *note 'NDB':
mysql-cluster. storage engine.  That is, in order for a table to be
shared between nodes in an NDB Cluster, the table must be created using
'ENGINE=NDB' (or the equivalent option 'ENGINE=NDBCLUSTER').

It is possible to create tables using other storage engines (such as
*note 'InnoDB': innodb-storage-engine. or *note 'MyISAM':
myisam-storage-engine.) on a MySQL server being used with an NDB
Cluster, but since these tables do not use *note 'NDB': mysql-cluster,
they do not participate in clustering; each such table is strictly local
to the individual MySQL server instance on which it is created.

In the event of a catastrophic failure-- for example, the whole city
loses power _and_ my UPS fails--would I lose all my data?

All committed transactions are logged.  Therefore, although it is
possible that some data could be lost in the event of a catastrophe,
this should be quite limited.  Data loss can be further reduced by
minimizing the number of operations per transaction.  (It is not a good
idea to perform large numbers of operations per transaction in any
case.)

Is it possible to use 'FULLTEXT' indexes with NDB Cluster?

'FULLTEXT' indexing is currently supported only by the *note 'MyISAM':
myisam-storage-engine. storage engine.  See *note fulltext-search::, for
more information.

Can I run multiple nodes on a single computer?

It is possible but not always advisable.  One of the chief reasons to
run a cluster is to provide redundancy.  To obtain the full benefits of
this redundancy, each node should reside on a separate machine.  If you
place multiple nodes on a single machine and that machine fails, you
lose all of those nodes.  For this reason, if you do run multiple data
nodes on a single machine, it is _extremely_ important that they be set
up in such a way that the failure of this machine does not cause the
loss of all the data nodes in a given node group.

Given that NDB Cluster can be run on commodity hardware loaded with a
low-cost (or even no-cost) operating system, the expense of an extra
machine or two is well worth it to safeguard mission-critical data.  It
also worth noting that the requirements for a cluster host running a
management node are minimal.  This task can be accomplished with a 300
MHz Pentium or equivalent CPU and sufficient RAM for the operating
system, plus a small amount of overhead for the *note 'ndb_mgmd':
mysql-cluster-programs-ndb-mgmd. and *note 'ndb_mgm':
mysql-cluster-programs-ndb-mgm. processes.

It is acceptable to run multiple cluster data nodes on a single host
that has multiple CPUs, cores, or both.  The NDB Cluster distribution
also provides a multithreaded version of the data node binary intended
for use on such systems.  For more information, see *note
mysql-cluster-programs-ndbmtd::.

It is also possible in some cases to run data nodes and SQL nodes
concurrently on the same machine; how well such an arrangement performs
is dependent on a number of factors such as number of cores and CPUs as
well as the amount of disk and memory available to the data node and SQL
node processes, and you must take these factors into account when
planning such a configuration.

Can I add data nodes to an NDB Cluster without restarting it?

It is possible to add new data nodes to a running NDB Cluster without
taking the cluster offline.  For more information, see *note
mysql-cluster-online-add-node::.

For other types of NDB Cluster nodes, a rolling restart is all that is
required (see *note mysql-cluster-rolling-restart::).

Are there any limitations that I should be aware of when using NDB
Cluster?

Limitations on *note 'NDB': mysql-cluster. tables in MySQL NDB Cluster
7.2 include the following:

   * Temporary tables are not supported; a *note 'CREATE TEMPORARY
     TABLE': create-table. statement using 'ENGINE=NDB' or
     'ENGINE=NDBCLUSTER' fails with an error.

   * The only types of user-defined partitioning supported for *note
     'NDBCLUSTER': mysql-cluster. tables are 'KEY' and 'LINEAR KEY'.
     Trying to create an 'NDB' table using any other partitioning type
     fails with an error.

   * 'FULLTEXT' indexes are not supported.

   * Index prefixes are not supported.  Only complete columns may be
     indexed.

   * Spatial indexes are not supported (although spatial columns can be
     used).  See *note spatial-types::.

   * Support for partial transactions and partial rollbacks is
     comparable to that of other transactional storage engines such as
     *note 'InnoDB': innodb-storage-engine. that can roll back
     individual statements.

   * The maximum number of attributes allowed per table is 512.
     Attribute names cannot be any longer than 31 characters.  For each
     table, the maximum combined length of the table and database names
     is 122 characters.

   * The maximum size for a table row is 14 kilobytes, not counting
     *note 'BLOB': blob. values.

     There is no set limit for the number of rows per 'NDB' table.
     Limits on table size depend on a number of factors, in particular
     on the amount of RAM available to each data node.

   * The *note 'NDBCLUSTER': mysql-cluster. engine does not support
     foreign key constraints.  As with *note 'MyISAM':
     myisam-storage-engine. tables, if these are specified in a *note
     'CREATE TABLE': create-table. or *note 'ALTER TABLE': alter-table.
     statement, they are ignored.

For a complete listing of limitations in NDB Cluster, see *note
mysql-cluster-limitations::.  See also *note
mysql-cluster-limitations-resolved::.

Does NDB Cluster support foreign keys?

NDB Cluster 7.2 does not support foreign key constraints, and ignores
foreign keys in *note 'CREATE TABLE': create-table. statements
(similarly to how *note 'MyISAM': myisam-storage-engine. treats foreign
key syntax).

Foreign key support comparable to that found in the *note 'InnoDB':
innodb-storage-engine. storage engine is provided by *note 'NDB':
mysql-cluster. beginning with NDB 7.3.  Applications requiring foreign
key support should use NDB Cluster 7.3 or later.

How do I import an existing MySQL database into an NDB Cluster?

You can import databases into NDB Cluster much as you would with any
other version of MySQL. Other than the limitations mentioned elsewhere
in this FAQ, the only other special requirement is that any tables to be
included in the cluster must use the *note 'NDB': mysql-cluster. storage
engine.  This means that the tables must be created with 'ENGINE=NDB' or
'ENGINE=NDBCLUSTER'.

It is also possible to convert existing tables that use other storage
engines to *note 'NDBCLUSTER': mysql-cluster. using one or more *note
'ALTER TABLE': alter-table. statement.  However, the definition of the
table must be compatible with the *note 'NDBCLUSTER': mysql-cluster.
storage engine prior to making the conversion.  In MySQL 5.5, an
additional workaround is also required; see *note
mysql-cluster-limitations::, for details.

How do NDB Cluster nodes communicate with one another?

Cluster nodes can communicate through any of three different transport
mechanisms: TCP/IP, SHM (shared memory), and SCI (Scalable Coherent
Interface).  Where available, SHM is used by default between nodes
residing on the same cluster host; however, this is considered
experimental.  SCI is a high-speed (1 gigabit per second and higher),
high-availability protocol used in building scalable multi-processor
systems; it requires special hardware and drivers.  See *note
mysql-cluster-interconnects::, for more about using SCI as a transport
mechanism for NDB Cluster.

What is an _arbitrator_?

If one or more data nodes in a cluster fail, it is possible that not all
cluster data nodes will be able to 'see' one another.  In fact, it is
possible that two sets of data nodes might become isolated from one
another in a network partitioning, also known as a 'split-brain'
scenario.  This type of situation is undesirable because each set of
data nodes tries to behave as though it is the entire cluster.  An
arbitrator is required to decide between the competing sets of data
nodes.

When all data nodes in at least one node group are alive, network
partitioning is not an issue, because no single subset of the cluster
can form a functional cluster on its own.  The real problem arises when
no single node group has all its nodes alive, in which case network
partitioning (the 'split-brain' scenario) becomes possible.  Then an
arbitrator is required.  All cluster nodes recognize the same node as
the arbitrator, which is normally the management server; however, it is
possible to configure any of the MySQL Servers in the cluster to act as
the arbitrator instead.  The arbitrator accepts the first set of cluster
nodes to contact it, and tells the remaining set to shut down.
Arbitrator selection is controlled by the 'ArbitrationRank'
configuration parameter for MySQL Server and management server nodes.
You can also use the 'ArbitrationRank' configuration parameter to
control the arbitrator selection process.  For more information about
these parameters, see *note mysql-cluster-mgm-definition::.

The role of arbitrator does not in and of itself impose any heavy
demands upon the host so designated, and thus the arbitrator host does
not need to be particularly fast or to have extra memory especially for
this purpose.

What data types are supported by NDB Cluster?

NDB Cluster supports all of the usual MySQL data types, including those
associated with MySQL's spatial extensions; however, the *note 'NDB':
mysql-cluster. storage engine does not support spatial indexes.
(Spatial indexes are supported only by *note 'MyISAM':
myisam-storage-engine.; see *note spatial-types::, for more
information.)  In addition, there are some differences with regard to
indexes when used with *note 'NDB': mysql-cluster. tables.

*Note*:

NDB Cluster Disk Data tables (that is, tables created with 'TABLESPACE
... STORAGE DISK ENGINE=NDB' or 'TABLESPACE ... STORAGE DISK
ENGINE=NDBCLUSTER') have only fixed-width rows.  This means that (for
example) each Disk Data table record containing a *note 'VARCHAR(255)':
char. column requires space for 255 characters (as required for the
character set and collation being used for the table), regardless of the
actual number of characters stored therein.

See *note mysql-cluster-limitations::, for more information about these
issues.

How do I start and stop NDB Cluster?

It is necessary to start each node in the cluster separately, in the
following order:

  1. Start the management node, using the *note 'ndb_mgmd':
     mysql-cluster-programs-ndb-mgmd. command.

     You must include the '-f' or '--config-file' option to tell the
     management node where its configuration file can be found.

  2. Start each data node with the *note 'ndbd':
     mysql-cluster-programs-ndbd. command.

     Each data node must be started with the '-c' or
     '--ndb-connectstring' option so that the data node knows how to
     connect to the management server.

  3. Start each MySQL Server (SQL node) using your preferred startup
     script, such as *note 'mysqld_safe': mysqld-safe.

     Each MySQL Server must be started with the '--ndbcluster' and
     '--ndb-connectstring' options.  These options cause mysqld to
     enable *note 'NDBCLUSTER': mysql-cluster. storage engine support
     and how to connect to the management server.

Each of these commands must be run from a system shell on the machine
housing the affected node.  (You do not have to be physically present at
the machine--a remote login shell can be used for this purpose.)  You
can verify that the cluster is running by starting the *note 'NDB':
mysql-cluster. management client *note 'ndb_mgm':
mysql-cluster-programs-ndb-mgm. on the machine housing the management
node and issuing the 'SHOW' or 'ALL STATUS' command.

To shut down a running cluster, issue the command 'SHUTDOWN' in the
management client.  Alternatively, you may enter the following command
in a system shell:

     shell> ndb_mgm -e "SHUTDOWN"

(The quotation marks in this example are optional, since there are no
spaces in the command string following the '-e' option; in addition, the
'SHUTDOWN' command, like other management client commands, is not
case-sensitive.)

Either of these commands causes the *note 'ndb_mgm':
mysql-cluster-programs-ndb-mgm, *note 'ndb_mgm':
mysql-cluster-programs-ndb-mgm, and any *note 'ndbd':
mysql-cluster-programs-ndbd. processes to terminate gracefully.  MySQL
servers running as SQL nodes can be stopped using *note 'mysqladmin
shutdown': mysqladmin.

For more information, see *note mysql-cluster-mgm-client-commands::, and
*note mysql-cluster-install-shutdown-restart::.

What happens to NDB Cluster data when the NDB Cluster is shut down?

The data that was held in memory by the cluster's data nodes is written
to disk, and is reloaded into memory the next time that the cluster is
started.

Is it a good idea to have more than one management node for an NDB
Cluster?

It can be helpful as a fail-safe.  Only one management node controls the
cluster at any given time, but it is possible to configure one
management node as primary, and one or more additional management nodes
to take over in the event that the primary management node fails.

See *note mysql-cluster-config-file::, for information on how to
configure NDB Cluster management nodes.

Can I mix different kinds of hardware and operating systems in one NDB
Cluster?

Yes, as long as all machines and operating systems have the same
'endianness' (all big-endian or all little-endian).

It is also possible to use software from different NDB Cluster releases
on different nodes.  However, we support this only as part of a rolling
upgrade procedure (see *note mysql-cluster-rolling-restart::).

Can I run two data nodes on a single host?  Two SQL nodes?

Yes, it is possible to do this.  In the case of multiple data nodes, it
is advisable (but not required) for each node to use a different data
directory.  If you want to run multiple SQL nodes on one machine, each
instance of *note 'mysqld': mysqld. must use a different TCP/IP port.

Running data nodes and SQL nodes together on the same host is possible,
but you should be aware that the *note 'ndbd':
mysql-cluster-programs-ndbd. (or *note 'ndbmtd':
mysql-cluster-programs-ndbmtd.) and *note 'mysqld': mysqld. processes
may compete for memory.

Can I use host names with NDB Cluster?

Yes, it is possible to use DNS and DHCP for cluster hosts.  However, if
your application requires 'five nines' availability, you should use
fixed (numeric) IP addresses, since making communication between Cluster
hosts dependent on services such as DNS and DHCP introduces additional
potential points of failure.

Does NDB Cluster support IPv6?

IPv6 is supported for connections between SQL nodes (MySQL servers), but
connections between all other types of NDB Cluster nodes must use IPv4.

In practical terms, this means that you can use IPv6 for replication
between NDB Clusters, but connections between nodes in the same NDB
Cluster must use IPv4.  For more information, see *note
mysql-cluster-replication-issues::.

How do I handle MySQL users in an NDB Cluster having multiple MySQL
servers?

MySQL user accounts and privileges are normally not automatically
propagated between different MySQL servers accessing the same NDB
Cluster.  MySQL NDB Cluster provides support for distributed privileges,
which you can enable by following a procedure provided in the
documentation; see *note mysql-cluster-privilege-distribution::, for
more information.

How do I continue to send queries in the event that one of the SQL nodes
fails?

MySQL NDB Cluster does not provide any sort of automatic failover
between SQL nodes.  Your application must be prepared to handle the loss
of SQL nodes and to fail over between them.

How do I back up and restore an NDB Cluster?

You can use the NDB Cluster native backup and restore functionality in
the NDB management client and the *note 'ndb_restore':
mysql-cluster-programs-ndb-restore. program.  See *note
mysql-cluster-backup::, and *note mysql-cluster-programs-ndb-restore::.

You can also use the traditional functionality provided for this purpose
in *note 'mysqldump': mysqldump. and the MySQL server.  See *note
mysqldump::, for more information.

What is an 'angel process'?

This process monitors and, if necessary, attempts to restart the data
node process.  If you check the list of active processes on your system
after starting *note 'ndbd': mysql-cluster-programs-ndbd, you can see
that there are actually 2 processes running by that name, as shown here
(we omit the output from *note 'ndb_mgmd':
mysql-cluster-programs-ndb-mgmd. and *note 'ndbd':
mysql-cluster-programs-ndbd. for brevity):

     shell> ./ndb_mgmd

     shell> ps aux | grep ndb
     me      23002  0.0  0.0 122948  3104 ?        Ssl  14:14   0:00 ./ndb_mgmd
     me      23025  0.0  0.0   5284   820 pts/2    S+   14:14   0:00 grep ndb

     shell> ./ndbd -c 127.0.0.1 --initial

     shell> ps aux | grep ndb
     me      23002  0.0  0.0 123080  3356 ?        Ssl  14:14   0:00 ./ndb_mgmd
     me      23096  0.0  0.0  35876  2036 ?        Ss   14:14   0:00 ./ndbd -c 127.0.0.1 --initial
     me      23097  1.0  2.4 524116 91096 ?        Sl   14:14   0:00 ./ndbd -c 127.0.0.1 --initial
     me      23168  0.0  0.0   5284   812 pts/2    R+   14:15   0:00 grep ndb

The *note 'ndbd': mysql-cluster-programs-ndbd. process showing 0 memory
and CPU usage is the angel process.  It actually does use a very small
amount of each, of course.  It simply checks to see if the main *note
'ndbd': mysql-cluster-programs-ndbd. process (the primary data node
process that actually handles the data) is running.  If permitted to do
so (for example, if the 'StopOnError' configuration parameter is set to
false--see *note mysql-cluster-params-ndbd::), the angel process tries
to restart the primary data node process.


File: manual.info.tmp,  Node: faqs-cjk,  Next: faqs-connectors-apis,  Prev: faqs-mysql-cluster,  Up: faqs

A.11 MySQL 5.5 FAQ: MySQL Chinese, Japanese, and Korean Character Sets
======================================================================

This set of Frequently Asked Questions derives from the experience of
MySQL's Support and Development groups in handling many inquiries about
CJK (Chinese-Japanese-Korean) issues.

What CJK character sets are available in MySQL?

The list of CJK character sets may vary depending on your MySQL version.
For example, the 'gb18030' character set is not supported prior to MySQL
5.7.4.  However, since the name of the applicable language appears in
the 'DESCRIPTION' column for every entry in the *note
'INFORMATION_SCHEMA.CHARACTER_SETS': character-sets-table. table, you
can obtain a current list of all the non-Unicode CJK character sets
using this query:

     mysql> SELECT CHARACTER_SET_NAME, DESCRIPTION
            FROM INFORMATION_SCHEMA.CHARACTER_SETS
            WHERE DESCRIPTION LIKE '%Chin%'
            OR DESCRIPTION LIKE '%Japanese%'
            OR DESCRIPTION LIKE '%Korean%'
            ORDER BY CHARACTER_SET_NAME;
     +--------------------+---------------------------------+
     | CHARACTER_SET_NAME | DESCRIPTION                     |
     +--------------------+---------------------------------+
     | big5               | Big5 Traditional Chinese        |
     | cp932              | SJIS for Windows Japanese       |
     | eucjpms            | UJIS for Windows Japanese       |
     | euckr              | EUC-KR Korean                   |
     | gb18030            | China National Standard GB18030 |
     | gb2312             | GB2312 Simplified Chinese       |
     | gbk                | GBK Simplified Chinese          |
     | sjis               | Shift-JIS Japanese              |
     | ujis               | EUC-JP Japanese                 |
     +--------------------+---------------------------------+

(For more information, see *note character-sets-table::.)

MySQL supports three variants of the _GB_ (_Guojia Biaozhun_, or
_National Standard_, or _Simplified Chinese_) character sets which are
official in the People's Republic of China: 'gb2312', 'gbk', and (as of
MySQL 5.7.4) 'gb18030'.

Sometimes people try to insert 'gbk' characters into 'gb2312', and it
works most of the time because 'gbk' is a superset of 'gb2312'.  But
eventually they try to insert a rarer Chinese character and it does not
work.  (For an example, see Bug #16072).

Here, we try to clarify exactly what characters are legitimate in
'gb2312' or 'gbk', with reference to the official documents.  Please
check these references before reporting 'gb2312' or 'gbk' bugs:

   * The MySQL 'gbk' character set is in reality 'Microsoft code page
     936'.  This differs from the official 'gbk' for characters 'A1A4'
     (middle dot), 'A1AA' (em dash), 'A6E0-A6F5', and 'A8BB-A8C0'.

   * For a listing of 'gbk'/Unicode mappings, see
     <http://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WINDOWS/CP936.TXT>.

It is also possible to store CJK characters in Unicode character sets,
although the available collations may not sort characters quite as you
expect:

   * The 'utf8' and 'ucs2' character sets support the characters from
     Unicode Basic Multilingual Plane (BMP). These characters have code
     point values between 'U+0000' and 'U+FFFF'.

   * The 'utf8mb4', 'utf16', 'utf16le', and 'utf32' character sets
     support BMP characters, as well as supplementary characters that
     lie outside the BMP. Supplementary characters have code point
     values between 'U+10000' and 'U+10FFFF'.

The collation used for a Unicode character set determines the ability to
sort (that is, distinguish) characters in the set:

   * Collations based on Unicode Collation Algorithm (UCA) 4.0.0
     distinguish only BMP characters.

   * Collations based on UCA 5.2.0 or 9.0.0 distinguish BMP and
     supplementary characters.

   * Non-UCA collations may not distinguish all Unicode characters.  For
     example, the 'utf8mb4' default collation is 'utf8mb4_general_ci',
     which distinguishes only BMP characters.

Moreover, distinguishing characters is not the same as ordering them per
the conventions of a given CJK language.  Currently, MySQL has only one
CJK-specific UCA collation, 'gb18030_unicode_520_ci' (which requires use
of the non-Unicode 'gb18030' character set).

For information about Unicode collations and their differentiating
properties, including collation properties for supplementary characters,
see *note charset-unicode-sets::.

I have inserted CJK characters into my table.  Why does *note 'SELECT':
select. display them as '?' characters?

This problem is usually due to a setting in MySQL that does not match
the settings for the application program or the operating system.  Here
are some common steps for correcting these types of issues:

   * _Be certain of what MySQL version you are using_.

     Use the statement 'SELECT VERSION();' to determine this.

   * _Make sure that the database is actually using the desired
     character set_.

     People often think that the client character set is always the same
     as either the server character set or the character set used for
     display purposes.  However, both of these are false assumptions.
     You can make sure by checking the result of 'SHOW CREATE TABLE
     TABLENAME' or, better yet, by using this statement:

          SELECT character_set_name, collation_name
              FROM information_schema.columns
              WHERE table_schema = your_database_name
                  AND table_name = your_table_name
                  AND column_name = your_column_name;

   * _Determine the hexadecimal value of the character or characters
     that are not being displayed correctly_.

     You can obtain this information for a column COLUMN_NAME in the
     table TABLE_NAME using the following query:

          SELECT HEX(COLUMN_NAME)
          FROM TABLE_NAME;

     '3F' is the encoding for the '?' character; this means that '?' is
     the character actually stored in the column.  This most often
     happens because of a problem converting a particular character from
     your client character set to the target character set.

   * _Make sure that a round trip is possible.  When you select LITERAL
     (or _INTRODUCER HEXADECIMAL-VALUE), do you obtain LITERAL as a
     result_?

     For example, the Japanese Katakana character _Pe_ (''') exists
     in all CJK character sets, and has the code point value
     (hexadecimal coding) '0x30da'.  To test a round trip for this
     character, use this query:

          SELECT '' AS ``;         /* or SELECT _ucs2 0x30da; */

     If the result is not also '', the round trip failed.

     For bug reports regarding such failures, we might ask you to follow
     up with 'SELECT HEX('');'.  Then we can determine whether the
     client encoding is correct.

   * _Make sure that the problem is not with the browser or other
     application, rather than with MySQL_.

     Use the *note 'mysql': mysql. client program to accomplish this
     task.  If *note 'mysql': mysql. displays characters correctly but
     your application does not, your problem is probably due to system
     settings.

     To determine your settings, use the *note 'SHOW VARIABLES':
     show-variables. statement, whose output should resemble what is
     shown here:

          mysql> SHOW VARIABLES LIKE 'char%';
          +--------------------------+----------------------------------------+
          | Variable_name            | Value                                  |
          +--------------------------+----------------------------------------+
          | character_set_client     | utf8                                   |
          | character_set_connection | utf8                                   |
          | character_set_database   | latin1                                 |
          | character_set_filesystem | binary                                 |
          | character_set_results    | utf8                                   |
          | character_set_server     | latin1                                 |
          | character_set_system     | utf8                                   |
          | character_sets_dir       | /usr/local/mysql/share/mysql/charsets/ |
          +--------------------------+----------------------------------------+

     These are typical character-set settings for an
     international-oriented client (notice the use of 'utf8' Unicode)
     connected to a server in the West ('latin1' is a West Europe
     character set).

     Although Unicode (usually the 'utf8' variant on Unix, and the
     'ucs2' variant on Windows) is preferable to Latin, it is often not
     what your operating system utilities support best.  Many Windows
     users find that a Microsoft character set, such as 'cp932' for
     Japanese Windows, is suitable.

     If you cannot control the server settings, and you have no idea
     what setting your underlying computer uses, try changing to a
     common character set for the country that you're in ('euckr' =
     Korea; 'gb18030', 'gb2312' or 'gbk' = People's Republic of China;
     'big5' = Taiwan; 'sjis', 'ujis', 'cp932', or 'eucjpms' = Japan;
     'ucs2' or 'utf8' = anywhere).  Usually it is necessary to change
     only the client and connection and results settings.  The *note
     'SET NAMES': set-names.  statement changes all three at once.  For
     example:

          SET NAMES 'big5';

     Once the setting is correct, you can make it permanent by editing
     'my.cnf' or 'my.ini'.  For example you might add lines looking like
     these:

          [mysqld]
          character-set-server=big5
          [client]
          default-character-set=big5

     It is also possible that there are issues with the API
     configuration setting being used in your application; see 'Why does
     my GUI front end or browser not display CJK characters
     correctly...?' for more information.

What problems should I be aware of when working with the Big5 Chinese
character set?

MySQL supports the Big5 character set which is common in Hong Kong and
Taiwan (Republic of China).  The MySQL 'big5' character set is in
reality Microsoft code page 950, which is very similar to the original
'big5' character set.

A feature request for adding 'HKSCS' extensions has been filed.  People
who need this extension may find the suggested patch for Bug #13577 to
be of interest.

Why do Japanese character set conversions fail?

MySQL supports the 'sjis', 'ujis', 'cp932', and 'eucjpms' character
sets, as well as Unicode.  A common need is to convert between character
sets.  For example, there might be a Unix server (typically with 'sjis'
or 'ujis') and a Windows client (typically with 'cp932').

In the following conversion table, the 'ucs2' column represents the
source, and the 'sjis', 'cp932', 'ujis', and 'eucjpms' columns represent
the destinations; that is, the last 4 columns provide the hexadecimal
result when we use 'CONVERT(ucs2)' or we assign a 'ucs2' column
containing the value to an 'sjis', 'cp932', 'ujis', or 'eucjpms' column.

Character Name                ucs2      sjis      cp932     ujis      eucjpms
                                                                      
BROKEN BAR                    00A6      3F        3F        8FA2C3    3F
                                                                      
FULLWIDTH BROKEN BAR          FFE4      3F        FA55      3F        8FA2
                                                                      
YEN SIGN                      00A5      3F        3F        20        3F
                                                                      
FULLWIDTH YEN SIGN            FFE5      818F      818F      A1EF      3F
                                                                      
TILDE                         007E      7E        7E        7E        7E
                                                                      
OVERLINE                      203E      3F        3F        20        3F
                                                                      
HORIZONTAL BAR                2015      815C      815C      A1BD      A1BD
                                                                      
EM DASH                       2014      3F        3F        3F        3F
                                                                      
REVERSE SOLIDUS               005C      815F      5C        5C        5C
                                                                      
FULLWIDTH ""                  FF3C      3F        815F      3F        A1C0
                                                                      
WAVE DASH                     301C      8160      3F        A1C1      3F
                                                                      
FULLWIDTH TILDE               FF5E      3F        8160      3F        A1C1
                                                                      
DOUBLE VERTICAL LINE          2016      8161      3F        A1C2      3F
                                                                      
PARALLEL TO                   2225      3F        8161      3F        A1C2
                                                                      
MINUS SIGN                    2212      817C      3F        A1DD      3F
                                                                      
FULLWIDTH HYPHEN-MINUS        FF0D      3F        817C      3F        A1DD
                                                                      
CENT SIGN                     00A2      8191      3F        A1F1      3F
                                                                      
FULLWIDTH CENT SIGN           FFE0      3F        8191      3F        A1F1
                                                                      
POUND SIGN                    00A3      8192      3F        A1F2      3F
                                                                      
FULLWIDTH POUND SIGN          FFE1      3F        8192      3F        A1F2
                                                                      
NOT SIGN                      00AC      81CA      3F        A2CC      3F
                                                                      
FULLWIDTH NOT SIGN            FFE2      3F        81CA      3F        A2CC
                                                            

Now consider the following portion of the table.

                                         ucs2        sjis        cp932
                                                                 
NOT SIGN                                 00AC        81CA        3F
                                                                 
FULLWIDTH NOT SIGN                       FFE2        3F          81CA
                                                     

This means that MySQL converts the 'NOT SIGN' (Unicode 'U+00AC') to
'sjis' code point '0x81CA' and to 'cp932' code point '3F'.  ('3F' is the
question mark ('?'.  This is what is always used when the conversion
cannot be performed.)

What should I do if I want to convert SJIS '81CA' to 'cp932'?

Our answer is: '?'.  There are disadvantages to this, and many people
would prefer a 'loose' conversion, so that '81CA (NOT SIGN)' in 'sjis'
becomes '81CA (FULLWIDTH NOT SIGN)' in 'cp932'.

How does MySQL represent the Yen ('') sign?

A problem arises because some versions of Japanese character sets (both
'sjis' and 'euc') treat '5C' as a _reverse solidus_ ('\', also known as
a backslash), whereas others treat it as a yen sign ('').

MySQL follows only one version of the JIS (Japanese Industrial
Standards) standard description.  In MySQL, _'5C' is always the reverse
solidus ('\')_.

Of what issues should I be aware when working with Korean character sets
in MySQL?

In theory, while there have been several versions of the 'euckr'
(_Extended Unix Code Korea_) character set, only one problem has been
noted.  We use the 'ASCII' variant of EUC-KR, in which the code point
'0x5c' is REVERSE SOLIDUS, that is '\', instead of the 'KS-Roman'
variant of EUC-KR, in which the code point '0x5c' is 'WON SIGN' ('').
This means that you cannot convert Unicode 'U+20A9' to 'euckr':

     mysql> SELECT
                CONVERT('' USING euckr) AS euckr,
                HEX(CONVERT('' USING euckr)) AS hexeuckr;
     +-------+----------+
     | euckr | hexeuckr |
     +-------+----------+
     | ?     | 3F       |
     +-------+----------+

Why do I get 'Incorrect string value' error messages?

To see the problem, create a table with one Unicode ('ucs2') column and
one Chinese ('gb2312') column.

     mysql> CREATE TABLE ch
            (ucs2 CHAR(3) CHARACTER SET ucs2,
            gb2312 CHAR(3) CHARACTER SET gb2312);

In nonstrict SQL mode, try to place the rare character '' in both
columns.

     mysql> SET sql_mode = '';
     mysql> INSERT INTO ch VALUES ('AB','AB');
     Query OK, 1 row affected, 1 warning (0.00 sec)

The *note 'INSERT': insert. produces a warning.  Use the following
statement to see what it is:

     mysql> SHOW WARNINGS\G
     *************************** 1. row ***************************
       Level: Warning
        Code: 1366
     Message: Incorrect string value: '\xE6\xB1\x8CB' for column 'gb2312' at row 1

So it is a warning about the 'gb2312' column only.

     mysql> SELECT ucs2,HEX(ucs2),gb2312,HEX(gb2312) FROM ch;
     +-------+--------------+--------+-------------+
     | ucs2  | HEX(ucs2)    | gb2312 | HEX(gb2312) |
     +-------+--------------+--------+-------------+
     | AB | 00416C4C0042 | A?B    | 413F42      |
     +-------+--------------+--------+-------------+

Several things need explanation here:

  1. The '' character is not in the 'gb2312' character set, as
     described earlier.

  2. If you are using an old version of MySQL, you may see a different
     message.

  3. A warning occurs rather than an error because MySQL is not set to
     use strict SQL mode.  In nonstrict mode, MySQL tries to do what it
     can, to get the best fit, rather than give up.  With strict SQL
     mode, the 'Incorrect string value' message occurs as an error
     rather than a warning, and the *note 'INSERT': insert. fails.

Why does my GUI front end or browser display CJK characters incorrectly
in my application using Access, PHP, or another API?

Obtain a direct connection to the server using the *note 'mysql': mysql.
client, and try the same query there.  If *note 'mysql': mysql. responds
correctly, the trouble may be that your application interface requires
initialization.  Use *note 'mysql': mysql. to tell you what character
set or sets it uses with the statement 'SHOW VARIABLES LIKE 'char%';'.
If you are using Access, you are most likely connecting with
Connector/ODBC. In this case, you should check Configuring
Connector/ODBC
(https://dev.mysql.com/doc/connector-odbc/en/connector-odbc-configuration.html).
If, for example, you use 'big5', you would enter 'SET NAMES 'big5''.
(In this case, no ';' character is required.)  If you are using ASP, you
might need to add *note 'SET NAMES': set-names. in the code.  Here is an
example that has worked in the past:

     <%
     Session.CodePage=0
     Dim strConnection
     Dim Conn
     strConnection="driver={MySQL ODBC 3.51 Driver};server=SERVER;uid=USERNAME;" \
                    & "pwd=PASSWORD;database=DATABASE;stmt=SET NAMES 'big5';"
     Set Conn = Server.CreateObject("ADODB.Connection")
     Conn.Open strConnection
     %>

In much the same way, if you are using any character set other than
'latin1' with Connector/NET, you must specify the character set in the
connection string.  See Connecting to MySQL Using Connector/NET
(https://dev.mysql.com/doc/connector-net/en/connector-net-programming-connecting.html),
for more information.

If you are using PHP, try this:

     <?php
       $link = new mysqli($host, $usr, $pwd, $db);

       if( mysqli_connect_errno() )
       {
         printf("Connect failed: %s\n", mysqli_connect_error());
         exit();
       }

       $link->query("SET NAMES 'utf8'");
     ?>

In this case, we used *note 'SET NAMES': set-names. to change
'character_set_client', 'character_set_connection', and
'character_set_results'.

Another issue often encountered in PHP applications has to do with
assumptions made by the browser.  Sometimes adding or changing a
'<meta>' tag suffices to correct the problem: for example, to insure
that the user agent interprets page content as 'UTF-8', include '<meta
http-equiv="Content-Type" content="text/html; charset=utf-8">' in the
'<head>' section of the HTML page.

If you are using Connector/J, see Using Character Sets and Unicode
(https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-charsets.html).

I've upgraded to MySQL 5.5.  How can I revert to behavior like that in
MySQL 4.0 with regard to character sets?

In MySQL Version 4.0, there was a single 'global' character set for both
server and client, and the decision as to which character to use was
made by the server administrator.  This changed starting with MySQL
Version 4.1.  What happens now is a 'handshake', as described in *note
charset-connection:::

When a client connects, it sends to the server the name of the character
set that it wants to use.  The server uses the name to set the
'character_set_client', 'character_set_results', and
'character_set_connection' system variables.  In effect, the server
performs a *note 'SET NAMES': set-names. operation using the character
set name.

The effect of this is that you cannot control the client character set
by starting *note 'mysqld': mysqld. with '--character-set-server=utf8'.
However, some Asian customers prefer the MySQL 4.0 behavior.  To make it
possible to retain this behavior, we added a *note 'mysqld': mysqld.
switch, '--character-set-client-handshake', which can be turned off with
'--skip-character-set-client-handshake'.  If you start *note 'mysqld':
mysqld. with '--skip-character-set-client-handshake', then, when a
client connects, it sends to the server the name of the character set
that it wants to use.  However, _the server ignores this request from
the client_.

By way of example, suppose that your favorite server character set is
'latin1'.  Suppose further that the client uses 'utf8' because this is
what the client's operating system supports.  Start the server with
'latin1' as its default character set:

     mysqld --character-set-server=latin1

And then start the client with the default character set 'utf8':

     mysql --default-character-set=utf8

The resulting settings can be seen by viewing the output of *note 'SHOW
VARIABLES': show-variables.:

     mysql> SHOW VARIABLES LIKE 'char%';
     +--------------------------+----------------------------------------+
     | Variable_name            | Value                                  |
     +--------------------------+----------------------------------------+
     | character_set_client     | utf8                                   |
     | character_set_connection | utf8                                   |
     | character_set_database   | latin1                                 |
     | character_set_filesystem | binary                                 |
     | character_set_results    | utf8                                   |
     | character_set_server     | latin1                                 |
     | character_set_system     | utf8                                   |
     | character_sets_dir       | /usr/local/mysql/share/mysql/charsets/ |
     +--------------------------+----------------------------------------+

Now stop the client, and stop the server using *note 'mysqladmin':
mysqladmin.  Then start the server again, but this time tell it to skip
the handshake like so:

     mysqld --character-set-server=utf8 --skip-character-set-client-handshake

Start the client with 'utf8' once again as the default character set,
then display the resulting settings:

     mysql> SHOW VARIABLES LIKE 'char%';
     +--------------------------+----------------------------------------+
     | Variable_name            | Value                                  |
     +--------------------------+----------------------------------------+
     | character_set_client     | latin1                                 |
     | character_set_connection | latin1                                 |
     | character_set_database   | latin1                                 |
     | character_set_filesystem | binary                                 |
     | character_set_results    | latin1                                 |
     | character_set_server     | latin1                                 |
     | character_set_system     | utf8                                   |
     | character_sets_dir       | /usr/local/mysql/share/mysql/charsets/ |
     +--------------------------+----------------------------------------+

As you can see by comparing the differing results from *note 'SHOW
VARIABLES': show-variables, the server ignores the client's initial
settings if the '--skip-character-set-client-handshake' option is used.

Why do some 'LIKE' and 'FULLTEXT' searches with CJK characters fail?

For 'LIKE' searches, there is a very simple problem with binary string
column types such as *note 'BINARY': binary-varbinary. and *note 'BLOB':
blob.: we must know where characters end.  With multibyte character
sets, different characters might have different octet lengths.  For
example, in 'utf8', 'A' requires one byte but '' requires three
bytes, as shown here:

     +-------------------------+---------------------------+
     | OCTET_LENGTH(_utf8 'A') | OCTET_LENGTH(_utf8 '') |
     +-------------------------+---------------------------+
     |                       1 |                         3 |
     +-------------------------+---------------------------+

If we do not know where the first character in a string ends, we do not
know where the second character begins, in which case even very simple
searches such as 'LIKE '_A%'' fail.  The solution is to use a nonbinary
string column type defined to have the proper CJK character set.  For
example: 'mycol TEXT CHARACTER SET sjis'.  Alternatively, convert to a
CJK character set before comparing.

This is one reason why MySQL cannot permit encodings of nonexistent
characters.  If it is not strict about rejecting bad input, it has no
way of knowing where characters end.

For 'FULLTEXT' searches, we must know where words begin and end.  With
Western languages, this is rarely a problem because most (if not all) of
these use an easy-to-identify word boundary: the space character.
However, this is not usually the case with Asian writing.  We could use
arbitrary halfway measures, like assuming that all Han characters
represent words, or (for Japanese) depending on changes from Katakana to
Hiragana due to grammatical endings.  However, the only sure solution
requires a comprehensive word list, which means that we would have to
include a dictionary in the server for each Asian language supported.
This is simply not feasible.

How do I know whether character X is available in all character sets?

The majority of simplified Chinese and basic nonhalfwidth Japanese Kana
characters appear in all CJK character sets.  The following stored
procedure accepts a 'UCS-2' Unicode character, converts it to other
character sets, and displays the results in hexadecimal.

     DELIMITER //

     CREATE PROCEDURE p_convert(ucs2_char CHAR(1) CHARACTER SET ucs2)
     BEGIN

     CREATE TABLE tj
                  (ucs2 CHAR(1) character set ucs2,
                   utf8 CHAR(1) character set utf8,
                   big5 CHAR(1) character set big5,
                   cp932 CHAR(1) character set cp932,
                   eucjpms CHAR(1) character set eucjpms,
                   euckr CHAR(1) character set euckr,
                   gb2312 CHAR(1) character set gb2312,
                   gbk CHAR(1) character set gbk,
                   sjis CHAR(1) character set sjis,
                   ujis CHAR(1) character set ujis);

     INSERT INTO tj (ucs2) VALUES (ucs2_char);

     UPDATE tj SET utf8=ucs2,
                   big5=ucs2,
                   cp932=ucs2,
                   eucjpms=ucs2,
                   euckr=ucs2,
                   gb2312=ucs2,
                   gbk=ucs2,
                   sjis=ucs2,
                   ujis=ucs2;

     /* If there are conversion problems, UPDATE produces warnings. */

     SELECT hex(ucs2) AS ucs2,
            hex(utf8) AS utf8,
            hex(big5) AS big5,
            hex(cp932) AS cp932,
            hex(eucjpms) AS eucjpms,
            hex(euckr) AS euckr,
            hex(gb2312) AS gb2312,
            hex(gbk) AS gbk,
            hex(sjis) AS sjis,
            hex(ujis) AS ujis
     FROM tj;

     DROP TABLE tj;

     END//

     DELIMITER ;

The input can be any single 'ucs2' character, or it can be the code
value (hexadecimal representation) of that character.  For example, from
Unicode's list of 'ucs2' encodings and names
(<http://www.unicode.org/Public/UNIDATA/UnicodeData.txt>), we know that
the Katakana character _Pe_ appears in all CJK character sets, and that
its code value is 'X'30DA''.  If we use this value as the argument to
'p_convert()', the result is as shown here:

     mysql> CALL p_convert(X'30DA');
     +------+--------+------+-------+---------+-------+--------+------+------+------+
     | ucs2 | utf8   | big5 | cp932 | eucjpms | euckr | gb2312 | gbk  | sjis | ujis |
     +------+--------+------+-------+---------+-------+--------+------+------+------+
     | 30DA | E3839A | C772 | 8379  | A5DA    | ABDA  | A5DA   | A5DA | 8379 | A5DA |
     +------+--------+------+-------+---------+-------+--------+------+------+------+

Since none of the column values is '3F' (that is, the question mark
character, '?'), we know that every conversion worked.

Why do CJK strings sort incorrectly in Unicode?  (I)

*Note*:

The CJK sorting problems described here can occur for MySQL versions
prior to MySQL 8.0.  As of MySQL 8.0, they can be solved by using the
'utf8mb4' character set and the 'utf8mb4_ja_0900_as_cs' collation.

Sometimes people observe that the result of a 'utf8_unicode_ci' or
'ucs2_unicode_ci' search, or of an 'ORDER BY' sort is not what they
think a native would expect.  Although we never rule out the possibility
that there is a bug, we have found in the past that many people do not
correctly read the standard table of weights for the Unicode Collation
Algorithm.  MySQL uses the tables found under
<http://www.unicode.org/Public/UCA/>:

   * UCA 4.0.0 table:
     <http://www.unicode.org/Public/UCA/4.0.0/allkeys-4.0.0.txt>

     This includes 'XXX_unicode_ci' collations with no version number in
     the collation name.

   * UCA 5.2.0 table:
     <http://www.unicode.org/Public/UCA/5.2.0/allkeys.txt>

     This includes collations with '_520_' in the collation name.

   * UCA 9.0.0 table:
     <http://www.unicode.org/Public/UCA/9.0.0/allkeys.txt>

     This includes collations with '_0900_' in the collation name.

To handle newer UCA versions, we create new collations.  We are very
wary about changing ordering of existing collations because that affects
indexes, which can bring about situations such as that reported in Bug
#16526, illustrated as follows:

     mysql> CREATE TABLE tj (s1 CHAR(1) CHARACTER SET utf8 COLLATE utf8_unicode_ci);
     Query OK, 0 rows affected (0.05 sec)

     mysql> INSERT INTO tj VALUES (''),('');
     Query OK, 2 rows affected (0.00 sec)
     Records: 2  Duplicates: 0  Warnings: 0

     mysql> SELECT * FROM tj WHERE s1 = '';
     +------+
     | s1   |
     +------+
     |   |
     |   |
     +------+

The character in the first result row is not the one that we searched
for.  Why did MySQL retrieve it?  First we look for the Unicode code
point value, which is possible by reading the hexadecimal number for the
'ucs2' version of the characters:

     mysql> SELECT s1, HEX(CONVERT(s1 USING ucs2)) FROM tj;
     +------+-----------------------------+
     | s1   | HEX(CONVERT(s1 USING ucs2)) |
     +------+-----------------------------+
     |   | 304C                        |
     |   | 304B                        |
     +------+-----------------------------+

Now we search for '304B' and '304C' in the '4.0.0 allkeys' table, and
find these lines:

     304B  ; [.1E57.0020.000E.304B] # HIRAGANA LETTER KA
     304C  ; [.1E57.0020.000E.304B][.0000.0140.0002.3099] # HIRAGANA LETTER GA; QQCM

The official Unicode names (following the '#' mark) tell us the Japanese
syllabary (Hiragana), the informal classification (letter, digit, or
punctuation mark), and the Western identifier ('KA' or 'GA', which
happen to be voiced and unvoiced components of the same letter pair).
More importantly, the _primary weight_ (the first hexadecimal number
inside the square brackets) is '1E57' on both lines.  For comparisons in
both searching and sorting, MySQL pays attention to the primary weight
only, ignoring all the other numbers.  This means that we are sorting
'' and '' correctly according to the Unicode specification.  If we
wanted to distinguish them, we'd have to use a non-UCA (Unicode
Collation Algorithm) collation ('utf8_bin' or 'utf8_general_ci'), or to
compare the 'HEX()' values, or use 'ORDER BY CONVERT(s1 USING sjis)'.
Being correct 'according to Unicode' is not enough, of course: the
person who submitted the bug was equally correct.  To solve this, we
need another collation for Japanese according to the JIS X 4061
standard, in which voiced/unvoiced letter pairs like 'KA'/'GA' are
distinguishable for ordering purposes.

Why do CJK strings sort incorrectly in Unicode?  (II)

*Note*:

The CJK sorting problems described here can occur for MySQL versions
prior to MySQL 8.0.  As of MySQL 8.0, they can be solved by using the
'utf8mb4' character set and the 'utf8mb4_ja_0900_as_cs' collation.

If you are using Unicode ('ucs2' or 'utf8'), and you know what the
Unicode sort order is (see *note faqs-cjk::), but MySQL still seems to
sort your table incorrectly, first verify the character set in the table
definition:

     mysql> SHOW CREATE TABLE t\G
     ******************** 1. row ******************
     Table: t
     Create Table: CREATE TABLE `t` (
     `s1` char(1) CHARACTER SET ucs2 DEFAULT NULL
     ) ENGINE=MyISAM DEFAULT CHARSET=latin1

Since the character set for the column 's1' appears to be correct
('ucs2'), check what information the *note 'INFORMATION_SCHEMA.COLUMNS':
columns-table. table can provide about this column:

     mysql> SELECT COLUMN_NAME, CHARACTER_SET_NAME, COLLATION_NAME
            FROM INFORMATION_SCHEMA.COLUMNS
            WHERE COLUMN_NAME = 's1'
            AND TABLE_NAME = 't';
     +-------------+--------------------+-----------------+
     | COLUMN_NAME | CHARACTER_SET_NAME | COLLATION_NAME  |
     +-------------+--------------------+-----------------+
     | s1          | ucs2               | ucs2_general_ci |
     +-------------+--------------------+-----------------+

(See *note columns-table::, for more information.)

You can see that the collation is 'ucs2_general_ci' instead of
'ucs2_unicode_ci'.  The reason why this is so can be found using *note
'SHOW CHARACTER SET': show-character-set, as shown here:

     mysql> SHOW CHARSET LIKE 'ucs2%';
     +---------+---------------+-------------------+--------+
     | Charset | Description   | Default collation | Maxlen |
     +---------+---------------+-------------------+--------+
     | ucs2    | UCS-2 Unicode | ucs2_general_ci   |      2 |
     +---------+---------------+-------------------+--------+

For 'ucs2' and 'utf8', the default collation is 'general'.  To specify a
Unicode UCA collation, use 'COLLATE ucs2_unicode_ci', as shown in the
preceding item.

Why are my supplementary characters rejected by MySQL?

Supplementary characters lie outside the Unicode _Basic Multilingual
Plane / Plane 0_.  BMP characters have code point values between
'U+0000' and 'U+FFFF'.  Supplementary characters have code point values
between 'U+10000' and 'U+10FFFF'.

To store supplementary characters, you must use a character set that
permits them:

   * The 'utf8' and 'ucs2' character sets support BMP characters only.

     The 'utf8' character set permits only 'UTF-8' characters that take
     up to three bytes.  This has led to reports such as that found in
     Bug #12600, which we rejected as 'not a bug'.  With 'utf8', MySQL
     must truncate an input string when it encounters bytes that it does
     no understand.  Otherwise, it is unknown how long the bad multibyte
     character is.

     One possible workaround is to use 'ucs2' instead of 'utf8', in
     which case the 'bad' characters are changed to question marks.
     However, no truncation takes place.  You can also change the data
     type to *note 'BLOB': blob. or *note 'BINARY': binary-varbinary,
     which perform no validity checking.

   * The 'utf8mb4', 'utf16', 'utf16le', and 'utf32' character sets
     support BMP characters, as well as supplementary characters outside
     the BMP.

Should 'CJK' be 'CJKV'?

No.  The term 'CJKV' (_Chinese Japanese Korean Vietnamese_) refers to
Vietnamese character sets which contain Han (originally Chinese)
characters.  MySQL supports the modern Vietnamese script with Western
characters, but does not support the old Vietnamese script using Han
characters.

Does MySQL permit CJK characters to be used in database and table names?

Yes.

Where can I find translations of the MySQL Manual into Chinese,
Japanese, and Korean?

The Japanese translation of the MySQL 5.6 manual can be downloaded from
<https://dev.mysql.com/doc/>.

Where can I get help with CJK and related issues in MySQL?

The following resources are available:

   * A listing of MySQL user groups can be found at
     <https://wikis.oracle.com/display/mysql/List+of+MySQL+User+Groups>.

   * View feature requests relating to character set issues at
     <http://tinyurl.com/y6xcuf>.

   * Visit the MySQL Collation, Unicode Forum.
     <http://forums.mysql.com/> also provides foreign-language forums.


File: manual.info.tmp,  Node: faqs-connectors-apis,  Next: faqs-c-api,  Prev: faqs-cjk,  Up: faqs

A.12 MySQL 5.5 FAQ: Connectors & APIs
=====================================

For common questions, issues, and answers relating to the MySQL
Connectors and other APIs, see the following areas of the Manual:

   * *note c-api-common-issues::

   * Common Problems with MySQL and PHP
     (https://dev.mysql.com/doc/apis-php/en/apis-php-problems.html)

   * Connector/ODBC Notes and Tips
     (https://dev.mysql.com/doc/connector-odbc/en/connector-odbc-usagenotes.html)

   * Connector/NET Programming
     (https://dev.mysql.com/doc/connector-net/en/connector-net-programming.html)

   * MySQL Connector/J 5.1 Developer Guide
     (https://dev.mysql.com/doc/connector-j/5.1/en/)


File: manual.info.tmp,  Node: faqs-c-api,  Next: faqs-replication,  Prev: faqs-connectors-apis,  Up: faqs

A.13 MySQL 5.5 FAQ: C API, libmysql
===================================

Frequently asked questions about MySQL C API and libmysql.

What is 'MySQL Native C API'?  What are typical benefits and use cases?

libmysql is a C-based API that you can use in C applications to connect
with the MySQL database server.  It is also itself used as the
foundation for drivers for standard database APIs like ODBC, Perl's DBI,
and Python's DB API.

Which version of libmysql should I use?

For MySQL 8.0, 5.7, 5.6, and 5.5, we recommend libmysql 8.0.

What if I want to use the 'NoSQL' X DevAPI?

For C-language and X DevApi Document Store for MySQL 8.0, we recommend
MySQL Connector/C++.  Connector/C++ 8.0 has compatible C headers.  (This
is not applicable to MySQL 5.7 or before.)

How to I download libmysql?

   * Linux: The Client Utilities Package is available from the MySQL
     Community Server (https://dev.mysql.com/downloads/mysql/) download
     page.

   * Repos: The Client Utilities Package is available from the Yum
     (https://dev.mysql.com/downloads/repo/yum/), APT
     (https://dev.mysql.com/downloads/repo/apt/), SuSE repositories
     (https://dev.mysql.com/downloads/repo/suse/).

   * Windows: The Client Utilities Package is available from Windows
     Installer (https://dev.mysql.com/downloads/installer/).

Where is the documentation?

See *note c-api::.

How do I report bugs?

Please report any bugs or inconsistencies you observe to our Bugs
Database (https://bugs.mysql.com/).  Select the C API Client as shown.

Is it possible to compile the library myself?

Yes, you can download the libmysqlclient source code and compile it on
your own.  Here's an example:

     $ git clone --depth 1 https://github.com/mysql/mysql-server
     $ cd mysql-server
     $ mkdir build
     $ cd build
     $ cmake .. -GNinja -DDOWNLOAD_BOOST=1 \
                -DWITH_BOOST=/tmp -DCMAKE_BUILD_TYPE=Release -DWITHOUT_SERVER=ON \
                -DWITH_SSL=system
     $ ninja libmysqlclient.a
     $ ls -la archive_output_directory/libmysqlclient.a
     -rw-rw-r-- 1 kg kg 8,5M wrz 5 04:57 archive_output_directory/libmysqlclient.a

*Note*:

This example uses https://ninja-build.org/ as a build system instead of
make.


File: manual.info.tmp,  Node: faqs-replication,  Next: faqs-thread-pool,  Prev: faqs-c-api,  Up: faqs

A.14 MySQL 5.5 FAQ: Replication
===============================

In the following section, we provide answers to questions that are most
frequently asked about MySQL Replication.

Must the slave be connected to the master all the time?

No, it does not.  The slave can go down or stay disconnected for hours
or even days, and then reconnect and catch up on updates.  For example,
you can set up a master/slave relationship over a dial-up link where the
link is up only sporadically and for short periods of time.  The
implication of this is that, at any given time, the slave is not
guaranteed to be in synchrony with the master unless you take some
special measures.

To ensure that catchup can occur for a slave that has been disconnected,
you must not remove binary log files from the master that contain
information that has not yet been replicated to the slaves.
Asynchronous replication can work only if the slave is able to continue
reading the binary log from the point where it last read events.

Must I enable networking on my master and slave to enable replication?

Yes, networking must be enabled on the master and slave.  If networking
is not enabled, the slave cannot connect to the master and transfer the
binary log.  Verify that the 'skip_networking' system variable has not
been enabled in the configuration file for either server.

How do I know how late a slave is compared to the master?  In other
words, how do I know the date of the last statement replicated by the
slave?

Check the 'Seconds_Behind_Master' column in the output from *note 'SHOW
SLAVE STATUS': show-slave-status.  See *note
replication-administration-status::.

When the slave SQL thread executes an event read from the master, it
modifies its own time to the event timestamp.  (This is why *note
'TIMESTAMP': datetime. is well replicated.)  In the 'Time' column in the
output of *note 'SHOW PROCESSLIST': show-processlist, the number of
seconds displayed for the slave SQL thread is the number of seconds
between the timestamp of the last replicated event and the real time of
the slave machine.  You can use this to determine the date of the last
replicated event.  Note that if your slave has been disconnected from
the master for one hour, and then reconnects, you may immediately see
large 'Time' values such as 3600 for the slave SQL thread in *note 'SHOW
PROCESSLIST': show-processlist.  This is because the slave is executing
statements that are one hour old.  See *note
replication-implementation-details::.

How do I force the master to block updates until the slave catches up?

Use the following procedure:

  1. On the master, execute these statements:

          mysql> FLUSH TABLES WITH READ LOCK;
          mysql> SHOW MASTER STATUS;

     Record the replication coordinates (the current binary log file
     name and position) from the output of the *note 'SHOW': show.
     statement.

  2. On the slave, issue the following statement, where the arguments to
     the 'MASTER_POS_WAIT()' function are the replication coordinate
     values obtained in the previous step:

          mysql> SELECT MASTER_POS_WAIT('LOG_NAME', LOG_POS);

     The *note 'SELECT': select. statement blocks until the slave
     reaches the specified log file and position.  At that point, the
     slave is in synchrony with the master and the statement returns.

  3. On the master, issue the following statement to enable the master
     to begin processing updates again:

          mysql> UNLOCK TABLES;

What issues should I be aware of when setting up two-way replication?

MySQL replication currently does not support any locking protocol
between master and slave to guarantee the atomicity of a distributed
(cross-server) update.  In other words, it is possible for client A to
make an update to co-master 1, and in the meantime, before it propagates
to co-master 2, client B could make an update to co-master 2 that makes
the update of client A work differently than it did on co-master 1.
Thus, when the update of client A makes it to co-master 2, it produces
tables that are different from what you have on co-master 1, even after
all the updates from co-master 2 have also propagated.  This means that
you should not chain two servers together in a two-way replication
relationship unless you are sure that your updates can safely happen in
any order, or unless you take care of mis-ordered updates somehow in the
client code.

You should also realize that two-way replication actually does not
improve performance very much (if at all) as far as updates are
concerned.  Each server must do the same number of updates, just as you
would have a single server do.  The only difference is that there is a
little less lock contention because the updates originating on another
server are serialized in one slave thread.  Even this benefit might be
offset by network delays.

How can I use replication to improve performance of my system?

Set up one server as the master and direct all writes to it.  Then
configure as many slaves as you have the budget and rackspace for, and
distribute the reads among the master and the slaves.  You can also
start the slaves with the '--skip-innodb' option, enable the
'low_priority_updates' system variable, and set the 'delay_key_write'
system variable to 'ALL' to get speed improvements on the slave end.  In
this case, the slave uses nontransactional 'MyISAM' tables instead of
'InnoDB' tables to get more speed by eliminating transactional overhead.

What should I do to prepare client code in my own applications to use
performance-enhancing replication?

See the guide to using replication as a scale-out solution, *note
replication-solutions-scaleout::.

When and how much can MySQL replication improve the performance of my
system?

MySQL replication is most beneficial for a system that processes
frequent reads and infrequent writes.  In theory, by using a
single-master/multiple-slave setup, you can scale the system by adding
more slaves until you either run out of network bandwidth, or your
update load grows to the point that the master cannot handle it.

To determine how many slaves you can use before the added benefits begin
to level out, and how much you can improve performance of your site, you
must know your query patterns, and determine empirically by benchmarking
the relationship between the throughput for reads and writes on a
typical master and a typical slave.  The example here shows a rather
simplified calculation of what you can get with replication for a
hypothetical system.  Let 'reads' and 'writes' denote the number of
reads and writes per second, respectively.

Let's say that system load consists of 10% writes and 90% reads, and we
have determined by benchmarking that 'reads' is 1200 - 2 * 'writes'.  In
other words, the system can do 1,200 reads per second with no writes,
the average write is twice as slow as the average read, and the
relationship is linear.  Suppose that the master and each slave have the
same capacity, and that we have one master and N slaves.  Then we have
for each server (master or slave):

'reads' = 1200 - 2 * 'writes'

'reads' = 9 * 'writes' / (N + 1) (reads are split, but writes replicated
to all slaves)

9 * 'writes' / (N + 1) + 2 * 'writes' = 1200

'writes' = 1200 / (2 + 9/(N + 1))

The last equation indicates the maximum number of writes for N slaves,
given a maximum possible read rate of 1,200 per second and a ratio of
nine reads per write.

This analysis yields the following conclusions:

   * If N = 0 (which means we have no replication), our system can
     handle about 1200/11 = 109 writes per second.

   * If N = 1, we get up to 184 writes per second.

   * If N = 8, we get up to 400 writes per second.

   * If N = 17, we get up to 480 writes per second.

   * Eventually, as N approaches infinity (and our budget negative
     infinity), we can get very close to 600 writes per second,
     increasing system throughput about 5.5 times.  However, with only
     eight servers, we increase it nearly four times.

These computations assume infinite network bandwidth and neglect several
other factors that could be significant on your system.  In many cases,
you may not be able to perform a computation similar to the one just
shown that accurately predicts what will happen on your system if you
add N replication slaves.  However, answering the following questions
should help you decide whether and by how much replication will improve
the performance of your system:

   * What is the read/write ratio on your system?

   * How much more write load can one server handle if you reduce the
     reads?

   * For how many slaves do you have bandwidth available on your
     network?

How can I use replication to provide redundancy or high availability?

How you implement redundancy is entirely dependent on your application
and circumstances.  High-availability solutions (with automatic
failover) require active monitoring and either custom scripts or third
party tools to provide the failover support from the original MySQL
server to the slave.

To handle the process manually, you should be able to switch from a
failed master to a pre-configured slave by altering your application to
talk to the new server or by adjusting the DNS for the MySQL server from
the failed server to the new server.

For more information and some example solutions, see *note
replication-solutions-switch::.

How do I tell whether a master server is using statement-based or
row-based binary logging format?

Check the value of the 'binlog_format' system variable:

     mysql> SHOW VARIABLES LIKE 'binlog_format';

The value shown will be one of 'STATEMENT', 'ROW', or 'MIXED'.  For
'MIXED' mode, statement-based logging is used by default but replication
switches automatically to row-based logging under certain conditions,
such as unsafe statements.  For information about when this may occur,
see *note binary-log-mixed::.

How do I tell a slave to use row-based replication?

Slaves automatically know which format to use.

How do I prevent *note 'GRANT': grant. and *note 'REVOKE': revoke.
statements from replicating to slave machines?

Start the server with the '--replicate-wild-ignore-table=mysql.%' option
to ignore replication for tables in the 'mysql' database.

Does replication work on mixed operating systems (for example, the
master runs on Linux while slaves run on OS X and Windows)?

Yes.

Does replication work on mixed hardware architectures (for example, the
master runs on a 64-bit machine while slaves run on 32-bit machines)?

Yes.


File: manual.info.tmp,  Node: faqs-thread-pool,  Next: faqs-innodb-change-buffer,  Prev: faqs-replication,  Up: faqs

A.15 MySQL 5.5 FAQ: MySQL Enterprise Thread Pool
================================================

What is the Thread Pool and what problem does it solve?

The MySQL Thread Pool is a MySQL server plugin that extends the default
connection-handling capabilities of the MySQL server to limit the number
of concurrently executing statements/queries and transactions to ensure
that each has sufficient CPU and memory resources to fulfill its task.
For MySQL 5.5, the Thread Pool plugin is included in MySQL Enterprise
Edition, a commercial product.

The default thread-handling model in MySQL Server executes statements
using one thread per client connection.  As more clients connect to the
server and execute statements, overall performance degrades.  The Thread
Pool plugin provides an alternative thread-handling model designed to
reduce overhead and improve performance.  The Thread Pool plugin
increases server performance by efficiently managing statement execution
threads for large numbers of client connections, especially on modern
multi-CPU/Core systems.

For more information, see *note thread-pool::.

How does the Thread Pool limit and manage concurrent sessions and
transactions for optimal performance and throughput?

The Thread Pool uses a 'divide and conquer' approach to limiting and
balancing concurrency.  Unlike the default connection handling of the
MySQL Server, the Thread Pool separates connections and threads, so
there is no fixed relationship between connections and the threads that
execute statements received from those connections.  The Thread Pool
then manages client connections within configurable thread groups, where
they are prioritized and queued based on the nature of the work they
were submitted to accomplish.

For more information, see *note thread-pool-operation::.

How is the Thread Pool different from the client side Connection Pool?

The MySQL Connection Pool operates on the client side to ensure that a
MySQL client does not constantly connect to and disconnect from the
MySQL server.  It is designed to cache idle connections in the MySQL
client for use by other users as they are needed.  This minimizes the
overhead and expense of establishing and tearing down connections as
queries are submitted to the MySQL server.  The MySQL Connection Pool
has no visibility as to the query handling capabilities or load of the
back-end MySQL server.  By contrast, the Thread Pool operates on the
MySQL server side and is designed to manage the execution of inbound
concurrent connections and queries as they are received from the client
connections accessing the back-end MySQL database.  Because of the
separation of duties, the MySQL Connection Pool and Thread Pool are
orthogonal and can be used independent of each other.

MySQL Connection Pooling via the MySQL Connectors is covered in *note
connectors-apis::.

When should I use the Thread Pool?

There are a few rules of thumb to consider for optimal Thread Pool use
cases:

The MySQL 'Threads_running' variable keeps track of the number of
concurrent statements currently executing in the MySQL Server.  If this
variable consistently exceeds a region where the server won't operate
optimally (usually going beyond 40 for InnoDB workloads), the Thread
Pool will be beneficial, especially in extreme parallel overload
situations.

If you are using the 'innodb_thread_concurrency' to limit the number of
concurrently executing statements, you will find the Thread Pool solves
the same problem, only better, by assigning connections to thread
groups, then queuing executions based on transactional content, user
defined designations, and so forth.

Lastly, if your workload comprises mainly short queries, the Thread Pool
will be beneficial.

To learn more, see *note thread-pool-tuning::.

Are there recommended Thread Pool configurations?

The Thread Pool has a number of user case driven configuration
parameters that affect its performance.  To learn about these and tips
on tuning, see *note thread-pool-tuning::.


File: manual.info.tmp,  Node: faqs-innodb-change-buffer,  Next: faqs-virtualization,  Prev: faqs-thread-pool,  Up: faqs

A.16 MySQL 5.5 FAQ: InnoDB Change Buffer
========================================

What types of operations modify secondary indexes and result in change
buffering?

'INSERT', 'UPDATE', and 'DELETE' operations can modify secondary
indexes.  If an affected index page is not in the buffer pool, the
changes can be buffered in the change buffer.

What is the benefit of the 'InnoDB' change buffer?

Buffering secondary index changes when secondary index pages are not in
the buffer pool avoids expensive random access I/O operations that would
be required to immediately read in affected index pages from disk.
Buffered changes can be applied later, in batches, as pages are read
into the buffer pool by other read operations.

Does the change buffer support other types of indexes?

No.  The change buffer only supports secondary indexes.  Clustered
indexes, full-text indexes, and spatial indexes are not supported.
Full-text indexes have their own caching mechanism.

How much space does 'InnoDB' use for the change buffer?

The maximum size of the on-disk change buffer in the system tablespace
is 1/3 of the 'InnoDB' buffer pool size.  'InnoDB' does not buffer an
operation if it would cause the on-disk change buffer to exceed this
limit.

Change buffer pages are not required to persist in the buffer pool and
may be evicted by LRU operations.

How do I determine the current size of the change buffer?

The current size of the change buffer is reported by 'SHOW ENGINE INNODB
STATUS \G', under the 'INSERT BUFFER AND ADAPTIVE HASH INDEX' heading.
For example:

     -------------------------------------
     INSERT BUFFER AND ADAPTIVE HASH INDEX
     -------------------------------------
     Ibuf: size 1, free list len 0, seg size 2, 0 merges

Relevant data points include:

   * 'size': The number of pages used within the change buffer.  Change
     buffer size is equal to 'seg size - (1 + free list len)'.  The '1
     +' value represents the change buffer header page.

   * 'seg size': The size of the change buffer, in pages.

For information about monitoring change buffer status, see *note
innodb-change-buffer::.

When does change buffer merging occur?

   * When a page is read into the buffer pool, buffered changes are
     merged upon completion of the read, before the page is made
     available.

   * Change buffer merging is performed as a background task.  The
     'innodb_io_capacity' parameter sets an upper limit on the I/O
     activity performed by 'InnoDB' background tasks such as merging
     data from the change buffer.

   * A change buffer merge is performed during crash recovery.  Changes
     are applied from the change buffer (in the system tablespace) to
     leaf pages of secondary indexes as index pages are read into the
     buffer pool.

   * The change buffer is fully durable and will survive a system crash.
     Upon restart, change buffer merge operations resume as part of
     normal operations.

   * A full merge of the change buffer can be forced as part of a slow
     server shutdown using '--innodb-fast-shutdown=0'.

When is the change buffer flushed?

Updated pages are flushed by the same flushing mechanism that flushes
the other pages that occupy the buffer pool.

When should the change buffer be used?

The change buffer is a feature designed to reduce random I/O to
secondary indexes as indexes grow larger and no longer fit in the
'InnoDB' buffer pool.  Generally, the change buffer should be used when
the entire data set does not fit into the buffer pool, when there is
substantial DML activity that modifies secondary index pages, or when
there are lots of secondary indexes that are regularly changed by DML
activity.

When should the change buffer not be used?

You might consider disabling the change buffer if the entire data set
fits within the 'InnoDB' buffer pool, if you have relatively few
secondary indexes, or if you are using solid-state storage, where random
reads are about as fast as sequential reads.  Before making
configuration changes, it is recommended that you run tests using a
representative workload to determine if disabling the change buffer
provides any benefit.

Where can I find additional information about the change buffer?

See *note innodb-change-buffer::.


File: manual.info.tmp,  Node: faqs-virtualization,  Prev: faqs-innodb-change-buffer,  Up: faqs

A.17 MySQL 5.5 FAQ: Virtualization Support
==========================================

Is MySQL supported on virtualized environments such as Oracle VM,
VMWare, Docker, Microsoft Hyper-V, or others?

MySQL is supported on virtualized environments, but is certified only
for Oracle VM
(http://www.oracle.com/technetwork/server-storage/vm/index.html).
Contact Oracle Support for more information.

Be aware of potential problems when using virtualization software.  The
usual ones are related to performance, performance degradations,
slowness, or unpredictability of disk, I/O, network, and memory.


File: manual.info.tmp,  Node: error-handling,  Next: indexes,  Prev: faqs,  Up: Top

Appendix B Errors, Error Codes, and Common Problems
***************************************************

* Menu:

* error-message-components::     Error Message Sources and Components
* error-interfaces::             Error Information Interfaces
* error-reference::              Error Message Reference
* problems::                     Problems and Common Errors

This appendix describes the types of error information MySQL provides
and how to obtain information about them.  It also lists the error
messages that the MySQL server and MySQL client programs generate.  The
final section is for troubleshooting.  It describes common problems and
errors that may occur and potential resolutions.

*Additional Resources*

Other sections that discuss error-related topics include:

   * Information about configuring where and how the server writes the
     error log: *note error-log::

   * Information about the character set used for error messages: *note
     charset-errors::

   * Information about the language used for error messages: *note
     error-message-language::

   * Information about errors related to *note 'InnoDB':
     innodb-storage-engine.: *note innodb-error-handling::


File: manual.info.tmp,  Node: error-message-components,  Next: error-interfaces,  Prev: error-handling,  Up: error-handling

B.1 Error Message Sources and Components
========================================

This section discusses how error messages originate within MySQL and the
components they contain.

   * *note error-sources::

   * *note error-components::

*Error Message Sources*

Error messages can originate on the server side or the client side:

   * On the server side, error messages may occur during the startup and
     shutdown processes, as a result of issues that occur during SQL
     statement execution, and so forth.

        * The MySQL server writes some error messages to its error log.
          These indicate issues of interest to database administrators
          or that require DBA action.

        * The server sends other error messages to client programs.
          These indicate issues pertaining only to a particular client.
          The MySQL client library takes errors received from the server
          and makes them available to the host client program.

   * Client-side error messages are generated from within the MySQL
     client library, usually involving problems communicating with the
     server.

Example server-side error messages written to the error log:

   * This message produced during the startup process provides a status
     or progress indicator:

          181009  7:43:37 [Note] Event Scheduler: scheduler
          thread started with id 1

   * This message indicates an issue that requires DBA action:

          181009 3:20:39 [ERROR] Can't open the mysql.plugin
          table. Please run mysql_upgrade to create it.

Example server-side error message sent to client programs, as displayed
by the *note 'mysql': mysql. client:

     mysql> SELECT * FROM no_such_table;
     ERROR 1146 (42S02): Table 'test.no_such_table' doesn't exist

Example client-side error message originating from within the client
library, as displayed by the *note 'mysql': mysql. client:

     shell> mysql -h no-such-host
     ERROR 2005 (HY000): Unknown MySQL server host 'no-such-host' (0)

Whether an error originates from within the client library or is
received from the server, a MySQL client program may respond in varying
ways.  As just illustrated, the client may display the error message so
the user can take corrective measures.  The client may instead
internally attempt to resolve or retry a failed operation, or take other
action.

*Error Message Components*

When an error occurs, error information includes several components: an
error code, SQLSTATE value, and message string.  These components have
the following characteristics:

   * Error code: This value is numeric.  It is MySQL-specific and is not
     portable to other database systems.

     Each error number has a corresponding symbolic value.  Examples:

        * The symbol for server error number '1146' is
          'ER_NO_SUCH_TABLE'.

        * The symbol for client error number '2005' is
          'CR_UNKNOWN_HOST'.

     Error codes are stable across General Availability (GA) releases of
     a given MySQL series.  Before a series reaches GA status, new codes
     may still be under development and are subject to change.

   * SQLSTATE value: This value is a five-character string (for example,
     ''42S02'').  SQLSTATE values are taken from ANSI SQL and ODBC and
     are more standardized than the numeric error codes.  The first two
     characters of an SQLSTATE value indicate the error class:

        * Class = ''00'' indicates success.

        * Class = ''01'' indicates a warning.

        * Class = ''02'' indicates 'not found.' This is relevant within
          the context of cursors and is used to control what happens
          when a cursor reaches the end of a data set.  This condition
          also occurs for 'SELECT ... INTO VAR_LIST' statements that
          retrieve no rows.

        * Class > ''02'' indicates an exception.

     For server-side errors, not all MySQL error numbers have
     corresponding SQLSTATE values.  In these cases, ''HY000'' (general
     error) is used.

     For client-side errors, the SQLSTATE value is always ''HY000''
     (general error), so it is not meaningful for distinguishing one
     client error from another.

   * Message string: This string provides a textual description of the
     error.


File: manual.info.tmp,  Node: error-interfaces,  Next: error-reference,  Prev: error-message-components,  Up: error-handling

B.2 Error Information Interfaces
================================

Error messages can originate on the server side or the client side, and
each error message includes an error code, SQLSTATE value, and message
string, as described in *note error-message-components::.  For lists of
server-side, client-side, and global (shared between server and clients)
errors, see *note error-reference::.

For error checking from within programs, use error code numbers or
symbols, not error message strings.  Message strings do not change
often, but it is possible.  Also, if the database administrator changes
the language setting, that affects the language of message strings; see
*note error-message-language::.

Error information in MySQL is available in the server error log, at the
SQL level, from within client programs, and at the command line.

   * *note error-interface-log::

   * *note error-interface-sql::

   * *note error-interface-client::

   * *note error-interface-command::

*Error Log*

On the server side, some messages are intended for the error log.  For
information about configuring where and how the server writes the log,
see *note error-log::.

Other server error messages are intended to be sent to client programs
and are available as described in *note error-interface-client::.

*SQL Error Message Interface*

At the SQL level, there are several sources of error information in
MySQL:

   * SQL statement warning and error information is available through
     the *note 'SHOW WARNINGS': show-warnings. and *note 'SHOW ERRORS':
     show-errors. statements.  The 'warning_count' system variable
     indicates the number of errors, warnings, and notes (with notes
     excluded if the 'sql_notes' system variable is disabled).  The
     'error_count' system variable indicates the number of errors.  Its
     value excludes warnings and notes.

   * *note 'SHOW SLAVE STATUS': show-slave-status. statement output
     includes information about replication errors occurring on
     replication slave servers.

   * *note 'SHOW ENGINE INNODB STATUS': show-engine. statement output
     includes information about the most recent foreign key error if a
     *note 'CREATE TABLE': create-table. statement for an *note
     'InnoDB': innodb-storage-engine. table fails.

*Client Error Message Interface*

Client programs receive errors from two sources:

   * Errors that originate on the client side from within the MySQL
     client library.

   * Errors that originate on the server side and are sent to the client
     by the server.  These are received within the client library, which
     makes them available to the host client program.

Regardless of whether an error originates from within the client library
or is received from the server, a MySQL client program obtains the error
code, SQLSTATE value, message string, and other related information by
calling C API functions in the client library:

   * *note 'mysql_errno()': mysql-errno. returns the MySQL error code.

   * *note 'mysql_sqlstate()': mysql-sqlstate. returns the SQLSTATE
     value.

   * *note 'mysql_error()': mysql-error. returns the message string.

   * *note 'mysql_stmt_errno()': mysql-stmt-errno, *note
     'mysql_stmt_sqlstate()': mysql-stmt-sqlstate, and *note
     'mysql_stmt_error()': mysql-stmt-error. are the corresponding error
     functions for prepared statements.

   * *note 'mysql_warning_count()': mysql-warning-count. returns the
     number of errors, warnings, and notes for the most recent
     statement.

For descriptions of the client library error functions, see *note
c-api::.

A MySQL client program may respond to an error in varying ways.  The
client may display the error message so the user can take corrective
measures, internally attempt to resolve or retry a failed operation, or
take other action.  For example, (using the *note 'mysql': mysql.
client), a failure to connect to the server might result in this
message:

     shell> mysql -h no-such-host
     ERROR 2005 (HY000): Unknown MySQL server host 'no-such-host' (0)

*Command-Line Error Message Interface*

The *note 'perror': perror. program provides information from the
command line about error numbers.  See *note perror::.

     shell> perror 1231
     MySQL error code 1231 (ER_WRONG_VALUE_FOR_VAR): Variable '%-.64s' can't
     be set to the value of '%-.200s'


File: manual.info.tmp,  Node: error-reference,  Next: problems,  Prev: error-interfaces,  Up: error-handling

B.3 Error Message Reference
===========================

* Menu:

* server-error-reference::       Server Error Message Reference
* client-error-reference::       Client Error Message Reference
* global-error-reference::       Global Error Message Reference

This section provides a reference for the various types of error
messages in MySQL:

   * Error messages produced only by the server: *note
     server-error-reference::

   * Error messages that originate only from within the MySQL client
     library: *note client-error-reference::

   * Error messages that are shared between the server and the client
     library: *note global-error-reference::


File: manual.info.tmp,  Node: server-error-reference,  Next: client-error-reference,  Prev: error-reference,  Up: error-reference

B.3.1 Server Error Message Reference
------------------------------------

The MySQL server writes some error messages to its error log, and sends
others to client programs.

Example server-side error messages written to the error log:

     181009  7:43:37 [Note] Event Scheduler: scheduler
     thread started with id 1

     181009 3:20:39 [ERROR] Can't open the mysql.plugin
     table. Please run mysql_upgrade to create it.

Example server-side error message sent to client programs, as displayed
by the *note 'mysql': mysql. client:

     mysql> SELECT * FROM no_such_table;
     ERROR 1146 (42S02): Table 'test.no_such_table' doesn't exist

Each server error message includes an error code, SQLSTATE value, and
message string, as described in *note error-message-components::.  These
components are available as described in *note error-interfaces::.

In addition to the errors in the following list, the server can also
produce error messages that have error codes in the range from 1 to 999.
See *note global-error-reference::

   * 
     Error number: '1000'; Symbol: 'ER_HASHCHK'; SQLSTATE: 'HY000'

     Message: hashchk

     Unused.

   * 
     Error number: '1001'; Symbol: 'ER_NISAMCHK'; SQLSTATE: 'HY000'

     Message: isamchk

     Unused.

   * 
     Error number: '1002'; Symbol: 'ER_NO'; SQLSTATE: 'HY000'

     Message: NO

     Used in the construction of other messages.

   * 
     Error number: '1003'; Symbol: 'ER_YES'; SQLSTATE: 'HY000'

     Message: YES

     Used in the construction of other messages.

     Extended *note 'EXPLAIN': explain. format generates Note messages.
     'ER_YES' is used in the 'Code' column for these messages in
     subsequent *note 'SHOW WARNINGS': show-warnings. output.

   * 
     Error number: '1004'; Symbol: 'ER_CANT_CREATE_FILE'; SQLSTATE:
     'HY000'

     Message: Can't create file '%s' (errno: %d)

     Occurs for failure to create or copy a file needed for some
     operation.

     Possible causes: Permissions problem for source file; destination
     file already exists but is not writeable.

   * 
     Error number: '1005'; Symbol: 'ER_CANT_CREATE_TABLE'; SQLSTATE:
     'HY000'

     Message: Can't create table '%s' (errno: %d)

     'InnoDB' reports this error when a table cannot be created.  If the
     error message refers to error 150, table creation failed because a
     foreign key constraint was not correctly formed.  If the error
     message refers to error 1, table creation probably failed
     because the table includes a column name that matched the name of
     an internal 'InnoDB' table.

   * 
     Error number: '1006'; Symbol: 'ER_CANT_CREATE_DB'; SQLSTATE:
     'HY000'

     Message: Can't create database '%s' (errno: %d)

   * 
     Error number: '1007'; Symbol: 'ER_DB_CREATE_EXISTS'; SQLSTATE:
     'HY000'

     Message: Can't create database '%s'; database exists

     An attempt to create a database failed because the database already
     exists.

     Drop the database first if you really want to replace an existing
     database, or add an 'IF NOT EXISTS' clause to the *note 'CREATE
     DATABASE': create-database. statement if to retain an existing
     database without having the statement produce an error.

   * 
     Error number: '1008'; Symbol: 'ER_DB_DROP_EXISTS'; SQLSTATE:
     'HY000'

     Message: Can't drop database '%s'; database doesn't exist

   * 
     Error number: '1009'; Symbol: 'ER_DB_DROP_DELETE'; SQLSTATE:
     'HY000'

     Message: Error dropping database (can't delete '%s', errno: %d)

   * 
     Error number: '1010'; Symbol: 'ER_DB_DROP_RMDIR'; SQLSTATE: 'HY000'

     Message: Error dropping database (can't rmdir '%s', errno: %d)

   * 
     Error number: '1011'; Symbol: 'ER_CANT_DELETE_FILE'; SQLSTATE:
     'HY000'

     Message: Error on delete of '%s' (errno: %d)

   * 
     Error number: '1012'; Symbol: 'ER_CANT_FIND_SYSTEM_REC'; SQLSTATE:
     'HY000'

     Message: Can't read record in system table

     Returned by 'InnoDB' for attempts to access 'InnoDB'
     'INFORMATION_SCHEMA' tables when 'InnoDB' is unavailable.

   * 
     Error number: '1013'; Symbol: 'ER_CANT_GET_STAT'; SQLSTATE: 'HY000'

     Message: Can't get status of '%s' (errno: %d)

   * 
     Error number: '1014'; Symbol: 'ER_CANT_GET_WD'; SQLSTATE: 'HY000'

     Message: Can't get working directory (errno: %d)

   * 
     Error number: '1015'; Symbol: 'ER_CANT_LOCK'; SQLSTATE: 'HY000'

     Message: Can't lock file (errno: %d)

   * 
     Error number: '1016'; Symbol: 'ER_CANT_OPEN_FILE'; SQLSTATE:
     'HY000'

     Message: Can't open file: '%s' (errno: %d)

     'InnoDB' reports this error when the table from the 'InnoDB' data
     files cannot be found, even though the '.frm' file for the table
     exists.  See *note innodb-troubleshooting-datadict::.

   * 
     Error number: '1017'; Symbol: 'ER_FILE_NOT_FOUND'; SQLSTATE:
     'HY000'

     Message: Can't find file: '%s' (errno: %d)

   * 
     Error number: '1018'; Symbol: 'ER_CANT_READ_DIR'; SQLSTATE: 'HY000'

     Message: Can't read dir of '%s' (errno: %d)

   * 
     Error number: '1019'; Symbol: 'ER_CANT_SET_WD'; SQLSTATE: 'HY000'

     Message: Can't change dir to '%s' (errno: %d)

   * 
     Error number: '1020'; Symbol: 'ER_CHECKREAD'; SQLSTATE: 'HY000'

     Message: Record has changed since last read in table '%s'

   * 
     Error number: '1021'; Symbol: 'ER_DISK_FULL'; SQLSTATE: 'HY000'

     Message: Disk full (%s); waiting for someone to free some space...

   * 
     Error number: '1022'; Symbol: 'ER_DUP_KEY'; SQLSTATE: '23000'

     Message: Can't write; duplicate key in table '%s'

   * 
     Error number: '1023'; Symbol: 'ER_ERROR_ON_CLOSE'; SQLSTATE:
     'HY000'

     Message: Error on close of '%s' (errno: %d)

   * 
     Error number: '1024'; Symbol: 'ER_ERROR_ON_READ'; SQLSTATE: 'HY000'

     Message: Error reading file '%s' (errno: %d)

   * 
     Error number: '1025'; Symbol: 'ER_ERROR_ON_RENAME'; SQLSTATE:
     'HY000'

     Message: Error on rename of '%s' to '%s' (errno: %d)

     'InnoDB' reports this error if you attempt to drop the last index
     that can enforce a particular referential constraint.  As of MySQL
     5.5, this error message is replaced by 'ERROR 1553'.

   * 
     Error number: '1026'; Symbol: 'ER_ERROR_ON_WRITE'; SQLSTATE:
     'HY000'

     Message: Error writing file '%s' (errno: %d)

   * 
     Error number: '1027'; Symbol: 'ER_FILE_USED'; SQLSTATE: 'HY000'

     Message: '%s' is locked against change

   * 
     Error number: '1028'; Symbol: 'ER_FILSORT_ABORT'; SQLSTATE: 'HY000'

     Message: Sort aborted

   * 
     Error number: '1029'; Symbol: 'ER_FORM_NOT_FOUND'; SQLSTATE:
     'HY000'

     Message: View '%s' doesn't exist for '%s'

   * 
     Error number: '1030'; Symbol: 'ER_GET_ERRNO'; SQLSTATE: 'HY000'

     Message: Got error %d from storage engine

     Check the '%d' value to see what the OS error means.  For example,
     28 indicates that you have run out of disk space.

   * 
     Error number: '1031'; Symbol: 'ER_ILLEGAL_HA'; SQLSTATE: 'HY000'

     Message: Table storage engine for '%s' doesn't have this option

   * 
     Error number: '1032'; Symbol: 'ER_KEY_NOT_FOUND'; SQLSTATE: 'HY000'

     Message: Can't find record in '%s'

   * 
     Error number: '1033'; Symbol: 'ER_NOT_FORM_FILE'; SQLSTATE: 'HY000'

     Message: Incorrect information in file: '%s'

   * 
     Error number: '1034'; Symbol: 'ER_NOT_KEYFILE'; SQLSTATE: 'HY000'

     Message: Incorrect key file for table '%s'; try to repair it

   * 
     Error number: '1035'; Symbol: 'ER_OLD_KEYFILE'; SQLSTATE: 'HY000'

     Message: Old key file for table '%s'; repair it!

   * 
     Error number: '1036'; Symbol: 'ER_OPEN_AS_READONLY'; SQLSTATE:
     'HY000'

     Message: Table '%s' is read only

   * 
     Error number: '1037'; Symbol: 'ER_OUTOFMEMORY'; SQLSTATE: 'HY001'

     Message: Out of memory; restart server and try again (needed %d
     bytes)

   * 
     Error number: '1038'; Symbol: 'ER_OUT_OF_SORTMEMORY'; SQLSTATE:
     'HY001'

     Message: Out of sort memory, consider increasing server sort buffer
     size

   * 
     Error number: '1039'; Symbol: 'ER_UNEXPECTED_EOF'; SQLSTATE:
     'HY000'

     Message: Unexpected EOF found when reading file '%s' (errno: %d)

   * 
     Error number: '1040'; Symbol: 'ER_CON_COUNT_ERROR'; SQLSTATE:
     '08004'

     Message: Too many connections

   * 
     Error number: '1041'; Symbol: 'ER_OUT_OF_RESOURCES'; SQLSTATE:
     'HY000'

     Message: Out of memory; check if mysqld or some other process uses
     all available memory; if not, you may have to use 'ulimit' to allow
     mysqld to use more memory or you can add more swap space

   * 
     Error number: '1042'; Symbol: 'ER_BAD_HOST_ERROR'; SQLSTATE:
     '08S01'

     Message: Can't get hostname for your address

   * 
     Error number: '1043'; Symbol: 'ER_HANDSHAKE_ERROR'; SQLSTATE:
     '08S01'

     Message: Bad handshake

   * 
     Error number: '1044'; Symbol: 'ER_DBACCESS_DENIED_ERROR'; SQLSTATE:
     '42000'

     Message: Access denied for user '%s'@'%s' to database '%s'

   * 
     Error number: '1045'; Symbol: 'ER_ACCESS_DENIED_ERROR'; SQLSTATE:
     '28000'

     Message: Access denied for user '%s'@'%s' (using password: %s)

   * 
     Error number: '1046'; Symbol: 'ER_NO_DB_ERROR'; SQLSTATE: '3D000'

     Message: No database selected

   * 
     Error number: '1047'; Symbol: 'ER_UNKNOWN_COM_ERROR'; SQLSTATE:
     '08S01'

     Message: Unknown command

   * 
     Error number: '1048'; Symbol: 'ER_BAD_NULL_ERROR'; SQLSTATE:
     '23000'

     Message: Column '%s' cannot be null

   * 
     Error number: '1049'; Symbol: 'ER_BAD_DB_ERROR'; SQLSTATE: '42000'

     Message: Unknown database '%s'

   * 
     Error number: '1050'; Symbol: 'ER_TABLE_EXISTS_ERROR'; SQLSTATE:
     '42S01'

     Message: Table '%s' already exists

   * 
     Error number: '1051'; Symbol: 'ER_BAD_TABLE_ERROR'; SQLSTATE:
     '42S02'

     Message: Unknown table '%s'

   * 
     Error number: '1052'; Symbol: 'ER_NON_UNIQ_ERROR'; SQLSTATE:
     '23000'

     Message: Column '%s' in %s is ambiguous

          %s = column name
          %s = location of column (for example, "field list")

     Likely cause: A column appears in a query without appropriate
     qualification, such as in a select list or ON clause.

     Examples:

          mysql> SELECT i FROM t INNER JOIN t AS t2;
          ERROR 1052 (23000): Column 'i' in field list is ambiguous

          mysql> SELECT * FROM t LEFT JOIN t AS t2 ON i = i;
          ERROR 1052 (23000): Column 'i' in on clause is ambiguous

     Resolution:

        * Qualify the column with the appropriate table name:

               mysql> SELECT t2.i FROM t INNER JOIN t AS t2;

        * Modify the query to avoid the need for qualification:

               mysql> SELECT * FROM t LEFT JOIN t AS t2 USING (i);

   * 
     Error number: '1053'; Symbol: 'ER_SERVER_SHUTDOWN'; SQLSTATE:
     '08S01'

     Message: Server shutdown in progress

   * 
     Error number: '1054'; Symbol: 'ER_BAD_FIELD_ERROR'; SQLSTATE:
     '42S22'

     Message: Unknown column '%s' in '%s'

   * 
     Error number: '1055'; Symbol: 'ER_WRONG_FIELD_WITH_GROUP';
     SQLSTATE: '42000'

     Message: '%s' isn't in GROUP BY

   * 
     Error number: '1056'; Symbol: 'ER_WRONG_GROUP_FIELD'; SQLSTATE:
     '42000'

     Message: Can't group on '%s'

   * 
     Error number: '1057'; Symbol: 'ER_WRONG_SUM_SELECT'; SQLSTATE:
     '42000'

     Message: Statement has sum functions and columns in same statement

   * 
     Error number: '1058'; Symbol: 'ER_WRONG_VALUE_COUNT'; SQLSTATE:
     '21S01'

     Message: Column count doesn't match value count

   * 
     Error number: '1059'; Symbol: 'ER_TOO_LONG_IDENT'; SQLSTATE:
     '42000'

     Message: Identifier name '%s' is too long

   * 
     Error number: '1060'; Symbol: 'ER_DUP_FIELDNAME'; SQLSTATE: '42S21'

     Message: Duplicate column name '%s'

   * 
     Error number: '1061'; Symbol: 'ER_DUP_KEYNAME'; SQLSTATE: '42000'

     Message: Duplicate key name '%s'

   * 
     Error number: '1062'; Symbol: 'ER_DUP_ENTRY'; SQLSTATE: '23000'

     Message: Duplicate entry '%s' for key %d

     The message returned with this error uses the format string for
     'ER_DUP_ENTRY_WITH_KEY_NAME'.

   * 
     Error number: '1063'; Symbol: 'ER_WRONG_FIELD_SPEC'; SQLSTATE:
     '42000'

     Message: Incorrect column specifier for column '%s'

   * 
     Error number: '1064'; Symbol: 'ER_PARSE_ERROR'; SQLSTATE: '42000'

     Message: %s near '%s' at line %d

   * 
     Error number: '1065'; Symbol: 'ER_EMPTY_QUERY'; SQLSTATE: '42000'

     Message: Query was empty

   * 
     Error number: '1066'; Symbol: 'ER_NONUNIQ_TABLE'; SQLSTATE: '42000'

     Message: Not unique table/alias: '%s'

   * 
     Error number: '1067'; Symbol: 'ER_INVALID_DEFAULT'; SQLSTATE:
     '42000'

     Message: Invalid default value for '%s'

   * 
     Error number: '1068'; Symbol: 'ER_MULTIPLE_PRI_KEY'; SQLSTATE:
     '42000'

     Message: Multiple primary key defined

   * 
     Error number: '1069'; Symbol: 'ER_TOO_MANY_KEYS'; SQLSTATE: '42000'

     Message: Too many keys specified; max %d keys allowed

   * 
     Error number: '1070'; Symbol: 'ER_TOO_MANY_KEY_PARTS'; SQLSTATE:
     '42000'

     Message: Too many key parts specified; max %d parts allowed

   * 
     Error number: '1071'; Symbol: 'ER_TOO_LONG_KEY'; SQLSTATE: '42000'

     Message: Specified key was too long; max key length is %d bytes

   * 
     Error number: '1072'; Symbol: 'ER_KEY_COLUMN_DOES_NOT_EXITS';
     SQLSTATE: '42000'

     Message: Key column '%s' doesn't exist in table

   * 
     Error number: '1073'; Symbol: 'ER_BLOB_USED_AS_KEY'; SQLSTATE:
     '42000'

     Message: BLOB column '%s' can't be used in key specification with
     the used table type

   * 
     Error number: '1074'; Symbol: 'ER_TOO_BIG_FIELDLENGTH'; SQLSTATE:
     '42000'

     Message: Column length too big for column '%s' (max = %lu); use
     BLOB or TEXT instead

   * 
     Error number: '1075'; Symbol: 'ER_WRONG_AUTO_KEY'; SQLSTATE:
     '42000'

     Message: Incorrect table definition; there can be only one auto
     column and it must be defined as a key

   * 
     Error number: '1076'; Symbol: 'ER_READY'; SQLSTATE: 'HY000'

     Message: %s: ready for connections.  Version: '%s' socket: '%s'
     port: %d

   * 
     Error number: '1077'; Symbol: 'ER_NORMAL_SHUTDOWN'; SQLSTATE:
     'HY000'

     Message: %s: Normal shutdown

   * 
     Error number: '1078'; Symbol: 'ER_GOT_SIGNAL'; SQLSTATE: 'HY000'

     Message: %s: Got signal %d.  Aborting!

   * 
     Error number: '1079'; Symbol: 'ER_SHUTDOWN_COMPLETE'; SQLSTATE:
     'HY000'

     Message: %s: Shutdown complete

   * 
     Error number: '1080'; Symbol: 'ER_FORCING_CLOSE'; SQLSTATE: '08S01'

     Message: %s: Forcing close of thread %ld user: '%s'

   * 
     Error number: '1081'; Symbol: 'ER_IPSOCK_ERROR'; SQLSTATE: '08S01'

     Message: Can't create IP socket

   * 
     Error number: '1082'; Symbol: 'ER_NO_SUCH_INDEX'; SQLSTATE: '42S12'

     Message: Table '%s' has no index like the one used in CREATE INDEX;
     recreate the table

   * 
     Error number: '1083'; Symbol: 'ER_WRONG_FIELD_TERMINATORS';
     SQLSTATE: '42000'

     Message: Field separator argument is not what is expected; check
     the manual

   * 
     Error number: '1084'; Symbol: 'ER_BLOBS_AND_NO_TERMINATED';
     SQLSTATE: '42000'

     Message: You can't use fixed rowlength with BLOBs; please use
     'fields terminated by'

   * 
     Error number: '1085'; Symbol: 'ER_TEXTFILE_NOT_READABLE'; SQLSTATE:
     'HY000'

     Message: The file '%s' must be in the database directory or be
     readable by all

   * 
     Error number: '1086'; Symbol: 'ER_FILE_EXISTS_ERROR'; SQLSTATE:
     'HY000'

     Message: File '%s' already exists

   * 
     Error number: '1087'; Symbol: 'ER_LOAD_INFO'; SQLSTATE: 'HY000'

     Message: Records: %ld Deleted: %ld Skipped: %ld Warnings: %ld

   * 
     Error number: '1088'; Symbol: 'ER_ALTER_INFO'; SQLSTATE: 'HY000'

     Message: Records: %ld Duplicates: %ld

   * 
     Error number: '1089'; Symbol: 'ER_WRONG_SUB_KEY'; SQLSTATE: 'HY000'

     Message: Incorrect prefix key; the used key part isn't a string,
     the used length is longer than the key part, or the storage engine
     doesn't support unique prefix keys

   * 
     Error number: '1090'; Symbol: 'ER_CANT_REMOVE_ALL_FIELDS';
     SQLSTATE: '42000'

     Message: You can't delete all columns with ALTER TABLE; use DROP
     TABLE instead

   * 
     Error number: '1091'; Symbol: 'ER_CANT_DROP_FIELD_OR_KEY';
     SQLSTATE: '42000'

     Message: Can't DROP '%s'; check that column/key exists

   * 
     Error number: '1092'; Symbol: 'ER_INSERT_INFO'; SQLSTATE: 'HY000'

     Message: Records: %ld Duplicates: %ld Warnings: %ld

   * 
     Error number: '1093'; Symbol: 'ER_UPDATE_TABLE_USED'; SQLSTATE:
     'HY000'

     Message: You can't specify target table '%s' for update in FROM
     clause

     This error occurs for attempts to select from and modify the same
     table within a single statement.  See *note
     subquery-restrictions::.

   * 
     Error number: '1094'; Symbol: 'ER_NO_SUCH_THREAD'; SQLSTATE:
     'HY000'

     Message: Unknown thread id: %lu

   * 
     Error number: '1095'; Symbol: 'ER_KILL_DENIED_ERROR'; SQLSTATE:
     'HY000'

     Message: You are not owner of thread %lu

   * 
     Error number: '1096'; Symbol: 'ER_NO_TABLES_USED'; SQLSTATE:
     'HY000'

     Message: No tables used

   * 
     Error number: '1097'; Symbol: 'ER_TOO_BIG_SET'; SQLSTATE: 'HY000'

     Message: Too many strings for column %s and SET

   * 
     Error number: '1098'; Symbol: 'ER_NO_UNIQUE_LOGFILE'; SQLSTATE:
     'HY000'

     Message: Can't generate a unique log-filename %s.(1-999)

   * 
     Error number: '1099'; Symbol: 'ER_TABLE_NOT_LOCKED_FOR_WRITE';
     SQLSTATE: 'HY000'

     Message: Table '%s' was locked with a READ lock and can't be
     updated

   * 
     Error number: '1100'; Symbol: 'ER_TABLE_NOT_LOCKED'; SQLSTATE:
     'HY000'

     Message: Table '%s' was not locked with LOCK TABLES

   * 
     Error number: '1101'; Symbol: 'ER_BLOB_CANT_HAVE_DEFAULT';
     SQLSTATE: '42000'

     Message: BLOB/TEXT column '%s' can't have a default value

   * 
     Error number: '1102'; Symbol: 'ER_WRONG_DB_NAME'; SQLSTATE: '42000'

     Message: Incorrect database name '%s'

   * 
     Error number: '1103'; Symbol: 'ER_WRONG_TABLE_NAME'; SQLSTATE:
     '42000'

     Message: Incorrect table name '%s'

   * 
     Error number: '1104'; Symbol: 'ER_TOO_BIG_SELECT'; SQLSTATE:
     '42000'

     Message: The SELECT would examine more than MAX_JOIN_SIZE rows;
     check your WHERE and use SET SQL_BIG_SELECTS=1 or SET
     MAX_JOIN_SIZE=# if the SELECT is okay

   * 
     Error number: '1105'; Symbol: 'ER_UNKNOWN_ERROR'; SQLSTATE: 'HY000'

     Message: Unknown error

   * 
     Error number: '1106'; Symbol: 'ER_UNKNOWN_PROCEDURE'; SQLSTATE:
     '42000'

     Message: Unknown procedure '%s'

   * 
     Error number: '1107'; Symbol: 'ER_WRONG_PARAMCOUNT_TO_PROCEDURE';
     SQLSTATE: '42000'

     Message: Incorrect parameter count to procedure '%s'

   * 
     Error number: '1108'; Symbol: 'ER_WRONG_PARAMETERS_TO_PROCEDURE';
     SQLSTATE: 'HY000'

     Message: Incorrect parameters to procedure '%s'

   * 
     Error number: '1109'; Symbol: 'ER_UNKNOWN_TABLE'; SQLSTATE: '42S02'

     Message: Unknown table '%s' in %s

   * 
     Error number: '1110'; Symbol: 'ER_FIELD_SPECIFIED_TWICE'; SQLSTATE:
     '42000'

     Message: Column '%s' specified twice

   * 
     Error number: '1111'; Symbol: 'ER_INVALID_GROUP_FUNC_USE';
     SQLSTATE: 'HY000'

     Message: Invalid use of group function

   * 
     Error number: '1112'; Symbol: 'ER_UNSUPPORTED_EXTENSION'; SQLSTATE:
     '42000'

     Message: Table '%s' uses an extension that doesn't exist in this
     MySQL version

   * 
     Error number: '1113'; Symbol: 'ER_TABLE_MUST_HAVE_COLUMNS';
     SQLSTATE: '42000'

     Message: A table must have at least 1 column

   * 
     Error number: '1114'; Symbol: 'ER_RECORD_FILE_FULL'; SQLSTATE:
     'HY000'

     Message: The table '%s' is full

     'InnoDB' reports this error when the system tablespace runs out of
     free space.  Reconfigure the system tablespace to add a new data
     file.

   * 
     Error number: '1115'; Symbol: 'ER_UNKNOWN_CHARACTER_SET'; SQLSTATE:
     '42000'

     Message: Unknown character set: '%s'

   * 
     Error number: '1116'; Symbol: 'ER_TOO_MANY_TABLES'; SQLSTATE:
     'HY000'

     Message: Too many tables; MySQL can only use %d tables in a join

   * 
     Error number: '1117'; Symbol: 'ER_TOO_MANY_FIELDS'; SQLSTATE:
     'HY000'

     Message: Too many columns

   * 
     Error number: '1118'; Symbol: 'ER_TOO_BIG_ROWSIZE'; SQLSTATE:
     '42000'

     Message: Row size too large.  The maximum row size for the used
     table type, not counting BLOBs, is %ld.  You have to change some
     columns to TEXT or BLOBs

   * 
     Error number: '1119'; Symbol: 'ER_STACK_OVERRUN'; SQLSTATE: 'HY000'

     Message: Thread stack overrun: Used: %ld of a %ld stack.  Use
     'mysqld -thread_stack=#' to specify a bigger stack if needed

   * 
     Error number: '1120'; Symbol: 'ER_WRONG_OUTER_JOIN'; SQLSTATE:
     '42000'

     Message: Cross dependency found in OUTER JOIN; examine your ON
     conditions

   * 
     Error number: '1121'; Symbol: 'ER_NULL_COLUMN_IN_INDEX'; SQLSTATE:
     '42000'

     Message: Table handler doesn't support NULL in given index.  Please
     change column '%s' to be NOT NULL or use another handler

   * 
     Error number: '1122'; Symbol: 'ER_CANT_FIND_UDF'; SQLSTATE: 'HY000'

     Message: Can't load function '%s'

   * 
     Error number: '1123'; Symbol: 'ER_CANT_INITIALIZE_UDF'; SQLSTATE:
     'HY000'

     Message: Can't initialize function '%s'; %s

   * 
     Error number: '1124'; Symbol: 'ER_UDF_NO_PATHS'; SQLSTATE: 'HY000'

     Message: No paths allowed for shared library

   * 
     Error number: '1125'; Symbol: 'ER_UDF_EXISTS'; SQLSTATE: 'HY000'

     Message: Function '%s' already exists

   * 
     Error number: '1126'; Symbol: 'ER_CANT_OPEN_LIBRARY'; SQLSTATE:
     'HY000'

     Message: Can't open shared library '%s' (errno: %d %s)

   * 
     Error number: '1127'; Symbol: 'ER_CANT_FIND_DL_ENTRY'; SQLSTATE:
     'HY000'

     Message: Can't find symbol '%s' in library

   * 
     Error number: '1128'; Symbol: 'ER_FUNCTION_NOT_DEFINED'; SQLSTATE:
     'HY000'

     Message: Function '%s' is not defined

   * 
     Error number: '1129'; Symbol: 'ER_HOST_IS_BLOCKED'; SQLSTATE:
     'HY000'

     Message: Host '%s' is blocked because of many connection errors;
     unblock with 'mysqladmin flush-hosts'

   * 
     Error number: '1130'; Symbol: 'ER_HOST_NOT_PRIVILEGED'; SQLSTATE:
     'HY000'

     Message: Host '%s' is not allowed to connect to this MySQL server

   * 
     Error number: '1131'; Symbol: 'ER_PASSWORD_ANONYMOUS_USER';
     SQLSTATE: '42000'

     Message: You are using MySQL as an anonymous user and anonymous
     users are not allowed to change passwords

   * 
     Error number: '1132'; Symbol: 'ER_PASSWORD_NOT_ALLOWED'; SQLSTATE:
     '42000'

     Message: You must have privileges to update tables in the mysql
     database to be able to change passwords for others

   * 
     Error number: '1133'; Symbol: 'ER_PASSWORD_NO_MATCH'; SQLSTATE:
     '42000'

     Message: Can't find any matching row in the user table

   * 
     Error number: '1134'; Symbol: 'ER_UPDATE_INFO'; SQLSTATE: 'HY000'

     Message: Rows matched: %ld Changed: %ld Warnings: %ld

   * 
     Error number: '1135'; Symbol: 'ER_CANT_CREATE_THREAD'; SQLSTATE:
     'HY000'

     Message: Can't create a new thread (errno %d); if you are not out
     of available memory, you can consult the manual for a possible
     OS-dependent bug

   * 
     Error number: '1136'; Symbol: 'ER_WRONG_VALUE_COUNT_ON_ROW';
     SQLSTATE: '21S01'

     Message: Column count doesn't match value count at row %ld

   * 
     Error number: '1137'; Symbol: 'ER_CANT_REOPEN_TABLE'; SQLSTATE:
     'HY000'

     Message: Can't reopen table: '%s'

   * 
     Error number: '1138'; Symbol: 'ER_INVALID_USE_OF_NULL'; SQLSTATE:
     '22004'

     Message: Invalid use of NULL value

   * 
     Error number: '1139'; Symbol: 'ER_REGEXP_ERROR'; SQLSTATE: '42000'

     Message: Got error '%s' from regexp

   * 
     Error number: '1140'; Symbol: 'ER_MIX_OF_GROUP_FUNC_AND_FIELDS';
     SQLSTATE: '42000'

     Message: Mixing of GROUP columns (MIN(),MAX(),COUNT(),...)  with no
     GROUP columns is illegal if there is no GROUP BY clause

   * 
     Error number: '1141'; Symbol: 'ER_NONEXISTING_GRANT'; SQLSTATE:
     '42000'

     Message: There is no such grant defined for user '%s' on host '%s'

   * 
     Error number: '1142'; Symbol: 'ER_TABLEACCESS_DENIED_ERROR';
     SQLSTATE: '42000'

     Message: %s command denied to user '%s'@'%s' for table '%s'

   * 
     Error number: '1143'; Symbol: 'ER_COLUMNACCESS_DENIED_ERROR';
     SQLSTATE: '42000'

     Message: %s command denied to user '%s'@'%s' for column '%s' in
     table '%s'

   * 
     Error number: '1144'; Symbol: 'ER_ILLEGAL_GRANT_FOR_TABLE';
     SQLSTATE: '42000'

     Message: Illegal GRANT/REVOKE command; please consult the manual to
     see which privileges can be used

   * 
     Error number: '1145'; Symbol: 'ER_GRANT_WRONG_HOST_OR_USER';
     SQLSTATE: '42000'

     Message: The host or user argument to GRANT is too long

   * 
     Error number: '1146'; Symbol: 'ER_NO_SUCH_TABLE'; SQLSTATE: '42S02'

     Message: Table '%s.%s' doesn't exist

   * 
     Error number: '1147'; Symbol: 'ER_NONEXISTING_TABLE_GRANT';
     SQLSTATE: '42000'

     Message: There is no such grant defined for user '%s' on host '%s'
     on table '%s'

   * 
     Error number: '1148'; Symbol: 'ER_NOT_ALLOWED_COMMAND'; SQLSTATE:
     '42000'

     Message: The used command is not allowed with this MySQL version

   * 
     Error number: '1149'; Symbol: 'ER_SYNTAX_ERROR'; SQLSTATE: '42000'

     Message: You have an error in your SQL syntax; check the manual
     that corresponds to your MySQL server version for the right syntax
     to use

   * 
     Error number: '1150'; Symbol: 'ER_DELAYED_CANT_CHANGE_LOCK';
     SQLSTATE: 'HY000'

     Message: Delayed insert thread couldn't get requested lock for
     table %s

   * 
     Error number: '1151'; Symbol: 'ER_TOO_MANY_DELAYED_THREADS';
     SQLSTATE: 'HY000'

     Message: Too many delayed threads in use

   * 
     Error number: '1152'; Symbol: 'ER_ABORTING_CONNECTION'; SQLSTATE:
     '08S01'

     Message: Aborted connection %ld to db: '%s' user: '%s' (%s)

   * 
     Error number: '1153'; Symbol: 'ER_NET_PACKET_TOO_LARGE'; SQLSTATE:
     '08S01'

     Message: Got a packet bigger than 'max_allowed_packet' bytes

   * 
     Error number: '1154'; Symbol: 'ER_NET_READ_ERROR_FROM_PIPE';
     SQLSTATE: '08S01'

     Message: Got a read error from the connection pipe

   * 
     Error number: '1155'; Symbol: 'ER_NET_FCNTL_ERROR'; SQLSTATE:
     '08S01'

     Message: Got an error from fcntl()

   * 
     Error number: '1156'; Symbol: 'ER_NET_PACKETS_OUT_OF_ORDER';
     SQLSTATE: '08S01'

     Message: Got packets out of order

   * 
     Error number: '1157'; Symbol: 'ER_NET_UNCOMPRESS_ERROR'; SQLSTATE:
     '08S01'

     Message: Couldn't uncompress communication packet

   * 
     Error number: '1158'; Symbol: 'ER_NET_READ_ERROR'; SQLSTATE:
     '08S01'

     Message: Got an error reading communication packets

   * 
     Error number: '1159'; Symbol: 'ER_NET_READ_INTERRUPTED'; SQLSTATE:
     '08S01'

     Message: Got timeout reading communication packets

   * 
     Error number: '1160'; Symbol: 'ER_NET_ERROR_ON_WRITE'; SQLSTATE:
     '08S01'

     Message: Got an error writing communication packets

   * 
     Error number: '1161'; Symbol: 'ER_NET_WRITE_INTERRUPTED'; SQLSTATE:
     '08S01'

     Message: Got timeout writing communication packets

   * 
     Error number: '1162'; Symbol: 'ER_TOO_LONG_STRING'; SQLSTATE:
     '42000'

     Message: Result string is longer than 'max_allowed_packet' bytes

   * 
     Error number: '1163'; Symbol: 'ER_TABLE_CANT_HANDLE_BLOB';
     SQLSTATE: '42000'

     Message: The used table type doesn't support BLOB/TEXT columns

   * 
     Error number: '1164'; Symbol:
     'ER_TABLE_CANT_HANDLE_AUTO_INCREMENT'; SQLSTATE: '42000'

     Message: The used table type doesn't support AUTO_INCREMENT columns

   * 
     Error number: '1165'; Symbol: 'ER_DELAYED_INSERT_TABLE_LOCKED';
     SQLSTATE: 'HY000'

     Message: INSERT DELAYED can't be used with table '%s' because it is
     locked with LOCK TABLES

   * 
     Error number: '1166'; Symbol: 'ER_WRONG_COLUMN_NAME'; SQLSTATE:
     '42000'

     Message: Incorrect column name '%s'

   * 
     Error number: '1167'; Symbol: 'ER_WRONG_KEY_COLUMN'; SQLSTATE:
     '42000'

     Message: The used storage engine can't index column '%s'

   * 
     Error number: '1168'; Symbol: 'ER_WRONG_MRG_TABLE'; SQLSTATE:
     'HY000'

     Message: Unable to open underlying table which is differently
     defined or of non-MyISAM type or doesn't exist

   * 
     Error number: '1169'; Symbol: 'ER_DUP_UNIQUE'; SQLSTATE: '23000'

     Message: Can't write, because of unique constraint, to table '%s'

   * 
     Error number: '1170'; Symbol: 'ER_BLOB_KEY_WITHOUT_LENGTH';
     SQLSTATE: '42000'

     Message: BLOB/TEXT column '%s' used in key specification without a
     key length

   * 
     Error number: '1171'; Symbol: 'ER_PRIMARY_CANT_HAVE_NULL';
     SQLSTATE: '42000'

     Message: All parts of a PRIMARY KEY must be NOT NULL; if you need
     NULL in a key, use UNIQUE instead

   * 
     Error number: '1172'; Symbol: 'ER_TOO_MANY_ROWS'; SQLSTATE: '42000'

     Message: Result consisted of more than one row

   * 
     Error number: '1173'; Symbol: 'ER_REQUIRES_PRIMARY_KEY'; SQLSTATE:
     '42000'

     Message: This table type requires a primary key

     'InnoDB' reports this error when you attempt to drop an implicit
     clustered index (the first 'UNIQUE NOT NULL' index) if the table
     did not contain a PRIMARY KEY.

     'InnoDB' should no longer report this error as of MySQL 5.5.  For
     tables without an explicit 'PRIMARY KEY', 'InnoDB' creates an
     implicit clustered index using the first columns of the table that
     are declared 'UNIQUE' and 'NOT NULL'.  When you drop such an index,
     'InnoDB' now automatically copies the table and rebuilds the index
     using a different 'UNIQUE NOT NULL' group of columns or a
     system-generated key.  Since this operation changes the primary
     key, it uses the slow method of copying the table and re-creating
     the index, rather than the Fast Index Creation technique from *note
     innodb-create-index-implementation::.

   * 
     Error number: '1174'; Symbol: 'ER_NO_RAID_COMPILED'; SQLSTATE:
     'HY000'

     Message: This version of MySQL is not compiled with RAID support

   * 
     Error number: '1175'; Symbol: 'ER_UPDATE_WITHOUT_KEY_IN_SAFE_MODE';
     SQLSTATE: 'HY000'

     Message: You are using safe update mode and you tried to update a
     table without a WHERE that uses a KEY column

   * 
     Error number: '1176'; Symbol: 'ER_KEY_DOES_NOT_EXITS'; SQLSTATE:
     '42000'

     Message: Key '%s' doesn't exist in table '%s'

   * 
     Error number: '1177'; Symbol: 'ER_CHECK_NO_SUCH_TABLE'; SQLSTATE:
     '42000'

     Message: Can't open table

   * 
     Error number: '1178'; Symbol: 'ER_CHECK_NOT_IMPLEMENTED'; SQLSTATE:
     '42000'

     Message: The storage engine for the table doesn't support %s

   * 
     Error number: '1179'; Symbol:
     'ER_CANT_DO_THIS_DURING_AN_TRANSACTION'; SQLSTATE: '25000'

     Message: You are not allowed to execute this command in a
     transaction

   * 
     Error number: '1180'; Symbol: 'ER_ERROR_DURING_COMMIT'; SQLSTATE:
     'HY000'

     Message: Got error %d during COMMIT

   * 
     Error number: '1181'; Symbol: 'ER_ERROR_DURING_ROLLBACK'; SQLSTATE:
     'HY000'

     Message: Got error %d during ROLLBACK

   * 
     Error number: '1182'; Symbol: 'ER_ERROR_DURING_FLUSH_LOGS';
     SQLSTATE: 'HY000'

     Message: Got error %d during FLUSH_LOGS

   * 
     Error number: '1183'; Symbol: 'ER_ERROR_DURING_CHECKPOINT';
     SQLSTATE: 'HY000'

     Message: Got error %d during CHECKPOINT

   * 
     Error number: '1184'; Symbol: 'ER_NEW_ABORTING_CONNECTION';
     SQLSTATE: '08S01'

     Message: Aborted connection %ld to db: '%s' user: '%s' host: '%s'
     (%s)

   * 
     Error number: '1185'; Symbol: 'ER_DUMP_NOT_IMPLEMENTED'; SQLSTATE:
     'HY000'

     Message: The storage engine for the table does not support binary
     table dump

   * 
     Error number: '1186'; Symbol: 'ER_FLUSH_MASTER_BINLOG_CLOSED';
     SQLSTATE: 'HY000'

     Message: Binlog closed, cannot RESET MASTER

   * 
     Error number: '1187'; Symbol: 'ER_INDEX_REBUILD'; SQLSTATE: 'HY000'

     Message: Failed rebuilding the index of dumped table '%s'

   * 
     Error number: '1188'; Symbol: 'ER_MASTER'; SQLSTATE: 'HY000'

     Message: Error from master: '%s'

   * 
     Error number: '1189'; Symbol: 'ER_MASTER_NET_READ'; SQLSTATE:
     '08S01'

     Message: Net error reading from master

   * 
     Error number: '1190'; Symbol: 'ER_MASTER_NET_WRITE'; SQLSTATE:
     '08S01'

     Message: Net error writing to master

   * 
     Error number: '1191'; Symbol: 'ER_FT_MATCHING_KEY_NOT_FOUND';
     SQLSTATE: 'HY000'

     Message: Can't find FULLTEXT index matching the column list

   * 
     Error number: '1192'; Symbol: 'ER_LOCK_OR_ACTIVE_TRANSACTION';
     SQLSTATE: 'HY000'

     Message: Can't execute the given command because you have active
     locked tables or an active transaction

   * 
     Error number: '1193'; Symbol: 'ER_UNKNOWN_SYSTEM_VARIABLE';
     SQLSTATE: 'HY000'

     Message: Unknown system variable '%s'

   * 
     Error number: '1194'; Symbol: 'ER_CRASHED_ON_USAGE'; SQLSTATE:
     'HY000'

     Message: Table '%s' is marked as crashed and should be repaired

   * 
     Error number: '1195'; Symbol: 'ER_CRASHED_ON_REPAIR'; SQLSTATE:
     'HY000'

     Message: Table '%s' is marked as crashed and last (automatic?)
     repair failed

   * 
     Error number: '1196'; Symbol: 'ER_WARNING_NOT_COMPLETE_ROLLBACK';
     SQLSTATE: 'HY000'

     Message: Some non-transactional changed tables couldn't be rolled
     back

   * 
     Error number: '1197'; Symbol: 'ER_TRANS_CACHE_FULL'; SQLSTATE:
     'HY000'

     Message: Multi-statement transaction required more than
     'max_binlog_cache_size' bytes of storage; increase this mysqld
     variable and try again

   * 
     Error number: '1198'; Symbol: 'ER_SLAVE_MUST_STOP'; SQLSTATE:
     'HY000'

     Message: This operation cannot be performed with a running slave;
     run STOP SLAVE first

   * 
     Error number: '1199'; Symbol: 'ER_SLAVE_NOT_RUNNING'; SQLSTATE:
     'HY000'

     Message: This operation requires a running slave; configure slave
     and do START SLAVE

   * 
     Error number: '1200'; Symbol: 'ER_BAD_SLAVE'; SQLSTATE: 'HY000'

     Message: The server is not configured as slave; fix in config file
     or with CHANGE MASTER TO

   * 
     Error number: '1201'; Symbol: 'ER_MASTER_INFO'; SQLSTATE: 'HY000'

     Message: Could not initialize master info structure; more error
     messages can be found in the MySQL error log

   * 
     Error number: '1202'; Symbol: 'ER_SLAVE_THREAD'; SQLSTATE: 'HY000'

     Message: Could not create slave thread; check system resources

   * 
     Error number: '1203'; Symbol: 'ER_TOO_MANY_USER_CONNECTIONS';
     SQLSTATE: '42000'

     Message: User %s already has more than 'max_user_connections'
     active connections

   * 
     Error number: '1204'; Symbol: 'ER_SET_CONSTANTS_ONLY'; SQLSTATE:
     'HY000'

     Message: You may only use constant expressions with SET

   * 
     Error number: '1205'; Symbol: 'ER_LOCK_WAIT_TIMEOUT'; SQLSTATE:
     'HY000'

     Message: Lock wait timeout exceeded; try restarting transaction

     'InnoDB' reports this error when lock wait timeout expires.  The
     statement that waited too long was rolled back (not the entire
     transaction).  You can increase the value of the
     'innodb_lock_wait_timeout' configuration option if SQL statements
     should wait longer for other transactions to complete, or decrease
     it if too many long-running transactions are causing locking
     problems and reducing concurrency on a busy system.

   * 
     Error number: '1206'; Symbol: 'ER_LOCK_TABLE_FULL'; SQLSTATE:
     'HY000'

     Message: The total number of locks exceeds the lock table size

     'InnoDB' reports this error when the total number of locks exceeds
     the amount of memory devoted to managing locks.  To avoid this
     error, increase the value of 'innodb_buffer_pool_size'.  Within an
     individual application, a workaround may be to break a large
     operation into smaller pieces.  For example, if the error occurs
     for a large *note 'INSERT': insert, perform several smaller *note
     'INSERT': insert. operations.

   * 
     Error number: '1207'; Symbol: 'ER_READ_ONLY_TRANSACTION'; SQLSTATE:
     '25000'

     Message: Update locks cannot be acquired during a READ UNCOMMITTED
     transaction

   * 
     Error number: '1208'; Symbol: 'ER_DROP_DB_WITH_READ_LOCK';
     SQLSTATE: 'HY000'

     Message: DROP DATABASE not allowed while thread is holding global
     read lock

   * 
     Error number: '1209'; Symbol: 'ER_CREATE_DB_WITH_READ_LOCK';
     SQLSTATE: 'HY000'

     Message: CREATE DATABASE not allowed while thread is holding global
     read lock

   * 
     Error number: '1210'; Symbol: 'ER_WRONG_ARGUMENTS'; SQLSTATE:
     'HY000'

     Message: Incorrect arguments to %s

   * 
     Error number: '1211'; Symbol: 'ER_NO_PERMISSION_TO_CREATE_USER';
     SQLSTATE: '42000'

     Message: '%s'@'%s' is not allowed to create new users

   * 
     Error number: '1212'; Symbol: 'ER_UNION_TABLES_IN_DIFFERENT_DIR';
     SQLSTATE: 'HY000'

     Message: Incorrect table definition; all MERGE tables must be in
     the same database

   * 
     Error number: '1213'; Symbol: 'ER_LOCK_DEADLOCK'; SQLSTATE: '40001'

     Message: Deadlock found when trying to get lock; try restarting
     transaction

     'InnoDB' reports this error when a transaction encounters a
     deadlock and is automatically rolled back so that your application
     can take corrective action.  To recover from this error, run all
     the operations in this transaction again.  A deadlock occurs when
     requests for locks arrive in inconsistent order between
     transactions.  The transaction that was rolled back released all
     its locks, and the other transaction can now get all the locks it
     requested.  Thus, when you re-run the transaction that was rolled
     back, it might have to wait for other transactions to complete, but
     typically the deadlock does not recur.  If you encounter frequent
     deadlocks, make the sequence of locking operations ('LOCK TABLES',
     'SELECT ... FOR UPDATE', and so on) consistent between the
     different transactions or applications that experience the issue.
     See *note innodb-deadlocks:: for details.

   * 
     Error number: '1214'; Symbol: 'ER_TABLE_CANT_HANDLE_FT'; SQLSTATE:
     'HY000'

     Message: The used table type doesn't support FULLTEXT indexes

   * 
     Error number: '1215'; Symbol: 'ER_CANNOT_ADD_FOREIGN'; SQLSTATE:
     'HY000'

     Message: Cannot add foreign key constraint

   * 
     Error number: '1216'; Symbol: 'ER_NO_REFERENCED_ROW'; SQLSTATE:
     '23000'

     Message: Cannot add or update a child row: a foreign key constraint
     fails

     'InnoDB' reports this error when you try to add a row but there is
     no parent row, and a foreign key constraint fails.  Add the parent
     row first.

   * 
     Error number: '1217'; Symbol: 'ER_ROW_IS_REFERENCED'; SQLSTATE:
     '23000'

     Message: Cannot delete or update a parent row: a foreign key
     constraint fails

     'InnoDB' reports this error when you try to delete a parent row
     that has children, and a foreign key constraint fails.  Delete the
     children first.

   * 
     Error number: '1218'; Symbol: 'ER_CONNECT_TO_MASTER'; SQLSTATE:
     '08S01'

     Message: Error connecting to master: %s

   * 
     Error number: '1219'; Symbol: 'ER_QUERY_ON_MASTER'; SQLSTATE:
     'HY000'

     Message: Error running query on master: %s

   * 
     Error number: '1220'; Symbol: 'ER_ERROR_WHEN_EXECUTING_COMMAND';
     SQLSTATE: 'HY000'

     Message: Error when executing command %s: %s

   * 
     Error number: '1221'; Symbol: 'ER_WRONG_USAGE'; SQLSTATE: 'HY000'

     Message: Incorrect usage of %s and %s

   * 
     Error number: '1222'; Symbol:
     'ER_WRONG_NUMBER_OF_COLUMNS_IN_SELECT'; SQLSTATE: '21000'

     Message: The used SELECT statements have a different number of
     columns

   * 
     Error number: '1223'; Symbol: 'ER_CANT_UPDATE_WITH_READLOCK';
     SQLSTATE: 'HY000'

     Message: Can't execute the query because you have a conflicting
     read lock

   * 
     Error number: '1224'; Symbol: 'ER_MIXING_NOT_ALLOWED'; SQLSTATE:
     'HY000'

     Message: Mixing of transactional and non-transactional tables is
     disabled

   * 
     Error number: '1225'; Symbol: 'ER_DUP_ARGUMENT'; SQLSTATE: 'HY000'

     Message: Option '%s' used twice in statement

   * 
     Error number: '1226'; Symbol: 'ER_USER_LIMIT_REACHED'; SQLSTATE:
     '42000'

     Message: User '%s' has exceeded the '%s' resource (current value:
     %ld)

   * 
     Error number: '1227'; Symbol: 'ER_SPECIFIC_ACCESS_DENIED_ERROR';
     SQLSTATE: '42000'

     Message: Access denied; you need (at least one of) the %s
     privilege(s) for this operation

   * 
     Error number: '1228'; Symbol: 'ER_LOCAL_VARIABLE'; SQLSTATE:
     'HY000'

     Message: Variable '%s' is a SESSION variable and can't be used with
     SET GLOBAL

   * 
     Error number: '1229'; Symbol: 'ER_GLOBAL_VARIABLE'; SQLSTATE:
     'HY000'

     Message: Variable '%s' is a GLOBAL variable and should be set with
     SET GLOBAL

   * 
     Error number: '1230'; Symbol: 'ER_NO_DEFAULT'; SQLSTATE: '42000'

     Message: Variable '%s' doesn't have a default value

   * 
     Error number: '1231'; Symbol: 'ER_WRONG_VALUE_FOR_VAR'; SQLSTATE:
     '42000'

     Message: Variable '%s' can't be set to the value of '%s'

   * 
     Error number: '1232'; Symbol: 'ER_WRONG_TYPE_FOR_VAR'; SQLSTATE:
     '42000'

     Message: Incorrect argument type to variable '%s'

   * 
     Error number: '1233'; Symbol: 'ER_VAR_CANT_BE_READ'; SQLSTATE:
     'HY000'

     Message: Variable '%s' can only be set, not read

   * 
     Error number: '1234'; Symbol: 'ER_CANT_USE_OPTION_HERE'; SQLSTATE:
     '42000'

     Message: Incorrect usage/placement of '%s'

   * 
     Error number: '1235'; Symbol: 'ER_NOT_SUPPORTED_YET'; SQLSTATE:
     '42000'

     Message: This version of MySQL doesn't yet support '%s'

   * 
     Error number: '1236'; Symbol:
     'ER_MASTER_FATAL_ERROR_READING_BINLOG'; SQLSTATE: 'HY000'

     Message: Got fatal error %d from master when reading data from
     binary log: '%s'

   * 
     Error number: '1237'; Symbol: 'ER_SLAVE_IGNORED_TABLE'; SQLSTATE:
     'HY000'

     Message: Slave SQL thread ignored the query because of
     replicate-*-table rules

   * 
     Error number: '1238'; Symbol: 'ER_INCORRECT_GLOBAL_LOCAL_VAR';
     SQLSTATE: 'HY000'

     Message: Variable '%s' is a %s variable

   * 
     Error number: '1239'; Symbol: 'ER_WRONG_FK_DEF'; SQLSTATE: '42000'

     Message: Incorrect foreign key definition for '%s': %s

   * 
     Error number: '1240'; Symbol: 'ER_KEY_REF_DO_NOT_MATCH_TABLE_REF';
     SQLSTATE: 'HY000'

     Message: Key reference and table reference don't match

   * 
     Error number: '1241'; Symbol: 'ER_OPERAND_COLUMNS'; SQLSTATE:
     '21000'

     Message: Operand should contain %d column(s)

   * 
     Error number: '1242'; Symbol: 'ER_SUBQUERY_NO_1_ROW'; SQLSTATE:
     '21000'

     Message: Subquery returns more than 1 row

   * 
     Error number: '1243'; Symbol: 'ER_UNKNOWN_STMT_HANDLER'; SQLSTATE:
     'HY000'

     Message: Unknown prepared statement handler (%.*s) given to %s

   * 
     Error number: '1244'; Symbol: 'ER_CORRUPT_HELP_DB'; SQLSTATE:
     'HY000'

     Message: Help database is corrupt or does not exist

   * 
     Error number: '1245'; Symbol: 'ER_CYCLIC_REFERENCE'; SQLSTATE:
     'HY000'

     Message: Cyclic reference on subqueries

   * 
     Error number: '1246'; Symbol: 'ER_AUTO_CONVERT'; SQLSTATE: 'HY000'

     Message: Converting column '%s' from %s to %s

   * 
     Error number: '1247'; Symbol: 'ER_ILLEGAL_REFERENCE'; SQLSTATE:
     '42S22'

     Message: Reference '%s' not supported (%s)

   * 
     Error number: '1248'; Symbol: 'ER_DERIVED_MUST_HAVE_ALIAS';
     SQLSTATE: '42000'

     Message: Every derived table must have its own alias

   * 
     Error number: '1249'; Symbol: 'ER_SELECT_REDUCED'; SQLSTATE:
     '01000'

     Message: Select %u was reduced during optimization

   * 
     Error number: '1250'; Symbol: 'ER_TABLENAME_NOT_ALLOWED_HERE';
     SQLSTATE: '42000'

     Message: Table '%s' from one of the SELECTs cannot be used in %s

   * 
     Error number: '1251'; Symbol: 'ER_NOT_SUPPORTED_AUTH_MODE';
     SQLSTATE: '08004'

     Message: Client does not support authentication protocol requested
     by server; consider upgrading MySQL client

   * 
     Error number: '1252'; Symbol: 'ER_SPATIAL_CANT_HAVE_NULL';
     SQLSTATE: '42000'

     Message: All parts of a SPATIAL index must be NOT NULL

   * 
     Error number: '1253'; Symbol: 'ER_COLLATION_CHARSET_MISMATCH';
     SQLSTATE: '42000'

     Message: COLLATION '%s' is not valid for CHARACTER SET '%s'

   * 
     Error number: '1254'; Symbol: 'ER_SLAVE_WAS_RUNNING'; SQLSTATE:
     'HY000'

     Message: Slave is already running

   * 
     Error number: '1255'; Symbol: 'ER_SLAVE_WAS_NOT_RUNNING'; SQLSTATE:
     'HY000'

     Message: Slave already has been stopped

   * 
     Error number: '1256'; Symbol: 'ER_TOO_BIG_FOR_UNCOMPRESS';
     SQLSTATE: 'HY000'

     Message: Uncompressed data size too large; the maximum size is %d
     (probably, length of uncompressed data was corrupted)

   * 
     Error number: '1257'; Symbol: 'ER_ZLIB_Z_MEM_ERROR'; SQLSTATE:
     'HY000'

     Message: ZLIB: Not enough memory

   * 
     Error number: '1258'; Symbol: 'ER_ZLIB_Z_BUF_ERROR'; SQLSTATE:
     'HY000'

     Message: ZLIB: Not enough room in the output buffer (probably,
     length of uncompressed data was corrupted)

   * 
     Error number: '1259'; Symbol: 'ER_ZLIB_Z_DATA_ERROR'; SQLSTATE:
     'HY000'

     Message: ZLIB: Input data corrupted

   * 
     Error number: '1260'; Symbol: 'ER_CUT_VALUE_GROUP_CONCAT';
     SQLSTATE: 'HY000'

     Message: Row %u was cut by GROUP_CONCAT()

   * 
     Error number: '1261'; Symbol: 'ER_WARN_TOO_FEW_RECORDS'; SQLSTATE:
     '01000'

     Message: Row %ld doesn't contain data for all columns

   * 
     Error number: '1262'; Symbol: 'ER_WARN_TOO_MANY_RECORDS'; SQLSTATE:
     '01000'

     Message: Row %ld was truncated; it contained more data than there
     were input columns

   * 
     Error number: '1263'; Symbol: 'ER_WARN_NULL_TO_NOTNULL'; SQLSTATE:
     '22004'

     Message: Column set to default value; NULL supplied to NOT NULL
     column '%s' at row %ld

   * 
     Error number: '1264'; Symbol: 'ER_WARN_DATA_OUT_OF_RANGE';
     SQLSTATE: '22003'

     Message: Out of range value for column '%s' at row %ld

   * 
     Error number: '1265'; Symbol: 'WARN_DATA_TRUNCATED'; SQLSTATE:
     '01000'

     Message: Data truncated for column '%s' at row %ld

   * 
     Error number: '1266'; Symbol: 'ER_WARN_USING_OTHER_HANDLER';
     SQLSTATE: 'HY000'

     Message: Using storage engine %s for table '%s'

   * 
     Error number: '1267'; Symbol: 'ER_CANT_AGGREGATE_2COLLATIONS';
     SQLSTATE: 'HY000'

     Message: Illegal mix of collations (%s,%s) and (%s,%s) for
     operation '%s'

   * 
     Error number: '1268'; Symbol: 'ER_DROP_USER'; SQLSTATE: 'HY000'

     Message: Cannot drop one or more of the requested users

   * 
     Error number: '1269'; Symbol: 'ER_REVOKE_GRANTS'; SQLSTATE: 'HY000'

     Message: Can't revoke all privileges for one or more of the
     requested users

   * 
     Error number: '1270'; Symbol: 'ER_CANT_AGGREGATE_3COLLATIONS';
     SQLSTATE: 'HY000'

     Message: Illegal mix of collations (%s,%s), (%s,%s), (%s,%s) for
     operation '%s'

   * 
     Error number: '1271'; Symbol: 'ER_CANT_AGGREGATE_NCOLLATIONS';
     SQLSTATE: 'HY000'

     Message: Illegal mix of collations for operation '%s'

   * 
     Error number: '1272'; Symbol: 'ER_VARIABLE_IS_NOT_STRUCT';
     SQLSTATE: 'HY000'

     Message: Variable '%s' is not a variable component (can't be used
     as XXXX.variable_name)

   * 
     Error number: '1273'; Symbol: 'ER_UNKNOWN_COLLATION'; SQLSTATE:
     'HY000'

     Message: Unknown collation: '%s'

   * 
     Error number: '1274'; Symbol: 'ER_SLAVE_IGNORED_SSL_PARAMS';
     SQLSTATE: 'HY000'

     Message: SSL parameters in CHANGE MASTER are ignored because this
     MySQL slave was compiled without SSL support; they can be used
     later if MySQL slave with SSL is started

   * 
     Error number: '1275'; Symbol: 'ER_SERVER_IS_IN_SECURE_AUTH_MODE';
     SQLSTATE: 'HY000'

     Message: Server is running in -secure-auth mode, but '%s'@'%s' has
     a password in the old format; please change the password to the new
     format

   * 
     Error number: '1276'; Symbol: 'ER_WARN_FIELD_RESOLVED'; SQLSTATE:
     'HY000'

     Message: Field or reference '%s%s%s%s%s' of SELECT #%d was resolved
     in SELECT #%d

   * 
     Error number: '1277'; Symbol: 'ER_BAD_SLAVE_UNTIL_COND'; SQLSTATE:
     'HY000'

     Message: Incorrect parameter or combination of parameters for START
     SLAVE UNTIL

   * 
     Error number: '1278'; Symbol: 'ER_MISSING_SKIP_SLAVE'; SQLSTATE:
     'HY000'

     Message: It is recommended to use -skip-slave-start when doing
     step-by-step replication with START SLAVE UNTIL; otherwise, you
     will get problems if you get an unexpected slave's mysqld restart

   * 
     Error number: '1279'; Symbol: 'ER_UNTIL_COND_IGNORED'; SQLSTATE:
     'HY000'

     Message: SQL thread is not to be started so UNTIL options are
     ignored

   * 
     Error number: '1280'; Symbol: 'ER_WRONG_NAME_FOR_INDEX'; SQLSTATE:
     '42000'

     Message: Incorrect index name '%s'

   * 
     Error number: '1281'; Symbol: 'ER_WRONG_NAME_FOR_CATALOG';
     SQLSTATE: '42000'

     Message: Incorrect catalog name '%s'

   * 
     Error number: '1282'; Symbol: 'ER_WARN_QC_RESIZE'; SQLSTATE:
     'HY000'

     Message: Query cache failed to set size %lu; new query cache size
     is %lu

   * 
     Error number: '1283'; Symbol: 'ER_BAD_FT_COLUMN'; SQLSTATE: 'HY000'

     Message: Column '%s' cannot be part of FULLTEXT index

   * 
     Error number: '1284'; Symbol: 'ER_UNKNOWN_KEY_CACHE'; SQLSTATE:
     'HY000'

     Message: Unknown key cache '%s'

   * 
     Error number: '1285'; Symbol: 'ER_WARN_HOSTNAME_WONT_WORK';
     SQLSTATE: 'HY000'

     Message: MySQL is started in -skip-name-resolve mode; you must
     restart it without this switch for this grant to work

   * 
     Error number: '1286'; Symbol: 'ER_UNKNOWN_STORAGE_ENGINE';
     SQLSTATE: '42000'

     Message: Unknown storage engine '%s'

   * 
     Error number: '1287'; Symbol: 'ER_WARN_DEPRECATED_SYNTAX';
     SQLSTATE: 'HY000'

     Message: '%s' is deprecated and will be removed in a future
     release.  Please use %s instead

   * 
     Error number: '1288'; Symbol: 'ER_NON_UPDATABLE_TABLE'; SQLSTATE:
     'HY000'

     Message: The target table %s of the %s is not updatable

   * 
     Error number: '1289'; Symbol: 'ER_FEATURE_DISABLED'; SQLSTATE:
     'HY000'

     Message: The '%s' feature is disabled; you need MySQL built with
     '%s' to have it working

   * 
     Error number: '1290'; Symbol: 'ER_OPTION_PREVENTS_STATEMENT';
     SQLSTATE: 'HY000'

     Message: The MySQL server is running with the %s option so it
     cannot execute this statement

   * 
     Error number: '1291'; Symbol: 'ER_DUPLICATED_VALUE_IN_TYPE';
     SQLSTATE: 'HY000'

     Message: Column '%s' has duplicated value '%s' in %s

   * 
     Error number: '1292'; Symbol: 'ER_TRUNCATED_WRONG_VALUE'; SQLSTATE:
     '22007'

     Message: Truncated incorrect %s value: '%s'

   * 
     Error number: '1293'; Symbol: 'ER_TOO_MUCH_AUTO_TIMESTAMP_COLS';
     SQLSTATE: 'HY000'

     Message: Incorrect table definition; there can be only one
     TIMESTAMP column with CURRENT_TIMESTAMP in DEFAULT or ON UPDATE
     clause

   * 
     Error number: '1294'; Symbol: 'ER_INVALID_ON_UPDATE'; SQLSTATE:
     'HY000'

     Message: Invalid ON UPDATE clause for '%s' column

   * 
     Error number: '1295'; Symbol: 'ER_UNSUPPORTED_PS'; SQLSTATE:
     'HY000'

     Message: This command is not supported in the prepared statement
     protocol yet

   * 
     Error number: '1296'; Symbol: 'ER_GET_ERRMSG'; SQLSTATE: 'HY000'

     Message: Got error %d '%s' from %s

   * 
     Error number: '1297'; Symbol: 'ER_GET_TEMPORARY_ERRMSG'; SQLSTATE:
     'HY000'

     Message: Got temporary error %d '%s' from %s

   * 
     Error number: '1298'; Symbol: 'ER_UNKNOWN_TIME_ZONE'; SQLSTATE:
     'HY000'

     Message: Unknown or incorrect time zone: '%s'

   * 
     Error number: '1299'; Symbol: 'ER_WARN_INVALID_TIMESTAMP';
     SQLSTATE: 'HY000'

     Message: Invalid TIMESTAMP value in column '%s' at row %ld

   * 
     Error number: '1300'; Symbol: 'ER_INVALID_CHARACTER_STRING';
     SQLSTATE: 'HY000'

     Message: Invalid %s character string: '%s'

   * 
     Error number: '1301'; Symbol: 'ER_WARN_ALLOWED_PACKET_OVERFLOWED';
     SQLSTATE: 'HY000'

     Message: Result of %s() was larger than max_allowed_packet (%ld) -
     truncated

   * 
     Error number: '1302'; Symbol: 'ER_CONFLICTING_DECLARATIONS';
     SQLSTATE: 'HY000'

     Message: Conflicting declarations: '%s%s' and '%s%s'

   * 
     Error number: '1303'; Symbol: 'ER_SP_NO_RECURSIVE_CREATE';
     SQLSTATE: '2F003'

     Message: Can't create a %s from within another stored routine

   * 
     Error number: '1304'; Symbol: 'ER_SP_ALREADY_EXISTS'; SQLSTATE:
     '42000'

     Message: %s %s already exists

   * 
     Error number: '1305'; Symbol: 'ER_SP_DOES_NOT_EXIST'; SQLSTATE:
     '42000'

     Message: %s %s does not exist

   * 
     Error number: '1306'; Symbol: 'ER_SP_DROP_FAILED'; SQLSTATE:
     'HY000'

     Message: Failed to DROP %s %s

   * 
     Error number: '1307'; Symbol: 'ER_SP_STORE_FAILED'; SQLSTATE:
     'HY000'

     Message: Failed to CREATE %s %s

   * 
     Error number: '1308'; Symbol: 'ER_SP_LILABEL_MISMATCH'; SQLSTATE:
     '42000'

     Message: %s with no matching label: %s

   * 
     Error number: '1309'; Symbol: 'ER_SP_LABEL_REDEFINE'; SQLSTATE:
     '42000'

     Message: Redefining label %s

   * 
     Error number: '1310'; Symbol: 'ER_SP_LABEL_MISMATCH'; SQLSTATE:
     '42000'

     Message: End-label %s without match

   * 
     Error number: '1311'; Symbol: 'ER_SP_UNINIT_VAR'; SQLSTATE: '01000'

     Message: Referring to uninitialized variable %s

   * 
     Error number: '1312'; Symbol: 'ER_SP_BADSELECT'; SQLSTATE: '0A000'

     Message: PROCEDURE %s can't return a result set in the given
     context

   * 
     Error number: '1313'; Symbol: 'ER_SP_BADRETURN'; SQLSTATE: '42000'

     Message: RETURN is only allowed in a FUNCTION

   * 
     Error number: '1314'; Symbol: 'ER_SP_BADSTATEMENT'; SQLSTATE:
     '0A000'

     Message: %s is not allowed in stored procedures

   * 
     Error number: '1315'; Symbol: 'ER_UPDATE_LOG_DEPRECATED_IGNORED';
     SQLSTATE: '42000'

     Message: The update log is deprecated and replaced by the binary
     log; SET SQL_LOG_UPDATE has been ignored.  This option will be
     removed in MySQL 5.6.

   * 
     Error number: '1316'; Symbol:
     'ER_UPDATE_LOG_DEPRECATED_TRANSLATED'; SQLSTATE: '42000'

     Message: The update log is deprecated and replaced by the binary
     log; SET SQL_LOG_UPDATE has been translated to SET SQL_LOG_BIN.
     This option will be removed in MySQL 5.6.

   * 
     Error number: '1317'; Symbol: 'ER_QUERY_INTERRUPTED'; SQLSTATE:
     '70100'

     Message: Query execution was interrupted

   * 
     Error number: '1318'; Symbol: 'ER_SP_WRONG_NO_OF_ARGS'; SQLSTATE:
     '42000'

     Message: Incorrect number of arguments for %s %s; expected %u, got
     %u

   * 
     Error number: '1319'; Symbol: 'ER_SP_COND_MISMATCH'; SQLSTATE:
     '42000'

     Message: Undefined CONDITION: %s

   * 
     Error number: '1320'; Symbol: 'ER_SP_NORETURN'; SQLSTATE: '42000'

     Message: No RETURN found in FUNCTION %s

   * 
     Error number: '1321'; Symbol: 'ER_SP_NORETURNEND'; SQLSTATE:
     '2F005'

     Message: FUNCTION %s ended without RETURN

   * 
     Error number: '1322'; Symbol: 'ER_SP_BAD_CURSOR_QUERY'; SQLSTATE:
     '42000'

     Message: Cursor statement must be a SELECT

   * 
     Error number: '1323'; Symbol: 'ER_SP_BAD_CURSOR_SELECT'; SQLSTATE:
     '42000'

     Message: Cursor SELECT must not have INTO

   * 
     Error number: '1324'; Symbol: 'ER_SP_CURSOR_MISMATCH'; SQLSTATE:
     '42000'

     Message: Undefined CURSOR: %s

   * 
     Error number: '1325'; Symbol: 'ER_SP_CURSOR_ALREADY_OPEN';
     SQLSTATE: '24000'

     Message: Cursor is already open

   * 
     Error number: '1326'; Symbol: 'ER_SP_CURSOR_NOT_OPEN'; SQLSTATE:
     '24000'

     Message: Cursor is not open

   * 
     Error number: '1327'; Symbol: 'ER_SP_UNDECLARED_VAR'; SQLSTATE:
     '42000'

     Message: Undeclared variable: %s

   * 
     Error number: '1328'; Symbol: 'ER_SP_WRONG_NO_OF_FETCH_ARGS';
     SQLSTATE: 'HY000'

     Message: Incorrect number of FETCH variables

   * 
     Error number: '1329'; Symbol: 'ER_SP_FETCH_NO_DATA'; SQLSTATE:
     '02000'

     Message: No data - zero rows fetched, selected, or processed

   * 
     Error number: '1330'; Symbol: 'ER_SP_DUP_PARAM'; SQLSTATE: '42000'

     Message: Duplicate parameter: %s

   * 
     Error number: '1331'; Symbol: 'ER_SP_DUP_VAR'; SQLSTATE: '42000'

     Message: Duplicate variable: %s

   * 
     Error number: '1332'; Symbol: 'ER_SP_DUP_COND'; SQLSTATE: '42000'

     Message: Duplicate condition: %s

   * 
     Error number: '1333'; Symbol: 'ER_SP_DUP_CURS'; SQLSTATE: '42000'

     Message: Duplicate cursor: %s

   * 
     Error number: '1334'; Symbol: 'ER_SP_CANT_ALTER'; SQLSTATE: 'HY000'

     Message: Failed to ALTER %s %s

   * 
     Error number: '1335'; Symbol: 'ER_SP_SUBSELECT_NYI'; SQLSTATE:
     '0A000'

     Message: Subquery value not supported

   * 
     Error number: '1336'; Symbol: 'ER_STMT_NOT_ALLOWED_IN_SF_OR_TRG';
     SQLSTATE: '0A000'

     Message: %s is not allowed in stored function or trigger

   * 
     Error number: '1337'; Symbol: 'ER_SP_VARCOND_AFTER_CURSHNDLR';
     SQLSTATE: '42000'

     Message: Variable or condition declaration after cursor or handler
     declaration

   * 
     Error number: '1338'; Symbol: 'ER_SP_CURSOR_AFTER_HANDLER';
     SQLSTATE: '42000'

     Message: Cursor declaration after handler declaration

   * 
     Error number: '1339'; Symbol: 'ER_SP_CASE_NOT_FOUND'; SQLSTATE:
     '20000'

     Message: Case not found for CASE statement

   * 
     Error number: '1340'; Symbol: 'ER_FPARSER_TOO_BIG_FILE'; SQLSTATE:
     'HY000'

     Message: Configuration file '%s' is too big

   * 
     Error number: '1341'; Symbol: 'ER_FPARSER_BAD_HEADER'; SQLSTATE:
     'HY000'

     Message: Malformed file type header in file '%s'

   * 
     Error number: '1342'; Symbol: 'ER_FPARSER_EOF_IN_COMMENT';
     SQLSTATE: 'HY000'

     Message: Unexpected end of file while parsing comment '%s'

   * 
     Error number: '1343'; Symbol: 'ER_FPARSER_ERROR_IN_PARAMETER';
     SQLSTATE: 'HY000'

     Message: Error while parsing parameter '%s' (line: '%s')

   * 
     Error number: '1344'; Symbol:
     'ER_FPARSER_EOF_IN_UNKNOWN_PARAMETER'; SQLSTATE: 'HY000'

     Message: Unexpected end of file while skipping unknown parameter
     '%s'

   * 
     Error number: '1345'; Symbol: 'ER_VIEW_NO_EXPLAIN'; SQLSTATE:
     'HY000'

     Message: EXPLAIN/SHOW can not be issued; lacking privileges for
     underlying table

   * 
     Error number: '1346'; Symbol: 'ER_FRM_UNKNOWN_TYPE'; SQLSTATE:
     'HY000'

     Message: File '%s' has unknown type '%s' in its header

   * 
     Error number: '1347'; Symbol: 'ER_WRONG_OBJECT'; SQLSTATE: 'HY000'

     Message: '%s.%s' is not %s

     The named object is incorrect for the type of operation attempted
     on it.  It must be an object of the named type.

   * 
     Error number: '1348'; Symbol: 'ER_NONUPDATEABLE_COLUMN'; SQLSTATE:
     'HY000'

     Message: Column '%s' is not updatable

   * 
     Error number: '1349'; Symbol: 'ER_VIEW_SELECT_DERIVED'; SQLSTATE:
     'HY000'

     Message: View's SELECT contains a subquery in the FROM clause

   * 
     Error number: '1350'; Symbol: 'ER_VIEW_SELECT_CLAUSE'; SQLSTATE:
     'HY000'

     Message: View's SELECT contains a '%s' clause

   * 
     Error number: '1351'; Symbol: 'ER_VIEW_SELECT_VARIABLE'; SQLSTATE:
     'HY000'

     Message: View's SELECT contains a variable or parameter

   * 
     Error number: '1352'; Symbol: 'ER_VIEW_SELECT_TMPTABLE'; SQLSTATE:
     'HY000'

     Message: View's SELECT refers to a temporary table '%s'

   * 
     Error number: '1353'; Symbol: 'ER_VIEW_WRONG_LIST'; SQLSTATE:
     'HY000'

     Message: View's SELECT and view's field list have different column
     counts

   * 
     Error number: '1354'; Symbol: 'ER_WARN_VIEW_MERGE'; SQLSTATE:
     'HY000'

     Message: View merge algorithm can't be used here for now (assumed
     undefined algorithm)

   * 
     Error number: '1355'; Symbol: 'ER_WARN_VIEW_WITHOUT_KEY'; SQLSTATE:
     'HY000'

     Message: View being updated does not have complete key of
     underlying table in it

   * 
     Error number: '1356'; Symbol: 'ER_VIEW_INVALID'; SQLSTATE: 'HY000'

     Message: View '%s.%s' references invalid table(s) or column(s) or
     function(s) or definer/invoker of view lack rights to use them

   * 
     Error number: '1357'; Symbol: 'ER_SP_NO_DROP_SP'; SQLSTATE: 'HY000'

     Message: Can't drop or alter a %s from within another stored
     routine

   * 
     Error number: '1358'; Symbol: 'ER_SP_GOTO_IN_HNDLR'; SQLSTATE:
     'HY000'

     Message: GOTO is not allowed in a stored procedure handler

   * 
     Error number: '1359'; Symbol: 'ER_TRG_ALREADY_EXISTS'; SQLSTATE:
     'HY000'

     Message: Trigger already exists

   * 
     Error number: '1360'; Symbol: 'ER_TRG_DOES_NOT_EXIST'; SQLSTATE:
     'HY000'

     Message: Trigger does not exist

   * 
     Error number: '1361'; Symbol: 'ER_TRG_ON_VIEW_OR_TEMP_TABLE';
     SQLSTATE: 'HY000'

     Message: Trigger's '%s' is view or temporary table

   * 
     Error number: '1362'; Symbol: 'ER_TRG_CANT_CHANGE_ROW'; SQLSTATE:
     'HY000'

     Message: Updating of %s row is not allowed in %strigger

   * 
     Error number: '1363'; Symbol: 'ER_TRG_NO_SUCH_ROW_IN_TRG';
     SQLSTATE: 'HY000'

     Message: There is no %s row in %s trigger

   * 
     Error number: '1364'; Symbol: 'ER_NO_DEFAULT_FOR_FIELD'; SQLSTATE:
     'HY000'

     Message: Field '%s' doesn't have a default value

   * 
     Error number: '1365'; Symbol: 'ER_DIVISION_BY_ZERO'; SQLSTATE:
     '22012'

     Message: Division by 0

   * 
     Error number: '1366'; Symbol: 'ER_TRUNCATED_WRONG_VALUE_FOR_FIELD';
     SQLSTATE: 'HY000'

     Message: Incorrect %s value: '%s' for column '%s' at row %ld

   * 
     Error number: '1367'; Symbol: 'ER_ILLEGAL_VALUE_FOR_TYPE';
     SQLSTATE: '22007'

     Message: Illegal %s '%s' value found during parsing

   * 
     Error number: '1368'; Symbol: 'ER_VIEW_NONUPD_CHECK'; SQLSTATE:
     'HY000'

     Message: CHECK OPTION on non-updatable view '%s.%s'

   * 
     Error number: '1369'; Symbol: 'ER_VIEW_CHECK_FAILED'; SQLSTATE:
     'HY000'

     Message: CHECK OPTION failed '%s.%s'

   * 
     Error number: '1370'; Symbol: 'ER_PROCACCESS_DENIED_ERROR';
     SQLSTATE: '42000'

     Message: %s command denied to user '%s'@'%s' for routine '%s'

   * 
     Error number: '1371'; Symbol: 'ER_RELAY_LOG_FAIL'; SQLSTATE:
     'HY000'

     Message: Failed purging old relay logs: %s

   * 
     Error number: '1372'; Symbol: 'ER_PASSWD_LENGTH'; SQLSTATE: 'HY000'

     Message: Password hash should be a %d-digit hexadecimal number

   * 
     Error number: '1373'; Symbol: 'ER_UNKNOWN_TARGET_BINLOG'; SQLSTATE:
     'HY000'

     Message: Target log not found in binlog index

   * 
     Error number: '1374'; Symbol: 'ER_IO_ERR_LOG_INDEX_READ'; SQLSTATE:
     'HY000'

     Message: I/O error reading log index file

   * 
     Error number: '1375'; Symbol: 'ER_BINLOG_PURGE_PROHIBITED';
     SQLSTATE: 'HY000'

     Message: Server configuration does not permit binlog purge

   * 
     Error number: '1376'; Symbol: 'ER_FSEEK_FAIL'; SQLSTATE: 'HY000'

     Message: Failed on fseek()

   * 
     Error number: '1377'; Symbol: 'ER_BINLOG_PURGE_FATAL_ERR';
     SQLSTATE: 'HY000'

     Message: Fatal error during log purge

   * 
     Error number: '1378'; Symbol: 'ER_LOG_IN_USE'; SQLSTATE: 'HY000'

     Message: A purgeable log is in use, will not purge

   * 
     Error number: '1379'; Symbol: 'ER_LOG_PURGE_UNKNOWN_ERR'; SQLSTATE:
     'HY000'

     Message: Unknown error during log purge

   * 
     Error number: '1380'; Symbol: 'ER_RELAY_LOG_INIT'; SQLSTATE:
     'HY000'

     Message: Failed initializing relay log position: %s

   * 
     Error number: '1381'; Symbol: 'ER_NO_BINARY_LOGGING'; SQLSTATE:
     'HY000'

     Message: You are not using binary logging

   * 
     Error number: '1382'; Symbol: 'ER_RESERVED_SYNTAX'; SQLSTATE:
     'HY000'

     Message: The '%s' syntax is reserved for purposes internal to the
     MySQL server

   * 
     Error number: '1383'; Symbol: 'ER_WSAS_FAILED'; SQLSTATE: 'HY000'

     Message: WSAStartup Failed

   * 
     Error number: '1384'; Symbol: 'ER_DIFF_GROUPS_PROC'; SQLSTATE:
     'HY000'

     Message: Can't handle procedures with different groups yet

   * 
     Error number: '1385'; Symbol: 'ER_NO_GROUP_FOR_PROC'; SQLSTATE:
     'HY000'

     Message: Select must have a group with this procedure

   * 
     Error number: '1386'; Symbol: 'ER_ORDER_WITH_PROC'; SQLSTATE:
     'HY000'

     Message: Can't use ORDER clause with this procedure

   * 
     Error number: '1387'; Symbol: 'ER_LOGGING_PROHIBIT_CHANGING_OF';
     SQLSTATE: 'HY000'

     Message: Binary logging and replication forbid changing the global
     server %s

   * 
     Error number: '1388'; Symbol: 'ER_NO_FILE_MAPPING'; SQLSTATE:
     'HY000'

     Message: Can't map file: %s, errno: %d

   * 
     Error number: '1389'; Symbol: 'ER_WRONG_MAGIC'; SQLSTATE: 'HY000'

     Message: Wrong magic in %s

   * 
     Error number: '1390'; Symbol: 'ER_PS_MANY_PARAM'; SQLSTATE: 'HY000'

     Message: Prepared statement contains too many placeholders

   * 
     Error number: '1391'; Symbol: 'ER_KEY_PART_0'; SQLSTATE: 'HY000'

     Message: Key part '%s' length cannot be 0

   * 
     Error number: '1392'; Symbol: 'ER_VIEW_CHECKSUM'; SQLSTATE: 'HY000'

     Message: View text checksum failed

   * 
     Error number: '1393'; Symbol: 'ER_VIEW_MULTIUPDATE'; SQLSTATE:
     'HY000'

     Message: Can not modify more than one base table through a join
     view '%s.%s'

   * 
     Error number: '1394'; Symbol: 'ER_VIEW_NO_INSERT_FIELD_LIST';
     SQLSTATE: 'HY000'

     Message: Can not insert into join view '%s.%s' without fields list

   * 
     Error number: '1395'; Symbol: 'ER_VIEW_DELETE_MERGE_VIEW';
     SQLSTATE: 'HY000'

     Message: Can not delete from join view '%s.%s'

   * 
     Error number: '1396'; Symbol: 'ER_CANNOT_USER'; SQLSTATE: 'HY000'

     Message: Operation %s failed for %s

   * 
     Error number: '1397'; Symbol: 'ER_XAER_NOTA'; SQLSTATE: 'XAE04'

     Message: XAER_NOTA: Unknown XID

   * 
     Error number: '1398'; Symbol: 'ER_XAER_INVAL'; SQLSTATE: 'XAE05'

     Message: XAER_INVAL: Invalid arguments (or unsupported command)

   * 
     Error number: '1399'; Symbol: 'ER_XAER_RMFAIL'; SQLSTATE: 'XAE07'

     Message: XAER_RMFAIL: The command cannot be executed when global
     transaction is in the %s state

   * 
     Error number: '1400'; Symbol: 'ER_XAER_OUTSIDE'; SQLSTATE: 'XAE09'

     Message: XAER_OUTSIDE: Some work is done outside global transaction

   * 
     Error number: '1401'; Symbol: 'ER_XAER_RMERR'; SQLSTATE: 'XAE03'

     Message: XAER_RMERR: Fatal error occurred in the transaction branch
     - check your data for consistency

   * 
     Error number: '1402'; Symbol: 'ER_XA_RBROLLBACK'; SQLSTATE: 'XA100'

     Message: XA_RBROLLBACK: Transaction branch was rolled back

   * 
     Error number: '1403'; Symbol: 'ER_NONEXISTING_PROC_GRANT';
     SQLSTATE: '42000'

     Message: There is no such grant defined for user '%s' on host '%s'
     on routine '%s'

   * 
     Error number: '1404'; Symbol: 'ER_PROC_AUTO_GRANT_FAIL'; SQLSTATE:
     'HY000'

     Message: Failed to grant EXECUTE and ALTER ROUTINE privileges

   * 
     Error number: '1405'; Symbol: 'ER_PROC_AUTO_REVOKE_FAIL'; SQLSTATE:
     'HY000'

     Message: Failed to revoke all privileges to dropped routine

   * 
     Error number: '1406'; Symbol: 'ER_DATA_TOO_LONG'; SQLSTATE: '22001'

     Message: Data too long for column '%s' at row %ld

   * 
     Error number: '1407'; Symbol: 'ER_SP_BAD_SQLSTATE'; SQLSTATE:
     '42000'

     Message: Bad SQLSTATE: '%s'

   * 
     Error number: '1408'; Symbol: 'ER_STARTUP'; SQLSTATE: 'HY000'

     Message: %s: ready for connections.  Version: '%s' socket: '%s'
     port: %d %s

   * 
     Error number: '1409'; Symbol:
     'ER_LOAD_FROM_FIXED_SIZE_ROWS_TO_VAR'; SQLSTATE: 'HY000'

     Message: Can't load value from file with fixed size rows to
     variable

   * 
     Error number: '1410'; Symbol: 'ER_CANT_CREATE_USER_WITH_GRANT';
     SQLSTATE: '42000'

     Message: You are not allowed to create a user with GRANT

   * 
     Error number: '1411'; Symbol: 'ER_WRONG_VALUE_FOR_TYPE'; SQLSTATE:
     'HY000'

     Message: Incorrect %s value: '%s' for function %s

   * 
     Error number: '1412'; Symbol: 'ER_TABLE_DEF_CHANGED'; SQLSTATE:
     'HY000'

     Message: Table definition has changed, please retry transaction

   * 
     Error number: '1413'; Symbol: 'ER_SP_DUP_HANDLER'; SQLSTATE:
     '42000'

     Message: Duplicate handler declared in the same block

   * 
     Error number: '1414'; Symbol: 'ER_SP_NOT_VAR_ARG'; SQLSTATE:
     '42000'

     Message: OUT or INOUT argument %d for routine %s is not a variable
     or NEW pseudo-variable in BEFORE trigger

   * 
     Error number: '1415'; Symbol: 'ER_SP_NO_RETSET'; SQLSTATE: '0A000'

     Message: Not allowed to return a result set from a %s

   * 
     Error number: '1416'; Symbol: 'ER_CANT_CREATE_GEOMETRY_OBJECT';
     SQLSTATE: '22003'

     Message: Cannot get geometry object from data you send to the
     GEOMETRY field

   * 
     Error number: '1417'; Symbol: 'ER_FAILED_ROUTINE_BREAK_BINLOG';
     SQLSTATE: 'HY000'

     Message: A routine failed and has neither NO SQL nor READS SQL DATA
     in its declaration and binary logging is enabled; if
     non-transactional tables were updated, the binary log will miss
     their changes

   * 
     Error number: '1418'; Symbol: 'ER_BINLOG_UNSAFE_ROUTINE'; SQLSTATE:
     'HY000'

     Message: This function has none of DETERMINISTIC, NO SQL, or READS
     SQL DATA in its declaration and binary logging is enabled (you
     *might* want to use the less safe log_bin_trust_function_creators
     variable)

   * 
     Error number: '1419'; Symbol:
     'ER_BINLOG_CREATE_ROUTINE_NEED_SUPER'; SQLSTATE: 'HY000'

     Message: You do not have the SUPER privilege and binary logging is
     enabled (you *might* want to use the less safe
     log_bin_trust_function_creators variable)

   * 
     Error number: '1420'; Symbol: 'ER_EXEC_STMT_WITH_OPEN_CURSOR';
     SQLSTATE: 'HY000'

     Message: You can't execute a prepared statement which has an open
     cursor associated with it.  Reset the statement to re-execute it.

   * 
     Error number: '1421'; Symbol: 'ER_STMT_HAS_NO_OPEN_CURSOR';
     SQLSTATE: 'HY000'

     Message: The statement (%lu) has no open cursor.

   * 
     Error number: '1422'; Symbol: 'ER_COMMIT_NOT_ALLOWED_IN_SF_OR_TRG';
     SQLSTATE: 'HY000'

     Message: Explicit or implicit commit is not allowed in stored
     function or trigger.

   * 
     Error number: '1423'; Symbol: 'ER_NO_DEFAULT_FOR_VIEW_FIELD';
     SQLSTATE: 'HY000'

     Message: Field of view '%s.%s' underlying table doesn't have a
     default value

   * 
     Error number: '1424'; Symbol: 'ER_SP_NO_RECURSION'; SQLSTATE:
     'HY000'

     Message: Recursive stored functions and triggers are not allowed.

   * 
     Error number: '1425'; Symbol: 'ER_TOO_BIG_SCALE'; SQLSTATE: '42000'

     Message: Too big scale %d specified for column '%s'.  Maximum is
     %lu.

   * 
     Error number: '1426'; Symbol: 'ER_TOO_BIG_PRECISION'; SQLSTATE:
     '42000'

     Message: Too big precision %d specified for column '%s'.  Maximum
     is %lu.

   * 
     Error number: '1427'; Symbol: 'ER_M_BIGGER_THAN_D'; SQLSTATE:
     '42000'

     Message: For float(M,D), double(M,D) or decimal(M,D), M must be >=
     D (column '%s').

   * 
     Error number: '1428'; Symbol: 'ER_WRONG_LOCK_OF_SYSTEM_TABLE';
     SQLSTATE: 'HY000'

     Message: You can't combine write-locking of system tables with
     other tables or lock types

   * 
     Error number: '1429'; Symbol: 'ER_CONNECT_TO_FOREIGN_DATA_SOURCE';
     SQLSTATE: 'HY000'

     Message: Unable to connect to foreign data source: %s

   * 
     Error number: '1430'; Symbol: 'ER_QUERY_ON_FOREIGN_DATA_SOURCE';
     SQLSTATE: 'HY000'

     Message: There was a problem processing the query on the foreign
     data source.  Data source error: %s

   * 
     Error number: '1431'; Symbol:
     'ER_FOREIGN_DATA_SOURCE_DOESNT_EXIST'; SQLSTATE: 'HY000'

     Message: The foreign data source you are trying to reference does
     not exist.  Data source error: %s

   * 
     Error number: '1432'; Symbol:
     'ER_FOREIGN_DATA_STRING_INVALID_CANT_CREATE'; SQLSTATE: 'HY000'

     Message: Can't create federated table.  The data source connection
     string '%s' is not in the correct format

   * 
     Error number: '1433'; Symbol: 'ER_FOREIGN_DATA_STRING_INVALID';
     SQLSTATE: 'HY000'

     Message: The data source connection string '%s' is not in the
     correct format

   * 
     Error number: '1434'; Symbol: 'ER_CANT_CREATE_FEDERATED_TABLE';
     SQLSTATE: 'HY000'

     Message: Can't create federated table.  Foreign data src error: %s

   * 
     Error number: '1435'; Symbol: 'ER_TRG_IN_WRONG_SCHEMA'; SQLSTATE:
     'HY000'

     Message: Trigger in wrong schema

   * 
     Error number: '1436'; Symbol: 'ER_STACK_OVERRUN_NEED_MORE';
     SQLSTATE: 'HY000'

     Message: Thread stack overrun: %ld bytes used of a %ld byte stack,
     and %ld bytes needed.  Use 'mysqld -thread_stack=#' to specify a
     bigger stack.

   * 
     Error number: '1437'; Symbol: 'ER_TOO_LONG_BODY'; SQLSTATE: '42000'

     Message: Routine body for '%s' is too long

   * 
     Error number: '1438'; Symbol: 'ER_WARN_CANT_DROP_DEFAULT_KEYCACHE';
     SQLSTATE: 'HY000'

     Message: Cannot drop default keycache

   * 
     Error number: '1439'; Symbol: 'ER_TOO_BIG_DISPLAYWIDTH'; SQLSTATE:
     '42000'

     Message: Display width out of range for column '%s' (max = %lu)

   * 
     Error number: '1440'; Symbol: 'ER_XAER_DUPID'; SQLSTATE: 'XAE08'

     Message: XAER_DUPID: The XID already exists

   * 
     Error number: '1441'; Symbol: 'ER_DATETIME_FUNCTION_OVERFLOW';
     SQLSTATE: '22008'

     Message: Datetime function: %s field overflow

   * 
     Error number: '1442'; Symbol:
     'ER_CANT_UPDATE_USED_TABLE_IN_SF_OR_TRG'; SQLSTATE: 'HY000'

     Message: Can't update table '%s' in stored function/trigger because
     it is already used by statement which invoked this stored
     function/trigger.

   * 
     Error number: '1443'; Symbol: 'ER_VIEW_PREVENT_UPDATE'; SQLSTATE:
     'HY000'

     Message: The definition of table '%s' prevents operation %s on
     table '%s'.

   * 
     Error number: '1444'; Symbol: 'ER_PS_NO_RECURSION'; SQLSTATE:
     'HY000'

     Message: The prepared statement contains a stored routine call that
     refers to that same statement.  It's not allowed to execute a
     prepared statement in such a recursive manner

   * 
     Error number: '1445'; Symbol: 'ER_SP_CANT_SET_AUTOCOMMIT';
     SQLSTATE: 'HY000'

     Message: Not allowed to set autocommit from a stored function or
     trigger

   * 
     Error number: '1446'; Symbol: 'ER_MALFORMED_DEFINER'; SQLSTATE:
     'HY000'

     Message: Definer is not fully qualified

   * 
     Error number: '1447'; Symbol: 'ER_VIEW_FRM_NO_USER'; SQLSTATE:
     'HY000'

     Message: View '%s'.'%s' has no definer information (old table
     format).  Current user is used as definer.  Please recreate the
     view!

   * 
     Error number: '1448'; Symbol: 'ER_VIEW_OTHER_USER'; SQLSTATE:
     'HY000'

     Message: You need the SUPER privilege for creation view with
     '%s'@'%s' definer

   * 
     Error number: '1449'; Symbol: 'ER_NO_SUCH_USER'; SQLSTATE: 'HY000'

     Message: The user specified as a definer ('%s'@'%s') does not exist

   * 
     Error number: '1450'; Symbol: 'ER_FORBID_SCHEMA_CHANGE'; SQLSTATE:
     'HY000'

     Message: Changing schema from '%s' to '%s' is not allowed.

   * 
     Error number: '1451'; Symbol: 'ER_ROW_IS_REFERENCED_2'; SQLSTATE:
     '23000'

     Message: Cannot delete or update a parent row: a foreign key
     constraint fails (%s)

     'InnoDB' reports this error when you try to delete a parent row
     that has children, and a foreign key constraint fails.  Delete the
     children first.

   * 
     Error number: '1452'; Symbol: 'ER_NO_REFERENCED_ROW_2'; SQLSTATE:
     '23000'

     Message: Cannot add or update a child row: a foreign key constraint
     fails (%s)

     'InnoDB' reports this error when you try to add a row but there is
     no parent row, and a foreign key constraint fails.  Add the parent
     row first.

   * 
     Error number: '1453'; Symbol: 'ER_SP_BAD_VAR_SHADOW'; SQLSTATE:
     '42000'

     Message: Variable '%s' must be quoted with '...', or renamed

   * 
     Error number: '1454'; Symbol: 'ER_TRG_NO_DEFINER'; SQLSTATE:
     'HY000'

     Message: No definer attribute for trigger '%s'.'%s'.  The trigger
     will be activated under the authorization of the invoker, which may
     have insufficient privileges.  Please recreate the trigger.

   * 
     Error number: '1455'; Symbol: 'ER_OLD_FILE_FORMAT'; SQLSTATE:
     'HY000'

     Message: '%s' has an old format, you should re-create the '%s'
     object(s)

   * 
     Error number: '1456'; Symbol: 'ER_SP_RECURSION_LIMIT'; SQLSTATE:
     'HY000'

     Message: Recursive limit %d (as set by the max_sp_recursion_depth
     variable) was exceeded for routine %s

   * 
     Error number: '1457'; Symbol: 'ER_SP_PROC_TABLE_CORRUPT'; SQLSTATE:
     'HY000'

     Message: Failed to load routine %s.  The table mysql.proc is
     missing, corrupt, or contains bad data (internal code %d)

   * 
     Error number: '1458'; Symbol: 'ER_SP_WRONG_NAME'; SQLSTATE: '42000'

     Message: Incorrect routine name '%s'

   * 
     Error number: '1459'; Symbol: 'ER_TABLE_NEEDS_UPGRADE'; SQLSTATE:
     'HY000'

     Message: Table upgrade required.  Please do "REPAIR TABLE '%s'" or
     dump/reload to fix it!

   * 
     Error number: '1460'; Symbol: 'ER_SP_NO_AGGREGATE'; SQLSTATE:
     '42000'

     Message: AGGREGATE is not supported for stored functions

   * 
     Error number: '1461'; Symbol: 'ER_MAX_PREPARED_STMT_COUNT_REACHED';
     SQLSTATE: '42000'

     Message: Can't create more than max_prepared_stmt_count statements
     (current value: %lu)

   * 
     Error number: '1462'; Symbol: 'ER_VIEW_RECURSIVE'; SQLSTATE:
     'HY000'

     Message: '%s'.'%s' contains view recursion

   * 
     Error number: '1463'; Symbol: 'ER_NON_GROUPING_FIELD_USED';
     SQLSTATE: '42000'

     Message: Non-grouping field '%s' is used in %s clause

   * 
     Error number: '1464'; Symbol: 'ER_TABLE_CANT_HANDLE_SPKEYS';
     SQLSTATE: 'HY000'

     Message: The used table type doesn't support SPATIAL indexes

   * 
     Error number: '1465'; Symbol: 'ER_NO_TRIGGERS_ON_SYSTEM_SCHEMA';
     SQLSTATE: 'HY000'

     Message: Triggers can not be created on system tables

   * 
     Error number: '1466'; Symbol: 'ER_REMOVED_SPACES'; SQLSTATE:
     'HY000'

     Message: Leading spaces are removed from name '%s'

   * 
     Error number: '1467'; Symbol: 'ER_AUTOINC_READ_FAILED'; SQLSTATE:
     'HY000'

     Message: Failed to read auto-increment value from storage engine

   * 
     Error number: '1468'; Symbol: 'ER_USERNAME'; SQLSTATE: 'HY000'

     Message: user name

   * 
     Error number: '1469'; Symbol: 'ER_HOSTNAME'; SQLSTATE: 'HY000'

     Message: host name

   * 
     Error number: '1470'; Symbol: 'ER_WRONG_STRING_LENGTH'; SQLSTATE:
     'HY000'

     Message: String '%s' is too long for %s (should be no longer than
     %d)

   * 
     Error number: '1471'; Symbol: 'ER_NON_INSERTABLE_TABLE'; SQLSTATE:
     'HY000'

     Message: The target table %s of the %s is not insertable-into

   * 
     Error number: '1472'; Symbol: 'ER_ADMIN_WRONG_MRG_TABLE'; SQLSTATE:
     'HY000'

     Message: Table '%s' is differently defined or of non-MyISAM type or
     doesn't exist

   * 
     Error number: '1473'; Symbol:
     'ER_TOO_HIGH_LEVEL_OF_NESTING_FOR_SELECT'; SQLSTATE: 'HY000'

     Message: Too high level of nesting for select

   * 
     Error number: '1474'; Symbol: 'ER_NAME_BECOMES_EMPTY'; SQLSTATE:
     'HY000'

     Message: Name '%s' has become "

   * 
     Error number: '1475'; Symbol: 'ER_AMBIGUOUS_FIELD_TERM'; SQLSTATE:
     'HY000'

     Message: First character of the FIELDS TERMINATED string is
     ambiguous; please use non-optional and non-empty FIELDS ENCLOSED BY

   * 
     Error number: '1476'; Symbol: 'ER_FOREIGN_SERVER_EXISTS'; SQLSTATE:
     'HY000'

     Message: The foreign server, %s, you are trying to create already
     exists.

   * 
     Error number: '1477'; Symbol: 'ER_FOREIGN_SERVER_DOESNT_EXIST';
     SQLSTATE: 'HY000'

     Message: The foreign server name you are trying to reference does
     not exist.  Data source error: %s

   * 
     Error number: '1478'; Symbol: 'ER_ILLEGAL_HA_CREATE_OPTION';
     SQLSTATE: 'HY000'

     Message: Table storage engine '%s' does not support the create
     option '%s'

   * 
     Error number: '1479'; Symbol: 'ER_PARTITION_REQUIRES_VALUES_ERROR';
     SQLSTATE: 'HY000'

     Message: Syntax error: %s PARTITIONING requires definition of
     VALUES %s for each partition

   * 
     Error number: '1480'; Symbol: 'ER_PARTITION_WRONG_VALUES_ERROR';
     SQLSTATE: 'HY000'

     Message: Only %s PARTITIONING can use VALUES %s in partition
     definition

   * 
     Error number: '1481'; Symbol: 'ER_PARTITION_MAXVALUE_ERROR';
     SQLSTATE: 'HY000'

     Message: MAXVALUE can only be used in last partition definition

   * 
     Error number: '1482'; Symbol: 'ER_PARTITION_SUBPARTITION_ERROR';
     SQLSTATE: 'HY000'

     Message: Subpartitions can only be hash partitions and by key

   * 
     Error number: '1483'; Symbol: 'ER_PARTITION_SUBPART_MIX_ERROR';
     SQLSTATE: 'HY000'

     Message: Must define subpartitions on all partitions if on one
     partition

   * 
     Error number: '1484'; Symbol: 'ER_PARTITION_WRONG_NO_PART_ERROR';
     SQLSTATE: 'HY000'

     Message: Wrong number of partitions defined, mismatch with previous
     setting

   * 
     Error number: '1485'; Symbol:
     'ER_PARTITION_WRONG_NO_SUBPART_ERROR'; SQLSTATE: 'HY000'

     Message: Wrong number of subpartitions defined, mismatch with
     previous setting

   * 
     Error number: '1486'; Symbol:
     'ER_CONST_EXPR_IN_PARTITION_FUNC_ERROR'; SQLSTATE: 'HY000'

     Message: Constant/Random expression in (sub)partitioning function
     is not allowed

     In 5.5.1: 'ER_CONST_EXPR_IN_PARTITION_FUNC_ERROR' was renamed to
     'ER_WRONG_EXPR_IN_PARTITION_FUNC_ERROR'.

     'ER_CONST_EXPR_IN_PARTITION_FUNC_ERROR' was removed after 5.5.0.

   * 
     Error number: '1486'; Symbol:
     'ER_WRONG_EXPR_IN_PARTITION_FUNC_ERROR'; SQLSTATE: 'HY000'

     Message: Constant, random or timezone-dependent expressions in
     (sub)partitioning function are not allowed

     In 5.5.1: 'ER_CONST_EXPR_IN_PARTITION_FUNC_ERROR' was renamed to
     'ER_WRONG_EXPR_IN_PARTITION_FUNC_ERROR'.

     'ER_WRONG_EXPR_IN_PARTITION_FUNC_ERROR' was added in 5.5.1.

   * 
     Error number: '1487'; Symbol:
     'ER_NO_CONST_EXPR_IN_RANGE_OR_LIST_ERROR'; SQLSTATE: 'HY000'

     Message: Expression in RANGE/LIST VALUES must be constant

   * 
     Error number: '1488'; Symbol: 'ER_FIELD_NOT_FOUND_PART_ERROR';
     SQLSTATE: 'HY000'

     Message: Field in list of fields for partition function not found
     in table

   * 
     Error number: '1489'; Symbol:
     'ER_LIST_OF_FIELDS_ONLY_IN_HASH_ERROR'; SQLSTATE: 'HY000'

     Message: List of fields is only allowed in KEY partitions

   * 
     Error number: '1490'; Symbol:
     'ER_INCONSISTENT_PARTITION_INFO_ERROR'; SQLSTATE: 'HY000'

     Message: The partition info in the frm file is not consistent with
     what can be written into the frm file

   * 
     Error number: '1491'; Symbol:
     'ER_PARTITION_FUNC_NOT_ALLOWED_ERROR'; SQLSTATE: 'HY000'

     Message: The %s function returns the wrong type

   * 
     Error number: '1492'; Symbol:
     'ER_PARTITIONS_MUST_BE_DEFINED_ERROR'; SQLSTATE: 'HY000'

     Message: For %s partitions each partition must be defined

   * 
     Error number: '1493'; Symbol: 'ER_RANGE_NOT_INCREASING_ERROR';
     SQLSTATE: 'HY000'

     Message: VALUES LESS THAN value must be strictly increasing for
     each partition

   * 
     Error number: '1494'; Symbol:
     'ER_INCONSISTENT_TYPE_OF_FUNCTIONS_ERROR'; SQLSTATE: 'HY000'

     Message: VALUES value must be of same type as partition function

   * 
     Error number: '1495'; Symbol:
     'ER_MULTIPLE_DEF_CONST_IN_LIST_PART_ERROR'; SQLSTATE: 'HY000'

     Message: Multiple definition of same constant in list partitioning

   * 
     Error number: '1496'; Symbol: 'ER_PARTITION_ENTRY_ERROR'; SQLSTATE:
     'HY000'

     Message: Partitioning can not be used stand-alone in query

   * 
     Error number: '1497'; Symbol: 'ER_MIX_HANDLER_ERROR'; SQLSTATE:
     'HY000'

     Message: The mix of handlers in the partitions is not allowed in
     this version of MySQL

   * 
     Error number: '1498'; Symbol: 'ER_PARTITION_NOT_DEFINED_ERROR';
     SQLSTATE: 'HY000'

     Message: For the partitioned engine it is necessary to define all
     %s

   * 
     Error number: '1499'; Symbol: 'ER_TOO_MANY_PARTITIONS_ERROR';
     SQLSTATE: 'HY000'

     Message: Too many partitions (including subpartitions) were defined

   * 
     Error number: '1500'; Symbol: 'ER_SUBPARTITION_ERROR'; SQLSTATE:
     'HY000'

     Message: It is only possible to mix RANGE/LIST partitioning with
     HASH/KEY partitioning for subpartitioning

   * 
     Error number: '1501'; Symbol: 'ER_CANT_CREATE_HANDLER_FILE';
     SQLSTATE: 'HY000'

     Message: Failed to create specific handler file

   * 
     Error number: '1502'; Symbol: 'ER_BLOB_FIELD_IN_PART_FUNC_ERROR';
     SQLSTATE: 'HY000'

     Message: A BLOB field is not allowed in partition function

   * 
     Error number: '1503'; Symbol:
     'ER_UNIQUE_KEY_NEED_ALL_FIELDS_IN_PF'; SQLSTATE: 'HY000'

     Message: A %s must include all columns in the table's partitioning
     function

   * 
     Error number: '1504'; Symbol: 'ER_NO_PARTS_ERROR'; SQLSTATE:
     'HY000'

     Message: Number of %s = 0 is not an allowed value

   * 
     Error number: '1505'; Symbol:
     'ER_PARTITION_MGMT_ON_NONPARTITIONED'; SQLSTATE: 'HY000'

     Message: Partition management on a not partitioned table is not
     possible

   * 
     Error number: '1506'; Symbol: 'ER_FOREIGN_KEY_ON_PARTITIONED';
     SQLSTATE: 'HY000'

     Message: Foreign key clause is not yet supported in conjunction
     with partitioning

   * 
     Error number: '1507'; Symbol: 'ER_DROP_PARTITION_NON_EXISTENT';
     SQLSTATE: 'HY000'

     Message: Error in list of partitions to %s

   * 
     Error number: '1508'; Symbol: 'ER_DROP_LAST_PARTITION'; SQLSTATE:
     'HY000'

     Message: Cannot remove all partitions, use DROP TABLE instead

   * 
     Error number: '1509'; Symbol: 'ER_COALESCE_ONLY_ON_HASH_PARTITION';
     SQLSTATE: 'HY000'

     Message: COALESCE PARTITION can only be used on HASH/KEY partitions

   * 
     Error number: '1510'; Symbol: 'ER_REORG_HASH_ONLY_ON_SAME_NO';
     SQLSTATE: 'HY000'

     Message: REORGANIZE PARTITION can only be used to reorganize
     partitions not to change their numbers

   * 
     Error number: '1511'; Symbol: 'ER_REORG_NO_PARAM_ERROR'; SQLSTATE:
     'HY000'

     Message: REORGANIZE PARTITION without parameters can only be used
     on auto-partitioned tables using HASH PARTITIONs

   * 
     Error number: '1512'; Symbol: 'ER_ONLY_ON_RANGE_LIST_PARTITION';
     SQLSTATE: 'HY000'

     Message: %s PARTITION can only be used on RANGE/LIST partitions

   * 
     Error number: '1513'; Symbol: 'ER_ADD_PARTITION_SUBPART_ERROR';
     SQLSTATE: 'HY000'

     Message: Trying to Add partition(s) with wrong number of
     subpartitions

   * 
     Error number: '1514'; Symbol: 'ER_ADD_PARTITION_NO_NEW_PARTITION';
     SQLSTATE: 'HY000'

     Message: At least one partition must be added

   * 
     Error number: '1515'; Symbol: 'ER_COALESCE_PARTITION_NO_PARTITION';
     SQLSTATE: 'HY000'

     Message: At least one partition must be coalesced

   * 
     Error number: '1516'; Symbol: 'ER_REORG_PARTITION_NOT_EXIST';
     SQLSTATE: 'HY000'

     Message: More partitions to reorganize than there are partitions

   * 
     Error number: '1517'; Symbol: 'ER_SAME_NAME_PARTITION'; SQLSTATE:
     'HY000'

     Message: Duplicate partition name %s

   * 
     Error number: '1518'; Symbol: 'ER_NO_BINLOG_ERROR'; SQLSTATE:
     'HY000'

     Message: It is not allowed to shut off binlog on this command

   * 
     Error number: '1519'; Symbol: 'ER_CONSECUTIVE_REORG_PARTITIONS';
     SQLSTATE: 'HY000'

     Message: When reorganizing a set of partitions they must be in
     consecutive order

   * 
     Error number: '1520'; Symbol: 'ER_REORG_OUTSIDE_RANGE'; SQLSTATE:
     'HY000'

     Message: Reorganize of range partitions cannot change total ranges
     except for last partition where it can extend the range

   * 
     Error number: '1521'; Symbol: 'ER_PARTITION_FUNCTION_FAILURE';
     SQLSTATE: 'HY000'

     Message: Partition function not supported in this version for this
     handler

   * 
     Error number: '1522'; Symbol: 'ER_PART_STATE_ERROR'; SQLSTATE:
     'HY000'

     Message: Partition state cannot be defined from CREATE/ALTER TABLE

   * 
     Error number: '1523'; Symbol: 'ER_LIMITED_PART_RANGE'; SQLSTATE:
     'HY000'

     Message: The %s handler only supports 32 bit integers in VALUES

   * 
     Error number: '1524'; Symbol: 'ER_PLUGIN_IS_NOT_LOADED'; SQLSTATE:
     'HY000'

     Message: Plugin '%s' is not loaded

   * 
     Error number: '1525'; Symbol: 'ER_WRONG_VALUE'; SQLSTATE: 'HY000'

     Message: Incorrect %s value: '%s'

   * 
     Error number: '1526'; Symbol: 'ER_NO_PARTITION_FOR_GIVEN_VALUE';
     SQLSTATE: 'HY000'

     Message: Table has no partition for value %s

   * 
     Error number: '1527'; Symbol: 'ER_FILEGROUP_OPTION_ONLY_ONCE';
     SQLSTATE: 'HY000'

     Message: It is not allowed to specify %s more than once

   * 
     Error number: '1528'; Symbol: 'ER_CREATE_FILEGROUP_FAILED';
     SQLSTATE: 'HY000'

     Message: Failed to create %s

   * 
     Error number: '1529'; Symbol: 'ER_DROP_FILEGROUP_FAILED'; SQLSTATE:
     'HY000'

     Message: Failed to drop %s

   * 
     Error number: '1530'; Symbol: 'ER_TABLESPACE_AUTO_EXTEND_ERROR';
     SQLSTATE: 'HY000'

     Message: The handler doesn't support autoextend of tablespaces

   * 
     Error number: '1531'; Symbol: 'ER_WRONG_SIZE_NUMBER'; SQLSTATE:
     'HY000'

     Message: A size parameter was incorrectly specified, either number
     or on the form 10M

   * 
     Error number: '1532'; Symbol: 'ER_SIZE_OVERFLOW_ERROR'; SQLSTATE:
     'HY000'

     Message: The size number was correct but we don't allow the digit
     part to be more than 2 billion

   * 
     Error number: '1533'; Symbol: 'ER_ALTER_FILEGROUP_FAILED';
     SQLSTATE: 'HY000'

     Message: Failed to alter: %s

   * 
     Error number: '1534'; Symbol: 'ER_BINLOG_ROW_LOGGING_FAILED';
     SQLSTATE: 'HY000'

     Message: Writing one row to the row-based binary log failed

   * 
     Error number: '1535'; Symbol: 'ER_BINLOG_ROW_WRONG_TABLE_DEF';
     SQLSTATE: 'HY000'

     Message: Table definition on master and slave does not match: %s

   * 
     Error number: '1536'; Symbol: 'ER_BINLOG_ROW_RBR_TO_SBR'; SQLSTATE:
     'HY000'

     Message: Slave running with -log-slave-updates must use row-based
     binary logging to be able to replicate row-based binary log events

   * 
     Error number: '1537'; Symbol: 'ER_EVENT_ALREADY_EXISTS'; SQLSTATE:
     'HY000'

     Message: Event '%s' already exists

   * 
     Error number: '1538'; Symbol: 'ER_EVENT_STORE_FAILED'; SQLSTATE:
     'HY000'

     Message: Failed to store event %s.  Error code %d from storage
     engine.

   * 
     Error number: '1539'; Symbol: 'ER_EVENT_DOES_NOT_EXIST'; SQLSTATE:
     'HY000'

     Message: Unknown event '%s'

   * 
     Error number: '1540'; Symbol: 'ER_EVENT_CANT_ALTER'; SQLSTATE:
     'HY000'

     Message: Failed to alter event '%s'

   * 
     Error number: '1541'; Symbol: 'ER_EVENT_DROP_FAILED'; SQLSTATE:
     'HY000'

     Message: Failed to drop %s

   * 
     Error number: '1542'; Symbol:
     'ER_EVENT_INTERVAL_NOT_POSITIVE_OR_TOO_BIG'; SQLSTATE: 'HY000'

     Message: INTERVAL is either not positive or too big

   * 
     Error number: '1543'; Symbol: 'ER_EVENT_ENDS_BEFORE_STARTS';
     SQLSTATE: 'HY000'

     Message: ENDS is either invalid or before STARTS

   * 
     Error number: '1544'; Symbol: 'ER_EVENT_EXEC_TIME_IN_THE_PAST';
     SQLSTATE: 'HY000'

     Message: Event execution time is in the past.  Event has been
     disabled

   * 
     Error number: '1545'; Symbol: 'ER_EVENT_OPEN_TABLE_FAILED';
     SQLSTATE: 'HY000'

     Message: Failed to open mysql.event

   * 
     Error number: '1546'; Symbol: 'ER_EVENT_NEITHER_M_EXPR_NOR_M_AT';
     SQLSTATE: 'HY000'

     Message: No datetime expression provided

   * 
     Error number: '1547'; Symbol:
     'ER_COL_COUNT_DOESNT_MATCH_CORRUPTED'; SQLSTATE: 'HY000'

     Message: Column count of mysql.%s is wrong.  Expected %d, found %d.
     The table is probably corrupted

   * 
     Error number: '1548'; Symbol: 'ER_CANNOT_LOAD_FROM_TABLE';
     SQLSTATE: 'HY000'

     Message: Cannot load from mysql.%s.  The table is probably
     corrupted

   * 
     Error number: '1549'; Symbol: 'ER_EVENT_CANNOT_DELETE'; SQLSTATE:
     'HY000'

     Message: Failed to delete the event from mysql.event

   * 
     Error number: '1550'; Symbol: 'ER_EVENT_COMPILE_ERROR'; SQLSTATE:
     'HY000'

     Message: Error during compilation of event's body

   * 
     Error number: '1551'; Symbol: 'ER_EVENT_SAME_NAME'; SQLSTATE:
     'HY000'

     Message: Same old and new event name

   * 
     Error number: '1552'; Symbol: 'ER_EVENT_DATA_TOO_LONG'; SQLSTATE:
     'HY000'

     Message: Data for column '%s' too long

   * 
     Error number: '1553'; Symbol: 'ER_DROP_INDEX_FK'; SQLSTATE: 'HY000'

     Message: Cannot drop index '%s': needed in a foreign key constraint

     'InnoDB' reports this error when you attempt to drop the last index
     that can enforce a particular referential constraint.

     For optimal performance with DML statements, 'InnoDB' requires an
     index to exist on foreign key columns, so that 'UPDATE' and
     'DELETE' operations on a parent table can easily check whether
     corresponding rows exist in the child table.  MySQL creates or
     drops such indexes automatically when needed, as a side-effect of
     *note 'CREATE TABLE': create-table, *note 'CREATE INDEX':
     create-index, and *note 'ALTER TABLE': alter-table. statements.

     When you drop an index, 'InnoDB' checks if the index is used for
     checking a foreign key constraint.  It is still OK to drop the
     index if there is another index that can be used to enforce the
     same constraint.  'InnoDB' prevents you from dropping the last
     index that can enforce a particular referential constraint.

   * 
     Error number: '1554'; Symbol: 'ER_WARN_DEPRECATED_SYNTAX_WITH_VER';
     SQLSTATE: 'HY000'

     Message: The syntax '%s' is deprecated and will be removed in MySQL
     %s.  Please use %s instead

   * 
     Error number: '1555'; Symbol: 'ER_CANT_WRITE_LOCK_LOG_TABLE';
     SQLSTATE: 'HY000'

     Message: You can't write-lock a log table.  Only read access is
     possible

   * 
     Error number: '1556'; Symbol: 'ER_CANT_LOCK_LOG_TABLE'; SQLSTATE:
     'HY000'

     Message: You can't use locks with log tables.

   * 
     Error number: '1557'; Symbol: 'ER_FOREIGN_DUPLICATE_KEY'; SQLSTATE:
     '23000'

     Message: Upholding foreign key constraints for table '%s', entry
     '%s', key %d would lead to a duplicate entry

   * 
     Error number: '1558'; Symbol:
     'ER_COL_COUNT_DOESNT_MATCH_PLEASE_UPDATE'; SQLSTATE: 'HY000'

     Message: Column count of mysql.%s is wrong.  Expected %d, found %d.
     Created with MySQL %d, now running %d.  Please use mysql_upgrade to
     fix this error.

   * 
     Error number: '1559'; Symbol:
     'ER_TEMP_TABLE_PREVENTS_SWITCH_OUT_OF_RBR'; SQLSTATE: 'HY000'

     Message: Cannot switch out of the row-based binary log format when
     the session has open temporary tables

   * 
     Error number: '1560'; Symbol:
     'ER_STORED_FUNCTION_PREVENTS_SWITCH_BINLOG_FORMAT'; SQLSTATE:
     'HY000'

     Message: Cannot change the binary logging format inside a stored
     function or trigger

   * 
     Error number: '1561'; Symbol: 'ER_NDB_CANT_SWITCH_BINLOG_FORMAT';
     SQLSTATE: 'HY000'

     Message: The NDB cluster engine does not support changing the
     binlog format on the fly yet

   * 
     Error number: '1562'; Symbol: 'ER_PARTITION_NO_TEMPORARY';
     SQLSTATE: 'HY000'

     Message: Cannot create temporary table with partitions

   * 
     Error number: '1563'; Symbol: 'ER_PARTITION_CONST_DOMAIN_ERROR';
     SQLSTATE: 'HY000'

     Message: Partition constant is out of partition function domain

   * 
     Error number: '1564'; Symbol:
     'ER_PARTITION_FUNCTION_IS_NOT_ALLOWED'; SQLSTATE: 'HY000'

     Message: This partition function is not allowed

   * 
     Error number: '1565'; Symbol: 'ER_DDL_LOG_ERROR'; SQLSTATE: 'HY000'

     Message: Error in DDL log

   * 
     Error number: '1566'; Symbol: 'ER_NULL_IN_VALUES_LESS_THAN';
     SQLSTATE: 'HY000'

     Message: Not allowed to use NULL value in VALUES LESS THAN

   * 
     Error number: '1567'; Symbol: 'ER_WRONG_PARTITION_NAME'; SQLSTATE:
     'HY000'

     Message: Incorrect partition name

   * 
     Error number: '1568'; Symbol: 'ER_CANT_CHANGE_TX_ISOLATION';
     SQLSTATE: '25001'

     Message: Transaction isolation level can't be changed while a
     transaction is in progress

   * 
     Error number: '1569'; Symbol: 'ER_DUP_ENTRY_AUTOINCREMENT_CASE';
     SQLSTATE: 'HY000'

     Message: ALTER TABLE causes auto_increment resequencing, resulting
     in duplicate entry '%s' for key '%s'

   * 
     Error number: '1570'; Symbol: 'ER_EVENT_MODIFY_QUEUE_ERROR';
     SQLSTATE: 'HY000'

     Message: Internal scheduler error %d

   * 
     Error number: '1571'; Symbol: 'ER_EVENT_SET_VAR_ERROR'; SQLSTATE:
     'HY000'

     Message: Error during starting/stopping of the scheduler.  Error
     code %u

   * 
     Error number: '1572'; Symbol: 'ER_PARTITION_MERGE_ERROR'; SQLSTATE:
     'HY000'

     Message: Engine cannot be used in partitioned tables

   * 
     Error number: '1573'; Symbol: 'ER_CANT_ACTIVATE_LOG'; SQLSTATE:
     'HY000'

     Message: Cannot activate '%s' log

   * 
     Error number: '1574'; Symbol: 'ER_RBR_NOT_AVAILABLE'; SQLSTATE:
     'HY000'

     Message: The server was not built with row-based replication

   * 
     Error number: '1575'; Symbol: 'ER_BASE64_DECODE_ERROR'; SQLSTATE:
     'HY000'

     Message: Decoding of base64 string failed

   * 
     Error number: '1576'; Symbol: 'ER_EVENT_RECURSION_FORBIDDEN';
     SQLSTATE: 'HY000'

     Message: Recursion of EVENT DDL statements is forbidden when body
     is present

   * 
     Error number: '1577'; Symbol: 'ER_EVENTS_DB_ERROR'; SQLSTATE:
     'HY000'

     Message: Cannot proceed because system tables used by Event
     Scheduler were found damaged at server start

     To address this issue, try running *note 'mysql_upgrade':
     mysql-upgrade.

   * 
     Error number: '1578'; Symbol: 'ER_ONLY_INTEGERS_ALLOWED'; SQLSTATE:
     'HY000'

     Message: Only integers allowed as number here

   * 
     Error number: '1579'; Symbol: 'ER_UNSUPORTED_LOG_ENGINE'; SQLSTATE:
     'HY000'

     Message: This storage engine cannot be used for log tables"

   * 
     Error number: '1580'; Symbol: 'ER_BAD_LOG_STATEMENT'; SQLSTATE:
     'HY000'

     Message: You cannot '%s' a log table if logging is enabled

   * 
     Error number: '1581'; Symbol: 'ER_CANT_RENAME_LOG_TABLE'; SQLSTATE:
     'HY000'

     Message: Cannot rename '%s'.  When logging enabled, rename to/from
     log table must rename two tables: the log table to an archive table
     and another table back to '%s'

   * 
     Error number: '1582'; Symbol: 'ER_WRONG_PARAMCOUNT_TO_NATIVE_FCT';
     SQLSTATE: '42000'

     Message: Incorrect parameter count in the call to native function
     '%s'

   * 
     Error number: '1583'; Symbol: 'ER_WRONG_PARAMETERS_TO_NATIVE_FCT';
     SQLSTATE: '42000'

     Message: Incorrect parameters in the call to native function '%s'

   * 
     Error number: '1584'; Symbol: 'ER_WRONG_PARAMETERS_TO_STORED_FCT';
     SQLSTATE: '42000'

     Message: Incorrect parameters in the call to stored function '%s'

   * 
     Error number: '1585'; Symbol: 'ER_NATIVE_FCT_NAME_COLLISION';
     SQLSTATE: 'HY000'

     Message: This function '%s' has the same name as a native function

   * 
     Error number: '1586'; Symbol: 'ER_DUP_ENTRY_WITH_KEY_NAME';
     SQLSTATE: '23000'

     Message: Duplicate entry '%s' for key '%s'

     The format string for this error is also used with 'ER_DUP_ENTRY'.

   * 
     Error number: '1587'; Symbol: 'ER_BINLOG_PURGE_EMFILE'; SQLSTATE:
     'HY000'

     Message: Too many files opened, please execute the command again

   * 
     Error number: '1588'; Symbol: 'ER_EVENT_CANNOT_CREATE_IN_THE_PAST';
     SQLSTATE: 'HY000'

     Message: Event execution time is in the past and ON COMPLETION NOT
     PRESERVE is set.  The event was dropped immediately after creation.

   * 
     Error number: '1589'; Symbol: 'ER_EVENT_CANNOT_ALTER_IN_THE_PAST';
     SQLSTATE: 'HY000'

     Message: Event execution time is in the past and ON COMPLETION NOT
     PRESERVE is set.  The event was dropped immediately after creation.

   * 
     Error number: '1590'; Symbol: 'ER_SLAVE_INCIDENT'; SQLSTATE:
     'HY000'

     Message: The incident %s occured on the master.  Message: %s

   * 
     Error number: '1591'; Symbol:
     'ER_NO_PARTITION_FOR_GIVEN_VALUE_SILENT'; SQLSTATE: 'HY000'

     Message: Table has no partition for some existing values

   * 
     Error number: '1592'; Symbol: 'ER_BINLOG_UNSAFE_STATEMENT';
     SQLSTATE: 'HY000'

     Message: Unsafe statement written to the binary log using statement
     format since BINLOG_FORMAT = STATEMENT. %s

   * 
     Error number: '1593'; Symbol: 'ER_SLAVE_FATAL_ERROR'; SQLSTATE:
     'HY000'

     Message: Fatal error: %s

   * 
     Error number: '1594'; Symbol: 'ER_SLAVE_RELAY_LOG_READ_FAILURE';
     SQLSTATE: 'HY000'

     Message: Relay log read failure: %s

   * 
     Error number: '1595'; Symbol: 'ER_SLAVE_RELAY_LOG_WRITE_FAILURE';
     SQLSTATE: 'HY000'

     Message: Relay log write failure: %s

   * 
     Error number: '1596'; Symbol: 'ER_SLAVE_CREATE_EVENT_FAILURE';
     SQLSTATE: 'HY000'

     Message: Failed to create %s

   * 
     Error number: '1597'; Symbol: 'ER_SLAVE_MASTER_COM_FAILURE';
     SQLSTATE: 'HY000'

     Message: Master command %s failed: %s

   * 
     Error number: '1598'; Symbol: 'ER_BINLOG_LOGGING_IMPOSSIBLE';
     SQLSTATE: 'HY000'

     Message: Binary logging not possible.  Message: %s

   * 
     Error number: '1599'; Symbol: 'ER_VIEW_NO_CREATION_CTX'; SQLSTATE:
     'HY000'

     Message: View '%s'.'%s' has no creation context

   * 
     Error number: '1600'; Symbol: 'ER_VIEW_INVALID_CREATION_CTX';
     SQLSTATE: 'HY000'

     Message: Creation context of view '%s'.'%s' is invalid

   * 
     Error number: '1601'; Symbol: 'ER_SR_INVALID_CREATION_CTX';
     SQLSTATE: 'HY000'

     Message: Creation context of stored routine '%s'.'%s' is invalid

   * 
     Error number: '1602'; Symbol: 'ER_TRG_CORRUPTED_FILE'; SQLSTATE:
     'HY000'

     Message: Corrupted TRG file for table '%s'.'%s'

   * 
     Error number: '1603'; Symbol: 'ER_TRG_NO_CREATION_CTX'; SQLSTATE:
     'HY000'

     Message: Triggers for table '%s'.'%s' have no creation context

   * 
     Error number: '1604'; Symbol: 'ER_TRG_INVALID_CREATION_CTX';
     SQLSTATE: 'HY000'

     Message: Trigger creation context of table '%s'.'%s' is invalid

   * 
     Error number: '1605'; Symbol: 'ER_EVENT_INVALID_CREATION_CTX';
     SQLSTATE: 'HY000'

     Message: Creation context of event '%s'.'%s' is invalid

   * 
     Error number: '1606'; Symbol: 'ER_TRG_CANT_OPEN_TABLE'; SQLSTATE:
     'HY000'

     Message: Cannot open table for trigger '%s'.'%s'

   * 
     Error number: '1607'; Symbol: 'ER_CANT_CREATE_SROUTINE'; SQLSTATE:
     'HY000'

     Message: Cannot create stored routine '%s'.  Check warnings

   * 
     Error number: '1608'; Symbol: 'ER_SLAVE_AMBIGOUS_EXEC_MODE';
     SQLSTATE: 'HY000'

     Message: Ambiguous slave modes combination.  %s

     In 5.5.3: 'ER_SLAVE_AMBIGOUS_EXEC_MODE' was renamed to
     'ER_NEVER_USED'.

     'ER_SLAVE_AMBIGOUS_EXEC_MODE' was removed after 5.5.2.

   * 
     Error number: '1608'; Symbol: 'ER_NEVER_USED'; SQLSTATE: 'HY000'

     Message: Ambiguous slave modes combination.  %s

     In 5.5.3: 'ER_SLAVE_AMBIGOUS_EXEC_MODE' was renamed to
     'ER_NEVER_USED'.

     'ER_NEVER_USED' was added in 5.5.3.

   * 
     Error number: '1609'; Symbol:
     'ER_NO_FORMAT_DESCRIPTION_EVENT_BEFORE_BINLOG_STATEMENT'; SQLSTATE:
     'HY000'

     Message: The BINLOG statement of type '%s' was not preceded by a
     format description BINLOG statement.

   * 
     Error number: '1610'; Symbol: 'ER_SLAVE_CORRUPT_EVENT'; SQLSTATE:
     'HY000'

     Message: Corrupted replication event was detected

   * 
     Error number: '1611'; Symbol: 'ER_LOAD_DATA_INVALID_COLUMN';
     SQLSTATE: 'HY000'

     Message: Invalid column reference (%s) in LOAD DATA

   * 
     Error number: '1612'; Symbol: 'ER_LOG_PURGE_NO_FILE'; SQLSTATE:
     'HY000'

     Message: Being purged log %s was not found

   * 
     Error number: '1613'; Symbol: 'ER_XA_RBTIMEOUT'; SQLSTATE: 'XA106'

     Message: XA_RBTIMEOUT: Transaction branch was rolled back: took too
     long

   * 
     Error number: '1614'; Symbol: 'ER_XA_RBDEADLOCK'; SQLSTATE: 'XA102'

     Message: XA_RBDEADLOCK: Transaction branch was rolled back:
     deadlock was detected

   * 
     Error number: '1615'; Symbol: 'ER_NEED_REPREPARE'; SQLSTATE:
     'HY000'

     Message: Prepared statement needs to be re-prepared

   * 
     Error number: '1616'; Symbol: 'ER_DELAYED_NOT_SUPPORTED'; SQLSTATE:
     'HY000'

     Message: DELAYED option not supported for table '%s'

   * 
     Error number: '1617'; Symbol: 'WARN_NO_MASTER_INFO'; SQLSTATE:
     'HY000'

     Message: The master info structure does not exist

   * 
     Error number: '1618'; Symbol: 'WARN_OPTION_IGNORED'; SQLSTATE:
     'HY000'

     Message: <%s> option ignored

   * 
     Error number: '1619'; Symbol: 'WARN_PLUGIN_DELETE_BUILTIN';
     SQLSTATE: 'HY000'

     Message: Built-in plugins cannot be deleted

   * 
     Error number: '1620'; Symbol: 'WARN_PLUGIN_BUSY'; SQLSTATE: 'HY000'

     Message: Plugin is busy and will be uninstalled on shutdown

   * 
     Error number: '1621'; Symbol: 'ER_VARIABLE_IS_READONLY'; SQLSTATE:
     'HY000'

     Message: %s variable '%s' is read-only.  Use SET %s to assign the
     value

   * 
     Error number: '1622'; Symbol:
     'ER_WARN_ENGINE_TRANSACTION_ROLLBACK'; SQLSTATE: 'HY000'

     Message: Storage engine %s does not support rollback for this
     statement.  Transaction rolled back and must be restarted

   * 
     Error number: '1623'; Symbol: 'ER_SLAVE_HEARTBEAT_FAILURE';
     SQLSTATE: 'HY000'

     Message: Unexpected master's heartbeat data: %s

   * 
     Error number: '1624'; Symbol:
     'ER_SLAVE_HEARTBEAT_VALUE_OUT_OF_RANGE'; SQLSTATE: 'HY000'

     Message: The requested value for the heartbeat period is either
     negative or exceeds the maximum allowed (%s seconds).

   * 
     Error number: '1625'; Symbol: 'ER_NDB_REPLICATION_SCHEMA_ERROR';
     SQLSTATE: 'HY000'

     Message: Bad schema for mysql.ndb_replication table.  Message: %s

   * 
     Error number: '1626'; Symbol: 'ER_CONFLICT_FN_PARSE_ERROR';
     SQLSTATE: 'HY000'

     Message: Error in parsing conflict function.  Message: %s

   * 
     Error number: '1627'; Symbol: 'ER_EXCEPTIONS_WRITE_ERROR';
     SQLSTATE: 'HY000'

     Message: Write to exceptions table failed.  Message: %s"

   * 
     Error number: '1628'; Symbol: 'ER_TOO_LONG_TABLE_COMMENT';
     SQLSTATE: 'HY000'

     Message: Comment for table '%s' is too long (max = %lu)

   * 
     Error number: '1629'; Symbol: 'ER_TOO_LONG_FIELD_COMMENT';
     SQLSTATE: 'HY000'

     Message: Comment for field '%s' is too long (max = %lu)

   * 
     Error number: '1630'; Symbol: 'ER_FUNC_INEXISTENT_NAME_COLLISION';
     SQLSTATE: '42000'

     Message: FUNCTION %s does not exist.  Check the 'Function Name
     Parsing and Resolution' section in the Reference Manual

   * 
     Error number: '1631'; Symbol: 'ER_DATABASE_NAME'; SQLSTATE: 'HY000'

     Message: Database

   * 
     Error number: '1632'; Symbol: 'ER_TABLE_NAME'; SQLSTATE: 'HY000'

     Message: Table

   * 
     Error number: '1633'; Symbol: 'ER_PARTITION_NAME'; SQLSTATE:
     'HY000'

     Message: Partition

   * 
     Error number: '1634'; Symbol: 'ER_SUBPARTITION_NAME'; SQLSTATE:
     'HY000'

     Message: Subpartition

   * 
     Error number: '1635'; Symbol: 'ER_TEMPORARY_NAME'; SQLSTATE:
     'HY000'

     Message: Temporary

   * 
     Error number: '1636'; Symbol: 'ER_RENAMED_NAME'; SQLSTATE: 'HY000'

     Message: Renamed

   * 
     Error number: '1637'; Symbol: 'ER_TOO_MANY_CONCURRENT_TRXS';
     SQLSTATE: 'HY000'

     Message: Too many active concurrent transactions

   * 
     Error number: '1638'; Symbol:
     'WARN_NON_ASCII_SEPARATOR_NOT_IMPLEMENTED'; SQLSTATE: 'HY000'

     Message: Non-ASCII separator arguments are not fully supported

   * 
     Error number: '1639'; Symbol: 'ER_DEBUG_SYNC_TIMEOUT'; SQLSTATE:
     'HY000'

     Message: debug sync point wait timed out

   * 
     Error number: '1640'; Symbol: 'ER_DEBUG_SYNC_HIT_LIMIT'; SQLSTATE:
     'HY000'

     Message: debug sync point hit limit reached

   * 
     Error number: '1641'; Symbol: 'ER_DUP_SIGNAL_SET'; SQLSTATE:
     '42000'

     Message: Duplicate condition information item '%s'

   * 
     Error number: '1642'; Symbol: 'ER_SIGNAL_WARN'; SQLSTATE: '01000'

     Message: Unhandled user-defined warning condition

   * 
     Error number: '1643'; Symbol: 'ER_SIGNAL_NOT_FOUND'; SQLSTATE:
     '02000'

     Message: Unhandled user-defined not found condition

   * 
     Error number: '1644'; Symbol: 'ER_SIGNAL_EXCEPTION'; SQLSTATE:
     'HY000'

     Message: Unhandled user-defined exception condition

   * 
     Error number: '1645'; Symbol: 'ER_RESIGNAL_WITHOUT_ACTIVE_HANDLER';
     SQLSTATE: '0K000'

     Message: RESIGNAL when handler not active

   * 
     Error number: '1646'; Symbol: 'ER_SIGNAL_BAD_CONDITION_TYPE';
     SQLSTATE: 'HY000'

     Message: SIGNAL/RESIGNAL can only use a CONDITION defined with
     SQLSTATE

   * 
     Error number: '1647'; Symbol: 'WARN_COND_ITEM_TRUNCATED'; SQLSTATE:
     'HY000'

     Message: Data truncated for condition item '%s'

   * 
     Error number: '1648'; Symbol: 'ER_COND_ITEM_TOO_LONG'; SQLSTATE:
     'HY000'

     Message: Data too long for condition item '%s'

   * 
     Error number: '1649'; Symbol: 'ER_UNKNOWN_LOCALE'; SQLSTATE:
     'HY000'

     Message: Unknown locale: '%s'

   * 
     Error number: '1650'; Symbol: 'ER_SLAVE_IGNORE_SERVER_IDS';
     SQLSTATE: 'HY000'

     Message: The requested server id %d clashes with the slave startup
     option -replicate-same-server-id

   * 
     Error number: '1651'; Symbol: 'ER_QUERY_CACHE_DISABLED'; SQLSTATE:
     'HY000'

     Message: Query cache is disabled; restart the server with
     query_cache_type=1 to enable it

   * 
     Error number: '1652'; Symbol: 'ER_SAME_NAME_PARTITION_FIELD';
     SQLSTATE: 'HY000'

     Message: Duplicate partition field name '%s'

   * 
     Error number: '1653'; Symbol: 'ER_PARTITION_COLUMN_LIST_ERROR';
     SQLSTATE: 'HY000'

     Message: Inconsistency in usage of column lists for partitioning

   * 
     Error number: '1654'; Symbol: 'ER_WRONG_TYPE_COLUMN_VALUE_ERROR';
     SQLSTATE: 'HY000'

     Message: Partition column values of incorrect type

   * 
     Error number: '1655'; Symbol:
     'ER_TOO_MANY_PARTITION_FUNC_FIELDS_ERROR'; SQLSTATE: 'HY000'

     Message: Too many fields in '%s'

   * 
     Error number: '1656'; Symbol: 'ER_MAXVALUE_IN_VALUES_IN'; SQLSTATE:
     'HY000'

     Message: Cannot use MAXVALUE as value in VALUES IN

   * 
     Error number: '1657'; Symbol: 'ER_TOO_MANY_VALUES_ERROR'; SQLSTATE:
     'HY000'

     Message: Cannot have more than one value for this type of %s
     partitioning

   * 
     Error number: '1658'; Symbol:
     'ER_ROW_SINGLE_PARTITION_FIELD_ERROR'; SQLSTATE: 'HY000'

     Message: Row expressions in VALUES IN only allowed for multi-field
     column partitioning

   * 
     Error number: '1659'; Symbol:
     'ER_FIELD_TYPE_NOT_ALLOWED_AS_PARTITION_FIELD'; SQLSTATE: 'HY000'

     Message: Field '%s' is of a not allowed type for this type of
     partitioning

   * 
     Error number: '1660'; Symbol: 'ER_PARTITION_FIELDS_TOO_LONG';
     SQLSTATE: 'HY000'

     Message: The total length of the partitioning fields is too large

   * 
     Error number: '1661'; Symbol:
     'ER_BINLOG_ROW_ENGINE_AND_STMT_ENGINE'; SQLSTATE: 'HY000'

     Message: Cannot execute statement: impossible to write to binary
     log since both row-incapable engines and statement-incapable
     engines are involved.

     'ER_BINLOG_ROW_ENGINE_AND_STMT_ENGINE' was added in 5.5.3.

   * 
     Error number: '1662'; Symbol: 'ER_BINLOG_ROW_MODE_AND_STMT_ENGINE';
     SQLSTATE: 'HY000'

     Message: Cannot execute statement: impossible to write to binary
     log since BINLOG_FORMAT = ROW and at least one table uses a storage
     engine limited to statement-based logging.

     'ER_BINLOG_ROW_MODE_AND_STMT_ENGINE' was added in 5.5.3.

   * 
     Error number: '1663'; Symbol: 'ER_BINLOG_UNSAFE_AND_STMT_ENGINE';
     SQLSTATE: 'HY000'

     Message: Cannot execute statement: impossible to write to binary
     log since statement is unsafe, storage engine is limited to
     statement-based logging, and BINLOG_FORMAT = MIXED. %s

     'ER_BINLOG_UNSAFE_AND_STMT_ENGINE' was added in 5.5.3.

   * 
     Error number: '1664'; Symbol:
     'ER_BINLOG_ROW_INJECTION_AND_STMT_ENGINE'; SQLSTATE: 'HY000'

     Message: Cannot execute statement: impossible to write to binary
     log since statement is in row format and at least one table uses a
     storage engine limited to statement-based logging.

     'ER_BINLOG_ROW_INJECTION_AND_STMT_ENGINE' was added in 5.5.3.

   * 
     Error number: '1665'; Symbol: 'ER_BINLOG_STMT_MODE_AND_ROW_ENGINE';
     SQLSTATE: 'HY000'

     Message: Cannot execute statement: impossible to write to binary
     log since BINLOG_FORMAT = STATEMENT and at least one table uses a
     storage engine limited to row-based logging.%s

     'ER_BINLOG_STMT_MODE_AND_ROW_ENGINE' was added in 5.5.3.

   * 
     Error number: '1666'; Symbol:
     'ER_BINLOG_ROW_INJECTION_AND_STMT_MODE'; SQLSTATE: 'HY000'

     Message: Cannot execute statement: impossible to write to binary
     log since statement is in row format and BINLOG_FORMAT = STATEMENT.

     'ER_BINLOG_ROW_INJECTION_AND_STMT_MODE' was added in 5.5.3.

   * 
     Error number: '1667'; Symbol:
     'ER_BINLOG_MULTIPLE_ENGINES_AND_SELF_LOGGING_ENGINE'; SQLSTATE:
     'HY000'

     Message: Cannot execute statement: impossible to write to binary
     log since more than one engine is involved and at least one engine
     is self-logging.

     'ER_BINLOG_MULTIPLE_ENGINES_AND_SELF_LOGGING_ENGINE' was added in
     5.5.3.

   * 
     Error number: '1668'; Symbol: 'ER_BINLOG_UNSAFE_LIMIT'; SQLSTATE:
     'HY000'

     Message: The statement is unsafe because it uses a LIMIT clause.
     This is unsafe because the set of rows included cannot be
     predicted.

     'ER_BINLOG_UNSAFE_LIMIT' was added in 5.5.3.

   * 
     Error number: '1669'; Symbol: 'ER_BINLOG_UNSAFE_INSERT_DELAYED';
     SQLSTATE: 'HY000'

     Message: The statement is unsafe because it uses INSERT DELAYED.
     This is unsafe because the times when rows are inserted cannot be
     predicted.

     'ER_BINLOG_UNSAFE_INSERT_DELAYED' was added in 5.5.3.

   * 
     Error number: '1670'; Symbol: 'ER_BINLOG_UNSAFE_SYSTEM_TABLE';
     SQLSTATE: 'HY000'

     Message: The statement is unsafe because it uses the general log,
     slow query log, or performance_schema table(s).  This is unsafe
     because system tables may differ on slaves.

     'ER_BINLOG_UNSAFE_SYSTEM_TABLE' was added in 5.5.3.

   * 
     Error number: '1671'; Symbol: 'ER_BINLOG_UNSAFE_AUTOINC_COLUMNS';
     SQLSTATE: 'HY000'

     Message: Statement is unsafe because it invokes a trigger or a
     stored function that inserts into an AUTO_INCREMENT column.
     Inserted values cannot be logged correctly.

     'ER_BINLOG_UNSAFE_AUTOINC_COLUMNS' was added in 5.5.3.

   * 
     Error number: '1672'; Symbol: 'ER_BINLOG_UNSAFE_UDF'; SQLSTATE:
     'HY000'

     Message: Statement is unsafe because it uses a UDF which may not
     return the same value on the slave.

     'ER_BINLOG_UNSAFE_UDF' was added in 5.5.3.

   * 
     Error number: '1673'; Symbol: 'ER_BINLOG_UNSAFE_SYSTEM_VARIABLE';
     SQLSTATE: 'HY000'

     Message: Statement is unsafe because it uses a system variable that
     may have a different value on the slave.

     'ER_BINLOG_UNSAFE_SYSTEM_VARIABLE' was added in 5.5.3.

   * 
     Error number: '1674'; Symbol: 'ER_BINLOG_UNSAFE_SYSTEM_FUNCTION';
     SQLSTATE: 'HY000'

     Message: Statement is unsafe because it uses a system function that
     may return a different value on the slave.

     'ER_BINLOG_UNSAFE_SYSTEM_FUNCTION' was added in 5.5.3.

   * 
     Error number: '1675'; Symbol:
     'ER_BINLOG_UNSAFE_NONTRANS_AFTER_TRANS'; SQLSTATE: 'HY000'

     Message: Statement is unsafe because it accesses a
     non-transactional table after accessing a transactional table
     within the same transaction.

     'ER_BINLOG_UNSAFE_NONTRANS_AFTER_TRANS' was added in 5.5.3.

   * 
     Error number: '1676'; Symbol: 'ER_MESSAGE_AND_STATEMENT'; SQLSTATE:
     'HY000'

     Message: %s Statement: %s

     'ER_MESSAGE_AND_STATEMENT' was added in 5.5.3.

   * 
     Error number: '1677'; Symbol: 'ER_SLAVE_CONVERSION_FAILED';
     SQLSTATE: 'HY000'

     Message: Column %d of table '%s.%s' cannot be converted from type
     '%s' to type '%s'

     'ER_SLAVE_CONVERSION_FAILED' was added in 5.5.3.

   * 
     Error number: '1678'; Symbol: 'ER_SLAVE_CANT_CREATE_CONVERSION';
     SQLSTATE: 'HY000'

     Message: Can't create conversion table for table '%s.%s'

     'ER_SLAVE_CANT_CREATE_CONVERSION' was added in 5.5.3.

   * 
     Error number: '1679'; Symbol:
     'ER_INSIDE_TRANSACTION_PREVENTS_SWITCH_BINLOG_FORMAT'; SQLSTATE:
     'HY000'

     Message: Cannot modify @@session.binlog_format inside a transaction

     'ER_INSIDE_TRANSACTION_PREVENTS_SWITCH_BINLOG_FORMAT' was added in
     5.5.3.

   * 
     Error number: '1680'; Symbol: 'ER_PATH_LENGTH'; SQLSTATE: 'HY000'

     Message: The path specified for %s is too long.

     'ER_PATH_LENGTH' was added in 5.5.3.

   * 
     Error number: '1681'; Symbol:
     'ER_WARN_DEPRECATED_SYNTAX_NO_REPLACEMENT'; SQLSTATE: 'HY000'

     Message: '%s' is deprecated and will be removed in a future
     release.

     'ER_WARN_DEPRECATED_SYNTAX_NO_REPLACEMENT' was added in 5.5.3.

   * 
     Error number: '1682'; Symbol: 'ER_WRONG_NATIVE_TABLE_STRUCTURE';
     SQLSTATE: 'HY000'

     Message: Native table '%s'.'%s' has the wrong structure

     'ER_WRONG_NATIVE_TABLE_STRUCTURE' was added in 5.5.3.

   * 
     Error number: '1683'; Symbol: 'ER_WRONG_PERFSCHEMA_USAGE';
     SQLSTATE: 'HY000'

     Message: Invalid performance_schema usage.

     'ER_WRONG_PERFSCHEMA_USAGE' was added in 5.5.3.

   * 
     Error number: '1684'; Symbol: 'ER_WARN_I_S_SKIPPED_TABLE';
     SQLSTATE: 'HY000'

     Message: Table '%s'.'%s' was skipped since its definition is being
     modified by concurrent DDL statement

     'ER_WARN_I_S_SKIPPED_TABLE' was added in 5.5.3.

   * 
     Error number: '1685'; Symbol:
     'ER_INSIDE_TRANSACTION_PREVENTS_SWITCH_BINLOG_DIRECT'; SQLSTATE:
     'HY000'

     Message: Cannot modify
     @@session.binlog_direct_non_transactional_updates inside a
     transaction

     'ER_INSIDE_TRANSACTION_PREVENTS_SWITCH_BINLOG_DIRECT' was added in
     5.5.3.

   * 
     Error number: '1686'; Symbol:
     'ER_STORED_FUNCTION_PREVENTS_SWITCH_BINLOG_DIRECT'; SQLSTATE:
     'HY000'

     Message: Cannot change the binlog direct flag inside a stored
     function or trigger

     'ER_STORED_FUNCTION_PREVENTS_SWITCH_BINLOG_DIRECT' was added in
     5.5.3.

   * 
     Error number: '1687'; Symbol: 'ER_SPATIAL_MUST_HAVE_GEOM_COL';
     SQLSTATE: '42000'

     Message: A SPATIAL index may only contain a geometrical type column

     'ER_SPATIAL_MUST_HAVE_GEOM_COL' was added in 5.5.2.

   * 
     Error number: '1688'; Symbol: 'ER_TOO_LONG_INDEX_COMMENT';
     SQLSTATE: 'HY000'

     Message: Comment for index '%s' is too long (max = %lu)

     'ER_TOO_LONG_INDEX_COMMENT' was added in 5.5.3.

   * 
     Error number: '1689'; Symbol: 'ER_LOCK_ABORTED'; SQLSTATE: 'HY000'

     Message: Wait on a lock was aborted due to a pending exclusive lock

     'ER_LOCK_ABORTED' was added in 5.5.4.

   * 
     Error number: '1690'; Symbol: 'ER_DATA_OUT_OF_RANGE'; SQLSTATE:
     '22003'

     Message: %s value is out of range in '%s'

     'ER_DATA_OUT_OF_RANGE' was added in 5.5.5.

   * 
     Error number: '1691'; Symbol: 'ER_WRONG_SPVAR_TYPE_IN_LIMIT';
     SQLSTATE: 'HY000'

     Message: A variable of a non-integer based type in LIMIT clause

     'ER_WRONG_SPVAR_TYPE_IN_LIMIT' was added in 5.5.5.

   * 
     Error number: '1692'; Symbol:
     'ER_BINLOG_UNSAFE_MULTIPLE_ENGINES_AND_SELF_LOGGING_ENGINE';
     SQLSTATE: 'HY000'

     Message: Mixing self-logging and non-self-logging engines in a
     statement is unsafe.

     'ER_BINLOG_UNSAFE_MULTIPLE_ENGINES_AND_SELF_LOGGING_ENGINE' was
     added in 5.5.5.

   * 
     Error number: '1693'; Symbol: 'ER_BINLOG_UNSAFE_MIXED_STATEMENT';
     SQLSTATE: 'HY000'

     Message: Statement accesses nontransactional table as well as
     transactional or temporary table, and writes to any of them.

     'ER_BINLOG_UNSAFE_MIXED_STATEMENT' was added in 5.5.5.

   * 
     Error number: '1694'; Symbol:
     'ER_INSIDE_TRANSACTION_PREVENTS_SWITCH_SQL_LOG_BIN'; SQLSTATE:
     'HY000'

     Message: Cannot modify @@session.sql_log_bin inside a transaction

     'ER_INSIDE_TRANSACTION_PREVENTS_SWITCH_SQL_LOG_BIN' was added in
     5.5.5.

   * 
     Error number: '1695'; Symbol:
     'ER_STORED_FUNCTION_PREVENTS_SWITCH_SQL_LOG_BIN'; SQLSTATE: 'HY000'

     Message: Cannot change the sql_log_bin inside a stored function or
     trigger

     'ER_STORED_FUNCTION_PREVENTS_SWITCH_SQL_LOG_BIN' was added in
     5.5.5.

   * 
     Error number: '1696'; Symbol: 'ER_FAILED_READ_FROM_PAR_FILE';
     SQLSTATE: 'HY000'

     Message: Failed to read from the .par file

     'ER_FAILED_READ_FROM_PAR_FILE' was added in 5.5.5.

   * 
     Error number: '1697'; Symbol: 'ER_VALUES_IS_NOT_INT_TYPE_ERROR';
     SQLSTATE: 'HY000'

     Message: VALUES value for partition '%s' must have type INT

     'ER_VALUES_IS_NOT_INT_TYPE_ERROR' was added in 5.5.7.

   * 
     Error number: '1698'; Symbol: 'ER_ACCESS_DENIED_NO_PASSWORD_ERROR';
     SQLSTATE: '28000'

     Message: Access denied for user '%s'@'%s'

     'ER_ACCESS_DENIED_NO_PASSWORD_ERROR' was added in 5.5.7.

   * 
     Error number: '1699'; Symbol: 'ER_SET_PASSWORD_AUTH_PLUGIN';
     SQLSTATE: 'HY000'

     Message: SET PASSWORD has no significance for users authenticating
     via plugins

     'ER_SET_PASSWORD_AUTH_PLUGIN' was added in 5.5.7.

   * 
     Error number: '1700'; Symbol: 'ER_GRANT_PLUGIN_USER_EXISTS';
     SQLSTATE: 'HY000'

     Message: GRANT with IDENTIFIED WITH is illegal because the user
     %-.*s already exists

     'ER_GRANT_PLUGIN_USER_EXISTS' was added in 5.5.7.

   * 
     Error number: '1701'; Symbol: 'ER_TRUNCATE_ILLEGAL_FK'; SQLSTATE:
     '42000'

     Message: Cannot truncate a table referenced in a foreign key
     constraint (%s)

     'ER_TRUNCATE_ILLEGAL_FK' was added in 5.5.7.

   * 
     Error number: '1702'; Symbol: 'ER_PLUGIN_IS_PERMANENT'; SQLSTATE:
     'HY000'

     Message: Plugin '%s' is force_plus_permanent and can not be
     unloaded

     'ER_PLUGIN_IS_PERMANENT' was added in 5.5.7.

   * 
     Error number: '1703'; Symbol:
     'ER_SLAVE_HEARTBEAT_VALUE_OUT_OF_RANGE_MIN'; SQLSTATE: 'HY000'

     Message: The requested value for the heartbeat period is less than
     1 millisecond.  The value is reset to 0, meaning that heartbeating
     will effectively be disabled.

     'ER_SLAVE_HEARTBEAT_VALUE_OUT_OF_RANGE_MIN' was added in 5.5.7.

   * 
     Error number: '1704'; Symbol:
     'ER_SLAVE_HEARTBEAT_VALUE_OUT_OF_RANGE_MAX'; SQLSTATE: 'HY000'

     Message: The requested value for the heartbeat period exceeds the
     value of 'slave_net_timeout' seconds.  A sensible value for the
     period should be less than the timeout.

     'ER_SLAVE_HEARTBEAT_VALUE_OUT_OF_RANGE_MAX' was added in 5.5.7.

   * 
     Error number: '1705'; Symbol: 'ER_STMT_CACHE_FULL'; SQLSTATE:
     'HY000'

     Message: Multi-row statements required more than
     'max_binlog_stmt_cache_size' bytes of storage; increase this mysqld
     variable and try again

     'ER_STMT_CACHE_FULL' was added in 5.5.9.

   * 
     Error number: '1706'; Symbol: 'ER_MULTI_UPDATE_KEY_CONFLICT';
     SQLSTATE: 'HY000'

     Message: Primary key/partition key update is not allowed since the
     table is updated both as '%s' and '%s'.

     'ER_MULTI_UPDATE_KEY_CONFLICT' was added in 5.5.11.

   * 
     Error number: '1707'; Symbol: 'ER_TABLE_NEEDS_REBUILD'; SQLSTATE:
     'HY000'

     Message: Table rebuild required.  Please do "ALTER TABLE '%s'
     FORCE" or dump/reload to fix it!

     'ER_TABLE_NEEDS_REBUILD' was added in 5.5.11.

   * 
     Error number: '1708'; Symbol: 'WARN_OPTION_BELOW_LIMIT'; SQLSTATE:
     'HY000'

     Message: The value of '%s' should be no less than the value of '%s'

     'WARN_OPTION_BELOW_LIMIT' was added in 5.5.12.

   * 
     Error number: '1709'; Symbol: 'ER_INDEX_COLUMN_TOO_LONG'; SQLSTATE:
     'HY000'

     Message: Index column size too large.  The maximum column size is
     %lu bytes.

     'ER_INDEX_COLUMN_TOO_LONG' was added in 5.5.14.

   * 
     Error number: '1710'; Symbol: 'ER_ERROR_IN_TRIGGER_BODY'; SQLSTATE:
     'HY000'

     Message: Trigger '%s' has an error in its body: '%s'

     'ER_ERROR_IN_TRIGGER_BODY' was added in 5.5.15.

   * 
     Error number: '1711'; Symbol: 'ER_ERROR_IN_UNKNOWN_TRIGGER_BODY';
     SQLSTATE: 'HY000'

     Message: Unknown trigger has an error in its body: '%s'

     'ER_ERROR_IN_UNKNOWN_TRIGGER_BODY' was added in 5.5.15.

   * 
     Error number: '1712'; Symbol: 'ER_INDEX_CORRUPT'; SQLSTATE: 'HY000'

     Message: Index %s is corrupted

     'ER_INDEX_CORRUPT' was added in 5.5.17.

   * 
     Error number: '1713'; Symbol: 'ER_UNDO_RECORD_TOO_BIG'; SQLSTATE:
     'HY000'

     Message: Undo log record is too big.

     'ER_UNDO_RECORD_TOO_BIG' was added in 5.5.17.

   * 
     Error number: '1714'; Symbol:
     'ER_BINLOG_UNSAFE_INSERT_IGNORE_SELECT'; SQLSTATE: 'HY000'

     Message: INSERT IGNORE... SELECT is unsafe because the order in
     which rows are retrieved by the SELECT determines which (if any)
     rows are ignored.  This order cannot be predicted and may differ on
     master and the slave.

     'ER_BINLOG_UNSAFE_INSERT_IGNORE_SELECT' was added in 5.5.18.

   * 
     Error number: '1715'; Symbol:
     'ER_BINLOG_UNSAFE_INSERT_SELECT_UPDATE'; SQLSTATE: 'HY000'

     Message: INSERT... SELECT... ON DUPLICATE KEY UPDATE is unsafe
     because the order in which rows are retrieved by the SELECT
     determines which (if any) rows are updated.  This order cannot be
     predicted and may differ on master and the slave.

     'ER_BINLOG_UNSAFE_INSERT_SELECT_UPDATE' was added in 5.5.18.

   * 
     Error number: '1716'; Symbol: 'ER_BINLOG_UNSAFE_REPLACE_SELECT';
     SQLSTATE: 'HY000'

     Message: REPLACE... SELECT is unsafe because the order in which
     rows are retrieved by the SELECT determines which (if any) rows are
     replaced.  This order cannot be predicted and may differ on master
     and the slave.

     'ER_BINLOG_UNSAFE_REPLACE_SELECT' was added in 5.5.18.

   * 
     Error number: '1717'; Symbol:
     'ER_BINLOG_UNSAFE_CREATE_IGNORE_SELECT'; SQLSTATE: 'HY000'

     Message: CREATE... IGNORE SELECT is unsafe because the order in
     which rows are retrieved by the SELECT determines which (if any)
     rows are ignored.  This order cannot be predicted and may differ on
     master and the slave.

     'ER_BINLOG_UNSAFE_CREATE_IGNORE_SELECT' was added in 5.5.18.

   * 
     Error number: '1718'; Symbol:
     'ER_BINLOG_UNSAFE_CREATE_REPLACE_SELECT'; SQLSTATE: 'HY000'

     Message: CREATE... REPLACE SELECT is unsafe because the order in
     which rows are retrieved by the SELECT determines which (if any)
     rows are replaced.  This order cannot be predicted and may differ
     on master and the slave.

     'ER_BINLOG_UNSAFE_CREATE_REPLACE_SELECT' was added in 5.5.18.

   * 
     Error number: '1719'; Symbol: 'ER_BINLOG_UNSAFE_UPDATE_IGNORE';
     SQLSTATE: 'HY000'

     Message: UPDATE IGNORE is unsafe because the order in which rows
     are updated determines which (if any) rows are ignored.  This order
     cannot be predicted and may differ on master and the slave.

     'ER_BINLOG_UNSAFE_UPDATE_IGNORE' was added in 5.5.18.

   * 
     Error number: '1720'; Symbol: 'ER_PLUGIN_NO_UNINSTALL'; SQLSTATE:
     'HY000'

     Message: Plugin '%s' is marked as not dynamically uninstallable.
     You have to stop the server to uninstall it.

     'ER_PLUGIN_NO_UNINSTALL' was added in 5.5.16.

   * 
     Error number: '1721'; Symbol: 'ER_PLUGIN_NO_INSTALL'; SQLSTATE:
     'HY000'

     Message: Plugin '%s' is marked as not dynamically installable.  You
     have to stop the server to install it.

     'ER_PLUGIN_NO_INSTALL' was added in 5.5.16.

   * 
     Error number: '1722'; Symbol:
     'ER_BINLOG_UNSAFE_WRITE_AUTOINC_SELECT'; SQLSTATE: 'HY000'

     Message: Statements writing to a table with an auto-increment
     column after selecting from another table are unsafe because the
     order in which rows are retrieved determines what (if any) rows
     will be written.  This order cannot be predicted and may differ on
     master and the slave.

     'ER_BINLOG_UNSAFE_WRITE_AUTOINC_SELECT' was added in 5.5.22.

   * 
     Error number: '1723'; Symbol:
     'ER_BINLOG_UNSAFE_CREATE_SELECT_AUTOINC'; SQLSTATE: 'HY000'

     Message: CREATE TABLE... SELECT... on a table with an
     auto-increment column is unsafe because the order in which rows are
     retrieved by the SELECT determines which (if any) rows are
     inserted.  This order cannot be predicted and may differ on master
     and the slave.

     'ER_BINLOG_UNSAFE_CREATE_SELECT_AUTOINC' was added in 5.5.22.

   * 
     Error number: '1724'; Symbol: 'ER_BINLOG_UNSAFE_INSERT_TWO_KEYS';
     SQLSTATE: 'HY000'

     Message: INSERT... ON DUPLICATE KEY UPDATE on a table with more
     than one UNIQUE KEY is unsafe

     'ER_BINLOG_UNSAFE_INSERT_TWO_KEYS' was added in 5.5.24.

   * 
     Error number: '1725'; Symbol: 'ER_TABLE_IN_FK_CHECK'; SQLSTATE:
     'HY000'

     Message: Table is being used in foreign key check.

     'ER_TABLE_IN_FK_CHECK' was added in 5.5.24.

   * 
     Error number: '1726'; Symbol: 'ER_UNSUPPORTED_ENGINE'; SQLSTATE:
     'HY000'

     Message: Storage engine '%s' does not support system tables.
     [%s.%s]

     'ER_UNSUPPORTED_ENGINE' was added in 5.5.24.

   * 
     Error number: '1727'; Symbol: 'ER_BINLOG_UNSAFE_AUTOINC_NOT_FIRST';
     SQLSTATE: 'HY000'

     Message: INSERT into autoincrement field which is not the first
     part in the composed primary key is unsafe.

     'ER_BINLOG_UNSAFE_AUTOINC_NOT_FIRST' was added in 5.5.25.


File: manual.info.tmp,  Node: client-error-reference,  Next: global-error-reference,  Prev: server-error-reference,  Up: error-reference

B.3.2 Client Error Message Reference
------------------------------------

Client error messages originate from within the MySQL client library.
Here is an example client error message, as displayed by the *note
'mysql': mysql. client:

     shell> mysql -h no-such-host
     ERROR 2005 (HY000): Unknown MySQL server host 'no-such-host' (0)

Each client error message includes an error code, SQLSTATE value, and
message string, as described in *note error-message-components::.  These
components are available as described in *note error-interfaces::.  For
client errors, the SQLSTATE value is always ''HY000'' (general error),
so it is not meaningful for distinguishing one client error from
another.

The client library also makes available to host client programs any
errors that originate on the server side and are recieved by the client
from the server.  For a list of server-side errors, see *note
server-error-reference::.

In addition to the errors in the following list, the client library can
also produce error messages that have error codes in the range from 1 to
999.  See *note global-error-reference::

   * 
     Error number: '2000'; Symbol: 'CR_UNKNOWN_ERROR';

     Message: Unknown MySQL error

   * 
     Error number: '2001'; Symbol: 'CR_SOCKET_CREATE_ERROR';

     Message: Can't create UNIX socket (%d)

   * 
     Error number: '2002'; Symbol: 'CR_CONNECTION_ERROR';

     Message: Can't connect to local MySQL server through socket '%s'
     (%d)

   * 
     Error number: '2003'; Symbol: 'CR_CONN_HOST_ERROR';

     Message: Can't connect to MySQL server on '%s' (%d)

   * 
     Error number: '2004'; Symbol: 'CR_IPSOCK_ERROR';

     Message: Can't create TCP/IP socket (%d)

   * 
     Error number: '2005'; Symbol: 'CR_UNKNOWN_HOST';

     Message: Unknown MySQL server host '%s' (%d)

   * 
     Error number: '2006'; Symbol: 'CR_SERVER_GONE_ERROR';

     Message: MySQL server has gone away

   * 
     Error number: '2007'; Symbol: 'CR_VERSION_ERROR';

     Message: Protocol mismatch; server version = %d, client version =
     %d

   * 
     Error number: '2008'; Symbol: 'CR_OUT_OF_MEMORY';

     Message: MySQL client ran out of memory

   * 
     Error number: '2009'; Symbol: 'CR_WRONG_HOST_INFO';

     Message: Wrong host info

   * 
     Error number: '2010'; Symbol: 'CR_LOCALHOST_CONNECTION';

     Message: Localhost via UNIX socket

   * 
     Error number: '2011'; Symbol: 'CR_TCP_CONNECTION';

     Message: %s via TCP/IP

   * 
     Error number: '2012'; Symbol: 'CR_SERVER_HANDSHAKE_ERR';

     Message: Error in server handshake

   * 
     Error number: '2013'; Symbol: 'CR_SERVER_LOST';

     Message: Lost connection to MySQL server during query

   * 
     Error number: '2014'; Symbol: 'CR_COMMANDS_OUT_OF_SYNC';

     Message: Commands out of sync; you can't run this command now

     Commands were executed in an improper order.  This error occurs
     when a function is called that is not appropriate for the current
     state of the connection.  For example, if *note
     'mysql_stmt_fetch()': mysql-stmt-fetch. is not called enough times
     to read an entire result set (that is, enough times to return
     'MYSQL_NO_DATA'), this error may occur for the following C API
     call.

   * 
     Error number: '2015'; Symbol: 'CR_NAMEDPIPE_CONNECTION';

     Message: Named pipe: %s

   * 
     Error number: '2016'; Symbol: 'CR_NAMEDPIPEWAIT_ERROR';

     Message: Can't wait for named pipe to host: %s pipe: %s (%lu)

   * 
     Error number: '2017'; Symbol: 'CR_NAMEDPIPEOPEN_ERROR';

     Message: Can't open named pipe to host: %s pipe: %s (%lu)

   * 
     Error number: '2018'; Symbol: 'CR_NAMEDPIPESETSTATE_ERROR';

     Message: Can't set state of named pipe to host: %s pipe: %s (%lu)

   * 
     Error number: '2019'; Symbol: 'CR_CANT_READ_CHARSET';

     Message: Can't initialize character set %s (path: %s)

   * 
     Error number: '2020'; Symbol: 'CR_NET_PACKET_TOO_LARGE';

     Message: Got packet bigger than 'max_allowed_packet' bytes

   * 
     Error number: '2021'; Symbol: 'CR_EMBEDDED_CONNECTION';

     Message: Embedded server

   * 
     Error number: '2022'; Symbol: 'CR_PROBE_SLAVE_STATUS';

     Message: Error on SHOW SLAVE STATUS:

   * 
     Error number: '2023'; Symbol: 'CR_PROBE_SLAVE_HOSTS';

     Message: Error on SHOW SLAVE HOSTS:

   * 
     Error number: '2024'; Symbol: 'CR_PROBE_SLAVE_CONNECT';

     Message: Error connecting to slave:

   * 
     Error number: '2025'; Symbol: 'CR_PROBE_MASTER_CONNECT';

     Message: Error connecting to master:

   * 
     Error number: '2026'; Symbol: 'CR_SSL_CONNECTION_ERROR';

     Message: SSL connection error: %s

   * 
     Error number: '2027'; Symbol: 'CR_MALFORMED_PACKET';

     Message: Malformed packet

   * 
     Error number: '2028'; Symbol: 'CR_WRONG_LICENSE';

     Message: This client library is licensed only for use with MySQL
     servers having '%s' license

   * 
     Error number: '2029'; Symbol: 'CR_NULL_POINTER';

     Message: Invalid use of null pointer

   * 
     Error number: '2030'; Symbol: 'CR_NO_PREPARE_STMT';

     Message: Statement not prepared

   * 
     Error number: '2031'; Symbol: 'CR_PARAMS_NOT_BOUND';

     Message: No data supplied for parameters in prepared statement

   * 
     Error number: '2032'; Symbol: 'CR_DATA_TRUNCATED';

     Message: Data truncated

   * 
     Error number: '2033'; Symbol: 'CR_NO_PARAMETERS_EXISTS';

     Message: No parameters exist in the statement

   * 
     Error number: '2034'; Symbol: 'CR_INVALID_PARAMETER_NO';

     Message: Invalid parameter number

     The column number for *note 'mysql_stmt_fetch_column()':
     mysql-stmt-fetch-column. was invalid.

     The parameter number for *note 'mysql_stmt_send_long_data()':
     mysql-stmt-send-long-data. was invalid.

   * 
     Error number: '2035'; Symbol: 'CR_INVALID_BUFFER_USE';

     Message: Can't send long data for non-string/non-binary data types
     (parameter: %d)

   * 
     Error number: '2036'; Symbol: 'CR_UNSUPPORTED_PARAM_TYPE';

     Message: Using unsupported buffer type: %d (parameter: %d)

   * 
     Error number: '2037'; Symbol: 'CR_SHARED_MEMORY_CONNECTION';

     Message: Shared memory: %s

   * 
     Error number: '2038'; Symbol:
     'CR_SHARED_MEMORY_CONNECT_REQUEST_ERROR';

     Message: Can't open shared memory; client could not create request
     event (%lu)

   * 
     Error number: '2039'; Symbol:
     'CR_SHARED_MEMORY_CONNECT_ANSWER_ERROR';

     Message: Can't open shared memory; no answer event received from
     server (%lu)

   * 
     Error number: '2040'; Symbol:
     'CR_SHARED_MEMORY_CONNECT_FILE_MAP_ERROR';

     Message: Can't open shared memory; server could not allocate file
     mapping (%lu)

   * 
     Error number: '2041'; Symbol: 'CR_SHARED_MEMORY_CONNECT_MAP_ERROR';

     Message: Can't open shared memory; server could not get pointer to
     file mapping (%lu)

   * 
     Error number: '2042'; Symbol: 'CR_SHARED_MEMORY_FILE_MAP_ERROR';

     Message: Can't open shared memory; client could not allocate file
     mapping (%lu)

   * 
     Error number: '2043'; Symbol: 'CR_SHARED_MEMORY_MAP_ERROR';

     Message: Can't open shared memory; client could not get pointer to
     file mapping (%lu)

   * 
     Error number: '2044'; Symbol: 'CR_SHARED_MEMORY_EVENT_ERROR';

     Message: Can't open shared memory; client could not create %s event
     (%lu)

   * 
     Error number: '2045'; Symbol:
     'CR_SHARED_MEMORY_CONNECT_ABANDONED_ERROR';

     Message: Can't open shared memory; no answer from server (%lu)

   * 
     Error number: '2046'; Symbol: 'CR_SHARED_MEMORY_CONNECT_SET_ERROR';

     Message: Can't open shared memory; cannot send request event to
     server (%lu)

   * 
     Error number: '2047'; Symbol: 'CR_CONN_UNKNOW_PROTOCOL';

     Message: Wrong or unknown protocol

   * 
     Error number: '2048'; Symbol: 'CR_INVALID_CONN_HANDLE';

     Message: Invalid connection handle

   * 
     Error number: '2049'; Symbol: 'CR_SECURE_AUTH';

     Message: Connection using old (pre-4.1.1) authentication protocol
     refused (client option 'secure_auth' enabled)

   * 
     Error number: '2050'; Symbol: 'CR_FETCH_CANCELED';

     Message: Row retrieval was canceled by mysql_stmt_close() call

   * 
     Error number: '2051'; Symbol: 'CR_NO_DATA';

     Message: Attempt to read column without prior row fetch

   * 
     Error number: '2052'; Symbol: 'CR_NO_STMT_METADATA';

     Message: Prepared statement contains no metadata

   * 
     Error number: '2053'; Symbol: 'CR_NO_RESULT_SET';

     Message: Attempt to read a row while there is no result set
     associated with the statement

   * 
     Error number: '2054'; Symbol: 'CR_NOT_IMPLEMENTED';

     Message: This feature is not implemented yet

   * 
     Error number: '2055'; Symbol: 'CR_SERVER_LOST_EXTENDED';

     Message: Lost connection to MySQL server at '%s', system error: %d

   * 
     Error number: '2056'; Symbol: 'CR_STMT_CLOSED';

     Message: Statement closed indirectly because of a preceeding %s()
     call

   * 
     Error number: '2057'; Symbol: 'CR_NEW_STMT_METADATA';

     Message: The number of columns in the result set differs from the
     number of bound buffers.  You must reset the statement, rebind the
     result set columns, and execute the statement again

   * 
     Error number: '2058'; Symbol: 'CR_ALREADY_CONNECTED';

     Message: This handle is already connected.  Use a separate handle
     for each connection.

   * 
     Error number: '2059'; Symbol: 'CR_AUTH_PLUGIN_CANNOT_LOAD';

     Message: Authentication plugin '%s' cannot be loaded: %s

     'CR_AUTH_PLUGIN_CANNOT_LOAD' was added in 5.5.7.


File: manual.info.tmp,  Node: global-error-reference,  Prev: client-error-reference,  Up: error-reference

B.3.3 Global Error Message Reference
------------------------------------

This section lists global error messages that are shared in the sense
that they can be produced by the MySQL server or by MySQL client
programs.  These errors have error codes in the range from 1 to 999.

Each global error message includes an error code, SQLSTATE value, and
message string, as described in *note error-message-components::.  These
components are available as described in *note error-interfaces::.  For
global errors, the SQLSTATE value is always ''HY000'' (general error),
so it is not meaningful for distinguishing one client error from
another.

   * 
     Error number: '1'; Symbol: 'EE_CANTCREATEFILE';

     Message: Can't create/write to file '%s' (Errcode: %d)

   * 
     Error number: '2'; Symbol: 'EE_READ';

     Message: Error reading file '%s' (Errcode: %d)

   * 
     Error number: '3'; Symbol: 'EE_WRITE';

     Message: Error writing file '%s' (Errcode: %d)

   * 
     Error number: '4'; Symbol: 'EE_BADCLOSE';

     Message: Error on close of '%s' (Errcode: %d)

   * 
     Error number: '5'; Symbol: 'EE_OUTOFMEMORY';

     Message: Out of memory (Needed %u bytes)

   * 
     Error number: '6'; Symbol: 'EE_DELETE';

     Message: Error on delete of '%s' (Errcode: %d)

   * 
     Error number: '7'; Symbol: 'EE_LINK';

     Message: Error on rename of '%s' to '%s' (Errcode: %d)

   * 
     Error number: '9'; Symbol: 'EE_EOFERR';

     Message: Unexpected eof found when reading file '%s' (Errcode: %d)

   * 
     Error number: '10'; Symbol: 'EE_CANTLOCK';

     Message: Can't lock file (Errcode: %d)

   * 
     Error number: '11'; Symbol: 'EE_CANTUNLOCK';

     Message: Can't unlock file (Errcode: %d)

   * 
     Error number: '12'; Symbol: 'EE_DIR';

     Message: Can't read dir of '%s' (Errcode: %d)

   * 
     Error number: '13'; Symbol: 'EE_STAT';

     Message: Can't get stat of '%s' (Errcode: %d)

   * 
     Error number: '14'; Symbol: 'EE_CANT_CHSIZE';

     Message: Can't change size of file (Errcode: %d)

   * 
     Error number: '15'; Symbol: 'EE_CANT_OPEN_STREAM';

     Message: Can't open stream from handle (Errcode: %d)

   * 
     Error number: '16'; Symbol: 'EE_GETWD';

     Message: Can't get working dirctory (Errcode: %d)

   * 
     Error number: '17'; Symbol: 'EE_SETWD';

     Message: Can't change dir to '%s' (Errcode: %d)

   * 
     Error number: '18'; Symbol: 'EE_LINK_WARNING';

     Message: Warning: '%s' had %d links

   * 
     Error number: '19'; Symbol: 'EE_OPEN_WARNING';

     Message: Warning: %d files and %d streams is left open

   * 
     Error number: '20'; Symbol: 'EE_DISK_FULL';

     Message: Disk is full writing '%s' (Errcode: %d).  Waiting for
     someone to free space...  (Expect up to %d secs delay for server to
     continue after freeing disk space)

   * 
     Error number: '21'; Symbol: 'EE_CANT_MKDIR';

     Message: Can't create directory '%s' (Errcode: %d)

   * 
     Error number: '22'; Symbol: 'EE_UNKNOWN_CHARSET';

     Message: Character set '%s' is not a compiled character set and is
     not specified in the '%s' file

   * 
     Error number: '23'; Symbol: 'EE_OUT_OF_FILERESOURCES';

     Message: Out of resources when opening file '%s' (Errcode: %d)

   * 
     Error number: '24'; Symbol: 'EE_CANT_READLINK';

     Message: Can't read value for symlink '%s' (Error %d)

   * 
     Error number: '25'; Symbol: 'EE_CANT_SYMLINK';

     Message: Can't create symlink '%s' pointing at '%s' (Error %d)

   * 
     Error number: '26'; Symbol: 'EE_REALPATH';

     Message: Error on realpath() on '%s' (Error %d)

   * 
     Error number: '27'; Symbol: 'EE_SYNC';

     Message: Can't sync file '%s' to disk (Errcode: %d)

   * 
     Error number: '28'; Symbol: 'EE_UNKNOWN_COLLATION';

     Message: Collation '%s' is not a compiled collation and is not
     specified in the '%s' file

   * 
     Error number: '29'; Symbol: 'EE_FILENOTFOUND';

     Message: File '%s' not found (Errcode: %d)

   * 
     Error number: '30'; Symbol: 'EE_FILE_NOT_CLOSED';

     Message: File '%s' (fileno: %d) was not closed

   * 
     Error number: '31'; Symbol: 'EE_CHANGE_OWNERSHIP';

     Message: Can't change ownership of the file '%s' (Errcode: %d)

     'EE_CHANGE_OWNERSHIP' was added in 5.5.6.

   * 
     Error number: '32'; Symbol: 'EE_CHANGE_PERMISSIONS';

     Message: Can't change permissions of the file '%s' (Errcode: %d)

     'EE_CHANGE_PERMISSIONS' was added in 5.5.6.

   * 
     Error number: '33'; Symbol: 'EE_CANT_SEEK';

     Message: Can't seek in file '%s' (Errcode: %d)

     'EE_CANT_SEEK' was added in 5.5.9.


File: manual.info.tmp,  Node: problems,  Prev: error-reference,  Up: error-handling

B.4 Problems and Common Errors
==============================

* Menu:

* what-is-crashing::             How to Determine What Is Causing a Problem
* common-errors::                Common Errors When Using MySQL Programs
* administration-issues::        Administration-Related Issues
* query-issues::                 Query-Related Issues
* optimizer-issues::             Optimizer-Related Issues
* table-definition-issues::      Table Definition-Related Issues
* known-issues::                 Known Issues in MySQL

This section lists some common problems and error messages that you may
encounter.  It describes how to determine the causes of the problems and
what to do to solve them.


File: manual.info.tmp,  Node: what-is-crashing,  Next: common-errors,  Prev: problems,  Up: problems

B.4.1 How to Determine What Is Causing a Problem
------------------------------------------------

When you run into a problem, the first thing you should do is to find
out which program or piece of equipment is causing it:

   * If you have one of the following symptoms, then it is probably a
     hardware problems (such as memory, motherboard, CPU, or hard disk)
     or kernel problem:

        * The keyboard does not work.  This can normally be checked by
          pressing the Caps Lock key.  If the Caps Lock light does not
          change, you have to replace your keyboard.  (Before doing
          this, you should try to restart your computer and check all
          cables to the keyboard.)

        * The mouse pointer does not move.

        * The machine does not answer to a remote machine's pings.

        * Other programs that are not related to MySQL do not behave
          correctly.

        * Your system restarted unexpectedly.  (A faulty user-level
          program should never be able to take down your system.)

     In this case, you should start by checking all your cables and run
     some diagnostic tool to check your hardware!  You should also check
     whether there are any patches, updates, or service packs for your
     operating system that could likely solve your problem.  Check also
     that all your libraries (such as 'glibc') are up to date.

     It is always good to use a machine with ECC memory to discover
     memory problems early.

   * If your keyboard is locked up, you may be able to recover by
     logging in to your machine from another machine and executing
     'kbd_mode -a'.

   * Please examine your system log file ('/var/log/messages' or
     similar) for reasons for your problem.  If you think the problem is
     in MySQL, you should also examine MySQL's log files.  See *note
     server-logs::.

   * If you do not think you have hardware problems, you should try to
     find out which program is causing problems.  Try using 'top', 'ps',
     Task Manager, or some similar program, to check which program is
     taking all CPU or is locking the machine.

   * Use 'top', 'df', or a similar program to check whether you are out
     of memory, disk space, file descriptors, or some other critical
     resource.

   * If the problem is some runaway process, you can always try to kill
     it.  If it does not want to die, there is probably a bug in the
     operating system.

If you have examined all other possibilities and concluded that the
MySQL server or a MySQL client is causing the problem, it is time to
create a bug report, see *note bug-reports::.  In the bug report, try to
give a complete description of how the system is behaving and what you
think is happening.  Also state why you think that MySQL is causing the
problem.  Take into consideration all the situations described in this
chapter.  State any problems exactly how they appear when you examine
your system.  Use the 'copy and paste' method for any output and error
messages from programs and log files.

Try to describe in detail which program is not working and all symptoms
you see.  We have in the past received many bug reports that state only
'the system does not work.' This provides us with no information about
what could be the problem.

If a program fails, it is always useful to know the following
information:

   * Has the program in question made a segmentation fault (did it dump
     core)?

   * Is the program taking up all available CPU time?  Check with 'top'.
     Let the program run for a while, it may simply be evaluating
     something computationally intensive.

   * If the *note 'mysqld': mysqld. server is causing problems, can you
     get any response from it with *note 'mysqladmin -u root ping':
     mysqladmin. or *note 'mysqladmin -u root processlist': mysqladmin.?

   * What does a client program say when you try to connect to the MySQL
     server?  (Try with *note 'mysql': mysql, for example.)  Does the
     client jam?  Do you get any output from the program?

When sending a bug report, you should follow the outline described in
*note bug-reports::.


File: manual.info.tmp,  Node: common-errors,  Next: administration-issues,  Prev: what-is-crashing,  Up: problems

B.4.2 Common Errors When Using MySQL Programs
---------------------------------------------

* Menu:

* error-access-denied::          Access denied
* can-not-connect-to-server::    Can't connect to [local] MySQL server
* error-lost-connection::        Lost connection to MySQL server
* old-client::                   Client does not support authentication protocol
* password-too-long::            Password Fails When Entered Interactively
* blocked-host::                 Host 'host_name' is blocked
* too-many-connections::         Too many connections
* out-of-memory::                Out of memory
* gone-away::                    MySQL server has gone away
* packet-too-large::             Packet Too Large
* communication-errors::         Communication Errors and Aborted Connections
* full-table::                   The table is full
* cannot-create::                Can't create/write to file
* commands-out-of-sync::         Commands out of sync
* ignoring-user::                Ignoring user
* cannot-find-table::            Table 'tbl_name' doesn't exist
* cannot-initialize-character-set::  Can't initialize character set
* not-enough-file-handles::      File Not Found and Similar Errors
* table-corruption::             Table-Corruption Issues

This section lists some errors that users frequently encounter when
running MySQL programs.  Although the problems show up when you try to
run client programs, the solutions to many of the problems involves
changing the configuration of the MySQL server.


File: manual.info.tmp,  Node: error-access-denied,  Next: can-not-connect-to-server,  Prev: common-errors,  Up: common-errors

B.4.2.1 Access denied
.....................

An 'Access denied' error can have many causes.  Often the problem is
related to the MySQL accounts that the server permits client programs to
use when connecting.  See *note access-control::, and *note
problems-connecting::.


File: manual.info.tmp,  Node: can-not-connect-to-server,  Next: error-lost-connection,  Prev: error-access-denied,  Up: common-errors

B.4.2.2 Can't connect to [local] MySQL server
.............................................

* Menu:

* howto-set-selinux-context::    Set SELinux context for MySQL Server
* can-not-connect-to-server-on-windows::  Connection to MySQL Server Failing on Windows

A MySQL client on Unix can connect to the *note 'mysqld': mysqld. server
in two different ways: By using a Unix socket file to connect through a
file in the file system (default '/tmp/mysql.sock'), or by using TCP/IP,
which connects through a port number.  A Unix socket file connection is
faster than TCP/IP, but can be used only when connecting to a server on
the same computer.  A Unix socket file is used if you do not specify a
host name or if you specify the special host name 'localhost'.

If the MySQL server is running on Windows, you can connect using TCP/IP.
If the server is started with the 'named_pipe' system variable enabled,
you can also connect with named pipes if you run the client on the host
where the server is running.  The name of the named pipe is 'MySQL' by
default.  If you do not give a host name when connecting to *note
'mysqld': mysqld, a MySQL client first tries to connect to the named
pipe.  If that does not work, it connects to the TCP/IP port.  You can
force the use of named pipes on Windows by using '.' as the host name.

The error (2002) 'Can't connect to ...' normally means that there is no
MySQL server running on the system or that you are using an incorrect
Unix socket file name or TCP/IP port number when trying to connect to
the server.  You should also check that the TCP/IP port you are using
has not been blocked by a firewall or port blocking service.

The error (2003) 'Can't connect to MySQL server on 'SERVER' (10061)'
indicates that the network connection has been refused.  You should
check that there is a MySQL server running, that it has network
connections enabled, and that the network port you specified is the one
configured on the server.

Start by checking whether there is a process named *note 'mysqld':
mysqld. running on your server host.  (Use 'ps xa | grep mysqld' on Unix
or the Task Manager on Windows.)  If there is no such process, you
should start the server.  See *note starting-server::.

If a *note 'mysqld': mysqld. process is running, you can check it by
trying the following commands.  The port number or Unix socket file name
might be different in your setup.  'host_ip' represents the IP address
of the machine where the server is running.

     shell> mysqladmin version
     shell> mysqladmin variables
     shell> mysqladmin -h `hostname` version variables
     shell> mysqladmin -h `hostname` --port=3306 version
     shell> mysqladmin -h host_ip version
     shell> mysqladmin --protocol=SOCKET --socket=/tmp/mysql.sock version

Note the use of backticks rather than forward quotation marks with the
'hostname' command; these cause the output of 'hostname' (that is, the
current host name) to be substituted into the *note 'mysqladmin':
mysqladmin. command.  If you have no 'hostname' command or are running
on Windows, you can manually type the host name of your machine (without
backticks) following the '-h' option.  You can also try '-h 127.0.0.1'
to connect with TCP/IP to the local host.

Make sure that the server has not been configured to ignore network
connections or (if you are attempting to connect remotely) that it has
not been configured to listen only locally on its network interfaces.
If the server was started with the 'skip_networking' system variable
enabled, it will not accept TCP/IP connections at all.  If the server
was started with '--bind-address=127.0.0.1', it will listen for TCP/IP
connections only locally on the loopback interface and will not accept
remote connections.

Check to make sure that there is no firewall blocking access to MySQL.
Your firewall may be configured on the basis of the application being
executed, or the port number used by MySQL for communication (3306 by
default).  Under Linux or Unix, check your IP tables (or similar)
configuration to ensure that the port has not been blocked.  Under
Windows, applications such as ZoneAlarm or the Windows XP personal
firewall may need to be configured not to block the MySQL port.

Here are some reasons the 'Can't connect to local MySQL server' error
might occur:

   * *note 'mysqld': mysqld. is not running on the local host.  Check
     your operating system's process list to ensure the *note 'mysqld':
     mysqld. process is present.

   * You're running a MySQL server on Windows with many TCP/IP
     connections to it.  If you're experiencing that quite often your
     clients get that error, you can find a workaround here: *note
     can-not-connect-to-server-on-windows::.

   * Someone has removed the Unix socket file that *note 'mysqld':
     mysqld. uses ('/tmp/mysql.sock' by default).  For example, you
     might have a 'cron' job that removes old files from the '/tmp'
     directory.  You can always run *note 'mysqladmin version':
     mysqladmin. to check whether the Unix socket file that *note
     'mysqladmin': mysqladmin. is trying to use really exists.  The fix
     in this case is to change the 'cron' job to not remove 'mysql.sock'
     or to place the socket file somewhere else.  See *note
     problems-with-mysql-sock::.

   * You have started the *note 'mysqld': mysqld. server with the
     '--socket=/path/to/socket' option, but forgotten to tell client
     programs the new name of the socket file.  If you change the socket
     path name for the server, you must also notify the MySQL clients.
     You can do this by providing the same '--socket' option when you
     run client programs.  You also need to ensure that clients have
     permission to access the 'mysql.sock' file.  To find out where the
     socket file is, you can do:

          shell> netstat -ln | grep mysql

     See *note problems-with-mysql-sock::.

   * You are using Linux and one server thread has died (dumped core).
     In this case, you must kill the other *note 'mysqld': mysqld.
     threads (for example, with *note 'kill': kill. or with the *note
     'mysql_zap': mysql-zap. script) before you can restart the MySQL
     server.  See *note crashing::.

   * The server or client program might not have the proper access
     privileges for the directory that holds the Unix socket file or the
     socket file itself.  In this case, you must either change the
     access privileges for the directory or socket file so that the
     server and clients can access them, or restart *note 'mysqld':
     mysqld. with a '--socket' option that specifies a socket file name
     in a directory where the server can create it and where client
     programs can access it.

If you get the error message 'Can't connect to MySQL server on
some_host', you can try the following things to find out what the
problem is:

   * Check whether the server is running on that host by executing
     'telnet some_host 3306' and pressing the Enter key a couple of
     times.  (3306 is the default MySQL port number.  Change the value
     if your server is listening to a different port.)  If there is a
     MySQL server running and listening to the port, you should get a
     response that includes the server's version number.  If you get an
     error such as 'telnet: Unable to connect to remote host: Connection
     refused', then there is no server running on the given port.

   * If the server is running on the local host, try using *note
     'mysqladmin -h localhost variables': mysqladmin. to connect using
     the Unix socket file.  Verify the TCP/IP port number that the
     server is configured to listen to (it is the value of the 'port'
     variable.)

   * If you are running under Linux and Security-Enhanced Linux
     (SELinux) is enabled, see Set SELinux context for MySQL Server
     (https://dev.mysql.com/doc/refman/5.6/en/can-not-connect-to-server.html#howto-set-selinux-contexts).


File: manual.info.tmp,  Node: howto-set-selinux-context,  Next: can-not-connect-to-server-on-windows,  Prev: can-not-connect-to-server,  Up: can-not-connect-to-server

B.4.2.3 Set SELinux context for MySQL Server
............................................

The MySQL server reads from and writes to many files, and if the SELinux
context is not set correctly on these files then the mysqld process may
block access to MySQL files.  In some cases, this may stop mysqld from
logging errors.

*Required Tools*

The semanage binary is used in this guide to manage context; on
Enterprise Linux it's part of the 'policycoreutils-python' package:

     shell> yum install policycoreutils-python

*Note*:

RHEL 6 with Python 2.6: to use semanage with early versions of RHEL 6
with python 2.6, you may need to install a backport of the OrderedDict
python collection module using python-pip from the EPEL repository.

*List Current MySQL Context*

List them using the following:

     shell> semanage fcontext -l | grep -i mysql

*Set MySQL Data Directory Context*

The default data directory location is '/var/lib/mysql/'; and the
SELinux context used is 'mysqld_db_t'.

If you edit the configuration file to use a different location for the
data directory, or for any of the files normally in the data directory
(such as the binary logs) you may need to set the context for the new
location.  For example:

     shell> semanage fcontext -a -t mysqld_db_t "/path/to/my/custom/datadir(/.*)?"
     shell> restorecon -Rv /path/to/my/custom/datadir

     shell> semanage fcontext -a -t mysqld_db_t "/path/to/my/custom/logdir(/.*)?"
     shell> restorecon -Rv /path/to/my/custom/logdir

*Set MySQL Error Log File Context*

The default location for RedHat RPMs is '/var/log/mysqld.log'; and the
SELinux context used is 'mysqld_log_t'.

If you edit the configuration file to use a different location then you
may need to set the context for the new location.  For example:

     shell> semanage fcontext -a -t mysqld_log_t "/path/to/my/custom/error.log"
     shell> restorecon -Rv /path/to/my/custom/error.log

*Set PID File Context*

The default location for the PID file is '/var/run/mysqld/mysqld.pid';
and the SELinux context used is 'mysqld_var_run_t'.

If you edit the configuration file to use a different location then you
may need to set the context for the new location.  For example:

     shell> semanage fcontext -a -t mysqld_var_run_t "/path/to/my/custom/pidfile/directory/.*?"
     shell> restorecon -Rv /path/to/my/custom/pidfile/directory

*Set unix-domain Socket Context*

The default location for the unix-domain socket is
'/var/lib/mysql/mysql.sock'; and the SELinux context used is
'mysqld_var_run_t'.

If you edit the configuration file to use a different location then you
may need to set the context for the new location.  For example:

     shell> semanage fcontext -a -t mysqld_var_run_t "/path/to/my/custom/mysql\.sock"
     shell> restorecon -Rv /path/to/my/custom/mysql.sock

*Set TCP Port Context*

The default TCP port is '3306'; and the SELinux context used is
'mysqld_port_t'.

If you edit the configuration file to use a different TCP port, or you
enable Group Replication which uses an additional port (typically port
13306), you may need to set the context for the new port.  For example:

     shell> semanage port -a -t mysqld_port_t -p tcp 13306
     shell> restorecon

*Set secure_file_priv Directory Context*

For MySQL versions since 5.5.53, 5.6.34, 5.7.16, and 8.0.11.

Installing the MySQL server RPM creates a '/var/lib/mysql-files/'
directory, but does not set the SELinux context on this directory.  This
directory is intended to be used for operations such as 'SELECT ... INTO
OUTFILE'.

If you enabled the use of this directory by setting 'secure_file_priv',
you may need to set the context like so:

     shell> semanage fcontext -a -t mysqld_db_t "/var/lib/mysql-files/(/.*)?"
     shell> restorecon -Rv /var/lib/mysql-files

Edit this path if you used a different location.  For security purposes,
this directory should never be within the data directory.

For more information about this variable, see the 'secure_file_priv'
documentation.


File: manual.info.tmp,  Node: can-not-connect-to-server-on-windows,  Prev: howto-set-selinux-context,  Up: can-not-connect-to-server

B.4.2.4 Connection to MySQL Server Failing on Windows
.....................................................

When you're running a MySQL server on Windows with many TCP/IP
connections to it, and you're experiencing that quite often your clients
get a 'Can't connect to MySQL server' error, the reason might be that
Windows does not allow for enough ephemeral (short-lived) ports to serve
those connections.

The purpose of 'TIME_WAIT' is to keep a connection accepting packets
even after the connection has been closed.  This is because Internet
routing can cause a packet to take a slow route to its destination and
it may arrive after both sides have agreed to close.  If the port is in
use for a new connection, that packet from the old connection could
break the protocol or compromise personal information from the original
connection.  The 'TIME_WAIT' delay prevents this by ensuring that the
port cannot be reused until after some time has been permitted for those
delayed packets to arrive.

It is safe to reduce 'TIME_WAIT' greatly on LAN connections because
there is little chance of packets arriving at very long delays, as they
could through the Internet with its comparatively large distances and
latencies.

Windows permits ephemeral (short-lived) TCP ports to the user.  After
any port is closed it will remain in a 'TIME_WAIT' status for 120
seconds.  The port will not be available again until this time expires.
The default range of port numbers depends on the version of Windows,
with a more limited number of ports in older versions:

   * Windows through Server 2003: Ports in range 1025-5000

   * Windows Vista, Server 2008, and newer: Ports in range 49152-65535

With a small stack of available TCP ports (5000) and a high number of
TCP ports being open and closed over a short period of time along with
the 'TIME_WAIT' status you have a good chance for running out of ports.
There are two ways to address this problem:

   * Reduce the number of TCP ports consumed quickly by investigating
     connection pooling or persistent connections where possible

   * Tune some settings in the Windows registry (see below)

*Important*:

The following procedure involves modifying the Windows registry.  Before
you modify the registry, make sure to back it up and make sure that you
understand how to restore it if a problem occurs.  For information about
how to back up, restore, and edit the registry, view the following
article in the Microsoft Knowledge Base:
<http://support.microsoft.com/kb/256986/EN-US/>.

  1. Start Registry Editor ('Regedt32.exe').

  2. Locate the following key in the registry:

          HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters

  3. On the 'Edit' menu, click 'Add Value', and then add the following
     registry value:

          Value Name: MaxUserPort
          Data Type: REG_DWORD
          Value: 65534

     This sets the number of ephemeral ports available to any user.  The
     valid range is between 5000 and 65534 (decimal).  The default value
     is 0x1388 (5000 decimal).

  4. On the 'Edit' menu, click 'Add Value', and then add the following
     registry value:

          Value Name: TcpTimedWaitDelay
          Data Type: REG_DWORD
          Value: 30

     This sets the number of seconds to hold a TCP port connection in
     'TIME_WAIT' state before closing.  The valid range is between 30
     and 300 decimal, although you may wish to check with Microsoft for
     the latest permitted values.  The default value is 0x78 (120
     decimal).

  5. Quit Registry Editor.

  6. Reboot the machine.

Note: Undoing the above should be as simple as deleting the registry
entries you've created.


File: manual.info.tmp,  Node: error-lost-connection,  Next: old-client,  Prev: can-not-connect-to-server,  Up: common-errors

B.4.2.5 Lost connection to MySQL server
.......................................

There are three likely causes for this error message.

Usually it indicates network connectivity trouble and you should check
the condition of your network if this error occurs frequently.  If the
error message includes 'during query,' this is probably the case you are
experiencing.

Sometimes the 'during query' form happens when millions of rows are
being sent as part of one or more queries.  If you know that this is
happening, you should try increasing 'net_read_timeout' from its default
of 30 seconds to 60 seconds or longer, sufficient for the data transfer
to complete.

More rarely, it can happen when the client is attempting the initial
connection to the server.  In this case, if your 'connect_timeout' value
is set to only a few seconds, you may be able to resolve the problem by
increasing it to ten seconds, perhaps more if you have a very long
distance or slow connection.  You can determine whether you are
experiencing this more uncommon cause by using 'SHOW GLOBAL STATUS LIKE
'Aborted_connects''.  It will increase by one for each initial
connection attempt that the server aborts.  You may see 'reading
authorization packet' as part of the error message; if so, that also
suggests that this is the solution that you need.

If the cause is none of those just described, you may be experiencing a
problem with *note 'BLOB': blob. values that are larger than
'max_allowed_packet', which can cause this error with some clients.
Sometime you may see an 'ER_NET_PACKET_TOO_LARGE' error, and that
confirms that you need to increase 'max_allowed_packet'.


File: manual.info.tmp,  Node: old-client,  Next: password-too-long,  Prev: error-lost-connection,  Up: common-errors

B.4.2.6 Client does not support authentication protocol
.......................................................

The current implementation of the authentication protocol uses a
password hashing algorithm that is incompatible with that used by older
(pre-4.1) clients.  Attempts to connect to a 4.1 or higher server with
an older client may fail with the following message:

     shell> mysql
     Client does not support authentication protocol requested
     by server; consider upgrading MySQL client

To deal with this problem, the preferred solution is to upgrade all
client programs to use a 4.1.1 or higher client library.  If that is not
possible, use one of the following approaches:

   * To connect to the server with a pre-4.1 client program, use an
     account that still has a pre-4.1-style password.

   * Reset the password to pre-4.1 style for each user that needs to use
     a pre-4.1 client program.  This can be done using the *note 'SET
     PASSWORD': set-password. statement and the 'OLD_PASSWORD()'
     function:

          mysql> SET PASSWORD FOR
              -> 'SOME_USER'@'SOME_HOST' = OLD_PASSWORD('NEW_PASSWORD');

     Substitute the password you want to use for 'NEW_PASSWORD' in the
     preceding example.  MySQL cannot tell you what the original
     password was, so you'll need to pick a new one.

   * Tell the server to use the older password hashing algorithm by
     default:

       1. Start *note 'mysqld': mysqld. with the 'old_passwords' system
          variable set to 1.

       2. Assign an old-format password to each account that has had its
          password updated to the longer 4.1 format.  You can identify
          these accounts with the following query:

               mysql> SELECT Host, User, Password FROM mysql.user
                   -> WHERE LENGTH(Password) > 16;

          For each account record displayed by the query, use the 'Host'
          and 'User' values and assign a password using one of the
          methods described previously.

The 'Client does not support authentication protocol' error also can
occur if multiple versions of MySQL are installed but client programs
are dynamically linked and link to an older library.  Make sure that
clients use the most recent library version with which they are
compatible.  The procedure to do this will depend on your system.

*Note*:

The PHP 'mysql' extension does not support the authentication protocol
in MySQL 4.1.1 and higher.  This is true regardless of the PHP version
being used.  If you wish to use the 'mysql' extension with MySQL 4.1 or
higher, you may need to follow one of the options discussed above for
configuring MySQL to work with old clients.  The 'mysqli' extension
(stands for "MySQL, Improved"; added in PHP 5) is compatible with the
improved password hashing employed in MySQL 4.1 and higher, and no
special configuration of MySQL need be done to use this MySQL client
library.  For more information about the 'mysqli' extension, see
<http://php.net/mysqli>.

For additional background on password hashing and authentication, see
*note password-hashing::.


File: manual.info.tmp,  Node: password-too-long,  Next: blocked-host,  Prev: old-client,  Up: common-errors

B.4.2.7 Password Fails When Entered Interactively
.................................................

MySQL client programs prompt for a password when invoked with a
'--password' or '-p' option that has no following password value:

     shell> mysql -u USER_NAME -p
     Enter password:

On some systems, you may find that your password works when specified in
an option file or on the command line, but not when you enter it
interactively at the 'Enter password:' prompt.  This occurs when the
library provided by the system to read passwords limits password values
to a small number of characters (typically eight).  That is a problem
with the system library, not with MySQL. To work around it, change your
MySQL password to a value that is eight or fewer characters long, or put
your password in an option file.


File: manual.info.tmp,  Node: blocked-host,  Next: too-many-connections,  Prev: password-too-long,  Up: common-errors

B.4.2.8 Host 'host_name' is blocked
...................................

If the following error occurs, it means that *note 'mysqld': mysqld. has
received many connection requests from the given host that were
interrupted in the middle:

     Host 'HOST_NAME' is blocked because of many connection errors.
     Unblock with 'mysqladmin flush-hosts'

The value of the 'max_connect_errors' system variable determines how
many successive interrupted connection requests are permitted.  After
'max_connect_errors' failed requests without a successful connection,
*note 'mysqld': mysqld. assumes that something is wrong (for example,
that someone is trying to break in), and blocks the host from further
connections until you flush the host cache by executing a 'FLUSH HOSTS'
statement or *note 'mysqladmin flush-hosts': mysqladmin. command.

To adjust the permitted number of successive connection errors, set
'max_connect_errors' at server startup.  For example, put these lines in
the server 'my.cnf' file:

     [mysqld]
     max_connect_errors=10000

The value can also be set at runtime:

     SET GLOBAL max_connect_errors=10000;

If you get the 'Host 'HOST_NAME' is blocked' error message for a given
host, you should first verify that there is nothing wrong with TCP/IP
connections from that host.  If you are having network problems, it does
no good to increase the value of 'max_connect_errors'.

For more information about how the host cache works, see *note
host-cache::.


File: manual.info.tmp,  Node: too-many-connections,  Next: out-of-memory,  Prev: blocked-host,  Up: common-errors

B.4.2.9 Too many connections
............................

If clients encounter 'Too many connections' errors when attempting to
connect to the *note 'mysqld': mysqld. server, all available connections
are in use by other clients.

The permitted number of connections is controlled by the
'max_connections' system variable.  The default value is 151 to improve
performance when MySQL is used with the Apache Web server.  To support
more connections, set 'max_connections' to a larger value.

*note 'mysqld': mysqld. actually permits 'max_connections' + 1 client
connections.  The extra connection is reserved for use by accounts that
have the 'SUPER' privilege.  By granting the privilege to administrators
and not to normal users (who should not need it), an administrator who
also has the 'PROCESS' privilege can connect to the server and use *note
'SHOW PROCESSLIST': show-processlist. to diagnose problems even if the
maximum number of unprivileged clients are connected.  See *note
show-processlist::.

For more information about how the server handles client connections,
see *note client-connections::.


File: manual.info.tmp,  Node: out-of-memory,  Next: gone-away,  Prev: too-many-connections,  Up: common-errors

B.4.2.10 Out of memory
......................

If you issue a query using the *note 'mysql': mysql. client program and
receive an error like the following one, it means that *note 'mysql':
mysql. does not have enough memory to store the entire query result:

     mysql: Out of memory at line 42, 'malloc.c'
     mysql: needed 8136 byte (8k), memory in use: 12481367 bytes (12189k)
     ERROR 2008: MySQL client ran out of memory

To remedy the problem, first check whether your query is correct.  Is it
reasonable that it should return so many rows?  If not, correct the
query and try again.  Otherwise, you can invoke *note 'mysql': mysql.
with the '--quick' option.  This causes it to use the *note
'mysql_use_result()': mysql-use-result. C API function to retrieve the
result set, which places less of a load on the client (but more on the
server).


File: manual.info.tmp,  Node: gone-away,  Next: packet-too-large,  Prev: out-of-memory,  Up: common-errors

B.4.2.11 MySQL server has gone away
...................................

This section also covers the related 'Lost connection to server during
query' error.

The most common reason for the 'MySQL server has gone away' error is
that the server timed out and closed the connection.  In this case, you
normally get one of the following error codes (which one you get is
operating system-dependent).

Error Code                Description
                          
'CR_SERVER_GONE_ERROR'    The client couldn't send a question to the
                          server.
                          
'CR_SERVER_LOST'          The client didn't get an error when writing
                          to the server, but it didn't get a full
                          answer (or any answer) to the question.

By default, the server closes the connection after eight hours if
nothing has happened.  You can change the time limit by setting the
'wait_timeout' variable when you start *note 'mysqld': mysqld.  See
*note server-system-variables::.

If you have a script, you just have to issue the query again for the
client to do an automatic reconnection.  This assumes that you have
automatic reconnection in the client enabled (which is the default for
the 'mysql' command-line client).

Some other common reasons for the 'MySQL server has gone away' error
are:

   * You (or the db administrator) has killed the running thread with a
     *note 'KILL': kill. statement or a *note 'mysqladmin kill':
     mysqladmin. command.

   * You tried to run a query after closing the connection to the
     server.  This indicates a logic error in the application that
     should be corrected.

   * A client application running on a different host does not have the
     necessary privileges to connect to the MySQL server from that host.

   * You got a timeout from the TCP/IP connection on the client side.
     This may happen if you have been using the commands: *note
     'mysql_options(..., MYSQL_OPT_READ_TIMEOUT,...)': mysql-options. or
     *note 'mysql_options(..., MYSQL_OPT_WRITE_TIMEOUT,...)':
     mysql-options.  In this case increasing the timeout may help solve
     the problem.

   * You have encountered a timeout on the server side and the automatic
     reconnection in the client is disabled (the 'reconnect' flag in the
     'MYSQL' structure is equal to 0).

   * You are using a Windows client and the server had dropped the
     connection (probably because 'wait_timeout' expired) before the
     command was issued.

     The problem on Windows is that in some cases MySQL does not get an
     error from the OS when writing to the TCP/IP connection to the
     server, but instead gets the error when trying to read the answer
     from the connection.

     The solution to this is to either do a *note 'mysql_ping()':
     mysql-ping. on the connection if there has been a long time since
     the last query (this is what Connector/ODBC does) or set
     'wait_timeout' on the *note 'mysqld': mysqld. server so high that
     it in practice never times out.

   * You can also get these errors if you send a query to the server
     that is incorrect or too large.  If *note 'mysqld': mysqld.
     receives a packet that is too large or out of order, it assumes
     that something has gone wrong with the client and closes the
     connection.  If you need big queries (for example, if you are
     working with big *note 'BLOB': blob. columns), you can increase the
     query limit by setting the server's 'max_allowed_packet' variable,
     which has a default value of 1MB. You may also need to increase the
     maximum packet size on the client end.  More information on setting
     the packet size is given in *note packet-too-large::.

     An *note 'INSERT': insert. or *note 'REPLACE': replace. statement
     that inserts a great many rows can also cause these sorts of
     errors.  Either one of these statements sends a single request to
     the server irrespective of the number of rows to be inserted; thus,
     you can often avoid the error by reducing the number of rows sent
     per *note 'INSERT': insert. or *note 'REPLACE': replace.

   * It is also possible to see this error if host name lookups fail
     (for example, if the DNS server on which your server or network
     relies goes down).  This is because MySQL is dependent on the host
     system for name resolution, but has no way of knowing whether it is
     working--from MySQL's point of view the problem is
     indistinguishable from any other network timeout.

     You may also see the 'MySQL server has gone away' error if MySQL is
     started with the 'skip_networking' system variable enabled.

     Another networking issue that can cause this error occurs if the
     MySQL port (default 3306) is blocked by your firewall, thus
     preventing any connections at all to the MySQL server.

   * You can also encounter this error with applications that fork child
     processes, all of which try to use the same connection to the MySQL
     server.  This can be avoided by using a separate connection for
     each child process.

   * You have encountered a bug where the server died while executing
     the query.

You can check whether the MySQL server died and restarted by executing
*note 'mysqladmin version': mysqladmin. and examining the server's
uptime.  If the client connection was broken because *note 'mysqld':
mysqld. crashed and restarted, you should concentrate on finding the
reason for the crash.  Start by checking whether issuing the query again
kills the server again.  See *note crashing::.

You can obtain more information about lost connections by starting *note
'mysqld': mysqld. with the '--log-warnings=2' option.  This logs some of
the disconnected errors in the 'hostname.err' file.  See *note
error-log::.

If you want to create a bug report regarding this problem, be sure that
you include the following information:

   * Indicate whether the MySQL server died.  You can find information
     about this in the server error log.  See *note crashing::.

   * If a specific query kills *note 'mysqld': mysqld. and the tables
     involved were checked with *note 'CHECK TABLE': check-table. before
     you ran the query, can you provide a reproducible test case?  See
     *note porting::.

   * What is the value of the 'wait_timeout' system variable in the
     MySQL server?  (*note 'mysqladmin variables': mysqladmin. gives you
     the value of this variable.)

   * Have you tried to run *note 'mysqld': mysqld. with the general
     query log enabled to determine whether the problem query appears in
     the log?  (See *note query-log::.)

See also *note communication-errors::, and *note bug-reports::.


File: manual.info.tmp,  Node: packet-too-large,  Next: communication-errors,  Prev: gone-away,  Up: common-errors

B.4.2.12 Packet Too Large
.........................

A communication packet is a single SQL statement sent to the MySQL
server, a single row that is sent to the client, or a binary log event
sent from a master replication server to a slave.

The largest possible packet that can be transmitted to or from a MySQL
5.5 server or client is 1GB.

When a MySQL client or the *note 'mysqld': mysqld. server receives a
packet bigger than 'max_allowed_packet' bytes, it issues an
'ER_NET_PACKET_TOO_LARGE' error and closes the connection.  With some
clients, you may also get a 'Lost connection to MySQL server during
query' error if the communication packet is too large.

Both the client and the server have their own 'max_allowed_packet'
variable, so if you want to handle big packets, you must increase this
variable both in the client and in the server.

If you are using the *note 'mysql': mysql. client program, its default
'max_allowed_packet' variable is 16MB. To set a larger value, start
*note 'mysql': mysql. like this:

     shell> mysql --max_allowed_packet=32M

That sets the packet size to 32MB.

The server's default 'max_allowed_packet' value is 1MB. You can increase
this if the server needs to handle big queries (for example, if you are
working with big *note 'BLOB': blob. columns).  For example, to set the
variable to 16MB, start the server like this:

     shell> mysqld --max_allowed_packet=16M

You can also use an option file to set 'max_allowed_packet'.  For
example, to set the size for the server to 16MB, add the following lines
in an option file:

     [mysqld]
     max_allowed_packet=16M

It is safe to increase the value of this variable because the extra
memory is allocated only when needed.  For example, *note 'mysqld':
mysqld. allocates more memory only when you issue a long query or when
*note 'mysqld': mysqld. must return a large result row.  The small
default value of the variable is a precaution to catch incorrect packets
between the client and server and also to ensure that you do not run out
of memory by using large packets accidentally.

You can also get strange problems with large packets if you are using
large *note 'BLOB': blob. values but have not given *note 'mysqld':
mysqld. access to enough memory to handle the query.  If you suspect
this is the case, try adding 'ulimit -d 256000' to the beginning of the
*note 'mysqld_safe': mysqld-safe. script and restarting *note 'mysqld':
mysqld.


File: manual.info.tmp,  Node: communication-errors,  Next: full-table,  Prev: packet-too-large,  Up: common-errors

B.4.2.13 Communication Errors and Aborted Connections
.....................................................

If connection problems occur such as communication errors or aborted
connections, use these sources of information to diagnose problems:

   * The error log.  See *note error-log::.

   * The general query log.  See *note query-log::.

   * The 'Aborted_XXX' status variables.  See *note
     server-status-variables::.

If you start the server with the '--log-warnings' option, you might find
messages like this in your error log:

     Aborted connection 854 to db: 'employees' user: 'josh'

If a client is unable even to connect, the server increments the
'Aborted_connects' status variable.  Unsuccessful connection attempts
can occur for the following reasons:

   * A client attempts to access a database but has no privileges for
     it.

   * A client uses an incorrect password.

   * A connection packet does not contain the right information.

   * It takes more than 'connect_timeout' seconds to obtain a connect
     packet.  See *note server-system-variables::.

If these kinds of things happen, it might indicate that someone is
trying to break into your server!  If the general query log is enabled,
messages for these types of problems are logged to it.

If a client successfully connects but later disconnects improperly or is
terminated, the server increments the 'Aborted_clients' status variable,
and logs an 'Aborted connection' message to the error log.  The cause
can be any of the following:

   * The client program did not call *note 'mysql_close()': mysql-close.
     before exiting.

   * The client had been sleeping more than 'wait_timeout' or
     'interactive_timeout' seconds without issuing any requests to the
     server.  See *note server-system-variables::.

   * The client program ended abruptly in the middle of a data transfer.

Other reasons for problems with aborted connections or aborted clients:

   * The 'max_allowed_packet' variable value is too small or queries
     require more memory than you have allocated for *note 'mysqld':
     mysqld.  See *note packet-too-large::.

   * Use of Ethernet protocol with Linux, both half and full duplex.
     Some Linux Ethernet drivers have this bug.  You should test for
     this bug by transferring a huge file using FTP between the client
     and server machines.  If a transfer goes in burst-pause-burst-pause
     mode, you are experiencing a Linux duplex syndrome.  Switch the
     duplex mode for both your network card and hub/switch to either
     full duplex or to half duplex and test the results to determine the
     best setting.

   * A problem with the thread library that causes interrupts on reads.

   * Badly configured TCP/IP.

   * Faulty Ethernets, hubs, switches, cables, and so forth.  This can
     be diagnosed properly only by replacing hardware.

See also *note gone-away::.


File: manual.info.tmp,  Node: full-table,  Next: cannot-create,  Prev: communication-errors,  Up: common-errors

B.4.2.14 The table is full
..........................

If a table-full error occurs, it may be that the disk is full or that
the table has reached its maximum size.  The effective maximum table
size for MySQL databases is usually determined by operating system
constraints on file sizes, not by MySQL internal limits.  See *note
table-size-limit::.

This error can occur sometimes for NDB Cluster tables even when there
appears to be more than sufficient data memory available.  See the
documentation for the 'DataMemory' NDB Cluster data node configuration
parameter, as well as *note mysql-cluster-nodes-groups::, for more
information.


File: manual.info.tmp,  Node: cannot-create,  Next: commands-out-of-sync,  Prev: full-table,  Up: common-errors

B.4.2.15 Can't create/write to file
...................................

If you get an error of the following type for some queries, it means
that MySQL cannot create a temporary file for the result set in the
temporary directory:

     Can't create/write to file '\\sqla3fe_0.ism'.

The preceding error is a typical message for Windows; the Unix message
is similar.

One fix is to start *note 'mysqld': mysqld. with the '--tmpdir' option
or to add the option to the '[mysqld]' section of your option file.  For
example, to specify a directory of 'C:\temp', use these lines:

     [mysqld]
     tmpdir=C:/temp

The 'C:\temp' directory must exist and have sufficient space for the
MySQL server to write to.  See *note option-files::.

Another cause of this error can be permissions issues.  Make sure that
the MySQL server can write to the 'tmpdir' directory.

Check also the error code that you get with *note 'perror': perror.  One
reason the server cannot write to a table is that the file system is
full:

     shell> perror 28
     OS error code  28:  No space left on device

If you get an error of the following type during startup, it indicates
that the file system or directory used for storing data files is write
protected.  Provided that the write error is to a test file, the error
is not serious and can be safely ignored.

     Can't create test file /usr/local/mysql/data/master.lower-test


File: manual.info.tmp,  Node: commands-out-of-sync,  Next: ignoring-user,  Prev: cannot-create,  Up: common-errors

B.4.2.16 Commands out of sync
.............................

If you get 'Commands out of sync; you can't run this command now' in
your client code, you are calling client functions in the wrong order.

This can happen, for example, if you are using *note
'mysql_use_result()': mysql-use-result. and try to execute a new query
before you have called *note 'mysql_free_result()': mysql-free-result.
It can also happen if you try to execute two queries that return data
without calling *note 'mysql_use_result()': mysql-use-result. or *note
'mysql_store_result()': mysql-store-result. in between.


File: manual.info.tmp,  Node: ignoring-user,  Next: cannot-find-table,  Prev: commands-out-of-sync,  Up: common-errors

B.4.2.17 Ignoring user
......................

If you get the following error, it means that when *note 'mysqld':
mysqld. was started or when it reloaded the grant tables, it found an
account in the 'user' table that had an invalid password.

'Found wrong password for user 'SOME_USER'@'SOME_HOST'; ignoring user'

As a result, the account is simply ignored by the permission system.

The following list indicates possible causes of and fixes for this
problem:

   * You may be running a new version of *note 'mysqld': mysqld. with an
     old 'user' table.  Check whether the 'Password' column of that
     table is shorter than 16 characters.  If so, correct this condition
     by running *note 'mysql_upgrade': mysql-upgrade.

   * The account has an old password (eight characters long).  Update
     the account in the 'user' table to have a new password.

   * 
     You have specified a password in the 'user' table without using the
     'PASSWORD()' function.  Use *note 'mysql': mysql. to update the
     account in the 'user' table with a new password, making sure to use
     the 'PASSWORD()' function:

          mysql> UPDATE user SET Password=PASSWORD('NEW_PASSWORD')
              -> WHERE User='SOME_USER' AND Host='SOME_HOST';


File: manual.info.tmp,  Node: cannot-find-table,  Next: cannot-initialize-character-set,  Prev: ignoring-user,  Up: common-errors

B.4.2.18 Table 'tbl_name' doesn't exist
.......................................

If you get either of the following errors, it usually means that no
table exists in the default database with the given name:

     Table 'TBL_NAME' doesn't exist
     Can't find file: 'TBL_NAME' (errno: 2)

In some cases, it may be that the table does exist but that you are
referring to it incorrectly:

   * Because MySQL uses directories and files to store databases and
     tables, database and table names are case-sensitive if they are
     located on a file system that has case-sensitive file names.

   * Even for file systems that are not case-sensitive, such as on
     Windows, all references to a given table within a query must use
     the same lettercase.

You can check which tables are in the default database with *note 'SHOW
TABLES': show-tables.  See *note show::.


File: manual.info.tmp,  Node: cannot-initialize-character-set,  Next: not-enough-file-handles,  Prev: cannot-find-table,  Up: common-errors

B.4.2.19 Can't initialize character set
.......................................

You might see an error like this if you have character set problems:

     MySQL Connection Failed: Can't initialize character set CHARSET_NAME

This error can have any of the following causes:

   * The character set is a multibyte character set and you have no
     support for the character set in the client.  In this case, you
     need to recompile the client by running 'CMake' with the
     '-DDEFAULT_CHARSET=CHARSET_NAME' or
     '-DWITH_EXTRA_CHARSETS=CHARSET_NAME' option.  See *note
     source-configuration-options::.

     All standard MySQL binaries are compiled with
     '-DWITH_EXTRA_CHARSETS=all', which enables support for all
     multibyte character sets.  See *note
     source-configuration-options::.

   * The character set is a simple character set that is not compiled
     into *note 'mysqld': mysqld, and the character set definition files
     are not in the place where the client expects to find them.

     In this case, you need to use one of the following methods to solve
     the problem:

        * Recompile the client with support for the character set.  See
          *note source-configuration-options::.

        * Specify to the client the directory where the character set
          definition files are located.  For many clients, you can do
          this with the '--character-sets-dir' option.

        * Copy the character definition files to the path where the
          client expects them to be.


File: manual.info.tmp,  Node: not-enough-file-handles,  Next: table-corruption,  Prev: cannot-initialize-character-set,  Up: common-errors

B.4.2.20 File Not Found and Similar Errors
..........................................

If you get 'ERROR 'FILE_NAME' not found (errno: 23)', 'Can't open file:
FILE_NAME (errno: 24)', or any other error with 'errno 23' or 'errno 24'
from MySQL, it means that you have not allocated enough file descriptors
for the MySQL server.  You can use the *note 'perror': perror. utility
to get a description of what the error number means:

     shell> perror 23
     OS error code  23:  File table overflow
     shell> perror 24
     OS error code  24:  Too many open files
     shell> perror 11
     OS error code  11:  Resource temporarily unavailable

The problem here is that *note 'mysqld': mysqld. is trying to keep open
too many files simultaneously.  You can either tell *note 'mysqld':
mysqld. not to open so many files at once or increase the number of file
descriptors available to *note 'mysqld': mysqld.

To tell *note 'mysqld': mysqld. to keep open fewer files at a time, you
can make the table cache smaller by reducing the value of the
'table_open_cache' system variable (the default value is 64).  This may
not entirely prevent running out of file descriptors because in some
circumstances the server may attempt to extend the cache size
temporarily, as described in *note table-cache::.  Reducing the value of
'max_connections' also reduces the number of open files (the default
value is 100).

To change the number of file descriptors available to *note 'mysqld':
mysqld, you can use the '--open-files-limit' option to *note
'mysqld_safe': mysqld-safe. or set the 'open_files_limit' system
variable.  See *note server-system-variables::.  The easiest way to set
these values is to add an option to your option file.  See *note
option-files::.  If you have an old version of *note 'mysqld': mysqld.
that does not support setting the open files limit, you can edit the
*note 'mysqld_safe': mysqld-safe. script.  There is a commented-out line
'ulimit -n 256' in the script.  You can remove the '#' character to
uncomment this line, and change the number '256' to set the number of
file descriptors to be made available to *note 'mysqld': mysqld.

'--open-files-limit' and 'ulimit' can increase the number of file
descriptors, but only up to the limit imposed by the operating system.
There is also a 'hard' limit that can be overridden only if you start
*note 'mysqld_safe': mysqld-safe. or *note 'mysqld': mysqld. as 'root'
(just remember that you also need to start the server with the '--user'
option in this case so that it does not continue to run as 'root' after
it starts up).  If you need to increase the operating system limit on
the number of file descriptors available to each process, consult the
documentation for your system.

*Note*:

If you run the 'tcsh' shell, 'ulimit' does not work!  'tcsh' also
reports incorrect values when you ask for the current limits.  In this
case, you should start *note 'mysqld_safe': mysqld-safe. using 'sh'.


File: manual.info.tmp,  Node: table-corruption,  Prev: not-enough-file-handles,  Up: common-errors

B.4.2.21 Table-Corruption Issues
................................

If you have started *note 'mysqld': mysqld. with the
'myisam_recover_options' system variable set, MySQL automatically checks
and tries to repair 'MyISAM' tables if they are marked as 'not closed
properly' or 'crashed'.  If this happens, MySQL writes an entry in the
'hostname.err' file ''Warning: Checking table ...'' which is followed by
'Warning: Repairing table' if the table needs to be repaired.  If you
get a lot of these errors, without *note 'mysqld': mysqld. having died
unexpectedly just before, then something is wrong and needs to be
investigated further.

As of MySQL 5.5.3, when the server detects 'MyISAM' table corruption, it
writes additional information to the error log, such as the name and
line number of the source file, and the list of threads accessing the
table.  Example: 'Got an error from thread_id=1, mi_dynrec.c:368'.  This
is useful information to include in bug reports.

See also *note server-options::, and *note reproducible-test-case::.


File: manual.info.tmp,  Node: administration-issues,  Next: query-issues,  Prev: common-errors,  Up: problems

B.4.3 Administration-Related Issues
-----------------------------------

* Menu:

* file-permissions::             Problems with File Permissions
* resetting-permissions::        How to Reset the Root Password
* crashing::                     What to Do If MySQL Keeps Crashing
* full-disk::                    How MySQL Handles a Full Disk
* temporary-files::              Where MySQL Stores Temporary Files
* problems-with-mysql-sock::     How to Protect or Change the MySQL Unix Socket File
* timezone-problems::            Time Zone Problems


File: manual.info.tmp,  Node: file-permissions,  Next: resetting-permissions,  Prev: administration-issues,  Up: administration-issues

B.4.3.1 Problems with File Permissions
......................................

If you have problems with file permissions, the 'UMASK' or 'UMASK_DIR'
environment variable might be set incorrectly when *note 'mysqld':
mysqld. starts.  For example, *note 'mysqld': mysqld. might issue the
following error message when you create a table:

     ERROR: Can't find file: 'path/with/filename.frm' (Errcode: 13)

The default 'UMASK' and 'UMASK_DIR' values are '0660' and '0700',
respectively.  *note 'mysqld': mysqld. assumes that the value for
'UMASK' or 'UMASK_DIR' is in octal if it starts with a zero.  For
example, setting 'UMASK=0600' is equivalent to 'UMASK=384' because 0600
octal is 384 decimal.

Assuming that you start *note 'mysqld': mysqld. using *note
'mysqld_safe': mysqld-safe, change the default 'UMASK' value as follows:

     UMASK=384  # = 600 in octal
     export UMASK
     mysqld_safe &

*Note*:

An exception applies for the error log file if you start *note 'mysqld':
mysqld. using *note 'mysqld_safe': mysqld-safe, which does not respect
'UMASK': *note 'mysqld_safe': mysqld-safe. may create the error log file
if it does not exist prior to starting *note 'mysqld': mysqld, and *note
'mysqld_safe': mysqld-safe. uses a umask set to a strict value of
'0137'.  If this is unsuitable, create the error file manually with the
desired access mode prior to executing *note 'mysqld_safe': mysqld-safe.

By default, *note 'mysqld': mysqld. creates database directories with an
access permission value of '0700'.  To modify this behavior, set the
'UMASK_DIR' variable.  If you set its value, new directories are created
with the combined 'UMASK' and 'UMASK_DIR' values.  For example, to give
group access to all new directories, start *note 'mysqld_safe':
mysqld-safe. as follows:

     UMASK_DIR=504  # = 770 in octal
     export UMASK_DIR
     mysqld_safe &

For additional details, see *note environment-variables::.


File: manual.info.tmp,  Node: resetting-permissions,  Next: crashing,  Prev: file-permissions,  Up: administration-issues

B.4.3.2 How to Reset the Root Password
......................................

* Menu:

* resetting-permissions-windows::  Resetting the Root Password: Windows Systems
* resetting-permissions-unix::   Resetting the Root Password: Unix and Unix-Like Systems
* resetting-permissions-generic::  Resetting the Root Password: Generic Instructions

If you have never assigned a 'root' password for MySQL, the server does
not require a password at all for connecting as 'root'.  However, this
is insecure.  For instructions on assigning passwords, see *note
default-privileges::.

If you know the 'root' password and want to change it, see *note
set-password::.

If you assigned a 'root' password previously but have forgotten it, you
can assign a new password.  The following sections provide instructions
for Windows and Unix and Unix-like systems, as well as generic
instructions that apply to any system.


File: manual.info.tmp,  Node: resetting-permissions-windows,  Next: resetting-permissions-unix,  Prev: resetting-permissions,  Up: resetting-permissions

B.4.3.3 Resetting the Root Password: Windows Systems
....................................................

On Windows, use the following procedure to reset the password for the
MySQL ''root'@'localhost'' account.  To change the password for a 'root'
account with a different host name part, modify the instructions to use
that host name.

  1. Log on to your system as Administrator.

  2. Stop the MySQL server if it is running.  For a server that is
     running as a Windows service, go to the Services manager: From the
     'Start' menu, select 'Control Panel', then 'Administrative Tools',
     then 'Services'.  Find the MySQL service in the list and stop it.

     If your server is not running as a service, you may need to use the
     Task Manager to force it to stop.

  3. Create a text file containing the following statement on a single
     line.  Replace the password with the password that you want to use.

          SET PASSWORD FOR 'root'@'localhost' = PASSWORD('MyNewPass');

  4. Save the file.  This example assumes that you name the file
     'C:\mysql-init.txt'.

  5. Open a console window to get to the command prompt: From the
     'Start' menu, select 'Run', then enter 'cmd' as the command to be
     run.

  6. Start the MySQL server with the 'init_file' system variable set to
     name the file (notice that the backslash in the option value is
     doubled):

          C:\> cd "C:\Program Files\MySQL\MySQL Server 5.5\bin"
          C:\> mysqld --init-file=C:\\mysql-init.txt

     If you installed MySQL to a different location, adjust the 'cd'
     command accordingly.

     The server executes the contents of the file named by the
     'init_file' system variable at startup, changing the
     ''root'@'localhost'' account password.

     To have server output to appear in the console window rather than
     in a log file, add the '--console' option to the *note 'mysqld':
     mysqld. command.

     If you installed MySQL using the MySQL Installation Wizard, you may
     need to specify a '--defaults-file' option.  For example:

          C:\> mysqld
                   --defaults-file="C:\\ProgramData\\MySQL\\MySQL Server 5.5\\my.ini"
                   --init-file=C:\\mysql-init.txt

     The appropriate '--defaults-file' setting can be found using the
     Services Manager: From the 'Start' menu, select 'Control Panel',
     then 'Administrative Tools', then 'Services'.  Find the MySQL
     service in the list, right-click it, and choose the 'Properties'
     option.  The 'Path to executable' field contains the
     '--defaults-file' setting.

  7. After the server has started successfully, delete
     'C:\mysql-init.txt'.

You should now be able to connect to the MySQL server as 'root' using
the new password.  Stop the MySQL server and restart it normally.  If
you run the server as a service, start it from the Windows Services
window.  If you start the server manually, use whatever command you
normally use.


File: manual.info.tmp,  Node: resetting-permissions-unix,  Next: resetting-permissions-generic,  Prev: resetting-permissions-windows,  Up: resetting-permissions

B.4.3.4 Resetting the Root Password: Unix and Unix-Like Systems
...............................................................

On Unix, use the following procedure to reset the password for the MySQL
''root'@'localhost'' account.  To change the password for a 'root'
account with a different host name part, modify the instructions to use
that host name.

The instructions assume that you will start the MySQL server from the
Unix login account that you normally use for running it.  For example,
if you run the server using the 'mysql' login account, you should log in
as 'mysql' before using the instructions.  Alternatively, you can log in
as 'root', but in this case you _must_ start *note 'mysqld': mysqld.
with the '--user=mysql' option.  If you start the server as 'root'
without using '--user=mysql', the server may create 'root'-owned files
in the data directory, such as log files, and these may cause
permission-related problems for future server startups.  If that
happens, you will need to either change the ownership of the files to
'mysql' or remove them.

  1. Log on to your system as the Unix user that the MySQL server runs
     as (for example, 'mysql').

  2. Stop the MySQL server if it is running.  Locate the '.pid' file
     that contains the server's process ID. The exact location and name
     of this file depend on your distribution, host name, and
     configuration.  Common locations are '/var/lib/mysql/',
     '/var/run/mysqld/', and '/usr/local/mysql/data/'.  Generally, the
     file name has an extension of '.pid' and begins with either
     'mysqld' or your system's host name.

     Stop the MySQL server by sending a normal 'kill' (not 'kill -9') to
     the *note 'mysqld': mysqld. process.  Use the actual path name of
     the '.pid' file in the following command:

          shell> kill `cat /mysql-data-directory/host_name.pid`

     Use backticks (not forward quotation marks) with the 'cat' command.
     These cause the output of 'cat' to be substituted into the 'kill'
     command.

  3. Create a text file containing the following statement on a single
     line.  Replace the password with the password that you want to use.

          SET PASSWORD FOR 'root'@'localhost' = PASSWORD('MyNewPass');

  4. Save the file.  This example assumes that you name the file
     '/home/me/mysql-init'.  The file contains the password, so do not
     save it where it can be read by other users.  If you are not logged
     in as 'mysql' (the user the server runs as), make sure that the
     file has permissions that permit 'mysql' to read it.

  5. Start the MySQL server with the 'init_file' system variable set to
     name the file:

          shell> mysqld --init-file=/home/me/mysql-init &

     The server executes the contents of the file named by the
     'init_file' system variable at startup, changing the
     ''root'@'localhost'' account password.

     Other options may be necessary as well, depending on how you
     normally start your server.  For example, '--defaults-file' may be
     needed before the 'init_file' argument.

  6. After the server has started successfully, delete
     '/home/me/mysql-init'.

You should now be able to connect to the MySQL server as 'root' using
the new password.  Stop the server and restart it normally.


File: manual.info.tmp,  Node: resetting-permissions-generic,  Prev: resetting-permissions-unix,  Up: resetting-permissions

B.4.3.5 Resetting the Root Password: Generic Instructions
.........................................................

The preceding sections provide password-resetting instructions
specifically for Windows and Unix and Unix-like systems.  Alternatively,
on any platform, you can reset the password using the *note 'mysql':
mysql. client (but this approach is less secure):

  1. Stop the MySQL server if necessary, then restart it with the
     '--skip-grant-tables' option.  This enables anyone to connect
     without a password and with all privileges, and disables
     account-management statements such as *note 'SET PASSWORD':
     set-password.  Because this is insecure, you might want to use
     '--skip-grant-tables' in conjunction with enabling the
     'skip_networking' system variable to prevent remote clients from
     connecting.

  2. Connect to the MySQL server using the *note 'mysql': mysql. client;
     no password is necessary because the server was started with
     '--skip-grant-tables':

          shell> mysql

  3. In the 'mysql' client, tell the server to reload the grant tables
     so that account-management statements work:

          mysql> FLUSH PRIVILEGES;

     Then change the ''root'@'localhost'' account password.  Replace the
     password with the password that you want to use.  To change the
     password for a 'root' account with a different host name part,
     modify the instructions to use that host name.

          mysql> SET PASSWORD FOR 'root'@'localhost' = PASSWORD('MyNewPass');

You should now be able to connect to the MySQL server as 'root' using
the new password.  Stop the server and restart it normally (without the
'--skip-grant-tables' option and without enabling the 'skip_networking'
system variable).


File: manual.info.tmp,  Node: crashing,  Next: full-disk,  Prev: resetting-permissions,  Up: administration-issues

B.4.3.6 What to Do If MySQL Keeps Crashing
..........................................

Each MySQL version is tested on many platforms before it is released.
This does not mean that there are no bugs in MySQL, but if there are
bugs, they should be very few and can be hard to find.  If you have a
problem, it always helps if you try to find out exactly what crashes
your system, because you have a much better chance of getting the
problem fixed quickly.

First, you should try to find out whether the problem is that the *note
'mysqld': mysqld. server dies or whether your problem has to do with
your client.  You can check how long your *note 'mysqld': mysqld. server
has been up by executing *note 'mysqladmin version': mysqladmin.  If
*note 'mysqld': mysqld. has died and restarted, you may find the reason
by looking in the server's error log.  See *note error-log::.

On some systems, you can find in the error log a stack trace of where
*note 'mysqld': mysqld. died that you can resolve with the
'resolve_stack_dump' program.  See *note porting::.  Note that the
variable values written in the error log may not always be 100% correct.

Many server crashes are caused by corrupted data files or index files.
MySQL updates the files on disk with the 'write()' system call after
every SQL statement and before the client is notified about the result.
(This is not true if you are running with the 'delay_key_write' system
variable enabled, in which case data files are written but not index
files.)  This means that data file contents are safe even if *note
'mysqld': mysqld. crashes, because the operating system ensures that the
unflushed data is written to disk.  You can force MySQL to flush
everything to disk after every SQL statement by starting *note 'mysqld':
mysqld. with the '--flush' option.

The preceding means that normally you should not get corrupted tables
unless one of the following happens:

   * The MySQL server or the server host was killed in the middle of an
     update.

   * You have found a bug in *note 'mysqld': mysqld. that caused it to
     die in the middle of an update.

   * Some external program is manipulating data files or index files at
     the same time as *note 'mysqld': mysqld. without locking the table
     properly.

   * You are running many *note 'mysqld': mysqld. servers using the same
     data directory on a system that does not support good file system
     locks (normally handled by the 'lockd' lock manager), or you are
     running multiple servers with external locking disabled.

   * You have a crashed data file or index file that contains very
     corrupt data that confused *note 'mysqld': mysqld.

   * You have found a bug in the data storage code.  This isn't likely,
     but it is at least possible.  In this case, you can try to change
     the storage engine to another engine by using *note 'ALTER TABLE':
     alter-table. on a repaired copy of the table.

Because it is very difficult to know why something is crashing, first
try to check whether things that work for others crash for you.  Please
try the following things:

   * Stop the *note 'mysqld': mysqld. server with *note 'mysqladmin
     shutdown': mysqladmin, run *note 'myisamchk --silent --force
     */*.MYI': myisamchk. from the data directory to check all 'MyISAM'
     tables, and restart *note 'mysqld': mysqld.  This ensures that you
     are running from a clean state.  See *note server-administration::.

   * Start *note 'mysqld': mysqld. with the general query log enabled
     (see *note query-log::).  Then try to determine from the
     information written to the log whether some specific query kills
     the server.  About 95% of all bugs are related to a particular
     query.  Normally, this is one of the last queries in the log file
     just before the server restarts.  See *note query-log::.  If you
     can repeatedly kill MySQL with a specific query, even when you have
     checked all tables just before issuing it, then you have been able
     to locate the bug and should submit a bug report for it.  See *note
     bug-reports::.

   * Try to make a test case that we can use to repeat the problem.  See
     *note porting::.

   * Try the 'fork_big.pl' script.  (It is located in the 'tests'
     directory of source distributions.)

   * If you configure MySQL for debugging, it is much easier to gather
     information about possible errors if something goes wrong.
     Reconfigure MySQL with the '-DWITH_DEBUG=1' option to 'CMake' and
     then recompile.  See *note porting::.

   * Make sure that you have applied the latest patches for your
     operating system.

   * Use the '--skip-external-locking' option to *note 'mysqld': mysqld.
     On some systems, the 'lockd' lock manager does not work properly;
     the '--skip-external-locking' option tells *note 'mysqld': mysqld.
     not to use external locking.  (This means that you cannot run two
     *note 'mysqld': mysqld. servers on the same data directory and that
     you must be careful if you use *note 'myisamchk': myisamchk.
     Nevertheless, it may be instructive to try the option as a test.)

   * Have you tried *note 'mysqladmin -u root processlist': mysqladmin.
     when *note 'mysqld': mysqld. appears to be running but not
     responding?  Sometimes *note 'mysqld': mysqld. is not comatose even
     though you might think so.  The problem may be that all connections
     are in use, or there may be some internal lock problem.  *note
     'mysqladmin -u root processlist': mysqladmin. usually is able to
     make a connection even in these cases, and can provide useful
     information about the current number of connections and their
     status.

   * Run the command *note 'mysqladmin -i 5 status': mysqladmin. or
     *note 'mysqladmin -i 5 -r status': mysqladmin. in a separate window
     to produce statistics while you run your other queries.

   * Try the following:

       1. Start *note 'mysqld': mysqld. from 'gdb' (or another
          debugger).  See *note porting::.

       2. Run your test scripts.

       3. Print the backtrace and the local variables at the three
          lowest levels.  In 'gdb', you can do this with the following
          commands when *note 'mysqld': mysqld. has crashed inside
          'gdb':

               backtrace
               info local
               up
               info local
               up
               info local

          With 'gdb', you can also examine which threads exist with
          'info threads' and switch to a specific thread with 'thread
          N', where N is the thread ID.

   * Try to simulate your application with a Perl script to force MySQL
     to crash or misbehave.

   * Send a normal bug report.  See *note bug-reports::.  Be even more
     detailed than usual.  Because MySQL works for many people, it may
     be that the crash results from something that exists only on your
     computer (for example, an error that is related to your particular
     system libraries).

   * If you have a problem with tables containing dynamic-length rows
     and you are using only *note 'VARCHAR': char. columns (not *note
     'BLOB': blob. or *note 'TEXT': blob. columns), you can try to
     change all *note 'VARCHAR': char. to *note 'CHAR': char. with *note
     'ALTER TABLE': alter-table.  This forces MySQL to use fixed-size
     rows.  Fixed-size rows take a little extra space, but are much more
     tolerant to corruption.

     The current dynamic row code has been in use for several years with
     very few problems, but dynamic-length rows are by nature more prone
     to errors, so it may be a good idea to try this strategy to see
     whether it helps.

   * Do not rule out your server hardware when diagnosing problems.
     Defective hardware can be the cause of data corruption.  Particular
     attention should be paid to your memory and disk subsystems when
     troubleshooting hardware.


File: manual.info.tmp,  Node: full-disk,  Next: temporary-files,  Prev: crashing,  Up: administration-issues

B.4.3.7 How MySQL Handles a Full Disk
.....................................

This section describes how MySQL responds to disk-full errors (such as
'no space left on device'), and to quota-exceeded errors (such as 'write
failed' or 'user block limit reached').

This section is relevant for writes to 'MyISAM' tables.  It also applies
for writes to binary log files and binary log index file, except that
references to 'row' and 'record' should be understood to mean 'event.'

When a disk-full condition occurs, MySQL does the following:

   * It checks once every minute to see whether there is enough space to
     write the current row.  If there is enough space, it continues as
     if nothing had happened.

   * Every 10 minutes it writes an entry to the log file, warning about
     the disk-full condition.

To alleviate the problem, you can take the following actions:

   * To continue, you only have to free enough disk space to insert all
     records.

   * To abort the thread, you must use *note 'mysqladmin kill':
     mysqladmin.  The thread is aborted the next time it checks the disk
     (in one minute).

   * Other threads might be waiting for the table that caused the
     disk-full condition.  If you have several 'locked' threads, killing
     the one thread that is waiting on the disk-full condition enables
     the other threads to continue.

Exceptions to the preceding behavior are when you use *note 'REPAIR
TABLE': repair-table. or *note 'OPTIMIZE TABLE': optimize-table. or when
the indexes are created in a batch after *note 'LOAD DATA': load-data.
or after an *note 'ALTER TABLE': alter-table. statement.  All of these
statements may create large temporary files that, if left to themselves,
would cause big problems for the rest of the system.  If the disk
becomes full while MySQL is doing any of these operations, it removes
the big temporary files and mark the table as crashed.  The exception is
that for *note 'ALTER TABLE': alter-table, the old table is left
unchanged.


File: manual.info.tmp,  Node: temporary-files,  Next: problems-with-mysql-sock,  Prev: full-disk,  Up: administration-issues

B.4.3.8 Where MySQL Stores Temporary Files
..........................................

On Unix, MySQL uses the value of the 'TMPDIR' environment variable as
the path name of the directory in which to store temporary files.  If
'TMPDIR' is not set, MySQL uses the system default, which is usually
'/tmp', '/var/tmp', or '/usr/tmp'.

On Windows, MySQL checks in order the values of the 'TMPDIR', 'TEMP',
and 'TMP' environment variables.  For the first one found to be set,
MySQL uses it and does not check those remaining.  If none of 'TMPDIR',
'TEMP', or 'TMP' are set, MySQL uses the Windows system default, which
is usually 'C:\windows\temp\'.

If the file system containing your temporary file directory is too
small, you can use the *note 'mysqld': mysqld. '--tmpdir' option to
specify a directory in a file system where you have enough space.  On
replication slaves, you can use the 'slave_load_tmpdir' system variable
to specify a separate directory for holding temporary files when
replicating *note 'LOAD DATA': load-data. statements.

The '--tmpdir' option can be set to a list of several paths that are
used in round-robin fashion.  Paths should be separated by colon
characters (':') on Unix and semicolon characters (';') on Windows.

*Note*:

To spread the load effectively, these paths should be located on
different _physical_ disks, not different partitions of the same disk.

If the MySQL server is acting as a replication slave, you should be sure
to set 'slave_load_tmpdir' not to point to a directory that is on a
memory-based file system or to a directory that is cleared when the
server host restarts.  A replication slave needs some of its temporary
files to survive a machine restart so that it can replicate temporary
tables or *note 'LOAD DATA': load-data. operations.  If files in the
slave temporary file directory are lost when the server restarts,
replication fails.

MySQL arranges that temporary files are removed if *note 'mysqld':
mysqld. is terminated.  On platforms that support it (such as Unix),
this is done by unlinking the file after opening it.  The disadvantage
of this is that the name does not appear in directory listings and you
do not see a big temporary file that fills up the file system in which
the temporary file directory is located.  (In such cases, 'lsof +L1' may
be helpful in identifying large files associated with *note 'mysqld':
mysqld.)

When sorting ('ORDER BY' or 'GROUP BY'), MySQL normally uses one or two
temporary files.  The maximum disk space required is determined by the
following expression:

     (length of what is sorted + sizeof(row pointer))
     * number of matched rows
     * 2

The row pointer size is usually four bytes, but may grow in the future
for really big tables.

For some statements, MySQL creates temporary SQL tables that are not
hidden and have names that begin with '#sql'.

Some *note 'SELECT': select. queries creates temporary SQL tables to
hold intermediate results.

*note 'ALTER TABLE': alter-table. creates a temporary copy of the
original table in the same directory as the original table.

See also *note innodb-orphan-temporary-tables::.


File: manual.info.tmp,  Node: problems-with-mysql-sock,  Next: timezone-problems,  Prev: temporary-files,  Up: administration-issues

B.4.3.9 How to Protect or Change the MySQL Unix Socket File
...........................................................

The default location for the Unix socket file that the server uses for
communication with local clients is '/tmp/mysql.sock'.  (For some
distribution formats, the directory might be different, such as
'/var/lib/mysql' for RPMs.)

On some versions of Unix, anyone can delete files in the '/tmp'
directory or other similar directories used for temporary files.  If the
socket file is located in such a directory on your system, this might
cause problems.

On most versions of Unix, you can protect your '/tmp' directory so that
files can be deleted only by their owners or the superuser ('root').  To
do this, set the 'sticky' bit on the '/tmp' directory by logging in as
'root' and using the following command:

     shell> chmod +t /tmp

You can check whether the 'sticky' bit is set by executing 'ls -ld
/tmp'.  If the last permission character is 't', the bit is set.

Another approach is to change the place where the server creates the
Unix socket file.  If you do this, you should also let client programs
know the new location of the file.  You can specify the file location in
several ways:

   * Specify the path in a global or local option file.  For example,
     put the following lines in '/etc/my.cnf':

          [mysqld]
          socket=/path/to/socket

          [client]
          socket=/path/to/socket

     See *note option-files::.

   * Specify a '--socket' option on the command line to *note
     'mysqld_safe': mysqld-safe. and when you run client programs.

   * Set the 'MYSQL_UNIX_PORT' environment variable to the path of the
     Unix socket file.

   * Recompile MySQL from source to use a different default Unix socket
     file location.  Define the path to the file with the
     'MYSQL_UNIX_ADDR' option when you run 'CMake'.  See *note
     source-configuration-options::.

You can test whether the new socket location works by attempting to
connect to the server with this command:

     shell> mysqladmin --socket=/path/to/socket version


File: manual.info.tmp,  Node: timezone-problems,  Prev: problems-with-mysql-sock,  Up: administration-issues

B.4.3.10 Time Zone Problems
...........................

If you have a problem with 'SELECT NOW()' returning values in UTC and
not your local time, you have to tell the server your current time zone.
The same applies if 'UNIX_TIMESTAMP()' returns the wrong value.  This
should be done for the environment in which the server runs (for
example, in *note 'mysqld_safe': mysqld-safe. or *note 'mysql.server':
mysql-server.).  See *note environment-variables::.

You can set the time zone for the server with the
'--timezone=TIMEZONE_NAME' option to *note 'mysqld_safe': mysqld-safe.
You can also set it by setting the 'TZ' environment variable before you
start *note 'mysqld': mysqld.

The permissible values for '--timezone' or 'TZ' are system dependent.
Consult your operating system documentation to see what values are
acceptable.


File: manual.info.tmp,  Node: query-issues,  Next: optimizer-issues,  Prev: administration-issues,  Up: problems

B.4.4 Query-Related Issues
--------------------------

* Menu:

* case-sensitivity::             Case Sensitivity in String Searches
* using-date::                   Problems Using DATE Columns
* problems-with-null::           Problems with NULL Values
* problems-with-alias::          Problems with Column Aliases
* nontransactional-tables::      Rollback Failure for Nontransactional Tables
* deleting-from-related-tables::  Deleting Rows from Related Tables
* no-matching-rows::             Solving Problems with No Matching Rows
* problems-with-float::          Problems with Floating-Point Values


File: manual.info.tmp,  Node: case-sensitivity,  Next: using-date,  Prev: query-issues,  Up: query-issues

B.4.4.1 Case Sensitivity in String Searches
...........................................

For nonbinary strings (*note 'CHAR': char, *note 'VARCHAR': char, *note
'TEXT': blob.), string searches use the collation of the comparison
operands.  For binary strings (*note 'BINARY': binary-varbinary, *note
'VARBINARY': binary-varbinary, *note 'BLOB': blob.), comparisons use the
numeric values of the bytes in the operands; this means that for
alphabetic characters, comparisons will be case-sensitive.

A comparison between a nonbinary string and binary string is treated as
a comparison of binary strings.

Simple comparison operations ('>=, >, =, <, <=', sorting, and grouping)
are based on each character's 'sort value.' Characters with the same
sort value are treated as the same character.  For example, if 'e' and
'e'' have the same sort value in a given collation, they compare as
equal.

The default character set and collation are 'latin1' and
'latin1_swedish_ci', so nonbinary string comparisons are
case-insensitive by default.  This means that if you search with
'COL_NAME LIKE 'a%'', you get all column values that start with 'A' or
'a'.  To make this search case-sensitive, make sure that one of the
operands has a case-sensitive or binary collation.  For example, if you
are comparing a column and a string that both have the 'latin1'
character set, you can use the 'COLLATE' operator to cause either
operand to have the 'latin1_general_cs' or 'latin1_bin' collation:

     COL_NAME COLLATE latin1_general_cs LIKE 'a%'
     COL_NAME LIKE 'a%' COLLATE latin1_general_cs
     COL_NAME COLLATE latin1_bin LIKE 'a%'
     COL_NAME LIKE 'a%' COLLATE latin1_bin

If you want a column always to be treated in case-sensitive fashion,
declare it with a case-sensitive or binary collation.  See *note
create-table::.

To cause a case-sensitive comparison of nonbinary strings to be
case-insensitive, use 'COLLATE' to name a case-insensitive collation.
The strings in the following example normally are case-sensitive, but
'COLLATE' changes the comparison to be case-insensitive:

     mysql> SET @s1 = 'MySQL' COLLATE latin1_bin,
         ->     @s2 = 'mysql' COLLATE latin1_bin;
     mysql> SELECT @s1 = @s2;
     +-----------+
     | @s1 = @s2 |
     +-----------+
     |         0 |
     +-----------+
     mysql> SELECT @s1 COLLATE latin1_swedish_ci = @s2;
     +-------------------------------------+
     | @s1 COLLATE latin1_swedish_ci = @s2 |
     +-------------------------------------+
     |                                   1 |
     +-------------------------------------+

A binary string is case-sensitive in comparisons.  To compare the string
as case-insensitive, convert it to a nonbinary string and use 'COLLATE'
to name a case-insensitive collation:

     mysql> SET @s = BINARY 'MySQL';
     mysql> SELECT @s = 'mysql';
     +--------------+
     | @s = 'mysql' |
     +--------------+
     |            0 |
     +--------------+
     mysql> SELECT CONVERT(@s USING latin1) COLLATE latin1_swedish_ci = 'mysql';
     +--------------------------------------------------------------+
     | CONVERT(@s USING latin1) COLLATE latin1_swedish_ci = 'mysql' |
     +--------------------------------------------------------------+
     |                                                            1 |
     +--------------------------------------------------------------+

To determine whether a value will compare as a nonbinary or binary
string, use the 'COLLATION()' function.  This example shows that
'VERSION()' returns a string that has a case-insensitive collation, so
comparisons are case-insensitive:

     mysql> SELECT COLLATION(VERSION());
     +----------------------+
     | COLLATION(VERSION()) |
     +----------------------+
     | utf8_general_ci      |
     +----------------------+

For binary strings, the collation value is 'binary', so comparisons will
be case-sensitive.  One context in which you will see 'binary' is for
compression functions, which return binary strings as a general rule:
string:

     mysql> SELECT COLLATION(COMPRESS('x'));
     +--------------------------+
     | COLLATION(COMPRESS('x')) |
     +--------------------------+
     | binary                   |
     +--------------------------+


File: manual.info.tmp,  Node: using-date,  Next: problems-with-null,  Prev: case-sensitivity,  Up: query-issues

B.4.4.2 Problems Using DATE Columns
...................................

The format of a *note 'DATE': datetime. value is ''YYYY-MM-DD''.
According to standard SQL, no other format is permitted.  You should use
this format in *note 'UPDATE': update. expressions and in the 'WHERE'
clause of *note 'SELECT': select. statements.  For example:

     SELECT * FROM t1 WHERE date >= '2003-05-05';

As a convenience, MySQL automatically converts a date to a number if the
date is used in numeric context and vice versa.  MySQL also permits a
'relaxed' string format when updating and in a 'WHERE' clause that
compares a date to a *note 'DATE': datetime, *note 'DATETIME': datetime,
or *note 'TIMESTAMP': datetime. column.  'Relaxed' format means that any
punctuation character may be used as the separator between parts.  For
example, ''2004-08-15'' and ''2004#08#15'' are equivalent.  MySQL can
also convert a string containing no separators (such as ''20040815''),
provided it makes sense as a date.

When you compare a *note 'DATE': datetime, *note 'TIME': time, *note
'DATETIME': datetime, or *note 'TIMESTAMP': datetime. to a constant
string with the '<', '<=', '=', '>=', '>', or 'BETWEEN' operators, MySQL
normally converts the string to an internal long integer for faster
comparison (and also for a bit more 'relaxed' string checking).
However, this conversion is subject to the following exceptions:

   * When you compare two columns

   * When you compare a *note 'DATE': datetime, *note 'TIME': time,
     *note 'DATETIME': datetime, or *note 'TIMESTAMP': datetime. column
     to an expression

   * When you use any comparison method other than those just listed,
     such as 'IN' or 'STRCMP()'.

For those exceptions, the comparison is done by converting the objects
to strings and performing a string comparison.

To be on the safe side, assume that strings are compared as strings and
use the appropriate string functions if you want to compare a temporal
value to a string.

The special 'zero' date ''0000-00-00'' can be stored and retrieved as
''0000-00-00'.' When a ''0000-00-00'' date is used through
Connector/ODBC, it is automatically converted to 'NULL' because ODBC
cannot handle that kind of date.

Because MySQL performs the conversions just described, the following
statements work (assume that 'idate' is a *note 'DATE': datetime.
column):

     INSERT INTO t1 (idate) VALUES (19970505);
     INSERT INTO t1 (idate) VALUES ('19970505');
     INSERT INTO t1 (idate) VALUES ('97-05-05');
     INSERT INTO t1 (idate) VALUES ('1997.05.05');
     INSERT INTO t1 (idate) VALUES ('1997 05 05');
     INSERT INTO t1 (idate) VALUES ('0000-00-00');

     SELECT idate FROM t1 WHERE idate >= '1997-05-05';
     SELECT idate FROM t1 WHERE idate >= 19970505;
     SELECT MOD(idate,100) FROM t1 WHERE idate >= 19970505;
     SELECT idate FROM t1 WHERE idate >= '19970505';

However, the following statement does not work:

     SELECT idate FROM t1 WHERE STRCMP(idate,'20030505')=0;

'STRCMP()' is a string function, so it converts 'idate' to a string in
''YYYY-MM-DD'' format and performs a string comparison.  It does not
convert ''20030505'' to the date ''2003-05-05'' and perform a date
comparison.

If you enable the 'ALLOW_INVALID_DATES' SQL mode, MySQL permits you to
store dates that are given only limited checking: MySQL requires only
that the day is in the range from 1 to 31 and the month is in the range
from 1 to 12.  This makes MySQL very convenient for Web applications
where you obtain year, month, and day in three different fields and you
want to store exactly what the user inserted (without date validation).

MySQL permits you to store dates where the day or month and day are
zero.  This is convenient if you want to store a birthdate in a *note
'DATE': datetime. column and you know only part of the date.  To
disallow zero month or day parts in dates, enable the 'NO_ZERO_IN_DATE'
SQL mode.

MySQL permits you to store a 'zero' value of ''0000-00-00'' as a 'dummy
date.' This is in some cases more convenient than using 'NULL' values.
If a date to be stored in a *note 'DATE': datetime. column cannot be
converted to any reasonable value, MySQL stores ''0000-00-00''.  To
disallow ''0000-00-00'', enable the 'NO_ZERO_DATE' SQL mode.

To have MySQL check all dates and accept only legal dates (unless
overridden by 'IGNORE'), set the 'sql_mode' system variable to
'"NO_ZERO_IN_DATE,NO_ZERO_DATE"'.


File: manual.info.tmp,  Node: problems-with-null,  Next: problems-with-alias,  Prev: using-date,  Up: query-issues

B.4.4.3 Problems with NULL Values
.................................

The concept of the 'NULL' value is a common source of confusion for
newcomers to SQL, who often think that 'NULL' is the same thing as an
empty string ''''.  This is not the case.  For example, the following
statements are completely different:

     mysql> INSERT INTO my_table (phone) VALUES (NULL);
     mysql> INSERT INTO my_table (phone) VALUES ('');

Both statements insert a value into the 'phone' column, but the first
inserts a 'NULL' value and the second inserts an empty string.  The
meaning of the first can be regarded as 'phone number is not known' and
the meaning of the second can be regarded as 'the person is known to
have no phone, and thus no phone number.'

To help with 'NULL' handling, you can use the 'IS NULL' and 'IS NOT
NULL' operators and the 'IFNULL()' function.

In SQL, the 'NULL' value is never true in comparison to any other value,
even 'NULL'.  An expression that contains 'NULL' always produces a
'NULL' value unless otherwise indicated in the documentation for the
operators and functions involved in the expression.  All columns in the
following example return 'NULL':

     mysql> SELECT NULL, 1+NULL, CONCAT('Invisible',NULL);

To search for column values that are 'NULL', you cannot use an 'expr =
NULL' test.  The following statement returns no rows, because 'expr =
NULL' is never true for any expression:

     mysql> SELECT * FROM my_table WHERE phone = NULL;

To look for 'NULL' values, you must use the 'IS NULL' test.  The
following statements show how to find the 'NULL' phone number and the
empty phone number:

     mysql> SELECT * FROM my_table WHERE phone IS NULL;
     mysql> SELECT * FROM my_table WHERE phone = '';

See *note working-with-null::, for additional information and examples.

You can add an index on a column that can have 'NULL' values if you are
using the 'MyISAM', 'InnoDB', or 'MEMORY' storage engine.  Otherwise,
you must declare an indexed column 'NOT NULL', and you cannot insert
'NULL' into the column.

When reading data with *note 'LOAD DATA': load-data, empty or missing
columns are updated with ''''.  To load a 'NULL' value into a column,
use '\N' in the data file.  The literal word 'NULL' may also be used
under some circumstances.  See *note load-data::.

When using 'DISTINCT', 'GROUP BY', or 'ORDER BY', all 'NULL' values are
regarded as equal.

When using 'ORDER BY', 'NULL' values are presented first, or last if you
specify 'DESC' to sort in descending order.

Aggregate (summary) functions such as 'COUNT()', 'MIN()', and 'SUM()'
ignore 'NULL' values.  The exception to this is 'COUNT(*)', which counts
rows and not individual column values.  For example, the following
statement produces two counts.  The first is a count of the number of
rows in the table, and the second is a count of the number of non-'NULL'
values in the 'age' column:

     mysql> SELECT COUNT(*), COUNT(age) FROM person;

For some data types, MySQL handles 'NULL' values specially.  If you
insert 'NULL' into a *note 'TIMESTAMP': datetime. column, the current
date and time is inserted.  If you insert 'NULL' into an integer or
floating-point column that has the 'AUTO_INCREMENT' attribute, the next
number in the sequence is inserted.


File: manual.info.tmp,  Node: problems-with-alias,  Next: nontransactional-tables,  Prev: problems-with-null,  Up: query-issues

B.4.4.4 Problems with Column Aliases
....................................

An alias can be used in a query select list to give a column a different
name.  You can use the alias in 'GROUP BY', 'ORDER BY', or 'HAVING'
clauses to refer to the column:

     SELECT SQRT(a*b) AS root FROM TBL_NAME
       GROUP BY root HAVING root > 0;
     SELECT id, COUNT(*) AS cnt FROM TBL_NAME
       GROUP BY id HAVING cnt > 0;
     SELECT id AS 'Customer identity' FROM TBL_NAME;

Standard SQL disallows references to column aliases in a 'WHERE' clause.
This restriction is imposed because when the 'WHERE' clause is
evaluated, the column value may not yet have been determined.  For
example, the following query is illegal:

     SELECT id, COUNT(*) AS cnt FROM TBL_NAME
       WHERE cnt > 0 GROUP BY id;

The 'WHERE' clause determines which rows should be included in the
'GROUP BY' clause, but it refers to the alias of a column value that is
not known until after the rows have been selected, and grouped by the
'GROUP BY'.

In the select list of a query, a quoted column alias can be specified
using identifier or string quoting characters:

     SELECT 1 AS `one`, 2 AS 'two';

Elsewhere in the statement, quoted references to the alias must use
identifier quoting or the reference is treated as a string literal.  For
example, this statement groups by the values in column 'id', referenced
using the alias '`a`':

     SELECT id AS 'a', COUNT(*) AS cnt FROM TBL_NAME
       GROUP BY `a`;

But this statement groups by the literal string ''a'' and will not work
as expected:

     SELECT id AS 'a', COUNT(*) AS cnt FROM TBL_NAME
       GROUP BY 'a';


File: manual.info.tmp,  Node: nontransactional-tables,  Next: deleting-from-related-tables,  Prev: problems-with-alias,  Up: query-issues

B.4.4.5 Rollback Failure for Nontransactional Tables
....................................................

If you receive the following message when trying to perform a *note
'ROLLBACK': commit, it means that one or more of the tables you used in
the transaction do not support transactions:

     Warning: Some non-transactional changed tables couldn't be rolled back

These nontransactional tables are not affected by the *note 'ROLLBACK':
commit. statement.

If you were not deliberately mixing transactional and nontransactional
tables within the transaction, the most likely cause for this message is
that a table you thought was transactional actually is not.  This can
happen if you try to create a table using a transactional storage engine
that is not supported by your *note 'mysqld': mysqld. server (or that
was disabled with a startup option).  If *note 'mysqld': mysqld. does
not support a storage engine, it instead creates the table as a 'MyISAM'
table, which is nontransactional.

You can check the storage engine for a table by using either of these
statements:

     SHOW TABLE STATUS LIKE 'TBL_NAME';
     SHOW CREATE TABLE TBL_NAME;

See *note show-table-status::, and *note show-create-table::.

You can check which storage engines your *note 'mysqld': mysqld. server
supports by using this statement:

     SHOW ENGINES;

You can also use the following statement, and check the value of the
variable that is associated with the storage engine in which you are
interested:

     SHOW VARIABLES LIKE 'have_%';

For example, to determine whether the 'InnoDB' storage engine is
available, check the value of the 'have_innodb' variable.

See *note show-engines::, and *note show-variables::.


File: manual.info.tmp,  Node: deleting-from-related-tables,  Next: no-matching-rows,  Prev: nontransactional-tables,  Up: query-issues

B.4.4.6 Deleting Rows from Related Tables
.........................................

If the total length of the *note 'DELETE': delete. statement for
'related_table' is more than 1MB (the default value of the
'max_allowed_packet' system variable), you should split it into smaller
parts and execute multiple *note 'DELETE': delete. statements.  You
probably get the fastest *note 'DELETE': delete. by specifying only 100
to 1,000 'related_column' values per statement if the 'related_column'
is indexed.  If the 'related_column' isn't indexed, the speed is
independent of the number of arguments in the 'IN' clause.


File: manual.info.tmp,  Node: no-matching-rows,  Next: problems-with-float,  Prev: deleting-from-related-tables,  Up: query-issues

B.4.4.7 Solving Problems with No Matching Rows
..............................................

If you have a complicated query that uses many tables but that returns
no rows, you should use the following procedure to find out what is
wrong:

  1. Test the query with *note 'EXPLAIN': explain. to check whether you
     can find something that is obviously wrong.  See *note explain::.

  2. Select only those columns that are used in the 'WHERE' clause.

  3. Remove one table at a time from the query until it returns some
     rows.  If the tables are large, it is a good idea to use 'LIMIT 10'
     with the query.

  4. Issue a *note 'SELECT': select. for the column that should have
     matched a row against the table that was last removed from the
     query.

  5. If you are comparing *note 'FLOAT': floating-point-types. or *note
     'DOUBLE': floating-point-types. columns with numbers that have
     decimals, you cannot use equality ('=') comparisons.  This problem
     is common in most computer languages because not all floating-point
     values can be stored with exact precision.  In some cases, changing
     the *note 'FLOAT': floating-point-types. to a *note 'DOUBLE':
     floating-point-types. fixes this.  See *note problems-with-float::.

  6. If you still cannot figure out what is wrong, create a minimal test
     that can be run with 'mysql test < query.sql' that shows your
     problems.  You can create a test file by dumping the tables with
     *note 'mysqldump --quick db_name TBL_NAME_1 ... TBL_NAME_N >
     query.sql': mysqldump.  Open the file in an editor, remove some
     insert lines (if there are more than needed to demonstrate the
     problem), and add your *note 'SELECT': select. statement at the end
     of the file.

     Verify that the test file demonstrates the problem by executing
     these commands:

          shell> mysqladmin create test2
          shell> mysql test2 < query.sql

     Attach the test file to a bug report, which you can file using the
     instructions in *note bug-reports::.


File: manual.info.tmp,  Node: problems-with-float,  Prev: no-matching-rows,  Up: query-issues

B.4.4.8 Problems with Floating-Point Values
...........................................

Floating-point numbers sometimes cause confusion because they are
approximate and not stored as exact values.  A floating-point value as
written in an SQL statement may not be the same as the value represented
internally.  Attempts to treat floating-point values as exact in
comparisons may lead to problems.  They are also subject to platform or
implementation dependencies.  The *note 'FLOAT': floating-point-types.
and *note 'DOUBLE': floating-point-types. data types are subject to
these issues.  For *note 'DECIMAL': fixed-point-types. columns, MySQL
performs operations with a precision of 65 decimal digits, which should
solve most common inaccuracy problems.

The following example uses *note 'DOUBLE': floating-point-types. to
demonstrate how calculations that are done using floating-point
operations are subject to floating-point error.

     mysql> CREATE TABLE t1 (i INT, d1 DOUBLE, d2 DOUBLE);
     mysql> INSERT INTO t1 VALUES (1, 101.40, 21.40), (1, -80.00, 0.00),
         -> (2, 0.00, 0.00), (2, -13.20, 0.00), (2, 59.60, 46.40),
         -> (2, 30.40, 30.40), (3, 37.00, 7.40), (3, -29.60, 0.00),
         -> (4, 60.00, 15.40), (4, -10.60, 0.00), (4, -34.00, 0.00),
         -> (5, 33.00, 0.00), (5, -25.80, 0.00), (5, 0.00, 7.20),
         -> (6, 0.00, 0.00), (6, -51.40, 0.00);

     mysql> SELECT i, SUM(d1) AS a, SUM(d2) AS b
         -> FROM t1 GROUP BY i HAVING a <> b;

     +------+-------+------+
     | i    | a     | b    |
     +------+-------+------+
     |    1 |  21.4 | 21.4 |
     |    2 |  76.8 | 76.8 |
     |    3 |   7.4 |  7.4 |
     |    4 |  15.4 | 15.4 |
     |    5 |   7.2 |  7.2 |
     |    6 | -51.4 |    0 |
     +------+-------+------+

The result is correct.  Although the first five records look like they
should not satisfy the comparison (the values of 'a' and 'b' do not
appear to be different), they may do so because the difference between
the numbers shows up around the tenth decimal or so, depending on
factors such as computer architecture or the compiler version or
optimization level.  For example, different CPUs may evaluate
floating-point numbers differently.

If columns 'd1' and 'd2' had been defined as *note 'DECIMAL':
fixed-point-types. rather than *note 'DOUBLE': floating-point-types, the
result of the *note 'SELECT': select. query would have contained only
one row--the last one shown above.

The correct way to do floating-point number comparison is to first
decide on an acceptable tolerance for differences between the numbers
and then do the comparison against the tolerance value.  For example, if
we agree that floating-point numbers should be regarded the same if they
are same within a precision of one in ten thousand (0.0001), the
comparison should be written to find differences larger than the
tolerance value:

     mysql> SELECT i, SUM(d1) AS a, SUM(d2) AS b FROM t1
         -> GROUP BY i HAVING ABS(a - b) > 0.0001;
     +------+-------+------+
     | i    | a     | b    |
     +------+-------+------+
     |    6 | -51.4 |    0 |
     +------+-------+------+
     1 row in set (0.00 sec)

Conversely, to get rows where the numbers are the same, the test should
find differences within the tolerance value:

     mysql> SELECT i, SUM(d1) AS a, SUM(d2) AS b FROM t1
         -> GROUP BY i HAVING ABS(a - b) <= 0.0001;
     +------+------+------+
     | i    | a    | b    |
     +------+------+------+
     |    1 | 21.4 | 21.4 |
     |    2 | 76.8 | 76.8 |
     |    3 |  7.4 |  7.4 |
     |    4 | 15.4 | 15.4 |
     |    5 |  7.2 |  7.2 |
     +------+------+------+
     5 rows in set (0.03 sec)

Floating-point values are subject to platform or implementation
dependencies.  Suppose that you execute the following statements:

     CREATE TABLE t1(c1 FLOAT(53,0), c2 FLOAT(53,0));
     INSERT INTO t1 VALUES('1e+52','-1e+52');
     SELECT * FROM t1;

On some platforms, the 'SELECT' statement returns 'inf' and '-inf'.  On
others, it returns '0' and '-0'.

An implication of the preceding issues is that if you attempt to create
a replication slave by dumping table contents with *note 'mysqldump':
mysqldump. on the master and reloading the dump file into the slave,
tables containing floating-point columns might differ between the two
hosts.


File: manual.info.tmp,  Node: optimizer-issues,  Next: table-definition-issues,  Prev: query-issues,  Up: problems

B.4.5 Optimizer-Related Issues
------------------------------

MySQL uses a cost-based optimizer to determine the best way to resolve a
query.  In many cases, MySQL can calculate the best possible query plan,
but sometimes MySQL does not have enough information about the data at
hand and has to make 'educated' guesses about the data.

For the cases when MySQL does not do the "right" thing, tools that you
have available to help MySQL are:

   * Use the *note 'EXPLAIN': explain. statement to get information
     about how MySQL processes a query.  To use it, just add the keyword
     *note 'EXPLAIN': explain. to the front of your *note 'SELECT':
     select. statement:

          mysql> EXPLAIN SELECT * FROM t1, t2 WHERE t1.i = t2.i;

     *note 'EXPLAIN': explain. is discussed in more detail in *note
     explain::.

   * Use 'ANALYZE TABLE TBL_NAME' to update the key distributions for
     the scanned table.  See *note analyze-table::.

   * 
     Use 'FORCE INDEX' for the scanned table to tell MySQL that table
     scans are very expensive compared to using the given index:

          SELECT * FROM t1, t2 FORCE INDEX (index_for_column)
          WHERE t1.col_name=t2.col_name;

     'USE INDEX' and 'IGNORE INDEX' may also be useful.  See *note
     index-hints::.

   * Global and table-level 'STRAIGHT_JOIN'.  See *note select::.

   * You can tune global or threa